game.zuanversion = "琉璃专属版";
game.import("extension",
function(lib, game, ui, get, ai, _status) {
    game.zuanSetSSRAudio = function(name, num) {
        lib.skill[name] = {
            audio: num,
        };
        return {
            AudioLink: name + ': ' + num,
        };
    };//('shensu1_ol_xiahouyuan', 2)
    return {
        name: "祖安武将",
        editable: false,
        content: function(config, pack) {

            window.zuanDamageAudio = true;
            if (!lib.config['extension_祖安设置_showboss']) return;
            if (get.mode() == 'tafang') return;
            var storage = localStorage.getItem('boss_storage_playpackconfig');
            try {
                storage = JSON.parse(storage) || {};
            } catch(e) {
                storage = {};
            }
            if (!storage.translate) {
                storage.translate = {};
            }
            var loadversus = function() {
                if (get.mode() != 'versus') {
                    game.loadModeAsync('versus',
                    function(mode) {
                        for (var i in mode.translate) {
                            lib.translate[i] = lib.translate[i] || mode.translate[i];
                            storage.translate[i] = mode.translate[i];
                        }
                        for (var i in mode.skill) {
                            if (lib.skill[i]) console.log(i);
                            if (i != 'versus_ladder') {
                                lib.skill[i] = mode.skill[i];
                            }
                        }
                        for (var ii in mode.skill) {
                            if (ii != 'versus_ladder') {
                                game.finishSkill(ii);
                            }
                        }
                        storage.versus = {};
                        for (var i in mode.jiangeboss) {
                            if (mode.jiangeboss[i][4].contains('bossallowed')) {
                                storage.versus[i] = mode.jiangeboss[i];
                            }
                        }
                        localStorage.setItem('boss_storage_playpackconfig', JSON.stringify(storage));
                    });
                } else {
                    localStorage.setItem('boss_storage_playpackconfig', JSON.stringify(storage));
                }
            };
            if (get.mode() != 'boss') {
                game.loadModeAsync('boss',
                function(mode) {
                    for (var i in mode.translate) {
                        lib.translate[i] = lib.translate[i] || mode.translate[i];
                        storage.translate[i] = mode.translate[i];
                    }
                    for (var i in mode.skill) {
                        if (lib.skill[i]) console.log(i);
                        lib.skill[i] = mode.skill[i];
                    }
                    for (var ii in mode.skill) {
                        if (ii != 'versus_ladder') {
                            game.finishSkill(ii);
                        }
                    }
                    storage.boss = {};
                    for (var i in mode.characterPack.mode_boss) {
                        if (mode.characterPack.mode_boss[i][4] && mode.characterPack.mode_boss[i][4].contains('bossallowed')) {
                            storage.boss[i] = mode.characterPack.mode_boss[i];
                        }
                    }
                    loadversus();
                });
            } else {
                loadversus();
            }
        },
        precontent: function() {
            if (!lib.config['extension_祖安设置_enable']) {
                game.saveConfig('extension_祖安设置_enable', true);
                //lib.config['extension_电影设置_enable']=true;
            }
            if (!lib.config['extension_祖安设置_showboss']) return;
            if (get.mode() == 'tafang') return;
            var storage = localStorage.getItem('boss_storage_playpackconfig');
            try {
                storage = JSON.parse(storage) || {};
            } catch(e) {
                storage = {};
            }
            if (get.mode() != 'boss') {
                lib.characterPack.mode_extension_boss = storage.boss || {};
                for (var i in lib.characterPack.mode_extension_boss) {
                    lib.characterPack.mode_extension_boss[i][4].push('mode:boss');
                    lib.character[i] = lib.characterPack.mode_extension_boss[i];
                    if (typeof lib.character[i][2] != 'number' && (typeof lib.character[i][2] != 'string' || lib.character[i][2].indexOf('/') == -1)) {
                        lib.character[i][2] = Infinity;
                    }
                    if (!lib.config.boss_enableai_playpackconfig) {
                        lib.config.forbidai.push(i);
                    }
                }
            }
            var list2 = storage.versus || {};
            if (get.mode() != 'versus' || get.config('versus_mode') != 'jiange') {
                lib.characterPack.mode_extension_jiange = list2;
                for (var i in list2) {
                    lib.characterPack.mode_extension_jiange[i] = list2[i];
                    lib.characterPack.mode_extension_jiange[i][4].push('mode:versus');
                    lib.character[i] = list2[i];
                    lib.character[i][4].add('No_Outcrop');
                    if (typeof lib.character[i][2] != 'number') {
                        lib.character[i][2] = Infinity;
                    }
                    if (!lib.config.boss_enableai_playpackconfig) {
                        lib.config.forbidai.push(i);
                    }
                }
                lib.characterIntro.boss_liedixuande = lib.characterIntro.liubei;
                lib.characterIntro.boss_gongshenyueying = lib.characterIntro.huangyueying;
                lib.characterIntro.boss_tianhoukongming = lib.characterIntro.shen_zhugeliang;
                lib.characterIntro.boss_yuhuoshiyuan = lib.characterIntro.pangtong;
                lib.characterIntro.boss_qiaokuijunyi = lib.characterIntro.zhanghe;
                lib.characterIntro.boss_jiarenzidan = lib.characterIntro.caozhen;
                lib.characterIntro.boss_duanyuzhongda = lib.characterIntro.simayi;
                lib.characterIntro.boss_juechenmiaocai = lib.characterIntro.xiahouyuan;
            } else if (_status.mode != 'jiange') {
                for (var i in list2) {
                    lib.character[i] = list2[i];
                    if (!lib.config.boss_enableai_playpackconfig) {
                        lib.config.forbidai.push(i);
                    }
                }
            }
            var list = storage.translate || {};
            list.mode_extension_boss_character_config = '挑战武将';
            list.mode_extension_jiange_character_config = '剑阁武将';

            for (var i in list) {
                lib.translate[i] = lib.translate[i] || list[i];
            }
        },
        help: {
            "祖安武将": "<br>更新日志>>><br><br>[2024.06.27]<br><br><li>重置 标包增强 系列武将，修复部分技能失效<li>维护优化部分运行代码，提高游戏流畅度，修复报错<br><br>[2023.10.09]<li>优化 界面布局 、 回合特效 、 祖安对话 和 攻击指示线 的代码<br><br>[2023.09.10]<li>扩展进入维护期，不定时检测并修补代码和机制<br><br>[2023.07.29]<li>紧急修复了 新版无名杀 导致代码失效的问题<li>设置界面 搬迁到新的附属扩展中<li>新增 标准武将 增强包的分类开关<br><br>[2023.05.21]<li>优化了扩展界面的结构代码，改善选项显示和提示，修复古早版本中提及的显示错位问题<li>增加3种新款式 手牌背景<li>将 张春华 替换成 李典，再次补齐标准包武将增强<li>削弱部分 标准武将增强 武将，调整平衡性<li>修复部分BUG，包括机制BUG以及武将、装备的代码BUG<br><br>[2023.05.18]<li>增加4种新款式 手牌背景<li>修复了一些代码错误<li>新增试验性功能 游戏身份隐藏，目前功能并未完善<br><br>[2023.05.09]<li>新增三个攻击指示特效<li>完结 装备增强系统<li>新增2个 元气模式 天赋，修改部分天赋效果<li>优化 开始界面美化 中 无名杀 的素材<li>优化 武将回合特效 的代码结构，将 武将回合特效 的素材重置为立绘<br><br>[2023.05.03]<li>新增 等级奖励 的新规则<li>新增 装备增强系统<li>新增4个 元气模式 天赋<li>优化了电脑启动动画的画面拉伸问题<li>更新了 祖安对话 优化代码和内容的新版本<li>新增 标包武将增强 的 强力替换模式，优化部分武将技能<li>修复了若干BUG<br><br>[2022.08.06]<li>优化了 群雄争霸 和 讨伐叛军 模式的规则和代码<li>新增7个 元气模式 天赋<li>优化了部分 标准武将增强 技能<br><br>[2022.08.04]<li>优化 攻守京城 和 讨伐叛军 主公阵亡后的效果，添加专属贴图<li>更改了部分技能的描述，新增类似“终焉技”、“陨星技”等的技能类型<li>将 魏延 替换成 徐庶，完成对标准包武将的全部强化<li>优化 大将英魂 和 标包武将增强 的替换效果，优化储存器的保留效果<li>优化部分 游戏模式 和 娱乐效果 的规则和代码，减少发生错误的概率，同时限制了使用的模式，减少可能的冲突<li>取消 开局动画关闭 对金币的要求，安装扩展后若打开富甲天下，则将金币锁定在 99999999 的数值<br><br>[2022.07.28]<li>新增12个 标准武将增强 武将，优化了体力调整的判断，调整了部分武将的技能，修复了部分脑残AI<li>修复 游戏自定义工具 的代码，减少产生错误的可能<li>优化 标准武将增强 和 自定义武将 在国战中的效果，修复技能重复的BUG<li>优化了 兵乐闪电特效 的代码，统一并简化了显示代码，极大提升了显示效果<li>增加了 兵乐闪电特效 中 草木皆兵 的贴图，修改了部分贴图，同时修复了部分的显示错误<br><br>[2022.02.18]<li>优化 界面比例设置，选择时自动调整比例<li>美化手牌栏的样式显示<li>调整部分 标准武将增强 武将<li>修复 游戏自定义工具 BOSS武将包不显示图片的BUG<li>修复 游戏自定义工具 不显示除基本势力外的角色的BUG<li>修复 游戏自定义工具 手牌显示滞留不关闭的BUG<li>优化 游戏自定义工具 ，新增替换手牌功能<br><br>[2022.02.14]<li>新增 节日快乐特效 功能，在特定的节日将展示动画<li>新增 生日庆祝，生日当天会有节日特效，并且会有特殊的开局台词<li>修复无 十周年UI 扩展情况下 手牌整理出现的BUG<li>优化 标准武将增强 功能，修复一些替换时发生的错误<li>修复部分 标准武将增强 武将的技能<br><br>[2022.02.09]<li>新增 开始界面 的美化效果<li>新增12个 标准武将增强 武将，并优化了部分武将<li>新增若干 祖安对话 台词<li>重制 开局动画 ，缩短了播放的时间<li>新增 启动动画 的播放音效<li>新增 游卡桌游 的启动动画<li>重写 动态画面特效 代码，优化播放效果，修复其导致的壁纸消失问题<li>新增 手杀 和 十周年 的卡牌音效<li>新增 富甲天下 的雪花特效设置<li>优化 10周年UI 立绘效果<li>武将回合特效 优化部分武将贴图，素材源自『桤楴』立绘资源包，特此感谢<li>修复了各 游戏模式 中部分显示的问题，优化体验<li>修改了 等级 以及 游戏模式 中主要的标记为贴图<li>完善 自定义工具 换将在双将模式下的主副武将更换<li>重写 手牌整理 代码<li>更名 羁绊一抽手气 为 天选之子模式 ，并添加提高判定的运气的功能<li>新增 窗口比例 的设置，可以调整窗口大小<br><br>[2021.08.31]<li>新增 游戏启动动画 鎏金岁月 和 至臻黑金<li>完全修复 武将回合特效 无贴图时显示错误的BUG<br><br>[2021.08.30]<li>新增 霓裳羽衣 游戏场景壁纸<li>修改了 标准武将增强 刘备的仁德技能<br><br>[2021.08.28]<li>新增 游戏启动动画 功能<br><br>[2021.08.27]<li>新增 手牌整理 功能<li>新增 海棠依旧、世海壁纸、锦绣山河 游戏场景壁纸，扩充了 梦幻壁纸 内容<li>新增 深宫殿堂、元夕之夜、苍龙夜月、破碎庙宇 菜单界面壁纸<br><br>[2021.08.26]<li>为 祖安台词 新增了一些网络梗句<li>新增 兵乐闪电覆盖特效 不透明度的调整选项<li>新增电脑端支持1280x660显示大小的兼容<li>新增 元气系统 获得技能时显示技能名称的效果<li>修改了 水墨 攻击指示特效<li>搬运了 永远的萌新 的 特效测试 中的攻击指示特效<li>新增 魔爪 和 御剑 攻击指示特效（攻击指示，原名 指示线条）<br><br>[2021.08.25]<li>优化了界面UI<li>修复了 标准武将增强 功能中断弦AI的BUG<li>修改了 标准武将增强 诸葛亮的运筹和空城、貂蝉的离魂、刘备的仁德技能<li>修复了 元气系统 不兼容电脑端的BUG，同时优化了护盾的图标显示<li>修改了 元气系统 部分天赋<li>优化了 元气系统 的天赋规则，死亡后不会清空天赋<br><br>[2021.08.20]<li>新增 标准武将增强 功能<li>优化了 战危 显示的时机（拥有护盾、体力上限为一时不显示）<li>修复 指示线条特效 在默认选项下的BUG<li>修复了一些显示BUG和一些机制BUG<li>新增部分 武将回合特效 贴图<br><br>[2021.08.09]<li>新增 指示线条特效<li>新增 砸花送蛋表情<li>修复上一个版本再次出现的壁纸丢失BUG<li>新增一张 势力风貌 神势力的壁纸<li>修复 元气系统 中天赋未出现雷盾、体力值为无限大时卡死等BUG，同时优化了一些偏弱天赋<br><br>[2021.08.03]<li>新增 手牌栏美化 功能<li>新增 武将回合开始特效<li>重新整理、添加了许多壁纸，同时降低了壁纸的大小，优化游戏流畅性（包括菜单壁纸 和 场景壁纸）<li>完成了部分电脑端的兼容<li>调整美化了拓展的界面<li>修复了所有已知的BUG<br><br>[2021.07.26]<li>新增 前置壁纸 功能<li>增加卡牌 火山 的动画特效以及角色体力值不大于一的 战危 特效<li>新增娱乐玩法 元气系统<li>减少了部分动态壁纸的体积，增加流畅度<li>优化了开始游戏时作者的LOGO动画<li>基本修复了动画特效导致动态壁纸消失的问题，优化了闪电的动画特效<br><br>[2021.07.09]<li>新增游戏场景自定义功能，可更换场上的武将、查看身份、交换位置以及查看并更换角色的手牌（供拓展作者测试武将技能的配合和AI）<li>将各模式增加体力上限和体力的方式从回复体力改为直接改变，避免触发回复体力获得经验的BUG<li>减少了娱乐模式中躯干技能显示的频率<br><br>[2020.06.21]<li>新增并完善祖安对话内容<li>增加女武将专属卖萌对话内容（做这个真的头疼）<li>新增升级提示播报关闭按钮<li>增加娱乐玩法暗夜鬼城<li>新增兵乐闪电特效10周年UI长边的适配版及其优化美化版<li>尽量修复动画特效等不明原因关闭动态壁纸的BUG（但是衔接问题仍然摸不着头脑）<li>增加 势力风貌 壁纸和 新杀春日 壁纸（新杀壁纸搬运自 无名杀爱好者交流群II 未经上传者同意，请上传联系我并给我来一拳）<br><br>[2021.06.19]<li>放假，从监狱中解放出来<li>计划继续更新本拓展<br><br>[2020.03.25]<li>平衡娱乐模式的强度（可在界面处关闭）<li>增加祖安词库<li>即将公开发布本拓展<br><br>[2020.03.19]<li>新增暗杀行动模式<li>使界面的横线框长度兼容<li>即将公开发布本拓展<br><br>[2020.03.18]<li>新增同将之争效果<li>修复7级时计算距离-1增益失效问题<br><br>[2020.03.15]<li>大将英魂移至娱乐玩法<li>新增群侠论武效果<li>新增桃花落尽效果<br><br>[2020.03.14]<li>新增大将英魂模式<br><br>[2020.03.13]<li>平衡各模式的强度<li>增加祖安语音和卡牌音效<li>在贴吧发布第二版内测<br><br>[2020.03.09]<li>完善界面UI<li>在贴吧发布第一版内测<br><br>[2020.03.07]<li>完成界面基本UI以及按钮<li>加入动态皮肤<li>新增模式雷鸣山谷<li>开始处理后期细节<li>制作动画特效等<br><br>[2020.03.10]<li>新增幻海之诗模式<li>填写更新日志<br><br>[2020.03.09]<li>完善界面UI<li>在贴吧发布第一版内测<br><br>[2020.03.07]<li>完成界面基本UI以及按钮<li>加入动态皮肤<li>新增模式雷鸣山谷<li>开始处理后期细节<li>制作动画特效等<br><br>[2020.03.06]<li>拓展玩法完成<li>基本架构完成，<li>所有目前已知的BUG修复<li>开始在贴吧预告<br><br>[2020.03.04]<li>等级模式完成<li>开始设计拓展玩法<br><br>[2020.03.03]<li>台词功能完成<li>填入互动台词<li>完成兵乐闪电特效<li>开始设计等级模式<br><br>[2020.02.29]<li>开始设计祖安拓展<li>逐步完成台词功能",
            //"幻海之诗":"꧁幻 海 之 诗꧂<br><br>.   我的小鱼你醒了<br>.   还认识早晨吗<br>.   昨夜你曾经说<br>.   愿夜幕永不开启<br>.   你的香腮边轻轻滑落的<br>.   是你的泪，还是我的泪<br>.   初吻吻别的那个季节<br>.   不是已经哭过了吗<br>.   我的指尖还记忆着<br>.   你慌乱的心跳<br>.   温润的体香里<br>.   那一绺长发飘飘<br><br>.   ……",
            "元气天赋": "<li>天赋库 数量：52<br><br>〖蓝盾〗<li>你的护盾消失后，你免疫多余的伤害，并且直到下回合开始，你免疫一次伤害。<br><br>〖火盾〗<li>每回合限一次，当你即将受到火属性的伤害时，你令此伤害减一。<br><br>〖雷盾〗<li>每回合限一次，当你即将受到雷属性的伤害时，你令此伤害减一。<br><br>〖毒盾〗<li>每回合限两次，当你即将受【毒】影响或流失体力时，你减少一点造成的体力流失。<br><br>〖刺盾〗<li>当受到与你距离不大于一的角色除【杀】或【决斗】外造成，或没有来源的伤害时，你防止此伤害。<br><br>〖血盾〗<li>你获得一点体力上限，并回复一点体力。（当你失去此天赋时，你减少一点体力上限）<br><br>〖护盾〗<li>你获得一点护盾上限，并恢复一点护盾。（当你失去此天赋时，你减少一点护盾上限）<br><br>〖碎盾〗<li>当你的护盾受到攻击后，伤害来源弃一张牌，本回合内你不能再受到伤害。<br><br>〖紫手〗<li>当一名其他角色使用【杀】指定你为目标时，其需弃置一张手牌，否则此【杀】对你无效。<br><br>〖药水〗<li>当你对濒死的角色使用【桃】恢复体力时，你令此【桃】能额外回复一点体力。<br><br>〖吸蓝〗<li>每回合限两次，当有一名其他角色进入濒死状态时，你摸一张牌。<br><br>〖吸血〗<li>每当你造成一点伤害后，你可进行一次判定：若为红色非锦囊，你回复一点体力。<br><br>〖蓄力〗<li>回合结束阶段，若你于本回合的出牌阶段内没有过使用或打出过【杀】，则你摸一张牌。<br><br>〖霰弹〗<li>当你使用一张【杀】指定一名角色作为目标后，你可为此【杀】额外指定一个目标。<br><br>〖瞄准〗<li>每当你使用【杀】指定目标后，你进行判定：若为黑色非锦囊，则此【杀】不可被闪避。<br><br>〖激光〗<li>当你即将使用【杀】或【决斗】造成伤害时，你令此伤害变为雷属性并令目标弃一张牌。<br><br>〖折射〗<li>每回合限一次，当你的【杀】被闪避后，你可为此【杀】指定另一个目标。<br><br>〖元素〗<li>当你即将造成属性伤害时，你令此伤害加一。（冷却时间：2轮）<br><br>〖穿透〗<li>你无视场上所有其他角色的防具，所有其他角色的防具对你无法产生效果。<br><br>〖防御〗<li>你最多只能受到一点伤害，你最多只能流失一点体力。<br><br>〖修盾〗<li>你的回合开始时，你恢复护盾可以不受到恢复的条件限制。（冷却时间：2轮）<br><br>〖选择〗<li>你可以提前选一次天赋，当你在选择天赋的过程中，你可额外增加两个可选择的选项。<br><br>〖遗忘〗<li>你选择遗忘并且删除一个天赋，你的下个回合开始时你可重新选择一次天赋。<br><br>〖商店〗<li>你的摸牌阶段开始时进行一次判定：若为基本牌，则你令摸牌数增加一。<br><br>〖冰盾〗<li>你的武将牌始终正面向上，你移除你的判定区。（失去此天赋后你恢复判定区）<br><br>〖近战〗<li>当你与其他角色计算距离时，你令你与该角色计算的距离减少一。<br><br>〖冷却〗<li>每回合更新一次，你将你原武将牌上除限定技、觉醒技和主公技以外的随机一个技能克隆。<br><br>〖能量〗<li>你的弃牌阶段时，你的手牌上限始终视为增加两张。<br><br>〖速击〗<li>你的出牌阶段内，你可使用【杀】的次数上限加一。<br><br>〖真伤〗<li>你即将造成伤害时，你令你造成的伤害无视伤害目标的护盾。<br><br>〖强化〗<li>你可以强化一次装备区的标准/军争/SP包防具，当你失去强化的防具时，你将其重置并重新装备。（冷却时间：3轮）<br><br>〖血箱〗<li>当你的手牌或装备牌中存在红桃牌时，你可以将其当做【桃】使用。<br><br>〖反弹〗<li>当你使用【闪】闪避了一名角色对你使用的【杀】后，你视为对其使用此【杀】。<br><br>〖逃逸〗<li>当你没有护盾，与其他角色计算距离时，你令该角色与你计算的距离增加一。<br><br>〖雕像〗<li>你随机展示四个未拥有的限定技，然后选择获得其中一个。<br><br>〖双武〗<li>当你失去装备区的武器牌时，你保留该武器的技能直到你失去下一张武器牌。<br><br>〖宠物〗<li>你装备区内的坐骑牌不能够被弃置，当你即将受到伤害时，你区域内的坐骑牌会替你抵挡等量的伤害。<br><br>〖归盾〗<li>当你的护盾受到伤害后，你获得等伤害的量的牌。<br><br>〖嗜血〗<li>当你受到伤害后，直到你的下回合结束，你的【杀】不可被闪避。<br><br>〖狂暴〗<li>每当你的【杀】造成一点伤害后，你摸一张牌。<br><br>〖炸弹〗<li>当一名角色死亡时，你可以立即令至多两名其他角色受到随机〇至两点火焰伤害。<br><br>〖金盾〗<li>你每有两张手牌时，你的护盾上限增加一。（最多增加三点）<br><br>〖移盾〗<li>每轮限一次，当你使用或打出一张【闪】时，你回复一点护盾。<br><br>〖法杖〗<li>你使用单体非延时锦囊牌时可以额外指定一名角色作为目标。<br><br>〖幸运〗<li>在你进行判定前，你将牌堆顶的三张牌中对你判定结果最有利的一张牌置于牌堆顶。<br><br>〖连发〗<li>你使用【杀】对一名距离大于一或非上下家的角色结算完毕后，你视为对该角色再使用一张【杀】。<br><br>〖双盾〗<li>你受到的无属性伤害加一，当你的护盾消失后，你将护盾恢复至满。（冷却时间：3轮）<br><br>〖移速〗<li>每张卡限一次，当你使用的【杀】命中角色目标后，你摸一张牌。<br><br>〖抑制〗<li>当你使用【杀】造成伤害时，你令该角色的护盾恢复延迟一个回合。（不可叠加）<br><br>〖增效〗<li>每回合限一次，当你于摸牌阶段外摸牌时，你额外摸一张牌。<br><br>〖治愈〗<li>当你回复体力时，若你的体力值不大于上限的一半，你额外回复一点体力。（冷却时间：3回合）<br><br>〖突变〗<li>你令你的手牌上限始终视为减少一张，然后你增加两个天赋槽位。"
        },
        config: {
            // ---------------------------------------按钮开关------------------------------------------//
            "informknow": {
                "name": "◈ <span class=\"texiaotext\" style=\"color:#C0C0C0\">长按以获取详情或彩蛋</span>",
                "init": "0",
                "intro": "你长按下面的选项，不是长按我..<br>⚆_⚆ Okay?",
                "item": {
                    "0": " ",
                    //"1":"你有在听课嘛同学？<br>是长按不是点击啊<br>(ー_ー)!!"
                },
                "textMenu": function(node, link) {
                    lib.setScroll(node.parentNode);
                    node.innerHTML = "你有在听课嘛同学？<br>是长按不是点击啊<br>(ー_ー)!!";
                },
            },
            "about1": {
                "name": "———————————",
                "init": "1",
                "intro": "我只是一条线，你点我干嘛？ →_→",
                "item": {
                    "1": "———————————"
                },
                "textMenu": function(node, link) {
                    lib.setScroll(node.parentNode);
                    node.innerHTML = "我只是一条线，你点我干嘛？ →_→";
                },
            },
            "about2": {
                //"name":".       <span class=\"goldtext\" style=\"color:#DAA520\">祖</span> <span class=\"exttext\" style=\"color:#7FFFAA\">安</span> <span class=\"yellowtext\" style=\"color:#FFFF00\">武</span> <span class=\"fuhuotext\" style=\"color:#87CEFA\">将</span>",
                "name": '<div style="test-aligh:center;transform: translate(-50%, 0%);left: 50%;position: relative;"><img style=width:238px;opacity:0.9 src=' + lib.assetURL + 'extension/祖安武将/basic/title.png></div>',
                "init": "1",
                "intro": "标题党？<br>_(´ཀ`」 ∠)__ ",
                "item": {
                    "1": " "
                },
                "textMenu": function(node, link) {
                    lib.setScroll(node.parentNode);
                    node.innerHTML = "标题党？<br>_(´ཀ`」 ∠)__ ";
                },
            },
            "blank1": {
                "name": " ",
                "init": "1",
                "intro": "标题党？<br>_(´ཀ`」 ∠)__ ",
                "item": {
                    "1": " "
                },
                "textMenu": function(node, link) {
                    lib.setScroll(node.parentNode);
                    node.innerHTML = "标题党？<br>_(´ཀ`」 ∠)__ ";
                },
            },
            "blank2": {
                "name": " ",
                "init": "1",
                "intro": "标题党？<br>_(´ཀ`」 ∠)__ ",
                "item": {
                    "1": " "
                },
                "textMenu": function(node, link) {
                    lib.setScroll(node.parentNode);
                    node.innerHTML = "标题党？<br>_(´ཀ`」 ∠)__ ";
                },
            },
            /*"huisheng":{
	            //"name":".       <span class=\"goldtext\" style=\"color:#DAA520\">祖</span> <span class=\"exttext\" style=\"color:#7FFFAA\">安</span> <span class=\"yellowtext\" style=\"color:#FFFF00\">武</span> <span class=\"fuhuotext\" style=\"color:#87CEFA\">将</span>",
	            "name":"<img style=width:238px;opacity:0.9 src="+lib.assetURL+"extension/祖安武将/basic/huisheng.png>",
	            "init":"1",
	            "intro":"快来加群(✿≖◡≖)✧",
	            "item":{
	                "1":" "
	            }
	        },*/
            "Myfriend": {
                "name": '<div style="test-aligh:center;transform: translate(-50%, 0%);left: 50%;position: relative;"><img style=width:238px;opacity:0.9 src=' + lib.assetURL + 'extension/祖安武将/basic/myfriend.png></div>',
                "init": "1",
                "intro": "感谢好友 梦寻千古鹿原雪（世中人） 的鼎力相助，听我说靴靴你，因为有你，温暖了司机...<br>( *ˊᵕˋ)✩︎‧₊",
                "item": {
                    "1": " "
                },
                "textMenu": function(node, link) {
                    lib.setScroll(node.parentNode);
                    node.innerHTML = "感谢好友 梦寻千古鹿原雪（世中人） 的鼎力相助，听我说靴靴你，因为有你，温暖了司机...<br>( *ˊᵕˋ)✩︎‧₊";
                },
            },
            "about3": { //<div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);">
                "name": '<div style="test-aligh:center;transform: translate(-50%, 0%);left: 50%;position: relative;"><span class=\"texiaotext\" style=\"color:#C0C0C0\">[点击查看说明]</span></div>',
                "init": "1",
                "intro": "这个让你点击你反而长按了是怎么回事。。<br>-_-||",
                "item": {
                    "1": " ",
                    "2": " ",
                    "3": " ",
                    "4": " ",
                    "5": " ",
                    "6": " ",
                    "7": " ",
                    "8": " ",
                    "9": " ",
                    "10": " ",
                    /*"1":"<span style=\"animation: -webkit-animation:fairy 20s infinite;animation:fairy 20s infinite;\">最近更新日期： 2024.06.27</span>",
	                "2":"[在“帮助”处查看更新日志]",
	                "3":" ",
	                "4":"<span class=\"playext\" style=\"color:#87CEFA\">规则介绍 > > > </span><br><br><span class=\"playext\" style=\"color:#4169E1\">[等级模式]</span><li>初始等级为1级；<li>每回合开始获得3点经验；<li>每回合限三次，使用一张手牌获得2点经验；<li>每造成一点伤害获得7点经验；<li>每回复一点体力后获得已失体力值加一*2点经验；<li>每击杀一名角色获得25点经验；<li>每个等级升级所需经验：等级*2+20点；<li>每提升一级摸一张牌<span class=\"balancetext\" style=\"color:#C0C0C0\">（取消摸牌效果）</span>。<br><br><span class=\"playext\" style=\"color:#4169E1\">[等级奖励]</span><li><span class=\"playext\" style=\"color:#87CEFA\">新规则 ></span><br>  三级：手牌上限+1；<br>  四级：【杀】的使用范围+1；<br>  五级：【杀】的使用次数+1；<br>  六级：防御距离+1；<br>  七级：进攻距离+1；<br>  八级：体力上限+1；<br>  九级：摸牌阶段摸牌数+1；<br>  十级：出牌阶段限两次，可将两张手牌当一张基本牌使用。<li><span class=\"playext\" style=\"color:#87CEFA\">旧规则 ></span><br>  三级：手牌上限+1；<br>  四级：获得一点护甲；<br>  五级：【杀】的使用次数+1；<br>  六级：手牌上限+1；<br>  七级：攻击距离+1；<br>  八级：获得一点体力上限；<br>  九级：摸牌阶段额外摸一张牌；<br>  十级：出牌阶段限两次，可将两张手牌当一张基本牌使用。<br><br><span class=\"playext\" style=\"color:#4169E1\">[复活效果]</span><li>武将死亡后将于 等级*0.4+0.1（向上取整） 个回合后复活；<li>复活后手牌摸至X张。（X为角色等级*0.5向上取整）",
	                "5":" ",
	                "6":"<span class=\"playext\" style=\"color:#90EE90\">拓展玩法 > > > </span><br><br><span class=\"playext\" style=\"color:#00FF7F\">[普通模式]</span><li>无任何特殊效果的普通战役。<span class=\"playext\" style=\"color:#87CEFA\"><br>〈所有模式可用〉<br></span><br><span class=\"playext\" style=\"color:#00FF7F\">[攻守京城]</span><li>角色拥有复活效果；<li>主公死亡后出现 京城 ；<li><span class=\"balancetext\" style=\"color:#C0C0C0\">游戏开始时内奸重新平均分配忠臣和反贼的身份（优先反贼）</span>；<li>京城的初始体力值为游戏开始时反贼的数量*8；<li>所有角色与京城计算距离时视为一；<li>京城没有手牌和装备牌，受到伤害视为流失体力，受到【杀】造成的伤害翻倍，且不能回复体力；<li>京城不能成为除闪电、火山、洪水和浮雷外延时锦囊牌的目标；<li>京城需要两张【闪】才能抵消【杀】，其他非反贼角色可替京城打出【闪】；<li>京城的回合改为随机令场上任意一名反贼打出一张【闪】，或受到一点伤害，<span class=\"balancetext\" style=\"color:#C0C0C0\">以此法造成X点伤害（X为场上存活的忠臣的数量）</span>；<li><span class=\"balancetext\" style=\"color:#C0C0C0\">在主公或忠臣的回合，非濒死的反贼不能使用【桃】</span>；<li>反贼击杀主公后，击杀者摸三张牌；<li><span class=\"balancetext\" style=\"color:#C0C0C0\">当有一名反贼死亡后，随机一名其他已死亡的反贼复活延迟一个回合</span>；<li><span class=\"balancetext\" style=\"color:#C0C0C0\">当有一名忠臣死亡后，若主公为死亡，其失去一点体力</span>；<li><span class=\"balancetext\" style=\"color:#C0C0C0\">所有角色每死亡两次延长一个回合的复活时间，最多5个回合</span>；<li>京城或所有反贼死亡后游戏结束。<span class=\"playext\" style=\"color:#87CEFA\"><br>〈身份模式可用〉</span><br><br><span class=\"playext\" style=\"color:#00FF7F\">[群雄争霸]</span><li>游戏开始时主公称为 霸主 ，其他角色均改为反贼，称为 群雄 ；<li>霸主 的回合内，所有的其他角色非濒死时不能使用【桃】；<li><span class=\"balancetext\" style=\"color:#C0C0C0\">场上所有角色直接的距离均视为一</span>；<li>霸主 回合开始时摸两张牌，手牌上限+2<span class=\"balancetext\" style=\"color:#C0C0C0\">（取消此效果）</span>；<li><span class=\"balancetext\" style=\"color:#C0C0C0\">其他角色的摸牌阶段摸牌时，霸主 摸等量张牌，其他角色弃牌阶段弃牌时，霸主 随机弃等量张手牌</span>；<li><span class=\"balancetext\" style=\"color:#C0C0C0\">霸主 每杀死一名其他角色，胜利推进一个轮数</span>；<li>霸主 不会被无来源的伤害杀死，霸主被击杀后，将身份转移到击杀者身上，且使场上不为 霸主 的角色各流失一点体力，并加速复活效果一个回合；<li>每个 霸主 出现后开始计算，五轮后直接获得胜利。<span class=\"playext\" style=\"color:#87CEFA\"><br>〈身份模式可用〉</span><br><br><span class=\"playext\" style=\"color:#00FF7F\">[讨伐叛军]</span><li>角色拥有复活效果；<li>游戏开始时主公称为 官府 ，忠臣和内奸称为 官兵 ，主公和忠臣属于官府阵营，反贼称为 叛军 ，属于叛军阵营；<li>所有角色受到火焰伤害时需弃置一张牌，每名角色回合开始时进行一次判定：若结果为红桃，则受到来自 官府 的一点火焰伤害<span class=\"balancetext\" style=\"color:#C0C0C0\">（此技能改为所有角色受到火焰伤害时随机弃置一张牌，每轮开始时，若场上所有角色的判定区内没有【火山】，则将一张【火山】随机置入一名角色的判定区内）</span>；<li>叛军，忠臣身份的 官兵 死亡后，增加敌对阵营一点势力，官府死亡后增加敌对阵营两点势力；<li>先到达10点势力的阵营胜利（或反贼和内奸全部死亡后官府阵营胜利）；<li>叛军 被击杀后没有原模式中相应的摸牌奖励；<li><span class=\"balancetext\" style=\"color:#C0C0C0\">当最后一个 叛军 即将阵亡时，强行随机复活一个已阵亡的叛军</span>；<li>击杀内奸身份的 官兵 后，内奸随机与一名场上存活的忠臣官兵对调身份，击杀者<span class=\"balancetext\" style=\"color:#C0C0C0\">增加一点护甲，</span>获得Buff效果：持续三回合，摸牌阶段额外摸一张牌，限一次，对一名角色造成一点火焰伤害；<li>所有角色非濒死时回复的体力改为摸等量的牌。<span class=\"balancetext\" style=\"color:#C0C0C0\">（此技能改为所有角色非脱离濒死回复的每一点体力前需进行判定：若结果为红桃或武将牌上“桃”标记存在的花色，则可回复体力并弃置所有的“桃”；否则回复体力失效，将判定牌置于武将牌上，称为“桃”）<span class=\"playext\" style=\"color:#87CEFA\"><br>〈身份模式可用〉</span><br><br><span class=\"playext\" style=\"color:#00FF7F\">[天下归心]</span><li>游戏开始时，主公称为 汉高祖 ，其他所有角色改为反贼且称为 楚军 ；<li>主公额外获得一点体力上限，摸牌阶段额外摸两张牌，手牌上限始终为体力上限+2<span class=\"balancetext\" style=\"color:#C0C0C0\">（额外摸牌和手牌上限改为+X，X为楚军的数量）</span>；<li>主公初始拥有一枚人心标记，主公造成伤害时，受伤者若为 楚军 ，则有一定概率（该概率为 楚军数量/全场角色数）使 楚军 变为忠臣并移除一枚人心标记，称之为 汉军 ；<li>最后一名 楚军 不会被改变阵营；<li>每有一名其他角色死亡，主公回复一点体力并获得一枚人心标记<span class=\"balancetext\" style=\"color:#C0C0C0\">（若死亡的角色不为楚军，你无法获得人心标记）</span>。<span class=\"playext\" style=\"color:#87CEFA\"><br>〈所有模式可用〉</span><br><br><span class=\"playext\" style=\"color:#00FF7F\">[雷鸣山谷]</span><li>游戏开始时所有角色体力翻倍；<li>游戏开始时所有的【反馈】和【鬼才】技能均替换为【天妒】；<li>每名角色的回合开始时，若其判定区没有“闪电”，则置入一张“闪电”；<li>每名角色在4级时，随机获得【红颜】，【连环】，【天妒】中的一个；<li>每名角色在8级时，随机获得【观星】，【看破】和【鬼才】中的一个；<li>所有获得的技能不会重复。<span class=\"playext\" style=\"color:#87CEFA\"><br>〈所有模式可用〉</span><br><br><span class=\"playext\" style=\"color:#00FF7F\">[幻海之诗]</span><li>游戏开始时所有角色失去所有技能并将体力以及上限调整为4点；<li>主公的回合开始时进行一次判定，若为方块则所有角色所有技能失效直到下一轮开始；<span class=\"balancetext\" style=\"color:#C0C0C0\">（改为摸一张牌并投掷一枚骰子，场上所有角色区域内与该数字相等的牌全部进入弃牌堆，若数字为6则所有角色所有技能失效直到下一轮开始）</span><li>主公的回合开始时所有角色随机调整一次位置；<li>角色每提升到奇数等级时随机获得相同势力中一名角色的一个技能，不会重复。<span class=\"playext\" style=\"color:#87CEFA\"><br>〈身份单将可用〉</span><br><br><span class=\"playext\" style=\"color:#00FF7F\">[暗杀行动]</span><li>游戏开始时，所有的反贼变为忠臣，内奸变为刺客，所有身份均不展示；<li><span class=\"balancetext\" style=\"color:#C0C0C0\">降低AI的嘲讽度，降低伤亡速度</span>；<li>游戏开始的第二个回合夜幕降临：只要刺客存在，主公的每个回合结束都会有一名忠臣死亡；<li>当所有忠臣死亡时，刺客身份暴露，此时夜幕消逝；<li>夜幕消逝后的第三个回合，夜幕将再次降临：若主公仍未能杀死刺客，则主公于回合结束时死亡，刺客胜利；<li>刺客的举动会和其他忠臣有微小差别，细心观察可以识破；<li>本模式建议关闭自动标记身份。（当然，打开后也不一定会暴露刺客的身份）<span class=\"playext\" style=\"color:#87CEFA\"><br>〈身份模式可用〉</span>",
	                "7":" ",
	                "8":"<span class=\"playext\" style=\"color:#FFFFE0\">娱乐玩法 > > > </span><br><br><span class=\"playext\" style=\"color:#FFFF00\">[大将英魂]</span><li>每名角色在游戏开始时在标准包武将中选择一名武将作为“将魂”；<li>在每名角色的出牌阶段，其可以将武将在原武将和“将魂”直接转换，冷却时间为一回合；（在 攻守京城、群雄争霸、讨伐叛军 模式中冷却时间改为2回合）<li>转换武将时，武将解除负面效果；<li>原武将和“将魂”之间的装备分别独立，体力按比例转换（向上取整）；<li>当角色濒死时，可以移除其将魂转换技能还原其武将牌并使体力值回复至3点，然后摸3张牌。<span class=\"playext\" style=\"color:#87CEFA\"><br>〈单将模式可用〉</span><br><br><span class=\"playext\" style=\"color:#FFFF00\">[群侠论武]</span><li>所有角色拥有技能【极武】<li>【极武】：当你被【杀】指定为目标时，你可以立即使用一张【杀】，若你的【杀】造成伤害，则指定你的【杀】无效。<span class=\"playext\" style=\"color:#87CEFA\"><br>〈所有模式可用〉</span><br><br><span class=\"playext\" style=\"color:#FFFF00\">[桃花尽落]</span><li>锁定技，所有角色非濒死不能使用【桃】，可以重铸【桃】。<span class=\"playext\" style=\"color:#87CEFA\"><br>〈所有模式可用〉</span><br><br><span class=\"playext\" style=\"color:#FFFF00\">[同将之争]</span><li>所有角色变为玩家选择的角色。<span class=\"playext\" style=\"color:#87CEFA\"><br>〈所有模式可用〉</span><br><br><span class=\"playext\" style=\"color:#FFFF00\">[暗夜鬼城]</span><li>主公的回合结束后，若场上有已死亡的角色，场上所有角色翻面，游戏随机将已死亡的角色变成“鬼”加入游戏；<li>所有的“鬼”不能成为卡牌的目标，不在计算距离内，初始时有四张手牌并且满血，回合结束后离开游戏<span class=\"playext\" style=\"color:#87CEFA\"><br>〈身份模式可用〉</span><br><br><span class=\"playext\" style=\"color:#FFFF00\">[元气系统]</span><li>此玩法的机制改自手游《元气骑士》；<li>所有玩家将体力值按任意比例转化成护盾值；<li>护盾与体力值系统分离，不受到有关体力值技能或卡牌的影响（除【铁索连环】外）；<li>所有护盾值不为满的角色在回合开始时，若其和其护盾从上个同样阶段到现在没有受到过伤害或流失体力，其恢复一点护盾（不能超过护盾上限）；<li>游戏中每名角色的第一个回合开始时，其可选择并获得一个天赋，此后每2轮的回合开始时可再选择并获得一个天赋（天赋数量不能超过6个，在 攻守京城、群雄争霸、讨伐叛军 模式中改为每3轮）；<li>天赋的选项将从天赋库中随机选取三项供角色选择；<li>若该角色在规定的轮数内未获得天赋，则在下一个回合的开始时可再次进行选择获得天赋；<li>天赋的详细内容列表请在“帮助”处进行查看。<span class=\"playext\" style=\"color:#87CEFA\"><br>〈所有模式可用〉</span>",
	                "9":"<br><br><br><br><br><br><br><br><br>"*/
                },
                "textMenu": function(node, link) {
                    lib.setScroll(node.parentNode);
                    //node.parentNode.style.transform = "translateY(-100px)";
                    //node.parentNode.style.height = "300px";
                    //node.parentNode.style.width = "300px";
                    //node.style.width="400px";
                    switch (link) {
                    case "1":
                        node.innerHTML = "<span style=\"animation: -webkit-animation:fairy 20s infinite;animation:fairy 20s infinite;\">最近更新日期： 2024.06.27 - 琉璃版</span>";
                        break;
                    case "2":
                        node.innerHTML = "[在“帮助”处查看更新日志]";
                        break;
                    case "3":
                        node.innerHTML = "<span class=\"infext\" style=\"color:#FFD01C\">注意！</span><span class=\"infext\" style=\"color:#DBDBDB\">若游戏频繁弹出诸如“扩展名设置不正确”等提示，请自行关闭《搬运自用》这一扩展，是由此扩展太过爱管闲事错误地检测 祖安武将 扩展的安装信息导致。</span>";
                        break;
                    case "4":
                        node.innerHTML = " ";
                        break;
                    case "5":
                        node.innerHTML = "<span class=\"playext\" style=\"color:#87CEFA\">规则介绍 > > > </span><br><br><span class=\"playext\" style=\"color:#4169E1\">[等级模式]</span><li>初始等级为1级；<li>每回合开始获得3点经验；<li>每回合限三次，使用一张手牌获得2点经验；<li>每造成一点伤害获得7点经验；<li>每回复一点体力后获得已失体力值加一*2点经验；<li>每击杀一名角色获得25点经验；<li>每个等级升级所需经验：等级*2+20点；<li>每提升一级摸一张牌<span class=\"balancetext\" style=\"color:#C0C0C0\">（取消摸牌效果）</span>。<br><br><span class=\"playext\" style=\"color:#4169E1\">[等级奖励]</span><li><span class=\"playext\" style=\"color:#87CEFA\">新规则 ></span><br>  三级：手牌上限+1；<br>  四级：【杀】的使用范围+1；<br>  五级：【杀】的使用次数+1；<br>  六级：防御距离+1；<br>  七级：进攻距离+1；<br>  八级：体力上限+1；<br>  九级：摸牌阶段摸牌数+1；<br>  十级：出牌阶段限两次，可将两张手牌当一张基本牌使用。<li><span class=\"playext\" style=\"color:#87CEFA\">旧规则 ></span><br>  三级：手牌上限+1；<br>  四级：获得一点护甲；<br>  五级：【杀】的使用次数+1；<br>  六级：手牌上限+1；<br>  七级：攻击距离+1；<br>  八级：获得一点体力上限；<br>  九级：摸牌阶段额外摸一张牌；<br>  十级：出牌阶段限两次，可将两张手牌当一张基本牌使用。<br><br><span class=\"playext\" style=\"color:#4169E1\">[复活效果]</span><li>武将死亡后将于 等级*0.4+0.1（向上取整） 个回合后复活；<li>复活后手牌摸至X张。（X为角色等级*0.5向上取整）";
                        break;
                    case "6":
                        node.innerHTML = " ";
                        break;
                    case "7":
                        node.innerHTML = "<span class=\"playext\" style=\"color:#90EE90\">拓展玩法 > > > </span><br><br><span class=\"playext\" style=\"color:#00FF7F\">[普通模式]</span><li>无任何特殊效果的普通战役。<span class=\"playext\" style=\"color:#87CEFA\"><br>〈所有模式可用〉<br></span><br><span class=\"playext\" style=\"color:#00FF7F\">[攻守京城]</span><li>角色拥有复活效果；<li>主公死亡后出现 京城 ；<li><span class=\"balancetext\" style=\"color:#C0C0C0\">游戏开始时内奸重新平均分配忠臣和反贼的身份（优先反贼）</span>；<li>京城的初始体力值为游戏开始时反贼的数量*8；<li>所有角色与京城计算距离时视为一；<li>京城没有手牌和装备牌，受到伤害视为流失体力，受到【杀】造成的伤害翻倍，且不能回复体力；<li>京城不能成为除闪电、火山、洪水和浮雷外延时锦囊牌的目标；<li>京城需要两张【闪】才能抵消【杀】，其他非反贼角色可替京城打出【闪】；<li>京城的回合改为随机令场上任意一名反贼打出一张【闪】，或受到一点伤害，<span class=\"balancetext\" style=\"color:#C0C0C0\">以此法造成X点伤害（X为场上存活的忠臣的数量）</span>；<li><span class=\"balancetext\" style=\"color:#C0C0C0\">在主公或忠臣的回合，非濒死的反贼不能使用【桃】</span>；<li>反贼击杀主公后，击杀者摸三张牌；<li><span class=\"balancetext\" style=\"color:#C0C0C0\">当有一名反贼死亡后，随机一名其他已死亡的反贼复活延迟一个回合</span>；<li><span class=\"balancetext\" style=\"color:#C0C0C0\">当有一名忠臣死亡后，若主公为死亡，其失去一点体力</span>；<li><span class=\"balancetext\" style=\"color:#C0C0C0\">所有角色每死亡两次延长一个回合的复活时间，最多5个回合</span>；<li>京城或所有反贼死亡后游戏结束。<span class=\"playext\" style=\"color:#87CEFA\"><br>〈身份模式可用〉</span><br><br><span class=\"playext\" style=\"color:#00FF7F\">[群雄争霸]</span><li>游戏开始时主公称为 霸主 ，其他角色均改为反贼，称为 群雄 ；<li>霸主 的回合内，所有的其他角色非濒死时不能使用【桃】；<li><span class=\"balancetext\" style=\"color:#C0C0C0\">场上所有角色直接的距离均视为一</span>；<li>霸主 回合开始时摸两张牌，手牌上限+2<span class=\"balancetext\" style=\"color:#C0C0C0\">（取消此效果）</span>；<li><span class=\"balancetext\" style=\"color:#C0C0C0\">其他角色的摸牌阶段摸牌时，霸主 摸等量张牌，其他角色弃牌阶段弃牌时，霸主 随机弃等量张手牌</span>；<li><span class=\"balancetext\" style=\"color:#C0C0C0\">霸主 每杀死一名其他角色，胜利推进一个轮数</span>；<li>霸主 不会被无来源的伤害杀死，霸主被击杀后，将身份转移到击杀者身上，且使场上不为 霸主 的角色各流失一点体力，并加速复活效果一个回合；<li>每个 霸主 出现后开始计算，五轮后直接获得胜利。<span class=\"playext\" style=\"color:#87CEFA\"><br>〈身份模式可用〉</span><br><br><span class=\"playext\" style=\"color:#00FF7F\">[讨伐叛军]</span><li>角色拥有复活效果；<li>游戏开始时主公称为 官府 ，忠臣和内奸称为 官兵 ，主公和忠臣属于官府阵营，反贼称为 叛军 ，属于叛军阵营；<li>所有角色受到火焰伤害时需弃置一张牌，每名角色回合开始时进行一次判定：若结果为红桃，则受到来自 官府 的一点火焰伤害<span class=\"balancetext\" style=\"color:#C0C0C0\">（此技能改为所有角色受到火焰伤害时随机弃置一张牌，每轮开始时，若场上所有角色的判定区内没有【火山】，则将一张【火山】随机置入一名角色的判定区内）</span>；<li>叛军，忠臣身份的 官兵 死亡后，增加敌对阵营一点势力，官府死亡后增加敌对阵营两点势力；<li>先到达10点势力的阵营胜利（或反贼和内奸全部死亡后官府阵营胜利）；<li>叛军 被击杀后没有原模式中相应的摸牌奖励；<li><span class=\"balancetext\" style=\"color:#C0C0C0\">当最后一个 叛军 即将阵亡时，强行随机复活一个已阵亡的叛军</span>；<li>击杀内奸身份的 官兵 后，击杀者<span class=\"balancetext\" style=\"color:#C0C0C0\">增加一点护甲，</span>获得Buff效果：持续三回合，摸牌阶段额外摸一张牌，限一次，对一名角色造成一点火焰伤害；<li>所有角色非濒死时回复的体力改为摸等量的牌。<span class=\"balancetext\" style=\"color:#C0C0C0\">（此技能改为所有角色非脱离濒死回复的每一点体力前需进行判定：若结果为红桃或武将牌上“桃”标记存在的花色，则可回复体力并弃置所有的“桃”；否则回复体力失效，将判定牌置于武将牌上，称为“桃”）<span class=\"playext\" style=\"color:#87CEFA\"><br>〈身份模式可用〉</span><br><br><span class=\"playext\" style=\"color:#00FF7F\">[天下归心]</span><li>游戏开始时，主公称为 汉高祖 ，其他所有角色改为反贼且称为 楚军 ；<li>主公额外获得一点体力上限，摸牌阶段额外摸两张牌，手牌上限始终为体力上限+2<span class=\"balancetext\" style=\"color:#C0C0C0\">（额外摸牌和手牌上限改为+X，X为楚军的数量）</span>；<li>主公初始拥有一枚人心标记，主公造成伤害时，受伤者若为 楚军 ，则有一定概率（该概率为 楚军数量/全场角色数）使 楚军 变为忠臣并移除一枚人心标记，称之为 汉军 ；<li>最后一名 楚军 不会被改变阵营；<li>每有一名其他角色死亡，主公回复一点体力并获得一枚人心标记<span class=\"balancetext\" style=\"color:#C0C0C0\">（若死亡的角色不为楚军，你无法获得人心标记）</span>。<span class=\"playext\" style=\"color:#87CEFA\"><br>〈所有模式可用〉</span><br><br><span class=\"playext\" style=\"color:#00FF7F\">[雷鸣山谷]</span><li>游戏开始时所有角色体力翻倍；<li>游戏开始时所有的【反馈】和【鬼才】技能均替换为【天妒】；<li>每名角色的回合开始时，若其判定区没有“闪电”，则置入一张“闪电”；<li>每名角色在4级时，随机获得【红颜】，【连环】，【天妒】中的一个；<li>每名角色在8级时，随机获得【观星】，【看破】和【鬼才】中的一个；<li>所有获得的技能不会重复。<span class=\"playext\" style=\"color:#87CEFA\"><br>〈所有模式可用〉</span><br><br><span class=\"playext\" style=\"color:#00FF7F\">[幻海之诗]</span><li>游戏开始时所有角色失去所有技能并将体力以及上限调整为4点；<li>主公的回合开始时进行一次判定，若为方块则所有角色所有技能失效直到下一轮开始；<span class=\"balancetext\" style=\"color:#C0C0C0\">（改为摸一张牌并投掷一枚骰子，场上所有角色区域内与该数字相等的牌全部进入弃牌堆，若数字为6则所有角色所有技能失效直到下一轮开始）</span><li>主公的回合开始时所有角色随机调整一次位置；<li>角色每提升到奇数等级时随机获得相同势力中一名角色的一个技能，不会重复。<span class=\"playext\" style=\"color:#87CEFA\"><br>〈身份单将可用〉</span><br><br><span class=\"playext\" style=\"color:#00FF7F\">[暗杀行动]</span><li>游戏开始时，所有的反贼变为忠臣，内奸变为刺客，所有身份均不展示；<li><span class=\"balancetext\" style=\"color:#C0C0C0\">降低AI的嘲讽度，降低伤亡速度</span>；<li>游戏开始的第二个回合夜幕降临：只要刺客存在，主公的每个回合结束都会有一名忠臣死亡；<li>当所有忠臣死亡时，刺客身份暴露，此时夜幕消逝；<li>夜幕消逝后的第三个回合，夜幕将再次降临：若主公仍未能杀死刺客，则主公于回合结束时死亡，刺客胜利；<li>刺客的举动会和其他忠臣有微小差别，细心观察可以识破；<li>本模式建议关闭自动标记身份。（当然，打开后也不一定会暴露刺客的身份）<span class=\"playext\" style=\"color:#87CEFA\"><br>〈身份模式可用〉</span>";
                        break;
                    case "8":
                        node.innerHTML = " ";
                        break;
                    case "9":
                        node.innerHTML = "<span class=\"playext\" style=\"color:#FFFFE0\">娱乐玩法 > > > </span><br><br><span class=\"playext\" style=\"color:#FFFF00\">[大将英魂]</span><li>每名角色在游戏开始时在标准包武将中选择一名武将作为“将魂”；<li>在每名角色的出牌阶段，其可以将武将在原武将和“将魂”直接转换，冷却时间为一回合；（在 攻守京城、群雄争霸、讨伐叛军 模式中冷却时间改为2回合）<li>转换武将时，武将解除负面效果；<li>原武将和“将魂”之间的装备分别独立，体力按比例转换（向上取整）；<li>当角色濒死时，可以移除其将魂转换技能还原其武将牌并使体力值回复至3点，然后摸3张牌。<span class=\"playext\" style=\"color:#87CEFA\"><br>〈单将模式可用〉</span><br><br><span class=\"playext\" style=\"color:#FFFF00\">[群侠论武]</span><li>所有角色拥有技能【极武】<li>【极武】：当你被【杀】指定为目标时，你可以立即使用一张【杀】，若你的【杀】造成伤害，则指定你的【杀】无效。<span class=\"playext\" style=\"color:#87CEFA\"><br>〈所有模式可用〉</span><br><br><span class=\"playext\" style=\"color:#FFFF00\">[桃花尽落]</span><li>锁定技，所有角色非濒死不能使用【桃】，可以重铸【桃】。<span class=\"playext\" style=\"color:#87CEFA\"><br>〈所有模式可用〉</span><br><br><span class=\"playext\" style=\"color:#FFFF00\">[同将之争]</span><li>所有角色变为玩家选择的角色。<span class=\"playext\" style=\"color:#87CEFA\"><br>〈所有模式可用〉</span><br><br><span class=\"playext\" style=\"color:#FFFF00\">[暗夜鬼城]</span><li>主公的回合结束后，若场上有已死亡的角色，场上所有角色翻面，游戏随机将已死亡的角色变成“鬼”加入游戏；<li>所有的“鬼”不能成为卡牌的目标，不在计算距离内，初始时有四张手牌并且满血，回合结束后离开游戏<span class=\"playext\" style=\"color:#87CEFA\"><br>〈身份模式可用〉</span><br><br><span class=\"playext\" style=\"color:#FFFF00\">[元气系统]</span><li>此玩法的机制改自手游《元气骑士》；<li>所有玩家将体力值按任意比例转化成护盾值；<li>护盾与体力值系统分离，不受到有关体力值技能或卡牌的影响（除【铁索连环】外）；<li>所有护盾值不为满的角色在回合开始时，若其和其护盾从上个同样阶段到现在没有受到过伤害或流失体力，其恢复一点护盾（不能超过护盾上限）；<li>游戏中每名角色的第一个回合开始时，其可选择并获得一个天赋，此后每2轮的回合开始时可再选择并获得一个天赋（天赋数量不能超过6个，在 攻守京城、群雄争霸、讨伐叛军 模式中改为每3轮）；<li>天赋的选项将从天赋库中随机选取三项供角色选择；<li>若该角色在规定的轮数内未获得天赋，则在下一个回合的开始时可再次进行选择获得天赋；<li>天赋的详细内容列表请在“帮助”处进行查看。<span class=\"playext\" style=\"color:#87CEFA\"><br>〈所有模式可用〉</span>";
                        break;
                    case "10":
                        node.innerHTML = "<br><br><br><br><br><br><br><br><br>";
                        break;
                    }
                },
            },
            "about4": {
                "name": "———————————",
                "init": "1",
                "intro": "不是，你点我有什么意义？←_←",
                "item": {
                    "1": "———————————"
                },
                "textMenu": function(node, link) {
                    lib.setScroll(node.parentNode);
                    node.innerHTML = "不是，你点我有什么意义？←_←";
                },
            },
            "falseedit": {
                "name": "编辑此扩展",
                "init": "0",
                "intro": "对不起，您不能通过长按来进入扩展编辑页面",
                "item": {
                    "0": " ",
                    //"1":"什么！你还想编辑我？<br>(ಡωಡ)"
                },
                "textMenu": function(node, link) {
                    lib.setScroll(node.parentNode);
                    node.innerHTML = "什么！你还想编辑我？<br>(ಡωಡ)";
                },
            }
        },
        package: {
            character: {
                character: {
                    // ---------------------------------------武将列表------------------------------------------//
                    "ssr_luxun": ["male", "wu", 3, ["ssr_qianxun", "ssr_jueji"], []],
                    "ssr_sunquan": ["male", "wu", 4, ["ssr_zhiheng", "ssr_jianye", "ssr_jiuyuan"], ["zhu", ]],
                    "ssr_zhaoyun": ["male", "shu", 4, ["ssr_newlongdan", "ssr_newpozhen"], []],
                    "ssr_zhugeliang": ["male", "shu", 3, ["ssr_jinnang", "ssr_newbazhen"], []],
                    "ssr_zhangliao": ["male", "wei", 4, ["ssr_tuxi", "ssr_newmubing"], []],
                    "ssr_ganning": ["male", "wu", 4, ["ssr_jinfan", "ssr_qixi"], []],
                    "ssr_machao": ["male", "shu", "2/4/2", ["ssr_zhuiji", "ssr_tieji"], []],
                    "ssr_zhouyu": ["male", "wu", 3, ["ssr_youqin", "ssr_newfanjian"], []],
                    "ssr_liubei": ["male", "shu", 4, ["ssr_shichou", "ssr_newrende", "ssr_jijiang"], ["zhu", ]],
                    "ssr_dianwei": ["male", "wei", 4, ["ssr_qiangxi", "ssr_qingji"], []],
                    "ssr_guojia": ["male", "wei", 3, ["ssr_bailun", "ssr_newyice"], []],
                    "ssr_caocao": ["male", "wei", 4, ["ssr_tumeng", "ssr_zhujiu", "ssr_hujia"], ["zhu", ]],
                    "ssr_lvbu": ["male", "qun", 4, ["ssr_shenfen", "ssr_kuangbao", "ssr_wushuang", "ssr_jiwu"], []],
                    "ssr_huangzhong": ["male", "shu", 4, ["ssr_liegong", "ssr_pojia"], []],
                    "ssr_xiahoudun": ["male", "wei", 4, ["ssr_newganglie", "ssr_zuni"], []],
                    "ssr_huatuo": ["male", "qun", 3, ["ssr_chuli", "ssr_xianfang"], []],
                    "ssr_yujin": ["male", "wei", 4, ["ssr_newzhenjun", "ssr_newyizhong"], []],
                    "ssr_zuoci": ["male", "qun", 3, ["ssr_shendao", "ssr_newjiahe"], []],
                    "ssr_huaxiong": ["male", "qun", 4, ["ssr_miedi", "ssr_shiyong"], []],
                    "ssr_huanggai": ["male", "wu", 4, ["ssr_newkurou", "ssr_fenchuan"], []],
                    "ssr_diaochan": ["female", "qun", 3, ["ssr_newlihun", "ssr_biyue"], []],
                    "ssr_yuanshu": ["male", "qun", 4, ["ssr_yjixi", "ssr_yanji", "ssr_cuandi"], []],
                    "ssr_guanyu": ["male", "shu", 4, ["ssr_wusheng", "ssr_yijue"], []],
                    "ssr_lvmeng": ["male", "wu", 4, ["ssr_newbaiyi", "ssr_liecheng"], []],
                    "ssr_gongsunzan": ["male", "qun", 4, ["ssr_newyucong", "ssr_newyicong"], []],
                    "ssr_daqiao": ["female", "wu", 3, ["ssr_newguose", "ssr_newtongque"], []],
                    "ssr_xiaoqiao": ["female", "wu", 3, ["ssr_newtianxiang", "ssr_newtongque"], []],
                    "ssr_xuzhu": ["male", "wei", 4, ["ssr_huchi", "ssr_newluoyi"], []],
                    "ssr_zhangfei": ["male", "shu", 4, ["ssr_zhenhun", "ssr_paoxiao"], []],
                    "ssr_zhenji": ["female", "wei", 3, ["ssr_newluoshen", "ssr_yushui"], []],
                    "ssr_sunshangxiang": ["female", "wu", 3, ["ssr_jieyin", "ssr_weigong"], []],
                    "ssr_simayi": ["male", "wei", 3, ["ssr_tianlang", "ssr_newjilue"], []],
                    "ssr_yiji": ["male", "shu", 3, ["ssr_newjijie", "ssr_newjiyuan"], []],
                    "ssr_huangyueying": ["female", "shu", 3, ["ssr_jiqiao", "ssr_qicai"], []],
                    "ssr_jiaxu": ["male", "qun", 3, ["ssr_newweimu", "ssr_guimou", "ssr_newluanwu"], []],
                    "ssr_caiwenji": ["female", "qun", 3, ["ssr_nianlei", "ssr_newduanxian"], []],
                    "ssr_menghuo": ["male", "shu", 4, ["ssr_manjia", "ssr_zaiqi"], []],
                    "ssr_zhurong": ["female", "shu", 3, ["ssr_manjia", "ssr_lieren"], []],
                    "ssr_jiangwei": ["male", "shu", 4, ["ssr_zhiji", "ssr_weilong"], []],
                    "ssr_sunce": ["male", "wu", 4, ["ssr_hunzi", "ssr_newjiang", "ssr_newzhiba"], ["zhu", ]],
                    "ssr_taishici": ["male", "wu", '2/4/2', ["ssr_kuiwei", "ssr_newhanzhan"], []],
                    "ssr_zhoutai": ["male", "wu", 4, ["ssr_newbuqu", "ssr_huwei"], []],
                    "ssr_xiahouyuan": ["male", "wei", 4, ["ssr_shensu", "ssr_hubu"], []],
                    "ssr_caoren": ["male", "wei", 4, ["ssr_jushou", "ssr_zhuzhen"], []],
                    "ssr_dengai": ["male", "wei", 4, ["ssr_tuntian", "ssr_zaoxian"], []],
                    "ssr_dongzhuo": ["male", "qun", 8, ["ssr_newhengzheng", "ssr_baonue", "ssr_newjiuchi"], ["zhu", ]],
                    "ssr_yuji": ["male", "qun", 3, ["ssr_newmizhou", "ssr_chanyuan"], []],
                    "ssr_yuanshao": ["male", "qun", 4, ["ssr_newluanji", "ssr_newdingsheng", "ssr_newshiyi"], ["zhu", ]],
                    "ssr_xushu": ["male", "shu", 4, ["ssr_zhuhai", "ssr_yijian"], []],
                    "ssr_fazheng": ["male", "shu", 3, ["ssr_newfabing", "ssr_xuanhuo"], []],
                    "ssr_pangtong": ["male", "shu", 3, ["ssr_lianhuan", "ssr_newsance"], []],
                    "ssr_zhanghe": ["male", "wei", 4, ["ssr_newxiebian", "ssr_motu"], []],
                    "ssr_re_lidian": ["male", "wei", '3/4/1', ["ssr_xunxun", "ssr_wangxi"], []],
                    "ssr_xuhuang": ["male", "wei", 4, ["ssr_jieliang", "ssr_zhiyan"], []],
                    "ssr_sunjian": ["male", "wu", 4, ["ssr_futu", "ssr_newpolu"], []],
                    "ssr_lusu": ["male", "wu", 3, ["ssr_dimeng", "ssr_fuhui"], []],
                    "ssr_zhangzhang": ["male", "wu", 3, ["ssr_zhijian", "ssr_guzheng"], []],
                    "ssr_zhangjiao": ["male", "qun", 3, ["ssr_tianlei", "ssr_gaiming", "ssr_newguidao", "ssr_zhuji"], ["zhu", ]],
                    "ssr_zhangbao": ["male", "qun", 3, ["ssr_dihuo", "ssr_gaiming", "ssr_guifu"], []],
                    "ssr_zhangliang": ["male", "qun", 3, ["ssr_renhong", "ssr_gaiming", "ssr_fangtong"], []],
                },
                translate: {
                    "ssr_luxun": "源陆逊",
                    "ssr_sunquan": "源孙权",
                    "ssr_zhaoyun": "源赵云",
                    "ssr_zhugeliang": "源诸葛亮",
                    "ssr_zhangliao": "源张辽",
                    "ssr_ganning": "源甘宁",
                    "ssr_machao": "源马超",
                    "ssr_zhouyu": "源周瑜",
                    "ssr_liubei": "源刘备",
                    "ssr_dianwei": "源典韦",
                    "ssr_guojia": "源郭嘉",
                    "ssr_caocao": "源曹操",
                    "ssr_lvbu": "源吕布",
                    "ssr_huangzhong": "源黄忠",
                    "ssr_xiahoudun": "源夏侯惇",
                    "ssr_huatuo": "源华佗",
                    "ssr_yujin": "源于禁",
                    "ssr_zuoci": "源左慈",
                    "ssr_huaxiong": "源华雄",
                    "ssr_huanggai": "源黄盖",
                    "ssr_diaochan": "源貂蝉",
                    "ssr_yuanshu": "源袁术",
                    "ssr_guanyu": "源关羽",
                    "ssr_lvmeng": "源吕蒙",
                    "ssr_gongsunzan": "源公孙瓒",
                    "ssr_daqiao": "源大乔",
                    "ssr_xiaoqiao": "源小乔",
                    "ssr_xuzhu": "源许褚",
                    "ssr_zhangfei": "源张飞",
                    "ssr_zhenji": "源甄姬",
                    "ssr_sunshangxiang": "源孙尚香",
                    "ssr_simayi": "源司马懿",
                    "ssr_yiji": "源伊籍",
                    "ssr_huangyueying": "源黄月英",
                    "ssr_jiaxu": "源贾诩",
                    "ssr_caiwenji": "源蔡文姬",
                    "ssr_menghuo": "源孟获",
                    "ssr_zhurong": "源祝融",
                    "ssr_jiangwei": "源姜维",
                    "ssr_sunce": "源孙策",
                    "ssr_taishici": "源太史慈",
                    "ssr_zhoutai": "源周泰",
                    "ssr_xiahouyuan": "源夏侯渊",
                    "ssr_caoren": "源曹仁",
                    "ssr_dengai": "源邓艾",
                    "ssr_dongzhuo": "源董卓",
                    "ssr_yuji": "源于吉",
                    "ssr_yuanshao": "源袁绍",
                    "ssr_xushu": "源徐庶",
                    "ssr_fazheng": "源法正",
                    "ssr_pangtong": "源庞统",
                    "ssr_zhanghe": "源张郃",
                    "ssr_re_lidian": "源李典",
                    "ssr_xuhuang": "源徐晃",
                    "ssr_sunjian": "源孙坚",
                    "ssr_lusu": "源鲁肃",
                    "ssr_zhangzhang": "源张昭张纮",
                    "ssr_zhangjiao": "源张角",
                    "ssr_zhangbao": "源张宝",
                    "ssr_zhangliang": "源张梁",

                    "ssr_luxun_ab": "陆逊",
                    "ssr_sunquan_ab": "孙权",
                    "ssr_zhaoyun_ab": "赵云",
                    "ssr_zhugeliang_ab": "诸葛亮",
                    "ssr_zhangliao_ab": "张辽",
                    "ssr_ganning_ab": "甘宁",
                    "ssr_machao_ab": "马超",
                    "ssr_zhouyu_ab": "周瑜",
                    "ssr_liubei_ab": "刘备",
                    "ssr_dianwei_ab": "典韦",
                    "ssr_guojia_ab": "郭嘉",
                    "ssr_caocao_ab": "曹操",
                    "ssr_lvbu_ab": "吕布",
                    "ssr_huangzhong_ab": "黄忠",
                    "ssr_xiahoudun_ab": "夏侯惇",
                    "ssr_huatuo_ab": "华佗",
                    "ssr_yujin_ab": "于禁",
                    "ssr_zuoci_ab": "左慈",
                    "ssr_huaxiong_ab": "华雄",
                    "ssr_huanggai_ab": "黄盖",
                    "ssr_diaochan_ab": "貂蝉",
                    "ssr_yuanshu_ab": "袁术",
                    "ssr_guanyu_ab": "关羽",
                    "ssr_lvmeng_ab": "吕蒙",
                    "ssr_gongsunzan_ab": "公孙瓒",
                    "ssr_daqiao_ab": "大乔",
                    "ssr_xiaoqiao_ab": "小乔",
                    "ssr_xuzhu_ab": "许褚",
                    "ssr_zhangfei_ab": "张飞",
                    "ssr_zhenji_ab": "甄姬",
                    "ssr_sunshangxiang_ab": "孙尚香",
                    "ssr_simayi_ab": "司马懿",
                    "ssr_yiji_ab": "伊籍",
                    "ssr_huangyueying_ab": "黄月英",
                    "ssr_jiaxu_ab": "贾诩",
                    "ssr_caiwenji_ab": "蔡文姬",
                    "ssr_menghuo_ab": "孟获",
                    "ssr_zhurong_ab": "祝融",
                    "ssr_jiangwei_ab": "姜维",
                    "ssr_sunce_ab": "孙策",
                    "ssr_taishici_ab": "太史慈",
                    "ssr_zhoutai_ab": "周泰",
                    "ssr_xiahouyuan_ab": "夏侯渊",
                    "ssr_caoren_ab": "曹仁",
                    "ssr_dengai_ab": "邓艾",
                    "ssr_dongzhuo_ab": "董卓",
                    "ssr_yuji_ab": "于吉",
                    "ssr_yuanshao_ab": "袁绍",
                    "ssr_xushu_ab": "徐庶",
                    "ssr_fazheng_ab": "法正",
                    "ssr_pangtong_ab": "庞统",
                    "ssr_zhanghe_ab": "张郃",
                    "ssr_re_lidian_ab": "李典",
                    "ssr_xuhuang_ab": "徐晃",
                    "ssr_sunjian_ab": "孙坚",
                    "ssr_lusu_ab": "鲁肃",
                    "ssr_zhangzhang_ab": "张昭张纮",
                    "ssr_zhangjiao_ab": "张角",
                    "ssr_zhangbao_ab": "张宝",
                    "ssr_zhangliang_ab": "张梁",
                },
                characterIntro: {
                    "ssr_yiji": "伊籍，字机伯，生卒年不详，兖州山阳郡（今山东金乡县）人，三国时期蜀汉官员。年少时依附于同乡刘表。刘备落难到荆州时，伊籍时常拜访，托请刘备照顾。建安十三年（208年），刘表病死，伊籍便转投刘备，一起渡江南下。建安十六年（211年），刘备入蜀帮助刘璋，伊籍亦有跟随。随后刘备和刘璋双方决裂。建安十九年（214年），刘备平定益州，任命伊籍为左将军从事中郎，其待遇次于简雍、孙乾等。后升任昭文将军，并与诸葛亮、法正、刘巴、李严共同编制《蜀科》。",
                },
            },
            card: {
                card: {

},
                translate: {

},
                list: [],
            },
            skill: {
                skill: {
                    hpunshow: {
                        charlotte: true,
                    },
                    thunderunshow: {
                        charlotte: true,
                    },
                    huoshanunshow: {
                        charlotte: true,
                    },
                    hongshuiunshow: {
                        charlotte: true,
                    },
                    fuleiunshow: {
                        charlotte: true,
                    },
                    norecover: {
                        charlotte: true,
                        silent: true,
                        trigger: {
                            player: "recoverBegin",
                        },
                        forced: true,
                        content: function() {
                            trigger.cancel();
                        },
                        popup: false,
                    },
                    jingcheng: {
                        subSkill: {
                            link: {
                                trigger: {
                                    player: "linkBegin",
                                },
                                priority: 209,
                                forced: true,
                                filter: function(event, player) {
                                    return ! player.isLinked();
                                },
                                content: function() {
                                    game.log(player, '取消了横置');
                                    trigger.cancel();
                                },
                                ai: {
                                    effect: {
                                        target: function(card) {
                                            if (card.name == 'tiesuo') return 'zeroplayertarget';
                                        },
                                    },
                                },
                                sub: true,
                            },
                            gain: {
                                trigger: {
                                    player: ["gainBefore", "equipBefore"],
                                },
                                priority: 209,
                                forced: true,
                                filter: function(event, player) {
                                    return event.cards && event.cards.length > 0;
                                },
                                mod: {
                                    targetEnabled: function(card, player, target, now) {
                                        var oklist = ['shandian', 'huoshan', 'hongshui', 'fulei'];
                                        if (get.type(card) == 'delay' && !oklist.contains(card.name)) return false;
                                    },
                                },
                                content: function() {
                                    "step 0";
                                    trigger.cancel();
                                    "step 1";
                                    var card = trigger.cards;
                                    if (player.countCards('he')) {
                                        card = card.concat(player.getCards('he'));
                                    }
                                    if (player.countCards('he')) {
                                        card = card.concat(player.getCards('he'));
                                    }
                                    for (var i = 0; i < card.length; i++) {
                                        card[i].fix();
                                        card[i].remove();
                                        card[i].destroyed = true;
                                    }
                                    game.log(card, '被销毁了');
                                },
                                ai: {
                                    effect: {
                                        target: function(card, player, target) {
                                            if (get.type(card) == 'delay') return 0;
                                        },
                                    },
                                },
                                sub: true,
                            },
                            turnover: {
                                trigger: {
                                    player: "turnOverBefore",
                                },
                                priority: 209,
                                forced: true,
                                filter: function(event, player) {
                                    return ! player.isTurnedOver();
                                },
                                content: function() {
                                    trigger.cancel();
                                    game.log(player, '取消了翻面');
                                },
                                ai: {
                                    noturn: true,
                                },
                                sub: true,
                            },
                            recover: {
                                trigger: {
                                    player: "recoverBegin",
                                },
                                priority: 209,
                                forced: true,
                                content: function() {
                                    trigger.cancel();
                                    game.log(player, '无法回复体力');
                                },
                                sub: true,
                            },
                            resshan: {
                                trigger: {
                                    player: ["chooseToRespondBefore", "chooseToUseBefore"],
                                },
                                direct: true,
                                silent: true,
                                filter: function(event, player) {
                                    if (event.responded) return false;
                                    if (player.storage.resshaning) return false;
                                    if (!event.filterCard({
                                        name: 'shan'
                                    },
                                    player, event)) return false;
                                    return game.hasPlayer(function(current) {
                                        return current != player && current.identity != 'fan';
                                    });
                                },
                                content: function() {
                                    "step 0";
                                    if (!player.isAsked) {
                                        player.isAsked = true;
                                        player.say('京城失守，速来救驾！');
                                        setTimeout(function() {
                                            if (player) player.isAsked = false;
                                        },
                                        2000);
                                    }
                                    if (event.current == undefined) event.current = player.next;
                                    if (event.current == player) {
                                        {
                                            if (event && event.finish) {
                                                event.finish();
                                            } else {
                                                return;
                                            }
                                        }
                                    } else if (event.current.identity != 'fan') {
                                        if ((event.current == game.me && !_status.auto) || (get.attitude(event.current, player) > 2) || event.current.isOnline()) {
                                            player.storage.resshaning = true;
                                            var next = event.current.chooseToRespond('是否替' + get.translation(player) + '打出一张闪？', {
                                                name: 'shan'
                                            });
                                            next.set('ai',
                                            function() {
                                                var event = _status.event;
                                                return (get.attitude(event.player, event.source) - 2);
                                            });
                                            next.set('skillwarn', '替' + get.translation(player) + '打出一张闪');
                                            next.autochoose = lib.filter.autoRespondShan;
                                            next.set('source', player);
                                        }
                                    }
                                    "step 1";
                                    player.storage.resshaning = false;
                                    if (result.bool) {
                                        {
                                            if (event && event.finish) {
                                                event.finish();
                                            } else {
                                                return;
                                            }
                                        }
                                        trigger.result = {
                                            bool: true,
                                            card: {
                                                name: 'shan',
                                                isCard: true
                                            }
                                        };
                                        trigger.responded = true;
                                        trigger.animate = false;
                                        if (typeof event.current.ai.shown == 'number' && event.current.ai.shown < 0.95) {
                                            event.current.ai.shown += 0.3;
                                            if (event.current.ai.shown > 0.95) event.current.ai.shown = 0.95;
                                        }
                                    } else {
                                        event.current = event.current.next;
                                        event.goto(0);
                                    }
                                },
                                ai: {
                                    respondShan: true,
                                    skillTagFilter: function(player) {
                                        if (player.storage.resshaning) return false;
                                        return game.hasPlayer(function(current) {
                                            return current != player && current.identity != 'fan';
                                        });
                                    },
                                    effect: {
                                        target: function(card, player, target, current) {
                                            if (card.name == 'sha') {
                                                return [1, -4];
                                            } else if (get.tag(card, 'damage')) {
                                                return [1, -2];
                                            }
                                        },
                                    },
                                },
                                sub: true,
                            },
                            from: {
                                mod: {
                                    globalFrom: function(from, to) {
                                        if (to.hasSkill("jingcheng")) return - Infinity;
                                    },
                                },
                            },
                            shanplus: {
                                trigger: {
                                    target: "shaBegin",
                                },
                                silent: true,
                                priority: -1,
                                forced: true,
                                filter: function(event, player) {
                                    if (event.directHit) return false;
                                    return true;
                                },
                                content: function() {
                                    if (typeof trigger.shanRequired == 'number') {
                                        trigger.shanRequired++;
                                    } else {
                                        trigger.shanRequired = 2;
                                    }
                                },
                                sub: true,
                            },
                            damage: {
                                silent: true,
                                forced: true,
                                trigger: {
                                    player: "damageBegin4",
                                },
                                priority: -999,
                                content: function() {
                                    trigger.cancel();
                                    if (!player.hasSkill('guanfu')) {
                                        if (trigger.card && trigger.card.name == 'sha') {
                                            var dam = trigger.num * 2;
                                        } else {
                                            var dam = trigger.num;
                                        }
                                        player.hp -= dam;
                                        player.$damage();
                                        if (window.zuanDamageAudio) game.playAudio('..', 'extension', '祖安武将', 'audio', 'jingcheng.mp3');
                                        player.$damagepop( - dam, 'soil');
                                    }
                                    player.update();
                                    if (player.hp < 1) player.die();
                                },
                                sub: true,
                            },
                            round: {
                                silent: true,
                                forced: true,
                                trigger: {
                                    player: "phaseBefore",
                                },
                                priority: 678,
                                content: function() {
                                    'step 0';
                                    trigger.cancel();
                                    player.phaseJudge();
                                    if (parseFloat(lib.config['extension_祖安设置_mode']) != '2') {
                                        if (event && event.finish) {
                                            event.finish();
                                        } else {
                                            return;
                                        }
                                    }
                                    'step 1';
                                    /*if(player.storage.zhongnum) {
		                                event.dam=player.storage.zhongnum;
		                            }else {
		                                event.dam=1;
		                            }*/
                                    if (lib.config['extension_祖安设置_balance']) {
                                        event.dam = game.countPlayer(function(current) {
                                            var idelist = ['zhong', 'mingzhong'];
                                            return idelist.contains(current.identity);
                                        });
                                    } else {
                                        event.dam = 1;
                                    }
                                    'step 2';
                                    if (event.dam < 1) {
                                        if (event && event.finish) {
                                            event.finish();
                                        } else {
                                            return;
                                        }
                                    }
                                    'step 3';
                                    event.dam--;
                                    event.players = [];
                                    for (var i = 0; i < game.players.length; i++) {
                                        if (game.players[i] != player && game.players[i].identity == 'fan') {
                                            event.players.push(game.players[i]);
                                        }
                                    }
                                    'step 4';
                                    event.him = event.players.randomGet();
                                    event.him.chooseToRespond({
                                        name: 'shan'
                                    },
                                    '请打出一张【闪】，否则受到来自京城的一点伤害').set('check',
                                    function(card) {
                                        return 9 - get.value(card);
                                    });
                                    'step 5';
                                    if (!result.bool) event.him.damage();
                                    'step 6';
                                    event.goto(2);
                                },
                                sub: true,
                            },
                        },
                        charlotte: true,
                        silent: true,
                        locked: true,
                        priority: 30,
                        charlotte: true,
                        global: ["jingcheng_from"],
                        group: ["jingcheng_link", "jingcheng_gain", "jingcheng_turnover", "jingcheng_recover", "jingcheng_round", "jingcheng_damage", "jingcheng_shanplus", "jingcheng_resshan"],
                        trigger: {
                            //player:["phaseBegin"],
                            global: 'roundStart',
                        },
                        forced: true,
                        filter: function(event, player) {
                            if (player.identity != 'zhu') return false;
                            return parseFloat(lib.config['extension_祖安设置_relife']) != '0';
                        },
                        content: function() {
                            var dd = player;
                            var dds = dd.storage.relife;
                            dd.storage.relife--;
                            if (!dd.storage.relife || dd.storage.relife < 1) {
                                if (parseFloat(lib.config['extension_祖安设置_audio']) >= '2') game.playAudio('..', 'extension', '祖安武将', 'audio', 'revive.ogg');
                                event.dead = dd;
                                player.storage.tahp = player.hp;
                                player.maxHp = player.storage.zhumaxhp;
                                player.hp = player.maxHp;
                                player.removeSkill('jingcheng');
                                dd.draw(Math.ceil(dd.storage._levelskill * 0.5));
                                dd.markSkill('_expskill');
                                dd.syncStorage('_expskill');
                                dd.markSkill('_levelskill');
                                dd.syncStorage('_levelskill');
                                player.identity = 'zhu';
                                player.setIdentity('主');
                                player.node.identity.dataset.color = 'zhu';
                                player.identityShown = true;
                                player.storage.zuan_identity = ['主', 'zhu'];
                                player.enableSkill('lockskill');
                                if (dd.hasSkill('zuan_hudun')) {
                                    dd.storage.zuan_hudun = dd.storage.zuan_maxhujia;
                                    dd.seeMark('zuan_hudun');
                                    //dd.markSkill('zuan_hudun');
                                    //dd.syncStorage('zuan_hudun');   
                                }
                                if (player.storage.jingchengimgshow) {
                                    player.storage.jingchengimgshow = false;
                                    game.broadcastAll(function(player) {
                                        player.storage.jingcheng_img.style.opacity = 0; //'translateY(-200px)'
                                        player.storage.jingcheng_img.delete();
                                    },
                                    player);
                                }
                                dd.update();
                                if (player.hasSkill('notarget')) player.removeSkill('notarget');
                                if (parseFloat(lib.config['extension_祖安设置_relife']) != '0') {
                                    player.storage.relife = Math.ceil(player.storage._levelskil * 0.4 + 0.1);
                                } else {
                                    player.storage.relife = 4;
                                }
                                dd.$damagepop('重生');
                                game.log(dd, '<span class=\"zuantext\" style=\"color: #7CFC00\">获得了重生</span>');
                            } else {
                                dd.$damagepop(get.cnNumber(dd.storage.relife) + '回合');
                                game.log(dd, '复活还剩<span class=\"zuantext\" style=\"color: #228B22\">', get.cnNumber(dd.storage.relife), '回合</span>');
                            }
                        },
                        ai: {
                            threaten: 3.5,
                        },
                        popup: false,
                    },
                    qunxiongkill: {
                        charlotte: true,
                        trigger: {
                            global: ["phaseBefore", "useCard", "drawBefore", "phaseEnd"],
                        },
                        silent: true,
                        forced: true,
                        unique: true,
                        priority: 100,
                        content: function() {
                            "step 0";
                            if (lib.config.mode == 'guozhan' && get.config('guozhan_mode') != 'mingjiang') {
                                for (var i = 0; i < game.players.length; i++) {
                                    game.players[i].showCharacter(2);
                                }
                            } else {
                                event.goto(1);
                            }
                            "step 1";
                            if (player.maxHp > 1) {
                                player.loseMaxHp();
                            }
                            var names = [];
                            var players = game.players.concat(game.dead);
                            for (var i = 0; i < players.length; i++) {
                                if (players[i] == player) continue;
                                if (players[i].name && !players[i].classList.contains('unseen')) names.add(players[i].name);
                                if (players[i].name1 && !players[i].classList.contains('unseen')) names.add(players[i].name1);
                                if (players[i].name2 && !players[i].classList.contains('unseen2')) names.add(players[i].name2);
                            }
                            ui.clear();
                            game.zhu = player;
                            player.identity = 'zhu';
                            player.setIdentity('霸');
                            player.node.identity.dataset.color = 'zhong';
                            player.identityShown = true;
                            player.storage.zuan_identity = ['霸', 'zhong'];
                            var players = get.players(false, true);
                            for (var i = 0; i < players.length; i++) {
                                if (players[i] != player) {
                                    players[i].identity = 'fan';
                                    players[i].setIdentity('群');
                                    players[i].node.identity.dataset.color = 'nei';
                                    players[i].identityShown = true;
                                }
                            }
                            for (var i = 0; i < game.players.length; i++) {
                                if (game.players[i] == player) continue;
                                if (game.players[i].name) {
                                    game.players[i].disabledSkills.zhushen0 = lib.character[game.players[i].name][3];
                                }
                                if (game.players[i].name1) {
                                    game.players[i].disabledSkills.zhushen1 = lib.character[game.players[i].name1][3];
                                }
                                if (game.players[i].name2) {
                                    game.players[i].disabledSkills.zhushen2 = lib.character[game.players[i].name2][3];
                                }
                            }
                            player.removeSkill('qunxiongkill');
                            player.addSkill('bakill');
                        },
                    },
                    bakill: {
                        subSkill: {
                            show: {
                                trigger: {
                                    global: ['usecardAfter', 'phaseBegin', 'gainAfter', 'changeHpAfter', 'loseAfter'],
                                },
                                priority: 98,
                                silent: true,
                                forced: true,
                                content: function() {
                                    player.identity = 'zhu';
                                    player.setIdentity('霸');
                                    player.node.identity.dataset.color = 'zhong';
                                    player.identityShown = true;
                                    var players = get.players(false, true);
                                    for (var i = 0; i < players.length; i++) {
                                        if (players[i] != player) {
                                            players[i].identity = 'fan';
                                            players[i].setIdentity('群');
                                            players[i].node.identity.dataset.color = 'nei';
                                            players[i].identityShown = true;
                                        }
                                    }
                                },
                                sub: true,
                            },
                            mode: {
                                mod: {
                                    globalFrom: function(from, to) {
                                        if (lib.config['extension_祖安设置_balance']) return - Infinity;
                                    },
                                    cardSavable: function(card, player) {
                                        if (!lib.config['extension_祖安设置_balance']) return;
                                        if (!_status.currentPhase) return;
                                        if (_status.currentPhase.isAlive() && _status.currentPhase.hasSkill('bakill') && _status.currentPhase != player) {
                                            if (card.name == 'tao' && !player.isDying()) return false;
                                        }
                                    },
                                    cardEnabled: function(card, player) {
                                        if (!lib.config['extension_祖安设置_balance']) return;
                                        if (!_status.currentPhase) return;
                                        if (_status.currentPhase.isAlive() && _status.currentPhase.hasSkill('bakill') && _status.currentPhase != player) {
                                            if (card.name == 'tao' && !player.isDying()) return false;
                                        }
                                    },
                                },
                                sub: true,
                            },
                        },
                        charlotte: true,
                        skillAnimation: "epic",
                        global: ["bakill_mode"],
                        group: ["batime", "qunxiongdraw", "qunxiongdis", "qunxiongsha", "bakill_show"],
                        trigger: {
                            player: "dieBegin",
                        },
                        silent: true,
                        logTarget: "source",
                        forced: true,
                        unique: true,
                        priority: 100,
                        filter: function(event) {
                            return true;
                        },
                        content: function() {
                            "step 0";
                            if (trigger.source && trigger.source.isIn()) {
                                var die = 1;
                            } else {
                                var die = 0;
                            }
                            if (die == 1) {
                                if (lib.config.mode == 'guozhan' && get.config('guozhan_mode') != 'mingjiang') {
                                    for (var i = 0; i < game.players.length; i++) {
                                        game.players[i].showCharacter(2);
                                    }
                                } else {
                                    event.goto(1);
                                }
                            } else {
                                trigger.cancel();
                                player.hp = 1;
                                player.update(); {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            "step 1";
                            if (game.dead.length) {
                                for (var i = 0; i < game.dead.length; i++) {
                                    var dd = game.dead[i];
                                    var dds = dd.storage.relife;
                                    dd.storage.relife--;
                                    if (!dd.storage.relife || dd.storage.relife < 1) {
                                        if (parseFloat(lib.config['extension_祖安设置_audio']) >= '2') game.playAudio('..', 'extension', '祖安武将', 'audio', 'revive.ogg');
                                        dd.revive(dd.maxHp);
                                        game.addVideo('revive', dd);
                                        event.dead = dd;
                                        dd.draw(Math.ceil(dd.storage._levelskill * 0.5));
                                        dd.storage.relife = Math.ceil(dd.storage._levelskill * 0.4 + 0.1);
                                        dd.markSkill('_expskill');
                                        dd.syncStorage('_expskill');
                                        dd.markSkill('_levelskill');
                                        dd.syncStorage('_levelskill');
                                        if (dd.hasSkill('zuan_hudun')) {
                                            dd.storage.zuan_hudun = dd.storage.zuan_maxhujia;
                                            dd.seeMark('zuan_hudun');
                                            //dd.markSkill('zuan_hudun');
                                            //dd.syncStorage('zuan_hudun');
                                        }
                                        dd.update();
                                        dd.$damagepop('重生');
                                        game.log(dd, '<span class=\"zuantext\" style=\"color: #7CFC00\">获得了重生</span>');
                                    } else {
                                        dd.$damagepop(get.cnNumber(dd.storage.relife) + '回合');
                                        game.log(dd, '复活还剩<span class=\"zuantext\" style=\"color: #228B22\">', get.cnNumber(dd.storage.relife), '回合</span>');
                                    }
                                }
                            }
                            ui.clear();
                            game.zhu = trigger.source;
                            trigger.source.identity = 'zhu';
                            trigger.source.setIdentity('霸');
                            trigger.source.node.identity.dataset.color = 'zhong';
                            trigger.source.identityShown = true;
                            player.identity = 'fan';
                            player.setIdentity('群');
                            player.node.identity.dataset.color = 'nei';
                            player.identityShown = true;
                            player.storage.zuan_identity = ['群', 'nei'];
                            trigger.source.draw(3);
                            trigger.source.addSkill('bakill');
                            player.removeSkill('bakill');
                            for (var i = 0; i < game.players.length; i++) {
                                if (game.players[i] != player && !game.players[i].hasSkill('bakill')) {
                                    game.players[i].loseHp();
                                }
                            }
                        },
                    },
                    batime: {
                        charlotte: true,
                        trigger: {
                            //player:["phaseBegin","turnOverAfter"],
                            global: 'roundStart',
                        },
                        silent: true,
                        forced: true,
                        mark: true,
                        //marktext:"胜",
                        marktext: "<img style=width:15px src=" + lib.assetURL + "extension/祖安武将/basic/mode_zhengba.png>",
                        check: function(event, player) {
                            //if(player.isTurnedOver()) return false;
                            return true;
                        },
                        init: function(player) {
                            player.storage.batime = 5;
                            player.markSkill('batime');
                            player.syncStorage('batime');
                        },
                        content: function() {
                            if (!lib.config['extension_祖安设置_balance']) {
                                player.draw(2);
                            }
                            player.storage.batime -= 1;
                            player.markSkill('batime');
                            player.syncStorage('batime');
                            if (player.storage.batime <= 0) {
                                if (lib.config['extension_祖安设置_newover']) {
                                    if (game.me == player) {
                                        game.over(true);
                                    } else {
                                        game.over(false);
                                    }
                                } else {
                                    for (var i = 0; i < game.players.length; i++) {
                                        if (game.players[i] != player) {
                                            game.players[i].die();
                                        }
                                    }
                                }
                            }
                        },
                        mod: {
                            maxHandcard: function(player, num) {
                                if (!lib.config['extension_祖安设置_balance']) return num + 2;
                            },
                        },
                        intro: {
                            content: function(storage, player, skill) {
                                if (lib.config['extension_祖安设置_balance']) {
                                    var str = '<br>你离胜利只剩' + player.storage.batime + '轮<li>Buff：霸主的回合内，所有其他角色非濒死不能使用【桃】；其他角色的摸牌阶段摸牌时，你摸等量的牌；弃牌阶段弃牌时，你随机弃等量的手牌；你杀死其他角色后，你的胜利推进一回合；你死亡后，所有霸主以外的角色流失一点体力，所有群雄复活时间推进一个回合';
                                } else {
                                    var str = '<br>你离胜利只剩' + player.storage.batime + '轮<li>Buff：霸主的回合内，所有其他角色非濒死不能使用【桃】；每回合开始你摸2张牌，你的手牌上限+2；你死亡后，所有霸主以外的角色流失一点体力，所有群雄复活时间推进一个回合';
                                }
                                return str;
                            },
                        },
                        ai: {
                            threaten: 5,
                        },
                    },
                    guanfu: {
                        subSkill: {
                            disrecover: {
                                silent: true,
                                trigger: {
                                    player: "recoverBegin",
                                },
                                forced: true,
                                filter: function(event, player) {
                                    return player.hp > 0 || lib.config['extension_祖安设置_balance'];
                                },
                                marktext: "桃",
                                intro: {
                                    name: "桃之夭夭",
                                    content: "cards",
                                    onunmark: function(storage, player) {
                                        if (storage && storage.length) {
                                            player.$throw(storage);
                                            game.cardsDiscard(storage);
                                            delete player.storage.guanfu_disrecover;
                                        }
                                    },
                                },
                                content: function() {
                                    'step 0';
                                    event.num = trigger.num;
                                    if (lib.config['extension_祖安设置_balance']) event.goto(2);
                                    'step 1';
                                    trigger.cancel();
                                    player.draw(trigger.num); {
                                        if (event && event.finish) {
                                            event.finish();
                                        } else {
                                            return;
                                        }
                                    }
                                    'step 2';
                                    if (event.num < 1 || player.hp + event.num <= 1) {
                                        if (event && event.finish) {
                                            event.finish();
                                        } else {
                                            return;
                                        }
                                    }
                                    'step 3';
                                    event.num--;
                                    if (player.storage.guanfu_disrecover == undefined) player.storage.guanfu_disrecover = [];
                                    var suitlist = [];
                                    for (var i = 0; i < player.storage.guanfu_disrecover.length; i++) {
                                        suitlist.push(get.suit(player.storage.guanfu_disrecover[i]));
                                    }
                                    player.judge(function(card) {
                                        if (get.suit(card) == 'heart') return 2;
                                        if (suitlist.contains(get.suit(card))) return 2;
                                        return - 0.5;
                                    }).judge2 = function(result) {
                                        return result.bool;
                                    };
                                    'step 4';
                                    if (!result.bool) {
                                        trigger.num--;
                                        player.storage.guanfu_disrecover.push(result.card);
                                        player.markSkill('guanfu_disrecover');
                                    } else if (player.storage.guanfu_disrecover.length > 0) {
                                        player.$throw(player.storage.guanfu_disrecover);
                                        game.cardsDiscard(player.storage.guanfu_disrecover);
                                        player.unmarkSkill('guanfu_disrecover');
                                        player.storage.guanfu_disrecover = [];
                                    }
                                    event.goto(2);
                                },
                                popup: false,
                                sub: true,
                            },
                            fandie: {
                                trigger: {
                                    global: "die",
                                },
                                forced: true,
                                silent: true,
                                filter: function(event, player) {
                                    return event.source && event.source.isIn() && event.player.identity == 'fan';
                                },
                                priority: 65,
                                content: function() {
                                    trigger.source = undefined;
                                },
                                sub: true,
                            },
                            fanrevive: {
                                trigger: {
                                    global: "dieBefore",
                                },
                                forced: true,
                                silent: true,
                                filter: function(event, player) {
                                    return game.countPlayer(function(current) {
                                        return current.identity == 'fan';
                                    }) <= 1 && event.player.identity == 'fan' && lib.config['extension_祖安设置_balance'] && player.storage.zuan_guanbing < 10;
                                },
                                priority: 65,
                                content: function() {
                                    var fanlist = [];
                                    for (var i = 0; i < game.dead.length; i++) {
                                        if (game.dead[i].identity == 'fan') {
                                            fanlist.push(game.dead[i]);
                                        }
                                    }
                                    game.expRevive(fanlist.randomGet());
                                },
                                sub: true,
                            },
                        },
                        charlotte: true,
                        silent: true,
                        marktext: "<img style=width:15px src=" + lib.assetURL + "extension/祖安武将/basic/mode_guanfu.png>",
                        //marktext:"御",
                        charlotte: true,
                        global: ['guanfu_disrecover'],
                        group: ["hellfire", "zuan_guanbing", "guanfu_fandie", "guanfu_fanrevive", "zuan_panjun", "firedam", "firedam2", "firedam3"],
                        trigger: {
                            global: "die",
                        },
                        forced: true,
                        mark: true,
                        init: function(player) {
                            player.storage.zuan_guanbing = 0;
                            player.markSkill('zuan_guanbing');
                            player.syncStorage('zuan_guanbing');
                            player.storage.zuan_panjun = 0;
                            player.markSkill('zuan_panjun');
                            player.syncStorage('zuan_panjun');
                        },
                        content: function() {
                            var tex = lib.config['extension_祖安设置_texiao'];
                            if (tex) {
                                game.newalive('extension/祖安武将/mode/mode_hellfire.gif', 1.5, lib.config.zuancoveropacity);
                                game.delay(2);
                                /*if((parseFloat(lib.config['extension_祖安设置_wallpaper'])!='1'||(lib.config['extension_祖安设置_exwallpaper']&&lib.config.zuanexwallpaper=='on'))&&parseFloat(lib.config['extension_祖安设置_isPC'])!='0') {
						            setTimeout(function () {
			                            game.broadcastAll()+ui.background.setBackgroundImage(lib.config.zuanbackground);
								    // ---------------------------------------动态壁纸刷新
						            }, 3000);
						        }*/
                            }
                            if (lib.config.mode != 'guozhan') {
                                if (trigger.player.identity == 'fan') {
                                    player.addMark('zuan_guanbing', false);
                                }
                                var idelist = ['zhong', 'mingzhong'];
                                if (idelist.contains(trigger.player.identity)) {
                                    player.addMark('zuan_panjun', false);
                                }
                            }
                            if (lib.config['extension_祖安设置_newover']) {
                                if (player.storage.zuan_guanbing >= 10) {
                                    //内奸获胜的条件是结束游戏时还活着
                                    if (game.me.identity == 'nei') {
                                        if (game.me.isAlive()) {
                                            game.over(true);
                                        } else {
                                            game.over(false);
                                        }
                                    } else if (player.isFriendsOf(game.me)) {
                                        game.over(false);
                                    } else {
                                        game.over(true);
                                    }
                                } else if (player.storage.zuan_panjun >= 10) {
                                    //内奸获胜的条件是结束游戏时还活着
                                    if (game.me.identity == 'nei') {
                                        if (game.me.isAlive()) {
                                            game.over(true);
                                        } else {
                                            game.over(false);
                                        }
                                    } else if (player.isFriendsOf(game.me)) {
                                        game.over(true);
                                    } else {
                                        game.over(false);
                                    }
                                }
                            } else {
                                if (player.storage.zuan_guanbing >= 10) {
                                    for (var i = 0; i < game.players.length; i++) {
                                        if (!game.players[i].isFriendsOf(player)) {
                                            //if(game.players[i].identity=='fan'||game.players[i].identity=='nei'){
                                            game.players[i].die();
                                        }
                                    }
                                } else if (player.storage.zuan_panjun >= 10) {
                                    player.die();
                                }
                            }
                        },
                        intro: {
                            content: function(storage, player, skill) {
                                var red = 10 - player.storage.zuan_panjun;
                                var blue = 10 - player.storage.zuan_guanbing;
                                var str = '<br>官府代表主公阵容，叛军代表反贼阵容<br>受到火焰伤害的角色弃一张牌<br>双方角色阵亡都会增加对方势力数，先到达10个势力的一方获胜<br>死亡后的主公无法被攻击<li>官府剩余目标：' + blue + '<li>叛军剩余目标：' + red;
                                return str;       
                            },
                        },
                        popup: false,
                    },
                    hellfire: {
                        silent: true,
                        trigger: {
                            player: ["damageEnd", "loseHpEnd"],
                        },
                        filter: function(event, player) {
                            return player.hasSkill('jingcheng');
                        },
                        forced: true,
                        frequent: true,
                        content: function() {
                            dam = trigger.num;
                            var fum = game.players.length;
                            var ram = 1 / fum;
                            var z = 1;
                            for (var a = 0; dam >= 1; a++) {
                                for (var i = 0; i < game.players.length; i++) {
                                    if (dam > 0) {
                                        var idelist = ['zhong', 'mingzhong'];
                                        if (idelist.contains(game.players[i].identity)) {
                                            var z = 0;
                                            if (Math.random() <= ram) {
                                                game.players[i].damage();

                                                var dam = dam - 1;
                                            }
                                        }
                                    }
                                    if (z != 0) {
                                        var dam = 0;
                                    }
                                }
                            }
                        },
                        intro: {
                            content: "mark",
                        },
                        popup: false,
                    },
                    "zuan_guanbing": {
                        charlotte: true,
                        forced: true,
                        mark: true,
                        marktext: "官",
                        intro: {
                            name: "官兵势力",
                            content: "mark",
                        },
                    },
                    "zuan_panjun": {
                        charlotte: true,
                        forced: true,
                        mark: true,
                        marktext: "叛",
                        intro: {
                            name: "叛军势力",
                            content: "mark",
                        },
                    },
                    firedam: {
                        silent: true,
                        trigger: {
                            global: "phaseBegin",
                        },
                        filter: function(event, player) {
                            if (lib.config['extension_祖安设置_balance']) return false;
                            return true;
                        },
                        forced: true,
                        content: function() {
                            'step 0';
                            var target = trigger.player;
                            target.judge(function(card) {
                                if (get.suit(card) == 'heart') return - 2;
                                return 0;
                            });
                            'step 1';
                            if (result.color) {
                                if (result.suit == 'heart') {
                                    trigger.player.damage('fire');
                                }
                            }
                        },
                        popup: false,
                    },
                    "firedam2": {
                        silent: true,
                        trigger: {
                            global: "damageEnd",
                        },
                        filter: function(event, player) {
                            return event.nature == 'fire' && event.player.countCards('he') > 0;
                        },
                        forced: true,
                        content: function() {
                            "step 0";
                            if (lib.config['extension_祖安设置_balance']) {
                                var cards = trigger.player.getCards('he');
                                trigger.player.discard(cards.randomGet());
                            } else {
                                trigger.player.chooseToDiscard('he', true);
                            }
                        },
                        popup: false,
                    },
                    turnoverfalse: {
                        silent: true,
                        trigger: {
                            player: "turnOverBefore",
                        },
                        priority: 20,
                        forced: true,
                        filter: function(event, player) {
                            return ! player.isTurnedOver();
                        },
                        content: function() {
                            trigger.cancel();
                            game.log(player, '取消了翻面');
                        },
                        ai: {
                            noturn: true,
                        },
                        popup: false,
                    },
                    notarget: {
                        silent: true,
                        charlotte: true,
                        trigger: {
                            player: ["damageBegin3", "loseHpBefore", "recoverBefore"],
                        },
                        forced: true,
                        popup: false,
                        content: function() {
                            trigger.cancel();
                        },
                        mod: {
                            cardEnabled: function() {
                                return false;
                            },
                            cardSavable: function() {
                                return false;
                            },
                            targetEnabled: function() {
                                return false;
                            },
                        },
                    },
                    "guifu_fire": {
                        group: "guifu_dam",
                        charlotte: true,
                        silent: true,
                        marktext: "鬼",
                        forced: true,
                        trigger: {
                            player: "phaseDrawBegin2",
                        },
                        filter: function(event) {
                            return true;
                        },
                        content: function() {
                            trigger.num++;
                            player.removeMark('guifu_fire');
                            if (player.countMark('guifu_fire') < 1) {
                                player.removeSkill('guifu_fire');
                            }
                        },
                        intro: {
                            content: function(storage, player, skill) {
                                var str = '鬼符效果：摸牌阶段额外摸一张牌<li>限定技：对一名角色造成一点火焰伤害<li>持续时间：还剩' + player.storage.guifu_fire + '回合';
                                return str;
                            },
                        },
                    },
                    "guifu_dam": {
                        intro: {
                            name: "鬼符",
                            content: "mark",
                        },
                        marktext: "限",
                        usable: 1,
                        enable: "phaseUse",
                        filter: function(event, player) {
                            return player.countMark('guifu_dam') >= 1;
                        },
                        filterTarget: function(card, player, target) {
                            return target != player && !target.hasSkill('jingcheng');
                        },
                        content: function() {
                            var tex = lib.config['extension_祖安设置_texiao'];
                            if (tex) {
                                game.newalive('extension/祖安武将/mode/mode_guifu.gif', 1.5, lib.config.zuancoveropacity);
                                game.delay(2);
                                /*if((parseFloat(lib.config['extension_祖安设置_wallpaper'])!='1'||(lib.config['extension_祖安设置_exwallpaper']&&lib.config.zuanexwallpaper=='on'))&&parseFloat(lib.config['extension_祖安设置_isPC'])!='0') {
						            setTimeout(function () {
						                game.broadcastAll()+ui.background.setBackgroundImage(lib.config.zuanbackground);
								    // ---------------------------------------动态壁纸刷新
						            }, 3000);
						        }*/
                            }
                            player.removeMark('guifu_dam');
                            target.damage('fire', 'nocard');
                        },
                        ai: {
                            threaten: 1.5,
                            result: {
                                target: function(player, target) {
                                    return - target.hp;
                                },
                            },
                            order: 10,
                            expose: 0.4,
                        },
                    },
                    "guifu_nei": {
                        charlotte: true,
                        trigger: {
                            player: "die",
                        },
                        /*mod:{
		                    cardSavable:function (card,player){
		                            if(card.name=='tao'&&!player.isDying()&&(lib.config['extension_祖安设置_balance'])) return false;
		                    },
		                    cardEnabled:function (card,player){
		                            if(card.name=='tao'&&!player.isDying()&&(lib.config['extension_祖安设置_balance'])) return false;
		                    },
		                },*/
                        silent: true,
                        forced: true,
                        forceDie: true,
                        skillAnimation: true,
                        animationColor: "fire",
                        filter: function(event) {
                            return event.source && event.source.isIn();
                        },
                        content: function() {
                            trigger.source.addTempSkill('guifu_fire', {
                                player: 'dying'
                            });
                            trigger.source.addMark('guifu_dam');
                            trigger.source.addMark('guifu_fire', 3);
                            if (game.hasPlayer(function(current) {
                                return current.identity == 'zhong';
                            })) {
                                var him = game.filterPlayer(function(current) {
                                    return current.identity == 'zhong';
                                }).randomGet();
                                game.broadcastAll(function(player, target, shown) {
                                    var identity = player.identity;
                                    player.identity = target.identity;
                                    if (shown || player == game.me) {
                                        player.setIdentity();
                                    }
                                    target.identity = identity;
                                },
                                player, him, him.identityShown);
                            }
                            if (lib.config['extension_祖安设置_balance']) trigger.source.changeHujia();
                        },
                        logTarget: "source",
                    },
                    "renxin_dam": {
                        charlotte: true,
                        group: ["renxin_add", "renxin_draw"],
                        mark: true,
                        frequent: true,
                        //marktext:"心",
                        marktext: "<img style=width:15px src=" + lib.assetURL + "extension/祖安武将/basic/mode_renxin.png>",
                        skillAnimation: true,
                        animationStr: "人心",
                        animationColor: "silver",
                        init: function(player) {
                            player.addMark('renxin_dam', 1);
                        },
                        sub: true,
                        intro: {
                            content: function(storage, player, skill) {
                                var str = '人心：可使用次数还剩' + get.cnNumber(player.storage.renxin_dam, true) + '次';
                                return str;
                            },
                        },
                        trigger: {
                            source: "damageBegin",
                        },
                        filter: function(event, player) {
                            if (event.num <= 0) return false;
                            return (event.player.identity == 'fan' && player.countMark('renxin_dam') >= 1);
                        },
                        content: function() {
                            var fan = 0;
                            for (var i = 0; i < game.players.length; i++) {
                                if (game.players[i].identity == 'fan') var fan = fan + 1;
                            }
                            var ram = fan / game.players.length;
                            if (fan <= 1) var ram = 0;
                            if (Math.random() <= ram) {
                                trigger.cancel();
                                trigger.player.identity = 'zhong';
                                trigger.player.setIdentity('汉');
                                trigger.player.node.identity.dataset.color = 'zhong';
                                trigger.player.identityShown = true;
                                trigger.player.storage.zuan_identity = ['汉', 'zhong'];
                                player.removeMark('renxin_dam');
                                player.say('欢迎将军来我麾下！');
                            } else {
                                player.say('哈哈，我相信，将军还会来找我的！');
                            }
                        },
                    },
                    "renxin_add": {
                        charlotte: true,
                        silent: true,
                        forced: true,
                        trigger: {
                            global: "die",
                        },
                        filter: function(event) {
                            return true;
                        },
                        content: function() {
                            "step 0";
                            if (!lib.config['extension_祖安设置_balance'] || trigger.player.identity == 'fan') {
                                player.addMark('renxin_dam');
                            }
                            player.recover();
                        },
                    },
                    "renxin_draw": {
                        trigger: {
                            player: "phaseDrawBegin2",
                        },
                        silent: true,
                        forced: true,
                        content: function() {
                            if (lib.config['extension_祖安设置_balance']) {
                                var num = 0;
                                for (var i = 0; i < game.players.length; i++) {
                                    if (game.players[i].identity == 'fan') num++;
                                }
                                trigger.num += num;
                            } else {
                                trigger.num += 2;
                            }
                        },
                        ai: {
                            threaten: 1.5,
                        },
                        mod: {
                            maxHandcard: function(player, num) {
                                if (lib.config['extension_祖安设置_balance']) {
                                    var num = 0;
                                    for (var i = 0; i < game.players.length; i++) {
                                        if (game.players[i].identity == 'fan') num++;
                                    }
                                    return player.maxHp + num;
                                } else {
                                    return player.maxHp + 2;
                                }
                            },
                        },
                    },
                    maxlevel: {
                        charlotte: true,
                        enable: "phaseUse",
                        usable: 2,
                        filter: function(event, player) {
                            return player.countCards('h') >= 2;
                        },
                        chooseButton: {
                            dialog: function(player) {
                                var list = [];
                                for (var i = 0; i < lib.inpile.length; i++) {
                                    if (get.type(lib.inpile[i]) == 'basic') list.push(['基本', '', lib.inpile[i]]);
                                }
                                return ui.create.dialog('号令群雄', [list, 'vcard']);
                            },
                            filter: function(button, player) {
                                return lib.filter.filterCard({
                                    name: button.link[2]
                                },
                                player, _status.event.getParent());
                            },
                            check: function(button) {
                                var player = _status.event.player;
                                var recover = 0,
                                lose = 1,
                                players = game.filterPlayer();
                                for (var i = 0; i < players.length; i++) {
                                    if (players[i].hp == 1 && get.damageEffect(players[i], player, player) > 0 && !players[i].hasSha()) {
                                        return (button.link[2] == 'sha') ? 2 : -1;
                                    }
                                    if (!players[i].isOut()) {
                                        if (players[i].hp < players[i].maxHp) {
                                            if (get.attitude(player, players[i]) > 0) {
                                                if (players[i].hp < 2) {
                                                    lose--;
                                                    recover += 0.5;
                                                }
                                                lose--;
                                                recover++;
                                            } else if (get.attitude(player, players[i]) < 0) {
                                                if (players[i].hp < 2) {
                                                    lose++;
                                                    recover -= 0.5;
                                                }
                                                lose++;
                                                recover--;
                                            }
                                        } else {
                                            if (get.attitude(player, players[i]) > 0) {
                                                lose--;
                                            } else if (get.attitude(player, players[i]) < 0) {
                                                lose++;
                                            }
                                        }
                                    }
                                }
                                if (lose > recover && lose > 0) return (button.link[2] == 'sha') ? 1 : -1;
                                if (lose < recover && recover > 0) return (button.link[2] == 'tao') ? 1 : -1;
                                return (button.link[2] == 'tao') ? 1 : -1;
                            },
                            backup: function(links, player) {
                                return {
                                    filterCard: true,
                                    selectCard: 2,
                                    audio: 2,
                                    popname: true,
                                    viewAs: {
                                        name: links[0][2]
                                    },
                                }
                            },
                            prompt: function(links, player) {
                                return '将两张手牌当作' + get.translation(links[0][2]) + '使用';
                            },
                        },
                        ai: {
                            order: 2,
                            result: {
                                player: function(player) {
                                    var num = 0;
                                    var cards = player.getCards('h');
                                    if (cards.length >= 3 && player.hp >= 3) return 0;
                                    for (var i = 0; i < cards.length; i++) {
                                        num += Math.max(0, get.value(cards[i], player, 'raw'));
                                    }
                                    num /= cards.length;
                                    num *= Math.min(cards.length, player.hp);
                                    return 12 - num;
                                },
                            },
                            threaten: 1.6,
                        },
                    },
                    levelcard: {
                        charlotte: true,
                        mod: {
                            maxHandcard: function(player, num, storage) {
                                var add = 0;
                                if (player.storage._levelskill >= 3) var add = add + 1;
                                if (player.storage._levelskill >= 6) var add = add + 1;
                                return num + add;
                            },
                            cardUsable: function(card, player, num, storage) {
                                if (player.storage._levelskill >= 5 && card.name == 'sha') return num + 1;
                            },
                        },
                    },
                    canghaizhu: {
                        charlotte: true,
                        marktext: "海",
                        mark: true,
                    },
                    huanhai: {
                        charlotte: true,
                        marktext: "幻",
                        marktext: "<img style=width:15px src=" + lib.assetURL + "extension/祖安武将/basic/mode_canghai.png>",
                        mark: true,
                        intro: {
                            content: "characters",
                        },
                        init: function(player) {
                            player.storage.huanhai = [];
                            // player.storage.huanhai2=0;
                        },
                    },
                    huanhaicls: {
                        charlotte: true,
                        firstDo: true,
                        trigger: {
                            global: ["phaseBefore"],
                            //global:["rountStart"],
                        },
                        //silent:true,
                        marktext: "镜",
                        mark: true,
                        priority: 99,
                        forced: true,
                        popup: false,
                        unique: true,
                        filter: function(event, player) {
                            if (event.player.identity != 'zhu') return false;
                            return true;
                        },
                        content: function() {
                            /*if(trigger.player.identity!='zhu'){
		                        var skills=player.getSkills(true,false);
		                        for(var i=0;i<skills.length;i++){
		                            var info=get.info(skills[i]);
		                            if(skills[i]=='huanhaicls'||info.charlotte){
		                                skills.splice(i--,1);
		                            }
		                        }
		                        player.disableSkill('huanhaicls',skills);
		                    }
		                    else {*/
                            player.enableSkill('huanhaicls');
                            player.removeSkill('huanhaicls');
                            //}
                        },
                        intro: {
                            content: function(storage, player, skill) {
                                var str = '<li>曲镜：所有技能已失效。';
                                var list = [];
                                for (var i in player.disabledSkills) {
                                    if (player.disabledSkills[i].contains(skill)) {
                                        list.push(i);
                                    }
                                }
                                if (list.length) {
                                    str += '<br><li>失效技能：';
                                    for (var i = 0; i < list.length; i++) {
                                        if (lib.translate[list[i] + '_info']) {
                                            str += get.translation(list[i]) + '、';
                                        }
                                    }
                                    return str.slice(0, str.length - 1);
                                } else return str;
                            },
                        },
                        onremove: function(player, skill) {
                            player.enableSkill(skill);
                        },
                        init: function(player, skill) {
                            var skills = player.getSkills(true, false);
                            for (var i = 0; i < skills.length; i++) {
                                var info = get.info(skills[i]);
                                if (skills[i] == 'huanhaicls' || info.charlotte) {
                                    skills.splice(i--, 1);
                                }
                            }
                            player.disableSkill(skill, skills);
                        },
                        locked: true,
                    },
                    qiyue: {
                        charlotte: true,
                        trigger: {
                            global: ["phaseBefore", "useCard", "drawBefore", "phaseEnd"],
                        },
                        direct: true,
                        forced: true,
                        /*init:function (player){
		                    player.addSkill('qichange');
		                    player.addSkill('qi');
		                },*/
                        content: function() {
                            'step 0';
                            //标包增强
                            if (lib.config['extension_祖安设置_ssr'] != 'none' || 1 == 1) {
                                lib.characterPackHun = {
                                    "mode_extension_祖安武将": lib.zuanPack
                                }
                            } else {
                                lib.characterPackHun = {
                                    "standard": lib.characterPack["standard"]
                                }
                            }
                            var list = [];
                            for (var a in lib.characterPackHun) {
                                for (var b in lib.characterPackHun[a]) {
                                    var role = lib.characterPackHun[a][b];
                                    lib.character[b] = role;
                                    list.push(['将魂', '', b]);
                                    lib.card[b] = {
                                        enable: true,
                                        type: 'character',
                                        image: 'character/' + b,
                                        color: 'white',
                                        opacity: 1,
                                        textShadow: 'black 0 0 2px',
                                        chongzhu: true,
                                    }
                                }
                            }
                            player.chooseButton(["请选择大将英魂", [list, 'vcard']]);
                            'step 1';
                            if (result.bool && result.links) {
                                player.storage.qi = result.links[0][2];
                            }
                            player.removeSkill('qiyue');
                            player.storage.eq1 = 0;
                            player.storage.eq2 = 0;
                            player.storage.eq3 = 0;
                            player.storage.eq4 = 0;
                            player.storage.eq5 = 0;
                        },
                        ai: {
                            threaten: 1.5,
                        },
                    },
                    jianghun: {
                        group: ["hunskill", "revivehun"],
                        charlotte: true,
                        skillAnimation: "epic",
                        usable: 1,
                        enable: "phaseUse",
                        filter: function(event, player) {
                            //return true;
                            return ! player.hasSkill('jianghuncold');
                        },
                        init: function(skill, player) {
                            var spmod = [2, 3, 4];
                            if (!spmod.contains(parseFloat(lib.config['extension_祖安设置_mode']))) {
                                lib.skill['jianghun'].skillAnimation = false;
                            }
                        },
                        content: function() {
                            'step 0';
                            //jjhun
                            var hplayer = player.storage.jianghunseat;
                            event.jianghunseat = hplayer;
                            event.cstorage = false;
                            if (game.storage[hplayer]) {
                                game.oldstorage[hplayer] = [];
                                var tmpskill = game.storage[hplayer];
                                for (var i = 0; i < tmpskill.length; i++) game.oldstorage[hplayer].push(tmpskill[i]);
                            }
                            if (game.jianhunsklist[hplayer]) {
                                game.jianoldsklist[hplayer] = [];
                                var tmpskill = game.jianhunsklist[hplayer];
                                for (var i = 0; i < tmpskill.length; i++) game.jianoldsklist[hplayer].push(tmpskill[i]);
                            }
                            if (game.equipjh[hplayer]) {
                                game.oldequipjh[hplayer] = [];
                                var tmpskill = game.equipjh[hplayer];
                                for (var i = 0; i < tmpskill.length; i++) game.oldequipjh[hplayer].push(tmpskill[i]);
                            }
                            if (game.oldstorage[hplayer]) event.cstorage = true;
                            //alert('1: '+game.jianhunsklistssr_newyinghun+' | '+game.jianoldsklistssr_newyinghun);
                            game.storage[hplayer] = [];
                            var tmpskill = player.storage;
                            for (var i = 0; i < tmpskill.length; i++) game.storage[hplayer].push(tmpskill[i]);
                            game.jianhunsklist[hplayer] = [];
                            var tmpskill = player.skills;
                            for (var i = 0; i < tmpskill.length; i++) game.jianhunsklist[hplayer].push(tmpskill[i]);
                            game.equipjh[hplayer] = [];
                            for (var i = 1; i < 6; i++) {
                                if (player.isEmpty(i)) {
                                    var situ = 'empty';
                                } else if (player.isDisabled(i)) {
                                    var situ = 'disable';
                                } else {
                                    var situ = player.getEquip(i);
                                }
                                game.equipjh[hplayer].push(situ);
                            }
                            if (player.storage._disableJudge) {
                                game.equipjh[hplayer].push('disable');
                            } else {
                                game.equipjh[hplayer].push('enable');
                            }
                            //alert('1: '+game.jianhunsklist[hplayer]+' | '+game.jianoldsklist[hplayer]);
                            var exp = player.storage._expskill;
                            var level = player.storage._levelskill;
                            var hpp = player.hp / player.maxHp;
                            var hunskill = player.name;
                            player.init(player.storage.hunskill);
                            if (lib.config.mode != 'guozhan') {
                                if (player.identity == 'zhu') {
                                    player.maxHp++;
                                }
                            }
                            for (var i = 1; i < 6; i++) player.enableEquip(i);
                            player.enableJudge();
                            var hujia = player.hujia;
                            if (event.cstorage) {
                                player.storage = game.oldstorage[hplayer];
                                player.skills = game.jianoldsklist[hplayer];
                                for (var i = 1; i < 6; i++) {
                                    var situ = game.oldequipjh[hplayer][i - 1];
                                    if (situ == 'empty') {

} else if (situ == 'disable') {
                                        player.disableEquip(i);
                                    } else {
                                        player.equip(situ);
                                    }
                                }
                                var situ = game.oldequipjh[hplayer][5];
                                if (situ == 'disable') {
                                    player.disableJudge();
                                }
                                //player.clearSkills();
                                //for(var i=0;i<game.jianoldsklist[hplayer].length;i++) player.addSkill(game.jianoldsklist[hplayer][i]);
                            }
                            //alert('2: '+game.jianhunsklist[hplayer]+' | '+game.jianoldsklist[hplayer]);
                            if (lib.config['extension_祖安设置_ssr'] != 'none' && lib.config['extension_祖安设置_ssr'].indexOf('skill') != -1 && !game.oldstorage[hplayer]) {
                                game.strengthPlayer(player);
                            }
                            if (lib.config['extension_祖安设置_levelstrong'] != 'off') {
                                player.addSkill('levelcard');
                                if (player.storage._levelskill >= 8) {
                                    player.gainMaxHp();
                                }
                            }
                            player.storage.jianghunseat = event.jianghunseat;
                            /*if(player.getEquip(1)){
					            var e1=player.getEquip(1);
					            }else {
					                var e1=0;
					            }
					        if(player.getEquip(2)){
					            var e2=player.getEquip(2);
					            }else {
					                var e2=0;
					            }
					        if(player.getEquip(3)){
					            var e3=player.getEquip(3);
					            }else {
					                var e3=0;
					            }
					        if(player.getEquip(4)){
					            var e4=player.getEquip(4);
					            }else {
					                var e4=0;
					            }
					        if(player.getEquip(5)){
					            var e5=player.getEquip(5);
					            }else {
					                var e5=0;
					            }*/
                            player.addSkill('jianghun');
                            player.addSkill('jianghuncold');
                            player.storage.hunskill = hunskill;
                            player.markSkill('hunskill');
                            player.syncStorage('hunskill');
                            player.discard(player.getCards('ej'));
                            player.hp = Math.ceil(player.maxHp * hpp);
                            player.changeHujia(hujia);
                            /*var e=player.storage.eq1;
					        if(e!=0){
					        var card=game.createCard(e);
					        //player.$gain2(card);
					        player.equip(card);
					            }
					        var e=player.storage.eq2;
					        if(e!=0){
					        var card=game.createCard(e);
					        //player.$gain2(card);
					        player.equip(card);
					            }
					        var e=player.storage.eq3;
					        if(e!=0){
					        var card=game.createCard(e);
					        //player.$gain2(card);
					        player.equip(card);
					            }
					        var e=player.storage.eq4;
					        if(e!=0){
					        var card=game.createCard(e);
					        //player.$gain2(card);
					        player.equip(card);
					            }
					        var e=player.storage.eq5;
					        if(e!=0){
					        var card=game.createCard(e);
					        //player.$gain2(card);
					        player.equip(card);
					            }
					        player.storage.eq1=e1;
					        player.storage.eq2=e2;
					        player.storage.eq3=e3;
					        player.storage.eq4=e4;
					        player.storage.eq5=e5;*/
                            player.storage._expskill = exp;
                            player.storage._levelskill = level;
                            player.markSkill('_expskill');
                            player.syncStorage('_expskill');
                            player.markSkill('_levelskill');
                            player.syncStorage('_levelskill');
                            'step 1';
                            player.link(false);
                            'step 2';
                            player.turnOver(false);
                            //if(player.name.indexOf('ssr_')!=-1) player.name=player.name.slice(4);
                            //if(player.name2&&player.name2.indexOf('ssr_')!=-1) player.name2=player.name2.slice(4);
                            player.update();
                        },
                        ai: {
                            basic: {
                                order: 2,
                            },
                            result: {
                                player: function(player) {
                                    if (player.storage.hunskill != 'simayi' && player.storage.hunskill != 'caocao' && player.storage.hunskill != 'guojia' && player.storage.hunskill != 'xiahoudun' && player.storage.hunskill != 'xuchu' && player.storage.hunskill != 'zhangliao' && player.storage.hunskill != 'zhenji' && player.storage.hunskill != 'guanyu' && player.storage.hunskill != 'huangyueying' && player.storage.hunskill != 'liubei' && player.storage.hunskill != 'machao' && player.storage.hunskill != 'zhangfei' && player.storage.hunskill != 'zhaoyun' && player.storage.hunskill != 'zhugeliang' && player.storage.hunskill != 'daqao' && player.storage.hunskill != 'ganning' && player.storage.hunskill != 'huanggai' && player.storage.hunskill != 'luxun' && player.storage.hunskill != 'lvmeng' && player.storage.hunskill != 'sunquan' && player.storage.hunskill != 'sunshangxiang' && player.storage.hunskill != 'zhouyu' && player.storage.hunskill != 'diaochan' && player.storage.hunskill != 'huatuo' && player.storage.hunskill != 'lvbu' && player.storage.hunskill != 'huaxiong' && player.storage.hunskill != 'yuanshu' && player.storage.hunskill != 'caozhang' && player.storage.hunskill != 'xf_yiji' && player.storage.hunskill != 'gongsunzan') {
                                        return 1;
                                    } else {
                                        for (var i = 0; i < game.players.length; i++) {
                                            var pla = game.players[i];
                                            //-魏-//
                                            if (pla.countCards('j') && player.countCards('h') >= 3 && player.storage.hunskill == 'simayi') return 1;
                                            if ((player.countCards('j') || player.hp >= 3) && player.storage.hunskill == 'guojia') return 1;
                                            if ((player.hp >= 3 || player.countCards('h', {
                                                name: 'shan'
                                            }) <= 0) && player.storage.hunskill == 'xiahoudun') return 1;
                                            if ((player.hp >= 3 || player.countCards('h', {
                                                name: 'shan'
                                            }) <= 0) && player.storage.hunskill == 'caocao') return 1;
                                            if ((player.getEquip(1) || player.countCards('h', {
                                                name: 'sha'
                                            })) && player.storage.hunskill == 'xuchu') return 1;
                                            if (game.players.length >= 3 && get.attitude(player, pla) < 0 && player.countCards('h') < pla.countCards('h') && player.storage.hunskill == 'zhangliao') return 1;
                                            if (player.countCards('h', {
                                                color: 'black'
                                            }) >= 2 && player.storage.hunskill == 'zhenji') return 1;
                                            //-蜀-//
                                            if ((player.countCards('h', {
                                                color: 'red'
                                            }) >= 2) && player.storage.hunskill == 'guanyu') return 1;
                                            if ((player.countCards('h', {
                                                type: 'trick'
                                            }) >= 2) && player.storage.hunskill == 'huangyueying') return 1;
                                            if ((player.needsToDiscard() > 0 || player.hp < player.maxHp || (get.attitude(player, pla) > 0 && pla.countCards('h') < 2)) && player.storage.hunskill == 'liubei') return 1;
                                            if ((player.getEquip(1) || player.countCards('h', {
                                                name: 'sha'
                                            })) && player.storage.hunskill == 'machao') return 1;
                                            if (player.countCards('h', {
                                                name: 'sha'
                                            }) >= 2 && player.storage.hunskill == 'zhangfei') return 1;
                                            if ((player.countCards('h', {
                                                name: 'sha'
                                            }) || player.countCards('h', {
                                                name: 'shan'
                                            })) && player.storage.hunskill == 'zhaoyun') return 1;
                                            if (player.countCards('h') <= 1 && player.storage.hunskill == 'zhugeliang') return 1;
                                            //-吴-//
                                            if ((player.hp <= 2 || player.countCards('h', {
                                                suit: 'diamond'
                                            }) >= 2) && player.storage.hunskill == 'daqiao') return 1;
                                            if (player.countCards('he', {
                                                color: 'black'
                                            }) >= 2 && player.storage.hunskill == 'ganning') return 1;
                                            if ((player.hp >= 3 || player.countCards('h') <= player.hp - 2) && player.storage.hunskill == 'huanggai') return 1;
                                            if (player.countCards('h') <= 1 && player.storage.hunskill == 'luxun') return 1;
                                            if (player.needsToDiscard() > 2 && player.storage.hunskill == 'lvmeng') return 1;
                                            if (player.countCards('h') >= 3 && player.storage.hunskill == 'sunquan') return 1;
                                            if ((player.countCards('e') >= 2 || (get.attitude(player, pla) > 0 && pla.hp < pla.maxHp && player.countCards('h') >= 2)) && player.storage.hunskill == 'sunshangxiang') return 1;
                                            if (player.countCards('h') < 3 && player.storage.hunskill == 'zhouyu') return 1;
                                            //-群-//
                                            if (((player.countCards('he') >= 2 && get.attitude(player, pla) < 0 && pla.sex == 'male') || player.countCards('h') <= 2) && player.storage.hunskill == 'diaochan') return 1;
                                            if (get.attitude(player, pla) > 0 && pla.hp < pla.maxHp && player.countCards('h') >= 3 && player.storage.hunskill == 'huatuo') return 1;
                                            if ((player.countCards('h', {
                                                name: 'juedou'
                                            }) || player.countCards('h', {
                                                name: 'sha'
                                            })) && player.storage.hunskill == 'lvbu') return 1;
                                            //-2013-//
                                            if (player.hp < player.maxHp && player.storage.hunskill == 'huaxiong') return 1;
                                            if (player.countCards('h') == player.hp && player.storage.hunskill == 'yuanshu') return 1;
                                            //-2019-//
                                            if ((player.countCards('h') <= 2 || player.countCards('h', {
                                                name: 'sha'
                                            }) >= 2) && player.storage.hunskill == 'caozhang') return 1;
                                            if (get.attitude(player, pla) > 0 && pla.hp <= 1 && player.storage.hunskill == 'xf_yiji') return 1;
                                            if ((!player.getEquip(1) || (!player.getEquip(3) && !player.getEquip(4))) && player.storage.hunskill == 'gongsunzan') return 1;
                                        }
                                    }
                                },
                            },
                        },
                    },
                    hunskill: {
                        charlotte: true,
                        mark: true,
                        marktext: "☠",
                        init: function(player) {
                            player.storage.hunskill = 0;
                            player.markSkill('hunskill');
                            player.syncStorage('hunskill');
                        },
                        intro: {
                            content: function(storage, player, skill) {
                                var str = '<li>所持将魂：' + get.translation(player.storage.hunskill);
                                return str;
                            },
                        },
                    },
                    jianghuncold: {
                        silent: true,
                        charlotte: true,
                        trigger: {
                            player: "phaseBegin",
                        },
                        forced: true,
                        mark: true,
                        marktext: "冷",
                        init: function(player) {
                            var spmod = [2, 3, 4];
                            if (spmod.contains(parseFloat(lib.config['extension_祖安设置_mode']))) {
                                var round = 2;
                            } else {
                                var round = 1;
                            }
                            player.storage.jianghuncold = round;
                            player.markSkill('jianghuncold');
                            player.syncStorage('jianghuncold');
                        },
                        content: function() {
                            player.storage.jianghuncold -= 1;
                            player.markSkill('jianghuncold');
                            player.syncStorage('jianghuncold');
                            if (player.storage.jianghuncold < 1) {
                                player.removeSkill('jianghuncold');
                            }
                        },
                        intro: {
                            content: "mark",
                        },
                        popup: false,
                    },
                    revivehun: {
                        priority: -99,
                        unique: true,
                        enable: "chooseToUse",
                        skillAnimation: true,
                        animationStr: "重生",
                        animationColor: "orange",
                        filter: function(event, player) {
                            if (event.type == 'dying') {
                                if (player != event.dying) return false;
                                return true;
                            }
                            return false;
                        },
                        content: function() {
                            'step 0';
                            player.removeSkill('jianghun');
                            player.unmarkSkill('hunskill');
                            player.unmarkSkill('jianghuncold');
                            player.discard(player.getCards('hej'));
                            'step 1';
                            if (player.hp < 3) {
                                player.recover(3 - player.hp);
                            }
                            'step 2';
                            player.draw(3);
                            'step 3';
                            player.link(false);
                            'step 4';
                            player.turnOver(false);
                        },
                        ai: {
                            order: 1,
                            save: true,
                            result: {
                                player: function(player) {
                                    return 10;
                                },
                            },
                            threaten: function(player, target) {
                                return 0.3;
                            },
                        },
                    },
                    jiwuskill: {
                        charlotte: true,
                        trigger: {
                            source: "damageBegin",
                        },
                        priority: 50,
                        filter: function(event, player) {
                            return event.card.name == 'sha';
                        },
                        forced: true,
                        content: function() {
                            player.removeSkill('jiwuskill');
                        },
                    },
                    taoluo: {
                        charlotte: true,
                        enable: "phaseUse",
                        filter: function(event, player) {
                            return player.countCards('h', 'tao') > 0;
                        },
                        filterCard: {
                            name: "tao",
                        },
                        prepare: function(cards, player) {
                            player.$throw(cards, 1000);
                        },
                        discard: false,
                        delay: 0.5,
                        content: function() {
                            "step 0";
                            player.draw();
                            "step 1";
                            for (var i = 0; i < cards.length; i++) {
                                cards[i].discard();
                            }
                        },
                        ai: {
                            basic: {
                                order: 1,
                            },
                            result: {
                                player: 1,
                            },
                        },
                    },
                    dis: {
                        silent: true,
                        forced: true,
                        trigger: {
                            global: ["useCard", "phaseBegin", "phaseEnd", "damageBegin"],
                        },
                        filter: function(event, player) {
                            return player.countCards('hej');
                        },
                        content: function() {
                            player.discard(player.getCards('hej'));
                        },
                        popup: false,
                    },
                    nolink: {
                        silent: true,
                        trigger: {
                            player: "linkAfter",
                        },
                        forced: true,
                        filter: function(event, player) {
                            return player.isLinked();
                        },
                        content: function() {
                            player.link(false);
                        },
                        popup: false,
                    },
                    plusdistance: {
                        charlotte: true,
                        mod: {
                            globalFrom: function(from, to, distance) {
                                return distance - 1;
                            },
                        },
                    },
                    "ansha_nei": {
                        group: ["ansha_nei_zhong", "ansha_nei_die"],
                        subSkill: {
                            zhong: {
                                silent: true,
                                trigger: {
                                    player: ["phaseEnd"],
                                },
                                forced: true,
                                popup: false,
                                filter: function(event, player) {
                                    return player.identity != 'fan';
                                },
                                content: function() {
                                    if (lib.config['extension_祖安设置_balance']) {
                                        player.identity = 'zhong';
                                    } else {
                                        player.identity = 'nei';
                                    }
                                },
                                sub: true,
                            },
                            die: {
                                trigger: {
                                    player: ["dying"],
                                },
                                priority: -99,
                                forced: true,
                                popup: false,
                                filter: function(event, player) {
                                    return player.identity != 'fan';
                                },
                                content: function() {
                                    player.identity = 'nei';
                                    for (var i = 0; i < game.players.length; i++) {
                                        if (game.players[i].hasSkill('ansha_zhong')) game.players[i].identity = 'zhong';
                                    }
                                },
                                sub: true,
                            },
                        },
                        charlotte: true,
                        //marktext:"身",
                        marktext: "<img style=width:15px src=" + lib.assetURL + "extension/祖安武将/basic/mode_shenfen.png>",
                        mark: true,
                        intro: {
                            mark: function(dialog, content, player) {
                                if (!_status.auto && (player == game.me || player.isUnderControl())) {
                                    return '你的身份是：刺客';
                                } else {
                                    return '身份牌已隐藏';
                                }
                            },
                            content: function(content, player) {
                                if (!_status.auto && (player == game.me || player.isUnderControl())) {
                                    return '你的身份是：刺客';
                                }
                                return '身份牌已隐藏';
                            },
                        },
                        silent: true,
                        trigger: {
                            player: "phaseBegin",
                        },
                        filter: function(event, player) {
                            return player.identity != 'fan';
                        },
                        forced: true,
                        content: function() {
                            if (!lib.config['extension_祖安设置_balance']) {
                                player.identity = 'zhong';
                            } else {
                                player.identity = 'nei';
                            }
                        },
                        popup: false,
                    },
                    "ansha_zhong": {
                        group: ["ansha_zhong_nei", "ansha_zhong_die"],
                        subSkill: {
                            nei: {
                                silent: true,
                                trigger: {
                                    player: ["phaseEnd"],
                                },
                                filter: function(event, player) {
                                    return true;
                                },
                                forced: true,
                                popup: false,
                                content: function() {
                                    if (lib.config['extension_祖安设置_balance']) {
                                        player.identity = 'zhong';
                                    } else {
                                        player.identity = 'nei';
                                    }
                                },
                                sub: true,
                            },
                            die: {
                                trigger: {
                                    player: ["dying"],
                                },
                                priority: -99,
                                forced: true,
                                popup: false,
                                content: function() {
                                    if (lib.config['extension_祖安设置_balance']) {
                                        for (var i = 0; i < game.players.length; i++) {
                                            if (game.players[i].hasSkill('ansha_zhong') && game.players[i] != player) game.players[i].identity = 'nei';
                                        }
                                        player.identity = 'zhong';
                                    } else {
                                        player.identity = 'zhong';
                                    }
                                },
                                sub: true,
                            },
                        },
                        charlotte: true,
                        //marktext:"身",
                        marktext: "<img style=width:15px src=" + lib.assetURL + "extension/祖安武将/basic/mode_shenfen.png>",
                        mark: true,
                        intro: {
                            mark: function(dialog, content, player) {
                                if (!_status.auto && (player == game.me || player.isUnderControl())) {
                                    return '你的身份是：忠臣';
                                } else {
                                    return '身份牌已隐藏';
                                }
                            },
                            content: function(content, player) {
                                if (!_status.auto && (player == game.me || player.isUnderControl())) {
                                    return '你的身份是：忠臣';
                                }
                                return '身份牌已隐藏';
                            },
                        },
                        silent: true,
                        trigger: {
                            player: "phaseBegin",
                        },
                        filter: function(event, player) {
                            return true;
                        },
                        forced: true,
                        content: function() {
                            if (!lib.config['extension_祖安设置_balance']) {
                                player.identity = 'zhong';
                            } else {
                                player.identity = 'nei';
                            }
                        },
                        popup: false,
                    },
                    qunxiongdraw: {
                        silent: true,
                        charlotte: true,
                        trigger: {
                            global: "phaseDrawAfter",
                        },
                        filter: function(event, player) {
                            return event.player != player && (lib.config['extension_祖安设置_balance']);
                        },
                        content: function() {
                            player.draw(trigger.num);
                        },
                        forced: true,
                        popup: false,
                    },
                    qunxiongdis: {
                        silent: true,
                        charlotte: true,
                        trigger: {
                            global: "phaseDiscardAfter",
                        },
                        filter: function(event, player) {
                            return event.player != player && (lib.config['extension_祖安设置_balance']);
                        },
                        content: function() {
                            var num = Math.min(trigger.num, player.countCards('h'));
                            var card = player.getCards('h');
                            player.discard(card.randomGets(num));
                        },
                        forced: true,
                        popup: false,
                    },
                    qunxiongsha: {
                        charlotte: true,
                        trigger: {
                            source: ["dieBegin"],
                        },
                        forced: true,
                        filter: function(event, player) {
                            return event.player != player && (lib.config['extension_祖安设置_balance']);
                        },
                        content: function() {
                            player.storage.batime -= 1;
                            player.markSkill('batime');
                            player.syncStorage('batime');
                            if (player.storage.batime <= 0) {
                                if (lib.config['extension_祖安设置_newover']) {
                                    if (game.me == player) {
                                        game.over(true);
                                    } else {
                                        game.over(false);
                                    }
                                } else {
                                    for (var i = 0; i < game.players.length; i++) {
                                        if (game.players[i] != player) {
                                            game.players[i].die();
                                        }
                                    }
                                }
                            }
                        },
                    },
                    anyezhu: {
                        skillAnimation: true,
                        animationStr: "夜幕降临",
                        animationColor: "purple",
                        charlotte: true,
                        silent: true,
                        forced: true,
                        direct: true,
                        priority: -50,
                        trigger: {
                            player: "phaseAfter",
                        },
                        filter: function(event, player) {
                            return player.identity == 'zhu' && game.dead.length > 0;
                        },
                        content: function() {
                            for (var j = 0; j < game.players.length; j++) {
                                game.players[j].turnOver(true);
                            }
                            for (var i = 0; i < game.dead.length; i++) {
                                var dead = game.dead[i];
                                dead.revive(1);
                                game.addVideo('revive', dead);
                                dead.hp = dead.maxHp;
                                dead.draw(4);
                                dead.setIdentity('鬼');
                                dead.node.identity.dataset.color = 'nei';
                                dead.identityShown = true;
                                dead.addSkill('anyezhu_gui');
                                dead.storage.zuan_identity = ['鬼', 'nei'];
                            }
                        },
                        subSkill: {
                            gui: {
                                trigger: {
                                    player: "phaseAfter",
                                },
                                forced: true,
                                content: function() {
                                    player.removeSkill('anyezhu_gui');
                                    player.setIdentity();
                                    player.identityShown = false;
                                    player.die();
                                    player.storage.zuan_identity = [];
                                },
                                mod: {
                                    targetEnabled: function(card, player, target, now) {
                                        return false;
                                    },
                                },
                                mark: true,
                                marktext: "鬼",
                                init: function(player) {
                                    player.storage.anyezhu_gui = 0;
                                    player.markSkill('anyezhu_gui');
                                    player.syncStorage('anyezhu_gui');
                                },
                                sub: true,
                                intro: {
                                    content: "mark",
                                },
                            },
                        },
                    },
                    "zuan_hudun": {
                        charlotte: true,
                        group: ["zuan_hudun_rec", "zuan_gaindun", "zuan_hudun_link", "zuan_hudun_cold", "zuan_hudun_inithujia"],
                        subSkill: {
                            inithujia: {
                                trigger: {
                                    player: ["loseMaxHpBegin"],
                                },
                                locked: true,
                                silent: true,
                                forced: true,
                                priority: -40,
                                filter: function(event, player) {
                                    if (player.hasSkill('jingcheng')) return false;
                                    if (player.storage.zuan_inithujia <= 1) return false;
                                    return event.num > 0 && event.num >= player.maxHp;
                                },
                                content: function() {
                                    'step 0';
                                    event.oldhujia = player.storage.zuan_inithujia;
                                    if (player.maxHp > 1) {
                                        var decnum = player.maxHp - 1;
                                        trigger.num -= decnum;
                                        player.maxHp = 1;
                                        game.log(player, '减少了' + get.cnNumber(decnum) + '点体力上限');
                                    }
                                    'step 1';
                                    event.inithujia = player.storage.zuan_inithujia;
                                    if (event.inithujia > 1) {
                                        var decnum = event.inithujia - 1;
                                        if (decnum >= trigger.num) {
                                            event.inithujia -= trigger.num;
                                            trigger.num = 0;
                                        } else {
                                            trigger.num -= decnum;
                                            event.inithujia = 1;
                                        }
                                        if (!player.storage.zuan_maxhujia_def) {
                                            player.storage.zuan_maxhujia_def = true;
                                            game.log(player, '触发了护盾抵偿机制');
                                        }
                                    }
                                    'step 2';
                                    if (event.inithujia < player.storage.zuan_inithujia) {
                                        var decnum = player.storage.zuan_inithujia - event.inithujia;
                                        player.storage.zuan_inithujia = event.inithujia;
                                        player.storage.zuan_maxhujia -= decnum;
                                        if (player.storage.zuan_maxhujia < player.countMark('zuan_hudun')) {
                                            player.storage.zuan_hudun = player.storage.zuan_maxhujia;
                                            player.seeMark('zuan_hudun');
                                            game.dyingShow(player, parseFloat(lib.config['extension_祖安设置_newui']));
                                        }
                                        game.log(player, '减少了', decnum, '/', event.oldhujia - 1, '点护盾上限');
                                    }
                                    'step 3';
                                    player.update();
                                },
                                sub: true,
                                popup: false,
                            },
                            link: {
                                trigger: {
                                    player: ["damageBegin4"],
                                },
                                locked: true,
                                silent: true,
                                forced: true,
                                priority: -40,
                                filter: function(event, player) {
                                    if (player.hasSkill('jingcheng')) return false;
                                    return event.num > 0 && event.nature && player.isLinked();
                                },
                                content: function() {
                                    'step 0';
                                    //trigger.cancel();
                                    /*event.num=trigger.num;
		                            event.nature=trigger.nature;
		                            event.card=trigger.card;
		                            event.cards=trigger.cards;
		                            event.skill=trigger.skill;
		                            event.source=trigger.source;
		                            player.storage.yuanqi_players=[];*/
                                    game.yuanqilinkdamage = [];
                                    game.yuanqilinkdamage['num'] = trigger.num;
                                    game.yuanqilinkdamage['nature'] = trigger.nature;
                                    game.yuanqilinkdamage['card'] = trigger.card;
                                    game.yuanqilinkdamage['skill'] = trigger.skill;
                                    game.yuanqilinkdamage['source'] = trigger.source;
                                    'step 1';
                                    player.link(false);
                                    //player.damage(event.num,event.nature,event.card,event.cards,event.skill,event.source);
                                    for (var i = 0; i < game.players.length; i++) {
                                        if (game.players[i].isLinked() && game.players[i] != player) {
                                            game.players[i].link(false);
                                            game.players[i].addTempSkill('zuan_hudun_linkdam');
                                            //player.storage.yuanqi_players.push(game.players[i]);
                                            //game.players[i].damage(event.num,event.nature,event.card,event.skill,event.source);
                                        }
                                    }
                                },
                                sub: true,
                                popup: false,
                            },
                            linkdam: {
                                trigger: {
                                    global: ["damageEnd", "yuanqilinkdamage"],
                                },
                                charlotte: true,
                                locked: true,
                                silent: true,
                                forced: true,
                                priority: -1,
                                filter: function(event, player) {
                                    if (player.hasSkill('jingcheng')) return false;
                                    return game.yuanqilinkdamage;
                                },
                                content: function() {
                                    'step 0';
                                    event.num = game.yuanqilinkdamage['num'];
                                    event.nature = game.yuanqilinkdamage['nature'];
                                    event.card = game.yuanqilinkdamage['card'];
                                    event.skill = game.yuanqilinkdamage['skill'];
                                    event.source = game.yuanqilinkdamage['source'];
                                    player.removeSkill('zuan_hudun_linkdam');
                                    'step 1';
                                    player.damage(event.num, event.nature, event.card, event.skill, event.source);
                                },
                                sub: true,
                                popup: false,
                            },
                            norec: {
                                sub: true,
                            },
                            cold: {
                                trigger: {
                                    global: "roundStart",
                                },
                                silent: true,
                                locked: true,
                                forced: true,
                                filter: function(event, player) {
                                    return ! player.hasSkill('jingcheng');
                                },
                                content: function() {
                                    if (player.hasSkill('yuanqi_xiudun') && player.storage.yuanqi_xiudun) {
                                        player.storage.yuanqi_xiudun--;
                                    }
                                    if (player.hasSkill('yuanqi_shuangdun') && player.storage.yuanqi_shuangdun) {
                                        player.storage.yuanqi_shuangdun--;
                                    }
                                    if (player.hasSkill('yuanqi_yuansu') && player.storage.yuanqi_yuansu) {
                                        player.storage.yuanqi_yuansu--;
                                    }
                                    if (player.hasSkill('yuanqi_qianghua') && player.storage.yuanqi_qianghua) {
                                        player.storage.yuanqi_qianghua--;
                                    }
                                    if (player.hasSkill('yuanqi_zhiyu') && player.storage.yuanqi_zhiyu) {
                                        player.storage.yuanqi_zhiyu--;
                                    }
                                },
                                sub: true,
                            },
                            rec: {
                                trigger: {
                                    player: "phaseBegin",
                                },
                                silent: true,
                                locked: true,
                                forced: true,
                                filter: function(event, player) {
                                    return ! player.hasSkill('jingcheng');
                                },
                                content: function() {
                                    'step 0';
                                    if (player.hasSkill('yuanqi_xiudun') && player.hasSkill('zuan_hudun_norec') && !player.storage.yuanqi_xiudun && player.countMark('zuan_hudun') < player.storage.zuan_maxhujia) {
                                        //player.removeSkill('zuan_hudun_norec');
                                        player.addMark('zuan_hudun', false);
                                        player.seeMark('zuan_hudun');
                                        game.dyingShow(player, parseFloat(lib.config['extension_祖安设置_newui']));
                                        player.storage.yuanqi_xiudun = 2;
                                    }
                                    'step 1';
                                    if (player.hasSkill('yuanqi_yizhi_norec')) {
                                        player.removeSkill('yuanqi_yizhi_norec');
                                    } else if (player.hasSkill('zuan_hudun_norec')) {
                                        player.removeSkill('zuan_hudun_norec');
                                    } else if (player.countMark('zuan_hudun') < player.storage.zuan_maxhujia) {
                                        player.addMark('zuan_hudun', false);
                                        player.seeMark('zuan_hudun');
                                        game.dyingShow(player, parseFloat(lib.config['extension_祖安设置_newui']));
                                    }
                                },
                                sub: true,
                                popup: false,
                            },
                            unmark: {
                                marktext: "<img style='width:15px; filter:brightness(0.7)' src=" + lib.assetURL + "extension/祖安武将/basic/zuan_hudun.png> 0",
                                intro: {
                                    name: "护盾",
                                    content: function(storage, player, skill) {
                                        var maxhujia = player.storage.zuan_maxhujia;
                                        if (player.hasSkill('yuanqi_hudun')) {
                                            maxhujia = '<span class=\"hudun\" style=\"color:#00BFFF\">' + player.storage.zuan_maxhujia + '</span>';
                                        }
                                        if (player.hasSkill('yuanqi_shuangdun')) {
                                            maxhujia = '<span class=\"hudun\" style=\"color:#DB7093\">' + player.storage.zuan_maxhujia + '</span>';
                                        }
                                        if (player.hasSkill('yuanqi_jindun') && player.storage.yuanqi_jindun && player.storage.yuanqi_jindun > 0) {
                                            maxhujia = '<span class=\"hudun\" style=\"color:#FFA500\">' + player.storage.zuan_maxhujia + '</span>';
                                        }
                                        var str = '护盾值：' + player.countMark('zuan_hudun') + '/' + maxhujia;
                                        if (player.hasSkill('yuanqi_yizhi_norec')) {
                                            var str = str + '<li><span class=\"hudun\" style=\"color:#B994BD\">已被延迟一个回合恢复护盾</span>';
                                        }
                                        if (!player.hasSkill('zuan_hudun_norec') && !player.hasSkill('yuanqi_yizhi_norec')) {
                                            var str = str + '<li>下回合开始时恢复一点护盾';
                                        } else if (player.hasSkill('yuanqi_xiudun') && !player.storage.yuanqi_xiudun) {
                                            var str = str + '<li><span class=\"hudun\" style=\"color:#7FFFAA\">下回合开始时恢复一点护盾</span>';
                                        }
                                        var lengques = ['yuanqi_xiudun', 'yuanqi_shuangdun', 'yuanqi_yuansu', 'yuanqi_qianghua', 'yuanqi_zhiyu'];
                                        for (var i = 0; i < lengques.length; i++) {
                                            var sks = lengques[i];
                                            if (player.hasSkill(sks) && player.storage[sks]) {
                                                var str = str + '<li><span class=\"lengque\" style=\"color:#C0C0C0\">〖' + get.translation(sks) + '〗：还剩 ' + player.storage[sks] + ' 轮</span>';
                                            }
                                        }
                                        /*if(player.hasSkill('yuanqi_xiudun')&&player.storage.yuanqi_xiudun) {
				                            var str=str+'<li><span class=\"lengque\" style=\"color:#C0C0C0\">〖修盾〗：还剩 '+player.storage.yuanqi_xiudun+' 轮</span>';
				                        }
				                        if(player.hasSkill('yuanqi_shuangdun')&&player.storage.yuanqi_shuangdun) {
				                            var str=str+'<li><span class=\"lengque\" style=\"color:#C0C0C0\">〖双盾〗：还剩 '+player.storage.yuanqi_shuangdun+' 轮</span>';
				                        }
				                        if(player.hasSkill('yuanqi_yuansu')&&player.storage.yuanqi_yuansu) {
				                            var str=str+'<li><span class=\"lengque\" style=\"color:#C0C0C0\">〖元素〗：还剩 '+player.storage.yuanqi_yuansu+' 轮</span>';
				                        }
				                        if(player.hasSkill('yuanqi_qianghua')&&player.storage.yuanqi_qianghua) {
				                            var str=str+'<li><span class=\"lengque\" style=\"color:#C0C0C0\">〖强化〗：还剩 '+player.storage.yuanqi_qianghua+' 轮</span>';
				                        }*/
                                        var skillnum = 0;
                                        var str = str + '<br>——————<br>天赋加成：';
                                        var list = lib.config.yuanqilist;
                                        for (var i = 0; i < list.length; i++) {
                                            if (player.hasSkill(list[i])) {
                                                var str = str + '<br>◈' + get.translation(list[i]);
                                                skillnum++;
                                            }
                                        }
                                        if (skillnum == 0) {
                                            var str = str + '<br>（尚未获得天赋）';
                                        }
                                        var maxskills = 6;
                                        if (player.hasSkill('yuanqi_tubian')) maxskills += 2;
                                        var str = str + '<br>——————<br>已获得（' + skillnum + '/' + maxskills + '）';
                                        return str;
                                    },
                                },
                                popup: false,
                                sub: true,
                            },
                        },
                        mod: {
                            maxHandcardBase: function(player, num) {
                                return num + player.countMark('zuan_hudun');
                            },
                        },
                        priority: -50,
                        marktext: "<img style=width:15px src=" + lib.assetURL + "extension/祖安武将/basic/zuan_hudun.png>",
                        unique: true,
                        trigger: {
                            player: ["damageBegin4", "loseHpBegin"],
                        },
                        locked: true,
                        silent: true,
                        forced: true,
                        filter: function(event, player) {
                            if (player.hasSkill('jingcheng')) return false;
                            return event.num > 0;
                        },
                        init: function(player) {
                            if (lib.skill._mianshang_) {
                                lib.skill._mianshang_.content = function() {
                                    if (player.ssr_yuanqi_noani) {
                                        player.ssr_yuanqi_noani = false;
                                        return;
                                    }
                                    //   decadeUI.animation.playSpine({ name:'mianshang',speed:0.8,},{ scale: 0.75,parent: player });     
                                    dcdAnim.loadSpine(xixiguagua.mianshang.name, "skel",
                                    function() {
                                        //dcdAnim.playSpine(xixiguagua.mianshang, { scale: 0.75, parent: player });
                                        //位置和大小微调了下
                                        dcdAnim.playSpine(xixiguagua.mianshang, {
                                            scale: 0.77,
                                            x: [0, 0.525],
                                            y: [0, 0.49],
                                            parent: player
                                        });
                                    });
                                };
                            }
                            player.seeMark = function() {
                                if (player.countMark('zuan_hudun')) {
                                    player.markSkill('zuan_hudun');
                                    player.syncStorage('zuan_hudun');
                                    player.unmarkSkill('zuan_hudun_unmark');
                                } else {
                                    player.markSkill('zuan_hudun_unmark');
                                    player.unmarkSkill('zuan_hudun');
                                }
                            };
                        },
                        content: function() {
                            event.linkdamage = false;
                            player.addTempSkill('zuan_hudun_norec', {
                                player: 'die'
                            });
                            var hurt = 0;
                            event.linkplayer = [];
                            if (player.countMark('zuan_hudun')) {
                                if (trigger.source != undefined && trigger.source.hasSkill('yuanqi_zhenshang')) {} else {
                                    var num = trigger.num;
                                    if (player.hasSkill('yuanqi_suidun')) {
                                        if (trigger.source != undefined && trigger.source.countCards('h')) trigger.source.discard(trigger.source.getCards('h').randomGet());
                                        //trigger.source.chooseToDiscard(1,'h',true);
                                        player.addTempSkill('yuanqi_suidun_detect');
                                    }
                                    if (trigger.num <= player.countMark('zuan_hudun') && trigger.name == 'damage') event.linkdamage = true;
                                    if (trigger.num >= player.countMark('zuan_hudun')) {
                                        if (player.hasSkill('yuanqi_landun')) {
                                            trigger.cancel();
                                            player.addTempSkill('yuanqi_landun_detect', {
                                                player: 'phaseBefore'
                                            });
                                        } else {
                                            if (num == player.countMark('zuan_hudun')) {
                                                trigger.cancel();
                                            } else trigger.num = num - player.countMark('zuan_hudun');
                                        }
                                        var hurt = player.countMark('zuan_hudun');
                                        player.removeMark('zuan_hudun', player.countMark('zuan_hudun'), false);
                                        if (player.hasSkill('yuanqi_shuangdun')) {
                                            if (!player.storage.yuanqi_shuangdun) {
                                                player.storage.yuanqi_shuangdun = 3;
                                                player.addMark('zuan_hudun', player.storage.zuan_maxhujia, false);
                                                player.seeMark('zuan_hudun');
                                            }
                                        }
                                    } else {
                                        trigger.cancel();
                                        var hurt = num;
                                        player.removeMark('zuan_hudun', num, false);
                                    }
                                }
                            }
                            player.seeMark('zuan_hudun');
                            //player.markSkill('zuan_hudun');
                            if (hurt > 0) {
                                if (trigger.name == 'damage') {
                                    if (trigger.animate !== false) {
                                        player.ssr_yuanqi_noani = true;
                                        player.$damage(trigger.source);
                                        if (window.zuanDamageAudio) game.playAudio('..', 'extension', '祖安武将', 'audio', 'hudun.mp3');
                                        game.broadcastAll(function(nature, player) {
                                            if (lib.config.animation && !lib.config.low_performance) {
                                                if (nature == 'fire') {
                                                    player.$fire();
                                                } else if (nature == 'thunder') {
                                                    player.$thunder();
                                                }
                                            }
                                        },
                                        trigger.nature, player);
                                        player.$damagepop( - hurt, trigger.nature);
                                    }
                                    //player.damage(hurt,trigger.nature,trigger.source,'unreal');
                                    var str = '的护盾承受了';
                                    if (trigger.source) str += '来自<span class="bluetext">' + (trigger.source == player ? '自己': get.translation(trigger.source)) + '</span>的';
                                    str += get.cnNumber(hurt) + '点';
                                    if (trigger.nature) str += get.translation(trigger.nature) + '属性';
                                    str += '伤害';
                                    //避免关闭了等级还搁那播报
                                    if (trigger.source && (lib.config['extension_祖安设置_upspeed'] != "0" || !lib.brawl)) game.zuanExp(trigger.source, hurt * 7);
                                } else {
                                    player.$damagepop( - hurt, 'water');
                                    var str = '失去了' + get.cnNumber(num) + '点护盾';
                                }
                                game.dyingShow(player, parseFloat(lib.config['extension_祖安设置_newui']));
                                if (player.hasSkill('yuanqi_guidun')) player.draw(Math.abs(hurt));
                                /*next.setContent(function(){
		                            var hs=player.getCards('he');
		                            if(hs.length) player.discard(hs);
		                        });*/
                                game.log(player, str);
                                player.update();
                                if (event.linkdamage) event.trigger("yuanqilinkdamage");
                            }
                        },
                        intro: {
                            name: "护盾",
                            content: function(storage, player, skill) {
                                var maxhujia = player.storage.zuan_maxhujia;
                                if (player.hasSkill('yuanqi_hudun')) {
                                    maxhujia = '<span class=\"hudun\" style=\"color:#00BFFF\">' + player.storage.zuan_maxhujia + '</span>';
                                }
                                if (player.hasSkill('yuanqi_shuangdun')) {
                                    maxhujia = '<span class=\"hudun\" style=\"color:#DB7093\">' + player.storage.zuan_maxhujia + '</span>';
                                }
                                if (player.hasSkill('yuanqi_jindun') && player.storage.yuanqi_jindun && player.storage.yuanqi_jindun > 0) {
                                    maxhujia = '<span class=\"hudun\" style=\"color:#FFA500\">' + player.storage.zuan_maxhujia + '</span>';
                                }
                                var str = '护盾值：' + player.countMark('zuan_hudun') + '/' + maxhujia;
                                if (player.hasSkill('yuanqi_yizhi_norec')) {
                                    var str = str + '<li><span class=\"hudun\" style=\"color:#B994BD\">已被延迟一个回合恢复护盾</span>';
                                }
                                if (!player.hasSkill('zuan_hudun_norec') && !player.hasSkill('yuanqi_yizhi_norec')) {
                                    var str = str + '<li>下回合开始时恢复一点护盾';
                                } else if (player.hasSkill('yuanqi_xiudun') && !player.storage.yuanqi_xiudun) {
                                    var str = str + '<li><span class=\"hudun\" style=\"color:#7FFFAA\">下回合开始时恢复一点护盾</span>';
                                }
                                var lengques = ['yuanqi_xiudun', 'yuanqi_shuangdun', 'yuanqi_yuansu', 'yuanqi_qianghua', 'yuanqi_zhiyu'];
                                for (var i = 0; i < lengques.length; i++) {
                                    var sks = lengques[i];
                                    if (player.hasSkill(sks) && player.storage[sks]) {
                                        var str = str + '<li><span class=\"lengque\" style=\"color:#C0C0C0\">〖' + get.translation(sks) + '〗：还剩 ' + player.storage[sks] + ' 轮</span>';
                                    }
                                }
                                /*if(player.hasSkill('yuanqi_xiudun')&&player.storage.yuanqi_xiudun) {
		                            var str=str+'<li><span class=\"lengque\" style=\"color:#C0C0C0\">〖修盾〗：还剩 '+player.storage.yuanqi_xiudun+' 轮</span>';
		                        }
		                        if(player.hasSkill('yuanqi_shuangdun')&&player.storage.yuanqi_shuangdun) {
		                            var str=str+'<li><span class=\"lengque\" style=\"color:#C0C0C0\">〖双盾〗：还剩 '+player.storage.yuanqi_shuangdun+' 轮</span>';
		                        }
		                        if(player.hasSkill('yuanqi_yuansu')&&player.storage.yuanqi_yuansu) {
		                            var str=str+'<li><span class=\"lengque\" style=\"color:#C0C0C0\">〖元素〗：还剩 '+player.storage.yuanqi_yuansu+' 轮</span>';
		                        }
		                        if(player.hasSkill('yuanqi_qianghua')&&player.storage.yuanqi_qianghua) {
		                            var str=str+'<li><span class=\"lengque\" style=\"color:#C0C0C0\">〖强化〗：还剩 '+player.storage.yuanqi_qianghua+' 轮</span>';
		                        }*/
                                var skillnum = 0;
                                var str = str + '<br>——————<br>天赋加成：';
                                var list = lib.config.yuanqilist;
                                for (var i = 0; i < list.length; i++) {
                                    if (player.hasSkill(list[i])) {
                                        var str = str + '<br>◈' + get.translation(list[i]);
                                        skillnum++;
                                    }
                                }
                                if (skillnum == 0) {
                                    var str = str + '<br>（尚未获得天赋）';
                                }
                                var maxskills = 6;
                                if (player.hasSkill('yuanqi_tubian')) maxskills += 2;
                                var str = str + '<br>——————<br>已获得（' + skillnum + '/' + maxskills + '）';
                                return str;
                            },
                        },
                        popup: false,
                    },
                    "yuanqi_landun": {
                        charlotte: true,
                        subSkill: {
                            detect: {
                                trigger: {
                                    player: "damageBegin",
                                },
                                priority: 25,
                                forced: true,
                                mark: true,
                                marktext: "免伤",
                                intro: {
                                    content: "<li>免疫下一次伤害",
                                },
                                content: function() {
                                    trigger.cancel();
                                    player.removeSkill('yuanqi_landun_detect');
                                },
                                sub: true,
                            },
                        },
                    },
                    "yuanqi_huodun": {
                        charlotte: true,
                        trigger: {
                            player: "damageBegin4",
                        },
                        usable: 1,
                        priority: 25,
                        filter: function(event) {
                            return event.nature == 'fire';
                        },
                        forced: true,
                        content: function() {
                            trigger.num--;
                        },
                        ai: {
                            nofire: true,
                            effect: {
                                target: function(card, player, target, current) {
                                    if (get.tag(card, 'fireDamage')) return 'zerotarget';
                                },
                            },
                        },
                    },
                    "yuanqi_dudun": {
                        charlotte: true,
                        trigger: {
                            player: "loseHpBefore",
                        },
                        usable: 2,
                        priority: 25,
                        filter: function(event) {
                            return event.num > 0;
                        },
                        forced: true,
                        content: function() {
                            //trigger.cancel();
                            trigger.num--;
                        },
                        ai: {
                            nodu: true,
                            effect: {
                                target: function(card, player, target, current) {
                                    if (get.tag(card, 'loseHp')) return 'zerotarget';
                                },
                            },
                        },
                    },
                    "yuanqi_cidun": {
                        charlotte: true,
                        trigger: {
                            player: "damageBegin",
                        },
                        priority: 25,
                        filter: function(event, player) {
                            if (event.source != undefined) {
                                return get.distance(player, event.source) <= 1 && event.card && !['sha', 'juedou'].contains(event.card.name);
                            } else return true;
                        },
                        logTarget: "source",
                        forced: true,
                        content: function() {
                            trigger.cancel();
                        },
                        ai: {
                            effect: {
                                target: function(card, player, target, current) {
                                    if (get.tag(card, 'damage') && card.name != 'sha' && get.distance(target, player) <= 1) return 'zerotarget';
                                },
                            },
                        },
                    },
                    "yuanqi_xuedun": {
                        charlotte: true,
                        init: function(player, skill) {
                            player.gainMaxHp();
                            player.recover();
                            player.update();
                        },
                        onremove: function(player, skill) {
                            if (player.maxHp > 1) {
                                player.loseMaxHp();
                            }
                        },
                    },
                    "yuanqi_hudun": {
                        charlotte: true,
                        init: function(player, skill) {
                            player.storage.zuan_maxhujia++;
                            game.log(player, '增加了一点护盾上限');
                            player.addMark('zuan_hudun', false);
                            player.seeMark('zuan_hudun');
                            game.dyingShow(player, parseFloat(lib.config['extension_祖安设置_newui']));
                            player.update();
                        },
                        onremove: function(player, skill) {
                            player.storage.zuan_maxhujia--;
                            game.log(player, '失去了一点护盾上限');
                            if (player.storage.zuan_maxhujia < player.countMark('zuan_hudun')) {
                                player.removeMark('zuan_hudun', false);
                                game.dyingShow(player, parseFloat(lib.config['extension_祖安设置_newui']));
                            }
                        },
                    },
                    "yuanqi_suidun": {
                        charlotte: true,
                        subSkill: {
                            detect: {
                                trigger: {
                                    player: "damageBegin",
                                },
                                priority: 25,
                                forced: true,
                                content: function() {
                                    trigger.cancel();
                                },
                                sub: true,
                            },
                        },
                    },
                    "yuanqi_zishou": {
                        charlotte: true,
                        trigger: {
                            target: "useCardToTargeted",
                        },
                        priority: 3,
                        forced: true,
                        filter: function(event, player) {
                            return event.card.name == 'sha';
                        },
                        content: function() {
                            "step 0";
                            var eff = get.effect(player, trigger.card, trigger.player, trigger.player);
                            trigger.player.chooseCard('h', '弃置一张手牌，否则【杀】对' + get.translation(player.name) + '无效',
                            function(card) {
                                return true;
                            }).set('ai',
                            function(card) {
                                if (_status.event.eff > 0) {
                                    return 10 - get.value(card);
                                }
                                return 0;
                            }).set('eff', eff);
                            "step 1";
                            if (result.bool == false) {
                                trigger.getParent().excluded.add(player);
                            } else {
                                trigger.player.discard(result.cards);
                            }
                        },
                        ai: {
                            effect: {
                                target: function(card, player, target, current) {
                                    if (card.name == 'sha' && get.attitude(player, target) < 0) {
                                        if (_status.event.name == 'yuanqi_zishou') return;
                                        var bs = player.getCards('h');
                                        if (bs.length < 2) return 0;
                                        if (player.hasSkill('jiu') || player.hasSkill('tianxianjiu')) return;
                                        if (bs.length <= 3 && player.countCards('h', 'sha') <= 1) {
                                            for (var i = 0; i < bs.length; i++) {
                                                if (bs[i].name != 'sha' && get.value(bs[i]) < 7) {
                                                    return [1, 0, 1, -0.5];
                                                }
                                            }
                                            return 0;
                                        }
                                        return [1, 0, 1, -0.5];
                                    }
                                },
                            },
                        },
                    },
                    "yuanqi_yaoshui": {
                        charlotte: true,
                        trigger: {
                            global: "taoBegin",
                        },
                        forced: true,
                        filter: function(event, player) {
                            //if(event.player==player) return true;
                            return event.target.isDying() && event.player == player;
                        },
                        content: function() {
                            trigger.baseDamage++;
                        },
                    },
                    "yuanqi_xilan": {
                        charlotte: true,
                        trigger: {
                            global: "dying",
                        },
                        forced: true,
                        usable: 2,
                        filter: function(event, player) {
                            //return _status.currentPhase==player;
                            return event.player != player;
                        },
                        content: function() {
                            player.draw();
                        },
                    },
                    "yuanqi_xixue": {
                        charlotte: true,
                        trigger: {
                            source: "damageSource",
                        },
                        filter: function(event, player) {
                            return event.num > 0 && player.getDamagedHp() > 0;
                        },
                        forced: true,
                        content: function() {
                            "step 0";
                            event.num = trigger.num;
                            'step 1';
                            event.num--;
                            player.judge(function(card) {
                                if (get.color(card) == 'red' && get.type(card, 'trick') != 'trick') return 2;
                                return - 0.5;
                            });
                            "step 2";
                            if (result.bool) {
                                player.recover();
                            }
                            if (event.num > 0) event.goto(1);
                        },
                    },
                    "yuanqi_xuli": {
                        charlotte: true,
                        trigger: {
                            player: "phaseJieshuBegin",
                        },
                        priority: -1,
                        forced: true,
                        filter: function(event, player) {
                            if (player.getHistory('skipped').contains('phaseUse')) return true;
                            var history = player.getHistory('useCard').concat(player.getHistory('respond'));
                            for (var i = 0; i < history.length; i++) {
                                if (history[i].card.name == 'sha' && history[i].isPhaseUsing()) return false;
                            }
                            return true;
                        },
                        content: function() {
                            player.draw();
                        },
                    },
                    "yuanqi_xiandan": {
                        charlotte: true,
                        mod: {
                            selectTarget: function(card, player, range) {
                                if (range[1] == -1) return;
                                if (card.name == 'sha') range[1] += 1;
                            },
                        },
                    },
                    "yuanqi_miaozhun": {
                        charlotte: true,
                        forced: true,
                        shaRelated: true,
                        trigger: {
                            player: "useCardToPlayered",
                        },
                        priority: 5,
                        check: function(event, player) {
                            return get.attitude(player, event.target) <= 0;
                        },
                        filter: function(event, player) {
                            return event.card.name == 'sha';
                        },
                        logTarget: "target",
                        content: function() {
                            "step 0";
                            player.judge(function(card) {
                                if (get.color(card) == 'black' && get.type(card, 'trick') != 'trick') return 2;
                                return - 0.5;
                            });
                            "step 1";
                            if (result.bool) {
                                trigger.getParent().directHit.add(trigger.target);
                            }
                        },
                        ai: {
                            "directHit_ai": true,
                            skillTagFilter: function(player, tag, arg) {
                                if (get.attitude(player, arg.target) > 0 || arg.card.name != 'sha' || !ui.cardPile.firstChild || get.color(ui.cardPile.firstChild, player) != 'black') return false;
                            },
                        },
                    },
                    "yuanqi_jiguang": {
                        charlotte: true,
                        trigger: {
                            source: "damageBegin",
                        },
                        priority: -50,
                        filter: function(event, player) {
                            if (!event.card) return false;
                            if (! ['sha', 'juedou'].contains(event.card.name)) return false;
                            //if(event.nature&&event.nature!='thunder') return false;
                            return event.num > 0;
                        },
                        forced: true,
                        content: function() {
                            trigger.nature = 'thunder';
                            if (trigger.player.countCards('he')) trigger.player.discard(trigger.player.getCards('he').randomGet());
                            //trigger.player.chooseToDiscard(1,'he',true);
                        },
                    },
                    "yuanqi_fanshe": {
                        charlotte: true,
                        usable: 1,
                        trigger: {
                            player: "shaMiss",
                        },
                        direct: true,
                        filter: function(event, player) {
                            return true;
                            return player.canUse('sha', event.target, false) && (player.hasSha() || _status.connectMode && player.countCards('h'));
                        },
                        content: function() {
                            "step 0";
                            player.chooseTarget(get.prompt2('yuanqi_fanshe'), '为此【杀】指定另外一个目标', 1,
                            function(card, player, target) {
                                return player.canUse(trigger.card, target, false) && trigger.target != target;
                            },
                            function(target) {
                                return - get.attitude(player, target);
                            });
                            'step 1';
                            if (result.bool) {
                                player.useCard(trigger.card, result.targets[0], false);
                            }
                        },
                    },
                    "yuanqi_yuansu": {
                        charlotte: true,
                        trigger: {
                            source: "damageBegin",
                        },
                        usable: 1,
                        filter: function(event, player) {
                            return event.nature && event.num > 0 && !player.storage.yuanqi_yuansu;
                        },
                        forced: true,
                        content: function() {
                            player.storage.yuanqi_yuansu = 2;
                            trigger.num++;
                        },
                    },
                    "yuanqi_chuantou": {
                        charlotte: true,
                        group: "qinggang_skill",
                        ai: {
                            "unequip_ai": true,
                            skillTagFilter: function(player, tag, arg) {
                                if (arg && arg.name == 'sha') return true;
                                return false;
                            },
                        },
                    },
                    "yuanqi_fangyu": {
                        charlotte: true,
                        trigger: {
                            player: ["damageBegin4", "loseHpBegin"],
                        },
                        priority: -25,
                        forced: true,
                        filter: function(event, player) {
                            if (event.num <= 1) return false;
                            return true;
                        },
                        content: function() {
                            trigger.num = 1;
                        },
                        ai: {
                            filterDamage: true,
                        },
                    },
                    "yuanqi_xiudun": {
                        init: function(player, skill) {
                            player.storage.yuanqi_xiudun = 0;
                        },
                        charlotte: true,
                    },
                    "zuan_gaindun": {
                        trigger: {
                            player: "phaseBefore",
                        },
                        priority: 5,
                        silent: true,
                        forced: true,
                        filter: function(event, player) {
                            if (player.hasSkill('jingcheng')) return false;
                            return true;
                        },
                        filter: function(event, player) {
                            var spmod = [2, 3, 4];
                            if (spmod.contains(parseFloat(lib.config['extension_祖安设置_mode']))) {
                                var round = 3;
                            } else {
                                var round = 2;
                            }
                            var skillnum = 0;
                            event.list = lib.config.yuanqilist;
                            for (var i = 0; i < event.list.length; i++) {
                                if (player.hasSkill(event.list[i])) skillnum++;
                            }
                            var maxskills = 6;
                            var choadd = player.hasSkill('yuanqi_xuanze') ? 1 : 0;
                            if (player.hasSkill('yuanqi_tubian')) maxskills += 2;
                            return skillnum < Math.ceil(game.roundNumber / round) + choadd && skillnum < maxskills;
                        },
                        content: function() {
                            'step 0';
                            event.dun = [];
                            event.list = lib.config.yuanqilist;
                            for (var i = 0; i < event.list.length; i++) {
                                if (!player.hasSkill(event.list[i])) event.dun.push(event.list[i]);
                            }
                            var num = 3;
                            if (player.hasSkill('yuanqi_xuanze')) var num = 5;
                            event.skills = event.dun.randomGets(num);
                            var info = '- 请选择一个天赋 -<br><br>';
                            var tips = [];
                            for (var i = 0; i < event.skills.length; i++) {
                                var info = info + '<li>〖' + get.translation(event.skills[i]) + '〗 ' + get.translation(event.skills[i] + '_info');
                                tips.push('<li>〖' + get.translation(event.skills[i]) + '〗 ' + get.translation(event.skills[i] + '_info'));
                            }
                            var info = info + '<br><br><br><br>';
                            /*
					        player.chooseControl().set('prompt','征建：请选择一种效果').set('choiceList',[
					            '令“出牌阶段内未使用过非基本牌”的其他角色受到惩罚',
					            '令“出牌阶段内未获得过牌”的其他角色受到惩罚',
					            ]).set('ai',()=>Math.random()<=0.5?0:1);
					        player.chooseControl(event.skills,function(){
					            return event.skills.randomGet();
					        }).set('prompt',info);
					        */
                            player.chooseControl(event.skills,
                            function() {
                                return event.skills.randomGet();
                            }).set('choiceList', tips);
                            'step 1';
                            player.addSkill(result.control);
                            game.log(player, '获得了<span class=\"zuantext\" style=\"color: rgb(200,250,230)\">天赋〖' + get.translation(result.control) + '〗</span>');
                            player.logSkill(result.control);
                        },
                        popup: false,
                    },
                    "yuanqi_xuanze": {
                        charlotte: true,
                    },
                    "yuanqi_yiwang": {
                        charlotte: true,
                        trigger: {
                            player: "phaseBefore",
                        },
                        priority: -20,
                        forced: true,
                        content: function() {
                            'step 0';
                            event.skills = [];
                            event.list = lib.config.yuanqilist;
                            for (var i = 0; i < event.list.length; i++) {
                                if (player.hasSkill(event.list[i]) && event.list[i] != 'yuanqi_yiwang') event.skills.push(event.list[i]);
                            }
                            if (event.skills.length > 0) {
                                player.chooseControl(event.skills,
                                function() {
                                    return event.skills.randomGet();
                                }).set('prompt', '<li>〖遗忘天赋〗<br>请选择遗忘的天赋<br><br><br><br>');
                            }
                            'step 1';
                            if (result.control) {
                                player.removeSkill(result.control);
                                game.log(player, '遗忘了<span class=\"zuantext\" style=\"color: rgb(200,250,230)\">天赋〖' + get.translation(result.control) + '〗</span>');
                            }
                            player.removeSkill('yuanqi_yiwang');
                        },
                        popup: false,
                    },
                    "yuanqi_shangdian": {
                        charlotte: true,
                        trigger: {
                            player: "phaseDrawBegin2",
                        },
                        priority: 7,
                        forced: true,
                        filter: function(event, player) {
                            return ! event.numFixed;
                        },
                        content: function() {
                            "step 0";
                            player.judge(function(card) {
                                if (get.type(card) == 'basic') return 2;
                                return - 0.5;
                            }).judge2 = function(result) {
                                return result.bool;
                            };
                            "step 1";
                            if (result.bool) {
                                trigger.num++;
                            }
                        },
                    },
                    "yuanqi_bingdun": {
                        charlotte: true,
                        init: function(player, skill) {
                            if (player.isTurnedOver()) player.turnOver();
                            player.disableJudge();
                        },
                        onremove: function(player, skill) {
                            player.enableJudge();
                        },
                        trigger: {
                            player: ["turnOverBefore"],
                        },
                        priority: 20,
                        forced: true,
                        filter: function(event, player) {
                            return ! player.isTurnedOver();
                        },
                        content: function() {
                            trigger.cancel();
                            game.log(player, '取消了翻面');
                        },
                        ai: {
                            noturn: true,
                            effect: {
                                target: function(card, player, target) {
                                    if (get.type(card) == 'delay') return - 1;
                                },
                            },
                        },
                    },
                    "yuanqi_jinzhan": {
                        charlotte: true,
                        mod: {
                            globalFrom: function(from, to, distance) {
                                return distance - 1;
                            },
                        },
                    },
                    "yuanqi_lengque": {
                        charlotte: true,
                        trigger: {
                            player: "phaseBefore",
                        },
                        priority: -20,
                        forced: true,
                        filter: function(event, player) {
                            //if(player.storage.zhuSkill_yuanqi_lengque) return false;
                            return true;
                        },
                        onremove: function(player, skill) {
                            if (player.storage.zhuSkill_yuanqi_lengque) {
                                var list = player.storage.zhuSkill_yuanqi_lengque;
                                player.removeSkill(list);
                            }
                        },
                        content: function() {
                            'step 0';
                            if (player.storage.zhuSkill_yuanqi_lengque) {
                                var list = player.storage.zhuSkill_yuanqi_lengque;
                                player.removeSkill(list);
                            }
                            'step 1';
                            var list = [];
                            var sks = lib.character[player.name][3];
                            if (sks) {
                                for (var i = 0; i < sks.length; i++) {
                                    if (lib.skill[sks[i]] && !lib.skill[sks[i]].juexingji && !lib.skill[sks[i]].limited && !lib.skill[sks[i]].zhuSkill && !lib.skill[sks[i]].charlotte) {
                                        var add = 'yuanqi_lengque_tmp_' + sks[i];
                                        lib.skill[add] = lib.skill[sks[i]];
                                        lib.skill[add].firstDo = true;
                                        lib.skill[add].priority = 999;
                                        lib.translate[add] = lib.translate[sks[i]];
                                        lib.translate[add + '_info'] = '<li>来自〖冷却〗的克隆技能。<br>' + lib.translate[sks[i] + '_info'];
                                        list.push(add);
                                    }
                                }
                                var lists = [list.randomGet()];
                                player.addAdditionalSkill('yuanqi_lengque', lists);
                                player.storage.zhuSkill_yuanqi_lengque = lists;
                                game.broadcastAll(function(lists) {
                                    game.expandSkills(lists);
                                    for (var i of lists) {
                                        var info = lib.skill[i];
                                        if (!info) continue;
                                    }
                                },
                                list);
                            }
                        },
                        /*subSkill:{
		                    used:{
		                        charlotte:true,
		                        sub:true,
		                    },
		                },
		                charlotte:true,
		                init:function (player,skill){
		                    player.storage.yuanqi_lengque_usable=[];
		                    player.storage.yuanqi_lengque_limited=[];
		                    if(!player.storage.yuanqi_lengque_unlimited) player.storage.yuanqi_lengque_unlimited=[];
		                    var skills=player.getSkills(true,false);
		                    for(var i=0;i<skills.length;i++){
		                        var info=get.info(skills[i]);
		                        if(skills[i].indexOf('yuanqi_')!=-1) continue;
		                        if(get.translation(skills[i]+'_info')=='') continue;
		                        if(typeof info.usable=='number'){
		                            player.storage.yuanqi_lengque_usable[skills[i]]=info.usable;
		                            info.usable++;
		                        }
		                        if(info.limited){
		                            if(player.storage.yuanqi_lengque_unlimited.contains(skills[i])) continue;
		                            if(!player.storage[skills[i]]) {
		                                player.storage.yuanqi_lengque_limited.push(skills[i]);
		                            }else {
		                                player.restoreSkill(skills[i]);
		                                player.storage.yuanqi_lengque_unlimited.push(skills[i]);
		                            }
		                        }
		                    }
		                },
		                onremove:function (player,skill){
		                    var usable=player.storage.yuanqi_lengque_usable;
		                    for(var i=0;i<usable.length;i++){
		                        var info=get.info(usable[i]);
		                        info.usable=player.storage.yuanqi_lengque_usable[usable[i]];
		                    }
		                },
		                trigger:{
		                    global:["phaseUseBegin","phaseBefore"],
		                },
		                priority:7,
		                filter:function (event,player){
		                    return !player.hasSkill('yuanqi_lengque_used');
		                },
		                forced:true,
		                content:function (){
		                    'step 0';
		                    player.addTempSkill('yuanqi_lengque_used');
		                    var usable=player.storage.yuanqi_lengque_usable;
		                    var limited=player.storage.yuanqi_lengque_limited;
		                    var skills=player.getSkills(true,false);
		                    //加新的技能进去
		                    for(var i=0;i<skills.length;i++){
		                        var info=get.info(skills[i]);
		                        if(usable.contains(skills[i])) continue;
		                        if(limited.contains(skills[i])) continue;
		                        if(skills[i].indexOf('yuanqi_')!=-1) continue;
		                        if(get.translation(skills[i]+'_info')=='') continue;
		                        if(typeof info.usable=='number'){
		                            player.storage.yuanqi_lengque_usable[skills[i]]=info.usable;
		                        }
		                        if(info.limited){
		                            if(player.storage.yuanqi_lengque_unlimited.contains(skills[i])) continue;
		                            if(!player.storage[skills[i]]) {
		                                player.storage.yuanqi_lengque_limited.push(skills[i]);
		                            }else {
		                                player.restoreSkill(skills[i]);
		                                player.storage.yuanqi_lengque_unlimited.push(skills[i]);
		                            }
		                        }
		                    }
		                    'step 1';
		                    event.usableSkill=player.storage.yuanqi_lengque_usable;
		                    event.limitedSkill=player.storage.yuanqi_lengque_limited;
		                    //event.skills=player.getSkills(true,false);
		                    for(var i=0;i<event.usableSkill.length;i++) {
		                        var skill=event.usableSkill[i];
		                        if(!player.hasSkill(skill)) continue;
		                        var info=get.info(skill);
		                        info.usable=player.storage.yuanqi_lengque_usable[skill]+1;
		                    }
		                    for(var i=0;i<event.limitedSkill.length;i++) {
		                        var skill=event.limitedSkill[i];
		                        //if(!player.hasSkill(skill)) continue;
		                        //alert(player.storage[skill]);
		                        if(player.storage.yuanqi_lengque_unlimited.contains(skill)) continue;
		                        if(player.storage[skill]&&player.storage.yuanqi_lengque_limited.contains(skill)) {
		                            player.restoreSkill(skill);
		                            player.storage.yuanqi_lengque_limited.remove(skill);
		                            player.storage.yuanqi_lengque_unlimited.push(skill);
		                        }
		                    }
		                },*/
                    },
                    "yuanqi_nengliang": {
                        charlotte: true,
                        mod: {
                            maxHandcardBase: function(player, num) {
                                return num + 2;
                            },
                        },
                    },
                    "yuanqi_suji": {
                        charlotte: true,
                        mod: {
                            cardUsable: function(card, player, num) {
                                if (card.name == 'sha') return num + 1;
                            },
                        },
                    },
                    "yuanqi_leidun": {
                        charlotte: true,
                        trigger: {
                            player: "damageBegin4",
                        },
                        usable: 1,
                        priority: 25,
                        filter: function(event) {
                            return event.nature == 'thunder';
                        },
                        forced: true,
                        content: function() {
                            trigger.num--;
                        },
                        ai: {
                            nofire: true,
                            effect: {
                                target: function(card, player, target, current) {
                                    if (get.tag(card, 'thunderDamage')) return 'zerotarget';
                                },
                            },
                        },
                    },
                    "yuanqi_zhenshang": {
                        charlotte: true,
                    },
                    "firedam3": {
                        trigger: {
                            global: ["roundStart"],
                        },
                        forced: true,
                        filter: function(event, player) {
                            if (lib.config['extension_祖安设置_balance']) {
                                return game.countPlayer(function(current) {
                                    return current.canAddJudge('huoshan');
                                }) > 0 && game.countPlayer(function(current) {
                                    return current.hasJudge('huoshan');
                                }) < 1;
                            }
                        },
                        content: function() {
                            'step 0';
                            event.card = game.createCard('huoshan');
                            //player.$gain(event.card);
                            'step 1';
                            event.players = game.filterPlayer(function(current) {
                                return current.canAddJudge('huoshan');
                            });
                            'step 2';
                            var target = event.players.randomGet();
                            player.line(target, 'fire');
                            target.addJudge(event.card);
                        },
                    },
                    "yuanqi_diaoxiang": {
                        charlotte: true,
                        //global:"yuanqi_diaoxiang2",
                        trigger: {
                            player: "phaseBefore",
                        },
                        priority: -19,
                        forced: true,
                        filter: function(event, player) {
                            if (player.storage.zhuSkill_yuanqi_diaoxiang) return false;
                            var mode = get.mode();
                            return true;
                            //return (mode=='identity'||(mode=='versus'&&_status.mode=='four'));
                        },
                        onremove: function(player, skill) {
                            if (player.storage.zhuSkill_yuanqi_diaoxiang) {
                                var list = player.storage.zhuSkill_yuanqi_diaoxiang;
                                player.removeSkill(list);
                            }
                        },
                        content: function() {
                            "step 0";
                            var characterslist = [];
                            var skillslist = [];
                            var lengthslist = [];
                            var characterPack = lib.character;
                            var skillPack = lib.skill;
                            for (var i in characterPack) {
                                if (!characterPack[i]) continue;
                                if (characterPack[i][3].length < 1) continue;
                                if (lib.character[i][4]) {
                                    if (characterPack[i][4].contains('forbidai')) continue;
                                    if (characterPack[i][4].contains('boss')) continue;
                                    if (characterPack[i][4].contains('minskin')) continue;
                                    if (characterPack[i][4].contains('hiddenboss')) continue;
                                }
                                if (get.config('double_character') && lib.config.forbiddouble.contains(i)) continue;
                                var skills = characterPack[i][3];
                                //要ban的技能
                                var banskills = ['sbzhangwu', 'xinfu_tunjun'];
                                for (var a = 0; a < skills.length; a++) {
                                    var info = skillPack[skills[a]];
                                    //是限定技
                                    if (!info.limited) continue;
                                    if (info.charlotte) continue;
                                    if (info.zhuSkill) continue;
                                    //没有这个技能
                                    if (player.hasSkill(skills[a])) continue;
                                    //列表重复
                                    if (skillslist.contains(skills[a])) continue;
                                    //禁止刷到的技能（一般不能释放）
                                    if (banskills.contains(skills[a])) continue;
                                    //跟标记无关
                                    if (info.filter) {
                                        var filter = info.filter.toString();
                                        if (filter.indexOf('countMark') != -1) continue;
                                    }
                                    //添加check使用
                                    if (!info.check) {
                                        if (info.filterCard) {
                                            info.check = function(card) {
                                                return 15 - get.value(card);
                                            };
                                        } else {
                                            info.check = function(event, player) {
                                                return true;
                                            };
                                        }
                                    }
                                    characterslist.push(i);
                                    skillslist.push(skills[a]);
                                    //if(skills[a]=='zhafu') event.zhafu=lengthslist.length;
                                    lengthslist.push(lengthslist.length);
                                }
                                //characters.push(i);
                            }
                            event.characterslist = characterslist;
                            event.skillslist = skillslist;
                            event.lengthslist = lengthslist;
                            "step 1";
                            var luckynum = event.lengthslist.randomGets(4);
                            //luckynum.push(event.zhafu);
                            var tips = [];
                            event.skillpile = {};
                            event.skills = [];
                            for (var i = 0; i < luckynum.length; i++) {
                                var num = luckynum[i];
                                var theskill = event.skillslist[num];
                                event.skills.push(theskill);
                                event.skillpile[theskill] = event.characterslist[num];
                                var str = '<li>〖' + get.translation(theskill) + '〗：' + get.translation(theskill + '_info');
                                tips.push(str);
                            }
                            if (event.skills.length > 0) {
                                player.chooseControl(event.skills,
                                function() {
                                    return event.skills.randomGet();
                                }).set('choiceList', tips).set('prompt', "选择获得一个限定技");
                            } else {
                                player.removeSkill('yuanqi_diaoxiang'); {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            "step 2";
                            if (!player.storage.zhuSkill_yuanqi_diaoxiang) {
                                player.storage.zhuSkill_yuanqi_diaoxiang = [];
                            }
                            var skill = result.control;
                            var character = event.skillpile[result.control];
                            player.storage[skill] = false;
                            var lists = [skill];
                            player.addAdditionalSkill('yuanqi_lengque', lists);
                            player.storage.zhuSkill_yuanqi_diaoxiang = lists;
                            game.broadcastAll(function(lists) {
                                game.expandSkills(lists);
                                for (var i of lists) {
                                    var info = lib.skill[i];
                                    if (!info) continue;
                                }
                            },
                            lists);
                        },
                        popup: false,
                    },
                    "yuanqi_diaoxiang2": {
                        charlotte: true,
                        enable: "phaseUse",
                        filterCard: true,
                        selectCard: [1, Infinity],
                        discard: false,
                        lose: false,
                        delay: 0,
                        filter: function(card, player, target) {
                            var mode = get.mode();
                            if (mode == 'identity' || (mode == 'versus' && _status.mode == 'four')) return false;
                            var num = 0;
                            for (var i = 0; i < game.players.length; i++) {
                                if (game.players[i].hasSkill('yuanqi_diaoxiang')) num++;
                            }
                            if (num == 0) return false;
                            return player.countCards('h') > 0 && (num > 1 || !player.hasSkill('yuanqi_diaoxiang'));
                        },
                        filterTarget: function(card, player, target, skill) {
                            return player != target && target.hasSkill('yuanqi_diaoxiang');
                        },
                        check: function(card) {
                            if (ui.selected.cards.length > 1) return 0;
                            var player = get.owner(card);
                            if (player.needsToDiscard() > 0) {
                                if (ui.selected.cards.length) {
                                    return - 1;
                                }
                                if (player.needsToDiscard() > 0) return 10 - get.value(card);
                                var players = game.players;
                                for (var i = 0; i < players.length; i++) {
                                    if (players[i].hasSkill('yuanqi_diaoxiang') && (player.countCards('h') >= 2 || player.needsToDiscard() > 0) && get.attitude(player, players[i]) >= 1) {
                                        if (get.attitude(player, target) > 0) {
                                            return 9 - get.value(card);
                                        } else {
                                            return - 1;
                                        }
                                    }
                                }
                                if (player.countCards('h') > 2) return 6 - get.value(card);
                                return - 1;
                            }
                            if (player.countCards('h') > 2) return 5 - get.value(card);
                            return - 1;
                        },
                        content: function() {
                            target.gain(cards, player, 'giveAuto');
                        },
                        ai: {
                            order: 1,
                            result: {
                                player: function(player, target) {
                                    if (get.attitude(player, target) <= 0) return - 1;
                                    if (target.countCards('h') <= 1 && player.countCards('h') >= 3) return 5;
                                    if (player.needsToDiscard() > 0) return 4;
                                    return 1;
                                },
                            },
                        },
                    },
                    "yuanqi_taoyi": {
                        charlotte: true,
                        mod: {
                            globalTo: function(from, to, distance) {
                                if (!to.countMark('zuan_hudun')) return distance + 1;
                            },
                        },
                    },
                    "yuanqi_fantan": {
                        charlotte: true,
                        forced: true,
                        trigger: {
                            global: "shaMiss",
                        },
                        priority: -5,
                        filter: function(event, player) {
                            return event.target == player && event.player != player;
                        },
                        check: function(event, player, source) {
                            return get.attitude(player, event.player) < 0;
                        },
                        logTarget: "target",
                        content: function() {
                            player.useCard(trigger.player, trigger.card, {
                                name: 'sha'
                            });
                        },
                    },
                    "yuanqi_xuexiang": {
                        charlotte: true,
                        enable: "chooseToUse",
                        viewAsFilter: function(player) {
                            return player.countCards('hes', {
                                suit: 'heart'
                            }) > 0;
                        },
                        filterCard: function(card) {
                            return get.suit(card) == 'heart';
                        },
                        position: "hes",
                        viewAs: {
                            name: "tao",
                        },
                        prompt: "将一张红桃牌当【桃】使用",
                        check: function(card) {
                            return 15 - get.value(card)
                        },
                        ai: {
                            threaten: 1.5,
                            basic: {
                                order: function(card, player) {
                                    if (player.hasSkillTag('pretao')) return 5;
                                    return 2;
                                },
                                useful: [8, 6.5, 5, 4],
                                value: [8, 6.5, 5, 4],
                            },
                            result: {
                                target: 2,
                                "target_use": function(player, target) {
                                    // if(player==target&&player.hp<=0) return 2;
                                    if (player.hasSkillTag('nokeep', true, null, true)) return 2;
                                    var nd = player.needsToDiscard();
                                    var keep = false;
                                    if (nd <= 0) {
                                        keep = true;
                                    } else if (nd == 1 && target.hp >= 2 && target.countCards('h', 'tao') <= 1) {
                                        keep = true;
                                    }
                                    var mode = get.mode();
                                    if (target.hp >= 2 && keep && target.hasFriend()) {
                                        if (target.hp > 2 || nd == 0) return 0;
                                        if (target.hp == 2) {
                                            if (game.hasPlayer(function(current) {
                                                if (target != current && get.attitude(target, current) >= 3) {
                                                    if (current.hp <= 1) return true;
                                                    if ((mode == 'identity' || mode == 'versus' || mode == 'chess') && current.identity == 'zhu' && current.hp <= 2) return true;
                                                }
                                            })) {
                                                return 0;
                                            }
                                        }
                                    }
                                    if (target.hp < 0 && target != player && target.identity != 'zhu') return 0;
                                    var att = get.attitude(player, target);
                                    if (att < 3 && att >= 0 && player != target) return 0;
                                    var tri = _status.event.getTrigger();
                                    if (mode == 'identity' && player.identity == 'fan' && target.identity == 'fan') {
                                        if (tri && tri.name == 'dying' && tri.source && tri.source.identity == 'fan' && tri.source != target) {
                                            var num = game.countPlayer(function(current) {
                                                if (current.identity == 'fan') {
                                                    return current.countCards('h', 'tao');
                                                }
                                            });
                                            if (num > 1 && player == target) return 2;
                                            return 0;
                                        }
                                    }
                                    if (mode == 'identity' && player.identity == 'zhu' && target.identity == 'nei') {
                                        if (tri && tri.name == 'dying' && tri.source && tri.source.identity == 'zhong') {
                                            return 0;
                                        }
                                    }
                                    if (mode == 'stone' && target.isMin() && player != target && tri && tri.name == 'dying' && player.side == target.side && tri.source != target.getEnemy()) {
                                        return 0;
                                    }
                                    return 2;
                                },
                            },
                            tag: {
                                recover: 1,
                                save: 1,
                            },
                        },
                    },
                    "yuanqi_qianghua": {
                        group: 'yuanqi_qianghua_equip',
                        subSkill: {
                            equip: {
                                trigger: {
                                    player: "loseAfter",
                                    global: ["equipAfter", "addJudgeAfter", "gainAfter", "loseAsyncAfter", "addToExpansionAfter"],
                                },
                                forced: true,
                                filter: function(event, player) {
                                    var evt = event.getl(player);
                                    if (!player.isEmpty(2)) return false;
                                    if (evt && evt.player == player && evt.es && evt.es.length > 0) {
                                        var sumcard = evt.es;
                                        for (var i = 0; i < sumcard.length; i++) {
                                            if (get.subtype(sumcard[i]) == 'equip2' && sumcard[i].name.indexOf('rewrite_') != -1) return true;
                                        }
                                    }
                                    return false;
                                },
                                content: function() {
                                    "step 0";
                                    var evt = trigger.getl(player);
                                    var glcard = evt.es;
                                    event.revivecard = false;
                                    for (var i = 0; i < glcard.length; i++) {
                                        if (get.subtype(glcard[i]) == 'equip2' && glcard[i].name.indexOf('rewrite_') != -1) event.revivecard = glcard[i];
                                    }
                                    //alert(event.revivecard.name);
                                    if (!event.revivecard) {
                                        if (event && event.finish) {
                                            event.finish();
                                        } else {
                                            return;
                                        }
                                    }
                                    "step 1";
                                    var card = event.revivecard;
                                    var bool = (get.position(card) == 'e');
                                    if (card.name.indexOf('rewrite_') != -1) {
                                        game.addVideo('skill', player, ['yuanqi_qianghua', [bool, get.cardInfo(card)]]);
                                        game.broadcastAll(function(card) {
                                            card.init([card.suit, card.number, card.name.slice(8)]);
                                        },
                                        card);
                                        if (bool) {
                                            var info = get.info(card);
                                            if (info.skills) {
                                                for (var i = 0; i < info.skills.length; i++) {
                                                    player.addSkillTrigger(info.skills[i]);
                                                }
                                            }
                                        }
                                    }
                                    player.gain(card);
                                    player.equip(card);
                                },
                                ai: {
                                    noe: true,
                                    reverseEquip: true,
                                    effect: {
                                        target: function(card, player, target, current) {
                                            if (get.type(card) == 'equip' && !get.cardtag(card, 'gifts')) return [1, 3];
                                        },
                                    },
                                },
                                sub: true,
                            },
                        },
                        charlotte: true,
                        position: "e",
                        enable: "phaseUse",
                        filter: function(event, player) {
                            if (player.storage.yuanqi_qianghua) return false;
                            var he = player.getCards('e');
                            for (var i = 0; i < he.length; i++) {
                                if (["bagua", "baiyin", "lanyinjia", "renwang", "tengjia"].contains(he[i].name)) return true;
                            }
                            return false;
                        },
                        filterCard: function(card) {
                            return ["bagua", "baiyin", "lanyinjia", "renwang", "tengjia"].contains(card.name);
                        },
                        usable: 1,
                        selectCard: -1,
                        discard: false,
                        lose: false,
                        delay: false,
                        check: function() {
                            return 1;
                        },
                        content: function() {
                            "step 0";
                            player.showCards(cards);
                            "step 1";
                            var card = cards[0];
                            var bool = (get.position(card) == 'e');
                            if (bool) player.removeEquipTrigger(card);
                            game.addVideo('skill', player, ['yuanqi_qianghua', [bool, get.cardInfo(card)]]);
                            game.broadcastAll(function(card) {
                                card.init([card.suit, card.number, 'rewrite_' + card.name]);
                            },
                            card);
                            if (bool) {
                                var info = get.info(card);
                                if (info.skills) {
                                    for (var i = 0; i < info.skills.length; i++) {
                                        player.addSkillTrigger(info.skills[i]);
                                    }
                                }
                                player.storage.yuanqi_qianghua = 3;
                            }
                        },
                        ai: {
                            basic: {
                                order: 10,
                            },
                            result: {
                                player: 1,
                            },
                        },
                    },
                    "yuanqi_shuangwu": {
                        charlotte: true,
                        trigger: {
                            player: "loseAfter",
                            global: ["equipAfter", "addJudgeAfter", "gainAfter", "loseAsyncAfter"],
                        },
                        forced: true,
                        priority: 7,
                        filter: function(event, player) {
                            var evt = event.getl(player);
                            if (evt && evt.player == player) {
                                if (['useCard'].contains(event.getParent().name)) return false;
                                var sumcard = [];
                                if (evt.es && evt.es.length > 0) {
                                    var sumcard = sumcard.concat(evt.es);
                                }
                                /*if(evt.hs&&evt.hs.length>0) {
							        var sumcard=sumcard.concat(evt.hs);
						        }*/
                                if (sumcard && sumcard.length > 0) {
                                    for (var i = 0; i < sumcard.length; i++) {
                                        if (get.subtype(sumcard[i]) == 'equip1') return true;
                                    }
                                }
                            }
                        },
                        onremove: function(player, skill) {
                            if (player.storage.yuanqi_shuangwu && player.hasSkill(player.storage.yuanqi_shuangwu)) {
                                player.removeSkill(player.storage.yuanqi_shuangwu);
                            }
                        },
                        content: function() {
                            'step 0';
                            if (player.storage.yuanqi_shuangwu && player.hasSkill(player.storage.yuanqi_shuangwu)) {
                                player.removeSkill(player.storage.yuanqi_shuangwu);
                            }
                            event.name = 'none';
                            var evt = trigger.getl(player);
                            var sumcard = [];
                            if (evt.es && evt.es.length > 0) {
                                var sumcard = sumcard.concat(evt.es);
                            }
                            for (var i = 0; i < sumcard.length; i++) {
                                if (get.subtype(sumcard[i]) == 'equip1') event.name = sumcard[i].name + '_skill';
                            }
                            'step 1';
                            if (event.name == 'none') {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                            'step 2';
                            if (!player.hasSkill('event.name')) player.storage.yuanqi_shuangwu = event.name;
                            'step 3';
                            player.addTempSkill(event.name, {
                                player: 'die'
                            });
                        },
                        ai: {
                            noe: true,
                            reverseEquip: true,
                        },
                    },
                    "yuanqi_chongwu": {
                        charlotte: true,
                        forced: true,
                        trigger: {
                            player: "damageBegin",
                        },
                        priority: -35,
                        filter: function(event, player) {
                            return player.countCards('hes',
                            function(card) {
                                return (get.subtype(card) == 'equip3' || get.subtype(card) == 'equip4');
                            }) > 0 && event.num > 0;
                        },
                        content: function() {
                            'step 0';
                            event.cards = player.getCards('hes',
                            function(card) {
                                return (get.subtype(card) == 'equip3' || get.subtype(card) == 'equip4');
                            });
                            'step 1';
                            event.num = Math.min(trigger.num, event.cards.length);
                            player.discard(event.cards.randomGets(event.num));
                            game.log(player, '的坐骑承受了', get.cnNumber(event.num), '点伤害');
                            trigger.num -= event.num;
                        },
                        mod: {
                            canBeDiscarded: function(card) {
                                if (get.position(card) == 'e' && ['equip3', 'equip4'].contains(get.subtype(card))) return false;
                            },
                        },
                        ai: {
                            "maixie_defend": true,
                        },
                    },
                    "yuanqi_guidun": {
                        charlotte: true,
                    },
                    "yuanqi_shixue": {
                        subSkill: {
                            sha: {
                                charlotte: true,
                                shaRelated: true,
                                trigger: {
                                    player: "useCardToPlayered",
                                },
                                filter: function(event, player) {
                                    return event.card.name == 'sha';
                                },
                                mark: true,
                                marktext: "暴击",
                                intro: {
                                    content: "<li>使用【杀】不可被闪避",
                                },
                                priority: 5,
                                forced: true,
                                logTarget: "target",
                                preHidden: true,
                                content: function() {
                                    "step 0";
                                    trigger.getParent().directHit.add(trigger.target);
                                },
                                ai: {
                                    "directHit_ai": true,
                                    skillTagFilter: function(player, tag, arg) {
                                        return true;
                                    },
                                },
                                sub: true,
                            },
                        },
                        charlotte: true,
                        forced: true,
                        priority: -2,
                        preHidden: true,
                        trigger: {
                            player: "damageEnd",
                        },
                        filter: function(event, player) {
                            return true;
                        },
                        content: function() {
                            player.addTempSkill('yuanqi_shixue_sha', {
                                player: ['phaseAfter', 'die']
                            });
                        },
                        ai: {
                            maixie: true,
                            "maixie_hp": true,
                            effect: {
                                target: function(card, player, target) {
                                    if (player.hasSkillTag('jueqing', false, target)) return [1, -1];
                                    if (get.tag(card, 'damage')) return [1, 0.85];
                                },
                            },
                        },
                    },
                    "yuanqi_kuangbao": {
                        charlotte: true,
                        forced: true,
                        priority: -2,
                        trigger: {
                            source: "damageSource",
                        },
                        forced: true,
                        filter: function(event, player) {
                            return event.card && event.card.name == 'sha';
                        },
                        content: function() {
                            player.draw(trigger.num);
                        },
                    },
                    "yuanqi_zhadan": {
                        charlotte: true,
                        forced: true,
                        trigger: {
                            global: "dieAfter",
                        },
                        content: function() {
                            'step 0';
                            player.chooseTarget(get.prompt2('yuanqi_zhadan'), [1, 2], '令至多两名其他角色受到随机一至两点火焰伤害',
                            function(card, player, target) {
                                return player != target;
                            }).set('ai',
                            function(target) {
                                var att = get.attitude(_status.event.player, target);
                                return - att;
                            });
                            'step 1';
                            if (result.bool) {
                                for (var i = 0; i < result.targets.length; i++) {
                                    var target = result.targets[i];
                                    var num = [0, 1, 2].randomGet();
                                    target.damage('fire', num, 'nosource');
                                }
                            }
                        },
                    },
                    "yuanqi_jindun": {
                        charlotte: true,
                        forced: true,
                        trigger: {
                            player: "loseAfter",
                            global: ["equipAfter", "addJudgeAfter", "gainAfter", "loseAsyncAfter", "addToExpansionAfter"],
                        },
                        priority: 4,
                        init: function(player, skill) {
                            var num = Math.min(Math.floor(player.countCards('h') / 2), 3);
                            player.storage.yuanqi_jindun = num;
                            player.storage.zuan_maxhujia += num;
                            if (num > 0) game.log(player, '增加了', get.cnNumber(num) + '点护盾上限');
                        },
                        filter: function(event, player) {
                            var num = Math.min(Math.floor(player.countCards('h') / 2), 3);
                            return num != player.storage.yuanqi_jindun;
                        },
                        onremove: function(player, skill) {
                            var num = 0;
                            player.storage.zuan_maxhujia -= player.storage.yuanqi_jindun;
                            player.storage.yuanqi_jindun = 0;
                            game.log(player, '失去了', get.cnNumber(num) + '点护盾上限');
                            if (player.countMark('zuan_hudun') > player.storage.zuan_maxhujia) {
                                var decrease = player.countMark('zuan_hudun') - player.storage.zuan_maxhujia;
                                player.removeMark('zuan_hudun', decrease, false);
                                game.dyingShow(player, parseFloat(lib.config['extension_祖安设置_newui']));
                            }
                        },
                        content: function() {
                            var num = Math.min(Math.floor(player.countCards('h') / 2), 3);
                            var change = num - player.storage.yuanqi_jindun;
                            player.storage.yuanqi_jindun = num;
                            player.storage.zuan_maxhujia += change;
                            if (change > 0) {
                                game.log(player, '增加了', get.cnNumber(change) + '点护盾上限');
                            } else {
                                game.log(player, '失去了', get.cnNumber( - change) + '点护盾上限');
                            }
                            if (player.countMark('zuan_hudun') > player.storage.zuan_maxhujia) {
                                var decrease = player.countMark('zuan_hudun') - player.storage.zuan_maxhujia;
                                player.removeMark('zuan_hudun', decrease, false);
                                game.dyingShow(player, parseFloat(lib.config['extension_祖安设置_newui']));
                            }
                        },
                    },
                    "yuanqi_yidun": {
                        subSkill: {
                            used: {
                                charlotte: true,
                                sub: true,
                            },
                        },
                        charlotte: true,
                        forced: true,
                        trigger: {
                            player: ["useCard", "respond"],
                        },
                        filter: function(event, player) {
                            if (player.hasSkill('yuanqi_yidun_used')) return false;
                            return event.card.name == 'shan' && player.countMark('zuan_hudun') < player.storage.zuan_maxhujia;
                        },
                        priority: 4,
                        preHidden: true,
                        content: function() {
                            "step 0";
                            player.addMark('zuan_hudun', false);
                            player.seeMark('zuan_hudun');
                            game.dyingShow(player, parseFloat(lib.config['extension_祖安设置_newui']));
                            player.addTempSkill('yuanqi_yidun_used', {
                                player: 'phaseBefore'
                            });
                        },
                        ai: {
                            useShan: true,
                        },
                    },
                    "yuanqi_fazhang": {
                        charlotte: true,
                        mod: {
                            selectTarget: function(card, player, range) {
                                if (range[1] == -1) return;
                                if (get.type(card) == 'trick' && card.name != 'shengdong') range[1] += 1;
                            },
                        },
                    },
                    "yuanqi_xingyun": {
                        charlotte: true,
                        shaRelated: true,
                        forced: true,
                        trigger: {
                            player: "judgeBefore",
                        },
                        forced: true,
                        priority: 4,
                        filter: function(event, player) {
                            return true;
                        },
                        content: function() {
                            "step 0";
                            event.cards = get.cards(3);
                            player.showCards(event.cards, '牌堆顶的三张牌');
                            var cho = 0;
                            event.is = 0;
                            if (get.attitude(player, trigger.player) > 0) {
                                for (var i = 0; i < event.cards.length; i++) {
                                    var val = 1 + trigger.judge(event.cards[i]);
                                    //player.chooseControl('ok').set('dialog',[val,event.cards[i]]);
                                    if (cho < val) {
                                        cho = val;
                                        event.is = i;
                                    }
                                }
                            } else if (get.attitude(player, trigger.player) < 0) {
                                for (var i = 0; i < event.cards.length; i++) {
                                    var val = 1 - trigger.judge(event.cards[i]);
                                    if (cho > val) {
                                        cho = val;
                                        event.is = i;
                                    }
                                }
                            } else {
                                event.is = 0;
                            }
                            //event.finish();
                            "step 1";
                            event.links = event.cards[event.is];
                            //event.cards.remove(event.links);
                            "step 2";
                            //event.cards=[event.links].concat(event.cards);
                            var first = ui.cardPile.firstChild;
                            var cards = event.cards;
                            for (var i = 0; i < cards.length; i++) {
                                if (i != event.is) ui.cardPile.insertBefore(cards[i], first);
                            }
                            "step 3";
                            var first = ui.cardPile.firstChild;
                            ui.cardPile.insertBefore(event.links, first);
                        },
                    },
                    "yuanqi_lianfa": {
                        subSkill: {
                            using: {
                                charlotte: true,
                                sub: true,
                            },
                        },
                        charlotte: true,
                        shaRelated: true,
                        forced: true,
                        trigger: {
                            player: "shaEnd",
                        },
                        filter: function(event, player) {
                            return event.card.name == 'sha' && event.target && event.target.isIn() && (get.distance(player, event.target) > 1 || ![player.previous, player.next].contains(event.target)) && !player.hasSkill('yuanqi_lianfa_using');
                        },
                        priority: 6,
                        logTarget: "target",
                        content: function() {
                            "step 0";
                            player.addTempSkill('yuanqi_lianfa_using');
                            'step 1';
                            player.useCard(trigger.card, trigger.target, false);
                            'step 2';
                            player.removeSkill('yuanqi_lianfa_using');
                        },
                    },
                    "yuanqi_shuangdun": {
                        charlotte: true,
                        init: function(player, skill) {
                            player.storage.yuanqi_shuangdun = 0;
                            player.storage.zuan_maxhujia += 2;
                            game.log(player, '增加了两点护盾上限');
                            //player.addMark('zuan_hudun',false);
                            game.dyingShow(player, parseFloat(lib.config['extension_祖安设置_newui']));
                            player.update();
                        },
                        onremove: function(player, skill) {
                            player.storage.zuan_maxhujia -= 2;
                            game.log(player, '失去了两点护盾上限');
                            if (player.storage.zuan_maxhujia < player.countMark('zuan_hudun')) {
                                player.removeMark('zuan_hudun', player.countMark('zuan_hudun') - player.storage.zuan_maxhujia, false);
                                game.dyingShow(player, parseFloat(lib.config['extension_祖安设置_newui']));
                            }
                        },
                        forced: true,
                        trigger: {
                            player: "damageBegin3",
                        },
                        filter: function(event, player) {
                            if (event.nature) return false;
                            return true;
                        },
                        priority: -6,
                        content: function() {
                            trigger.num++;
                        },
                    },
                    "yuanqi_yisu": {
                        charlotte: true,
                        shaRelated: true,
                        forced: true,
                        trigger: {
                            source: "damageBegin2",
                        },
                        filter: function(event, player) {
                            if (player.storage.yuanqi_yisu) {
                                if (player.storage.yuanqi_yisu == event.card) return false;
                            }
                            return event.card && event.card.name == 'sha' && event.notLink();
                        },
                        priority: 4,
                        logTarget: "target",
                        content: function() {
                            "step 0";
                            player.storage.yuanqi_yisu = trigger.card;
                            player.draw();
                        },
                    },
                    "yuanqi_yizhi": {
                        subSkill: {
                            norec: {
                                charlotte: true,
                                sub: true,
                            },
                        },
                        charlotte: true,
                        trigger: {
                            source: "damageBegin",
                        },
                        priority: -55,
                        filter: function(event, player) {
                            if (!event.card) return false;
                            if (! ['sha'].contains(event.card.name)) return false;
                            return event.num > 0;
                        },
                        forced: true,
                        content: function() {
                            trigger.player.addSkill('yuanqi_yizhi_norec');
                        },
                    },
                    "yuanqi_zengxiao": {
                        charlotte: true,
                        forced: true,
                        trigger: {
                            player: "drawBegin",
                        },
                        filter: function(event, player) {
                            //if(player.storage.yuanqi_zengxiao) return false;
                            if (event.getParent('phaseDraw').player == player) return false;
                            return ! event.numFixed;
                        },
                        usable: 1,
                        priority: 11,
                        content: function() {
                            "step 0";
                            trigger.num++;
                            //player.storage.yuanqi_zengxiao=2;
                        },
                    },
                    "yuanqi_zhiyu": {
                        charlotte: true,
                        trigger: {
                            player: "recoverBegin",
                        },
                        priority: 6,
                        forced: true,
                        filter: function(event, player) {
                            if (player.storage.yuanqi_zhiyu) return false;
                            return player.getHp() <= (player.maxHp * 0.5);
                        },
                        content: function() {
                            trigger.num++;
                            player.storage.yuanqi_zhiyu = 3;
                        },
                    },
                    "yuanqi_tubian": {
                        charlotte: true,
                        mod: {
                            maxHandcardBase: function(player, num) {
                                return num - 1;
                            },
                        },
                        /*init:function (player,skill){
		                    if(player.maxHp>1) {
		                        player.loseMaxHp();
		                        player.update();
		                    }
		                },
		                onremove:function (player,skill){
		                    player.gainMaxHp();
		                },*/
                    },
                    "ssr_qianxun": {
                        priority: 45,
                        audio: "reqianxun",
                        trigger: {
                            target: "useCardToBefore",
                        },
                        filter: function(event, player) {
                            if (player.countCards('h') == 1) return false;
                            if (event.name == 'judge') return false;
                            if (event.targets && event.targets.length > 1) return false;
                            if (event.card && event.player != player) return (get.type(event.card) == 'trick' || get.type(event.card) == 'delay');
                        },
                        content: function() {
                            if (player.countCards('h') > 1) {
                                var num = player.countCards('h') - 1;
                                player.chooseToDiscard('h', num, true);
                            } else {
                                player.draw();
                            }
                        },
                    },
                    "ssr_jueji": {
                        subSkill: {
                            used: {
                                init: function(player) {
                                    player.storage.ssr_jueji_used = 1;
                                },
                                onremove: function(player) {
                                    player.storage.ssr_jueji_used = 0;
                                },
                                sub: true,
                            },
                            draw: {
                                trigger: {
                                    player: ["useCard", "respond"],
                                },
                                silent: true,
                                forced: true,
                                popup: false,
                                filter: function(event, player) {
                                    return event.skill == 'ssr_jueji_backup' || event.skill == 'ssr_jueji_shan' || event.skill == 'ssr_jueji_wuxie';
                                },
                                content: function() {
                                    'step 0';
                                    player.draw();
                                },
                                sub: true,
                            },
                            wuxie: {
                                audio: "relianying",
                                enable: "chooseToUse",
                                prompt: "将最后一张牌当做【无懈可击】使用",
                                viewAsFilter: function(player) {
                                    return ! player.getStorage('ssr_jueji').contains('wuxie') && !player.hasSkill('ssr_jueji_forbid') && player.countCards('h') == 1 && player.storage.ssr_jueji_used < 3;
                                },
                                onuse: function(result, player) {
                                    player.storage.ssr_jueji.add('wuxie');
                                    if (!player.hasSkill('ssr_jueji_used')) {
                                        player.addTempSkill('ssr_jueji_used');
                                    } else {
                                        player.storage.ssr_jueji_used++;
                                    }
                                },
                                filterCard: true,
                                position: "h",
                                selectCard: -1,
                                viewAs: {
                                    name: "wuxie",
                                },
                                ai: {
                                    basic: {
                                        useful: [6, 4],
                                        value: [6, 4],
                                    },
                                    result: {
                                        player: 1,
                                    },
                                    expose: 0.2,
                                },
                                sub: true,
                            },
                            response: {
                                audio: "relianying",
                                trigger: {
                                    player: "chooseToRespondBegin",
                                },
                                filter: function(event, player) {
                                    if (player.storage.ssr_jueji_used >= 3) return false;
                                    if (event.responded) return false;
                                    if (!event.filterCard({
                                        name: 'shan'
                                    }) && !event.filterCard({
                                        name: 'sha'
                                    })) return false;
                                    if (!lib.filter.cardRespondable({
                                        name: 'shan'
                                    },
                                    player, event) && !lib.filter.cardRespondable({
                                        name: 'sha'
                                    },
                                    player, event)) return false;
                                    if (player.countCards('h') != 1) return false;
                                    return true;
                                },
                                direct: true,
                                content: function() {
                                    "step 0";
                                    if (trigger.filterCard({
                                        name: 'shan'
                                    }) && lib.filter.cardRespondable({
                                        name: 'shan'
                                    },
                                    player, trigger)) event.name = 'shan';
                                    else event.name = 'sha';
                                    if (player.getStorage('ssr_jueji').contains(event.name) || player.hasSkill('ssr_jueji_forbid')) {
                                        if (event && event.finish) {
                                            event.finish();
                                        } else {
                                            return;
                                        }
                                    }
                                    "step 1";
                                    player.chooseCard('绝计：将最后一张手牌当做【' + get.translation(event.name) + '】打出');
                                    "step 2";
                                    if (result.bool) {
                                        event.card = result.cards[0];
                                        player.lose(event.card, ui.special);
                                        trigger.untrigger();
                                        trigger.responded = true;
                                        trigger.result = {
                                            bool: true,
                                            card: {
                                                name: event.name
                                            },
                                            cards: [event.card],
                                            noanimate: true
                                        };
                                        player.storage.ssr_jueji.add(event.name);
                                        player.draw();
                                    }
                                    if (!player.hasSkill('ssr_jueji_used')) {
                                        player.addTempSkill('ssr_jueji_used');
                                    } else {
                                        player.storage.ssr_jueji_used++;
                                    }
                                },
                                ai: {
                                    order: 11,
                                    useful: -1,
                                    value: -1,
                                },
                            },
                            shan: {
                                audio: "relianying",
                                prompt: "将最后一张牌当做【闪】使用",
                                enable: "chooseToUse",
                                filter: function(event, player) {
                                    return ! player.getStorage('ssr_jueji').contains('shan') && !player.hasSkill('ssr_jueji_forbid') && player.countCards('h') == 1 && player.storage.ssr_jueji_used < 3; //&&!_status.dying.length;
                                },
                                onuse: function(result, player) {
                                    player.storage.ssr_jueji.add('shan');
                                    if (!player.hasSkill('ssr_jueji_used')) {
                                        player.addTempSkill('ssr_jueji_used');
                                    } else {
                                        player.storage.ssr_jueji_used++;
                                    }
                                },
                                filterCard: true,
                                position: 'h',
                                selectCard: -1,
                                viewAs: {
                                    name: "shan",
                                },
                                ai: {
                                    skillTagFilter: function(player) {
                                        return player.countCards('hes') && !player.getStorage('taoluan').contains('shan') && !player.hasSkill('taoluan3');
                                    },
                                    threaten: 1.5,
                                    respondShan: true,
                                    order: 11,
                                    basic: {
                                        useful: [7, 2],
                                        value: [7, 2],
                                    },
                                    result: {
                                        player: 1,
                                    },
                                },
                                sub: true,
                            },
                            backup: {
                                sub: true,
                            },
                            forbid: {
                                sub: true,
                            },
                            clear: {
                                trigger: {
                                    player: ["phaseBefore", "phaseEnd"],
                                },
                                forced: true,
                                silent: true,
                                content: function() {
                                    player.storage.ssr_jueji = [];
                                },
                                sub: true,
                                popup: false,
                            },
                        },
                        group: ["ssr_jueji_shan", "ssr_jueji_wuxie", "ssr_jueji_response", "ssr_jueji_draw", "ssr_jueji_clear"],
                        audio: "relianying",
                        enable: "chooseToUse",
                        filter: function(event, player) {
                            return event.type != 'wuxie' && event.type != 'respondShan' && !player.hasSkill('ssr_jueji_forbid') && player.countCards('h') == 1 && player.storage.ssr_jueji_used < 3; //&&!_status.dying.length;
                        },
                        hiddenCard: function(player, name) {
                            return (!player.getStorage('ssr_jueji').contains(name) && player.countCards('h') == 1 && !player.hasSkill('ssr_jueji_forbid') && lib.inpile.contains(name));
                        },
                        init: function(player) {
                            lib.translate['ssr_jueji_wuxie'] = '绝破';
                            lib.translate['ssr_jueji_shan'] = '绝避';
                            if (!player.storage.ssr_jueji) player.storage.ssr_jueji = [];
                            player.storage.ssr_jueji_used = 0;
                        },
                        onremove: true,
                        chooseButton: {
                            dialog: function(event, player) {
                                var list = [];
                                for (var i = 0; i < lib.inpile.length; i++) {
                                    var name = lib.inpile[i];
                                    if (player.storage.ssr_jueji && player.storage.ssr_jueji.contains(name)) continue;
                                    if (name == 'sha') {
                                        list.push(['基本', '', 'sha']);
                                        list.push(['基本', '', 'sha', 'fire']);
                                        list.push(['基本', '', 'sha', 'thunder']);
                                        list.push(['基本', '', 'sha', 'ice']);
                                    } else if (get.type(name) == 'trick') list.push(['锦囊', '', name]);
                                    else if (get.type(name) == 'basic') list.push(['基本', '', name]);
                                }
                                if (list.length == 0) {
                                    return ui.create.dialog('〖绝计〗已无可用牌');
                                }
                                return ui.create.dialog('绝计', [list, 'vcard']);
                            },
                            filter: function(button, player) {
                                return _status.event.getParent().filterCard({
                                    name: button.link[2]
                                },
                                player, _status.event.getParent());
                            },
                            check: function(button) {
                                var player = _status.event.player;
                                //var player=get.owner(card);
                                if (button.link[2] == 'tao' && game.countPlayer(function(current) {
                                    return current.isDying();
                                })) {
                                    var target = game.filterPlayer(function(current) {
                                        return current.isDying();
                                    })[0];
                                    //alert(get.effect(target,{name:'tao'},player,player));
                                    return get.effect(target, {
                                        name: 'tao'
                                    },
                                    player, player);
                                }
                                //if(player.countCards('h',button.link[2])==1) return 0;
                                if (button.link[2] == 'wugu') return 0;
                                var effect = player.getUseValue(button.link[2]);
                                if (effect > 0) return effect;
                                return 0;
                            },
                            backup: function(links, player) {
                                return {
                                    filterCard: true,
                                    audio: 'relianying',
                                    selectCard: -1,
                                    popname: true,
                                    check: function(card) {
                                        return 11 - get.value(card);
                                    },
                                    position: 'h',
                                    viewAs: {
                                        name: links[0][2],
                                        nature: links[0][3]
                                    },
                                    onuse: function(result, player) {
                                        player.storage.ssr_jueji.add(result.card.name);
                                        if (!player.hasSkill('ssr_jueji_used')) {
                                            player.addTempSkill('ssr_jueji_used');
                                        } else {
                                            player.storage.ssr_jueji_used++;
                                        }
                                    },
                                }
                            },
                            prompt: function(links, player) {
                                return '将最后一张牌当做【' + (get.translation(links[0][3]) || '') + get.translation(links[0][2]) + '】使用';
                            },
                        },
                        ai: {
                            skillTagFilter: function(player) {
                                if (player.countCards('h') != 1 || player.hasSkill('ssr_jueji_forbid')) return false;
                                if (!player.storage.ssr_jueji.contains('tao')) {} else if (player.isDying() && !player.storage.ssr_jueji.contains('jiu')) {} else return false;
                            },
                            order: 11,
                            result: {
                                player: function(player) {
                                    var allshown = true,
                                    players = game.filterPlayer();
                                    for (var i = 0; i < players.length; i++) {
                                        if (players[i].ai.shown == 0) {
                                            allshown = false;
                                        }
                                        if (players[i] != player && players[i].countCards('h') && get.attitude(player, players[i]) > 0) {
                                            return 1;
                                        }
                                    }
                                    if (allshown) return 1;
                                    return 0;
                                },
                            },
                            threaten: 1.3,
                        },
                    },
                    "ssr_jianye": {
                        group: ['ssr_jianye_draw', 'ssr_jianye_discard'],
                        subSkill: {
                            draw: {
                                trigger: {
                                    global: "gainAfter",
                                },
                                silent: true,
                                forced: true,
                                priority: 3,
                                direct: true,
                                preHidden: true,
                                filter: function(event, player) {
                                    if (!player.isPhaseUsing()) return false;
                                    return event.getParent().name == 'draw' && !event.player.hasSkill('ssr_jianye_final') && event.getParent(2).name != 'ssr_jianye';
                                },
                                content: function() {
                                    event.target = trigger.player;
                                    event.cards = trigger.cards;
                                    if (event.cards.length >= 2 || event.target.hasSkill('ssr_jianye_temp')) {
                                        event.target.addTempSkill('ssr_jianye_final', {
                                            global: 'phaseUseAfter'
                                        });
                                        if (event.target.hasSkill('ssr_jianye_temp')) event.target.removeSkill('ssr_jianye_temp');
                                    } else {
                                        event.target.addTempSkill('ssr_jianye_temp', {
                                            global: 'phaseUseAfter'
                                        });
                                    }
                                },
                                sub: true,
                            },
                            discard: {
                                trigger: {
                                    global: ["loseAfter", "loseAsyncAfter"],
                                },
                                silent: true,
                                forced: true,
                                priority: 3,
                                direct: true,
                                preHidden: true,
                                filter: function(event, player) {
                                    var target = event.player;
                                    if (!target || !target.isIn() || event.type != 'discard' || !player.isPhaseUsing() || target.hasSkill('ssr_jianye_final') || !event.cards) return false;
                                    //if(target==player) return false;
                                    //var evt=event.getl(target);
                                    /*for(var i of evt.hes){
							            if(get.position(i,true)=='d') return true;
							        }*/
                                    for (var i = 0; i < event.cards.length; i++) {
                                        if (['h', 'e'].contains(event.cards[i].original)) return true;
                                    }
                                    return false;
                                },
                                content: function() {
                                    'step 0';
                                    event.target = trigger.player;
                                    event.cards = [];
                                    for (var i = 0; i < trigger.cards.length; i++) {
                                        if (['h', 'e'].contains(trigger.cards[i].original)) event.cards.push(trigger.cards[i]);
                                    }
                                    //event.cards=trigger.getl(event.target).hes.filterInD('d');
                                    if (event.cards.length >= 2 || event.target.hasSkill('ssr_jianye_temp')) {
                                        event.target.addTempSkill('ssr_jianye_final', {
                                            global: 'phaseUseAfter'
                                        });
                                        if (event.target.hasSkill('ssr_jianye_temp')) event.target.removeSkill('ssr_jianye_temp');
                                    } else {
                                        event.target.addTempSkill('ssr_jianye_temp', {
                                            global: 'phaseUseAfter'
                                        });
                                    }
                                },
                                sub: true,
                            },
                            final: {
                                charlotte: true,
                                mark: true,
                                marktext: '统业',
                                intro: {
                                    name: "大吴霸业",
                                    content: function(storage, player, skill) {
                                        return "<li>场上存在" + game.countPlayer(function(current) {
                                            return current.hasSkill('ssr_jianye_final');
                                        }) + "枚“统业”标记";
                                    },
                                },
                                sub: true,
                            },
                            temp: {
                                charlotte: true,
                                sub: true,
                            },
                        },
                        trigger: {
                            player: "phaseUseEnd",
                        },
                        filter: function(event, player) {
                            return game.countPlayer(function(current) {
                                return current.hasSkill('ssr_jianye_final');
                            }) > 0;
                        },
                        audio: 'sbtongye',
                        forced: true,
                        priority: 12,
                        content: function() {
                            var num = game.countPlayer(function(current) {
                                if (!current.hasSkill('ssr_jianye_final')) return false;
                                current.removeSkill('ssr_jianye_final');
                                return true;
                            });
                            player.draw(num);
                        },
                    },
                    "ssr_zhiheng": {
                        subSkill: {
                            forbid: {
                                sub: true,
                            },
                        },
                        filterTarget: function(card, player, target) {
                            return ! target.hasSkill('ssr_zhiheng_forbid');
                        },
                        audio: "rezhiheng",
                        enable: "phaseUse",
                        position: "he",
                        filter: function(event, player) {
                            return player.countCards('he');
                        },
                        filterCard: true,
                        selectCard: [1, Infinity],
                        prompt: "弃置任意张牌并令一名角色摸等量的牌或弃置等量的牌",
                        check: function(card) {
                            return 6 - get.value(card);
                        },
                        content: function() {
                            'step 0';
                            player.chooseControl('摸' + get.cnNumber(cards.length) + '张牌', '弃' + get.cnNumber(cards.length) + '张牌',
                            function() {
                                if (get.attitude(player, target) > 0) return '摸' + get.cnNumber(cards.length) + '张牌';
                                return '弃' + get.cnNumber(cards.length) + '张牌';
                            }).set('prompt', '请选择令' + get.translation(target.name) + '摸牌或弃牌？');
                            'step 1';
                            if (result.control) {
                                if (result.control.indexOf('摸') == 0) {
                                    //target.draw(cards.length);
                                    target.chooseControl('摸' + get.cnNumber(cards.length) + '张牌', '失去体力',
                                    function() {
                                        return '摸' + get.cnNumber(cards.length) + '张牌';
                                    }).set('prompt', '请选择令摸牌或失去体力？');
                                    event.goto(2);
                                } else {
                                    target.chooseToDiscard('he', cards.length).set('ai',
                                    function(card) {
                                        var num = cards.length;
                                        if (num < 2 || (target.hp < 2 && Math.random() < 0.85)) return 9 - get.value(card);
                                        if (target.hp > 2 && num > 2) return 5 - get.value(card);
                                        if ((target.hp == 2 || num == 2) && Math.random() < 0.6) return 6 - get.value(card);
                                        return 8 - get.value(card);
                                    });
                                    event.goto(3);
                                }
                                target.addTempSkill('ssr_zhiheng_forbid');
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            'step 2';
                            if (result.control == '失去体力') {
                                target.loseHp();
                            } else {
                                target.draw(cards.length);
                            } {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                            'step 3';
                            if (!result.bool) {
                                target.loseHp();
                            }
                        },
                        ai: {
                            order: 1,
                            result: {
                                target: function(player, target) {
                                    if (player == target) return 2.5;
                                    if (get.attitude(player, target) > 0) {
                                        return 2;
                                    } else {
                                        return - (1.3 + Math.random());
                                    }
                                },
                            },
                            threaten: 1.5,
                        },
                    },
                    "ssr_jiuyuan": {
                        subSkill: {
                            bing: {
                                sub: true,
                                charlotte: true,
                                trigger: {
                                    player: "phaseDrawBegin2",
                                },
                                priority: 8,
                                forced: true,
                                filter: function(event, player) {
                                    return ! event.numFixed;
                                },
                                audio: "rejiuyuan",
                                content: function() {
                                    trigger.num++;
                                    //player.removeSkill('ssr_jiuyuan_bing');
                                },
                                mark: true,
                                marktext: '集兵',
                                intro: {
                                    name: '集结将士',
                                    content: '摸牌阶段你额外摸一张牌，你的手牌上限减一',
                                },
                                mod: {
                                    maxHandcardBase: function(player, num) {
                                        return num - 1;
                                    },
                                },
                            },
                        },
                        audio: "sbjiuyuan",
                        trigger: {
                            target: "useCardToTargeted",
                        },
                        zhuSkill: true,
                        filter: function(event, player) {
                            /*if(player.storage.ssr_jiuyuan_num) {
					            if(player.storage.ssr_jiuyuan_num==game.roundNumber) return false;
					        }*/
                            if (!player.hasZhuSkill('ssr_jiuyuan')) return false;
                            if (event.card.name != 'sha') return false;
                            return game.hasPlayer(function(current) {
                                return current != player && current.group == 'wu' && !current.hasSkill('ssr_jiuyuan_bing');
                            });
                        },
                        direct: true,
                        unique: true,
                        content: function() {
                            'step 0';
                            var targets = game.filterPlayer();
                            targets.remove(player);
                            event.targets = targets;
                            event.damages = [];
                            player.storage.ssr_jiuyuan_num = game.roundNumber;
                            'step 1';
                            if (event.targets.length) {
                                var current = event.targets.shift();
                                if (current.group == 'wu' && !current.hasSkill('ssr_jiuyuan_bing')) {
                                    current.chooseBool('救援：是否令' + get.translation(player) + '摸一张牌？').set('ai',
                                    function() {
                                        return get.attitude(_status.event.player, _status.event.target) > 1;
                                    }).set('target', player);
                                    event.current = current;
                                } else {
                                    event.redo();
                                }
                            } else {
                                event.goto(3);
                            }
                            'step 2';
                            if (result.bool) {
                                event.damages.push(event.current);
                                event.current.line(player, 'green');
                                player.logSkill('ssr_jiuyuan', event.current);
                                game.log(event.current, '令', player, '摸一张牌');
                                player.draw();
                                event.current.addTempSkill('ssr_jiuyuan_bing', {
                                    player: 'phaseEnd'
                                });
                            }
                            if (event.targets.length) {
                                event.goto(1);
                            }
                        },
                    },
                    "ssr_fuzhen": {
                        shaRelated: true,
                        audio: "chongzhen1",
                        trigger: {
                            player: "useCardToPlayered",
                        },
                        check: function(event, player) {
                            return get.attitude(player, event.target) <= 0 && (player.getHp() + player.countCards('hes', {
                                suit: 'heart'
                            }) + player.countCards('hs', {
                                name: 'tao',
                                suit: 'diamond'
                            }) > 1);
                        },
                        filter: function(event, player) {
                            return event.card.name == 'sha';
                        },
                        logTarget: "target",
                        content: function() {
                            "step 0";
                            player.loseHp();
                            "step 1";
                            if (!trigger.target.hasSkill('fengyin')) {
                                trigger.target.addTempSkill('fengyin');
                            }
                            "step 2";
                            var target = trigger.target;
                            var num = target.countCards('h', 'shan');
                            target.chooseToDiscard('请弃置一张基本牌，否则不能使用【闪】抵消此【杀】', 'he',
                            function(card) {
                                return get.type(card) == 'basic';
                            }).set('ai',
                            function(card) {
                                var num = _status.event.num;
                                if (num == 0) return 0;
                                if (card.name == 'shan') return num > 1 ? 2 : 0;
                                return 8 - get.value(card);
                            }).set('num', num);
                            "step 3";
                            if (!result.bool) {
                                trigger.getParent().directHit.add(trigger.target);
                            }
                        },
                        ai: {
                            ignoreSkill: true,
                            skillTagFilter: function(player, tag, arg) {
                                if (tag == 'directHit_ai') {
                                    return get.attitude(player, arg.target) <= 0;
                                }
                                if (!arg || arg.isLink || !arg.card || arg.card.name != 'sha') return false;
                                if (!arg.target || get.attitude(player, arg.target) > 0) return false;
                                if (!arg.skill || !lib.skill[arg.skill] || lib.skill[arg.skill].charlotte || get.is.locked(arg.skill) || !arg.target.getSkills(true, false).contains(arg.skill)) return false;
                            },
                            "directHit_ai": true,
                        },
                        mod: {
                            cardUsable: function(card, player, num) {
                                if (card.name == 'sha') return num + 1;
                            },
                        },
                    },
                    'ssr_newlongdan': {
                        mod: {
                            aiValue: function(player, card, num) {
                                if (card.name != 'sha' && card.name != 'shan') return;
                                var geti = function() {
                                    var cards = player.getCards('hs',
                                    function(card) {
                                        return card.name == 'sha' || card.name == 'shan';
                                    });
                                    if (cards.contains(card)) {
                                        return cards.indexOf(card);
                                    }
                                    return cards.length;
                                };
                                return Math.max(num, [7, 5, 5, 3][Math.min(geti(), 3)]);
                            },
                            aiUseful: function() {
                                return lib.skill.ollongdan.mod.aiValue.apply(this, arguments);
                            },
                        },
                        usable: 2,
                        locked: false,
                        audio: 'longdan_sha_re_zhaoyun',
                        hiddenCard: function(player, name) {
                            if (name == 'tao') return player.countCards('hs', 'jiu') > 0;
                            if (name == 'jiu') return player.countCards('hs', 'tao') > 0;
                            return false;
                        },
                        enable: ['chooseToUse', 'chooseToRespond'],
                        position: 'hs',
                        prompt: '将杀当做闪，或将闪当做杀，或将桃当做酒，或将酒当做桃使用或打出',
                        viewAs: function(cards, player) {
                            var name = false;
                            switch (get.name(cards[0], player)) {
                            case 'sha':
                                name = 'shan';
                                break;
                            case 'shan':
                                name = 'sha';
                                break;
                            case 'tao':
                                name = 'jiu';
                                break;
                            case 'jiu':
                                name = 'tao';
                                break;
                            }
                            if (name) return {
                                name: name
                            };
                            return null;
                        },
                        check: function(card) {
                            var player = _status.event.player;
                            if (_status.event.type == 'phase') {
                                var max = 0;
                                var name2;
                                var list = ['sha', 'tao', 'jiu'];
                                var map = {
                                    sha: 'shan',
                                    tao: 'jiu',
                                    jiu: 'tao'
                                }
                                for (var i = 0; i < list.length; i++) {
                                    var name = list[i];
                                    if (player.countCards('hs', map[name]) > (name == 'jiu' ? 1 : 0) && player.getUseValue({
                                        name: name
                                    }) > 0) {
                                        var temp = get.order({
                                            name: name
                                        });
                                        if (temp > max) {
                                            max = temp;
                                            name2 = map[name];
                                        }
                                    }
                                }
                                if (name2 == get.name(card, player)) return 1;
                                return 0;
                            }
                            return 1;
                        },
                        filterCard: function(card, player, event) {
                            event = event || _status.event;
                            var filter = event._backup.filterCard;
                            var name = get.name(card, player);
                            if (name == 'sha' && filter({
                                name: 'shan',
                                cards: [card]
                            },
                            player, event)) return true;
                            if (name == 'shan' && filter({
                                name: 'sha',
                                cards: [card]
                            },
                            player, event)) return true;
                            if (name == 'tao' && filter({
                                name: 'jiu',
                                cards: [card]
                            },
                            player, event)) return true;
                            if (name == 'jiu' && filter({
                                name: 'tao',
                                cards: [card]
                            },
                            player, event)) return true;
                            return false;
                        },
                        filter: function(event, player) {
                            var filter = event.filterCard;
                            if (filter({
                                name: 'sha'
                            },
                            player, event) && player.countCards('hs', 'shan')) return true;
                            if (filter({
                                name: 'shan'
                            },
                            player, event) && player.countCards('hs', 'sha')) return true;
                            if (filter({
                                name: 'tao'
                            },
                            player, event) && player.countCards('hs', 'jiu')) return true;
                            if (filter({
                                name: 'jiu'
                            },
                            player, event) && player.countCards('hs', 'tao')) return true;
                            return false;
                        },
                        ai: {
                            respondSha: true,
                            respondShan: true,
                            skillTagFilter: function(player, tag) {
                                var name;
                                switch (tag) {
                                case 'respondSha':
                                    name = 'shan';
                                    break;
                                case 'respondShan':
                                    name = 'sha';
                                    break;
                                }
                                if (!player.countCards('hs', name)) return false;
                            },
                            order: function(item, player) {
                                if (player && _status.event.type == 'phase') {
                                    var max = 0;
                                    var list = ['sha', 'tao', 'jiu'];
                                    var map = {
                                        sha: 'shan',
                                        tao: 'jiu',
                                        jiu: 'tao'
                                    }
                                    for (var i = 0; i < list.length; i++) {
                                        var name = list[i];
                                        if (player.countCards('hs', map[name]) > (name == 'jiu' ? 1 : 0) && player.getUseValue({
                                            name: name
                                        }) > 0) {
                                            var temp = get.order({
                                                name: name
                                            });
                                            if (temp > max) max = temp;
                                        }
                                    }
                                    if (max > 0) max += 0.3;
                                    return max;
                                }
                                return 4;
                            },
                        },
                    },
                    "ssr_longdan": {
                        group: ["ssr_longdan_ressha", "ssr_longdan_usesha", "ssr_longdan_shan"],
                        subSkill: {
                            shan: {
                                audio: "longdan_shan",
                                trigger: {
                                    player: ["chooseToRespondBefore", "chooseToUseBefore"],
                                },
                                prompt: "龙胆：是否将一枚“龍”标记当作【闪】使用？",
                                filter: function(event, player) {
                                    if (event.responded) return false;
                                    if (player.hasSkill('ssr_longdan_ing')) return false;
                                    if (!event.filterCard({
                                        name: 'shan'
                                    },
                                    player, event)) return false;
                                    return player.countMark('ssr_longdan') > 0;
                                },
                                check: function(event, player) {
                                    if (get.damageEffect(player, event.player, player) >= 0) return false;
                                    return ! player.countCards('h', {
                                        name: 'shan'
                                    });
                                },
                                content: function() {
                                    "step 0";
                                    player.addTempSkill('ssr_longdan_ing');
                                    trigger.result = {
                                        bool: true,
                                        card: {
                                            name: 'shan',
                                            isCard: false
                                        }
                                    };
                                    trigger.responded = true;
                                    trigger.animate = false;
                                    player.removeMark('ssr_longdan');
                                    var target = _status.currentPhase;
                                    if (player.hasSkill('ssr_pozhen')) {
                                        player.logSkill('ssr_pozhen', target);
                                        player.discardPlayerCard('he', target, get.prompt2('ssr_pozhen'), '破阵：弃置' + get.translation(target.name) + '的一张牌');
                                    }
                                    game.delay();
                                    player.removeSkill('ssr_longdan_ing');
                                },
                                ai: {
                                    respondShan: true,
                                    skillTagFilter: function(player) {
                                        if (player.hasSkill('ssr_longdan_ing')) return false;
                                        return player.countMark('ssr_longdan') > 0;
                                    },
                                },
                                sub: true,
                            },
                            usesha: {
                                audio: "longdan_sha",
                                enable: "chooseToUse",
                                prompt: "龙胆：是否将一枚“龍”标记当作【杀】使用？",
                                filter: function(event, player) {
                                    if (event.filterCard && !event.filterCard({
                                        name: 'sha'
                                    },
                                    player, event)) return false;
                                    if (player.hasSkill('ssr_longdan_ing')) return false;
                                    if (!lib.filter.cardUsable({
                                        name: 'sha'
                                    },
                                    player)) return false;
                                    return player.countMark('ssr_longdan') > 0;
                                },
                                filterTarget: function(card, player, target) {
                                    if (_status.event._backup && typeof _status.event._backup.filterTarget == 'function' && !_status.event._backup.filterTarget({
                                        name: 'sha'
                                    },
                                    player, target)) {
                                        return false;
                                    }
                                    return player.canUse({
                                        name: 'sha'
                                    },
                                    target);
                                },
                                content: function() {
                                    "step 0";
                                    player.addTempSkill('ssr_longdan_ing');
                                    player.useCard({
                                        name: 'sha',
                                        isCard: false
                                    },
                                    target).animate = false;
                                    player.removeMark('ssr_longdan');
                                    if (player.hasSkill('ssr_pozhen')) {
                                        player.logSkill('ssr_pozhen', target);
                                        player.discardPlayerCard('he', target, get.prompt2('ssr_pozhen'), '破阵：弃置' + get.translation(target.name) + '的一张牌');
                                    }
                                    game.delay();
                                    player.removeSkill('ssr_longdan_ing');
                                },
                                ai: {
                                    respondSha: true,
                                    result: {
                                        target: function(player, target) {
                                            if (player.hasSkill('ssr_longdan_ing')) return 0;
                                            return get.effect(target, {
                                                name: 'sha'
                                            },
                                            player, target);
                                        },
                                    },
                                    order: function() {
                                        return 1;
                                    },
                                },
                                sub: true,
                            },
                            ressha: {
                                audio: "longdan_sha",
                                trigger: {
                                    player: "chooseToRespondBegin",
                                },
                                check: function(event, player) {
                                    if (event.ssr_longdan_sha) return false;
                                    return ! player.countCards('h', {
                                        name: 'sha'
                                    });
                                },
                                filter: function(event, player) {
                                    if (!event.filterCard({
                                        name: 'sha'
                                    },
                                    player, event)) return false;
                                    if (event.responded) return false;
                                    if (player.hasSkill('ssr_longdan_ing')) return false;
                                    return player.countMark('ssr_longdan') > 0;
                                },
                                prompt: "龙胆：是否将一枚“龍”标记当作【杀】打出？",
                                content: function() {
                                    "step 0";
                                    player.addTempSkill('ssr_longdan_ing');
                                    trigger.result = {
                                        bool: true,
                                        card: {
                                            name: 'sha',
                                            isCard: false
                                        }
                                    };
                                    trigger.responded = true;
                                    trigger.animate = false;
                                    player.removeMark('ssr_longdan');
                                    game.delay();
                                    var target = _status.currentPhase;
                                    if (player.hasSkill('ssr_pozhen')) player.discardPlayerCard('he', target, get.prompt2('ssr_pozhen'), '破阵：弃置' + get.translation(target.name) + '的一张牌');
                                    player.removeSkill('ssr_longdan_ing');
                                },
                                sub: true,
                            },
                            ing: {
                                sub: true,
                            },
                        },
                        audio: "longdan_sha",
                        marktext: "龍",
                        unique: true,
                        trigger: {
                            player: ["useCard", "respond", "enterGame", "phaseAfter", "phaseBegin"],
                            global: "gameDrawAfter",
                        },
                        priority: -8,
                        forced: true,
                        filter: function(event, player) {
                            if (player.hasSkill('ssr_longdan_ing')) return false;
                            if (event.name == 'useCard' || event.name == 'respond') {
                                //return _status.currentPhase!=player&&event.card.isCard;
                                //return get.type(event.card)=='basic'&&event.card.isCard;
                                return get.type(event.card, 'trick') == 'trick' && event.card.isCard;
                            } else {
                                if (player.countMark('ssr_longdan') >= 7) return false;
                                return ! player.storage.ssr_longdan_mark;
                            }
                        },
                        content: function() {
                            player.storage.ssr_longdan_mark = true;
                            player.addMark('ssr_longdan', (trigger.name == 'useCard' || trigger.name == 'respond') ? 1 : 2);
                        },
                        intro: {
                            name: "龙威虎胆",
                            content: "mark",
                        },
                    },
                    "ssr_newpozhen": {
                        audio: 'sbjizhu',
                        trigger: {
                            player: ["useCard", "respond"],
                        },
                        priority: 5,
                        frequent: true,
                        preHidden: true,
                        silent: true,
                        filter: function(event) {
                            return (get.type(event.card) == 'basic');
                        },
                        content: function() {
                            if (trigger.card.isCard) {
                                player.addTempSkill('ssr_newpozhen_zhanyi', {
                                    player: 'phaseBefore'
                                });
                            } else {
                                player.addTempSkill('ssr_newpozhen_chongzhen', {
                                    player: 'phaseBefore'
                                });
                            }
                        },
                        ai: {
                            threaten: 1.6,
                            noautowuxie: true,
                        },
                        subSkill: {
                            zhanyi: {
                                audio: "new_yajiao",
                                mark: true,
                                marktext: '战意',
                                intro: {
                                    name: "斩敌破阵",
                                    content: "锁定技，当你使用【杀】指定或成为【杀】的目标后，你令此牌需要弃置一张基本牌才能响应或生效",
                                },
                                trigger: {
                                    target: "useCardToTargeted",
                                    player: "useCardToPlayered",
                                },
                                forced: true,
                                preHidden: true,
                                priority: 9,
                                filter: function(event, player) {
                                    return event.card.name == 'sha' && event.player != event.target;
                                },
                                content: function() {
                                    "step 0";
                                    if (trigger.player == player) {
                                        event.goto(3);
                                    } else {
                                        event.goto(1);
                                    }
                                    "step 1";
                                    var eff = get.effect(trigger.target, trigger.card, trigger.player, trigger.player);
                                    trigger.player.chooseToDiscard('战意：弃置一张基本牌，否则【杀】对' + get.translation(player.name) + '无效',
                                    function(card) {
                                        return get.type(card) == 'basic';
                                    }).set('ai',
                                    function(card) {
                                        if (_status.event.eff > 0) {
                                            return 10 - get.value(card);
                                        }
                                        return 0;
                                    }).set('eff', eff);
                                    "step 2";
                                    if (result.bool == false) {
                                        trigger.getParent().excluded.add(player);
                                    } {
                                        if (event && event.finish) {
                                            event.finish();
                                        } else {
                                            return;
                                        }
                                    }
                                    "step 3";
                                    var target = trigger.target;
                                    var num = target.countCards('h', 'shan');
                                    target.chooseToDiscard('战意：弃置一张基本牌，否则不能使用【闪】抵消此【杀】',
                                    function(card) {
                                        return get.type(card) == 'basic';
                                    }).set('ai',
                                    function(card) {
                                        var num = _status.event.num;
                                        if (num == 0) return 0;
                                        if (card.name == 'shan') return num > 1 ? 2 : 0;
                                        return 10 - get.value(card);
                                    }).set('num', num);
                                    "step 4";
                                    if (!result.bool) {
                                        trigger.getParent().directHit.add(trigger.target);
                                    } {
                                        if (event && event.finish) {
                                            event.finish();
                                        } else {
                                            return;
                                        }
                                    }
                                },
                                ai: {
                                    skillTagFilter: function(player, tag, arg) {
                                        if (tag == 'directHit_ai') {
                                            return get.attitude(player, arg.target) <= 0;
                                        }
                                        if (!arg || arg.isLink || !arg.card || arg.card.name != 'sha') return false;
                                        if (!arg.target || get.attitude(player, arg.target) >= 0) return false;
                                        if (!arg.skill || !lib.skill[arg.skill] || lib.skill[arg.skill].charlotte || get.is.locked(arg.skill) || !arg.target.getSkills(true, false).contains(arg.skill)) return false;
                                    },
                                    "directHit_ai": true,
                                    effect: {
                                        target: function(card, player, target, current) {
                                            if (card.name == 'sha' && get.attitude(player, target) < 0) {
                                                var bs = player.getCards('h', {
                                                    type: 'basic'
                                                });
                                                if (bs.length < 2) return 0;
                                                if (player.hasSkill('jiu') || player.hasSkill('tianxianjiu')) return;
                                                if (bs.length <= 3 && player.countCards('h', 'sha') <= 1) {
                                                    for (var i = 0; i < bs.length; i++) {
                                                        if (bs[i].name != 'sha' && get.value(bs[i]) < 7) {
                                                            return [1, 0, 1, -0.5];
                                                        }
                                                    }
                                                    return 0;
                                                }
                                                return [1, 0, 1, -0.5];
                                            }
                                        },
                                    },
                                },
                                sub: true,
                                mod: {
                                    maxHandcardBase: function(player, num) {
                                        return num - 1;
                                    },
                                    globalFrom: function(from, to, distance) {
                                        return distance - 1;
                                    },
                                },
                            },
                            chongzhen: {
                                mark: true,
                                marktext: '冲锋',
                                intro: {
                                    name: "斩敌破阵",
                                    content: "当你使用或打出【杀】或【闪】时，你可以获得对方的一张手牌。",
                                },
                                group: ["ssr_newpozhen_chongzhen1", "ssr_newpozhen_chongzhen2"],
                                audio: "chongzhen1",
                                ai: {
                                    combo: "ollongdan",
                                    mingzhi: false,
                                    effect: {
                                        target: function(card, player, target, current) {
                                            if (get.tag(card, 'respondShan') || get.tag(card, 'respondSha')) {
                                                if (get.attitude(target, player) <= 0) {
                                                    if (current > 0) return;
                                                    if (target.countCards('h') == 0) return 1.6;
                                                    if (target.countCards('h') == 1) return 1.2;
                                                    if (target.countCards('h') == 2) return [0.8, 0.2, 0, -0.2];
                                                    return [0.4, 0.7, 0, -0.7];
                                                }
                                            }
                                        },
                                    },
                                },
                                sub: true,
                                mod: {
                                    maxHandcardBase: function(player, num) {
                                        return num - 1;
                                    },
                                    globalFrom: function(from, to, distance) {
                                        return distance - 1;
                                    },
                                },
                            },
                            chongzhen1: {
                                audio: 'chongzhen1',
                                trigger: {
                                    player: "useCard",
                                },
                                filter: function(event, player) {
                                    if (event.card.name != 'sha' && event.card.name != 'shan') return false;
                                    var target = lib.skill.ssr_newpozhen_chongzhen1.logTarget(event, player);
                                    return target && target.countGainableCards(player, 'h') > 0;
                                },
                                logTarget: function(event, player) {
                                    if (event.card.name == 'sha') return event.targets[0];
                                    return event.respondTo[0];
                                },
                                "prompt2": "当你使用或打出【杀】或【闪】时，你可以获得对方的一张手牌。",
                                content: function() {
                                    var target = lib.skill.ssr_newpozhen_chongzhen1.logTarget(trigger, player);
                                    player.gainPlayerCard(target, 'h', true);
                                },
                                priority: 10,
                                sub: true,
                            },
                            chongzhen2: {
                                audio: 'chongzhen2',
                                trigger: {
                                    player: "respond",
                                },
                                filter: function(event, player) {
                                    if (event.card.name != 'sha' && event.card.name != 'shan') return false;
                                    return event.source && event.source.countGainableCards(player, 'h') > 0;
                                },
                                logTarget: "source",
                                "prompt2": "当你使用或打出【杀】或【闪】时，你可以获得对方的一张手牌。",
                                content: function() {
                                    player.gainPlayerCard(trigger.source, 'h', true);
                                },
                                priority: 10,
                                sub: true,
                            },
                        },
                    },
                    "ssr_pozhen": {
                        audio: "chongzhen1",
                        ai: {
                            combo: "ssr_longdan",
                            mingzhi: false,
                            effect: {
                                target: function(card, player, target, current) {
                                    if (get.tag(card, 'respondShan') || get.tag(card, 'respondSha')) {
                                        if (get.attitude(target, player) <= 0) {
                                            if (current > 0) return;
                                            if (target.countCards('h') == 0) return 1.6;
                                            if (target.countCards('h') == 1) return 1.2;
                                            if (target.countCards('h') == 2) return [0.8, 0.2, 0, -0.2];
                                            return [0.4, 0.7, 0, -0.7];
                                        }
                                    }
                                },
                            },
                        },
                    },
                    "ssr_jilei": {
                        trigger: {
                            player: "phaseZhunbeiBegin",
                        },
                        audio: 'xinleiji',
                        skillAnimation: true,
                        animationColor: "thunder",
                        filter: function(event, player) {
                            return ! player.storage.ssr_jilei && player.canAddJudge({
                                name: 'shandian'
                            });
                        },
                        intro: {
                            content: "limited",
                        },
                        mark: true,
                        unique: true,
                        limited: true,
                        content: function() {
                            "step 0";
                            player.awakenSkill('ssr_jilei');
                            player.addJudge(game.createCard({
                                name: 'shandian',
                                number: 9,
                                suit: 'spade'
                            }));
                        },
                        init: (player, skill) =>player.storage[skill] = false,
                        "_priority": 0,
                    },
                    "ssr_tianxing": {
                        audio: "guanxing",
                        trigger: {
                            global: "judge",
                        },
                        filter: function(event, player) {
                            if (_status.currentPhase != player && event.player != player) return false;
                            return player.countCards('hes') > 0;
                        },
                        direct: true,
                        content: function() {
                            "step 0";
                            player.chooseCard(get.translation(trigger.player) + '的' + (trigger.judgestr || '') + '判定为' + get.translation(trigger.player.judging[0]) + '，' + get.prompt('ssr_tianxing'), 'hes',
                            function(card) {
                                var player = _status.event.player;
                                var mod2 = game.checkMod(card, player, 'unchanged', 'cardEnabled2', player);
                                if (mod2 != 'unchanged') return mod2;
                                var mod = game.checkMod(card, player, 'unchanged', 'cardRespondable', player);
                                if (mod != 'unchanged') return mod;
                                return true;
                            }).set('ai',
                            function(card) {
                                var trigger = _status.event.getTrigger();
                                var player = _status.event.player;
                                var judging = _status.event.judging;
                                var result = trigger.judge(card) - trigger.judge(judging);
                                var attitude = get.attitude(player, trigger.player);
                                if (attitude == 0 || result == 0) return 0;
                                if (attitude > 0) {
                                    return result;
                                } else {
                                    return - result;
                                }
                            }).set('judging', trigger.player.judging[0]);
                            "step 1";
                            if (result.bool) {
                                player.respond(result.cards, 'highlight', 'ssr_tianxing', 'noOrdering');
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            "step 2";
                            if (result.bool) {
                                player.$gain2(trigger.player.judging[0]);
                                player.gain(trigger.player.judging[0]);
                                trigger.player.judging[0] = result.cards[0];
                                trigger.orderingCards.addArray(result.cards);
                                game.log(trigger.player, '的判定牌改为', result.cards[0]);
                            }
                            "step 3";
                            game.delay(2);
                        },
                        ai: {
                            rejudge: true,
                            tag: {
                                rejudge: 1,
                            },
                        },
                    },
                    "ssr_tianxing_old": {
                        audio: "guanxing",
                        trigger: {
                            player: "phaseBegin",
                        },
                        direct: true,
                        priority: 1,
                        unique: true,
                        content: function() {
                            "step 0";
                            event.cards = get.cards(7);
                            player.chooseCardButton(true, event.cards, '观星：选择并获得一张牌').ai = function(button) {
                                return get.value(button.link);
                            };
                            "step 1";
                            if (!result.bool) {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                                return;
                            }
                            player.logSkill('ssr_tianxing', trigger.player);
                            var card = result.links[0];
                            event.cards.remove(card);
                            if (card) {
                                player.gain(card, 'gain2');
                                game.delay();
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            "step 2";
                            var first = ui.cardPile.firstChild;
                            for (var i = 0; i < event.cards.length; i++) {
                                ui.cardPile.insertBefore(event.cards[i], first);
                            }
                        },
                    },
                    "ssr_kongcheng": {
                        subSkill: {
                            card: {
                                audio: "kongcheng1",
                                trigger: {
                                    player: "loseEnd",
                                },
                                forced: true,
                                firstDo: true,
                                audioname: ["re_zhugeliang"],
                                filter: function(event, player) {
                                    return true;
                                },
                                content: function() {},
                                sub: true,
                            },
                        },
                        mod: {
                            targetEnabled: function(card, player, target, now) {
                                if (target.countCards('h', {
                                    type: 'basic'
                                }) == 0) {
                                    if (get.type(card) == 'basic') return false;
                                }
                                if (target.countCards('h', {
                                    type: 'trick'
                                }) + target.countCards('h', {
                                    type: 'delay'
                                }) == 0) {
                                    if (get.type(card) == 'trick' || get.type(card) == 'delay') return false;
                                }
                                if (target.countCards('h', {
                                    type: 'equip'
                                }) == 0) {
                                    if (get.type(card) == 'equip') return false;
                                }
                            },
                        },
                        group: "ssr_kongcheng_card",
                        audio: "kongcheng1",
                        ai: {
                            noh: true,
                            skillTagFilter: function(player, tag) {
                                if (tag == 'noh') {
                                    if (player.countCards('h') != 1) return false;
                                }
                            },
                        },
                    },
                    "ssr_tuxi": {
                        subSkill: {
                            kill: {
                                trigger: {
                                    source: "dieAfter",
                                },
                                audio: "retuxi",
                                forced: true,
                                priority: 6,
                                content: function() {
                                    player.addMark('ssr_tuxi');
                                },
                                sub: true,
                            },
                        },
                        group: 'ssr_tuxi_kill',
                        skillAnimation: true,
                        animationColor: "thunder",
                        direct: true,
                        //mark:true,
                        marktext: "袭",
                        init: function(player) {
                            if (!player.storage.ssr_tuxi && player.countMark('ssr_tuxi') <= 0) {
                                player.addMark('ssr_tuxi', 2);
                                player.markSkill('ssr_tuxi');
                            }
                            if (player.countMark('ssr_tuxi') > 0) player.markSkill('ssr_tuxi');
                        },
                        intro: {
                            name: "袭",
                            content: "mark",
                        },
                        audio: "retuxi",
                        trigger: {
                            player: "phaseDrawBegin2",
                        },
                        filter: function(event, player) {
                            return player.countMark('ssr_tuxi') > 0;
                        },
                        content: function() {
                            'step 0';
                            var num = player.countMark('ssr_tuxi');
                            player.chooseTarget(get.prompt('ssr_tuxi'), '是否弃置一枚“突袭”标记并获得任意名角色的手牌区和装备区的所有牌，然后若其体力值大于你，你对其使用一张【调虎离山】？', 1,
                            function(card, player, target) {
                                return target.countCards('he') > 0 && player != target;
                            },
                            function(target) {
                                var ran = 0.4;
                                if (player.hasSkill('ssr_mubing_dis')) var ran = 1;
                                if (player.skipList.contains('phaseUse')) return - 1;
                                if (Math.random() > ran) return - 1;
                                if (get.attitude(player, target) < -2) return target.countCards('he') - 2;
                                if (get.attitude(player, target) < 0) return target.countCards('he') - 4;
                                return - 1;
                            });
                            'step 1';
                            if (result.bool) {
                                player.removeMark('ssr_tuxi', result.targets.length);
                                player.logSkill(event.name, result.targets);
                                for (var i = 0; i < result.targets.length; i++) {
                                    var target = result.targets[i];
                                    player.gain(target.getCards('he'), target, 'giveAuto');
                                    if (target.getHp() > player.getHp()) player.useCard({
                                        name: 'diaohulishan'
                                    },
                                    target);
                                }
                            }
                            if (!player.countMark('ssr_tuxi') > 0) player.awakenSkill('ssr_tuxi');
                        },
                        ai: {
                            threaten: function(player, target) {
                                return 0.5 + target.countMark('ssr_tuxi') * 0.8;
                            },
                        },
                    },
                    "ssr_newmubing": {
                        trigger: {
                            player: "loseAfter",
                        },
                        priority: -9,
                        filter: function(event, player) {
                            if (event.type != 'discard' || !event.cards2) return false;
                            var evt = event.getParent('phaseDiscard');
                            if (! (evt && evt.name == 'phaseDiscard' && evt.player == player)) return false;
                            return event.cards2.length >= 2;
                        },
                        checkx: function(event, player, cards, cards2) {
                            return true;
                        },
                        audio: 'mubing',
                        frequent: true,
                        preHidden: true,
                        content: function() {
                            "step 0";
                            event.cards = get.cards(3);
                            var num = trigger.cards2.length - 1;
                            player.chooseCardButton('〖募兵〗<br>选择获得其中至多' + get.cnNumber(num) + '张牌', event.cards, [1, num]).set('ai',
                            function(button) {
                                return get.value(button);
                            });
                            "step 1";
                            if (result.bool) {
                                game.delay(0.5);
                                //player.logSkill('ssr_newmubing',trigger.player);
                                player.gain(result.links);
                                player.$gain2(result.links);
                                game.delay();
                            }
                        },
                    },
                    "ssr_mubing": {
                        subSkill: {
                            dis: {
                                mark: true,
                                marktext: "募兵",
                                intro: {
                                    name: "招兵买马",
                                    content: "<li>跳过你的下一个弃牌阶段",
                                },
                                audio: 'mubing',
                                trigger: {
                                    player: "phaseDiscardBefore",
                                },
                                frequent: function(event, player) {
                                    return player.needsToDiscard();
                                },
                                filter: function(event, player) {
                                    return true;
                                },
                                content: function() {
                                    trigger.cancel();
                                },
                                sub: true,
                            },
                        },
                        audio: 'mubing',
                        preHidden: true,
                        trigger: {
                            player: "damageEnd",
                        },
                        filter: function(event, player) {
                            return ! player.hasSkill('ssr_mubing_dis');
                        },
                        priority: -17,
                        frequent: true,
                        content: function() {
                            "step 0";
                            player.addTempSkill('ssr_mubing_dis', {
                                player: 'phaseAfter'
                            });
                        },
                        ai: {
                            maixie: true,
                            "maixie_hp": true,
                            effect: {
                                target: function(card, player, target) {
                                    if (player.hasSkillTag('jueqing', false, target)) return [1, -1];
                                    if (get.tag(card, 'damage')) return [1, 0.7];
                                },
                            },
                        },
                    },
                    "ssr_jinfan": {
                        enable: 'phaseUse',
                        filterCard: true,
                        usable: 2,
                        audio: 'gnjinfan',
                        check: function(card) {
                            return 9 - get.value(card);
                        },
                        filterCard: function(card) {
                            return get.color(card) == 'black' || get.type(card) == 'equip';
                        },
                        filter: function(event, player) {
                            return player.countCards('he', {
                                color: 'black'
                            }) + player.countCards('he', {
                                type: 'equip'
                            }) > 0;
                        },
                        //selectCard:[1,3],
                        position: 'he',
                        group: 'ssr_jinfan_effect',
                        content: function() {
                            var num = cards.length;
                            var gains = get.cards(num * 2);
                            //player.showCards(gains,'银铃锦帆');
                            player.addToExpansion(gains, player, 'give').gaintag.add('ssr_jinfan');
                        },
                        name: "铃",
                        intro: {
                            name: "银铃锦帆",
                            content: "expansion",
                            markcount: "expansion",
                        },
                        onremove: function(player) {
                            var cards = player.getExpansions('ssr_jinfan');
                            if (cards.length) player.loseToDiscardpile(cards);
                        },
                        ai: {
                            order: 9,
                            result: {
                                player: function(player) {
                                    return game.countPlayer(function(current) {
                                        return get.attitude(player, current) < -1;
                                    });
                                },
                            },
                        },
                        subSkill: {
                            effect: {
                                nopop: true,
                                trigger: {
                                    player: "useCardToPlayered",
                                },
                                filter: function(event, player) {
                                    return event.card.name == 'sha' && player.getExpansions('ssr_jinfan').length > event.target.countCards('h');
                                },
                                forced: true,
                                logTarget: "target",
                                content: function() {
                                    trigger.target.addTempSkill('qinggang2');
                                    trigger.target.storage.qinggang2.add(trigger.card);
                                    trigger.target.markSkill('qinggang2');
                                },
                                ai: {
                                    "unequip_ai": true,
                                    skillTagFilter: function(player, tag, arg) {
                                        if (arg && arg.name == 'sha') return true;
                                        return false;
                                    },
                                },
                                mod: {
                                    targetInRange: function(card, player, target, now) {
                                        if (card.name == 'sha' && player.getExpansions('ssr_jinfan').length > target.countCards('h')) return true;
                                    },
                                },
                                sub: true,
                            },
                        },
                    },
                    "ssr_qixi": {
                        trigger: {
                            player: "phaseJieshuBegin",
                        },
                        priority: 5,
                        filter: function(event, player) {
                            return player.getExpansions('ssr_jinfan').length > 0;
                        },
                        forced: true,
                        audio: 'sbqixi',
                        content: function() {
                            "step 0";
                            event.card = player.getExpansions('ssr_jinfan');
                            event.basic = event.card.filter(card =>get.type(card) == 'basic').length;
                            event.trick = event.card.filter(card =>get.type(card, 'trick') == 'trick').length;
                            event.equip = event.card.filter(card =>get.type(card) == 'equip').length;
                            "step 1";
                            player.chooseTarget("###" + get.prompt('ssr_qixi') + "###" + "锁定技，结束阶段，若你的武将牌上有“铃”，你须指定一名其他角色并对“铃”进行清算：<br>" + "●清算结果：" + event.basic + " 手牌区 | " + event.trick + " 装备区 | " + event.equip + " 造成伤害", true,
                            function(card, player, target) {
                                return player != target;
                            }).setHiddenSkill(event.name).ai = function(target) {
                                if (get.attitude(player, target) > 0) return 0;
                                var num = Math.random();
                                if (event.basic > 0 && target.countCards('h')) num += (6 - Math.abs(event.basic - target.countCards('h'))) * 1;
                                if (event.trick > 0 && target.countCards('e')) num += (6 - Math.abs(event.equip - target.countCards('e'))) * 1.5;
                                if (event.equip > 0) num += get.damageEffect(target, player, player);
                                return num;
                            };
                            'step 2';
                            if (result.bool) {
                                event.target = result.targets[0];
                            } else {
                                var cards = player.getExpansions('ssr_jinfan');
                                if (cards.length) player.loseToDiscardpile(cards); {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            'step 3';
                            if (event.basic > 0 && event.target.countCards('h', card =>{
                                return lib.filter.cardDiscardable(card, player);
                            }) > 0) {
                                var target = event.target;
                                var cards = target.getCards('h', card =>{
                                    return lib.filter.cardDiscardable(card, player);
                                });
                                //var num=Math.min(event.basic,cards.length);
                                player.line(target);
                                target.discard(cards.randomGet());
                                event.basic--;
                                event.redo();
                            }
                            'step 4';
                            if (event.trick > 0 && event.target.countCards('e', card =>{
                                return lib.filter.cardDiscardable(card, player);
                            }) > 0) {
                                var target = event.target;
                                var cards = target.getCards('e', card =>{
                                    return lib.filter.cardDiscardable(card, player);
                                });
                                //var num=Math.min(event.basic,cards.length);
                                player.line(target);
                                target.discard(cards.randomGet());
                                event.trick--;
                                event.redo();
                            }
                            'step 5';
                            if (event.equip > 0 && event.target.isAlive()) {
                                var target = event.target;
                                player.line(target);
                                target.damage();
                                event.equip--;
                                event.redo();
                            }
                            'step 6';
                            var cards = player.getExpansions('ssr_jinfan');
                            if (cards.length) player.loseToDiscardpile(cards);
                            'step 7';
                            var num = event.basic + event.trick + event.equip;
                            if (num > 0) player.draw(num);
                        },
                        ai: {
                            expose: 0.2,
                        },
                    },
                    "ssr_xuanfeng": {
                        group: ['ssr_xuanfeng_discard'],
                        subSkill: {
                            discard: {
                                trigger: {
                                    global: "phaseJieshuBegin",
                                },
                                priority: 5,
                                filter: function(event, player) {
                                    return player.countMark('ssr_xuanfeng') > 0;
                                },
                                forced: true,
                                content: function() {
                                    "step 0";
                                    event.num = player.countMark('ssr_xuanfeng');
                                    "step 1";
                                    player.removeMark('ssr_xuanfeng');
                                    player.chooseTarget(get.prompt('ssr_xuanfeng'), '是否弃置一名角色区域内的一张牌？', 1,
                                    function(card, player, target) {
                                        return target.countDiscardableCards(player, get.is.single() ? 'he': 'hej') && player != target;
                                    },
                                    function(target) {
                                        var att = get.attitude(player, target);
                                        var nh = target.countCards('h');
                                        if (att > 0) {
                                            if (target.countCards('j',
                                            function(card) {
                                                var cardj = card.viewAs ? {
                                                    name: card.viewAs
                                                }: card;
                                                return get.effect(target, cardj, target, player) < 0;
                                            }) > 0) return 3;
                                            if (target.getEquip('baiyin') && target.isDamaged() && get.recoverEffect(target, player, player) > 0) {
                                                if (target.hp == 1 && !target.hujia) return 1.6;
                                            }
                                            if (target.countCards('e',
                                            function(card) {
                                                if (get.position(card) == 'e') return get.value(card, target) < 0;
                                            }) > 0) return 1;
                                        }
                                        if (att < 0 && target.countCards('h') == 1) {
                                            return 3;
                                        }
                                        var es = target.getCards('e');
                                        var noe = (es.length == 0 || target.hasSkillTag('noe'));
                                        var noe2 = (es.filter(function(esx) {
                                            return get.value(esx, target) > 0;
                                        }).length == 0);
                                        var noh = (nh == 0 || target.hasSkillTag('noh'));
                                        if (noh && (noe || noe2)) return 0;
                                        if (att <= 0 && !target.countCards('he')) return 1.5;
                                        if (att <= 0) return 1.5;
                                        return - 1.5;
                                    });
                                    'step 2';
                                    event.okay = 0;
                                    if (result.bool) {
                                        event.target = result.targets[0];
                                        var target = result.targets[0];
                                        if (!get.is.single() && target.countDiscardableCards(player, 'hej')) {
                                            player.choosePlayerCard('hej', target, true);
                                            event.okay = 1;
                                        } else {
                                            var bool1 = target.countDiscardableCards(player, 'h');
                                            var bool2 = target.countDiscardableCards(player, 'e');
                                            if (bool1 && bool2) {
                                                player.chooseControl('手牌区', '装备区').set('ai',
                                                function() {
                                                    return Math.random() < 0.5 ? 1 : 0;
                                                }).set('prompt', '弃置' + (get.translation(target.name)) + '装备区的一张牌，或观看其手牌并弃置其中的一张牌。');
                                            } else event._result = {
                                                control: bool1 ? '手牌区': '装备区'
                                            };
                                        }
                                    }
                                    'step 3';
                                    if (event.okay == 0 && result.bool) {
                                        var target = result.targets[0];
                                        var pos = result.control == '手牌区' ? 'h': 'e';
                                        player.choosePlayerCard(target, pos, true, 'visible');
                                    }
                                    'step 4';
                                    if (result.bool) {
                                        if (target.countCards('h') > 0) {
                                            var cards = target.getCards('h');
                                            var card = result.links;
                                        } else {
                                            var cards = [];
                                        }
                                        //player.chooseControl('ok').set('dialog',['手牌',cards,'弃牌',card]);
                                        target.discard(result.links, ui.special);
                                        //if(card.contains(cards)) {
                                        if (cards.length == 1) {
                                            var cs = cards[0];
                                            var cd = card[0];
                                            if (get.type(cs) == get.type(cd) && get.suit(cs) == get.suit(cd) && get.number(cs) == get.number(cd)) {
                                                target.damage();
                                            }
                                        }
                                    }
                                    'step 5';
                                    if (player.countMark('ssr_xuanfeng') > 0) event.goto(1);
                                },
                                sub: true,
                            },
                        },
                        audio: "qixi",
                        trigger: {
                            player: "loseAfter",
                            global: ["equipAfter", "addJudgeAfter", "gainAfter", "loseAsyncAfter"],
                        },
                        priority: 4,
                        forced: true,
                        filter: function(event, player) {
                            var evt = event.getl(player);
                            if (evt && evt.player == player) {
                                var sumcard = [];
                                if (evt.es && evt.es.length > 0) {
                                    var sumcard = sumcard.concat(evt.es);
                                }
                                if (evt.hs && evt.hs.length > 0) {
                                    var sumcard = sumcard.concat(evt.hs);
                                }
                                if (sumcard && sumcard.length > 0) {
                                    if (['useCard'].contains(event.getParent().name)) {
                                        if (get.type(sumcard[0]) == 'equip') return false;
                                        if (sumcard[0].name == 'shandian') return false;
                                        if (sumcard[0].name == 'fulei') return false;
                                        if (sumcard[0].name == 'hongshui') return false;
                                    }
                                    for (var i = 0; i < sumcard.length; i++) {
                                        if (get.color(sumcard[i]) == 'black') return true;
                                    }
                                }
                            }
                        },
                        marktext: "铃",
                        intro: {
                            name: "狂风奇袭",
                            content: "mark",
                        },
                        content: function() {
                            'step 0';
                            event.num = 0;
                            var evt = trigger.getl(player);
                            var sumcard = [];
                            if (evt.es && evt.es.length > 0) {
                                var sumcard = sumcard.concat(evt.es);
                            }
                            if (evt.hs && evt.hs.length > 0) {
                                var sumcard = sumcard.concat(evt.hs);
                            }
                            for (var i = 0; i < sumcard.length; i++) {
                                if (get.color(sumcard[i]) == 'black') event.num++;
                            }
                            //var num=event.num;
                            'step 1';
                            player.addMark('ssr_xuanfeng', event.num);
                        },
                    },
                    "ssr_tieji": {
                        marktext: "锦",
                        audio: "sbtieji",
                        trigger: {
                            player: "useCardToPlayered",
                        },
                        check: function(event, player) {
                            return get.attitude(player, event.target) <= 0;
                        },
                        filter: function(event, player) {
                            return event.card.name == 'sha';
                        },
                        logTarget: "target",
                        content: function() {
                            "step 0";
                            if (!trigger.target.hasSkill('fengyin')) {
                                trigger.target.addTempSkill('fengyin');
                            }
                            event.card = get.cards()[0];
                            if (player.storage.ssr_tieji == undefined) player.storage.ssr_tieji = [];
                            var cards1 = [event.card];
                            var cards2 = player.storage.ssr_tieji.slice(0);
                            player.storage.ssr_tieji.push(event.card);
                            player.syncStorage('ssr_tieji');
                            event.trigger("addCardToStorage");
                            if (cards2.length > 0) {
                                event.dialog = ui.create.dialog('牌堆顶的牌', cards1, '武将牌上的“锦”', cards2);
                            } else {
                                event.dialog = ui.create.dialog('牌堆顶的牌', cards1);
                            }
                            player.showCards(event.dialog);
                            player.markSkill('ssr_tieji');
                            "step 1";
                            setTimeout(function() {
                                event.dialog.close();
                            },
                            500);
                            //event.dialog.close();
                            event.directhit = false;
                            for (var i = 0; i < player.storage.ssr_tieji.length - 1; i++) {
                                if (get.suit(event.card) && get.suit(event.card) == get.suit(player.storage.ssr_tieji[i])) {
                                    player.storage.ssr_tieji.remove(event.card);
                                    player.syncStorage('ssr_tieji');
                                    player.markSkill('ssr_tieji');
                                    game.cardsDiscard(event.card);
                                    //player.gain(event.card);
                                    //game.log(player,'获得了',event.card);
                                    trigger.getParent().directHit.add(trigger.target);
                                    event.directhit = true;
                                }
                            }
                            if (1 == 0 && !event.directhit) {
                                var target = trigger.target;
                                var position = 'h';
                                if (target.countGainableCards(player, position)) {
                                    player.gainPlayerCard(position, target, 1, true);
                                }
                            }
                        },
                        intro: {
                            name: "锦",
                            content: "cards",
                            onunmark: function(storage, player) {
                                if (storage && storage.length) {
                                    player.$throw(storage);
                                    game.cardsDiscard(storage);
                                    delete player.storage.ssr_tieji;
                                }
                            },
                        },
                        ai: {
                            ignoreSkill: true,
                            skillTagFilter: function(player, tag, arg) {
                                if (tag == 'directHit_ai') {
                                    return get.attitude(player, arg.target) <= 0;
                                }
                                if (!arg || arg.isLink || !arg.card || arg.card.name != 'sha') return false;
                                if (!arg.target || get.attitude(player, arg.target) >= 0) return false;
                                if (!arg.skill || !lib.skill[arg.skill] || lib.skill[arg.skill].charlotte || get.is.locked(arg.skill) || !arg.target.getSkills(true, false).contains(arg.skill)) return false;
                            },
                            "directHit_ai": true,
                        },
                    },
                    "ssr_zhuiji": {
                        trigger: {
                            source: "damageSource",
                        },
                        audio: "ol_shichou",
                        //direct: true,
                        forced: true,
                        priority: -5,
                        filter: function(event, player) {
                            return get.distance(player, event.player) <= 1 && event.player.countGainableCards(player, 'he') && event.player != player;
                        },
                        content: function() {
                            player.gainPlayerCard('he', trigger.player, 1);
                        },
                        mod: {
                            globalFrom: function(from, to, distance) {
                                if (from.hp < from.maxHp) {
                                    var number = from.getDamagedHp();
                                    return distance - number;
                                }
                            },
                            maxHandcardBase: function(player, num) {
                                if (player.hujia) return num + player.hujia;
                            },
                        },
                    },
                    "ssr_newfanjian": {
                        subSkill: {
                            break: {
                                trigger: {
                                    global: ["phaseBefore", "die"],
                                },
                                filter: function(event, player) {
                                    return event.player == player.storage.ssr_newfanjian_break;
                                },
                                charlotte: true,
                                forced: true,
                                silent: true,
                                intro: {
                                    name: "损兵折将",
                                    content: function(storage, player) {
                                        var suits = [];
                                        if (player.storage.ssr_newfanjian_suits && player.storage.ssr_newfanjian_suits.length) suits = player.storage.ssr_newfanjian_suits;
                                        if (!suits.length) return '限制已失效';
                                        return '你不能使用或打出' + get.translation(suits) + '花色的牌';
                                    },
                                },
                                mark: true,
                                marktext: "将损",
                                content: function() {
                                    player.removeSkill('ssr_newfanjian_break');
                                },
                                mod: {
                                    cardSavable: function(card, player) {
                                        var suits = [];
                                        if (player.storage.ssr_newfanjian_suits && player.storage.ssr_newfanjian_suits.length) suits = player.storage.ssr_newfanjian_suits;
                                        if (suits.contains(get.suit(card))) return false;
                                    },
                                    cardEnabled: function(card, player) {
                                        var suits = [];
                                        if (player.storage.ssr_newfanjian_suits && player.storage.ssr_newfanjian_suits.length) suits = player.storage.ssr_newfanjian_suits;
                                        if (suits.contains(get.suit(card))) return false;
                                    },
                                    cardResponsabled: function(card, player) {
                                        var suits = [];
                                        if (player.storage.ssr_newfanjian_suits && player.storage.ssr_newfanjian_suits.length) suits = player.storage.ssr_newfanjian_suits;
                                        if (suits.contains(get.suit(card))) return false;
                                    },
                                },
                                sub: true,
                            },
                        },
                        audio: "fanjian",
                        enable: "phaseUse",
                        usable: 1,
                        position: "h",
                        discard: false,
                        lose: false,
                        filterTarget: function(card, player, target) {
                            return player != target && target.countCards('h');
                        },
                        filterCard: true,
                        check: function(card) {
                            var player = get.owner(card);
                            var suits = ['spade', 'club', 'diamond', 'heart'];
                            for (var i = 0; i < suits.length; i++) {
                                if (game.hasPlayer(function(current) {
                                    if (get.attitude(player, current) > 0) return false;
                                    if (current.hasSkill('ssr_newkurou_' + suits[i])) return true;
                                    return false;
                                }) && get.suit(card) == suits[i]) return 9 - get.value(card);
                            }
                            return 7.5 - get.value(card);
                        },
                        content: function() {
                            "step 0";
                            if (!target.countCards('h')) {
                                event.finish();
                                return;
                            } else target.chooseCard(true, 'h').set('ai',
                            function(card) {
                                var player = _status.event.player;
                                return Math.max(1, 20 - get.value(card));
                            });
                            "step 1";
                            player.showCards(cards);
                            target.showCards(result.cards);
                            event.card1 = cards[0];
                            event.card2 = result.cards[0];
                            if (get.suit(event.card1) == get.suit(event.card2)) {
                                player.discard(cards);
                                target.discard(result.cards);
                                if (player.hasSkill('ssr_youqin_zi_basic')) {
                                    player.removeSkill('ssr_youqin_zi_basic');
                                    player.addSkill('ssr_youqin_zi_equip');
                                } else if (player.hasSkill('ssr_youqin_zi_equip')) {
                                    player.removeSkill('ssr_youqin_zi_equip');
                                    player.addSkill('ssr_youqin_zi_basic');
                                }
                            } else {
                                target.addSkill('ssr_newfanjian_break');
                                target.storage.ssr_newfanjian_break = player;
                                target.storage.ssr_newfanjian_suits = [get.suit(event.card1), get.suit(event.card2)];
                                target.damage('nocard');
                                if (player.hasSkill('ssr_youqin_hun_trick')) {
                                    player.removeSkill('ssr_youqin_hun_trick');
                                    player.addSkill('ssr_youqin_hun_delay');
                                } else if (player.hasSkill('ssr_youqin_hun_delay')) {
                                    player.removeSkill('ssr_youqin_hun_delay');
                                    player.addSkill('ssr_youqin_hun_trick');
                                }
                            }
                        },
                        ai: {
                            result: {
                                target: function(player, target) {
                                    var suits = ['spade', 'club', 'diamond', 'heart'];
                                    for (var i = 0; i < suits.length; i++) {
                                        if (target.hasSkill('ssr_newkurou_' + suits[i])) return - 1.5;
                                    }
                                    return - 1;
                                },
                            },
                            order: 9,
                        },
                    },
                    "ssr_youqin": {
                        subSkill: {
                            mark: {
                                trigger: {
                                    player: ["enterGame"],
                                    global: "phaseBefore",
                                },
                                forced: true,
                                priority: 20,
                                filter: function(event) {
                                    return (event.name != 'phase' || game.phaseNumber == 0);
                                },
                                content: function() {
                                    player.addSkill('ssr_youqin_hun_trick');
                                    player.addSkill('ssr_youqin_zi_basic');
                                },
                                sub: true,
                            },
                            hun_trick: {
                                title: "普通锦囊",
                                charlotte: true,
                                mark: true,
                                marktext: "魂 锦囊",
                                intro: {
                                    content: function(storage, player) {
                                        return '魂·普通锦囊';
                                    },
                                },
                                sub: true,
                                parentskill: "ssr_youqin",
                            },
                            hun_delay: {
                                title: "延时锦囊",
                                charlotte: true,
                                mark: true,
                                marktext: "魂 延时",
                                intro: {
                                    content: function(storage, player) {
                                        return '魂·延时锦囊';
                                    },
                                },
                                sub: true,
                                parentskill: "ssr_youqin",
                            },
                            zi_basic: {
                                title: "基本牌",
                                charlotte: true,
                                mark: true,
                                marktext: "姿 基本",
                                intro: {
                                    content: function(storage, player) {
                                        return '姿·基本牌';
                                    },
                                },
                                sub: true,
                                parentskill: "ssr_youqin",
                            },
                            zi_equip: {
                                title: "装备牌",
                                charlotte: true,
                                mark: true,
                                marktext: "姿 装备",
                                intro: {
                                    content: function(storage, player) {
                                        return '姿·装备牌';
                                    },
                                },
                                sub: true,
                                parentskill: "ssr_youqin",
                            },
                        },
                        group: 'ssr_youqin_mark',
                        audio: "yingzi",
                        trigger: {
                            player: "phaseDrawBegin2",
                        },
                        forced: true,
                        priority: 3,
                        filter: function(event, player) {
                            return ! event.numFixed && event.num > 0;
                        },
                        content: function() {
                            trigger.num--;
                            if (player.hasSkill('ssr_youqin_hun_trick')) {
                                event.card1 = get.cardPile(function(card) {
                                    return get.type(card) == 'trick';
                                },
                                'cardPile');
                                if (event.card1) {
                                    player.gain(event.card1, 'draw');
                                }
                            }
                            if (player.hasSkill('ssr_youqin_hun_delay')) {
                                event.card2 = get.cardPile(function(card) {
                                    return get.type(card) == 'delay';
                                },
                                'cardPile');
                                if (event.card2) {
                                    player.gain(event.card2, 'draw');
                                }
                            }
                            if (player.hasSkill('ssr_youqin_zi_basic')) {
                                event.card3 = get.cardPile(function(card) {
                                    return get.type(card) == 'basic';
                                },
                                'cardPile');
                                if (event.card3) {
                                    player.gain(event.card3, 'draw');
                                }
                            }
                            if (player.hasSkill('ssr_youqin_zi_equip')) {
                                event.card4 = get.cardPile(function(card) {
                                    return get.type(card) == 'equip';
                                },
                                'cardPile');
                                if (event.card4) {
                                    player.gain(event.card4, 'draw');
                                }
                            }
                        },
                        mod: {
                            maxHandcardBase: function(player, num) {
                                return player.maxHp;
                            },
                        },
                        ai: {
                            threaten: 1.2,
                        },
                    },
                    "ssr_yingzi": {
                        locked: true,
                        mod: {
                            maxHandcardBase: function(player, num) {
                                return 4;
                            },
                        },
                        audio: "yingzi",
                        trigger: {
                            player: "phaseDrawBegin2",
                        },
                        forced: true,
                        filter: function(event, player) {
                            return ! event.numFixed;
                        },
                        content: function() {
                            trigger.num++;
                        },
                        ai: {
                            threaten: 1.4,
                        },
                    },
                    "ssr_anhun": {
                        trigger: {
                            global: ['loseHpEnd', 'recoverEnd'],
                        },
                        forced: true,
                        //audio:2,
                        group: ['ssr_anhun_use', 'ssr_anhun_game', 'ssr_anhun_fire'],
                        content: function() {
                            var num = Math.min(8 - player.countMark('ssr_anhun'), trigger.num);
                            if (num > 0) player.addMark('ssr_anhun', num);
                        },
                        marktext: '幽弦',
                        intro: {
                            content: 'mark',
                        },
                        subSkill: {
                            use: {
                                trigger: {
                                    player: ['useCard', 'respond'],
                                },
                                forced: true,
                                //audio:2,
                                filter: function(event, player) {
                                    return player.countMark('ssr_anhun') > 0 && event.card && event.card.isCard;
                                },
                                content: function() {
                                    'step 0';
                                    player.removeMark('ssr_anhun');
                                    'step 1';
                                    player.draw();
                                },
                            },
                            game: {
                                trigger: {
                                    player: ["enterGame"],
                                    global: "phaseBefore",
                                },
                                forced: true,
                                filter: function(event) {
                                    return (event.name != 'phase' || game.phaseNumber == 0);
                                },
                                content: function() {
                                    player.addMark('ssr_anhun', 2);
                                },
                            },
                            fire: {
                                trigger: {
                                    player: "damageBegin4",
                                },
                                filter: function(event) {
                                    return event.nature == 'fire';
                                },
                                forced: true,
                                content: function() {
                                    trigger.cancel();
                                },
                                ai: {
                                    nofire: true,
                                    effect: {
                                        target: function(card, player, target, current) {
                                            if (get.tag(card, 'fireDamage')) return 'zerotarget';
                                        },
                                    },
                                },
                                "_priority": 0,
                            },
                        },
                    },
                    "ssr_yeyan": {
                        trigger: {
                            player: "damageBegin4",
                            source: "damageBegin4",
                        },
                        filter: function(event) {
                            return event.nature == 'fire';
                        },
                        direct: true,
                        content: function() {
                            'step 0';
                            if (trigger.player == player) {
                                var cho = player.chooseCard(1, 'he', '业炎：是否弃置一张牌，然后使受到的伤害值减一？');
                            } else {
                                var cho = player.chooseCard(1, 'he', '业炎：是否弃置一张牌，然后使造成的伤害值加一？');
                            }
                            cho.set('check',
                            function(card) {
                                return 9 - get.value(card);
                            });
                            'step 1';
                            if (result.bool) {
                                player.discard(result.cards);
                                if (trigger.player == player) {
                                    trigger.num--;
                                } else {
                                    trigger.num++;
                                }
                            }
                        },
                        /*ai:{
					        nofire:true,
					        effect:{
					            target:function(card,player,target,current){
					                if(get.tag(card,'fireDamage')) return 'zerotarget';
					            },
					        },
					    },*/
                    },
                    "ssr_fanjian": {
                        group: "ssr_fanjian_recycle",
                        subSkill: {
                            fear: {
                                trigger: {
                                    player: "useCardBefore",
                                },
                                filter: function(event, player, card) {
                                    if (player == game.me || player.isUnderControl()) return false;
                                    return true;
                                },
                                frequent: true,
                                silent: true,
                                content: function() {
                                    if (!player.storage.ssr_fanjian_nouse) player.storage.ssr_fanjian_nouse = [];
                                    if (Math.random() < 0.35) {
                                        player.storage.ssr_fanjian_nouse.push(trigger.card);
                                        trigger.cancel();
                                    }
                                },
                                mod: {
                                    cardEnabled: function(card, player) {
                                        if (player.storage.ssr_fanjian_nouse && player.storage.ssr_fanjian_nouse.length) {
                                            for (var i = 0; i < player.storage.ssr_fanjian_nouse.length; i++) {
                                                if (get.name(player.storage.ssr_fanjian_nouse[i]) == get.name(card) && get.suit(player.storage.ssr_fanjian_nouse[i]) == get.suit(card) && get.number(player.storage.ssr_fanjian_nouse[i]) == get.number(card)) return false;
                                            }
                                        }
                                    },
                                },
                                sub: true,
                                forced: true,
                                popup: false,
                            },
                            used: {
                                sub: true,
                            },
                            recycle: {
                                trigger: {
                                    global: "phaseBegin",
                                },
                                priority: 25,
                                filter: function(event, player, card) {
                                    return player.storage.ssr_fanjian && player.storage.ssr_fanjian.length > 0;
                                },
                                content: function() {
                                    'step 0';
                                    if (player.hasSkill('ssr_fanjian_use')) {
                                        player.removeSkill('ssr_fanjian_use');
                                        event.goto(5);
                                    }
                                    'step 1';
                                    if (_status.currentPhase == player) {
                                        event.goto(4);
                                    }
                                    'step 2'; //sslast
                                    if (!_status.auto && (player == game.me || player.isUnderControl())) game.waitClick(3, false, 100);
                                    player.chooseControl('确定', '取消', trigger.card,
                                    function() {
                                        if (window.aiClicking) return '取消';
                                        if (get.attitude(player, trigger.player) < 0) return '确定';
                                        return '取消';
                                    }).set('dialog', ['反间：是否更新〖反间〗牌库？', player.storage.ssr_fanjian]);
                                    'step 3';
                                    if (!_status.auto && (player == game.me || player.isUnderControl())) game.stopClick();
                                    if (result.control == '取消') {
                                        {
                                            if (event && event.finish) {
                                                event.finish();
                                            } else {
                                                return;
                                            }
                                        }
                                    }
                                    'step 4';
                                    player.gain(player.storage.ssr_fanjian, 'fromStorage');
                                    'step 5';
                                    player.storage.ssr_fanjian = [];
                                    player.unmarkSkill('ssr_fanjian');
                                    //player.removeSkill('ssr_fanjian_recycle');
                                    game.delay();
                                },
                                sub: true,
                                silent: true,
                                forced: true,
                                popup: false,
                            },
                            use: {
                                check: function(event, player) {
                                    return (get.attitude(player, event.player) < 0);
                                },
                                audio: "fanjian",
                                trigger: {
                                    global: ["useCard", "respond"],
                                },
                                filter: function(event, player, card) {
                                    if (!player.storage.ssr_fanjian || !event.card.isCard || player.storage.ssr_fanjian.length <= 0) return false;
                                    var types = ['type', 'name', 'suit', 'number'];
                                    for (var i = 0; i < types.length; i++) {
                                        if (get[types[i]](event.card) != get[types[i]](player.storage.ssr_fanjian[0])) return false;
                                    }
                                    /*if(get.type(event.card)!=get.type(player.storage.ssr_fanjian[0])) return false;
		                            if(get.name(event.card)!=get.name(player.storage.ssr_fanjian[0])) return false;
		                            if(get.suit(event.card)!=get.suit(player.storage.ssr_fanjian[0])) return false;
		                            if(get.number(event.card)!=get.number(player.storage.ssr_fanjian[0])) return false;*/
                                    return true;
                                },
                                direct: true,
                                content: function() {
                                    'step 0';
                                    player.chooseControl('确定', '取消', trigger.card,
                                    function() {
                                        if (get.attitude(player, trigger.player) < 0) return '确定';
                                        return '取消';
                                    }).set('prompt', '反间：' + get.translation(trigger.player.name) + '的【' + get.translation(trigger.card.name) + '】即将生效，是否令此牌无效，对该角色造成一点火焰伤害并回收此牌？');
                                    'step 1';
                                    if (result.control == '取消') {
                                        if (event && event.finish) {
                                            event.finish();
                                        } else {
                                            return;
                                        }
                                    }
                                    'step 2';
                                    player.logSkill('ssr_fanjian', trigger.player, 'fire');
                                    trigger.player.damage('fire');
                                    trigger.cancel();
                                    'step 3';
                                    trigger.player.discard(trigger.card);
                                    player.addTempSkill('ssr_fanjian_used', {
                                        player: 'phaseBegin'
                                    });
                                    'step 4';
                                    player.gain(player.storage.ssr_fanjian, 'gain2');
                                    player.storage.ssr_fanjian = [];
                                    player.unmarkSkill('ssr_fanjian');
                                    //player.removeSkill('ssr_fanjian_recycle');
                                    player.removeSkill('ssr_fanjian_use');
                                    if (trigger.player.hasSkill('ssr_fanjian_fear')) trigger.player.removeSkill('ssr_fanjian_fear');
                                },
                                ai: {
                                    result: {
                                        target: -2,
                                    },
                                    expose: 0.2,
                                },
                                sub: true,
                            },
                        },
                        marktext: "反间",
                        intro: {
                            mark: function(dialog, content, player) {
                                if (content && content.length) {
                                    if (player == game.me || player.isUnderControl() || player.classList.contains('dead') == true) {
                                        dialog.addAuto(content);
                                    } else {
                                        return '〖反间〗指定的牌';
                                    }
                                }
                            },
                            content: function(content, player) {
                                if (content && content.length) {
                                    if (player == game.me || player.isUnderControl() || player.classList.contains('dead') == true) {
                                        return get.translation(content);
                                    }
                                    return '〖反间〗指定的牌';
                                }
                            },
                        },
                        audio: "fanjian",
                        trigger: {
                            global: "phaseDrawBegin",
                        },
                        priority: -5,
                        filter: function(event, player, card) {
                            return event.player != player && player.countCards('h') > 0 && !(player.storage.ssr_fanjian && player.storage.ssr_fanjian.length > 0);
                        },
                        direct: true,
                        content: function() {
                            "step 0";
                            //if(!_status.auto&&(player==game.me||player.isUnderControl())) game.waitClick(5,false,400);
                            player.chooseCard('〖反间〗<br>请先选择一张手牌', 'h', true).set('check',
                            function(card, player) {
                                if (get.attitude(player, trigger.player) < 0 && !player.hasSkill('ssr_fanjian_used')) {
                                    if (card.name == 'tao' && event.player.hp >= event.player.maxHp) return - 1;
                                    if (card.name == 'shandian' || card.name == 'tiesuo') return 0.1;
                                }
                                if (card.name == 'shan' || card.name == 'wuxie') return - 1;
                                return get.value(card);
                            });
                            'step 1';
                            //if(!_status.auto&&(player==game.me||player.isUnderControl())) game.stopClick();
                            if (result.cards) {
                                event.card = result.cards[0];
                                player.lose(result.cards, ui.special);
                                game.broadcastAll(function(player) {
                                    var cardx = ui.create.card();
                                    cardx.classList.add('infohidden');
                                    cardx.classList.add('infoflip');
                                    player.$throw(cardx, 1000, 'nobroadcast');
                                },
                                player);
                            } else {
                                event.card = null;
                            }
                            if (!player.hasSkill('ssr_fanjian_used')) {
                                player.chooseControl('隐藏', '反间',
                                function() {
                                    if (get.attitude(player, trigger.player) < 0) return '反间';
                                    return '隐藏';
                                }).set('prompt', '〖反间〗<br>请选择此牌的效果');
                            } else {
                                result.control = '隐藏';
                            }
                            'step 2';
                            if (result.control == '反间' && !player.hasSkill('ssr_fanjian_used')) {
                                event.boolt = 1;
                            } else {
                                event.boolt = 0;
                            }
                            if (player == game.me) game.delay(0.5);
                            'step 3';
                            if (event.boolt == 1) {
                                if (event.card) {
                                    event.card.fix();
                                    ui.cardPile.insertBefore(event.card, ui.cardPile.firstChild);
                                    game.updateRoundNumber();
                                    event.cardl = game.createCard(event.card);
                                    player.storage.ssr_fanjian = game.cardsGotoSpecial(event.cardl).cards;
                                    player.markSkill('ssr_fanjian');
                                    player.syncStorage('ssr_fanjian');
                                    player.addSkill('ssr_fanjian_use');
                                }
                                if (player.isUnderControl()) {
                                    game.modeSwapPlayer(player);
                                }
                            } else {
                                player.storage.ssr_fanjian = game.cardsGotoSpecial(event.card).cards;
                                player.markSkill('ssr_fanjian');
                                player.syncStorage('ssr_fanjian');
                                //if(player.hasSkill('ssr_fanjian_use')) player.removeSkill('ssr_fanjian_use');
                            }
                            'step 4';
                            if (event.boolt == 1) {
                                player.update();
                                event.cards = get.cards(3);
                                player.chooseCardButton(event.cards, 3, '按顺序调整牌堆顶', true).set('ai', ai.get.buttonValue);
                            }
                            "step 5";
                            if (event.boolt == 1) {
                                if (get.attitude(trigger.player, player) < 0) {
                                    trigger.player.addTempSkill('ssr_fanjian_fear');
                                    trigger.player.storage.ssr_fanjian_nouse = [];
                                }
                                var choice = [];
                                for (var i = 0; i < result.links.length; i++) {
                                    choice.push(result.links[i]);
                                    cards.remove(result.links[i]);
                                }
                                for (var i = 0; i < cards.length; i++) {
                                    ui.cardPile.appendChild(cards[i]);
                                }
                                while (choice.length) {
                                    ui.cardPile.insertBefore(choice.pop(), ui.cardPile.firstChild);
                                }
                                get.bottomCards(1);
                            }
                        },
                        forced: true,
                        popup: false,
                    },
                    "ssr_jijiang": {
                        subSkill: {
                            sha: {
                                shaRelated: true,
                                audio: "nzry_jieying",
                                forced: true,
                                locked: true,
                                group: ["ssr_shichou"],
                                mark: true,
                                marktext: "激将",
                                intro: {
                                    name: "义愤填膺",
                                    content: "〖激将〗<li>你的回合内你可以额外使用一张【杀】<br><br>〖誓仇〗<li>当你使用【杀】指定一名角色为目标后，你可以进行一次判定：该角色不能使用或打出与判定结果花色相同的牌直到你的回合开始。",
                                },
                                mod: {
                                    cardUsable: function(card, player, num) {
                                        if (card.name == 'sha') return num + 1;
                                    },
                                },
                                sub: true,
                            },
                        },
                        audio: "sbzhangwu",
                        trigger: {
                            player: "phaseJieshuBegin",
                        },
                        direct: true,
                        unique: true,
                        zhuSkill: true,
                        filter: function(event, player) {
                            if (!player.hasZhuSkill('ssr_jijiang') || !game.hasPlayer(function(current) {
                                return current != player && current.group == 'shu' && !current.hasSkill('ssr_jijiang_sha');
                            })) return false;
                            if (player.getHistory('skipped').contains('phaseUse') || !player.countCards('h', {
                                name: 'sha'
                            })) return true;
                            var history = player.getHistory('useCard');
                            for (var i = 0; i < history.length; i++) {
                                if (history[i].card.name == 'sha' && history[i].isPhaseUsing()) return false;
                            }
                            return true;
                        },
                        content: function() {
                            'step 0';
                            player.chooseTarget(get.prompt2('ssr_jijiang'),
                            function(card, player, target) {
                                return target != player && !target.hasSkill('ssr_jijiang_sha') && target.group == 'shu';
                            }).ai = function(target) {
                                return get.attitude(player, target);
                            };
                            "step 1";
                            if (result.bool) {
                                player.logSkill('ssr_jijiang', result.targets, 'fire');
                                event.target = result.targets[0];
                                event.target.addTempSkill('ssr_jijiang_sha', {
                                    player: 'phaseEnd'
                                });
                            }
                        },
                    },
                    "ssr_qingji": {
                        audio: 'twmiewei',
                        enable: "phaseUse",
                        direct: true,
                        usable: 1,
                        content: function() {
                            'step 0';
                            player.logSkill('ssr_qingji');
                            player.damage(1);
                            'step 1';
                            var card = get.cardPile(function(card) {
                                return get.subtype(card, false) == 'equip1';
                            });
                            if (!card) {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                                return;
                            }
                            event.card = card;
                            player.gain(card, 'gain2');
                        },
                        ai: {
                            basic: {
                                order: 1,
                            },
                            result: {
                                player: function(player) {
                                    if (player.countCards('h') >= player.hp - 1) return - 1;
                                    if (player.hp < 3) return - 1;
                                    return 1;
                                },
                            },
                        },
                    },
                    "ssr_qiangxi": {
                        locked: true,
                        group: ["ssr_qiangxi_use", "ssr_qiangxi_equip"],
                        subSkill: {
                            use: {
                                filter: function(event, player) {
                                    return player.countMark('ssr_qiangxi') > 0;
                                },
                                audio: "twmiyong",
                                enable: "phaseUse",
                                usable: 2,
                                filterTarget: function(card, player, target) {
                                    if (target == player) return false;
                                    return true;
                                },
                                content: function() {
                                    player.removeMark('ssr_qiangxi');
                                    target.damage();
                                },
                                ai: {
                                    order: 8.5,
                                    threaten: 1.5,
                                    result: {
                                        target: function(player, target) {
                                            return get.damageEffect(target, player, target);
                                        },
                                    },
                                },
                                sub: true,
                            },
                            equip: {
                                audio: "olningwu",
                                trigger: {
                                    player: "loseAfter",
                                    global: ["equipAfter", "addJudgeAfter", "gainAfter", "loseAsyncAfter"],
                                },
                                forced: true,
                                filter: function(event, player) {
                                    var evt = event.getl(player);
                                    if (evt && evt.player == player) {
                                        if (['useCard'].contains(event.getParent().name)) return false;
                                        var sumcard = [];
                                        if (evt.es && evt.es.length > 0) {
                                            var sumcard = sumcard.concat(evt.es);
                                        }
                                        if (evt.hs && evt.hs.length > 0) {
                                            var sumcard = sumcard.concat(evt.hs);
                                        }
                                        if (sumcard && sumcard.length > 0) {
                                            for (var i = 0; i < sumcard.length; i++) {
                                                if (get.subtype(sumcard[i]) == 'equip1') return true;
                                            }
                                        }
                                    }
                                },
                                content: function() {
                                    'step 0';
                                    event.num = 0;
                                    var evt = trigger.getl(player);
                                    var sumcard = [];
                                    if (evt.es && evt.es.length > 0) {
                                        var sumcard = sumcard.concat(evt.es);
                                    }
                                    if (evt.hs && evt.hs.length > 0) {
                                        var sumcard = sumcard.concat(evt.hs);
                                    }
                                    for (var i = 0; i < sumcard.length; i++) {
                                        if (get.subtype(sumcard[i]) == 'equip1') event.num++;
                                    }
                                    var num = event.num;
                                    'step 1';
                                    player.addMark('ssr_qiangxi', event.num);
                                },
                                ai: {
                                    noe: true,
                                    reverseEquip: true,
                                },
                                sub: true,
                            },
                        },
                        audio: "olningwu",
                        marktext: "戟",
                        unique: true,
                        trigger: {
                            player: ["damageEnd", "enterGame", "phaseAfter", "phaseBegin"],
                            global: "gameDrawAfter",
                        },
                        priority: -1,
                        forced: true,
                        filter: function(event, player) {
                            return (event.name != 'damage' && !player.storage.ssr_qiangxi_mark) || event.num > 0;
                        },
                        content: function() {
                            player.storage.ssr_qiangxi_mark = true;
                            player.addMark('ssr_qiangxi', trigger.name == 'damage' ? trigger.num: 2);
                        },
                        intro: {
                            name: "双戟",
                            content: "mark",
                        },
                        ai: {
                            maixie: true,
                            "maixie_hp": true,
                        },
                    },
                    "ssr_yunchou": {
                        group: "ssr_yunchou_wuxie",
                        subSkill: {
                            forbid: {
                                sub: true,
                            },
                            basic: {
                                sub: true,
                            },
                            trick: {
                                sub: true,
                            },
                            equip: {
                                sub: true,
                            },

                            wuxie: {
                                audio: "kanpo",
                                enable: "chooseToUse",
                                prompt: "将某种类型的一张牌当做【无懈可击】使用",
                                viewAsFilter: function(player) {
                                    var types = ['basic', 'trick', 'delay', 'equip'];
                                    for (var i = 0; i < types.length; i++) {
                                        if (types[i] == 'delay') {
                                            var type = 'trick';
                                        } else {
                                            var type = types[i];
                                        }
                                        if (!player.hasSkill('ssr_yunchou_' + type) && player.countCards('hes', {
                                            type: types[i]
                                        })) return true;
                                    }
                                    return false;
                                },
                                onuse: function(result, player) {
                                    if (get.type(result.cards[0]) == 'delay') {
                                        var type = 'trick';
                                    } else {
                                        var type = get.type(result.cards[0]);
                                    }
                                    player.addTempSkill('ssr_yunchou_' + type, {
                                        player: 'phaseBegin'
                                    });
                                },
                                filterCard: function(card, player) {
                                    if (get.type(card) == 'delay') {
                                        var type = 'trick';
                                    } else {
                                        var type = get.type(card);
                                    }
                                    if (player.hasSkill('ssr_yunchou_' + type)) return false;
                                    return true;
                                },
                                position: "he",
                                selectCard: 1,
                                viewAs: {
                                    name: "wuxie",
                                },
                                ai: {
                                    basic: {
                                        useful: [6, 4],
                                        value: [6, 4],
                                    },
                                    result: {
                                        player: 1,
                                    },
                                    expose: 0.2,
                                },
                                sub: true,
                            },
                        },
                        audio: "kanpo",
                        enable: "chooseToUse",
                        filter: function(event, player) {
                            if (event.type == 'dying') return false;
                            if (event.type == 'shan') return false;
                            if (event.type == 'wuxie') return false;
                            var types = ['basic', 'trick', 'delay', 'equip'];
                            for (var i = 0; i < types.length; i++) {
                                if (types[i] == 'delay') {
                                    var type = 'trick';
                                } else {
                                    var type = types[i];
                                }
                                if (!player.hasSkill('ssr_yunchou_' + type) && player.countCards('hes', {
                                    type: types[i]
                                })) return true;
                            }
                            return false;
                        },
                        hiddenCard: function(player, name) {
                            if (!lib.inpile.contains(name)) return false;
                            var types = ['basic', 'trick', 'delay', 'equip'];
                            for (var i = 0; i < types.length; i++) {
                                if (types[i] == 'delay') {
                                    var type = 'trick';
                                } else {
                                    var type = types[i];
                                }
                                if (!player.hasSkill('ssr_yunchou_' + type) && player.countCards('hes', {
                                    type: types[i]
                                })) return true;
                            }
                            return false;
                        },
                        onremove: true,
                        chooseButton: {
                            dialog: function(event, player) {
                                var list = [];
                                for (var i = 0; i < lib.inpile.length; i++) {
                                    var name = lib.inpile[i];
                                    if (get.type(name) == 'trick') list.push(['锦囊', '', name]);
                                }
                                if (list.length == 0) {
                                    return ui.create.dialog('〖运筹〗已无可用牌');
                                }
                                return ui.create.dialog('运筹帷幄', [list, 'vcard']);
                            },
                            filter: function(button, player) {
                                return _status.event.getParent().filterCard({
                                    name: button.link[2]
                                },
                                player, _status.event.getParent());
                            },
                            check: function(button) {
                                var player = _status.event.player;
                                if (player.countCards('h', button.link[2]) == 1) return 0;
                                if (button.link[2] == 'wugu') return 0;
                                var effect = player.getUseValue(button.link[2]);
                                if (effect > 0) return effect;
                                return 0;
                            },
                            backup: function(links, player) {
                                return {
                                    filterCard: function(card) {
                                        if (get.type(card) == 'delay') {
                                            var type = 'trick';
                                        } else {
                                            var type = get.type(card);
                                        }
                                        if (player.hasSkill('ssr_yunchou_' + type)) return false;
                                        return true;
                                    },
                                    audio: 'relianying',
                                    selectCard: 1,
                                    popname: true,
                                    check: function(card) {
                                        return 6 - get.value(card);
                                    },
                                    position: 'he',
                                    viewAs: {
                                        name: links[0][2],
                                        nature: links[0][3]
                                    },
                                    onuse: function(result, player) {
                                        if (get.type(result.cards[0]) == 'delay') {
                                            var type = 'trick';
                                        } else {
                                            var type = get.type(result.cards[0]);
                                        }
                                        player.addTempSkill('ssr_yunchou_' + type, {
                                            player: 'phaseBegin'
                                        });
                                    },
                                }
                            },
                            prompt: function(links, player) {
                                return '将某种类型的一张牌当做【' + (get.translation(links[0][3]) || '') + get.translation(links[0][2]) + '】使用';
                            },
                        },
                        ai: {
                            order: 4,
                            result: {
                                player: function(player) {
                                    var allshown = true,
                                    players = game.filterPlayer();
                                    for (var i = 0; i < players.length; i++) {
                                        if (players[i].ai.shown == 0) {
                                            allshown = false;
                                        }
                                        if (players[i] != player && players[i].countCards('h') && get.attitude(player, players[i]) > 0) {
                                            return 1;
                                        }
                                    }
                                    if (allshown) return 1;
                                    return 0;
                                },
                            },
                            threaten: 1.9,
                        },
                    },
                    "ssr_bailun": {
                        subSkill: {
                            direct: {
                                trigger: {
                                    player: "useCard",
                                },
                                filter: function(event, player) {
                                    return player.isPhaseUsing() && (get.type(event.card, 'trick') == 'trick');
                                },
                                forced: true,
                                silent: true,
                                priority: 9,
                                content: function() {
                                    trigger.nowuxie = true;
                                    trigger.directHit.addArray(game.players);
                                },
                                mark: true,
                                marktext: "胜论",
                                intro: {
                                    name: "十胜十败",
                                    content: function(storage, player) {
                                        return '本回合你出牌阶段内使用的锦囊牌无距离限制且不能被响应';
                                    },
                                },
                                mod: {
                                    targetInRange: function(card, player, target, now) {
                                        var type = get.type(card);
                                        if (type == 'trick' || type == 'delay') return true;
                                    },
                                },
                                sub: true,
                            },
                            dam: {
                                trigger: {
                                    player: "phaseBegin",
                                },
                                forced: true,
                                audio: 'tiandu',
                                content: function() {
                                    "step 0";
                                    player.judge(function(card) {
                                        if (get.suit(card) == 'spade') return - 1;
                                        return 1;
                                    });
                                    "step 1";
                                    if (result.bool) {
                                        player.addTempSkill('ssr_bailun_direct');
                                    } else {
                                        //player.damage('thunder','nosource','nocard');
                                        if (result.card) player.gain(result.card, 'draw');
                                        player.loseHp();
                                    }
                                    game.delay();
                                },
                                sub: true,
                            },
                            dying: {
                                marktext: "败论",
                                intro: {
                                    name: "十胜十败",
                                    content: function(storage, player) {
                                        return '你的弃牌阶段开始时进行死亡结算<li>当前你的体力值为〈' + player.hp + '〉';
                                    },
                                },
                                forced: true,
                                priority: 99,
                                trigger: {
                                    player: "loseAfter",
                                    global: ["equipAfter", "addJudgeAfter", "gainAfter", "loseAsyncAfter", "addToExpansionAfter"],
                                },
                                frequent: true,
                                filter: function(event, player) {
                                    if (player.countCards('h') || player.hp > 0) return false;
                                    var evt = event.getl(player);
                                    return evt && evt.player == player && evt.hs && evt.hs.length > 0;
                                },
                                content: function() {
                                    player.draw();
                                },
                                ai: {
                                    threaten: 0.8,
                                    effect: {
                                        target: function(card) {
                                            if (card.name == 'guohe' || card.name == 'liuxinghuoyu') return 0.5;
                                        },
                                    },
                                    noh: true,
                                    skillTagFilter: function(player, tag) {
                                        if (tag == 'noh') {
                                            if (player.countCards('h') != 1) return false;
                                        }
                                    },
                                },
                                mark: true,
                                charlotte: true,
                                onremove: function(player) {
                                    'step 0';
                                    //var evt=_status.event.getParent('phaseDiscard');
                                    //if(evt&&evt.name=='phaseDiscard'&&evt.player==player) {
                                    if (player.hp <= 0 && player.ssr_bailun_needdie) player.dying({});
                                    //}
                                },
                                sub: true,
                            },
                        },
                        group: 'ssr_bailun_dam',
                        trigger: {
                            player: 'changeHp'
                        },
                        filter: function(event, player) {
                            if (player.hp > 0 && player.hasSkill('ssr_bailun_dying')) {
                                player.ssr_bailun_needdie = false;
                                player.removeSkill('ssr_bailun_dying');
                            }
                            var evt = event.getParent('phaseDiscard');
                            if (evt && evt.name == 'phaseDiscard' && evt.player == player) return false;
                            return player.hp <= 0;
                        },
                        audio: 'tiandu',
                        forced: true,
                        ondisable: true,
                        onremove: function(player, skill) {
                            if (player.hp <= 0) player.dying({});
                        },
                        content: function() {
                            'step 0';
                            var evt = trigger.getParent();
                            //if(evt.name=='damage'||evt.name=='loseHp') 
                            evt.nodying = true;
                            player.ssr_bailun_needdie = true;
                            if (!player.hasSkill('ssr_bailun_dying')) player.addTempSkill('ssr_bailun_dying', {
                                player: ['phaseDiscardBegin']
                            });
                        },
                        /*mod:{
						    targetEnabled:function(card,player,target,now){
						        if(get.tag(card,'damage')&&get.type(card,'trick')=='trick') return false;
						    },
						},*/
                    },
                    "ssr_newyice": {
                        subSkill: {
                            trick: {
                                trigger: {
                                    player: 'useCard'
                                },
                                preHidden: true,
                                forced: true,
                                priority: 3,
                                filter: function(event, player) {
                                    return player.countMark("ssr_newyice_trick") > 0 && event.card.name && ['chuqibuyi', 'dongzhuxianji', 'zhujinqiyuan', 'shengdong', 'sha'].contains(event.card.name);
                                },
                                mark: true,
                                marktext: "谏",
                                intro: {
                                    name: "贞侯遗策",
                                    content: "mark",
                                },
                                content: function() {
                                    player.draw();
                                    player.removeMark("ssr_newyice_trick");
                                    if (player.countMark("ssr_newyice_trick") < 1) {
                                        player.removeSkill("ssr_newyice_trick");
                                    }
                                },
                                ai: {
                                    threaten: 1.1,
                                },
                                sub: true,
                            },
                            phase: {
                                trigger: {
                                    player: ["phaseAfter"],
                                },
                                forced: true,
                                locked: false,
                                silent: true,
                                priority: 9,
                                filter: function(event, player) {
                                    return true;
                                },
                                content: function() {
                                    player.storage.ssr_newyice_mark = 1;
                                    player.markSkill('ssr_newyice_mark');
                                    player.syncStorage('ssr_newyice_mark');
                                },
                                sub: true,
                            },
                            lose: {
                                trigger: {
                                    player: ["damageEnd", "loseHpEnd"],
                                },
                                forced: true,
                                locked: false,
                                silent: true,
                                priority: 9,
                                filter: function(event, player) {
                                    return event.num;
                                },
                                content: function() {
                                    player.addMark('ssr_newyice_mark');
                                },
                                sub: true,
                            },
                            mark: {
                                trigger: {
                                    global: "phaseBefore",
                                    player: ["enterGame"],
                                },
                                forced: true,
                                locked: false,
                                silent: true,
                                priority: 19,
                                filter: function(event, player) {
                                    return (event.name != 'phase' || game.phaseNumber == 0);
                                },
                                marktext: "遗",
                                intro: {
                                    name: "贞侯遗策",
                                    content: "mark",
                                },
                                content: function() {
                                    player.storage.ssr_newyice_mark = 1;
                                    player.markSkill('ssr_newyice_mark');
                                    player.syncStorage('ssr_newyice_mark');
                                },
                                sub: true,
                            },
                        },
                        group: ['ssr_newyice_mark', 'ssr_newyice_lose', 'ssr_newyice_phase'],
                        derivation: ['chuqibuyi', 'dongzhuxianji', 'zhujinqiyuan', 'shengdong'],
                        enable: "phaseUse",
                        filterCard: true,
                        selectCard: 1,
                        discard: false,
                        lose: false,
                        delay: 0,
                        audio: 'zuoxing',
                        filter: function(event, player) {
                            return player.countMark('ssr_newyice_mark') > 0;
                        },
                        filterTarget: function(card, player, target) {
                            return player != target;
                        },
                        content: function() {
                            'step 0';
                            var ecards = [];
                            var trick = ['chuqibuyi', 'dongzhuxianji', 'zhujinqiyuan', 'shengdong'];
                            for (var i = 0; i < trick.length; i++) {
                                ecards.push(game.createCard(trick[i]));
                            }
                            //cards.sort(lib.sort.name);
                            var dialog = ui.create.dialog('贞侯遗策', [ecards, 'vcard']);
                            player.chooseButton(dialog).ai = function(button) {
                                return Math.random() * 10;
                            }
                            'step 1';
                            if (result.bool) {
                                //player.chooseUseTarget(result.links[0],true,false);
                                player.removeMark('ssr_newyice_mark');
                                cards.forEach(card =>card.init({
                                    name: result.links[0][2],
                                    suit: get.suit(card),
                                    number: get.number(card)
                                }));
                                player.give(cards, target);
                                if (!target.hasSkill('ssr_newyice_trick')) target.addSkill('ssr_newyice_trick');
                                target.addMark("ssr_newyice_trick");
                            }
                        },
                        check: function(card) {
                            var player = get.owner(card);
                            if (player.hp < 1) return 100 - get.value(card);
                            return 10 - get.value(card);
                        },
                        ai: {
                            order: function(skill, player) {
                                if (player.hp < 1) {
                                    return 1;
                                }
                                return 3;
                            },
                            result: {
                                target: function(player, target) {
                                    return 2;
                                },
                            },
                        },
                    },
                    "ssr_tianyun": {
                        subSkill: {
                            dam: {
                                trigger: {
                                    player: "phaseBegin",
                                },
                                forced: true,
                                content: function() {
                                    "step 0";
                                    player.judge(function(card) {
                                        if (get.suit(card) == 'spade' && get.number(card) > 1 && get.number(card) < 10) return - 1;
                                        return 1;
                                    });
                                    "step 1";
                                    if (!result.bool) {
                                        player.damage('thunder', 'nosource', 'nocard');
                                    }
                                    game.delay();
                                },
                                sub: true,
                            },
                        },
                        locked: true,
                        audio: "tiandu",
                        group: "ssr_tianyun_dam",
                        trigger: {
                            player: "judgeEnd",
                        },
                        frequent: function(event) {
                            if (event.result.card.name == 'du') return false;
                            //if(get.mode()=='guozhan') return false;
                            return true;
                        },
                        check: function(event) {
                            if (event.result.card.name == 'du') return false;
                            return true;
                        },
                        filter: function(event, player) {
                            return get.position(event.result.card, true) == 'o';
                        },
                        content: function() {
                            player.gain(trigger.result.card, 'gain2');
                        },
                    },
                    "ssr_yice": {
                        audio: "yiji",
                        trigger: {
                            player: "damage",
                        },
                        frequent: true,
                        filter: function(event, player) {
                            return event.num > 0;
                        },
                        content: function() {
                            "step 0";
                            event.count = trigger.num;
                            "step 1";
                            event.count--;
                            event.cards = [];
                            //event.cards=get.cards(3);
                            "step 2";
                            var card = get.cardPile(function(card) {
                                for (var a = 0; a < event.cards.length; a++) {
                                    if (get.name(card) == get.name(event.cards[a])) return false;
                                }
                                if (get.type(card) == 'trick' || get.type(card) == 'delay') return true;
                                return false;
                            });
                            if (card) {
                                event.cards = event.cards.concat(card);
                            }
                            if (event.cards.length >= 3 || !card) {
                                event.num = event.cards.length;
                            } else {
                                event.redo();
                            }
                            "step 3";
                            var num = event.num;
                            if (num > 0) {
                                player.chooseCardButton('将' + get.cnNumber(num) + '张〖遗策〗牌分配给任意角色', true, event.cards, [1, num]).set('ai',
                                function(button) {
                                    if (ui.selected.buttons.length == 0) return 1;
                                    return 0;
                                });
                            } else if (num == 1) {
                                event._result = {
                                    links: event.cards.slice(0),
                                    bool: true
                                };
                            } else {
                                event.goto(6);
                            }
                            "step 4";
                            if (result.bool) {
                                for (var i = 0; i < result.links.length; i++) {
                                    event.cards.remove(result.links[i]);
                                    event.num--;
                                }
                                event.togive = result.links.slice(0);
                                player.chooseTarget('将' + get.translation(result.links) + '交给一名角色', true).set('ai',
                                function(target) {
                                    var att = get.attitude(_status.event.player, target);
                                    if (_status.event.enemy) {
                                        return - att;
                                    } else if (att > 0) {
                                        return att / (1 + target.countCards('h'));
                                    } else {
                                        return att / 100;
                                    }
                                }).set('enemy', get.value(event.togive[0], player, 'raw') < 0);
                            }
                            "step 5";
                            if (result.targets.length) {
                                result.targets[0].gain(event.togive, 'draw');
                                player.line(result.targets[0], 'green');
                                game.log(result.targets[0], '获得了' + get.cnNumber(event.togive.length) + '张牌');
                                event.goto(3);
                            }
                            "step 6";
                            if (event.count > 0) player.chooseBool(get.prompt2(event.name)).set('frequentSkill', event.name);
                            else {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                            "step 7";
                            if (result.bool) {
                                player.logSkill(event.name);
                                event.goto(1);
                            }
                        },
                        ai: {
                            maixie: true,
                            "maixie_hp": true,
                            effect: {
                                target: function(card, player, target) {
                                    if (get.tag(card, 'damage')) {
                                        if (player.hasSkillTag('jueqing', false, target)) return [1, -2];
                                        if (!target.hasFriend()) return;
                                        var num = 1;
                                        if (get.attitude(player, target) > 0) {
                                            if (player.needsToDiscard()) {
                                                num = 0.7;
                                            } else {
                                                num = 0.5;
                                            }
                                        }
                                        if (target.hp >= 4) return [1, num * 2];
                                        if (target.hp == 3) return [1, num * 1.5];
                                        if (target.hp == 2) return [1, num * 0.5];
                                    }
                                },
                            },
                        },
                    },
                    "ssr_jianxiong": {
                        audio: "jianxiong",
                        trigger: {
                            player: "damageEnd",
                        },
                        priority: -16,
                        direct: true,
                        filter: function(event, player) {
                            return true;
                        },
                        content: function() {
                            "step 0";
                            if (!trigger.cards) {
                                event.goto(3);
                            } else if (get.itemtype(trigger.cards) != 'cards') {
                                event.goto(3);
                            } else if (get.position(trigger.cards[0], true) != 'o') event.goto(3);
                            "step 1";
                            var cardname = '是否获得';
                            for (var i = 0; i < trigger.cards.length; i++) {
                                if (i > 0) cardname = cardname + '、';
                                cardname = cardname + '【' + get.translation(trigger.cards[i].name) + '(' + get.translation(trigger.cards[i].suit) + trigger.cards[i].number + ')】';
                            }
                            player.chooseControl('确定', '取消',
                            function() {
                                return '确定';
                            }).set('prompt', '奸雄：' + cardname + '？').set('logSkill', 'ssr_jianxiong').setHiddenSkill('ssr_jianxiong');
                            "step 2";
                            if (result.control == '确定') {
                                player.gain(trigger.cards, 'gain2');
                            }
                            "step 3";
                            if (!player.canMoveCard()) {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                            "step 4";
                            var check;
                            if (!player.canMoveCard(true)) {
                                check = false;
                            } else {
                                check = game.hasPlayer(function(current) {
                                    return get.attitude(player, current) > 0 && current.countCards('j');
                                });
                                check = true;
                            }
                            player.chooseToDiscard(get.prompt('ssr_jianxiong'), 'h', '是否弃置一张手牌并移动场上的一张牌？', lib.filter.cardDiscardable).set('ai',
                            function(card) {
                                if (!_status.event.check) return 0;
                                return 7 - get.value(card);
                            }).set('check', check).set('logSkill', 'ssr_jianxiong').setHiddenSkill('ssr_jianxiong');
                            "step 5";
                            if (result.bool) {
                                player.moveCard();
                            }
                        },
                        ai: {
                            maixie: true,
                            "maixie_hp": true,
                            effect: {
                                target: function(card, player, target) {
                                    if (player.hasSkillTag('jueqing', false, target)) return [1, -1];
                                    if (get.tag(card, 'damage') && player != target) return [1, 0.6];
                                },
                            },
                        },
                    },
                    "ssr_tumeng": {
                        subSkill: {
                            card: {
                                marktext: "梦",
                                intro: {
                                    name: "梦中杀人",
                                    content: function(storage, player) {
                                        return '本回合内你的手牌上限-' + storage;
                                    },
                                },
                                charlotte: true,
                                onremove: function(player) {
                                    player.storage.ssr_tumeng_card = 0;
                                },
                                mod: {
                                    maxHandcardBase: function(player, num) {
                                        return num - player.countMark('ssr_tumeng_card');
                                    },
                                },
                            },
                            equip: {
                                trigger: {
                                    global: "phaseBefore",
                                    player: "enterGame",
                                },
                                forced: true,
                                locked: false,
                                priority: 18,
                                filter: function(event, player) {
                                    return (event.name != 'phase' || game.phaseNumber == 0);
                                },
                                content: function() {
                                    player.gain(game.createCard({
                                        name: 'qibaodao',
                                        number: 13,
                                        suit: 'spade'
                                    }));
                                },
                                sub: true,
                            },
                            damage: {
                                trigger: {
                                    player: "damageEnd",
                                },
                                priority: -16,
                                direct: true,
                                filter: function(event, player) {
                                    return true;
                                },
                                content: function() {
                                    "step 0";
                                    if (!trigger.cards) {
                                        event.goto(3);
                                    } else if (get.itemtype(trigger.cards) != 'cards') {
                                        event.goto(3);
                                    } else if (get.position(trigger.cards[0], true) != 'o') event.goto(3);
                                    "step 1";
                                    var cardname = '是否获得';
                                    for (var i = 0; i < trigger.cards.length; i++) {
                                        if (i > 0) cardname = cardname + '、';
                                        cardname = cardname + '【' + get.translation(trigger.cards[i].name) + '(' + get.translation(trigger.cards[i].suit) + trigger.cards[i].number + ')】';
                                    }
                                    player.chooseControl('确定', '取消',
                                    function() {
                                        return '确定';
                                    }).set('prompt', '奸雄：' + cardname + '？').set('logSkill', 'ssr_jianxiong').setHiddenSkill('ssr_jianxiong');
                                    "step 2";
                                    if (result.control == '确定') {
                                        player.gain(trigger.cards, 'gain2');
                                    }
                                    "step 3";
                                    if (!player.canMoveCard()) {
                                        if (event && event.finish) {
                                            event.finish();
                                        } else {
                                            return;
                                        }
                                    }
                                    "step 4";
                                    if (!game.hasPlayer(function(current) {
                                        return current.countCards('e', {
                                            name: 'qibaodao'
                                        });
                                    })) {
                                        if (event && event.finish) {
                                            event.finish();
                                        } else {
                                            return;
                                        }
                                    };
                                    "step 5";
                                    player.moveCard();
                                    "step 6";
                                    if (result.bool) {
                                        game.players.forEach(function(current) {
                                            if (current.countCards('e', {
                                                name: 'qibaodao'
                                            })) {
                                                current.chooseToDiscard('he', '屠梦：受到了【七宝刀】反噬，请弃置一张牌', true);
                                            }
                                        });
                                    }
                                },
                                ai: {
                                    maixie: true,
                                    "maixie_hp": true,
                                    effect: {
                                        target: function(card, player, target) {
                                            if (player.hasSkillTag('jueqing', false, target)) return [1, -1];
                                            if (get.tag(card, 'damage') && player != target) return [1, 0.6];
                                        },
                                    },
                                },
                                sub: true,
                            },
                        },
                        group: ['ssr_tumeng_equip', 'ssr_tumeng_damage'],
                        trigger: {
                            player: ['phaseZhunbeiBegin', 'damageEnd'],
                        },
                        loced: true,
                        forced: true,
                        audio: "rejianxiong",
                        check: function() {
                            return false;
                        },
                        filter: function(event, player) {
                            return true;
                        },
                        priority: 15,
                        content: function() {
                            'step 0';
                            var suitcard = get.cardPile(function(card) {
                                return card.name == 'qibaodao';
                            });
                            if (suitcard) {
                                game.log(player, '获取成功：', suitcard);
                                player.gain(suitcard, 'draw');
                            } else if (_status.currentPhase) {
                                game.log(player, '获取失败：', _status.currentPhase, '本回合手牌上限-1');
                                if (!_status.currentPhase.hasSkill('ssr_tumeng_card')) _status.currentPhase.addTempSkill('ssr_tumeng_card');
                                _status.currentPhase.addMark('ssr_tumeng_card');
                            } else {
                                game.log(player, '获取失败');
                            }
                        },
                    },
                    "ssr_hujia": {
                        global: "ssr_hujia_dam",
                        audio: "sbhujia",
                        derivation: 'feiying',
                        zhuSkill: true,
                        subSkill: {
                            dam: {
                                priority: -10,
                                audio: "sbhujia",
                                trigger: {
                                    player: "dying",
                                },
                                check: function(event, player) {
                                    for (var i = 0; i < game.players.length; i++) {
                                        if (game.players[i].hasZhuSkill('ssr_hujia')) {
                                            return get.attitude(player, game.players[i]) > 0;
                                        }
                                    }
                                },
                                filter: function(event, player) {
                                    if (player.group != 'wei') return false;
                                    return game.hasPlayer(function(current) {
                                        if (!current.hasZhuSkill('ssr_hujia')) return false;
                                        return current != player;
                                    });
                                },
                                content: function() {
                                    "step 0";
                                    player.draw();
                                    event.zhu = [];
                                    for (var i = 0; i < game.players.length; i++) {
                                        if (game.players[i].hasZhuSkill('ssr_hujia')) {
                                            event.zhu.push(game.players[i]);
                                        }
                                    }
                                    if (event.zhu.length > 1) event.goto(3);
                                    "step 1";
                                    player.chooseCard(1, 'he', true, '将一张牌交给' + get.translation(event.zhu[0].name)).set('check',
                                    function(card) {
                                        var val = get.value(card);
                                        if (get.color(card) == 'black') val += 3;
                                        return val;
                                    });
                                    "step 2";
                                    if (result.bool) {
                                        player.give(result.cards, event.zhu[0]);
                                        if (!player.hasSkill('feiying')) player.addTempSkill('feiying');
                                    } {
                                        if (event && event.finish) {
                                            event.finish();
                                        } else {
                                            return;
                                        }
                                    }
                                    "step 3";
                                    player.chooseCardTarget(true, {
                                        position: 'he',
                                        filterCard: true,
                                        selectCard: 1,
                                        filterTarget: function(card, player, target) {
                                            return player != target && target.hasZhuSkill('ssr_hujia');
                                        },
                                        ai1: function(card) {
                                            var val = get.value(card);
                                            if (get.color(card) == 'black') val += 3;
                                            return val;
                                        },
                                        ai2: function(player, target) {
                                            var att = get.attitude(player, target);
                                            return att;
                                        },
                                        prompt: '将一张牌交给发动〖护驾〗的角色',
                                    });
                                    "step 4";
                                    if (result.bool) {
                                        player.give(result.cards, result.targets[0]);
                                        if (!player.hasSkill('feiying')) player.addTempSkill('feiying');
                                    }
                                },
                                ai: {
                                    maixie: true,
                                    "maixie_hp": true,
                                    effect: {
                                        player: function(card, player, target) {
                                            for (var i = 0; i < game.players.length; i++) {
                                                if (game.players[i].hasZhuSkill('ssr_hujia')) {
                                                    var att = get.attitude(player, game.players[i]);
                                                    if (att > 0) return 2;
                                                }
                                            }
                                            return 0;
                                        },
                                        target: function(card, player, target) {
                                            if (player.hasSkillTag('jueqing', false, target)) return [1, -1];
                                            if (get.tag(card, 'damage')) return [1, 0.55];
                                        },
                                    },
                                },
                                sub: true,
                            },
                        },
                    },
                    "ssr_zhujiu": {
                        global: "ssr_zhujiu_jiu",
                        audio: "sbqingzheng",
                        subSkill: {
                            jiu: {
                                usable: 1,
                                audio: "sbqingzheng",
                                enable: "chooseToUse",
                                hiddenCard: function(player, name) {
                                    return (name == 'jiu');
                                },
                                filter: function(event, player) {
                                    if (!game.hasPlayer(function(current) {
                                        return current.hasSkill('ssr_zhujiu');
                                    })) return false;
                                    return event.filterCard({
                                        name: 'jiu',
                                        isCard: true
                                    },
                                    player, event);
                                },
                                check: function(event, player) {
                                    var num = game.countPlayer(function(current) {
                                        return current.hasSkill('ssr_zhujiu') && get.attitude(player, current) > 0;
                                    });
                                    return num >= 1;
                                },
                                content: function() {
                                    'step 0';
                                    event.current = player;
                                    event.okay = false;
                                    'step 1';
                                    if (event.current == player && event.okay) {
                                        {
                                            if (event && event.finish) {
                                                event.finish();
                                            } else {
                                                return;
                                            }
                                        }
                                    } else {
                                        if (event.current == player && !event.okay) event.okay = true;
                                        if (event.current.hasSkill('ssr_zhujiu')) {
                                            var next = event.current.chooseToRespond('煮酒：是否为' + get.translation(player.name) + '打出一张黑色的牌，视为其使用了一张【酒】？', {
                                                color: 'black'
                                            });
                                            next.set('position', 'hes');
                                            next.set('ai',
                                            function(card) {
                                                var event = _status.event;
                                                if (get.attitude(event.player, event.source) > 2) return 10 - get.value(card);
                                                return - 1;
                                            });
                                            next.set('source', player);
                                            next.set('ssr_zhujiu', true);
                                            next.set('skillwarn', '令' + get.translation(player.name) + '使用了一张【酒】');
                                            next.noOrdering = true;
                                            next.autochoose = lib.filter.autoUseJiu;
                                        } else {
                                            event.current = event.current.next;
                                            event.redo();
                                        }
                                    }
                                    "step 2";
                                    if (result.bool) {
                                        if (_status.event.getParent(2).type == 'dying') {
                                            event.dying = player;
                                            event.type = 'dying';
                                        }
                                        player.useCard({
                                            name: 'jiu',
                                            isCard: true
                                        },
                                        result.cards, player);
                                        if (typeof event.current.ai.shown == 'number' && event.current.ai.shown < 0.95) {
                                            event.current.ai.shown += 0.3;
                                            if (event.current.ai.shown > 0.95) event.current.ai.shown = 0.95;
                                        } {
                                            if (event && event.finish) {
                                                event.finish();
                                            } else {
                                                return;
                                            }
                                        }
                                    } else {
                                        event.current = event.current.next;
                                        event.goto(1);
                                    }
                                },
                                ai: {
                                    threaten: 1.4,
                                    order: function() {
                                        return get.order({
                                            name: 'sha'
                                        }) + 0.2;
                                    },
                                    result: {
                                        player: function(player) {
                                            var num = game.countPlayer(function(current) {
                                                return current.hasSkill('ssr_zhujiu') && get.attitude(player, current) > 0;
                                            });
                                            //alert(get.translation(player.name)+'player'+num);
                                            if (num < 1) return 0;
                                            if (_status.event.parent.name == 'phaseUse') {
                                                if (player.countCards('hs', 'jiu') > 0) return 0;
                                                if (player.getEquip('zhuge') && player.countCards('hes', 'sha') > 1) return 0;
                                                if (!player.countCards('hes', 'sha')) return 0;
                                                if (player == _status.currentPhase && player.countCards('hes', {
                                                    name: 'sha',
                                                    color: 'black'
                                                }) == 1 && player.countCards('hes', 'sha') == 1 && player.countCards('hes', {
                                                    color: 'black'
                                                }) == 1) return 0;
                                                var targets = [];
                                                var target;
                                                var players = game.filterPlayer();
                                                for (var i = 0; i < players.length; i++) {
                                                    if (get.attitude(player, players[i]) < 0) {
                                                        if (player.canUse('sha', players[i], true, true)) {
                                                            targets.push(players[i]);
                                                        }
                                                    }
                                                }
                                                if (targets.length) {
                                                    target = targets[0];
                                                } else {
                                                    return 0;
                                                }
                                                var num = get.effect(target, {
                                                    name: 'sha'
                                                },
                                                player, player);
                                                for (var i = 1; i < targets.length; i++) {
                                                    var num2 = get.effect(targets[i], {
                                                        name: 'sha'
                                                    },
                                                    player, player);
                                                    if (num2 > num) {
                                                        target = targets[i];
                                                        num = num2;
                                                    }
                                                }
                                                if (num <= 0) return 0;
                                                var e2 = target.getEquip(2);
                                                if (e2) {
                                                    if (e2.name == 'tengjia') {
                                                        if (!player.countCards('h', {
                                                            name: 'sha',
                                                            nature: 'fire'
                                                        }) && !player.getEquip('zhuque')) return 0;
                                                    }
                                                    if (e2.name == 'renwang') {
                                                        if (!player.countCards('h', {
                                                            name: 'sha',
                                                            color: 'red'
                                                        })) return 0;
                                                    }
                                                    if (e2.name == 'baiyin') return 0;
                                                }
                                                if (player.getEquip('guanshi') && player.countCards('he') > 2) return 1;
                                                return target.countCards('h') > 3 ? 0 : 1;
                                            }
                                            if (player == _status.event.dying) return 3;
                                        },
                                        target: function(player, target) {
                                            var num = game.countPlayer(function(current) {
                                                return current.hasSkill('ssr_zhujiu') && get.attitude(player, current) > 0;
                                            });
                                            //alert(get.translation(player.name)+'target'+num);
                                            if (num < 1) return 0;
                                            if (target && target.isDying()) return 2;
                                            if (target && !target.isPhaseUsing()) return 0;
                                            if (lib.config.mode == 'stone' && !player.isMin()) {
                                                if (player.getActCount() + 1 >= player.actcount) return 0;
                                            }
                                            var shas = player.getCards('h', 'sha');
                                            if (shas.length > 1 && (player.getCardUsable('sha') > 1 || player.countCards('h', 'zhuge'))) {
                                                return 0;
                                            }
                                            shas.sort(function(a, b) {
                                                return get.order(b) - get.order(a);
                                            });
                                            var card;
                                            if (shas.length) {
                                                for (var i = 0; i < shas.length; i++) {
                                                    if (lib.filter.filterCard(shas[i], target)) {
                                                        card = shas[i];
                                                        break;
                                                    }
                                                }
                                            } else if (player.hasSha() && player.needsToDiscard()) {
                                                if (player.countCards('h', 'hufu') != 1) {
                                                    card = {
                                                        name: 'sha'
                                                    };
                                                }
                                            }
                                            if (card && target) {
                                                if (game.hasPlayer(function(current) {
                                                    return (get.attitude(target, current) < 0 && target.canUse(card, current, true, true) && !current.hasSkillTag('filterDamage', null, {
                                                        player: player,
                                                        card: card,
                                                        jiu: true,
                                                    }) && get.effect(current, card, target) > 0);
                                                })) {
                                                    return 1;
                                                }
                                            }
                                            return 0;
                                        },
                                    },
                                    tag: {
                                        save: 1,
                                    },
                                },
                                sub: true,
                            },
                        },
                    },
                    "ssr_wushuang": {
                        shaRelated: true,
                        audio: "wushuang",
                        forced: true,
                        locked: true,
                        group: ["ssr_wushuang_sha", "ssr_wushuang_juedou"],
                        subSkill: {
                            sha: {
                                audio: "wushuang",
                                trigger: {
                                    player: "useCardToPlayered",
                                },
                                priority: 2,
                                forced: true,
                                filter: function(event, player) {
                                    return event.card.name == 'sha' && !event.getParent().directHit.contains(event.target);
                                },
                                logTarget: "target",
                                content: function() {
                                    var id = trigger.target.playerid;
                                    var map = trigger.getParent().customArgs;
                                    if (!map[id]) map[id] = {};
                                    if (typeof map[id].shanRequired == 'number') {
                                        map[id].shanRequired++;
                                    } else {
                                        map[id].shanRequired = 2;
                                    }
                                },
                                ai: {
                                    "directHit_ai": true,
                                    skillTagFilter: function(player, tag, arg) {
                                        if (arg.card.name != 'sha' || arg.target.countCards('h', 'shan') > 1) return false;
                                    },
                                },
                                sub: true,
                            },
                            juedou: {
                                audio: "wushuang",
                                trigger: {
                                    player: "useCardToPlayered",
                                    target: "useCardToTargeted",
                                },
                                priority: 2,
                                forced: true,
                                logTarget: function(trigger, player) {
                                    return player == trigger.player ? trigger.target: trigger.player
                                },
                                filter: function(event, player) {
                                    return event.card.name == 'juedou';
                                },
                                content: function() {
                                    var id = (player == trigger.player ? trigger.target: trigger.player)['playerid'];
                                    var idt = trigger.target.playerid;
                                    var map = trigger.getParent().customArgs;
                                    if (!map[idt]) map[idt] = {};
                                    if (!map[idt].shaReq) map[idt].shaReq = {};
                                    if (!map[idt].shaReq[id]) map[idt].shaReq[id] = 1;
                                    map[idt].shaReq[id]++;
                                },
                                ai: {
                                    "directHit_ai": true,
                                    skillTagFilter: function(player, tag, arg) {
                                        if (arg.card.name != 'juedou' || Math.floor(arg.target.countCards('h', 'sha') / 2) > player.countCards('h', 'sha')) return false;
                                    },
                                },
                                sub: true,
                            },
                        },
                    },
                    "ssr_zhanshen": {
                        subSkill: {
                            juexing: {
                                skillAnimation: true,
                                animationColor: "grey",
                                audio: "shenfen",
                                enable: "phaseUse",
                                unique: true,
                                juexingji: true,
                                filter: function(event, player) {
                                    var num = game.players.length;
                                    return player.countMark('ssr_zhanshen') >= num && !player.storage.ssr_zhanshen_juexing;
                                },
                                check: function(event, player) {
                                    return true;
                                },
                                content: function() {
                                    "step 0";
                                    player.setBackground('shen_lvbu', 'character');
                                    player.flashAvatar('ssr_zhanshen', 'shen_lvbu');
                                    var num = game.players.length;
                                    player.removeMark('ssr_zhanshen', num);
                                    if (player.countCards('e') > 0) player.gain(player.getCards('e'), 'gain2');
                                    player.disableEquip('equip1');
                                    player.disableEquip('equip2');
                                    player.disableEquip('equip3');
                                    player.disableEquip('equip4');
                                    player.disableEquip('equip5');
                                    player.disableJudge();
                                    'step 1';
                                    player.addSkill('ssr_shenwei');
                                    player.addSkill('ssr_shenji');
                                    player.addSkill('ssr_pojia');
                                    game.log(player, '获得了技能', '#g〖破甲〗、〖神威〗和〖神戟〗');
                                    player.awakenSkill('ssr_zhanshen');
                                    player.storage.ssr_zhanshen_juexing = true;
                                },
                                ai: {
                                    order: 15,
                                    result: {
                                        player: function(player) {
                                            return 5;
                                        },
                                    },
                                },
                                sub: true,
                            },
                        },
                        group: "ssr_zhanshen_juexing",
                        derivation: ["ssr_shenwei", "ssr_shenji", "ssr_pojia"],
                        audio: "baonu",
                        marktext: "神",
                        trigger: {
                            source: "damageSource",
                            player: ["damageEnd", "enterGame"],
                            global: "gameDrawAfter",
                        },
                        init: function(player) {
                            player.storage.ssr_zhanshen_juexing = false;
                        },
                        unique: true,
                        juexingji: true,
                        forced: true,
                        filter: function(event, player) {
                            if (player.storage.ssr_zhanshen_juexing) return false;
                            return event.name != 'damage' || event.num > 0;
                        },
                        content: function() {
                            player.addMark('ssr_zhanshen', trigger.name == 'damage' ? trigger.num: 2);
                        },
                        intro: {
                            name: "战神",
                            content: "mark",
                        },
                        ai: {
                            combo: "ssr_zhanshen_juexing",
                            maixie: true,
                            "maixie_hp": true,
                        },
                    },
                    "ssr_shenji": {
                        audio: 'xiuluo',
                        group: ["fangtian_skill", "fangtian_guozhan", "ssr_shenji_equip"],
                        mod: {
                            attackFrom: function(from, to, distance) {
                                return distance - 3;
                            },
                        },
                        subSkill: {
                            equip: {
                                usable: 1,
                                audio: 'xiuluo',
                                enable: "chooseToUse",
                                filterCard: function(card) {
                                    return get.type(card) == 'equip';
                                },
                                viewAs: {
                                    name: "jiu",
                                },
                                viewAsFilter: function(player) {
                                    if (!player.countCards('hes', {
                                        type: 'equip'
                                    }) > 0) return false;
                                    return true;
                                },
                                prompt: "将一张装备牌当【酒】使用",
                                check: function(card) {
                                    if (_status.event.type == 'dying') return 1 / Math.max(0.1, get.value(card));
                                    return 4 - get.value(card);
                                },
                                ai: {
                                    threaten: 1.5,
                                    basic: {
                                        useful: function(card, i) {
                                            if (_status.event.player.hp > 1) {
                                                if (i == 0) return 4;
                                                return 1;
                                            }
                                            if (i == 0) return 7.3;
                                            return 3;
                                        },
                                        value: function(card, player, i) {
                                            if (player.hp > 1) {
                                                if (i == 0) return 5;
                                                return 1;
                                            }
                                            if (i == 0) return 7.3;
                                            return 3;
                                        },
                                    },
                                    order: function() {
                                        return get.order({
                                            name: 'sha'
                                        }) + 1;
                                    },
                                    result: {
                                        target: function(player, target) {
                                            if (target && target.isDying()) return 2;
                                            if (target && !target.isPhaseUsing()) return 0;
                                            if (lib.config.mode == 'stone' && !player.isMin()) {
                                                if (player.getActCount() + 1 >= player.actcount) return 0;
                                            }
                                            var shas = player.getCards('h', 'sha');
                                            if (shas.length > 1 && (player.getCardUsable('sha') > 1 || player.countCards('h', 'zhuge'))) {
                                                return 0;
                                            }
                                            shas.sort(function(a, b) {
                                                return get.order(b) - get.order(a);
                                            });
                                            var card;
                                            if (shas.length) {
                                                for (var i = 0; i < shas.length; i++) {
                                                    if (lib.filter.filterCard(shas[i], target)) {
                                                        card = shas[i];
                                                        break;
                                                    }
                                                }
                                            } else if (player.hasSha() && player.needsToDiscard()) {
                                                if (player.countCards('h', 'hufu') != 1) {
                                                    card = {
                                                        name: 'sha'
                                                    };
                                                }
                                            }
                                            if (card) {
                                                if (game.hasPlayer(function(current) {
                                                    return (get.attitude(target, current) < 0 && target.canUse(card, current, true, true) && !current.hasSkillTag('filterDamage', null, {
                                                        player: player,
                                                        card: card,
                                                        jiu: true,
                                                    }) && get.effect(current, card, target) > 0);
                                                })) {
                                                    return 1;
                                                }
                                            }
                                            return 0;
                                        },
                                    },
                                    tag: {
                                        save: 1,
                                    },
                                },
                            },
                        },
                    },
                    "ssr_shenwei": {
                        subSkill: {
                            use: {
                                audio: 'shenwei',
                                trigger: {
                                    source: "damageBegin",
                                    player: ["recoverBegin", "drawBegin"],
                                },
                                forced: true,
                                content: function() {
                                    trigger.num++;
                                },
                                sub: true,
                            },
                            card: {
                                trigger: {
                                    global: "phaseEnd",
                                },
                                forced: true,
                                audio: 'shenwei',
                                content: function() {
                                    if (player.storage.ssr_shenwei_card.length > 0) player.gain(player.storage.ssr_shenwei_card, 'fromStorage', 'draw');
                                    player.storage.ssr_shenwei_card.length = 0;
                                    player.removeSkill('ssr_shenwei_card');
                                    game.addVideo('storage', player, ['ssr_shenwei_card', get.cardsInfo(player.storage.ssr_shenwei_card), 'cards']);
                                },
                                mark: true,
                                marktext: "神",
                                intro: {
                                    name: "神威",
                                    content: "cardCount",
                                    onunmark: function(storage, player) {
                                        if (storage && storage.length) {
                                            player.$throw(storage, 1000);
                                            game.cardsDiscard(storage);
                                            game.log(storage, '被置入了弃牌堆');
                                            player.storage.ssr_shenwei_card.length = 0;
                                        }
                                    },
                                },
                                sub: true,
                            },
                            sha: {
                                audio: "baonu",
                                trigger: {
                                    source: "damageSource",
                                },
                                filter: function(event, player) {
                                    return event.num > 0 && event.card && event.card.name == 'sha';
                                },
                                frequent: true,
                                content: function() {
                                    'step 0';
                                    player.draw();
                                },
                                sub: true,
                            },
                        },
                        audio: 'shenwei',
                        enable: "phaseUse",
                        init: function(player) {
                            if (!player.storage.ssr_shenwei_card) player.storage.ssr_shenwei_card = [];
                        },
                        filter: function(event, player) {
                            return player.countCards('h') > 0;
                        },
                        usable: 1,
                        content: function() {
                            'step 0';
                            'step 1';
                            player.storage.ssr_shenwei_card = player.storage.ssr_shenwei_card.concat(player.getCards('h'));
                            game.addVideo('storage', player, ['ssr_shenwei_card', get.cardsInfo(player.storage.ssr_shenwei_card), 'cards']);
                            player.lose(player.getCards('h'), ui.special, 'toStorage');
                            'step 2';
                            player.chooseCardButton('从〖神威〗中获得一张牌', true, player.storage.ssr_shenwei_card, 1).set('ai',
                            function(button) {
                                if (get.name(button.link) == 'sha') return 5;
                                return 0;
                            });
                            'step 3';
                            player.storage.ssr_shenwei_card.remove(result.links.slice(0));
                            player.gain(result.links.slice(0), 'draw');
                            player.line(player, 'yellow');
                            game.log(player, '获得了一张牌');
                            'step 4';
                            player.addSkill('ssr_shenwei_card');
                            player.addTempSkill('ssr_wansha');
                            //player.addTempSkill('ssr_shenwei_use',{player:'phaseEnd'});
                        },
                        ai: {
                            order: function(name, player) {
                                var cards = player.getCards('h');
                                if (player.countCards('h', 'sha') == 0) {
                                    return 1;
                                }
                                return get.order({
                                    name: 'sha'
                                }) + 0.5;
                            },
                            result: {
                                player: function(player) {
                                    return 5;
                                },
                            },
                        },
                    },
                    "ssr_liegong_audio": game.zuanSetSSRAudio('liegong_ol_huangzhong', 2),
                    "ssr_liegong": {
                        group: 'ssr_liegong_sha',
                        subSkill: {
                            sha: {
                                trigger: {
                                    source: "damageAfter",
                                },
                                filter: function(event, player) {
                                    return event.card && event.card.name == 'sha' && event.notLink() && event.player.countCards('e') > 0
                                },
                                priority: -4,
                                forced: true,
                                audio: true,
                                content: function() {
                                    "step 0";
                                    event.cards = trigger.player.getCards('e');
                                    "step 1";
                                    player.chooseCardButton('烈弓：是否将' + get.translation(trigger.player.name) + '的一张装备牌置于其武将牌上？', event.cards, 1).set('ai',
                                    function(button) {
                                        if (get.attitude(player, trigger.player) > 0) {
                                            return - get.value(button);
                                        } else {
                                            return get.value(button);
                                        }
                                    });
                                    "step 2";
                                    if (result.bool && result.links) {
                                        var him = trigger.player;
                                        if (!him.hasSkill('ssr_liegong_equip')) {
                                            him.addSkill('ssr_liegong_equip');
                                            him.storage.ssr_liegong_equip = [];
                                        }
                                        him.lose(result.links, ui.special, 'toStorage');
                                        him.$give(result.links, him, false);
                                        him.storage.ssr_liegong_equip = him.storage.ssr_liegong_equip.concat(result.links);
                                        him.storage.ssr_liegong_break = player;
                                        him.markSkill('ssr_liegong_equip');
                                    }
                                },
                                sub: true,
                            },
                            equip: {
                                trigger: {
                                    global: ["phaseBefore", "die"],
                                },
                                filter: function(event, player) {
                                    return event.player == player.storage.ssr_liegong_break;
                                },
                                charlotte: true,
                                forced: true,
                                silent: true,
                                intro: {
                                    name: "丢盔卸甲",
                                    content: "cards",
                                },
                                mark: true,
                                marktext: "碎",
                                content: function() {
                                    'step 0';
                                    event.cards = player.storage.ssr_liegong_equip;
                                    for (var i = 0; i < event.cards.length; i++) {
                                        player.equip(event.cards[i]);
                                    }
                                    'step 1';
                                    player.storage.ssr_liegong_equip = [];
                                    player.removeSkill('ssr_liegong_equip');
                                },
                                sub: true,
                            },
                        },
                        locked: true,
                        forced: true,
                        audio: "liegong_ol_huangzhong",
                        trigger: {
                            player: "useCardToPlayered",
                        },
                        check: function(event, player) {
                            return get.attitude(player, event.target) <= 0;
                        },
                        logTarget: "target",
                        priority: 5,
                        filter: function(event, player) {
                            if (event.card.name != 'sha') return false;
                            return true;
                        },
                        content: function() {
                            'step 0';
                            if (player.countCards('he') > 0) {
                                player.chooseCard('he', get.prompt('ssr_liegong'), '是否弃置一张牌令此【杀】不可被响应？',
                                function(card) {
                                    var value = 1;
                                    if (trigger.player.countCards('hs', {
                                        name: 'shan'
                                    }) || trigger.player.countCards('e', {
                                        name: 'bagua'
                                    })) {
                                        var value = 9;
                                    }
                                    if (get.attitude(player, trigger.player) < 0) return value - get.value(card);
                                    return - 1;
                                });
                            }
                            'step 1';
                            if (result.bool) {
                                player.discard(result.cards);
                                trigger.getParent().directHit.push(trigger.target);
                            }
                        },
                        mod: {
                            targetInRange: function(card, player, target, now) {
                                var name = get.name(card);
                                if (name == 'sha') return true;
                            },
                        },
                    },
                    "ssr_pojia": {
                        subSkill: {
                            ext: {
                                firstDo: true,
                                mark: true,
                                marktext: '裂甲',
                                intro: {
                                    name: '破兵碎甲',
                                    content: '你的防具已失效',
                                },
                                ai: {
                                    "unequip2": true,
                                },
                                init: function(player, skill) {
                                    if (!player.storage[skill]) player.storage[skill] = [];
                                },
                                onremove: true,
                                trigger: {
                                    player: ["damage", "damageCancelled", "damageZero"],
                                    source: ["damage", "damageCancelled", "damageZero"],
                                    target: ["shaMiss", "useCardToExcluded", "useCardToEnd"],
                                    global: ["useCardEnd"],
                                },
                                charlotte: true,
                                filter: function(event, player) {
                                    return player.storage.ssr_pojia_ext && event.card && player.storage.ssr_pojia_ext.contains(event.card) && (event.name != 'damage' || event.notLink());
                                },
                                silent: true,
                                forced: true,
                                popup: false,
                                priority: 12,
                                content: function() {
                                    player.storage.ssr_pojia_ext.remove(trigger.card);
                                    if (!player.storage.ssr_pojia_ext.length) player.removeSkill('ssr_pojia_ext');
                                },
                                sub: true,
                            },
                        },
                        priority: 25,
                        trigger: {
                            player: "useCardToPlayered",
                        },
                        filter: function(event) {
                            return event.card.name == 'sha';
                        },
                        forced: true,
                        audio: "sbliegong",
                        logTarget: "target",
                        content: function() {
                            trigger.target.addTempSkill('ssr_pojia_ext');
                            trigger.target.storage.ssr_pojia_ext.add(trigger.card);
                        },
                        ai: {
                            "unequip_ai": true,
                            skillTagFilter: function(player, tag, arg) {
                                if (arg && arg.name == 'sha') return true;
                                return false;
                            },
                        },
                    },
                    "ssr_wansha": {
                        subSkill: {
                            kill: {
                                mod: {
                                    cardSavable: function(card, player) {
                                        if (!_status.currentPhase) return;
                                        if (_status.currentPhase.isAlive() && _status.currentPhase.hasSkill('ssr_wansha') && _status.currentPhase != player) {
                                            if (card.name == 'tao' && !player.isDying()) return false;
                                        }
                                    },
                                    cardEnabled: function(card, player) {
                                        if (!_status.currentPhase) return;
                                        if (_status.currentPhase.isAlive() && _status.currentPhase.hasSkill('ssr_wansha') && _status.currentPhase != player) {
                                            if (card.name == 'tao' && !player.isDying()) return false;
                                        }
                                    },
                                },
                                sub: true,
                            },
                        },
                        locked: true,
                        audio: "wansha",
                        global: "ssr_wansha_kill",
                        trigger: {
                            global: "dying",
                        },
                        priority: 15,
                        forced: true,
                        filter: function(event, player, name) {
                            return _status.currentPhase == player && event.player != player;
                        },
                        content: function() {},
                    },
                    "ssr_newganglie": {
                        subSkill: {
                            sha: {
                                audio: "fenyong",
                                shaRelated: true,
                                trigger: {
                                    player: "useCardToPlayered",
                                },
                                check: function(event, player) {
                                    return get.attitude(player, event.target) <= 0;
                                },
                                filter: function(event, player) {
                                    return event.card.name == 'sha' && player.countCards('h') > 1 && event.target.countCards('h') > 1;
                                },
                                'prompt2': '当你使用【杀】指定一名其他角色为目标后，若你和该角色的手牌数均大于一，你可以令你和该角色各随机保留一张手牌然后弃置其他的手牌。',
                                logTarget: "target",
                                preHidden: true,
                                content: function() {
                                    "step 0";
                                    player.discard(player.getCards('h').randomGets(player.countCards('h') - 1));
                                    trigger.target.discard(trigger.target.getCards('h').randomGets(trigger.target.countCards('h') - 1));
                                },
                                ai: {
                                    "directHit_ai": true,
                                    skillTagFilter: function(player, tag, arg) {
                                        if (get.attitude(player, arg.target) > 0 || arg.card.name != 'sha' || !ui.cardPile.firstChild || get.color(ui.cardPile.firstChild, player) != 'red') return false;
                                    },
                                },
                                sub: true,
                            },
                        },
                        group: 'ssr_newganglie_sha',
                        audio: "reganglie",
                        trigger: {
                            player: "damageEnd",
                        },
                        filter: function(event, player) {
                            return (event.source != undefined);
                        },
                        check: function(event, player) {
                            return (get.attitude(player, event.source) <= 0);
                        },
                        'prompt2': '当你受到伤害后，你可以视为对伤害来源使用一张【杀】。',
                        logTarget: "source",
                        content: function() {
                            "step 0";
                            player.useCard({
                                name: 'sha'
                            },
                            trigger.source);
                        },
                        ai: {
                            "maixie_defend": true,
                            effect: {
                                target: function(card, player, target) {
                                    if (player.hasSkillTag('jueqing', false, target)) return [1, -1];
                                    return 0.8;
                                },
                            },
                        },
                    },
                    "ssr_ganglie": {
                        audio: "ganglie",
                        trigger: {
                            player: "damageEnd",
                        },
                        filter: function(event, player) {
                            return (event.source != undefined);
                        },
                        check: function(event, player) {
                            return (get.attitude(player, event.source) <= 0);
                        },
                        logTarget: "source",
                        content: function() {
                            "step 0";
                            event.num = trigger.num;
                            'step 1';
                            player.useCard({
                                name: 'sha'
                            },
                            trigger.source);
                            'step 2';
                            if (result.bool);
                            else {
                                if (trigger.source.countDiscardableCards(player, 'he')) {
                                    player.discardPlayerCard('he', trigger.source, true);
                                }
                            }
                            'step 3';
                            event.num--;
                            if (event.num > 0) {
                                event.goto(1);
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                        },
                        ai: {
                            "maixie_defend": true,
                            effect: {
                                target: function(card, player, target) {
                                    if (player.hasSkillTag('jueqing', false, target)) return [1, -1];
                                    return 0.8;
                                    // if(get.tag(card,'damage')&&get.damageEffect(target,player,player)>0) return [1,0,0,-1.5];
                                },
                            },
                        },
                    },
                    "ssr_danjing": {
                        audio: "fenyong",
                        trigger: {
                            player: "damageEnd",
                        },
                        filter: function(event, player) {
                            return event.card && event.card.name == 'wanjian';
                        },
                        forced: true,
                        content: function() {
                            "step 0";
                            player.recover();
                        },
                        ai: {
                            notrick: true,
                            notricksource: true,
                            effect: {
                                target: function(card, player, target, current) {
                                    if (get.name(card) == 'wanjian' && get.tag(card, 'damage')) {
                                        return 'zeroplayertarget';
                                    }
                                },
                            },
                        },
                    },
                    "ssr_chuli": {
                        subSkill: {
                            spade: {
                                charlotte: true,
                                sub: true,
                            },
                            club: {
                                charlotte: true,
                                sub: true,
                            },
                            diamond: {
                                charlotte: true,
                                sub: true,
                            },
                            heart: {
                                charlotte: true,
                                sub: true,
                            },
                            forbid: {
                                charlotte: true,
                                sub: true,
                            },
                            draw: {
                                //mark:true,
                                marktext: "痊",
                                onremove: function(player, skill) {
                                    if (player.countMark('ssr_chuli_draw') > 0) {
                                        var num = player.countMark('ssr_chuli_draw');
                                        player.removeMark('ssr_chuli_draw', num);
                                        player.draw(num);
                                    }
                                    player.unmarkSkill('ssr_chuli_draw');
                                },
                                intro: {
                                    name: "久病初愈",
                                    content: 'mark',
                                },
                            },
                        },
                        mark: true,
                        marktext: "药",
                        audio: "new_reqingnang",
                        enable: "phaseUse",
                        init: function(player) {
                            if (!player.storage.ssr_chuli) player.storage.ssr_chuli = [];
                        },
                        filter: function(event, player) {
                            return ! player.hasSkill('ssr_chuli_forbid');
                        },
                        filterTarget: function(card, player, target) {
                            return target.countCards('h');
                        },
                        content: function() {
                            "step 0";
                            player.choosePlayerCard(target, 'h', true).set('ai',
                            function(card) {
                                var value = 1000;
                                var suit = ['spade', 'club', 'diamond', 'heart'];
                                var suits = [0, 0, 0, 0];
                                var storage = player.storage.ssr_chuli;
                                for (var i = 0; i < storage.length; i++) {
                                    for (var j = 0; j < suit.length; j++) {
                                        if (get.suit(storage[i]) == suit[j]) {
                                            suits[j]++;
                                        }
                                    }
                                }
                                if (player.hasSkill('ssr_chuli_' + get.suit(card))) {
                                    value -= 3;
                                }
                                for (var i = 0; i < suit.length; i++) {
                                    if (get.suit(card) == suit[i]) {
                                        return value - suits[i];
                                    }
                                }
                            });
                            "step 1";
                            if (result.bool) {
                                player.storage.ssr_chuli = player.storage.ssr_chuli.concat(result.links);
                                player.markSkill('ssr_chuli');
                                player.syncStorage('ssr_chuli');
                                target.lose(result.links, ui.special, 'toStorage');
                                target.$give(result.links, player, false);
                                target.recover();
                                //if(target==player||target.getDamagedHp()>0) {
                                if (get.type(result.links[0]) == 'basic' || target == player) {
                                    //target.draw();
                                    //target.recover();
                                    target.addTempSkill('ssr_chuli_draw');
                                    target.addMark('ssr_chuli_draw');
                                }
                                if (get.suit(result.links)) {
                                    if (player.hasSkill('ssr_chuli_' + get.suit(result.links))) {
                                        player.addTempSkill('ssr_chuli_forbid');
                                    } else {
                                        player.addTempSkill('ssr_chuli_' + get.suit(result.links));
                                    }
                                }
                            }
                        },
                        intro: {
                            name: "灵丹妙药",
                            //content:"cards",
                            content: function(storage, player, skill) {
                                var said = '◈本回合已获得过的花色：';
                                var suit = ['spade', 'club', 'diamond', 'heart'];
                                var gets = false;
                                for (var i = 0; i < suit.length; i++) {
                                    if (player.hasSkill('ssr_chuli_' + suit[i])) {
                                        if (gets) var said = said + '、';
                                        var said = said + get.translation(suit[i]);
                                        gets = true;
                                    }
                                }
                                if (!gets) {
                                    var said = '◈本回合尚未获得过任何花色';
                                }
                                if (player.hasSkill('ssr_chuli_forbid')) {
                                    var said = said + '<br>(本回合内你不能再使用〖除疠〗)';
                                }
                                var suits = [0, 0, 0, 0];
                                for (var i = 0; i < storage.length; i++) {
                                    for (var j = 0; j < suit.length; j++) {
                                        if (get.suit(storage[i]) == suit[j]) {
                                            suits[j]++;
                                        }
                                    }
                                }
                                for (var i = 0; i < suit.length; i++) {
                                    var said = said + '<li>拥有' + get.translation(suit[i]) + '花色共' + suits[i] + '张';
                                }
                                return said;
                            },
                            onunmark: function(storage, player) {
                                if (storage && storage.length) {
                                    player.$throw(storage, 1000);
                                    game.cardsDiscard(storage);
                                    game.log(storage, '被置入了弃牌堆');
                                    storage.length = 0;
                                }
                            },
                        },
                        ai: {
                            threaten: 1.5,
                            result: {
                                target: function(player, target) {
                                    if (player == target) {
                                        var value = 4;
                                        var suit = ['spade', 'club', 'diamond', 'heart'];
                                        for (var i = 0; i < player.storage.ssr_chuli.length; i++) {
                                            for (var j = 0; j < suit.length; j++) {
                                                if (get.suit(player.storage.ssr_chuli[i]) == suit[j]) {
                                                    value--;
                                                }
                                            }
                                        }
                                        if (player.needsToDiscard() > 0) value++;
                                        return target.maxHp - target.hp + value;
                                    }
                                    if (target.hp == target.maxHp) {
                                        return - target.countCards('h');
                                    } else {
                                        return target.maxHp - target.hp;
                                    }
                                },
                            },
                            order: 10,
                            expose: 0.2,
                        },
                    },
                    "ssr_xianfang": {
                        subSkill: {
                            used: {
                                sub: true,
                            },
                        },
                        audio: "mbyouyi",
                        skillAnimation: true,
                        animationColor: "green",
                        trigger: {
                            global: "dying",
                        },
                        priority: -7,
                        filter: function(event, player) {
                            if (player.hasSkill('ssr_xianfang_used')) return false;
                            if (event.player.hp > 0) return false;
                            if (player.storage.ssr_chuli && player.storage.ssr_chuli.length) {
                                for (var i = 0; i < player.storage.ssr_chuli.length; i++) {
                                    if (get.suit(player.storage.ssr_chuli[i]) == 'spade') var spade = true;
                                    if (get.suit(player.storage.ssr_chuli[i]) == 'club') var club = true;
                                    if (get.suit(player.storage.ssr_chuli[i]) == 'diamond') var diamond = true;
                                    if (get.suit(player.storage.ssr_chuli[i]) == 'heart') var heart = true;
                                }
                                if (spade && club && diamond && heart) return true;
                            }
                        },
                        check: function(event, player) {
                            var att = get.attitude(player, event.player);
                            return att > 0;
                        },
                        content: function() {
                            "step 0";
                            player.addTempSkill('ssr_xianfang_used', {
                                player: 'phaseBefore'
                            });
                            for (var i = 0; i < player.storage.ssr_chuli.length; i++) {
                                if (get.suit(player.storage.ssr_chuli[i]) == 'spade' && !spade) {
                                    var spade = true;
                                    player.storage.ssr_chuli.remove(player.storage.ssr_chuli[i]);
                                }
                                if (get.suit(player.storage.ssr_chuli[i]) == 'club' && !club) {
                                    var club = true;
                                    player.storage.ssr_chuli.remove(player.storage.ssr_chuli[i]);
                                }
                                if (get.suit(player.storage.ssr_chuli[i]) == 'diamond' && !diamond) {
                                    var diamond = true;
                                    player.storage.ssr_chuli.remove(player.storage.ssr_chuli[i]);
                                }
                                if (get.suit(player.storage.ssr_chuli[i]) == 'heart' && !heart) {
                                    var heart = true;
                                    player.storage.ssr_chuli.remove(player.storage.ssr_chuli[i]);
                                }
                            }
                            trigger.player.recover(2);
                            trigger.player.draw(2);
                            player.markSkill('ssr_chuli');
                            player.update();
                        },
                        ai: {
                            save: true,
                            expose: 0.3,
                            result: {
                                target: 15,
                            },
                        },
                    },
                    "ssr_newyizhong": {
                        subSkill: {
                            red: {
                                charlotte: true,
                                forced: true,
                                intro: {
                                    name: "弃兵曳甲",
                                    content: "下个准备阶段你不能再发动〖毅重〗恢复体力。",
                                },
                                mark: true,
                                marktext: "溃甲",
                                sub: true,
                            },
                            dam: {
                                trigger: {
                                    player: 'damageBefore'
                                },
                                priority: 25,
                                forced: true,
                                check: function() {
                                    return false;
                                },
                                filter: function(event, player) {
                                    return event.card && event.card.name == 'sha' && get.color(event.card) == 'red';
                                },
                                content: function() {
                                    player.addTempSkill('ssr_newyizhong_red', {
                                        player: 'phaseAfter'
                                    });
                                },
                                sub: true,
                            },
                            rec: {
                                trigger: {
                                    player: 'phaseZhunbeiBegin'
                                },
                                filter: function(event, player) {
                                    if (player.hasSkill('ssr_newyizhong_red')) {
                                        player.removeSkill('ssr_newyizhong_red');
                                        return false;
                                    }
                                    return player.hujia > 0;
                                },
                                audio: 'sbjieyue',
                                forced: true,
                                priority: 5,
                                content: function() {
                                    "step 0";
                                    event.cards = get.cards(player.hujia);
                                    game.cardsGotoOrdering(event.cards);
                                    player.showCards(event.cards);
                                    "step 1";
                                    var num = 0;
                                    for (var i = 0; i < event.cards.length; i++) {
                                        if (get.suit(event.cards[i]) == 'spade') {
                                            num++;
                                            event.cards.splice(i--, 1);
                                        }
                                    }
                                    if (num) {
                                        player.recover(num);
                                        player.changeHujia( - num, null, true);
                                    }
                                },
                                ai: {
                                    threaten: function(player, target) {
                                        if (target.hp == 1) return 2;
                                        return 1;
                                    },
                                },
                                sub: true,
                            },
                        },
                        trigger: {
                            player: "damageBefore",
                        },
                        loced: true,
                        forced: true,
                        group: ['ssr_newyizhong_rec', 'ssr_newyizhong_dam'],
                        audio: "sbxiayuan",
                        check: function() {
                            return false;
                        },
                        filter: function(event, player) {
                            return player.getHp() > 1;
                        },
                        priority: 15,
                        content: function() {
                            'step 0';
                            event.num = trigger.num;
                            event.hujia = 0;
                            'step 1';
                            if (trigger.num < 1 || (player.getHp() - event.hujia <= 1)) event.goto(3);
                            //{if(event&&event.finish){event.finish();}else {return;}}
                            'step 2';
                            trigger.num--;
                            //player.loseHp();
                            //player.changeHujia(1,null,true);
                            event.hujia++;
                            event.goto(1);
                            'step 3';
                            player.loseHp(event.hujia);
                            player.changeHujia(event.hujia, null, true);
                        },
                        mod: {
                            maxHandcardBase: function(player, num) {
                                if (player.hujia) return num + player.hujia;
                            },
                        },
                        ai: {
                            effect: {
                                target: function(card, player, target, current) {},
                            },
                        },
                        "_priority": 0,
                    },
                    "ssr_yizhong": {
                        group: "ssr_yizhong_jia",
                        locked: true,
                        audio: "yizhong",
                        trigger: {
                            player: "damageEnd",
                        },
                        forced: true,
                        check: function(event, player) {
                            if (player == event.player) return true;
                            return false;
                        },
                        filter: function(event, player) {
                            if (event.card && get.color(event.card) == 'red') return false;
                            return true;
                        },
                        content: function() {
                            player.addMark('ssr_yizhong_jia', trigger.num);
                        },
                        subSkill: {
                            jia: {
                                audio: 'jieyue',
                                preHidden: true,
                                trigger: {
                                    player: ["damageBegin"],
                                },
                                forced: true,
                                locked: true,
                                priority: -30,
                                filter: function(event, player) {
                                    return event.num > 0 && player.countMark('ssr_yizhong_jia') > 0;
                                },
                                content: function() {
                                    if (trigger.num > player.countMark('ssr_yizhong_jia')) {
                                        var num = player.countMark('ssr_yizhong_jia');
                                    } else {
                                        var num = trigger.num;
                                    }
                                    if (trigger.name == 'damage') {
                                        if (trigger.animate !== false) {
                                            player.$damage(trigger.source);
                                            if (window.zuanDamageAudio) game.playAudio('..', 'extension', '祖安武将', 'audio', 'hudun.mp3');
                                            game.broadcastAll(function(nature, player) {
                                                if (lib.config.animation && !lib.config.low_performance) {
                                                    if (nature == 'fire') {
                                                        player.$fire();
                                                    } else if (nature == 'thunder') {
                                                        player.$thunder();
                                                    }
                                                }
                                            },
                                            trigger.nature, player);
                                            player.$damagepop( - num, trigger.nature);
                                        }
                                    }
                                    game.log(player, '的护甲抵挡了', get.cnNumber(num), '点伤害');
                                    player.removeMark('ssr_yizhong_jia', num);
                                    trigger.num -= num;
                                },
                                marktext: "甲",
                                intro: {
                                    name: "铁甲钢躯",
                                    content: "mark",
                                },
                                mod: {
                                    maxHandcardBase: function(player, num) {
                                        return num + player.countMark('ssr_yizhong_jia');
                                    },
                                },
                                sub: true,
                            },
                        },
                    },
                    "ssr_zhenjun": {
                        audio: "jieyue",
                        subSkill: {
                            break: {
                                trigger: {
                                    global: ["phaseBefore", "die"],
                                },
                                filter: function(event, player) {
                                    return event.player == player.storage.ssr_zhenjun_break;
                                },
                                charlotte: true,
                                forced: true,
                                silent: true,
                                intro: {
                                    name: "铁令如山",
                                    content: "你不能使用或打出黑色的牌。",
                                },
                                mark: true,
                                marktext: "禁令",
                                content: function() {
                                    player.removeSkill('ssr_zhenjun_break');
                                },
                                mod: {
                                    cardSavable: function(card, player) {
                                        if (get.color(card) == 'black') return false;
                                    },
                                    cardEnabled: function(card, player) {
                                        if (get.color(card) == 'black') return false;
                                    },
                                    cardResponsabled: function(card, player) {
                                        if (get.color(card) == 'black') return false;
                                    },
                                },
                                sub: true,
                            },
                        },
                        enable: "phaseUse",
                        filterCard: function(card) {
                            return get.suit(card) == 'spade';
                        },
                        selectCard: function() {
                            return 1;
                        },
                        filter: function(event, player) {
                            return player.countCards('he', {
                                suit: 'spade'
                            }) > 0;
                        },
                        filterTarget: function(card, player, target) {
                            if (player == target) return false;
                            if (target.hasSkill('ssr_zhenjun_break')) return false;
                            return true;
                        },
                        content: function() {
                            "step 0";
                            target.storage.ssr_zhenjun_break = player;
                            "step 1";
                            target.addSkill('ssr_zhenjun_break');
                        },
                        check: function(card) {
                            return 10 - get.value(card);
                        },
                        position: "he",
                        ai: {
                            order: 9,
                            result: {
                                target: function(player, target) {
                                    if (!ui.selected.cards.length) {
                                        if (player.hp < 2) return 0;
                                    }
                                    return - target.countCards('h', {
                                        color: 'black'
                                    });
                                },
                            },
                            threaten: 1.2,
                        },
                    },
                    "ssr_newzhenjun": {
                        audio: "decadezhenjun",
                        subSkill: {
                            break: {
                                trigger: {
                                    global: ["phaseBefore", "die"],
                                },
                                filter: function(event, player) {
                                    return event.player == player.storage.ssr_newzhenjun_break;
                                },
                                charlotte: true,
                                forced: true,
                                silent: true,
                                intro: {
                                    name: "铁令如山",
                                    content: "你不能使用或打出黑色的牌且防具失效。",
                                },
                                mark: true,
                                marktext: "禁令",
                                content: function() {
                                    player.removeSkill('ssr_newzhenjun_break');
                                },
                                ai: {
                                    "unequip2": true,
                                },
                                mod: {
                                    cardSavable: function(card, player) {
                                        if (get.color(card) == 'black') return false;
                                    },
                                    cardEnabled: function(card, player) {
                                        if (get.color(card) == 'black') return false;
                                    },
                                    cardResponsabled: function(card, player) {
                                        if (get.color(card) == 'black') return false;
                                    },
                                },
                                sub: true,
                            },
                        },
                        usable: 2,
                        enable: "phaseUse",
                        filter: function(event, player) {
                            return true;
                        },
                        filterTarget: function(card, player, target) {
                            if (player == target) return false;
                            if (target.hasSkill('ssr_newzhenjun_break')) return false;
                            return true;
                        },
                        content: function() {
                            "step 0";
                            player.damage('nosource');
                            target.storage.ssr_newzhenjun_break = player;
                            "step 1";
                            if (player.isAlive()) target.addSkill('ssr_newzhenjun_break');
                        },
                        ai: {
                            basic: {
                                order: 1,
                            },
                            result: {
                                player: function(player) {
                                    if (player.hp < 3) return - 2;
                                    return 0.5;
                                },
                                target: function(player) {
                                    if (player.hp < 2) return 0;
                                    return - 1.5;
                                },
                            },
                        },
                    },
                    "ssr_qianxing": {
                        //代码请参考游戏原生技能〖潜行〗#qianxing。
                    },
                    "ssr_jiahe": {
                        priority: -14,
                        audio: 'xinsheng',
                        preHidden: true,
                        trigger: {
                            target: "useCardToTargeted",
                        },
                        filter: function(event, player) {
                            return player == event.target && get.tag(event.card, 'damage') > 0;
                        },
                        frequent: true,
                        content: function() {
                            player.addTempSkill('qianxing', {
                                player: 'phaseBefore'
                            });
                        },
                        ai: {
                            effect: {
                                target: function(card, player, target) {
                                    if (card.name == 'sha' || card.name == 'juedou') return [1, 0.6];
                                },
                            },
                        },
                    },
                    "ssr_newjiahe": {
                        subSkill: {
                            qianxing: {
                                mark: true,
                                marktext: '潜行',
                                nopop: true,
                                init: function(player) {
                                    game.log(player, '获得了', '【潜行】');
                                },
                                intro: {
                                    name: "驾鹤仙归",
                                    content: "锁定技，你不能成为其他角色的卡牌的目标",
                                },
                                mod: {
                                    targetEnabled: function(card, player, target) {
                                        if (player != target) return false;
                                    },
                                },
                                onremove: function(player, skill) {
                                    player.storage.ssr_newjiahe_qianxing = 0;
                                    player.syncStorage('ssr_newjiahe_qianxing');
                                    player.unmarkSkill('ssr_newjiahe_qianxing');
                                },
                                trigger: {
                                    global: "phaseEnd",
                                },
                                firstDo: true,
                                direct: true,
                                silent: true,
                                filter: function(event, player) {
                                    return true;
                                },
                                content: function() {
                                    if (player.countMark('ssr_newjiahe_qianxing') > 0) {
                                        player.removeMark('ssr_newjiahe_qianxing');
                                    }
                                    if (player.countMark('ssr_newjiahe_qianxing') < 1) {
                                        player.removeSkill('ssr_newjiahe_qianxing');
                                    }
                                },
                                "_priority": 0,
                                sub: true,
                            },
                        },
                        priority: -14,
                        audio: 'xinsheng',
                        preHidden: true,
                        trigger: {
                            target: "useCardToTargeted",
                        },
                        filter: function(event, player) {
                            return player == event.target && get.tag(event.card, 'damage') > 0;
                        },
                        frequent: true,
                        content: function() {
                            if (!player.hasSkill('ssr_newjiahe_qianxing')) player.addTempSkill('ssr_newjiahe_qianxing', {
                                player: 'phaseBefore'
                            });
                            player.storage.ssr_newjiahe_qianxing = 1 + player.getDamagedHp();
                            player.syncStorage('ssr_newjiahe_qianxing');
                            player.markSkill('ssr_newjiahe_qianxing');
                        },
                        ai: {
                            effect: {
                                target: function(card, player, target) {
                                    if (get.tag(card, 'damage') > 0) return [1, 0.6];
                                },
                            },
                        },
                    },
                    "ssr_shendao": {
                        subSkill: {
                            fu: {
                                audio: "huashen2",
                                trigger: {
                                    //player:"phaseJieshuAfter",
                                    global: 'phaseAfter',
                                },
                                priority: -5,
                                direct: true,
                                forced: true,
                                preHidden: true,
                                content: function() {
                                    "step 0";
                                    if (!player.storage.ssr_shendao_fuskill) player.storage.ssr_shendao_fuskill = [];
                                    if (!player.storage.ssr_shendao_fu) player.storage.ssr_shendao_fu = [];
                                    var skills = player.storage.ssr_shendao_fuskill;
                                    var him = player.storage.ssr_shendao_fu;
                                    for (var i = skills.length - 1; i >= 0; i--) {
                                        //alert(player.storage[skills[i]]);
                                        if (player.storage[skills[i]] === true) {
                                            var skl = skills[i].slice(0);
                                            player.logSkill('ssr_shendao_fu');
                                            player.removeSkill(skills[i]);
                                            player.storage[skills[i]] = false;
                                            player.storage.ssr_shendao_fuskill.remove(skills[i]);
                                            player.storage.ssr_shendao_fu.remove(him[i]);
                                            player.markSkill('ssr_shendao_fu');
                                            game.log(player, '失去了一张神符·' + get.translation(skl));
                                        }
                                    }
                                    "step 1";
                                    if (player.storage.ssr_shendao_fu.length < 1) {
                                        player.removeSkill('ssr_shendao_fu');
                                        //if(player.identity!='zhu') player.isZhu=false;
                                    }
                                },
                                mark: true,
                                marktext: "符",
                                intro: {
                                    name: "幻化神符",
                                    content: "characters",
                                },
                                sub: true,
                            },
                        },
                        audio: "rehuashen",
                        enable: "phaseUse",
                        filterCard: true,
                        usable: 1,
                        check: function(card) {
                            return 9 - get.value(card);
                        },
                        selectCard: 2,
                        filterTarget: function(card, player, target) {
                            if (target.hasSkill('ssr_shendao_fu') && target.storage.ssr_shendao_fuskill) {
                                var num = target.storage.ssr_shendao_fuskill.length;
                            } else {
                                var num = 0;
                            }
                            return true || num < 2;
                        },
                        filter: function(event, player) {
                            return player.countCards('h') >= 2;
                        },
                        /*init:function(player){
		                    var characterslist=[];
		                    var skillslist=[];
		                    var lengthslist=[];
		                    var characterPack=lib.character;
		                    var skillPack=lib.skill;
		                    for(var i in characterPack){
		                        if(characterPack[i][3].length<1) continue;
		                        if(characterPack[i][4].contains('forbidai')) continue;
		                        if(characterPack[i][4].contains('boss')) continue;
		                        if(characterPack[i][4].contains('minskin')) continue;
		                        var skills=characterPack[i][3];
		                        for(var a=0;a<skills.length;a++) {
		                            var info=skillPack[skills[a]];
		                            if(info.limited) {
		                                characterslist.push(i);
		                                skillslist.push(skills[a]);
		                                lengthslist.push(lengthslist.length);
		                            }
		                        }
		                        //characters.push(i);
		                    }
		                    game.ssr_shendao_characterslist=characterslist;
		                    game.ssr_shendao_skillslist=skillslist;
		                    game.ssr_shendao_lengthslist=lengthslist;
		                },*/
                        //prepare:"give",
                        content: function() { //ssdao
                            "step 0";
                            var characterslist = [];
                            var skillslist = [];
                            var lengthslist = [];
                            var characterPack = lib.character;
                            var skillPack = lib.skill;
                            event.skillType = 'none';
                            if (get.color(cards[0]) == 'red' && get.color(cards[1]) == 'red') event.skillType = 'recover';
                            if (get.color(cards[0]) == 'black' && get.color(cards[1]) == 'black') event.skillType = 'damage';
                            for (var i in characterPack) {
                                if (!characterPack[i]) continue;
                                if (characterPack[i][3].length < 1) continue;
                                if (lib.character[i][4]) {
                                    if (characterPack[i][4].contains('forbidai')) continue;
                                    if (characterPack[i][4].contains('boss')) continue;
                                    if (characterPack[i][4].contains('minskin')) continue;
                                    if (characterPack[i][4].contains('hiddenboss')) continue;
                                }
                                if (get.config('double_character') && lib.config.forbiddouble.contains(i)) continue;
                                var skills = characterPack[i][3];
                                //要ban的技能
                                var banskills = ['sbzhangwu', 'xinfu_tunjun'];
                                for (var a = 0; a < skills.length; a++) {
                                    var info = skillPack[skills[a]];
                                    //是限定技
                                    if (!info.limited) continue;
                                    //不是主公技（兴衰给我整麻了）
                                    if (info.zhuSkill) continue;
                                    //没有这个技能
                                    if (target.hasSkill(skills[a])) continue;
                                    //禁止刷到的技能（一般不能释放）
                                    if (banskills.contains(skills[a])) continue;
                                    //列表重复
                                    if (skillslist.contains(skills[a])) continue;
                                    //跟标记无关
                                    if (info.filter) {
                                        var filter = info.filter.toString();
                                        if (filter.indexOf('countMark') != -1) continue;
                                    }
                                    //添加check使用
                                    if (!info.check) {
                                        if (info.filterCard) {
                                            info.check = function(card) {
                                                return 15 - get.value(card);
                                            };
                                        } else {
                                            info.check = function(event, player) {
                                                return true;
                                            };
                                        }
                                    }
                                    //修复那些死活不放技能的ai
                                    if (info.filterTarget && !info.ai) {
                                        var targetai = Math.floor(Math.random() * 100) / 10 - 6;
                                        var orderai = Math.floor(Math.random() * 100) / 10;
                                        info.ai = {
                                            order: orderai,
                                            result: {
                                                player: 1,
                                                target: targetai,
                                            },
                                        };
                                    }
                                    characterslist.push(i);
                                    skillslist.push(skills[a]);
                                    //if(skills[a]=='zhafu') event.zhafu=lengthslist.length;
                                    lengthslist.push(lengthslist.length);
                                }
                                //characters.push(i);
                            }
                            event.characterslist = characterslist;
                            event.skillslist = skillslist;
                            event.lengthslist = lengthslist;
                            event.yuansu = ['feng', 'huo', 'shan', 'lin', 'tian'];
                            event.yuansuname = ['飓风', '业火', '群山', '秀林', '苍天'];
                            event.shenfu = [];
                            for (var i = 0; i < event.yuansu.length; i++) {
                                var name = event.yuansu[i];
                                lib.card['shendao_' + name] = {
                                    fullskin: true,
                                    image: 'ext:祖安武将/card/shendao_' + name + '.png',
                                    opacity: 1,
                                    textShadow: 'black 0 0 2px',
                                };
                                lib.translate['shendao_' + name] = event.yuansuname[i];
                                lib.translate['shendao_' + name + '_info'] = "<li>幻化神符";
                                event.shenfu.push(game.createCard({
                                    name: 'shendao_' + name,
                                    number: "神",
                                    suit: "符"
                                }));
                            }
                            /*for(var i=0;i<3;i++) {
		                        var card=event.shenfu.randomGet();
		                        player.showCards(card);
		                        event.shenfu.remove(card);
		                        //game.delay();
		                    }*/
                            "step 1";
                            var luckynum;
                            if (event.skillType == 'recover') {
                                var rec = event.lengthslist.filter(function(num) {
                                    var name = event.skillslist[num];
                                    return (lib.translate[name + '_info'] && lib.translate[name + '_info'].indexOf('回复') != -1);
                                }).randomGet();
                                var other = event.lengthslist.slice(0);
                                other.remove(rec);
                                if (rec) {
                                    luckynum = other.randomGets(2);
                                    luckynum.push(rec);
                                    luckynum.sort(function(a, b) {
                                        return Math.random();
                                    });
                                } else {
                                    luckynum = other.randomGets(3);
                                }
                            } else if (event.skillType == 'damage') {
                                var dam = event.lengthslist.filter(function(num) {
                                    var name = event.skillslist[num];
                                    return (lib.translate[name + '_info'] && lib.translate[name + '_info'].indexOf('伤害') != -1);
                                }).randomGet();
                                var other = event.lengthslist.slice(0);
                                other.remove(dam);
                                if (dam) {
                                    luckynum = other.randomGets(2);
                                    luckynum.push(dam);
                                    luckynum.sort(function(a, b) {
                                        return Math.random();
                                    });
                                } else {
                                    luckynum = other.randomGets(3);
                                }
                            } else {
                                luckynum = event.lengthslist.randomGets(3);
                            }
                            //luckynum.push(event.zhafu);
                            var tips = [];
                            event.skillpile = {};
                            event.skills = [];
                            for (var i = 0; i < luckynum.length; i++) {
                                var num = luckynum[i];
                                var theskill = event.skillslist[num];
                                event.skills.push(theskill);
                                event.skillpile[theskill] = event.characterslist[num];
                                var str = '<li>〖' + get.translation(theskill) + '〗：' + get.translation(theskill + '_info');
                                tips.push(str);
                            }
                            player.chooseControl(event.skills,
                            function() {
                                return event.skills.randomGet();
                            }).set('choiceList', tips).set('prompt', "选择一个限定技写在神符上");
                            "step 2";
                            event.shenfutype = [];
                            for (var i = 0; i < 3; i++) {
                                var card = event.shenfu.randomGet();
                                player.showCards(card, "正在书写神符");
                                event.shenfu.remove(card);
                                event.shenfutype.push(card.name);
                                //game.delay();
                            }
                            "step 3";
                            if (!target.storage.zhuSkill_ssr_shendao) {
                                target.storage.zhuSkill_ssr_shendao = [];
                            }
                            var skill = result.control;
                            var character = event.skillpile[result.control];
                            target.addSkill('ssr_shendao_fu');
                            target.storage[skill] = false;
                            //target.isZhu=true;
                            var info = lib.skill[skill];
                            if (info.zhuSkill) {
                                target.storage.zhuSkill_ssr_shendao.push(skills[i]);
                                if (info.init) {
                                    info.init(target);
                                }
                                if (info.init2) {
                                    info.init2(target);
                                }
                            }
                            target.addSkill(skill);
                            target.restoreSkill(skill);
                            if (!target.storage.ssr_shendao_fu) {
                                target.storage.ssr_shendao_fu = [];
                                target.storage.ssr_shendao_fuskill = [];
                            }
                            target.storage.ssr_shendao_fu.push(character);
                            target.storage.ssr_shendao_fuskill.push(skill);
                            target.markSkill('ssr_shendao_fu');
                            //event.dialog=ui.create.dialog('<div class="text center">'+get.translation(target.name)+'被贴上了一张神符·'+get.translation(skill),[[character],'character']);
                            var shenfutps = event.shenfutype.randomGet();
                            event.shenfutype.remove(shenfutps);
                            lib.card['shendao_' + character] = {
                                fullskin: true,
                                image: 'ext:祖安武将/card/' + shenfutps + '.png',
                                opacity: 1,
                                textShadow: 'black 0 0 2px',
                            };
                            lib.translate['shendao_' + character] = get.translation(skill);
                            lib.translate['shendao_' + character + '_info'] = get.translation(skill + '_info');
                            player.$give(game.createCard({
                                name: 'shendao_' + character,
                                number: "神",
                                suit: "符"
                            }), target);
                            game.log(target, '被贴上了一张神符·' + get.translation(skill));
                            game.delay();
                            //"step 3";
                            //event.dialog.close();
                            "step 4";
                            if (target.storage.ssr_shendao_fu.length > 2) {
                                var character = 'remove';
                                lib.card['shendao_' + character] = {
                                    fullskin: true,
                                    image: 'ext:祖安武将/card/' + event.shenfutype.randomGet() + '.png',
                                    opacity: 1,
                                    textShadow: 'black 0 0 2px',
                                };
                                lib.translate['shendao_' + character] = '移除';
                                lib.translate['shendao_' + character + '_info'] = '神符过多，已被挤出';
                                target.storage.ssr_shendao_fu.shift();
                                var skill = target.storage.ssr_shendao_fuskill.shift();
                                if (target.hasSkill(skill)) target.removeSkill(skill);
                                target.markSkill('ssr_shendao_fu');
                                target.$throw(game.createCard({
                                    name: 'shendao_' + character,
                                    number: "神",
                                    suit: "符"
                                }));
                                game.log(target, '被挤掉了一张神符·' + get.translation(skill));
                            }
                            game.delay();
                        },
                        ai: {
                            order: 7,
                            result: {
                                target: function(player, target) {
                                    return 5;
                                },
                            },
                            threaten: 1.7,
                        },
                    },
                    "ssr_huanhua": {
                        init: function(player) {
                            if (!player.storage.ssr_huanhua_name) {
                                player.storage.ssr_huanhua_name = player.name;
                            }
                        },
                        intro: {
                            name: "幻化",
                            content: function(storage, player, skill) {
                                var name = player.storage.ssr_huanhua_name;
                                var str = '<li>武将本体：' + get.translation(name);
                                return str;
                            },
                        },
                        marktext: "化身",
                        priority: 20,
                        audio: "huashen",
                        trigger: {
                            player: ["phaseBegin", "phaseEnd"],
                        },
                        filter: function(event, player) {
                            var num = game.countPlayer(function(current) {
                                return player.name != current.name && player != current && current.group != 'shen';
                            });
                            return num > 0;
                        },
                        direct: true,
                        content: function() {
                            "step 0";
                            if (!player.storage.ssr_huanhua_maxhp) {
                                player.storage.ssr_huanhua_maxhp = player.maxHp;
                            } else {
                                player.maxHp = player.storage.ssr_huanhua_maxhp;
                            }
                            var num = player.countDisabled();
                            if (num) {
                                for (var i = 1; i < 6; i++) {
                                    if (player.isDisabled(i)) trigger.player.enableEquip(i);
                                }
                            }
                            player.chooseTarget(get.prompt2('ssr_huanhua'),
                            function(card, player, target) {
                                return player != target && player.name != target.name && target.group != 'shen';
                            }).set('ai',
                            function(target) {
                                var player = _status.event.player;
                                return 6 - target.maxHp;
                            });
                            player.update();
                            "step 1";
                            if (result.bool) {
                                player.logSkill(event.name, result.targets);
                                event.target = result.targets[0];
                                event.skills = event.target.getSkills(true, false).slice(0);
                                for (var i = 0; i < event.skills.length; i++) {
                                    var info = get.info(event.skills[i]);
                                    if (event.skills[i] == 'boss_baonu' || info.juexingji) {
                                        event.skills.splice(i--, 1);
                                    }
                                }
                                player.name = event.target.name;
                                player.addAdditionalSkill('ssr_huanhua', event.skills);
                                player.storage.ssr_huanhua = 0;
                                player.markSkill('ssr_huanhua');
                                player.syncStorage('ssr_huanhua');
                                player.storage.ssr_huanhua_skills = event.skills;
                                player.setBackground(event.target.name, 'character');
                                player.flashAvatar('ssr_huanhua', event.target.name);
                            }
                            player.update();
                        },
                    },
                    "ssr_xinsheng": {
                        derivation: ["ssr_qianxing"],
                        audio: "rexinsheng",
                        enable: "chooseToUse",
                        filter: function(event, player) {
                            if (event.type == 'dying') {
                                if (player != event.dying) return false;
                                if (player.storage.ssr_huanhua_name) {
                                    return player.name != player.storage.ssr_huanhua_name;
                                } else {
                                    return false;
                                }
                            }
                        },
                        content: function() {
                            'step 0';
                            player.name = player.storage.ssr_huanhua_name;
                            'step 1';
                            player.removeSkill(player.storage.ssr_huanhua_skills);
                            player.unmarkSkill('ssr_huanhua');
                            'step 2';
                            if (player.hp < 1) {
                                player.recover(1 - player.hp);
                            }
                            if (player.countCards('he', {
                                suit: 'heart'
                            })) player.chooseToDiscard(get.prompt('ssr_xinsheng'), 'he', {
                                suit: 'heart'
                            },
                            '是否弃置一张红桃牌并获得〖潜行〗直到你的回合开始？', lib.filter.cardDiscardable).set('ai',
                            function(card) {
                                return 9 - get.value(card);
                            }).set('logSkill', 'ssr_xinsheng').setHiddenSkill('ssr_xinsheng');
                            'step 3';
                            if (result.bool) {
                                player.addTempSkill('qianxing', {
                                    player: 'phaseBegin'
                                });
                            }
                            player.setBackground(player.storage.ssr_huanhua_name, 'character');
                            player.flashAvatar('ssr_huanhua', player.storage.ssr_huanhua_name);
                            player.update();
                        },
                        ai: {
                            order: 3,
                            save: true,
                            result: {
                                player: function(player) {
                                    return 5;
                                },
                            },
                            threaten: function(player, target) {
                                if (target.storage.ssr_huanhua_name) {
                                    if (target.name != player.storage.ssr_huanhua_name) return 0.6;
                                }
                            },
                        },
                    },
                    "ssr_miedi": {
                        subSkill: {
                            sha: {
                                sub: true,
                                charlotte: true,
                            },
                            forbid: {
                                sub: true,
                                charlotte: true,
                                intro: {
                                    name: "不可轻敌",
                                    content: "本回合不能再发动〖蔑敌〗",
                                },
                                mark: true,
                                marktext: "败颓",
                            },
                        },
                        audio: 'shizhan',
                        enable: 'phaseUse',
                        usable: 2,
                        filterTarget: function(card, player, target) {
                            return target != player && !player.hasSkill('ssr_miedi_forbid');
                        },
                        content: function() {
                            "step 0";
                            target.draw();
                            "step 1";
                            /*target.chooseToUse(function(card,player,event){
								if(get.name(card)!='sha') return false;
								return lib.filter.filterCard.apply(this,arguments);
							},'挑衅：对'+get.translation(player)+'使用一张杀，或令其弃置你的一张牌').set('targetRequired',true).set('complexSelect',true).set('filterTarget',function(card,player,target){
								if(target!=_status.event.sourcex&&!ui.selected.targets.contains(_status.event.sourcex)) return false;
								return lib.filter.filterTarget.apply(this,arguments);
							}).set('sourcex',player);*/
                            var num = Math.min(target.countCards('he'), 2);
                            player.addTempSkill('ssr_miedi_sha', {
                                player: ['damageSource', 'phaseAfter']
                            });
                            target.chooseToUse(function(card, player, event) {
                                if (get.name(card) != 'sha') return false;
                                return lib.filter.filterCard.apply(this, arguments);
                            },
                            '蔑敌：对' + get.translation(player.name) + '使用一张杀，或交给其' + get.cnNumber(num) + '张牌').set('targetRequired', true).set('complexSelect', true).set('filterTarget',
                            function(card, player, target) {
                                if (target != _status.event.sourcex && !ui.selected.targets.contains(_status.event.sourcex)) return false;
                                return lib.filter.targetEnabled.apply(this, arguments);
                            }).set('sourcex', player);
                            "step 2";
                            if (player.hasSkill('ssr_miedi_sha')) {
                                player.removeSkill('ssr_miedi_sha');
                            } else {
                                player.addTempSkill('ssr_miedi_forbid');
                            }
                            if (result.bool == false && target.countCards('he') > 0) {
                                var num = Math.min(target.countCards('he'), 2);
                                target.chooseCard('选择' + get.cnNumber(num) + '张手牌交给' + get.translation(player.name), 'he', num, true).set('ai',
                                function(card) {
                                    return 100 - get.value(card);
                                });
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            "step 3";
                            if (result.bool && result.cards) {
                                target.give(result.cards, player);
                            }
                        },
                        ai: {
                            order: 6,
                            expose: 0.2,
                            result: {
                                target: function(player, target) {
                                    var equips = target.countCards('e');
                                    if (target.countCards('h') == 0) return 0.2 - equips;
                                    if (target.countCards('h') == 1) return - 0.5 - equips * 0.1;
                                    return - 0.8;
                                },
                                player: function(player, target) {
                                    var shans = player.countCards('hs', 'shan') + player.countCards('hs', {
                                        type: 'trick'
                                    }) + player.countCards('hs', {
                                        type: 'delay'
                                    });
                                    if (target.countCards('h') == 0) return 0;
                                    if (target.countCards('h') == 1) return - 0.1;
                                    if (player.hp <= 2 && shans < 2) return - 2;
                                    if (shans < 1) return - 1;
                                    return - 0.5;
                                }
                            },
                            threaten: 1.1
                        }
                    },
                    "ssr_shiyong_audio": game.zuanSetSSRAudio('new_reyaowu_sb_huaxiong', 2),
                    "ssr_shiyong": {
                        subSkill: {
                            lose: {
                                forced: true,
                                audio: "new_reyaowu_sb_huaxiong",
                                trigger: {
                                    global: "shaMiss",
                                },
                                filter: function(event, player) {
                                    return event.target == player;
                                },
                                check: function(event, player, source) {
                                    return get.attitude(player, event.player) < 0;
                                },
                                logTarget: "target",
                                content: function() {
                                    trigger.player.loseHp();
                                },
                                sub: true,
                            },
                            shan: {
                                mod: {
                                    aiValue: function(player, card, num) {
                                        if (get.name(card) != 'shan' && get.type(card, 'trick') != 'trick') return;
                                        var cards = player.getCards('hs',
                                        function(card) {
                                            return get.name(card) == 'shan' || get.type(card, 'trick') == 'trick';
                                        });
                                        cards.sort(function(a, b) {
                                            return (get.name(b) == 'shan' ? 1 : 2) - (get.name(a) == 'shan' ? 1 : 2);
                                        });
                                        var geti = function() {
                                            if (cards.contains(card)) {
                                                return cards.indexOf(card);
                                            }
                                            return cards.length;
                                        };
                                        if (get.name(card) == 'shan') return Math.min(num, [6, 4, 3][Math.min(geti(), 2)]) * 0.6;
                                        return Math.max(num, [6.5, 4, 3][Math.min(geti(), 2)]);
                                    },
                                    aiUseful: function() {
                                        return lib.skill.qingguo.mod.aiValue.apply(this, arguments);
                                    },
                                },
                                locked: false,
                                enable: ['chooseToRespond', 'chooseToUse'],
                                filterCard: function(card) {
                                    return get.type(card, 'trick') == 'trick';
                                },
                                viewAs: {
                                    name: 'shan'
                                },
                                viewAsFilter: function(player) {
                                    if (player.countCards('hs', {
                                        type: 'trick'
                                    }) + player.countCards('hs', {
                                        type: 'delay'
                                    }) < 1) return false;
                                },
                                position: 'hs',
                                prompt: '将一张锦囊牌当【闪】使用或打出',
                                check: function() {
                                    return 1
                                },
                                sub: true,
                                ai: {
                                    order: 3,
                                    respondShan: true,
                                    skillTagFilter: function(player) {
                                        if (player.countCards('hs', {
                                            type: 'trick'
                                        }) + player.countCards('hs', {
                                            type: 'delay'
                                        }) < 1) return false;
                                    },
                                    effect: {
                                        target: function(card, player, target, current) {
                                            if (get.tag(card, 'respondShan') && current < 0) return 0.6
                                        }
                                    }
                                }
                            },
                        },
                        locked: true,
                        ai: {
                            effect: {
                                target: function(card, player, target, current) {
                                    if (card.name == 'sha' && (get.color(card) == 'red')) {
                                        return [1, -2];
                                    }
                                    if (card.name == 'sha' && (get.color(card) == 'black')) {
                                        return [0, -0.6];
                                    }
                                },
                            },
                        },
                        group: ["ssr_shiyong_lose", "ssr_shiyong_shan"],
                        audio: "new_reyaowu_sb_huaxiong",
                        trigger: {
                            target: "useCardToTargeted",
                        },
                        forced: true,
                        filter: function(event, player) {
                            if (event.card.name != 'sha') return false;
                            return get.color(event.card) == 'red';
                        },
                        check: function(event, player) {
                            return player == event.player;
                        },
                        content: function() {
                            var id = player.playerid;
                            var map = trigger.getParent().customArgs;
                            if (!map[id]) map[id] = {};
                            if (typeof map[id].shanRequired == 'number') {
                                map[id].shanRequired++;
                            } else {
                                map[id].shanRequired = 2;
                            }
                        },
                    },
                    "ssr_zuni": {
                        trigger: {
                            global: ["loseAfter"],
                        },
                        filter: function(event, player) {
                            if (player.storage.ssr_zuni_use) return false;
                            if (!event.cards2) return false;
                            if (event.type != 'discard') return false;
                            if (player.countCards('h') < 1) return false;
                            if (event.getParent()._ssr_zuni) return false;
                            var evt = event.getParent('phaseDiscard');
                            if (evt && evt.name == 'phaseDiscard') return false;
                            return event.cards2.length > 0 && event.player.isIn();
                        },
                        audio: "qingjian",
                        direct: true,
                        content: function() {
                            "step 0";
                            player.storage.ssr_zuni_use = true;
                            trigger.getParent()._ssr_zuni = true;
                            var num = trigger.cards2.length;
                            var dis = trigger.cards2;
                            var val = 0;
                            for (var i = 0; i < dis.length; i++) {
                                val += get.value(dis[i]);
                            }
                            var str = '阻逆：' + get.translation(trigger.player.name) + '失去了' + get.translation(trigger.cards2) + '，是否弃置一张手牌并令这些牌回到其手牌？';
                            if (!_status.auto && (player == game.me || player.isUnderControl())) game.waitClick(3, false, 100);
                            player.chooseToDiscard(1, 'h',
                            function(card) {
                                return true;
                            }).set('ai',
                            function(card) {
                                if (window.aiClicking) return 0;
                                if (get.attitude(player, trigger.player) > 1) {
                                    return val - get.value(card);
                                }
                                return 0;
                            }).set('dialog', [str, trigger.cards2]);
                            "step 1";
                            if (!_status.auto && (player == game.me || player.isUnderControl())) game.stopClick();
                            if (result.bool) {
                                trigger.player.gain(trigger.cards2);
                                trigger.player.$gain2(trigger.cards2);
                                game.log(trigger.player, '收回了', trigger.cards2);
                            }
                            "step 2";
                            game.delay();
                            player.storage.ssr_zuni_use = false;
                        },
                        ai: {
                            expose: 0.1,
                        },
                    },
                    "ssr_qingjian": {
                        audio: "qingjian",
                        trigger: {
                            player: "phaseDrawBegin2",
                        },
                        direct: true,
                        filter: function(event, player) {
                            return event.num > 0 && !event.numFixed && game.hasPlayer(function(target) {
                                return player != target;
                            });
                        },
                        content: function() {
                            "step 0";
                            var num = 2;
                            player.chooseTarget(get.prompt('ssr_qingjian'), '少摸一张牌，然后令至多' + get.translation(num) + '名其他角色各摸一张牌', [1, num],
                            function(card, player, target) {
                                return player != target;
                            },
                            function(target) {
                                var att = get.attitude(_status.event.player, target);
                                return att;
                            });
                            "step 1";
                            if (result.bool) {
                                result.targets.sortBySeat();
                                player.logSkill('ssr_qingjian', result.targets);
                                for (var i = 0; i < result.targets.length; i++) {
                                    result.targets[i].draw();
                                }
                                trigger.num--;
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            "step 2";
                            if (trigger.num <= 0) game.delay();
                        },
                        ai: {
                            threaten: 1.1,
                            expose: 0.2,
                        },
                    },
                    "ssr_yaowu": {
                        shaRelated: true,
                        audio: "yaowu",
                        trigger: {
                            player: "shaMiss",
                        },
                        filter: function(event) {
                            return event.target.countCards('h') > 0 && get.color(event.card) == 'black';
                        },
                        check: function(event, player) {
                            return get.attitude(player, event.target) < 0;
                        },
                        logTarget: "target",
                        content: function() {
                            player.discardPlayerCard('h', trigger.target, true);
                        },
                    },
                    "ssr_kurou": {
                        audio: "sbkurou",
                        enable: "phaseUse",
                        usable: 2,
                        filterTarget: function(card, player, target) {
                            return target != player && target.countCards('h');
                        },
                        content: function() {
                            "step 0";
                            player.loseHp();
                            event.videoId = lib.status.videoId++;
                            var cards = target.getCards('h');
                            if (player.isOnline2()) {
                                player.send(function(cards, id) {
                                    ui.create.dialog('苦肉', cards).videoId = id;
                                },
                                cards, event.videoId);
                            }
                            event.dialog = ui.create.dialog('苦肉', cards);
                            event.dialog.videoId = event.videoId;
                            if (!event.isMine()) {
                                event.dialog.style.display = 'none';
                            }
                            player.chooseButton([1, 2]).set('filterButton',
                            function(button) {
                                return true;
                            }).set('dialog', event.videoId);
                            "step 1";
                            if (result.bool) {
                                event.card = result.links;
                                var func = function(card, id) {
                                    var dialog = get.idDialog(id);
                                    if (dialog) {
                                        for (var i = 0; i < dialog.buttons.length; i++) {
                                            if (dialog.buttons[i].link == card) {
                                                dialog.buttons[i].classList.add('selectedx');
                                            } else {
                                                dialog.buttons[i].classList.add('unselectable');
                                            }
                                        }
                                    }
                                }
                                if (player.isOnline2()) {
                                    player.send(func, event.card, event.videoId);
                                } else if (event.isMine()) {
                                    func(event.card, event.videoId);
                                }
                            } else {
                                if (player.isOnline2()) {
                                    player.send('closeDialog', event.videoId);
                                }
                                event.dialog.close(); {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            "step 2";
                            if (player.isOnline2()) {
                                player.send('closeDialog', event.videoId);
                            }
                            event.dialog.close();
                            var card = event.card;
                            player.showCards(card, '苦肉');
                            game.log(player, '将', event.card, '苦肉');
                            player.gain(card, target, 'gain2');
                        },
                        ai: {
                            order: 8,
                            expose: 0.2,
                            result: {
                                target: function(player, target) {
                                    var value = -2;
                                    if (target.countCards('h') <= 1) var value = value + 1;
                                    if (target.countCards('h', {
                                        name: 'shan'
                                    }) && target.countCards('h', {
                                        name: 'shan'
                                    }) <= 2) var value = value - target.countCards('h', {
                                        name: 'shan'
                                    });
                                    if (target.countCards('h', {
                                        name: 'tao'
                                    })) var value = value - target.countCards('h', {
                                        name: 'tao'
                                    }) * 2;
                                    if (target.countCards('h', {
                                        name: 'jiu'
                                    })) var value = value - 2;
                                    if (player.hp < 2) var value = 0;
                                    return value;
                                },
                                player: function(player) {
                                    if (player.hp < 2 && !player.countCards('hs', {
                                        name: 'tao'
                                    }) > 0 && !player.countCards('hs', {
                                        name: 'jiu'
                                    }) > 0) return - 5;
                                    if (player.hp <= 2) return player.countCards('h') == 0 ? 1 : 0;
                                    if (player.countCards('h', {
                                        name: 'sha'
                                    })) return 1;
                                    if (player.hp < 2) return - 1;
                                    return player.countCards('h') <= player.hp ? 1 : 0;
                                },
                            },
                            effect: function(card, player, target) {
                                if (get.tag(card, 'damage')) {
                                    if (player.hasSkillTag('jueqing', false, target)) return [1, 1];
                                    return 1.2;
                                }
                                if (get.tag(card, 'loseHp')) {
                                    if (player.hp <= 1) return;
                                    return [0, 0];
                                }
                            },
                        },
                    },
                    "ssr_newkurou": {
                        subSkill: {
                            spade: {
                                trigger: {
                                    global: ["phaseBefore", "die"],
                                },
                                filter: function(event, player) {
                                    return event.player == player.storage.ssr_newkurou_spade;
                                },
                                charlotte: true,
                                forced: true,
                                silent: true,
                                intro: {
                                    name: "苦肉",
                                    content: "你区域内的牌均视为黑桃牌。",
                                },
                                mark: true,
                                marktext: "♠",
                                content: function() {
                                    player.removeSkill('ssr_newkurou_spade');
                                },
                                mod: {
                                    suit: function(card, suit) {
                                        return 'spade';
                                    },
                                },
                                target: function(card, player, target, current) {
                                    if (card.name == 'huogong') {
                                        if (player.countCards('h', {
                                            suit: 'spade'
                                        }) && get.attitude(player, target) <= 0) {
                                            return 2;
                                        } else {
                                            return 'zeroplayertarget';
                                        }
                                    }
                                },
                                sub: true,
                            },
                            club: {
                                trigger: {
                                    global: ["phaseBefore", "die"],
                                },
                                filter: function(event, player) {
                                    return event.player == player.storage.ssr_newkurou_club;
                                },
                                charlotte: true,
                                forced: true,
                                silent: true,
                                intro: {
                                    name: "苦肉",
                                    content: "你区域内的牌均视为梅花牌。",
                                },
                                mark: true,
                                marktext: "♣️",
                                content: function() {
                                    player.removeSkill('ssr_newkurou_club');
                                },
                                mod: {
                                    suit: function(card, suit) {
                                        return 'club';
                                    },
                                },
                                target: function(card, player, target, current) {
                                    if (card.name == 'huogong') {
                                        if (player.countCards('h', {
                                            suit: 'club'
                                        }) && get.attitude(player, target) <= 0) {
                                            return 2;
                                        } else {
                                            return 'zeroplayertarget';
                                        }
                                    }
                                },
                                sub: true,
                            },
                            heart: {
                                trigger: {
                                    global: ["phaseBefore", "die"],
                                },
                                filter: function(event, player) {
                                    return event.player == player.storage.ssr_newkurou_heart;
                                },
                                charlotte: true,
                                forced: true,
                                silent: true,
                                intro: {
                                    name: "苦肉",
                                    content: "你区域内的牌均视为红桃牌。",
                                },
                                mark: true,
                                marktext: "♥️",
                                content: function() {
                                    player.removeSkill('ssr_newkurou_heart');
                                },
                                mod: {
                                    suit: function(card, suit) {
                                        return 'heart';
                                    },
                                },
                                target: function(card, player, target, current) {
                                    if (card.name == 'huogong') {
                                        if (player.countCards('h', {
                                            suit: 'heart'
                                        }) && get.attitude(player, target) <= 0) {
                                            return 2;
                                        } else {
                                            return 'zeroplayertarget';
                                        }
                                    }
                                },
                                sub: true,
                            },
                            diamond: {
                                trigger: {
                                    global: ["phaseBefore", "die"],
                                },
                                filter: function(event, player) {
                                    return event.player == player.storage.ssr_newkurou_diamond;
                                },
                                charlotte: true,
                                forced: true,
                                silent: true,
                                intro: {
                                    name: "苦肉",
                                    content: "你区域内的牌均视为方片牌。",
                                },
                                mark: true,
                                marktext: "♦️",
                                content: function() {
                                    player.removeSkill('ssr_newkurou_diamond');
                                },
                                mod: {
                                    suit: function(card, suit) {
                                        return 'diamond';
                                    },
                                },
                                target: function(card, player, target, current) {
                                    if (card.name == 'huogong') {
                                        if (player.countCards('h', {
                                            suit: 'diamond'
                                        }) && get.attitude(player, target) <= 0) {
                                            return 2;
                                        } else {
                                            return 'zeroplayertarget';
                                        }
                                    }
                                },
                                sub: true,
                            },
                        },
                        audio: "sbkurou",
                        enable: "phaseUse",
                        usable: 1,
                        filterTarget: function(card, player, target) {
                            return target != player && target.countCards('h');
                        },
                        content: function() {
                            "step 0";
                            player.loseHp();
                            event.videoId = lib.status.videoId++;
                            var cards = target.getCards('h');
                            if (player.isOnline2()) {
                                player.send(function(cards, id) {
                                    ui.create.dialog('苦肉', cards).videoId = id;
                                },
                                cards, event.videoId);
                            }
                            event.dialog = ui.create.dialog('苦肉', cards);
                            event.dialog.videoId = event.videoId;
                            if (!event.isMine()) {
                                event.dialog.style.display = 'none';
                            }
                            player.chooseButton(1).set('filterButton',
                            function(button) {
                                return true;
                            }).set('dialog', event.videoId);
                            "step 1";
                            if (result.bool) {
                                event.card = result.links;
                                var func = function(card, id) {
                                    var dialog = get.idDialog(id);
                                    if (dialog) {
                                        for (var i = 0; i < dialog.buttons.length; i++) {
                                            if (dialog.buttons[i].link == card) {
                                                dialog.buttons[i].classList.add('selectedx');
                                            } else {
                                                dialog.buttons[i].classList.add('unselectable');
                                            }
                                        }
                                    }
                                }
                                if (player.isOnline2()) {
                                    player.send(func, event.card, event.videoId);
                                } else if (event.isMine()) {
                                    func(event.card, event.videoId);
                                }
                            } else {
                                if (player.isOnline2()) {
                                    player.send('closeDialog', event.videoId);
                                }
                                event.dialog.close(); {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            "step 2";
                            if (player.isOnline2()) {
                                player.send('closeDialog', event.videoId);
                            }
                            event.dialog.close();
                            var card = event.card;
                            player.showCards(card, '苦肉');
                            game.log(player, '将', event.card, '苦肉');
                            player.gain(card, target, 'gain2');
                            var suit = get.suit(card[0]);
                            if (!target.hasSkill('ssr_newkurou_' + suit)) {
                                target.addSkill('ssr_newkurou_' + suit);
                            }
                            target.storage['ssr_newkurou_' + suit] = player;
                        },
                        ai: {
                            order: 8,
                            expose: 0.2,
                            result: {
                                target: function(player, target) {
                                    var value = -2;
                                    if (target.countCards('h') <= 1) var value = value + 1;
                                    if (target.countCards('h', {
                                        name: 'shan'
                                    }) && target.countCards('h', {
                                        name: 'shan'
                                    }) <= 1) var value = value - target.countCards('h', {
                                        name: 'shan'
                                    });
                                    if (target.countCards('h', {
                                        name: 'tao'
                                    })) var value = value - target.countCards('h', {
                                        name: 'tao'
                                    }) * 2;
                                    if (target.countCards('h', {
                                        name: 'jiu'
                                    })) var value = value - 2;
                                    if (player.hp < 2) var value = 0;
                                    return value;
                                },
                                player: function(player) {
                                    if (player.hp < 2 && !player.countCards('hs', {
                                        name: 'tao'
                                    }) > 0 && !player.countCards('hs', {
                                        name: 'jiu'
                                    }) > 0) return - 5;
                                    if (player.hp <= 2) return player.countCards('h') == 0 ? 1 : 0;
                                    if (player.countCards('h', {
                                        name: 'sha'
                                    })) return 1;
                                    if (player.hp < 2) return - 1;
                                    return player.countCards('h') <= player.hp ? 1 : 0;
                                },
                            },
                            effect: function(card, player, target) {
                                if (get.tag(card, 'damage')) {
                                    if (player.hasSkillTag('jueqing', false, target)) return [1, 1];
                                    return 1.2;
                                }
                                if (get.tag(card, 'loseHp')) {
                                    if (player.hp <= 1) return;
                                    return [0, 0];
                                }
                            },
                        },
                    },
                    "ssr_fenchuan": {
                        shaRelated: true,
                        audio: 'sbzhaxiang',
                        trigger: {
                            player: "useCardToPlayered",
                        },
                        filter: function(event, player) {
                            return event.card.name == 'sha' && event.target.countCards('h');
                        },
                        check: function(event, player) {
                            return get.attitude(player, event.target) < 0;
                        },
                        content: function() {
                            "step 0";
                            if (trigger.target.countCards('h') == 0) {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                                return;
                            } else if (trigger.target.countCards('h') == 1) event._result = {
                                cards: trigger.target.getCards('h')
                            };
                            else trigger.target.chooseCard(true).ai = function(card) {
                                if (_status.event.getRand() < 0.5) return Math.random();
                                return get.value(card);
                            };
                            "step 1";
                            trigger.target.showCards(result.cards).setContent(function() {});
                            event.dialog = ui.create.dialog(get.translation(trigger.target) + '展示的手牌', result.cards);
                            event.videoId = lib.status.videoId++;

                            game.broadcast('createDialog', event.videoId, get.translation(trigger.target) + '展示的手牌', result.cards);
                            game.addVideo('cardDialog', null, [get.translation(trigger.target) + '展示的手牌', get.cardsInfo(result.cards), event.videoId]);
                            event.card2 = result.cards[0];
                            game.log(trigger.target, '展示了', event.card2);
                            event._result = {};
                            player.chooseToDiscard({
                                suit: get.suit(event.card2)
                            },
                            function(card) {
                                //var evt=_status.event.getParent();
                                var evt = trigger;
                                if (get.damageEffect(evt.target, evt.player, evt.player, 'fire') > 0) {
                                    return 7 - get.value(card, evt.player);
                                }
                                return - 1;
                            }).set('prompt', '弃置一张' + get.translation(get.suit(result.cards[0])) + '手牌，令' + get.translation(trigger.card) + '不可被【闪】响应，伤害加一且变成火属性。');
                            game.delay(2);
                            "step 2";
                            if (result.bool) {
                                var id = trigger.target.playerid;
                                var map = trigger.getParent().customArgs;
                                if (!map[id]) map[id] = {};
                                if (typeof map[id].extraDamage != 'number') {
                                    map[id].extraDamage = 0;
                                }
                                map[id].extraDamage++;
                                trigger.getParent().directHit.add(trigger.target);
                                trigger.card.nature = 'fire';
                            }
                            event.dialog.close();
                            game.addVideo('cardDialog', null, event.videoId);
                            game.broadcast('closeDialog', event.videoId);
                        },
                    },
                    "ssr_newlihun": {
                        subSkill: {
                        default:
                            {
                                charlotte:
                                true,
                                forced: true,
                                silent: true,
                                intro: {
                                    name: "黯然销魂",
                                    content: "本回合内你的手牌上限为○",
                                },
                                mark: true,
                                marktext: "销魂",
                                mod: {
                                    maxHandcardBase: function(player, num) {
                                        return 0;
                                    },
                                },
                                sub: true,
                            },
                            control: {
                                charlotte: true,
                                forced: true,
                                silent: true,
                                intro: {
                                    name: "操魂纵魄",
                                    content: "下个回合交由拥有〖离魂〗的角色控制",
                                },
                                mark: true,
                                marktext: "控魂",
                                sub: true,
                            },
                            start: {
                                audio: 'sblijian',
                                forced: true,
                                trigger: {
                                    global: 'phaseBeginStart'
                                },
                                filter: function(event, player) {
                                    return player != event.player && !event.player._trueMe && event.player.hasSkill('ssr_newlihun_control');
                                },
                                priority: 2,
                                logTarget: 'player',
                                skillAnimation: true,
                                animationColor: 'key',
                                content: function() {
                                    trigger.player.removeSkill('ssr_newlihun_control');
                                    trigger.player._trueMe = player;
                                    game.addGlobalSkill('autoswap');
                                    if (trigger.player == game.me) {
                                        game.notMe = true;
                                        if (!_status.auto) ui.click.auto();
                                    }
                                    trigger.player.addSkill('ssr_newlihun_end');
                                    player.addTempSkill('qianxing');
                                },
                                sub: true,
                            },
                            end: {
                                trigger: {
                                    player: ['phaseAfter', 'dieAfter'],
                                    global: 'phaseBefore',
                                },
                                group: 'ssr_newlihun_use',
                                lastDo: true,
                                charlotte: true,
                                forceDie: true,
                                forced: true,
                                silent: true,
                                priority: 2,
                                content: function() {
                                    player.removeSkill('ssr_newlihun_end');
                                },
                                onremove: function(player) {
                                    if (player == game.me) {
                                        if (!game.notMe) game.swapPlayerAuto(player._trueMe)
                                        else delete game.notMe;
                                        if (_status.auto) ui.click.auto();
                                    }
                                    delete player._trueMe;
                                },
                                mark: true,
                                marktext: "傀儡",
                                intro: {
                                    name: "魂魄附体",
                                    content: "武将正在被操控",
                                },
                                sub: true,
                            },
                            use: {
                                trigger: {
                                    player: ["useCardBefore"],
                                },
                                priority: 2,
                                filter: function(event, player) {
                                    return player._trueMe;
                                },
                                forced: true,
                                silent: true,
                                content: function() {
                                    var him = player._trueMe;
                                    him.line(player, 'grey');
                                },
                                sub: true,
                                popup: false,
                            },
                        },
                        derivation: ["ssr_qianxing"],
                        group: ['ssr_newlihun_start'],
                        audio: 'sblijian',
                        enable: 'phaseUse',
                        usable: 1,
                        filter: function(event, player) {
                            return player.countCards('h') > 0 && game.countPlayer() > 2;
                        },
                        filterTarget: function(card, player, target) {
                            return player != target && !target.hasSkill('ssr_newlihun_control');
                        },
                        filterCard: true,
                        check: function(card) {
                            return 8 - get.value(card);
                        },
                        discard: false,
                        lose: false,
                        delay: false,
                        content: function() {
                            "step 0";
                            target.chooseControl('basic', 'trick', 'equip').set('ai',
                            function(event) {
                                var num = Math.random();
                                if (num >= 0.5) return 'basic';
                                if (num > 0.2) return 'trick';
                                return 'equip';
                            }).set('prompt', '离魂：请猜测' + get.translation(player.name) + '所选择牌的类型');
                            "step 1";
                            game.log(target, '猜测为' + get.translation(result.control) + '牌');
                            player.showCards(cards);
                            "step 2";
                            var type = get.type(cards[0], 'trick');
                            if (result.control == type) {
                                game.log(target, '猜测正确');
                                //player.discard(cards);
                                player.loseHp();
                                player.addTempSkill('ssr_newlihun_default');
                            } else {
                                game.log(target, '猜测错误');
                                //player.give(cards,target);
                                target.addSkill('ssr_newlihun_control');
                            }
                            player.give(cards, target);
                        },
                        ai: {
                            order: 9,
                            result: {
                                player: function(player, target) {
                                    if(player.getHp() < 2) return -2;
                                    return 2;
                                },
                                target: function(player, target) {
                                    return - 1.5;
                                }
                            },
                            threaten: 2,
                        }
                    },
                    "ssr_lihun": {
                        subSkill: {
                            hun: {
                                mark: true,
                                marktext: "傀儡",
                                intro: {
                                    name: "魂魄附体",
                                    content: "武将正在被操控",
                                },
                                trigger: {
                                    player: ["useCardBefore"],
                                },
                                priority: 2,
                                filter: function(event, player) {
                                    return player.storage.ssr_lihun_benti;
                                },
                                forced: true,
                                silent: true,
                                content: function() {
                                    var him = player.storage.ssr_lihun_benti;
                                    him.line(player, 'grey');
                                },
                                sub: true,
                                popup: false,
                            },
                            dam: {
                                mark: true,
                                marktext: "离魂",
                                intro: {
                                    name: "魂离本体",
                                    content: "离魂期间本体防止受到的任何伤害或体力流失",
                                },
                                trigger: {
                                    player: ["damageBefore", "loseHpBefore"],
                                },
                                filter: function(event, player) {
                                    return true;
                                },
                                priority: 100,
                                forced: true,
                                content: function() {
                                    trigger.cancel();
                                },
                                ai: {
                                    nofire: true,
                                    nothunder: true,
                                    effect: {
                                        target: function(card, player, target, current) {
                                            if (get.tag(card, 'damage')) return 'zerotarget';
                                            if (get.tag(card, 'fireDamage')) return 'zerotarget';
                                            if (get.tag(card, 'thunderDamage')) return 'zerotarget';
                                        },
                                    },
                                },
                                sub: true,
                            },
                        },
                        audio: "lihun",
                        trigger: {
                            player: "phaseZhunbeiBegin",
                        },
                        priority: -2,
                        direct: true,
                        content: function() {
                            'step 0';
                            event.cards = get.cards(2);
                            player.chooseControl('ok').set('dialog', ['〖离魂〗牌堆顶的牌', event.cards]);
                            'step 1';
                            player.chooseTarget(get.prompt('ssr_lihun'), '跳过本回合，将' + get.translation(event.cards) + '交给一名男性角色并替其执行一个出牌阶段和弃牌阶段', 1,
                            function(card, player, target) {
                                return target.sex == 'male';
                            },
                            function(target) {
                                if (player.hp * 2 + player.countCards('h') > 5) {
                                    return 1;
                                } else {
                                    return - 1;
                                }
                            });
                            "step 2";
                            if (result.bool) {
                                event.realgameme = game.me;
                                player.skip('phaseJudge');
                                player.skip('phaseDraw');
                                player.skip('phaseUse');
                                player.skip('phaseDiscard');
                                event.target = result.targets[0];
                                player.logSkill(event.name, event.target);
                                if (event.cards.length > 0) event.target.gain(event.cards, 'draw');
                                event.target._trueMe = player;
                                game.addGlobalSkill('autoswap');
                                if (event.target == game.me) {
                                    game.notMe = true;
                                    if (!_status.auto) ui.click.auto();
                                }
                                player.addTempSkill('ssr_lihun_dam');
                                event.target.addTempSkill('ssr_lihun_hun');
                                event.target.storage.ssr_lihun_benti = player;
                                if (player == event.realgameme) {
                                    game.swapPlayerAuto(event.target);
                                }
                            } else {
                                var first = ui.cardPile.firstChild;
                                var cards = event.cards;
                                for (var i = 0; i < cards.length; i++) {
                                    ui.cardPile.insertBefore(cards[i], first);
                                } {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            'step 3';
                            if (result.bool) {
                                event.target.phaseUse();
                                event.target.phaseDiscard();
                                //if(event.cards.length>0) event.target.chooseToDiscard(event.cards.length,'h',true);
                            }
                            'step 4';
                            if (result.bool) {
                                player.removeSkill('ssr_lihun_dam');
                                event.target.removeSkill('ssr_lihun_hun');
                                if (event.target == game.me) {
                                    if (!game.notMe) game.swapPlayerAuto(event.target._trueMe)
                                    else delete game.notMe;
                                    if (_status.auto) ui.click.auto();
                                }
                                delete event.target._trueMe;
                            }
                        },
                        ai: {
                            result: {
                                player: 1,
                            },
                            expose: 0.2,
                            threaten: 1.2,
                        },
                    },
                    "ssr_biyue": {
                        audio: "sbbiyue",
                        locked: true,
                        mod: {
                            globalTo: function(from, to, distance) {
                                var num = 0;
                                if (to.countCards('h') < 1) num++;
                                if (to.countCards('e') < 1) num++;
                                if (to.countCards('j') < 1) num++;
                                return distance + num;
                            },
                            targetEnabled: function(card, player, target, now) {
                                if (get.type2(card) == 'trick' && (get.translation(card.name+'_info')||'none').indexOf('杀') != -1) return false;
                            },
                            /*targetEnabled: function(card, player, target, now) {
                                if (get.type(card) == 'trick' && target != player && !player.inRange(target)) return false;
                            },*/
                        },
                        priority: 1,
                        marktext: "月",
                        intro: {
                            name: "闭月羞花",
                            content: function(storage, player, skill) {
                                var str = '<li>没有牌的区域：';
                                var num = 0;
                                var cnname = ['h', '手牌区', 'e', '装备区', 'j', '判定区'];
                                for (var i = 0; i * 2 < cnname.length; i++) {
                                    if (storage.contains(cnname[i * 2])) {
                                        if (num > 0) str += '、';
                                        str += cnname[i * 2 + 1];
                                        num++;
                                    }
                                }
                                return str;
                            },
                        },
                        trigger: {
                            player: ["loseAfter", "enterGame"],
                            global: ["gameDrawAfter", "equipAfter", "addJudgeAfter", "gainAfter", "loseAsyncAfter"],
                        },
                        priority: -77,
                        forced: true,
                        filter: function(event, player) {
                            if (!player.storage.ssr_biyue) player.storage.ssr_biyue = [];
                            var all = ['h', 'e', 'j'];
                            for (var i = 0; i < all.length; i++) {
                                if (player.storage.ssr_biyue.contains(all[i])) {
                                    if (player.countCards(all[i]) > 0) return true;
                                } else {
                                    if (player.countCards(all[i]) < 1) return true;
                                }
                            }
                            return false;
                        },
                        init: function(player) {
                            player.storage.ssr_biyue = [];
                        },
                        content: function() {
                            'step 0';
                            player.storage.ssr_biyue = [];
                            'step 1';
                            var all = ['h', 'e', 'j'];
                            for (var i = 0; i < all.length; i++) {
                                if (player.countCards(all[i]) < 1) player.storage.ssr_biyue.push(all[i]);
                            }
                            'step 2';
                            if (player.storage.ssr_biyue.length > 0) {
                                player.markSkill('ssr_biyue');
                            } else {
                                player.unmarkSkill('ssr_biyue');
                            }
                        },
                        ai: {
                            result: {
                                player: 1.5,
                            },
                            threaten: 1.2,
                        },
                    },
                    "ssr_yuxi_cardskill": {},
                    "ssr_yongsi": {
                        derivation: "ssr_yuxi_cardskill",
                        audio: "drlt_yongsi",
                        group: "ssr_yongsi_lose",
                        init: function(player, skill) {
                            if (player.hasZhuSkill('ssr_yongsi')) {
                                var name = 'ssr_yongsi_yuxi_card';
                                lib.card[name] = {
                                    skills: ["ssr_yongsi_yuxi"],
                                    fullskin: true,
                                    type: "equip",
                                    image: 'ext:祖安武将/card/yongsi_yuxi.png',
                                    color: 'white',
                                    opacity: 1,
                                    textShadow: 'black 0 0 2px',
                                    subtype: "equip5",
                                    enable: true,
                                    selectTarget: -1,
                                    filterTarget: function(card, player, target) {
                                        return target == player;
                                    },
                                    modTarget: true,
                                    allowMultiple: false,
                                    content: function() {
                                        if (cards.length && get.position(cards[0], true) == 'o') target.equip(cards[0]);
                                    },
                                    toself: true,
                                    ai: {
                                        equipValue: 9,
                                        basic: {
                                            order: function(card, player) {
                                                if (player && player.hasSkillTag('reverseEquip')) {
                                                    return 8.5 - get.equipValue(card, player) / 20;
                                                } else {
                                                    return 8 + get.equipValue(card, player) / 20;
                                                }
                                            },
                                            useful: 2,
                                            equipValue: 1,
                                            value: function(card, player, index, method) {
                                                if (player.isDisabled(get.subtype(card))) return 0.01;
                                                var value = 0;
                                                var info = get.info(card);
                                                var current = player.getEquip(info.subtype);
                                                if (current && card != current) {
                                                    value = get.value(current, player);
                                                }
                                                var equipValue = info.ai.equipValue;
                                                if (equipValue == undefined) {
                                                    equipValue = info.ai.basic.equipValue;
                                                }
                                                if (typeof equipValue == 'function') {
                                                    if (method == 'raw') return equipValue(card, player);
                                                    if (method == 'raw2') return equipValue(card, player) - value;
                                                    return Math.max(0.1, equipValue(card, player) - value);
                                                }
                                                if (typeof equipValue != 'number') equipValue = 0;
                                                if (method == 'raw') return equipValue;
                                                if (method == 'raw2') return equipValue - value;
                                                return Math.max(0.1, equipValue - value);
                                            },
                                        },
                                        result: {
                                            target: function(player, target, card) {
                                                return get.equipResult(player, target, card.name);
                                            },
                                        },
                                    },
                                };
                                lib.translate[name] = "玉玺";
                                lib.translate[name + '_info'] = "锁定技：一、所有角色终视为在你的攻击范围内；二、当你成为【杀】的目标时，你可以弃置两张手牌（不足则全弃，无牌则不弃），然后摸两张牌。";
                                var card = game.createCard(name);
                                player.storage.ssr_yongsi = card;
                                player.equip(card);
                            }
                        },
                        zhuSkill: true,
                        lock: true,
                        forced: true,
                        subSkill: {
                            yuxi: {
                                audio: 'drlt_yongsi',
                                trigger: {
                                    target: "useCardToTargeted",
                                },
                                check: function(event, player) {
                                    var cards = player.getCards('h');
                                    if (cards.length <= 2) {
                                        for (var i = 0; i < cards.length; i++) {
                                            if (cards[i].name == 'shan' || cards[i].name == 'tao') return false;
                                        }
                                    }
                                    return true;
                                },
                                filter: function(event, player) {
                                    return event.card.name == 'sha';
                                },
                                prompt2: "当你成为【杀】的目标时，你可以弃置两张手牌（不足则全弃，无牌则不弃），然后摸两张牌。",
                                content: function() {
                                    "step 0";
                                    player.chooseToDiscard(2, true, 'h');
                                    player.draw(2);
                                    /*if(game.hasPlayer(function(current){
		                                return player!=current&&player.group==current.group;
		                            })) {
		                            player.chooseTarget(get.prompt('ssr_yongsi_yuxi_card'),'是否令一名'+get.translation(player.group)+'势力角色执行一次【玉玺】的效果？',1,function(card,player,target){
		                                return target!=player&&player.group==target.group;
		                            },function(target){
		                                return (Math.max(2-target.countCards('h'),1)*1.5+target.countCards('e',{subtype:'equip1'})+target.countCards('e',{subtype:'equip4'}))*get.attitude(player,target);
		                            });
		                            }else {if(event&&event.finish){event.finish();}else {return;}}
		                            "step 1";
		                            if(result.bool){
		                                result.targets[0].chooseToDiscard(2,true,'he');
		                                result.targets[0].draw(2);
		                            }*/
                                },
                                ai: {
                                    effect: {
                                        target: function(card, player, target, current) {
                                            if (card.name == 'sha') return [1, 0.5];
                                        },
                                    },
                                },
                                mod: {
                                    attackFrom: function(from, to, distance) {
                                        //if(from.group==to.group) return distance-Infinity;
                                        return 0;
                                    },
                                    /*canBeDiscarded:function(card){
		                                if(game.hasPlayer(function(current){
		                                    return current.hasZhuSkill('ssr_yongsi');
		                                })&&get.position(card)=='e'&&['equip5'].contains(get.subtype(card))) return false;
		                            },*/
                                },
                                sub: true,
                            },
                            lose: {
                                trigger: {
                                    player: "phaseZhunbeiBegin",
                                },
                                forced: true,
                                filter: function(event, player) {
                                    if (!player.hasZhuSkill('ssr_yongsi')) return false;
                                    var card = player.storage.ssr_yongsi;
                                    return card && card.isInPile() && player.hasUseTarget(card);
                                },
                                content: function() {
                                    //player.gain(player.storage.ssr_yongsi);
                                    player.chooseUseTarget(player.storage.ssr_yongsi, 'nopopup', true);
                                },
                                sub: true,
                            },
                        },
                    },
                    "ssr_yjixi": {
                        subSkill: {
                            gain: {
                                trigger: {
                                    global: 'phaseZhunbeiBegin'
                                },
                                forced: true,
                                audio: 'drlt_yongsi',
                                filter: function(event, player) {
                                    return event.player != player && event.player.countCards('hes', {
                                        name: 'yuxi'
                                    }) > 0 && event.player.countCards('h') > event.player.getHp();
                                },
                                priority: 3,
                                logTarget: 'player',
                                content: function() {
                                    'step 0';
                                    /*trigger.player.chooseCard('觊玺：交给'+get.translation(player.name)+'一张牌','hes',true,1,function(card,player){
		                                if(get.attitude(trigger.player,player)>0) {
		                                    return get.value(card);
		                                }else {
		                                    return 100-get.value(card);
		                                }
		                            });
		                            'step 1';
		                            player.gain(result.cards,'gain2',trigger.player);*/
                                    trigger.player.give(trigger.player.getCards('he').randomGet(), player, 'give');
                                },
                                sub: true,
                            },
                        },
                        group: 'ssr_yjixi_gain',
                        trigger: {
                            global: "phaseBefore",
                            player: "enterGame",
                        },
                        audio: 'drlt_yongsi',
                        forced: true,
                        locked: true,
                        priority: 23,
                        filter: function(event, player) {
                            return (event.name != 'phase' || game.phaseNumber == 0);
                        },
                        derivation: 'ssr_yuxi',
                        content: function() {
                            'step 0';
                            event.players = game.filterPlayer();
                            event.zhu = false;
                            'step 1';
                            if (!event.players.length) {
                                /*if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }*/
                                event.goto(4);
                            }
                            'step 2';
                            var zhu = false;
                            var target = event.players.shift();
                            switch (get.mode()) {
                            case 'identity':
                                {
                                    zhu = target.isZhu;
                                    break;
                                }
                            case 'guozhan':
                                {
                                    zhu = get.is.jun(target);
                                    break;
                                }
                            case 'versus':
                                {
                                    zhu = target.identity == 'zhu';
                                    break;
                                }
                            case 'doudizhu':
                                {
                                    zhu = target == game.zhu;
                                    break;
                                }
                            }
                            if (zhu) {
                                var card = game.createCard({
                                    name: 'yuxi',
                                    suit: ['spade', 'club', 'diamond', 'heart'].randomGet(),
                                    number: 13
                                });
                                target.equip(card);
                                event.zhu = target;
                            }
                            'step 3';
                            event.goto(1);
                            'step 4';
                            if(!event.zhu) {
                                //我来当皇帝
                                var card = game.createCard({
                                    name: 'yuxi',
                                    suit: ['spade', 'club', 'diamond', 'heart'].randomGet(),
                                    number: 13
                                });
                                player.equip(card);
                            }
                        },
                        mod: {
                            cardUsable: function(card, player, num) {
                                if (!player.countCards('he', {
                                    name: 'yuxi'
                                }) && card.name == 'sha') return num + 1;
                            },
                        },
                        init: function(player, skill) {
                            lib.card.yuxi.skills = ["ssr_yuxi"];
                            lib.translate['yuxi_info'] = '锁定技，①你视为拥有你武将牌上的主公技；②你的手牌上限加一，摸牌阶段你额外摸一张牌；③你和所有其他角色互相视为在彼此的攻击范围内。（此牌在装备区时不能被其他角色弃置）';
                            if (lib.card.yuxi.mode && !lib.card.yuxi.mode.contains(get.mode())) lib.card.yuxi.mode.add(get.mode());
                            lib.card.yuxi.ai = {
                                basic: {
                                    equipValue: 9,
                                    useful: 9,
                                    order: 9,
                                    value: 9,
                                },
                                result: {
                                    target: (player, target, card) =>get.equipResult(player, target, card.name),
                                },
                            };
                            /*lib.card.yuxi.onLose=function(){
		                        //player.removeAdditionalSkill('ssr_yuxi');
		                    };*/
                            lib.card.yuxi.onEquip = function() {
                                player.hasZhuSkill = function(skill, player) {
                                    if (!this.hasSkill(skill)) return false;
                                    if (this.countCards('e', {
                                        name: 'yuxi'
                                    })) return true;
                                    var mode = get.mode();
                                    if (mode == 'identity' || (mode == 'versus' && (_status.mode == 'four' || _status.mode == 'guandu'))) {
                                        if (mode != 'identity') {
                                            if (player && this.side != player.side) return false;
                                        }
                                        if (_status.mode == 'purple') {
                                            if (player && this.identity.slice(0, 1) != player.identity.slice(0, 1)) return false;
                                        }
                                        if (this.isZhu == true) return true;
                                        for (var i in this.storage) {
                                            if (i.indexOf('zhuSkill_') == 0 && this.storage[i].contains(skill)) return true;
                                        }
                                    }
                                    return false;
                                };
                                /*var listm=[];
		                        var listv=[];
		                        var list=[];
		                        if (player.name1 != undefined) listm = lib.character[player.name1][3];
		                        else listm = lib.character[player.name][3];
		                        if (player.name2 != undefined) listv = lib.character[player.name2][3];
		                        listm = listm.concat(listv);
		                        if(listm&&listm.length){
		                            for(var i=0;i<listm.length;i++){
		                                if(lib.skill[listm[i]]&&lib.skill[listm[i]].zhuSkill){
		                                    list.push(listm[i]);
		                                }
		                            }
		                        }
		                        player.addAdditionalSkill('ssr_yuxi',list);
		                        game.broadcastAll(function(list){
		                            game.expandSkills(list);
		                            for(var i of list){
		                                var info=lib.skill[i];
		                                if(!info) continue;
		                                if(!info.audioname2) info.audioname2={};
		                                info.audioname2[player.name]='weidi';
		                            }
		                        },list);*/
                            };
                        },
                    },
                    "ssr_yuxi": {
                        subSkill: {
                            dis: {
                                mod: {
                                    inRange: function(from, to) {
                                        if (to.countCards('e', {
                                            name: 'yuxi'
                                        })) return true;
                                    },
                                },
                                sub: true,
                            },
                        },
                        trigger: {
                            player: "phaseDrawBegin2",
                        },
                        forced: true,
                        preHidden: true,
                        priority: 7,
                        filter: function(event, player) {
                            return ! event.numFixed;
                        },
                        global: 'ssr_yuxi_dis',
                        content: function() {
                            trigger.num++;
                        },
                        ai: {
                            threaten: 1.3,
                        },
                        mod: {
                            maxHandcardBase: function(player, num) {
                                return num + 1;
                            },
                            inRange: function(from, to) {
                                return true;
                            },
                            canBeDiscarded: function(card) {
                                if (get.position(card) == 'e' && card.name == 'yuxi') return false;
                            },
                        },
                    },
                    "ssr_wangzun": {
                        subSkill: {
                            sha: {
                                trigger: {
                                    player: "useCard",
                                },
                                mark: true,
                                forced: true,
                                filter: function(event, player) {
                                    if (_status.currentPhase != player) return false;
                                    if (event.skill == 'qinglong_skill') return false;
                                    return (event.card.name == 'sha' && player.getStat().card.sha > 1);
                                },
                                content: function() {},
                                intro: {
                                    content: function(storage, player, skill) {
                                        return '你的回合内你可以额外使用一张【杀】';
                                    },
                                },
                                mod: {
                                    cardUsable: function(card, player, num) {
                                        if (card.name == 'sha') return num + 1;
                                    },
                                },
                                sub: true,
                            },
                        },
                        audio: "wangzun",
                        trigger: {
                            global: "phaseDrawBegin",
                        },
                        check: function(event, player) {
                            var att = get.attitude(player, event.player);
                            if (event.player == player) var att = 0 - att;
                            return ! game.hasPlayer(function(current) {
                                return get.attitude(player, current) < att;
                            });
                        },
                        filter: function(event, player) {
                            return event.player.identity == 'zhu';
                        },
                        priority: -2,
                        logTarget: "player",
                        content: function() {
                            "step 0";
                            trigger.num--;
                            player.chooseTarget(get.prompt('ssr_wangzun'), '请选择移走牌的角色和获得牌的角色？', 2, true,
                            function(card, player, target) {
                                if (ui.selected.targets.length == 0) {
                                    return target.countCards('h') >= 1;
                                } else {
                                    return true;
                                }
                            },
                            function(target) {
                                if (ui.selected.targets.length == 0) {
                                    return - get.attitude(player, target);
                                } else {
                                    return get.attitude(player, target);
                                }
                            }).set('targetprompt', ["被移走", "获得牌"]);
                            'step 1';
                            var target = result.targets[0];
                            var target2 = result.targets[1];
                            event.target = result.targets[0];
                            event.target2 = result.targets[1];
                            if (target.countGainableCards(target2, 'h')) {
                                event.videoId = lib.status.videoId++;
                                var cards = target.getCards('h');
                                if (player.isOnline2()) {
                                    player.send(function(cards, id) {
                                        ui.create.dialog('妄尊', cards).videoId = id;
                                    },
                                    cards, event.videoId);
                                }
                                event.dialog = ui.create.dialog('妄尊', cards);
                                event.dialog.videoId = event.videoId;
                                if (!event.isMine()) {
                                    event.dialog.style.display = 'none';
                                }
                                player.chooseButton().set('filterButton',
                                function(button) {
                                    return true;
                                }).set('dialog', event.videoId);
                            }
                            'step 2';
                            event.card = result.links[0];
                            var card = event.card;
                            event.dialog.close();
                            var target = event.target
                            var target2 = event.target2;
                            target2.gain(card, target);
                            target.$giveAuto(card, target2);
                            "step 3";
                            trigger.player.addTempSkill('ssr_wangzun_sha', {
                                player: 'phaseEnd'
                            });
                        },
                        ai: {
                            expose: 0.2,
                            result: {
                                target: function(player, target) {
                                    var ok = false;
                                    var hs = player.getCards('h');
                                    if (hs.length <= 1) return 0;
                                    for (var i = 0; i < hs.length; i++) {
                                        if (get.value(hs[i]) <= 5) {
                                            ok = true;
                                            break;
                                        }
                                    }
                                    if (!ok) return 0;
                                    if (ui.selected.targets.length == 1) {
                                        if (target.hasSkillTag('nogain')) return 0;
                                        return 2;
                                    }
                                    if (target.countCards('he') == 0) return 0;
                                    if (player.hasFriend()) return - 1;
                                    return 0;
                                },
                            },
                        },
                    },
                    "ssr_cuandi": {
                        audio: 'drlt_weidi',
                        trigger: {
                            target: 'useCardToTargeted'
                        },
                        check: function(event, player) {
                            var cards = player.getCards('h');
                            if (cards.length <= 2) {
                                for (var i = 0; i < cards.length; i++) {
                                    if (cards[i].name == 'shan' || cards[i].name == 'tao') return false;
                                }
                            }
                            return true;
                        },
                        filter: function(event, player) {
                            if (!player.hasZhuSkill('ssr_cuandi')) return false;
                            return event.card.name == 'sha';
                        },
                        priority: -15,
                        zhuSkill: true,
                        content: function() {
                            "step 0";
                            var targets = game.filterPlayer();
                            targets.remove(player);
                            event.targets = targets;
                            event.damages = [];
                            "step 1";
                            if (event.targets.length) {
                                var current = event.targets.shift();
                                if (current.group == 'qun') {
                                    current.chooseBool('篡帝：是否令' + get.translation(player) + '额外天命一张手牌？').set('ai',
                                    function() {
                                        return get.attitude(_status.event.player, _status.event.target) > 0;
                                    }).set('target', player);
                                    event.current = current;
                                } else {
                                    event.redo();
                                }
                            } else {
                                event.goto(3);
                            }
                            "step 2";
                            if (result.bool) {
                                event.damages.push(event.current);
                                event.current.line(player, 'gray');
                                game.log(event.current, '令', player, '额外天命一张手牌');
                            }
                            if (event.targets.length) {
                                event.goto(1);
                            }
                            "step 3";
                            if (event.damages.length) {
                                var num = event.damages.length;
                                player.chooseToDiscard(num, true, 'h');
                                player.draw(num);
                            }
                            /*"step 1";
							player.chooseToDiscard(2,true,'he');
							player.draw(2);
							var players=game.filterPlayer();
							players.sort(function(a,b){
								return b.hp-a.hp;
							});
							if(players[0].hp>players[1].hp&&players[0]!=player){
								players[0].chooseBool(get.prompt2('tianming'));
								event.player=players[0];
							}
							else{
								event.finish();
							}
							"step 1";
							if(result.bool){
								player.chooseToDiscard(2,true,'he');
								player.draw(2);
							}*/
                        },
                        ai: {
                            effect: {
                                target: function(card, player, target, current) {
                                    if (card.name == 'sha') return [1, 0.5];
                                }
                            }
                        }
                    },
                    "ssr_yanji": {
                        subSkill: {
                            dis: {
                                mod: {
                                    targetEnabled: function(card, player, target) {
                                        if (card.name == 'sha') {
                                            if (player.hasSkill('ssr_yanji')) return;
                                            if (target.hasSkill('ssr_yanji')) return;
                                            if (game.hasPlayer(function(current) {
                                                return current.hasSkill('ssr_yanji') && player.inRange(current);
                                            })) {
                                                return false;
                                            }
                                        }
                                    }
                                },
                                sub: true,
                            },
                        },
                        global: 'ssr_yanji_dis',
                        audio: "dccanxi",
                        trigger: {
                            target: "useCardToTarget",
                        },
                        direct: true,
                        filter: function(event, player) {
                            if (event.card.name != 'sha') return false;
                            return player.countCards('he') > 0 && game.hasPlayer(function(current) {
                                return current != event.player && current != player; //&&event.player.canUse(event.card,current,false,false);//lib.filter.targetEnabled(event.card,event.player,current);
                            });
                        },
                        content: function() {
                            "step 0";
                            var evt = trigger.getParent();
                            var next = player.chooseCardTarget({
                                position: 'he',
                                filterCard: lib.filter.cardDiscardable,
                                filterTarget: function(card, player, target) {
                                    var trigger = _status.event;
                                    if (target != trigger.source) {
                                        //if(lib.filter.targetEnabled(trigger.card,trigger.source,target)) return true;
                                        //if(trigger.source.canUse(trigger.card,target,false,false)) return true;
                                        return ! evt || !evt.targets || !evt.targets.contains(target);
                                    }
                                    return false;
                                },
                                ai1: function(card) {
                                    return get.unuseful(card) + 9;
                                },
                                ai2: function(target) {
                                    var trigger = _status.event.getTrigger();
                                    var player = _status.event.player;
                                    return get.effect(target, trigger.card, trigger.player, player) + 0.1;
                                    /*后面的没啥用了*/
                                    if (_status.event.player.countCards('h', 'shan')) {
                                        return - get.attitude(_status.event.player, target);
                                    }
                                    if (get.attitude(_status.event.player, target) < 5) {
                                        return 6 - get.attitude(_status.event.player, target);
                                    }
                                    if (_status.event.player.hp == 1 && player.countCards('h', 'shan') == 0) {
                                        return 10 - get.attitude(_status.event.player, target);
                                    }
                                    if (_status.event.player.hp == 2 && player.countCards('h', 'shan') == 0) {
                                        return 8 - get.attitude(_status.event.player, target);
                                    }
                                    return - 1;
                                },
                                prompt: get.prompt2('ssr_yanji'),
                                source: trigger.player,
                                card: trigger.card,
                            }).setHiddenSkill(event.name);
                            "step 1";
                            if (result.bool) {
                                var target = result.targets[0];
                                player.logSkill(event.name, target);
                                player.discard(result.cards);
                                var evt = trigger.getParent();
                                //evt.triggeredTargets2.remove(player);
                                //evt.targets.remove(player);
                                evt.targets.push(target);
                            }
                        },
                    },
                    "ssr_tongji": {
                        audio: "tongji",
                        trigger: {
                            target: "useCardToTarget",
                        },
                        direct: true,
                        filter: function(event, player) {
                            if (event.card.name != 'sha') return false;
                            return game.hasPlayer(function(current) {
                                return current != event.player && current != player && lib.filter.targetEnabled(event.card, event.player, current);
                            });
                        },
                        content: function() {
                            "step 0";
                            var him = trigger.player;
                            var use = trigger.card;
                            player.chooseTarget(get.prompt('ssr_tongji'), '是否为此【杀】额外指定一个目标？', 1,
                            function(card, player, target) {
                                var trigger = _status.event;
                                if (target != him) {
                                    if (lib.filter.targetEnabled(use, him, target)) return player.inRange(target);
                                }
                                return false;
                            },
                            function(target) {
                                if (_status.event.player.countCards('h', 'shan')) {
                                    return - get.attitude(_status.event.player, target);
                                }
                                if (get.attitude(_status.event.player, target) < 5) {
                                    return 6 - get.attitude(_status.event.player, target);
                                }
                                if (_status.event.player.hp == 1 && player.countCards('h', 'shan') == 0) {
                                    return 10 - get.attitude(_status.event.player, target);
                                }
                                if (_status.event.player.hp == 2 && player.countCards('h', 'shan') == 0) {
                                    return 8 - get.attitude(_status.event.player, target);
                                }
                                return - 1;
                            });
                            "step 1";
                            if (result.bool) {
                                var target = result.targets[0];
                                player.logSkill(event.name, target);
                                var evt = trigger.getParent();
                                evt.targets.push(target);
                            }
                        },
                    },
                    "ssr_wushen": {
                        group: ["ssr_wushen_dam", "ssr_wushen_kill"],
                        subSkill: {
                            dam: {
                                audio: "wuhun",
                                trigger: {
                                    source: "damageBefore",
                                },
                                forced: true,
                                filter: function(event, player) {
                                    return event.card && event.card.name == 'sha' && get.color(event.card) == 'red';
                                },
                                content: function() {
                                    trigger.num++;
                                },
                                ai: {
                                    player: function(card, player, target) {
                                        if (card.name == 'sha' && get.color(card) == 'red') return [1, 2.5];
                                    },
                                },
                                sub: true,
                            },
                            kill: {
                                shaRelated: true,
                                trigger: {
                                    player: "useCardToPlayered",
                                },
                                priority: 3,
                                forced: true,
                                logTarget: "target",
                                filter: function(event, player) {
                                    return event.card.name == 'sha' && get.color(event.card) == 'red' && event.target.hp == 1;
                                },
                                preHidden: true,
                                content: function() {
                                    "step 0";
                                    trigger.getParent().directHit.add(trigger.target);
                                },
                                ai: {
                                    "directHit_ai": true,
                                    skillTagFilter: function(player, tag, arg) {
                                        if (get.attitude(player, arg.target) > 0 || arg.target.hp != 1 || arg.card.name != 'sha' || !ui.cardPile.firstChild || get.color(arg.card) != 'red') return false;
                                    },
                                },
                            },
                        },
                        audio: "wushen",
                        enable: ["chooseToRespond", "chooseToUse"],
                        filterCard: function(card, player) {
                            if (get.zhu(player, 'shouyue')) return true;
                            return get.color(card) == 'red';
                        },
                        position: "hes",
                        viewAs: {
                            name: "sha",
                        },
                        viewAsFilter: function(player) {
                            if (get.zhu(player, 'shouyue')) {
                                if (!player.countCards('hes')) return false;
                            } else {
                                if (!player.countCards('hes', {
                                    color: 'red'
                                })) return false;
                            }
                        },
                        prompt: "武神：是否将一张红色牌当【杀】使用或打出？",
                        check: function(card) {
                            return 10 - get.value(card)
                        },
                        ai: {
                            skillTagFilter: function(player) {
                                if (!player.countCards('hes', {
                                    color: 'red'
                                })) return false;
                            },
                            aiOrder: function(player, card, num) {
                                if (card.name == 'sha' && get.color(card) == 'red') {
                                    return num + 10;
                                }
                            },
                            respondSha: true,
                            yingbian: function(card, player, targets, viewer) {
                                if (get.attitude(viewer, player) <= 0) return 0;
                                var base = 0,
                                hit = false;
                                if (get.cardtag(card, 'yingbian_hit')) {
                                    hit = true;
                                    if (targets.filter(function(target) {
                                        return target.hasShan() && get.attitude(viewer, target) < 0 && get.damageEffect(target, player, viewer, get.nature(card)) > 0;
                                    })) base += 5;
                                }
                                if (get.cardtag(card, 'yingbian_all')) {
                                    if (game.hasPlayer(function(current) {
                                        return ! targets.contains(current) && lib.filter.targetEnabled2(card, player, current) && get.effect(current, card, player, player) > 0;
                                    })) base += 5;
                                }
                                if (get.cardtag(card, 'yingbian_damage')) {
                                    if (targets.filter(function(target) {
                                        return get.attitude(player, target) < 0 && (hit || !target.mayHaveShan() || player.hasSkillTag('directHit_ai', true, {
                                            target: target,
                                            card: card,
                                        },
                                        true)) && !target.hasSkillTag('filterDamage', null, {
                                            player: player,
                                            card: card,
                                            jiu: true,
                                        })
                                    })) base += 5;
                                }
                                return base;
                            },
                            canLink: function(player, target, card) {
                                if (!target.isLinked() && !player.hasSkill('wutiesuolian_skill')) return false;
                                if (target.mayHaveShan() && !player.hasSkillTag('directHit_ai', true, {
                                    target: target,
                                    card: card,
                                },
                                true)) return false;
                                if (player.hasSkill('jueqing') || target.hasSkill('gangzhi') || target.hasSkill('gangzhi')) return false;
                                return true;
                            },
                            basic: {
                                useful: [7, 1],
                                value: [7, 1],
                            },
                            order: function(item, player) {
                                if (player.hasSkillTag('presha', true, null, true)) return 10;
                                if (lib.linked.contains(get.nature(item))) {
                                    if (game.hasPlayer(function(current) {
                                        return current != player && current.isLinked() && player.canUse(item, current, null, true) && get.effect(current, item, player, player) > 0 && lib.card.sha.ai.canLink(player, current, item);
                                    }) && game.countPlayer(function(current) {
                                        return current.isLinked() && get.damageEffect(current, player, player, get.nature(item)) > 0;
                                    }) > 1) return 5.1;
                                    return 5;
                                }
                                return 5.05;
                            },
                            result: {
                                target: function(player, target, card, isLink) {
                                    var eff = function() {
                                        if (!isLink && player.hasSkill('jiu')) {
                                            if (!target.hasSkillTag('filterDamage', null, {
                                                player: player,
                                                card: card,
                                                jiu: true,
                                            })) {
                                                if (get.attitude(player, target) > 0) {
                                                    return - 7;
                                                } else {
                                                    return - 4;
                                                }
                                            }
                                            return - 0.5;
                                        }
                                        return - 1.5;
                                    } ();
                                    if (!isLink && target.mayHaveShan() && !player.hasSkillTag('directHit_ai', true, {
                                        target: target,
                                        card: card,
                                    },
                                    true)) return eff / 1.2;
                                    return eff;
                                },
                            },
                            tag: {
                                respond: 1,
                                respondShan: 1,
                                damage: function(card) {
                                    if (card.nature == 'poison') return;
                                    if (get.color(card) == 'red') return 4;
                                    return 1;
                                },
                                natureDamage: function(card) {
                                    if (card.nature && get.color(card) == 'red') return 4;
                                },
                                fireDamage: function(card, nature) {
                                    if (card.nature == 'fire' && get.color(card) == 'red') return 4;
                                },
                                thunderDamage: function(card, nature) {
                                    if (card.nature == 'thunder' && get.color(card) == 'red') return 4;
                                },
                                poisonDamage: function(card, nature) {
                                    if (card.nature == 'poison' && get.color(card) == 'red') return 4;
                                },
                            },
                        },
                    },
                    "ssr_wusheng": {
                        group: ["ssr_wusheng_kill"],
                        subSkill: {
                            kill: {
                                shaRelated: true,
                                trigger: {
                                    player: "useCardToPlayered",
                                },
                                audio: 'wushen',
                                priority: 3,
                                forced: true,
                                logTarget: "target",
                                filter: function(event, player) {
                                    return event.card.name == 'sha' && event.getParent().jiu == true;
                                },
                                preHidden: true,
                                content: function() {
                                    "step 0";
                                    trigger.getParent().directHit.add(trigger.target);
                                },
                                ai: {
                                    "directHit_ai": true,
                                    skillTagFilter: function(player, tag, arg) {
                                        if (get.attitude(player, arg.target) > 0 || !player.hasSkill('jiu') || arg.card.name != 'sha') return false;
                                    },
                                },
                            },
                        },
                        audio: "sbwusheng",
                        enable: ["chooseToRespond", "chooseToUse"],
                        filterCard: function(card, player) {
                            if (get.zhu(player, 'shouyue')) return true;
                            return get.color(card) == 'red';
                        },
                        position: "hes",
                        viewAs: {
                            name: "sha",
                        },
                        viewAsFilter: function(player) {
                            if (get.zhu(player, 'shouyue')) {
                                if (!player.countCards('hes')) return false;
                            } else {
                                if (!player.countCards('hes', {
                                    color: 'red'
                                })) return false;
                            }
                        },
                        prompt: "将一张红色牌当杀使用或打出",
                        check: function(card) {
                            var val = get.value(card);
                            if (_status.event.name == 'chooseToRespond') return 1 / Math.max(0.1, val);
                            return 5 - val;
                        },
                        ai: {
                            skillTagFilter: function(player) {
                                if (get.zhu(player, 'shouyue')) {
                                    if (!player.countCards('hes')) return false;
                                } else {
                                    if (!player.countCards('hes', {
                                        color: 'red'
                                    })) return false;
                                }
                            },
                            respondSha: true,
                            yingbian: function(card, player, targets, viewer) {
                                if (get.attitude(viewer, player) <= 0) return 0;
                                var base = 0,
                                hit = false;
                                if (get.cardtag(card, 'yingbian_hit')) {
                                    hit = true;
                                    if (targets.filter(function(target) {
                                        return target.hasShan() && get.attitude(viewer, target) < 0 && get.damageEffect(target, player, viewer, get.nature(card)) > 0;
                                    })) base += 5;
                                }
                                if (get.cardtag(card, 'yingbian_all')) {
                                    if (game.hasPlayer(function(current) {
                                        return ! targets.contains(current) && lib.filter.targetEnabled2(card, player, current) && get.effect(current, card, player, player) > 0;
                                    })) base += 5;
                                }
                                if (get.cardtag(card, 'yingbian_damage')) {
                                    if (targets.filter(function(target) {
                                        return get.attitude(player, target) < 0 && (hit || !target.mayHaveShan() || player.hasSkillTag('directHit_ai', true, {
                                            target: target,
                                            card: card,
                                        },
                                        true)) && !target.hasSkillTag('filterDamage', null, {
                                            player: player,
                                            card: card,
                                            jiu: true,
                                        })
                                    })) base += 5;
                                }
                                return base;
                            },
                            canLink: function(player, target, card) {
                                if (!target.isLinked() && !player.hasSkill('wutiesuolian_skill')) return false;
                                if (target.mayHaveShan() && !player.hasSkillTag('directHit_ai', true, {
                                    target: target,
                                    card: card,
                                },
                                true)) return false;
                                if (player.hasSkill('jueqing') || player.hasSkill('gangzhi') || target.hasSkill('gangzhi')) return false;
                                return true;
                            },
                            basic: {
                                useful: [5, 3, 1],
                                value: [5, 3, 1],
                            },
                            order: function(item, player) {
                                if (player.hasSkillTag('presha', true, null, true)) return 10;
                                if (lib.linked.contains(get.nature(item))) {
                                    if (game.hasPlayer(function(current) {
                                        return current != player && current.isLinked() && player.canUse(item, current, null, true) && get.effect(current, item, player, player) > 0 && lib.card.sha.ai.canLink(player, current, item);
                                    }) && game.countPlayer(function(current) {
                                        return current.isLinked() && get.damageEffect(current, player, player, get.nature(item)) > 0;
                                    }) > 1) return 3.1;
                                    return 3;
                                }
                                return 3.05;
                            },
                            result: {
                                target: function(player, target, card, isLink) {
                                    var eff = function() {
                                        if (!isLink && player.hasSkill('jiu')) {
                                            if (!target.hasSkillTag('filterDamage', null, {
                                                player: player,
                                                card: card,
                                                jiu: true,
                                            })) {
                                                if (get.attitude(player, target) > 0) {
                                                    return - 7;
                                                } else {
                                                    return - 4;
                                                }
                                            }
                                            return - 0.5;
                                        }
                                        return - 1.5;
                                    } ();
                                    if (!isLink && target.mayHaveShan() && !player.hasSkillTag('directHit_ai', true, {
                                        target: target,
                                        card: card,
                                    },
                                    true)) return eff / 1.2;
                                    return eff;
                                },
                            },
                            tag: {
                                respond: 1,
                                respondShan: 1,
                                damage: function(card) {
                                    if (card.nature == 'poison') return;
                                    return 1;
                                },
                                natureDamage: function(card) {
                                    if (card.nature) return 1;
                                },
                                fireDamage: function(card, nature) {
                                    if (card.nature == 'fire') return 1;
                                },
                                thunderDamage: function(card, nature) {
                                    if (card.nature == 'thunder') return 1;
                                },
                                poisonDamage: function(card, nature) {
                                    if (card.nature == 'poison') return 1;
                                },
                            },
                        },
                    },
                    "ssr_baiyi": {
                        audio: "botu",
                        trigger: {
                            global: "useCard",
                        },
                        priority: 5,
                        filter: function(event, player) {
                            if (get.type(event.card) != 'trick') return false;
                            //if(get.info(event.card).multitarget) return false;
                            if (event.targets.length < 2) return false;
                            return true;
                        },
                        direct: true,
                        content: function() {
                            "step 0";
                            player.chooseTarget(get.prompt('ssr_baiyi'), 1,
                            function(card, player, target) {
                                var evt = _status.event.getTrigger();
                                return evt.targets.contains(target) && !evt.excluded.contains(target);
                            }).set('ai',
                            function(target) {
                                var trigger = _status.event.getTrigger();
                                if (game.phaseNumber > game.players.length * 2 && trigger.targets.length >= game.players.length - 1) {
                                    return - get.effect(target, trigger.card, trigger.player, _status.event.player);
                                }
                                return - 1;
                            });
                            "step 1";
                            if (result.bool) {
                                player.logSkill('ssr_baiyi', result.targets);
                                trigger.excluded.addArray(result.targets);
                                game.delay();
                            }
                        },
                    },
                    "ssr_yijue": {
                        audio: 'sbyijue',
                        enable: "phaseUse",
                        usable: 1,
                        discard: false,
                        lose: false,
                        delay: 0,
                        derivation: ['shuiyanqijunx', 'mashu'],
                        filter: function(event, player) {
                            return player.countCards('hes');
                        },
                        filterCard: function(card) {
                            return true;
                        },
                        filterTarget: function(card, player, target) {
                            return player != target;
                        },
                        position: 'hes',
                        check: function(card) {
                            if (get.color(card) == 'red') return 6 - get.value(card);
                            return 8 - get.value(card);
                        },
                        content: function() {
                            "step 0";
                            if (target.countCards('e')) {
                                player.useCard(cards, target, {
                                    name: 'shuiyanqijunx'
                                },
                                false);
                            } else {
                                target.draw();
                                player.useCard(cards, player, {
                                    name: 'jiu'
                                },
                                false);
                                player.addTempSkill('mashu');
                            }
                        },
                        ai: {
                            result: {
                                player: function(player, target) {
                                    if (player.countCards('hes', {
                                        color: 'red'
                                    }) + player.countCards('hes', {
                                        name: 'sha'
                                    })) {
                                        return 1.5;
                                    } else {
                                        return 0;
                                    }
                                },
                                target: function(player, target, card, isLink) {
                                    if (target.countCards('e')) {
                                        if (get.attitude(player, target) > 0) return - 5;
                                        return - 0.5 * target.countCards('e');
                                    } else {
                                        return 0.5;
                                    }
                                },
                            },
                            basic: {
                                order: 10,
                            },
                        },
                    },
                    "ssr_nuzhan": {
                        subSkill: {
                            kill: {
                                audio: 'wuhun21',
                                firstDo: true,
                                trigger: {
                                    player: "useCard1",
                                },
                                forced: true,
                                filter: function(event, player) {
                                    return ! event.audioed && event.card.name == 'sha' && player.countUsed('sha', true) > 1 && event.getParent().type == 'phase';
                                },
                                content: function() {
                                    trigger.audioed = true;
                                },
                                mod: {
                                    cardUsable: function(card, player, num) {
                                        if (card.name == 'sha') return Infinity;
                                    },
                                },
                                mark: true,
                                marktext: "怒魂",
                                intro: {
                                    content: "<li>本回合内使用【杀】没有次数限制",
                                },
                                ai: {
                                    unequip: true,
                                    skillTagFilter: function(player, tag, arg) {
                                        if (arg && arg.name == 'sha') return true;
                                        return false;
                                    },
                                },
                                sub: true,
                            },
                        },
                        skillAnimation: true,
                        animationColor: "red",
                        audio: "wuhun22",
                        trigger: {
                            source: "dieBegin",
                        },
                        forced: true,
                        filter: function(event, player) {
                            return true;
                        },
                        content: function() {
                            'step 0';
                            trigger.source = undefined;
                            player.draw(2);
                            player.addTempSkill("ssr_nuzhan_kill");
                        },
                    },
                    "ssr_liecheng": {
                        subSkill: {
                            heart: {
                                trigger: {
                                    global: ["phaseBefore", "die"],
                                },
                                filter: function(event, player) {
                                    return event.player == player.storage.ssr_liecheng_heart;
                                },
                                charlotte: true,
                                forced: true,
                                silent: true,
                                intro: {
                                    name: "攻心为上",
                                    content: "你区域内的牌均视为红桃牌。",
                                },
                                mark: true,
                                marktext: "攻心",
                                content: function() {
                                    player.removeSkill('ssr_liecheng_heart');
                                },
                                mod: {
                                    suit: function(card, suit) {
                                        return 'heart';
                                    },
                                },
                                target: function(card, player, target, current) {
                                    if (card.name == 'huogong') {
                                        if (player.countCards('h', {
                                            suit: 'heart'
                                        }) && get.attitude(player, target) <= 0) {
                                            return 2;
                                        } else {
                                            return 'zeroplayertarget';
                                        }
                                    }
                                },
                                sub: true,
                            },
                        },
                        audio: 'sbduojing',
                        trigger: {
                            player: "phaseZhunbeiBegin",
                        },
                        priority: 3,
                        direct: true,
                        preHidden: true,
                        content: function() {
                            "step 0";
                            player.chooseTarget(get.prompt2('ssr_liecheng'),
                            function(card, player, target) {
                                return player != target;
                            }).set('ai',
                            function(target) {
                                var player = _status.event.player;
                                return 100 - get.attitude(player, target);
                            }).setHiddenSkill(event.name);
                            "step 1";
                            if (result.bool) {
                                player.logSkill(event.name, result.targets);
                                event.target = result.targets[0];
                                event.target.chooseToRespond(1, {
                                    name: 'sha'
                                },
                                '猎城：打出一张【杀】，否则令' + get.translation(player.name) + '获得一张装备牌且你的手牌和判定牌均视为红桃').set('check',
                                function(card) {
                                    if (get.attitude(target, player) > 0) return 0;
                                    return 9 - get.value(card);
                                });
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            "step 2";
                            if (!result.bool) {
                                event.card = get.cardPile(function(card) {
                                    return get.type(card) == 'equip';
                                });
                                if (event.card) {
                                    player.gain(event.card, 'draw');
                                }
                                event.target.addSkill('ssr_liecheng_heart');
                                event.target.storage.ssr_liecheng_heart = player;
                            }
                        },
                    },
                    "ssr_newbaiyi": {
                        subSkill: {
                            break: {
                                trigger: {
                                    global: ["phaseEnd"],
                                },
                                filter: function(event, player) {
                                    return true;
                                },
                                priority: 5,
                                charlotte: true,
                                forced: true,
                                silent: true,
                                intro: {
                                    name: "白衣渡江",
                                    content: function(storage, player) {
                                        var card = player.storage.ssr_newbaiyi_break_card;
                                        return '你不能成为其他角色使用的锦囊牌或红色【杀】的目标';
                                    },
                                    mark: function(dialog, storage, player) {
                                        var card = player.storage.ssr_newbaiyi_break_card;
                                        dialog.addAuto(card);
                                        return '你不能成为其他角色使用的锦囊牌或红色【杀】的目标';
                                    },
                                },
                                mark: true,
                                marktext: "渡",
                                content: function() {
                                    player.removeMark('ssr_newbaiyi_break');
                                    if (player.countMark('ssr_newbaiyi_break') < 1) {
                                        player.removeSkill('ssr_newbaiyi_break');
                                        /*event.card=get.cardPile(function(card){
				                            return get.type(card)=='trick';
				                        });
				                        if(event.card){
				                            player.gain(event.card,'draw');
				                        }*/
                                        player.draw(2);
                                    }
                                },
                                onremove: function(player) {
                                    var cards = [player.storage.ssr_newbaiyi_break_card];
                                    if (cards.length) player.loseToDiscardpile(cards);
                                },
                                mod: {
                                    targetEnabled: function(card, player, target) {
                                        if ((get.type(card, 'trick') == 'trick' || (get.color(card) == 'red' && card.name == 'sha')) && player != target) return false;
                                    },
                                },
                                sub: true,
                            },
                        },
                        audio: "sbdujiang",
                        enable: "phaseUse",
                        filterCard: function(card) {
                            return get.type(card) == 'equip';
                        },
                        selectCard: 1,
                        filter: function(event, player) {
                            return player.countCards('he', {
                                type: 'equip'
                            }) > 0;
                        },
                        filterTarget: function(card, player, target) {
                            if (target.hasSkill('ssr_newbaiyi_break')) return false;
                            return true;
                        },
                        content: function() {
                            "step 0";
                            target.addSkill('ssr_newbaiyi_break');
                            target.storage.ssr_newbaiyi_break_card = cards;
                            target.addMark('ssr_newbaiyi_break', get.number(cards[0]));
                        },
                        check: function(card) {
                            return 8 - get.value(card);
                        },
                        position: "he",
                        ai: {
                            order: 9,
                            result: {
                                target: function(player, target) {
                                    return 2;
                                },
                            },
                        },
                    },
                    "ssr_gongxin": {
                        subSkill: {
                            break: {
                                trigger: {
                                    global: ["phaseBefore", "die"],
                                },
                                filter: function(event, player) {
                                    return event.player == player.storage.ssr_gongxin_break;
                                },
                                charlotte: true,
                                forced: true,
                                silent: true,
                                intro: {
                                    name: "魂飞魄散",
                                    content: "你不能使用或打出红色的牌。",
                                },
                                mark: true,
                                marktext: "破魂",
                                content: function() {
                                    player.removeSkill('ssr_gongxin_break');
                                },
                                mod: {
                                    cardSavable: function(card, player) {
                                        if (get.color(card) == 'red') return false;
                                    },
                                    cardEnabled: function(card, player) {
                                        if (get.color(card) == 'red') return false;
                                    },
                                    cardResponsabled: function(card, player) {
                                        if (get.color(card) == 'red') return false;
                                    },
                                },
                                sub: true,
                            },
                        },
                        audio: "gongxin",
                        enable: "phaseUse",
                        filterCard: function(card) {
                            return get.suit(card) == 'heart';
                        },
                        selectCard: function() {
                            return 1;
                        },
                        filter: function(event, player) {
                            return player.countCards('he', {
                                suit: 'heart'
                            }) > 0;
                        },
                        filterTarget: function(card, player, target) {
                            if (player == target) return false;
                            if (target.hasSkill('ssr_gongxin_break')) return false;
                            return true;
                        },
                        content: function() {
                            "step 0";
                            target.storage.ssr_gongxin_break = player;
                            "step 1";
                            target.addSkill('ssr_gongxin_break');
                        },
                        check: function(card) {
                            return 10 - get.value(card);
                        },
                        position: "he",
                        ai: {
                            order: 9,
                            result: {
                                target: function(player, target) {
                                    if (!ui.selected.cards.length) {
                                        if (player.hp < 2) return 0;
                                    }
                                    return - target.countCards('h', {
                                        color: 'red'
                                    });
                                },
                            },
                            threaten: 1.2,
                        },
                    },
                    "ssr_keji": {
                        trigger: {
                            player: "phaseDiscardBefore",
                        },
                        frequent: true,
                        filter: function(event, player) {
                            return player.countCards('h', {
                                type: 'delay'
                            }) || player.countCards('h', {
                                type: 'trick'
                            });
                        },
                        content: function() {},
                        audio: "keji",
                        mod: {
                            ignoredHandcard: function(card, player) {
                                return get.name(card) == 'sha';
                                /*if(get.type(card)=='trick'||get.type(card)=='delay'){
					                return true;
					            }*/
                            },
                            cardDiscardable: function(card, player, name) {
                                if (name == 'phaseDiscard' && (get.name(card) == 'sha')) {
                                    return false;
                                }
                                /*if(name=='phaseDiscard'&&(get.type(card)=='trick'||get.type(card)=='delay')){
					                return false;
					            }*/
                            },
                        },
                    },
                    "ssr_shelie": {
                        audio: "shelie",
                        trigger: {
                            player: "phaseDrawBegin1",
                        },
                        frequent: true,
                        filter: function(event, player) {
                            return ! event.numFixed;
                        },
                        content: function() {
                            "step 0";
                            trigger.changeToZero();
                            event.cards = get.cards(4);
                            game.cardsGotoOrdering(event.cards);
                            event.videoId = lib.status.videoId++;
                            game.broadcastAll(function(player, id, cards) {
                                var str;
                                if (player == game.me && !_status.auto) {
                                    str = '涉猎：选择获得其中的两张牌';
                                } else {
                                    str = '涉猎';
                                }
                                var dialog = ui.create.dialog(str, cards);
                                dialog.videoId = id;
                            },
                            player, event.videoId, event.cards);
                            event.time = get.utc();
                            game.addVideo('showCards', player, ['涉猎', get.cardsInfo(event.cards)]);
                            game.addVideo('delay', null, 2);
                            "step 1";
                            var next = player.chooseButton(2, true);
                            next.set('dialog', event.videoId);
                            next.set('filterButton',
                            function(button) {
                                return true;
                                for (var i = 0; i < ui.selected.buttons.length; i++) {
                                    if (get.suit(ui.selected.buttons[i].link) == get.suit(button.link)) return false;
                                }
                            });
                            next.set('ai',
                            function(button) {
                                return get.value(button.link, _status.event.player);
                            });
                            "step 2";
                            if (result.bool && result.links) {
                                event.cards2 = result.links;
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            var time = 1000 - (get.utc() - event.time);
                            if (time > 0) {
                                game.delay(0, time);
                            }
                            "step 3";
                            game.broadcastAll('closeDialog', event.videoId);
                            var cards2 = event.cards2;
                            player.gain(cards2, 'log', 'gain2');
                        },
                        ai: {
                            threaten: 1.2,
                        },
                    },
                    "ssr_newyicong": {
                        mod:{
                            globalFrom:function(from,to){
                                if(to.getEquips(3).length || to.getEquips(4).length) return -Infinity;
                            },
                        },
        				shaRelated:true,
        				audio: "dcyicong",
        				preHidden:true,
        				priority: 11,
        				trigger:{
        					player:'useCardToPlayered',
        					target:'useCardToTargeted',
        				},
        				check:function(event,player){
                            if(player == event.player) {
                                return get.attitude(player, event.target) <=0;
                            }else {
                                return get.attitude(player, event.player) <=0;
                            }
                        },
        				filter:function(event,player){
        					if(event.card.name!='juedou' && event.card.name!='sha') return false;
        					if(event.player == event.target) return false;
        					if(event.player == player && event.target.countCards('h') < 1) return false;
        					var aim = event.player == player ? event.target : event.player;
        					if(!(aim.getEquips(3).length || aim.getEquips(4).length)) return false;
        					return player == event.target || event.getParent().triggeredTargets3.length == 1;
        				},
        				content:function(){
        					"step 0";
        					var finish = true;
        					if(player == trigger.player) {
        					    trigger.target.discard(trigger.target.getCards('h').randomGets(2));
        					}
        					if(player == trigger.target) {
        					    var horses = [];
        					    if(trigger.player.getEquips(3).length) {
        					        horses.addArray(trigger.player.getEquips(3));
        					    }
        					    if(trigger.player.getEquips(4).length) {
        					        horses.addArray(trigger.player.getEquips(4));
        					    }
        					    if(horses.length) {
        					        player.gain(horses.randomGet(), 'gain2');
        					        finish = false;
        					    }
        					}
        					if(finish) {
            					if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                            "step 1";
                            player.draw();
        				},
        				ai:{
        					"directHit_ai":true,
                            skillTagFilter:function(player,tag,arg){
                                if(get.attitude(player,arg.target) > 0||(arg.card.name!='sha' && arg.card.name!='juedou') || arg.target.countCards('h') > 3 || arg.target.countCards('e', {name: 'bagua'}) || arg.target.countCards('e', {name: 'lanyinjia'})) return false;
                            },
        					effect:{
        						target:function(card,player,target){
        							if((card.name=='sha' || card.name=='juedou') && (player.getEquips(3).length || player.getEquips(4).length)) return [1,0.6];
        						},
        						player:function(card,player,target){
        							if((card.name=='sha' || card.name=='juedou') && (target.getEquips(3).length || target.getEquips(4).length)) return [1,1];
        						},
        					}
        				},
                    },
                    "ssr_newyucong": {
                        enable:"phaseUse",
                        audio: "sbqiaomeng",
                        usable:1,
                        selectCard:function(){
                            return [1, game.players.length];
                        },
                        filterTarget:function (card,player,target){
                            return true;
                        },
                        complexCard:true,
                        complexSelect:true,
                        selectTarget:function (){
                            return [1, ui.selected.cards.length * 2];
                        },
                        filterCard:true,
                        check:function(card,player){
                            var ai = get.info('ssr_newyucong').ai.result;
                            if(game.players.filter(target =>{
                                return ai.player(player, target) > (ai.target(player, target) * get.sgnAttitude(player, target));
                                //return !target.getEquips(3).length&&!target.getEquips(4).length;
                            }).length <= ui.selected.cards.length * 2) return -1;
                            if(card.name == 'sha' || card.name == 'juedou') return 4-get.value(card);
                            return 7-get.value(card);
                        },
                        content:function(){
                            var horse = game.createCard({
                                name: 'dilu',
                                suit: 'club',
                                number: 11,
                            });
                            target.gain(horse, 'gain2');
                            target.equip(horse);
                        },
                        ai:{
                            order: function(item, player) {
                                if(player.countCards('hs', {name: 'sha'})) return get.order({
                                    name: 'sha'
                                }) + 0.2;
                                return 2;
                            },
                            result:{
                                player:1,
                                player: function(player, target) {
                                    if(target.getEquips(3).length || target.getEquips(4).length || get.attitude(player, target) > 0) return 0;
                                    if(player == target) return 4;
                                    return 3;
                                },
                                target: function(player, target) {
                                    if(target.getEquips(3).length) return 0;
                                    //if(target.getEquips(4).length) return 2;
                                    return 2;
                                },
                            },
                        },
                    },
                    "ssr_yicong": {
                        subSkill: {
                            horse: {
                                locked: true,
                                /*mod:{
		                            targetEnabled:function(card,player,target,now){
		                                if(target.countCards('e',{subtype:'equip3'})+target.countCards('e',{subtype:'equip4'})>0) {
		                                    if(get.type(card)=='delay') return false;
		                                }
		                            },
		                        },*/
                                shaRelated: true,
                                trigger: {
                                    player: "shaMiss",
                                },
                                filter: function(event, player) {
                                    if (player.countCards('e', {
                                        subtype: 'equip3'
                                    }) + player.countCards('e', {
                                        subtype: 'equip4'
                                    }) > 0) {
                                        if (event.target.countCards('e') > 0 && get.color(event.card) == 'black') {
                                            return event.target.countDiscardableCards(player, 'e');
                                        }
                                    }
                                },
                                check: function(event, player) {
                                    return get.attitude(player, event.target) < 0;
                                },
                                prompt: "义从：当你使用黑色的【杀】被【闪】抵消后，你可以弃置目标角色一张装备牌",
                                logTarget: "target",
                                content: function() {
                                    player.discardPlayerCard('e', trigger.target, true);
                                },
                            },
                        },
                        //global:['ssr_yicong_horse'],
                        audio: "reyicong",
                        trigger: {
                            global: "damageBegin",
                        },
                        priority: -40,
                        direct: true,
                        filter: function(event, player) {
                            if (!event.card) return false;
                            if (get.type(event.card) != 'trick' && get.type(event.card) != 'delay') return false;
                            //if(event.player!=player) return false;
                            return event.player.countCards('e',
                            function(card) {
                                return (get.subtype(card) == 'equip3' || get.subtype(card) == 'equip4');
                            }) > 0 && event.num > 0;
                        },
                        content: function() {
                            "step 0";
                            var num = trigger.num;
                            /*
					        player.choosePlayerCard(trigger.player,pos,get.prompt('ssr_yicong'),get.translation(trigger.player.name)+'即将受到'+get.cnNumber(num)+'点伤害，是否弃置其任意张坐骑牌并减少等量的伤害？',[1,num],function(card,player){
					                if(get.subtype(card)!='equip3'&&get.subtype(card)!='equip4') return false;
					                return lib.filter.cardDiscardable(card,trigger.player);
					        },function(card){
					                return 10-get.value(card);
					        });*/
                            var cards = trigger.player.getCards('e', {
                                subtype: 'equip4'
                            }).concat(trigger.player.getCards('e', {
                                subtype: 'equip3'
                            }));
                            var list = [cards, 'vcard'];
                            var dialog = ui.create.dialog('白马义从', '义从：' + get.translation(trigger.player.name) + '即将受到来自【' + get.translation(trigger.card.name) + '】的' + get.cnNumber(num) + '点伤害，是否弃置其一张坐骑牌并减少一点伤害？', list);
                            player.chooseButton(dialog, 1).set('filterButton',
                            function(button) {
                                //if(get.subtype(button.link[2])=='equip3'||get.subtype(button.link[2])=='equip4') return true;
                                return lib.filter.cardDiscardable(button.link, player);
                            }).ai = function(button) {
                                return 10 - get.value(button.link);
                                /*
					            if(get.attitude(player,trigger.player)>1) {
					                return 10-get.value(button.link);
					            }else {
					                return -1;
					            }*/
                            };
                            "step 1";
                            if (result.bool) {
                                player.logSkill(event.name, trigger.player);
                                trigger.num -= result.links.length;
                                trigger.player.discard(result.links);
                            }
                        },
                        ai: {
                            "maixie_defend": true,
                        },
                        mod: {
                            canBeDiscarded: function(card) {
                                if (get.position(card) == 'e' && ['equip3', 'equip4'].contains(get.subtype(card))) return false;
                            },
                        },
                    },
                    "ssr_yucong": {
                        subSkill: {
                            "equip3": {
                                sub: true,
                            },
                            "equip4": {
                                sub: true,
                            },
                        },
                        audio: "qiaomeng",
                        enable: "phaseUse",
                        filterCard: true,
                        usable: 2,
                        position: "h",
                        check: function(card) {
                            return 5 - get.value(card);
                        },
                        filterTarget: function(card, player, target) {
                            return true;
                        },
                        filter: function(event, player) {
                            return player.countCards('h') > 0;
                        },
                        content: function() {
                            'step 0';
                            var cho = '请选择为' + get.translation(target.name) + '装备坐骑牌的类型';
                            var chooses = ['equip4', 'equip3'];
                            if (target.countCards('e', {
                                subtype: 'equip4'
                            }) + target.countCards('e', {
                                subtype: 'equip3'
                            }) > 0) {
                                chooses.push('弃置坐骑');
                                var cho = cho + '或弃置其坐骑';
                            }
                            if (target.countCards('e', {
                                subtype: 'equip4'
                            })) {
                                var cho = cho + '<br>√该角色已装备攻击马';
                            } else {
                                var cho = cho + '<br>×该角色未装备攻击马';
                            }
                            if (target.countCards('e', {
                                subtype: 'equip3'
                            })) {
                                var cho = cho + '<br>√该角色已装备防御马';
                            } else {
                                var cho = cho + '<br>×该角色未装备防御马';
                            }
                            player.chooseControl(chooses,
                            function() {
                                if (get.attitude(player, target) > 0) {
                                    if (!target.countCards('e', {
                                        subtype: 'equip3'
                                    }) && !player.hasSkill('ssr_yucong_equip3')) return 'equip3';
                                    if (!target.countCards('e', {
                                        subtype: 'equip4'
                                    }) && !player.hasSkill('ssr_yucong_equip4')) return 'equip4';
                                    return ['equip3', 'equip4'].randomGet();
                                } else {
                                    if (chooses.contains('弃置坐骑')) {
                                        return '弃置坐骑';
                                    } else {
                                        if (target.countCards('e', {
                                            subtype: 'equip3'
                                        })) return 'equip3';
                                        if (target.countCards('e', {
                                            subtype: 'equip4'
                                        })) return 'equip4';
                                        return ['equip3', 'equip4'].randomGet();
                                    }
                                }
                            }).set('prompt', cho);
                            'step 1';
                            /*event.card=get.cardPile(function(card){
					            return get.subtype(card)==result.control;
					        });*/
                            if (result.control == '弃置坐骑') {
                                var cards = target.getCards('e', {
                                    subtype: 'equip4'
                                }).concat(target.getCards('e', {
                                    subtype: 'equip3'
                                }));
                                var list = [cards, 'vcard'];
                                var dialog = ui.create.dialog('请选择弃置' + get.translation(target.name) + '的坐骑牌', list);
                                player.chooseButton(dialog, 1, true).set('filterButton',
                                function(button) {
                                    //if(get.subtype(button.link[2])=='equip3'||get.subtype(button.link[2])=='equip4') return true;
                                    return lib.filter.cardDiscardable(button.link, player);
                                }).ai = function(button) {
                                    return get.value(button.link);
                                };
                                event.goto(5);
                            }
                            'step 2';
                            event.card = game.createCard(get.inpile(result.control).randomGet());
                            if (!event.card) {
                                target.draw();
                                player.addSkill('ssr_yucong_' + result.control);
                                event.goto(3);
                            }
                            player.showCards([event.card]);
                            "step 3";
                            player.line(target, 'green');
                            target.equip(event.card, 'gain2');
                            target.$draw(event.card);
                            'step 4'; {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                            'step 5';
                            if (result.bool) {
                                player.line(target, 'red');
                                target.discard(result.links);
                            }
                        },
                        ai: {
                            order: 8,
                            result: {
                                target: function(player, target) {
                                    if (get.attitude(player, target) > 0) {
                                        var val = -1;
                                        if (!target.countCards('e', {
                                            subtype: 'equip3'
                                        }) && !player.hasSkill('ssr_yucong_equip3')) val += 3;
                                        if (!target.countCards('e', {
                                            subtype: 'equip4'
                                        }) && !player.hasSkill('ssr_yucong_equip4')) val += 2;
                                        if (val > 0 && target.hasSkill('ssr_yicong')) val += 4;
                                    } else {
                                        var val = 1;
                                        if (target.countCards('e', {
                                            subtype: 'equip3'
                                        })) val -= 3;
                                        if (target.countCards('e', {
                                            subtype: 'equip4'
                                        })) val -= 2;
                                        if (target.hasSkill('ssr_yicong')) val -= 4;
                                    }
                                    return val;
                                },
                            },
                            threaten: 0.2,
                        },
                    },
                    "ssr_newguose": {
                        subSkill: {
                            lebu: {
                                audio: "sbguose",
                                group: ['ssr_newtongque_dice', 'ssr_newtongque_die'],
                                global: ['ssr_newguose_zhiba'],
                                trigger: {
                                    player: ["phaseUseBefore"],
                                },
                                forced: true,
                                firstDo: true,
                                filter: function(event, player) {
                                    return true;
                                },
                                content: function() {
                                    "step 0";
                                    var dicePlay = get.info('ssr_newtongque').guessDice;
                                    event.resultNum = 0;
                                    if (get.isLuckyStar(player)) {
                                        event.resultNum = dicePlay(player, 1);
                                    } else {
                                        event.resultNum = dicePlay(player);
                                    }
                                    "step 1";
                                    if (event.resultNum > player.storage.ssr_newguose_lebu) {
                                        trigger.cancel();
                                    }
                                },
                                mod: {
                                    maxHandcardBase: function(player, num) {
                                        return num - 1;
                                    },
                                },
                                mark: true,
                                marktext: '国色',
                                intro: {
                                    name: '乐不思蜀',
                                    content: '你的手牌上限-1，出牌阶段开始时需进行一次猜骰[$]，若成功则你跳过此阶段。其他角色的出牌阶段均可与你进行一次拼点：若成功则将猜骰数-1。',
                                },
                                sub: true,
                            },
                            zhiba: {
                                audio:'sbguose',
                                enable:"phaseUse",
                                prompt:function(){
                                    var player=_status.event.player;
                                    var list=game.filterPlayer(function(target){
                                        return target.hasSkill('ssr_newguose_lebu')&&player.canCompare(target);
                                    });
                                    var str='每回合限一次，和'+get.translation(list);
                                    if(list.length>1) str+='中的一人';
                                    str+='进行拼点。若你赢，你将该角色〖国色〗的猜骰数-1。';
                                    return str;
                                },
                                filter:function(event,player){
                                    if(player.countCards('h')==0) return false;
                                    return game.hasPlayer(function(target){
                                        return target.hasSkill('ssr_newguose_lebu')&&player.canCompare(target);
                                    });
                                },
                                filterTarget:function(card,player,target){
                                    return target.hasSkill('ssr_newguose_lebu')&&player.canCompare(target);
                                },
                                log:false,
                                prepare:function(cards,player,targets){
                                    targets[0].logSkill('ssr_newguose_lebu');
                                },
                                usable:1,
                                content:function(){
                                    "step 0";
                                    player.chooseToCompare(target);
                                    "step 1";
                                    if(result.bool){
                                        target.storage.ssr_newguose_lebu--;
                                        if(target.storage.ssr_newguose_lebu <= 0) {
                                            target.storage.ssr_newguose_lebu = "0";
                                        }
                                        target.markSkill('ssr_newguose_lebu');
                                        target.syncStorage('ssr_newguose_lebu');
                                        game.log(player, '拼点胜利，', target, '的〖国色〗猜骰被数-1。');
                                    }
                                },
                                ai: {
                                    basic:{
                                        order:1,
                                    },
                                    expose:0.2,
                                    result:{
                                        player:function(player){
                                            var num=player.countCards('h');
                                            if(num>player.hp) return 0;
                                            if(num==1) return -2;
                                            if(num==2) return -1;
                                            return -0.7;
                                        },
                                        target:function(player,target){
                                            if(target.skipList.includes('phaseUse')) return 0;
                                            if((target.storage.ssr_newguose_lebu || 0) < 1) return 0;
                                            //天义部分
                                            var tianyi = function() {
                                                var num=target.countCards('h');
                                                if(num==1) return -1;
                                                if(num==2) return -0.7;
                                                return -0.5;
                                            };
                                            //国色部分
                                            var guose = function() {
                                                var num=target.hp-target.countCards('h')-3;
                                                if(num>-1) return -0.01;
                                                if(target.hp<3) num--;
                                                if(target.isTurnedOver()) num/=2;
                                                var dist=get.distance(player,target,'absolute');
                                                if(dist<1) dist=1;
                                                return num/Math.sqrt(dist)*get.threaten(target,player);
                                            }
                                            return guose() * 0.8 + tianyi();
                                        },
                                    },
                                },
                            },
                        },
                        audio: "sbguose",
                        filter: function(event, player) {
                            return player.countMark('ssr_newtongque_dice') > 0;
                        },
                        filterTarget: function(card, player, target) {
                            return player != target && target.countMark('ssr_newtongque_dice') < 2;
                        },
                        init: function(player, skill) {
                            lib.translate['ssr_newguose_zhiba'] = '夺袍';
                        },
                        enable: "phaseUse",
                        //prompt: "将一个骰子暂时交给一名其他角色",
                        content: function() {
                            'step 0';
                            player.removeMark('ssr_newtongque_dice');
                            'step 1';
                            var used = false;
                            if(!target.hasSkill('ssr_newguose_lebu')) {
                                target.addTempSkill('ssr_newguose_lebu', {player: 'die'});
                            }else {
                                used = true;
                            }
                            if(!target.storage.ssr_newtongque_dice_debuff) {
                                target.storage.ssr_newtongque_dice_debuff = [];
                            }
                            target.storage.ssr_newtongque_dice_debuff.push({
                                source: player,
                                skill: 'ssr_newguose_lebu',
                            });
                            //target.storage.ssr_newguose_lebu_source.push(player);
                            if(target.countMark('ssr_newtongque_dice') < 2) {
                                target.addMark('ssr_newtongque_dice');
                            }
                            if(!used) {
                                target.storage.ssr_newguose_lebu = 4;
                                target.markSkill('ssr_newguose_lebu');
                                target.syncStorage('ssr_newguose_lebu');
                            }
                        },
                        ai: {
                            threaten: 1.3,
                            result: {
                                player: function(player) {
                                    if(player.countMark('ssr_newtongque_dice') >= 2 || ((player.getHp() + player.hujia) * 2 + player.countCards('h')) >= 6) return -1;
                                    return Math.min(0, ((player.getHp() + player.hujia) * 2 + player.countCards('h')) - 6);
                                },
                                target: function(player, target) {
                                    if (target.hasJudge('lebu')) return 0;
                                    return get.effect(target, {
                                        name: 'lebu'
                                    },
                                    player, target);
                                },
                            },
                            order: 9,
                        },
                    },
                    "ssr_newtianxiang": {
                        subSkill: {
                            damage: {
                                audio: "sbtianxiang",
                                group: ['ssr_newtongque_dice', 'ssr_newtongque_die'],
                                trigger: {
                                    player: ["damageBegin3"],
                                },
                                forced: true,
                                firstDo: true,
                                filter: function(event, player) {
                                    return true;
                                },
                                content: function() {
                                    "step 0";
                                    var dicePlay = get.info('ssr_newtongque').guessDice;
                                    event.resultNum = 0;
                                    event.damageSource = trigger.source;
                                    if (get.isLuckyStar(player)) {
                                        event.resultNum = dicePlay(player, event.damageSource ? 6 : 1);
                                    } else {
                                        event.resultNum = dicePlay(player);
                                    }
                                    "step 1";
                                    var diceBasic = player.storage.ssr_newtianxiang_damage;
                                    if (event.damageSource) {
                                        if (event.resultNum > diceBasic) {
                                            trigger.cancel();
                                        }
                                    }else {
                                        if (event.resultNum > diceBasic - 1) {
                                            trigger.num++;
                                        }
                                        if (event.resultNum > diceBasic + 1) {
                                            trigger.num++;
                                        }
                                    }
                                },
                                mark: true,
                                marktext: '流离',
                                intro: {
                                    name: '流离失所',
                                    content: function(storage, player, skill) {
                                        return `即将受到伤害时，若该伤害：①有对应卡牌，则进行一次猜骰[${storage}]：若成功则防止此伤害；②无对应卡牌，则进行一次猜骰：若满足[${storage-1}]则该伤害+1；若满足[${storage+1}]则该伤害+2。`;
                                    },
                                },
                                sub: true,
                            },
                            hongyan: {
                                mod:{
                                    suit:function(card,suit){
                                        var player = get.owner(card);
                                        if(get.itemtype(player) == 'player' && player.countMark('ssr_newtongque_dice')) {
                                            /*if(suit=='spade') */return 'heart';
                                        }
                                    },
                                },
                            },
                        },
                        global: ['ssr_newtianxiang_hongyan'],
                        audio: "sbtianxiang",
                        filter: function(event, player) {
                            return player.countMark('ssr_newtongque_dice') > 0;
                        },
                        filterTarget: function(card, player, target) {
                            return player != target && target.countMark('ssr_newtongque_dice') < 2;
                        },
                        enable: "phaseUse",
                        //prompt: "将一个骰子暂时交给一名其他角色",
                        content: function() {
                            'step 0';
                            player.removeMark('ssr_newtongque_dice');
                            'step 1';
                            var used = false;
                            if(!target.hasSkill('ssr_newtianxiang_damage')) {
                                target.addTempSkill('ssr_newtianxiang_damage', {player: 'die'});
                            }else {
                                used = true;
                            }
                            if(!target.storage.ssr_newtongque_dice_debuff) {
                                target.storage.ssr_newtongque_dice_debuff = [];
                            }
                            target.storage.ssr_newtongque_dice_debuff.push({
                                source: player,
                                skill: 'ssr_newtianxiang_damage',
                            });
                            //target.storage.ssr_newguose_lebu_source.push(player);
                            if(target.countMark('ssr_newtongque_dice') < 2) {
                                target.addMark('ssr_newtongque_dice');
                            }
                            if(!used) {
                                target.storage.ssr_newtianxiang_damage = 3;
                                target.markSkill('ssr_newtianxiang_damage');
                                target.syncStorage('ssr_newtianxiang_damage');
                            }
                        },
                        ai: {
                            threaten: 1.3,
                            result: {
                                player: function(player) {
                                    if(player.countMark('ssr_newtongque_dice') >= 2 || ((player.getHp() + player.hujia) * 2 + player.countCards('h')) >= 6) return -1;
                                    return Math.min(0, ((player.getHp() + player.hujia) * 2 + player.countCards('h')) - 6);
                                },
                                target: function(player, target) {
                                    var checkDamage = function(str) {
                                        // 检查参数类型
                                        if (typeof str !== 'string') {
                                            return false;
                                        }
                                        
                                        // 查找各个字段的位置
                                        const index1 = str.indexOf('对');
                                        const index2 = str.indexOf('造成', index1 + 1);  // 从'对'之后开始搜索
                                        const index3 = str.indexOf('点伤害', index2 + 1); // 从'造成'之后开始搜索
                                        
                                        // 如果所有字段都按顺序找到，则返回true
                                        return index1 !== -1 && index2 !== -1 && index3 !== -1;
                                    };
                                    var hasDamageSkill = function(current) {
                                        var skills = current.getSkills(true, false);
                                        var hasDamaged = 0;
                                        for(var skill of skills) {
                                            var info = get.prompt2(skill);
                                            if(checkDamage(info)) hasDamaged++;
                                        }
                                        return hasDamaged;
                                    };
                                    var danger = 0;
                                    var friend = get.attitude(player, target) > 0 ? 1 : -1;
                                    game.filterPlayer(current =>{
                                        if((get.attitude(player, current) * friend) < 0) {
                                            var damage = hasDamageSkill(current);
                                            if(damage > 0) {
                                                if(!danger) danger = 2;
                                                danger+= damage * 1;
                                            }
                                        }
                                    });
                                    if(get.attitude(player, target) > 0 && target.hasSkill('ssr_newtianxiang_damage') && target.countCards('he') > 4 && (target.getHp() + target.hujia) >= 2) {
                                        return 0;
                                    }
                                    return (2 - danger) * 4;
                                },
                            },
                            order: 9,
                        },
                    },
                    "ssr_newtongque": {
                        subSkill: {
                            dice: {
                                marktext: "🎲",
                                intro: {
                                    name: "骰子",
                                    content: "拥有$枚骰子",
                                },
                                silent: true,
                                forced: true,
                                direct: true,
                                firstDo: true,
                                priority: 55,
                                trigger: {
                                    global: ['phaseZhunbeiBegin', 'tongqueDieJiance'],
                                },
                                filter: function(event, player) {
                                    var recycle = 0;
                                    if(!event.player.hasSkill('ssr_newtongque')) return false;
                                    if(typeof player.storage.ssr_newtongque_dice_debuff != 'object' || !player.storage.ssr_newtongque_dice_debuff.length) return false;
                                    var list = player.storage.ssr_newtongque_dice_debuff.filter(i =>i.source == event.player);
                                    for(var item of list) {
                                        var skill = item.skill;
                                        if(player.hasSkill(skill)) {
                                            player.storage.ssr_newtongque_dice_debuff.remove(item);
                                            if(player.storage.ssr_newtongque_dice_debuff.filter(i =>(i.source == event.player && i.skill == skill)).length < 1) {
                                                player.removeSkill(skill);
                                            }
                                            if(player.countMark('ssr_newtongque_dice')) {
                                                player.removeMark('ssr_newtongque_dice');
                                            }
                                            if(event.player.countMark('ssr_newtongque_dice') < 2) {
                                                event.player.addMark('ssr_newtongque_dice', 1, false);
                                            }
                                            recycle++;
                                        }
                                    }
                                    if(recycle > 0) {
                                        event.player.logSkill('ssr_newtongque', player);
                                        game.log(event.player, '收回了', get.cnNumber(recycle), '个', '#r【骰子】');
                                    }
                                    return true;
                                },
                                content: function() {},
                                sub: true,
                            },
                            die: {
                                trigger: {
                                    player:"dieBegin",
                                },
                                forced: true,
                                forceDie: true,
                                direct: true,
                                lastDo: true,
                                priority: -45,
                                content: function() {
                                    "step 0";
                                    event.players = game.filterPlayer().sortBySeat(player);
                                    "step 1"
                                    if(event.players.length < 1) event.finish();
                                    "step 2"
                                    var current = event.players.shift();
                                    var next = game.createEvent('tongqueDieJiance');
                                    next.player = current;
                                    next.setContent(function() {
                                        event.trigger('tongqueDieJiance');
                                    });
                                    event.goto(1);
                                },
                                sub: true,
                            },
                        },
                        derivation: ['ssr_newtongque_about'],
                        group: ['ssr_newtongque_dice'],
                        audio: "xingwu",
                        trigger: {
                            player: "damageBegin4",
                        },
                        forced: true,
                        priority: 34,
                        filter: function(event, player) {
                            return event.num > 0;
                        },
                        init: function(player) {
                            if (!player.storage.ssr_newtongque_dice && player.countMark('ssr_newtongque_dice') <= 0) {
                                player.addMark('ssr_newtongque_dice', 2);
                                player.markSkill('ssr_newtongque_dice');
                            }
                            if (player.countMark('ssr_newtongque_dice') > 0) player.markSkill('ssr_newtongque_dice');
                        },
                        content: function() {
                            "step 0";
                            var dicePlay = get.info('ssr_newtongque').guessDice;
                            event.resultNum = 0;
                            if (get.isLuckyStar(player)) {
                                event.resultNum = dicePlay(player, 6);
                            } else {
                                event.resultNum = dicePlay(player);
                            }
                            "step 1";
                            if (event.resultNum > 3) {
                                trigger.cancel();
                            }
                        },
                        ai: {
                            "maixie_defend": true,
                            effect: {
                                target: function(card, player, target) {
                                    if (player.hasSkillTag('jueqing', false, target)) return;
                                    if (get.tag(card, 'damage') && target.hasSkill('ssr_newtongque') && target.countMark('ssr_newtongque_dice') > 1) return 0.7;
                                },
                            },
                            threaten: function(player, target) {
                                if (target.hasSkill('ssr_newtongque') && target.countMark('ssr_newtongque_dice') < 1) return 2;
                                if (target.hasSkill('ssr_newtongque') && target.countMark('ssr_newtongque_dicd') < 2) return 1.1;
                            },
                        },
                        guessDice:function(player,cheat) {
                            var num=Math.min(player.countMark('ssr_newtongque_dice'),2);
                            if(num<1) return false;
                            var method=get.info('ssr_newtongque')[num==1?'throwDice':'throwDoubleDice'];
                            var result=method(cheat, cheat);
                            if(typeof result=='number') {
                                return result;
                            }
                            if(typeof result=='object' && result[0] && result[1]) {
                                return Math.max(result[0], result[1]);
                            }
                            return 0;
                        },
                        throwDice:function(num){
        					if(typeof num!='number'){
        						num=get.rand(6)+1;
        						_status.event.num=num;
        					}
        					if(!game.online){
        						game.pause();
        					}
        					game.broadcastAll(function(num){
        						var diceContainer=ui.create.div('.fullsize.dice-container',ui.window);
        						ui.window.classList.add('dicepaused');
        						var dice=ui.create.div('.dice');
        						var side;
        
        						side=ui.create.div('.side.front',dice);
        						ui.create.div('.dot.center',side);
        						ui.create.div('.side.front.inner',dice);
        
        						side=ui.create.div('.side.top',dice);
        						ui.create.div('.dot.dtop.dleft',side);
        						ui.create.div('.dot.dbottom.dright',side);
        						ui.create.div('.side.top.inner',dice);
        
        						side=ui.create.div('.side.right',dice);
        						ui.create.div('.dot.dtop.dleft',side);
        						ui.create.div('.dot.center',side);
        						ui.create.div('.dot.dbottom.dright',side);
        						ui.create.div('.side.right.inner',dice);
        
        						side=ui.create.div('.side.left',dice);
        						ui.create.div('.dot.dtop.dleft',side);
        						ui.create.div('.dot.dtop.dright',side);
        						ui.create.div('.dot.dbottom.dleft',side);
        						ui.create.div('.dot.dbottom.dright',side);
        						ui.create.div('.side.left.inner',dice);
        
        						side=ui.create.div('.side.bottom',dice);
        						ui.create.div('.dot.center',side);
        						ui.create.div('.dot.dtop.dleft',side);
        						ui.create.div('.dot.dtop.dright',side);
        						ui.create.div('.dot.dbottom.dleft',side);
        						ui.create.div('.dot.dbottom.dright',side);
        						ui.create.div('.side.bottom.inner',dice);
        
        						side=ui.create.div('.side.back',dice);
        						ui.create.div('.dot.dtop.dleft',side);
        						ui.create.div('.dot.dtop.dright',side);
        						ui.create.div('.dot.dbottom.dleft',side);
        						ui.create.div('.dot.dbottom.dright',side);
        						ui.create.div('.dot.center dleft',side);
        						ui.create.div('.dot.center dright',side);
        						ui.create.div('.side.back.inner',dice);
        
        						ui.create.div('.side.cover.x',dice);
        						ui.create.div('.side.cover.y',dice);
        						ui.create.div('.side.cover.z',dice);
        
        						var map={
        							1:[75,0,45],
        							2:[-15,45,0],
        							3:[165,-45,90],
        							4:[345,-45,90],
        							5:[345,-45,180],
        							6:[255,0,135]
        						};
        						dice.roll=function(deg){
        							if(typeof deg=='number'){
        								dice.current[0]+=deg;
        								deg=dice.current;
        							}
        							deg=deg.slice(0);
        							dice.current=deg;
        							this.style.transform='rotateX('+deg[0]+'deg) rotateY('+deg[1]+'deg) rotateZ('+deg[2]+'deg)';
        						};
        						dice.roll(map[num]);
        						diceContainer.appendChild(dice);
        						ui.refresh(dice);
        						dice.roll(1025);
        
        						dice.addEventListener('webkitTransitionEnd',function(){
        							if(!dice.over){
        								dice.style.transition='transform 0.8s ease';
        								dice.roll(-20);
        								dice.over=true;
        							}
        							else if(!dice.resumed){
        								setTimeout(function(){
        									diceContainer.delete();
        									ui.window.classList.remove('dicepaused');
        								},300);
        								if(!game.online){
        									setTimeout(game.resume,800);
        								}
        								dice.resumed=true;
        							}
        						});
        					},num);
        					return num;
        				},
        				//哈哈，没想到吧，扔两个骰子
        				throwDoubleDice:function(num1, num2){
        					game.createCss(`.leftDice{
        					    position: absolute;
        					    top: 50%;
        					    left: 33.3%;
        					    scale: 0.8;
        					}
        					.rightDice{
        					    position: absolute;
        					    top: 50%;
        					    right: 33.3%;
        					    scale: 0.8;
        					}`);
        					_status.event.nums=[num1, num2];
        					if(typeof num1!='number'){
        						num1=get.rand(6)+1;
        						_status.event.nums[0]=num1;
        					}
        					if(typeof num2!='number'){
        						num2=get.rand(6)+1;
        						_status.event.nums[1]=num2;
        					}
        					if(!game.online){
        						game.pause();
        					}
        					game.broadcastAll(function(num1, num2){
        						var diceContainer=ui.create.div('.fullsize.dice-container',ui.window);
        						ui.window.classList.add('dicepaused');
        						var createDice=function(parent, num, main) {
            						var dice=ui.create.div('.dice');
            						var side;
            
            						side=ui.create.div('.side.front',dice);
            						ui.create.div('.dot.center',side);
            						ui.create.div('.side.front.inner',dice);
            
            						side=ui.create.div('.side.top',dice);
            						ui.create.div('.dot.dtop.dleft',side);
            						ui.create.div('.dot.dbottom.dright',side);
            						ui.create.div('.side.top.inner',dice);
            
            						side=ui.create.div('.side.right',dice);
            						ui.create.div('.dot.dtop.dleft',side);
            						ui.create.div('.dot.center',side);
            						ui.create.div('.dot.dbottom.dright',side);
            						ui.create.div('.side.right.inner',dice);
            
            						side=ui.create.div('.side.left',dice);
            						ui.create.div('.dot.dtop.dleft',side);
            						ui.create.div('.dot.dtop.dright',side);
            						ui.create.div('.dot.dbottom.dleft',side);
            						ui.create.div('.dot.dbottom.dright',side);
            						ui.create.div('.side.left.inner',dice);
            
            						side=ui.create.div('.side.bottom',dice);
            						ui.create.div('.dot.center',side);
            						ui.create.div('.dot.dtop.dleft',side);
            						ui.create.div('.dot.dtop.dright',side);
            						ui.create.div('.dot.dbottom.dleft',side);
            						ui.create.div('.dot.dbottom.dright',side);
            						ui.create.div('.side.bottom.inner',dice);
            
            						side=ui.create.div('.side.back',dice);
            						ui.create.div('.dot.dtop.dleft',side);
            						ui.create.div('.dot.dtop.dright',side);
            						ui.create.div('.dot.dbottom.dleft',side);
            						ui.create.div('.dot.dbottom.dright',side);
            						ui.create.div('.dot.center dleft',side);
            						ui.create.div('.dot.center dright',side);
            						ui.create.div('.side.back.inner',dice);
            
            						ui.create.div('.side.cover.x',dice);
            						ui.create.div('.side.cover.y',dice);
            						ui.create.div('.side.cover.z',dice);
            						
            						var map={
            							1:[75,0,45],
            							2:[-15,45,0],
            							3:[165,-45,90],
            							4:[345,-45,90],
            							5:[345,-45,180],
            							6:[255,0,135]
            						};
            						dice.roll=function(deg){
            							if(typeof deg=='number'){
            								dice.current[0]+=deg;
            								deg=dice.current;
            							}
            							deg=deg.slice(0);
            							dice.current=deg;
            							this.style.transform='rotateX('+deg[0]+'deg) rotateY('+deg[1]+'deg) rotateZ('+deg[2]+'deg)';
            						};
            						dice.roll(map[num]);
            						//diceContainer.appendChild(dice);
            						parent.appendChild(dice);
            						ui.refresh(dice);
            						dice.roll(1025);
            
            						dice.addEventListener('webkitTransitionEnd',function(){
            							if(!dice.over){
            								dice.style.transition='transform 0.8s ease';
            								dice.roll(-20);
            								dice.over=true;
            							}
            							else if(main && !dice.resumed){
            								setTimeout(function(){
            									diceContainer.delete();
            									ui.window.classList.remove('dicepaused');
            								},300);
            								if(!game.online){
            									setTimeout(game.resume,800);
            								}
            								dice.resumed=true;
            							}
            						});
            						
            						return dice;
        						};
        						var leftDice=ui.create.div('.leftDice',diceContainer);
        						createDice(leftDice, num1, true);
        						var rightDice=ui.create.div('.rightDice',diceContainer);
        						createDice(rightDice, num2);
        					},num1, num2);
        					return [num1, num2];
        				},
                    },
                    "ssr_tongque": {
                        subSkill: {
                            discard: {
                                trigger: {
                                    player: "loseAfter",
                                    global: "loseAsyncAfter",
                                },
                                audio: 'xinhongyan',
                                forced: true,
                                priority: 5,
                                filter: function(event, player) {
                                    if (event.type != 'discard' || event.getlx === false) return false;
                                    var evt = event.getParent('phaseDiscard'),
                                    evt2 = event.getl(player);
                                    return evt && evt2 && evt.name == 'phaseDiscard' && evt.player == player && evt2.cards2 && evt2.cards2.length > 0 && player.countMark('ssr_tongque') < 6;
                                },
                                content: function() {
                                    player.addMark('ssr_tongque');
                                },
                                sub: true,
                            },
                        },
                        group: 'ssr_tongque_discard',
                        intro: {
                            name: "琉璃",
                            content: "mark",
                        },
                        marktext: "璃",
                        audio: "tianxiang",
                        trigger: {
                            player: "damageBegin4",
                        },
                        init: function(player) {
                            if (!player.storage.ssr_tongque && player.countMark('ssr_tongque') <= 0) {
                                player.addMark('ssr_tongque', 4);
                                player.markSkill('ssr_tongque');
                            }
                            if (player.countMark('ssr_tongque') > 0) player.markSkill('ssr_tongque');
                        },
                        frequent: true,
                        filter: function(event, player) {
                            return event.num > 0;
                        },
                        content: function() {
                            "step 0";
                            /*player.chooseCard(get.prompt('ssr_tongque'),'是否弃置一张红色的牌并防止此伤害？','he',1,function(card,player){
		                        return get.color(card)=='red';
		                    },function(card,player){
		                        return 13-get.value(card);
		                    });*/
                            if (get.isLuckyStar(player)) {
                                event.num = 0;
                                player.throwDice(0);
                            } else player.throwDice();
                            /*player.judge(function(card){
		                        if(get.color(card)=='red') return 2;
		                        return 0;
		                    });*/
                            "step 1";
                            /*if(result.color=='red'){
		                        trigger.cancel();
		                    }else {
		                        player.addMark('ssr_tongque');
		                    }*/
                            //player.logSkill(event.name,target);
                            if (!event.num) event.num = 0;
                            if (event.num <= player.countMark('ssr_tongque')) {
                                trigger.cancel();
                                player.removeMark('ssr_tongque');
                            } else if (event.num > player.countMark('ssr_tongque')) {
                                player.addMark('ssr_tongque');
                                player.draw();
                            }
                        },
                        ai: {
                            "maixie_defend": true,
                            effect: {
                                target: function(card, player, target) {
                                    if (player.hasSkillTag('jueqing', false, target)) return;
                                    if (get.tag(card, 'damage') && target.countCards('h') > 1) return 0.7;
                                },
                            },
                            threaten: function(player, target) {
                                if (target.countCards('h') == 0) return 2;
                            },
                        },
                    },
                    "ssr_guose": {
                        //group:['ssr_guose_lebu'],
                        subSkill: {
                            lebu: {
                                audio: "guose",
                                trigger: {
                                    global: ["judgeAfter"],
                                },
                                forced: true,
                                filter: function(event, player) {
                                    return event.player != player && event.card && event.cardname == 'lebu';
                                },
                                content: function() {
                                    player.draw();
                                },
                                sub: true,
                            },
                        },
                        audio: "guose",
                        filter: function(event, player) {
                            if (player.countMark('ssr_tongque') <= player.hp) return false;
                            return player.countMark('ssr_tongque') > 0;
                        },
                        filterTarget: function(card, player, target) {
                            return target.canAddJudge('lebu') || target.hasJudge('lebu');
                        },
                        enable: "phaseUse",
                        prompt: "弃置一枚“璃”标记并摸一张牌，然后将一张【乐不思蜀】从一名角色的判定区置入或弃置",
                        content: function() {
                            'step 0';
                            //event.card=get.cards(1);
                            event.card = game.createCard('lebu');
                            'step 1';
                            player.removeMark('ssr_tongque');
                            player.draw();
                            if (target.hasJudge('lebu')) {
                                target.discard(target.getJudge('lebu'));
                            } else {
                                target.addJudge(event.card);
                            }
                            //player.useCard({name:'lebu'},target,event.card).audio=false;
                            player.line(target, 'fire');
                        },
                        check: function(card) {
                            return 6 - get.value(card)
                        },
                        ai: {
                            threaten: 1.5,
                            result: {
                                target: function(player, target) {
                                    if (target.hasJudge('lebu')) return - get.effect(target, {
                                        name: 'lebu'
                                    },
                                    player, target);
                                    return get.effect(target, {
                                        name: 'lebu'
                                    },
                                    player, target);
                                },
                            },
                            order: 9,
                        },
                    },
                    "ssr_tianxiang": {
                        subSkill: {
                            off: {
                                sub: true,
                            },
                        },
                        filter: function(event, player) {
                            if (player.countMark('ssr_tongque') <= player.hp) return false;
                            return player.countMark('ssr_tongque') > 0;
                        },
                        audio: "liuli",
                        enable: "phaseUse",
                        filterTarget: function(card, player, target) {
                            if (target == player) return false;
                            return ! target.hasSkill('ssr_tianxiang_off');
                        },
                        content: function() {
                            'step 0';
                            player.removeMark('ssr_tongque');
                            target.loseHp();
                            'step 1';
                            //player.draw();
                            //target.draw();
                            game.asyncDraw([player, target]);
                            target.addTempSkill('ssr_tianxiang_off');
                        },
                        ai: {
                            threaten: 1.5,
                            result: {
                                player: 1,
                                target: function(player, target) {
                                    //var att=get.attitude(player,target);
                                    if (target.hp == 1) return - 2;
                                    return - 1;
                                },
                            },
                            order: 10,
                            expose: 0.2,
                        },
                    },
                    "ssr_aozhan": {
                        subSkill: {
                            temp: {},
                            hit: {
                                trigger: {
                                    source: "damageBegin",
                                },
                                forced: true,
                                silent: true,
                                priority: 50,
                                filter: function(event, player) {
                                    return event.card.name == 'sha';
                                },
                                content: function() {
                                    player.removeSkill('ssr_aozhan_hit');
                                },
                                sub: true,
                                popup: false,
                            },
                        },
                        audio: "luoyi",
                        trigger: {
                            target: "shaBegin",
                        },
                        check: function(event, player) {
                            var att = get.attitude(player, event.source);
                            var num = player.countCards('h', {
                                name: 'sha'
                            });
                            if (att <= 0 && num > 0) return true;
                            return false;
                        },
                        filter: function(event, player) {
                            return ! player.hasSkill('ssr_aozhan_temp');
                        },
                        frequent: true,
                        logTarget: "target",
                        content: function() {
                            'step 0';
                            player.addTempSkill('ssr_aozhan_temp');
                            'step 1';
                            player.draw();
                            trigger.cancel();
                            player.addTempSkill('ssr_aozhan_hit');
                            'step 2';
                            //player.chooseToDiscard(1,'h',true);
                            'step 3';
                            var triggers = _status.event.getTrigger();
                            if (player.countCards('h', {
                                name: 'sha'
                            })) {
                                player.chooseToUse(get.prompt('ssr_aozhan'), '是否对' + get.translation(trigger.player) + '使用一张【杀】？', {
                                    name: 'sha'
                                },
                                trigger.player);
                            }
                            'step 4';
                            if (player.hasSkill('ssr_aozhan_hit')) {
                                player.removeSkill('ssr_aozhan_hit');
                                trigger.player.useCard(trigger.card, player, false, 'noai').animate = false;
                                player.chooseToDiscard(1, 'h', true);
                            }
                            'step 5';
                            player.removeSkill('ssr_aozhan_temp');
                        },
                        ai: {
                            skillTagFilter: function(player, tag, arg) {
                                if (arg && arg.name == 'sha') return true;
                                return false;
                            },
                        },
                    },
                    "ssr_huchi": {
                        locked: true,
                        /*trigger:{
		                    source:"damageSource",
		                },
		                filter:function(event,player){
		                    return event.card&&event.card.name&&['sha','juedou'].contains(event.card.name)&&['sha','juedou'].contains(event.getParent().name);
		                },
		                audio:'reluoyi',
		                forced:true,
		                priority:5,
		                usable:1,
		                content:function(){
		                    "step 0";
		                    player.draw();
		                },*/
                        mod: {
                            cardname: function(card) {
                                if (['trick', 'delay'].contains(lib.card[card.name].type)) return 'juedou';
                                if (lib.card[card.name].type == 'equip' && lib.card[card.name].subtype != 'equip1') return 'sha';
                            },
                            selectTarget: function(card, player, range) {
                                if (['juedou'].contains(card.name) && range[1] != -1) range[1]++;
                            },
                        },
                    },
                    "ssr_newluoyi": {
                        subSkill: {
                            lose: {
                                trigger: {
                                    player: "phaseUseBegin",
                                },
                                filter: function(event, player) {
                                    return player.countMark('ssr_newluoyi');
                                },
                                audio: "luoyi",
                                forced: true,
                                priority: 22,
                                content: function() {
                                    "step 0";
                                    var num = Math.ceil(player.countMark('ssr_newluoyi') * 0.5);
                                    var nn = get.cnNumber(num);
                                    event.nums = num;
                                    var adds = num >= 2 ? '并移去一枚“疤”': '';
                                    player.chooseToDiscard('裸衣：弃置' + nn + '张【杀】' + adds + '，或失去' + nn + '点体力，移去' + nn + '枚“疤”并从牌堆中获得' + nn + '张【杀】', num, 'hs',
                                    function(card) {
                                        return get.name(card) == 'sha';
                                    }).set('ai',
                                    function(card) {
                                        if (player.hp > 3 && num < 3) return 0;
                                        return 10 - get.value(card);
                                    });
                                    "step 1";
                                    if (!result.bool) {
                                        player.loseHp(event.nums);
                                        player.removeMark('ssr_newluoyi', event.nums);
                                        var cards = [];
                                        for (var i = 0; i < event.nums; i++) {
                                            var card = get.cardPile(function(card) {
                                                return card.name == 'sha' && !cards.contains(card);
                                            });
                                            if (card) cards.push(card);
                                        }
                                        player.gain(cards, 'gain2');
                                    } else if (event.nums >= 2) {
                                        player.removeMark('ssr_newluoyi');
                                    }
                                },
                                sub: true,
                            },
                        },
                        group: 'ssr_newluoyi_lose',
                        audio: "luoyi",
                        trigger: {
                            player: "damageBegin4",
                        },
                        filter: function(event, player) {
                            return (event.card && event.card.name && ['sha', 'juedou'].contains(event.card.name) && event.source != undefined);
                        },
                        check: function(event, player) {
                            return (get.attitude(player, event.source) <= 0);
                        },
                        forced: true,
                        priority: 5,
                        logTarget: "source",
                        content: function() {
                            "step 0";
                            trigger.cancel();
                            player.addMark('ssr_newluoyi', trigger.num);
                            "step 1";
                            player.useCard({
                                name: 'juedou'
                            },
                            trigger.source);
                        },
                        marktext: "疤",
                        intro: {
                            name: "争擎恶斗",
                            content: "mark",
                        },
                        ai: {
                            "maixie_defend": true,
                            effect: {
                                target: function(card, player, target) {
                                    if (card.name == 'sha' || card.name == 'juedou') return [1, 0.6];
                                },
                            },
                        },
                    },
                    "ssr_luoyi": {
                        init: function(player) {
                            player.disableEquip('equip2');
                        },
                        onremove: function(player, skill) {
                            player.enableEquip('equip2');
                        },
                        mod: {
                            cardname: function(card) {
                                if (['trick', 'delay'].contains(lib.card[card.name].type)) return 'juedou';
                            },
                        },
                        shaRelated: true,
                        audio: "luoyi",
                        forced: true,
                        locked: true,
                        group: ["ssr_luoyi_sha", "ssr_luoyi_juedou"],
                        subSkill: {
                            sha: {
                                audio: "luoyi",
                                trigger: {
                                    player: "useCardToPlayered",
                                },
                                forced: true,
                                filter: function(event, player) {
                                    return event.card.name == 'sha' && !event.getParent().directHit.contains(event.target);
                                },
                                logTarget: "target",
                                content: function() {
                                    var id = trigger.target.playerid;
                                    var map = trigger.getParent().customArgs;
                                    if (!map[id]) map[id] = {};
                                    if (typeof map[id].shanRequired == 'number') {
                                        map[id].shanRequired++;
                                    } else {
                                        map[id].shanRequired = 2;
                                    }
                                },
                                ai: {
                                    "directHit_ai": true,
                                    skillTagFilter: function(player, tag, arg) {
                                        if (arg.card.name != 'sha' || arg.target.countCards('h', 'shan') > 1) return false;
                                    },
                                },
                                sub: true,
                            },
                            juedou: {
                                audio: "luoyi",
                                trigger: {
                                    player: "useCardToPlayered",
                                    target: "useCardToTargeted",
                                },
                                forced: true,
                                logTarget: function(trigger, player) {
                                    return player == trigger.player ? trigger.target: trigger.player
                                },
                                filter: function(event, player) {
                                    return event.card.name == 'juedou';
                                },
                                content: function() {
                                    var id = (player == trigger.player ? trigger.target: trigger.player)['playerid'];
                                    var idt = trigger.target.playerid;
                                    var map = trigger.getParent().customArgs;
                                    if (!map[idt]) map[idt] = {};
                                    if (!map[idt].shaReq) map[idt].shaReq = {};
                                    if (!map[idt].shaReq[id]) map[idt].shaReq[id] = 1;
                                    map[idt].shaReq[id]++;
                                },
                                ai: {
                                    "directHit_ai": true,
                                    skillTagFilter: function(player, tag, arg) {
                                        if (arg.card.name != 'juedou' || Math.floor(arg.target.countCards('h', 'sha') / 2) > player.countCards('h', 'sha')) return false;
                                    },
                                },
                                sub: true,
                            },
                        },
                    },
                    "ssr_paoxiao_audio": game.zuanSetSSRAudio('paoxiao_re_zhangfei', 2),
                    "ssr_paoxiao_res_audio": game.zuanSetSSRAudio('paoxiao_xin_zhangfei', 2),
                    "ssr_paoxiao": {
                        //group:'ssr_paoxiao_res',
                        subSkill: {
                            ing: {
                                locked: true,
                                sub: true,
                            },
                            res: {
                                enable: ["chooseToRespond"],
                                filterCard: function(card, player) {
                                    return true;
                                },
                                position: "hs",
                                viewAs: {
                                    name: "sha",
                                },
                                viewAsFilter: function(player) {
                                    if (!player.countCards('hs') > 0) return false;
                                },
                                filter: function(event, player) {
                                    return player.countCards('hs') > 0;
                                },
                                audio: "paoxiao_xin_zhangfei",
                                prompt: "咆哮：将一张手牌当做【杀】打出",
                                check: function(card) {
                                    return 15 - get.value(card)
                                },
                                ai: {
                                    skillTagFilter: function(player) {
                                        if (!player.countCards('hs')) return false;
                                    },
                                    respondSha: true,
                                    basic: {
                                        useful: [5, 3, 1],
                                        value: [5, 3, 1],
                                    },
                                    order: function(item, player) {
                                        return 15;
                                    },
                                    result: {
                                        target: function(player, target, card, isLink) {
                                            var eff = function() {
                                                if (!isLink && player.hasSkill('jiu')) {
                                                    if (!target.hasSkillTag('filterDamage', null, {
                                                        player: player,
                                                        card: card,
                                                        jiu: true,
                                                    })) {
                                                        if (get.attitude(player, target) > 0) {
                                                            return - 7;
                                                        } else {
                                                            return - 4;
                                                        }
                                                    }
                                                    return - 0.5;
                                                }
                                                return - 1.5;
                                            } ();
                                            if (!isLink && target.mayHaveShan() && !player.hasSkillTag('directHit_ai', true, {
                                                target: target,
                                                card: card,
                                            },
                                            true)) return eff / 1.2;
                                            return eff;
                                        },
                                    },
                                },
                            },
                        },
                        frequent: true,
                        audio: "paoxiao_re_zhangfei",
                        shaRelated: true,
                        trigger: {
                            player: "shaEnd",
                        },
                        check: function(event, player) {
                            return get.attitude(player, event.target) <= 0;
                        },
                        filter: function(event, player) {
                            return event.card.name == 'sha' && !player.hasSkill('ssr_paoxiao_ing');
                        },
                        logTarget: "target",
                        content: function() {
                            "step 0";
                            player.addTempSkill('ssr_paoxiao_ing');
                            'step 1';
                            player.useCard(trigger.card, trigger.target, false);
                            'step 2';
                            player.removeSkill('ssr_paoxiao_ing');
                        },
                    },
                    "ssr_zhenhun": {
                        subSkill: {
                            sha: {
                                charlotte: true,
                                mod: {
                                    cardEnabled: function(card) {
                                        if (get.name(card) == 'sha') return false;
                                    },
                                    cardRespondable: function(card) {
                                        if (get.name(card) == 'sha') return false;
                                    },
                                    cardSavable: function(card) {
                                        if (get.name(card) == 'sha') return false;
                                    },
                                },
                                sub: true,
                            },
                            danlie: {
                                trigger: {
                                    source: "damageEnd",
                                },
                                audio: 'shencai',
                                forced: true,
                                firstDo: true,
                                filter: function(event, player) {
                                    return event.card && event.card.name == 'sha' && event.player && event.player != player && !event.player.hasSkill('ssr_zhenhun_baiban');
                                },
                                content: function() {
                                    "step 0";
                                    trigger.player.addSkill('ssr_zhenhun_baiban');
                                    trigger.player.storage.ssr_zhenhun_break = player;
                                },
                            },
                            baiban: {
                                init: function(player, skill) {
                                    player.addSkillBlocker(skill);
                                },
                                onremove: function(player, skill) {
                                    player.removeSkillBlocker(skill);
                                },
                                charlotte: true,
                                skillBlocker: function(skill, player) {
                                    return ! lib.skill[skill].charlotte;
                                },
                                trigger: {
                                    global: ["phaseBefore", "die"],
                                },
                                filter: function(event, player) {
                                    return event.player == player.storage.ssr_zhenhun_break;
                                },
                                charlotte: true,
                                forced: true,
                                silent: true,
                                mark: true,
                                marktext: "胆裂",
                                content: function() {
                                    player.removeSkill('ssr_zhenhun_baiban');
                                },
                                mark: true,
                                intro: {
                                    name: "肝胆俱裂",
                                    content: function(storage, player, skill) {
                                        var list = player.getSkills(null, false, false).filter(function(i) {
                                            return lib.skill.baiban.skillBlocker(i, player);
                                        });
                                        if (list.length) return '失效技能：' + get.translation(list);
                                        return '无失效技能';
                                    },
                                },
                                "_priority": 0,
                            },
                        },
                        group: 'ssr_zhenhun_danlie',
                        audio: "retishen",
                        trigger: {
                            player: "phaseZhunbeiBegin",
                        },
                        forced: true,
                        content: function() {
                            game.countPlayer(function(current) {
                                if (current != player) {
                                    player.line(current, 'red');
                                    if (!current.hasSkill('fengyin')) current.addTempSkill('fengyin');
                                    current.addTempSkill('ssr_zhenhun_sha');
                                }
                            });
                        },
                    },
                    "ssr_newqingcheng": {
                        subSkill: {
                            jiu: {
                                audio: 'rejiushi',
                                mark: true,
                                marktext: "酒诗",
                                intro: {
                                    name: "曲水流觞",
                                    content: function(storage, player, skill) {
                                        var str = '<li>你可以移除此标记并视为使用一张【酒】。';
                                        return str;
                                    },
                                },
                                hiddenCard: function(player, name) {
                                    if (name == 'jiu') return true;
                                    return false;
                                },
                                audio: "rejiushi",
                                enable: "chooseToUse",
                                filter: function(event, player) {
                                    if (player.classList.contains('turnedover')) return false;
                                    return event.filterCard({
                                        name: 'jiu',
                                        isCard: true
                                    },
                                    player, event);
                                },
                                content: function() {
                                    if (_status.event.getParent(2).type == 'dying') {
                                        event.dying = player;
                                        event.type = 'dying';
                                    }
                                    player.removeSkill('ssr_newqingcheng_jiu');
                                    //player.turnOver();
                                    player.useCard({
                                        name: 'jiu',
                                        isCard: true
                                    },
                                    player);
                                },
                                ai: {
                                    order: 5.5,
                                    result: {
                                        player: function(player) {
                                            if (_status.event.parent.name == 'phaseUse') {
                                                if (player.countCards('h', 'jiu') > 0) return 0;
                                                if (player.getEquip('zhuge') && player.countCards('h', 'sha') > 1) return 0;
                                                if (!player.countCards('h', 'sha')) return 0;
                                                var targets = [];
                                                var target;
                                                var players = game.filterPlayer();
                                                for (var i = 0; i < players.length; i++) {
                                                    if (get.attitude(player, players[i]) < 0) {
                                                        if (player.canUse('sha', players[i], true, true)) {
                                                            targets.push(players[i]);
                                                        }
                                                    }
                                                }
                                                if (targets.length) {
                                                    target = targets[0];
                                                } else {
                                                    return 0;
                                                }
                                                var num = get.effect(target, {
                                                    name: 'sha'
                                                },
                                                player, player);
                                                for (var i = 1; i < targets.length; i++) {
                                                    var num2 = get.effect(targets[i], {
                                                        name: 'sha'
                                                    },
                                                    player, player);
                                                    if (num2 > num) {
                                                        target = targets[i];
                                                        num = num2;
                                                    }
                                                }
                                                if (num <= 0) return 0;
                                                var e2 = target.getEquip(2);
                                                if (e2) {
                                                    if (e2.name == 'tengjia') {
                                                        if (!player.countCards('h', {
                                                            name: 'sha',
                                                            nature: 'fire'
                                                        }) && !player.getEquip('zhuque')) return 0;
                                                    }
                                                    if (e2.name == 'renwang') {
                                                        if (!player.countCards('h', {
                                                            name: 'sha',
                                                            color: 'red'
                                                        })) return 0;
                                                    }
                                                    if (e2.name == 'baiyin') return 0;
                                                }
                                                if (player.getEquip('guanshi') && player.countCards('he') > 2) return 1;
                                                return target.countCards('h') > 3 ? 0 : 1;
                                            }
                                            if (player == _status.event.dying || player.isTurnedOver()) return 3;
                                        },
                                    },
                                    effect: {
                                        target: function(card, player, target) {
                                            if (card.name == 'guiyoujie') return [0, 0.5];
                                            if (target.isTurnedOver()) {
                                                if (get.tag(card, 'damage')) {
                                                    if (player.hasSkillTag('jueqing', false, target)) return [1, -2];
                                                    if (target.hp == 1) return;
                                                    return [1, target.countCards('h') / 2];
                                                }
                                            }
                                        },
                                    },
                                },
                                sub: true,
                            },
                            ball: {
                                mark: true,
                                marktext: "锦绣",
                                intro: {
                                    name: "锦绣",
                                    content: "洛神赋图",
                                },
                                sub: true,
                            },
                        },
                        usable: 1,
                        unique: true,
                        trigger: {
                            player: "phaseJieshuBegin",
                        },
                        frequent: true,
                        filter: function(event, player) {
                            game.filterPlayer(function(target) {
                                if (target.hasSkill('ssr_newqingcheng_jiu')) target.removeSkill('ssr_newqingcheng_jiu');
                                return true;
                            });
                            return true;
                        },
                        /*enable:"phaseUse",
		                filterTarget:function(card,player,target){
		                    return true;
		                },
		                selectTarget:-1,
		                multitarget:true,
		                multiline:true,*/
                        init: function(skill) {
                            lib.translate['ssr_newqingcheng_jiu'] = "酒诗";
                            //lib.translate['ssr_newqingcheng_jiu_info']="";
                        },
                        priority: -7,
                        content: function() {
                            'step 0';
                            //trigger.changeToZero();
                            event.cards = get.cards(2);
                            player.showCards(event.cards);
                            event.target = player;
                            //event.targets=targets.slice(0);
                            event.targets = [player].concat(game.filterPlayer(function(target) {
                                return player != target;
                            })).slice(0);
                            event.targets.sort(lib.sort.seat);
                            'step 1';
                            player.gain(event.cards);
                            player.$gain2(event.cards);
                            'step 2';
                            var num = Math.max(1, event.target.countCards('h') - event.target.maxHp);
                            event.target.chooseCard('交给' + get.translation(event.target.next.name) + get.cnNumber(num) + '张牌', 'h', true, num,
                            function(card, player) {
                                if (get.attitude(event.target, event.target.next) > 0) {
                                    return get.value(card);
                                } else {
                                    return 100 - get.value(card);
                                }
                            });
                            'step 3';
                            event.cards = result.cards,
                            ui.special;
                            if (event.target == player) {
                                player.lose(event.cards);
                                player.addTempSkill('ssr_newqingcheng_ball');
                                player.chooseCardButton('选择其中一张作为“锦绣”', true, event.cards, 1).set('ai',
                                function(button) {
                                    return Math.random();
                                });
                            }
                            'step 4';
                            //event.target.give(event.cards,event.target.next,false,false);
                            if (event.target == player) {
                                event.ball = result.links[0];
                            }
                            if (event.cards.contains(event.ball)) {
                                event.target.next.addTempSkill('ssr_newqingcheng_ball');
                                event.target.removeSkill('ssr_newqingcheng_ball');
                            }
                            event.target.next.gain(event.cards, event.target, false);
                            event.target.next.$gain2(event.cards, event.target, false);
                            'step 5';
                            /*if(event.target.countCards('h')<event.target.maxHp){
		                        event.target.addSkill('ssr_newqingcheng_jiu');
		                    }*/
                            game.delay();
                            'step 6';
                            var target = event.targets.shift();
                            event.target = event.target.next;
                            //game.delay(1);
                            if (event.target != player) {
                                event.goto(2);
                            }
                            'step 7';
                            var them = game.players;
                            event.him = player;
                            for (var i = 0; i < them.length; i++) {
                                if (them[i].hasSkill('ssr_newqingcheng_ball')) {
                                    var str = '“锦绣”在' + get.translation(them[i].name) + '处';
                                    them[i].showCards(str, [event.ball]);
                                    them[i].discard([event.ball]);
                                    them[i].removeSkill('ssr_newqingcheng_ball');
                                    them[i].addSkill('ssr_newqingcheng_jiu');
                                    //them[i].markSkill('ssr_newqingcheng_jiu');
                                    //event.him=them[i];
                                }
                            }
                            /*'step 8';
		                    event.him.discard(event.ball);
		                    event.him.addSkill('ssr_newqingcheng_jiu');
		                    event.him.discard(event.him.getCards('h'));
		                    event.cards=[];
		                    'step 9';
		                    var suits=['spade','club','heart','diamond'];
		                    for (var i=0;i<suits.length;i++) {
		                        var suitcard=get.cardPile(function(card){
		                            if(get.type(card)=='equip') return false;
		                            return get.suit(card)==suits[i];
		                        });
		                        if(suitcard){
		                            event.cards.push(suitcard);
		                        }
		                    }
		                    event.him.showCards("洛神赋图",[event.cards]);
		                    "step 10";
		                    event.him.line(player,'water');
		                    event.him.gain(event.cards,'gain2');*/
                        },
                        ai: {
                            order: 5,
                            expose: 0.2,
                            result: {
                                player: function(player) {
                                    var val = 3;
                                    var tar = player;
                                    for (var i = 0; i < targets.length; i++) {
                                    }
                                },
                            },
                        },
                        mod: {
                            targetEnabled: function(card, player, target, now) {
                                if (player.hasSkill('jiu')) {
                                    if (card.name == 'sha') return false;
                                }
                            },
                        },
                    },
                    "ssr_yushui": {
                        trigger: {
                            player: "damageBefore",
                        },
                        loced: true,
                        forced: true,
                        audio: "qingguo",
                        check: function() {
                            return false;
                        },
                        filter: function(event, player) {
                            return true;
                        },
                        priority: 14,
                        content: function() {
                            'step 0';
                            trigger.cancel();
                            if (player.countCards('he')) player.showCards(player.getCards('he'));
                            'step 1';
                            var suitcard = get.cardPile(function(card) {
                                var suit = get.suit(card);
                                return ! player.countCards('he', {
                                    suit: suit
                                });
                            });
                            if (suitcard) {
                                game.log(player, '抽取成功：', suitcard);
                                player.gain(suitcard, 'draw');
                                player.loseHp();
                            } else {
                                game.log(player, '抽取失败：免疫了伤害');
                            }
                        },
                        ai: {
                            effect: {
                                target: function(card, player, target, current) {
                                    if (!get.tag(card, 'damage')) return;
                                    var suits = ['spade', 'club', 'diamond', 'heart'];
                                    for (var i = 0; i < suits.length; i++) {
                                        if (!target.countCards('he', {
                                            suit: suits[i]
                                        })) return;
                                    }
                                    return 'zerotarget';
                                },
                            },
                        },
                        "_priority": 0,
                    },
                    "ssr_newluoshen": {
                        audio: "sbluoshen",
                        trigger: {
                            player: "phaseDrawEnd",
                        },
                        filter: function(event, player) {
                            return player.countCards('h') > 0;
                        },
                        priority: -7,
                        frequent: true,
                        content: function() {
                            "step 0";
                            game.delay();
                            event.cards = [];
                            event.yuansu = ['jinghong', 'youlong', 'qiuju'];
                            event.yuansuname = ['翩若惊鸿', '婉若游龙', '荣曜秋菊'];
                            event.luoshen = [];
                            for (var i = 0; i < event.yuansu.length; i++) {
                                var name = event.yuansu[i];
                                lib.card['luoshen_' + name] = {
                                    fullskin: true,
                                    image: 'ext:祖安武将/card/luoshen_' + name + '.png',
                                    opacity: 1,
                                    textShadow: 'black 0 0 2px',
                                };
                                lib.translate['luoshen_' + name] = event.yuansuname[i];
                                lib.translate['luoshen_' + name + '_info'] = "<li>洛神赋图";
                                event.luoshen.push(game.createCard({
                                    name: 'luoshen_' + name,
                                    number: "洛",
                                    suit: "神"
                                }));
                            }
                            event.luo = [];
                            player.$throw(event.luoshen.randomGet());
                            'step 1';
                            var suits = ['spade', 'club', 'heart', 'diamond'];
                            for (var i = 0; i < suits.length; i++) {
                                var suitcard = get.cardPile(function(card) {
                                    //if(get.type(card)=='equip') return false;
                                    if (get.type(card, 'trick') != 'trick') return false;
                                    return get.suit(card) == suits[i];
                                });
                                if (suitcard) {
                                    event.cards.push(suitcard);
                                }
                            }
                            player.showCards("洛神赋图", [event.cards]);
                            "step 2";
                            if (event.luo.length < 1) event.luo = event.luoshen.slice(0);
                            var minValue = 20;
                            var hs = player.getCards('h');
                            for (var i = 0; i < hs.length; i++) {
                                minValue = Math.min(minValue, get.value(hs[i], player));
                            }
                            player.chooseCardButton('洛神赋图', event.cards, 1).set('filterButton',
                            function(button) {
                                return player.countCards('h', {
                                    suit: get.suit(button)
                                }) > 0;
                            }).set('ai',
                            function(button) {
                                for (var h = 0; h < hs.length; h++) {
                                    if (get.suit(button) == get.suit(hs[h])) {
                                        if (get.value(button) > get.value(hs[h])) {
                                            return 2;
                                        }
                                    }
                                }
                                return 0;
                            });
                            "step 3";
                            if (result.bool) {
                                event.button = result.links[0];
                                player.chooseCard('用一张手牌替换' + get.translation(result.links), true).set('filterCard',
                                function(card) {
                                    return get.suit(card) == get.suit(event.button);
                                }).set('ai',
                                function(card) {
                                    return 99 - get.value(card);
                                });
                            } else {
                                var num = 0;
                                for (var i = 0; i < event.cards.length; i++) {
                                    if (get.type(event.cards[i], 'trick') != 'trick') num++;
                                }
                                if (num >= 2) player.recover(); {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            "step 4";
                            if (result.bool) {
                                player.lose(result.cards, ui.special);
                                //player.$throw(result.cards);
                                player.$throw(1);
                                //game.log(player,'用',result.cards,'替换了',event.button);
                                player.gain(event.button);
                                var luo = event.luo.randomGet();
                                player.$gain2(luo);
                                event.luo.remove(luo);
                                //player.$gain2(event.button);
                                for (var i = 0; i < event.cards.length; i++) {
                                    if (event.cards[i] == event.button) {
                                        event.cards[i] = result.cards[0];
                                    }
                                }
                                event.button.remove();
                            }
                            "step 5";
                            game.delay(2);
                            event.goto(2);
                        },
                        /*content:function(){
		                    'step 0';
		                    //player.discard(player.getCards('h'));
		                    event.cards=[];
		                    'step 1';
		                    var suits=['spade','club','heart','diamond'];
		                    for (var i=0;i<suits.length;i++) {
		                        var suitcard=get.cardPile(function(card){
		                            if(get.type(card)=='equip') return false;
		                            return get.suit(card)==suits[i];
		                        });
		                        if(suitcard){
		                            event.cards.push(suitcard);
		                        }
		                    }
		                    player.showCards("洛神赋图",[event.cards]);
		                    "step 2";
		                    //player.line(player,'water');
		                    //player.gain(event.cards,'gain2');
		                    var cards=event.cards;
		                    var hands=player.getCards('h');
		                    game.cardsGotoOrdering(cards);
		                    var next=player.chooseToMove(true);
		                    next.set('list',[
		                        ['替换《洛神赋图》中花色相同的牌',cards],
		                        [get.translation(player.name)+'的手牌区',hands],
		                    ]);
		                    next.set('filterMove',function(from,to,moved){
		                        if(to==0&&moved[0].length>=4) return false;
		                        //if(to==1&&moved[1].length>=hands.length) return false;
		                        //alert('from:'+get.translation(from));
		                        //alert('to:'+get.translation(to));
		                        return get.suit(to)==get.suit(from);
		                    });
		                    next.set('filterOk',function(moved){
		                        var suits=['spade','club','diamond','heart'];
		                        var num=0;
		                        for(var i=0;i<suits.length;i++) {
		                            for(var j=0;j<moved[0].length;j++) {
		                                if(get.suit(moved[0][j])==suits[i]) {
		                                    num++;
		                                    break;
		                                }
		                            }
		                        }
		                        return moved[0].length==4&&num>=4;
		                    });
		                    next.set('prompt','洛神赋图');
		                    next.set('processAI',function(list){
		                        var cards=list[0][1].slice(0).sort(function(a,b){
		                            return get.value(b)-get.value(a);
		                        });
		                        var temp=false;
		                        for(var a=0;a<list[0].length;a++) {
		                            var suit1=get.suit(list[0][a]);
		                            var card1=list[0][a];
		                            for(var b=0;b<list[1].length;b++) {
		                                var suit2=get.suit(list[1][b]);
		                                var card2=list[1][b];
		                                if(suit1==suit2&&get.value(card1)>get.value(card2)) {
		                                    temp=list[0][a];
		                                    list[0][a]=list[1][b];
		                                    list[1][b]=temp;
		                                }
		                            }
		                        }
		                        return [cards,cards.splice(2)];
		                    })
		                    "step 3";
		                    var top=result.moved[0];
		                    var bottom=result.moved[1];
		                    top.reverse();//ssgain
		                    var hands=player.getCards('h');
		                    game.addVideo('lose',player,[get.cardsInfo(hands),[],[],[]]);
		                    for(var i=0;i<hands.length;i++){
		                        hands[i].discard(false);
		                    }
		                    player.directgain(bottom);
		                    //player.popup(get.cnNumber(top.length)+'上'+get.cnNumber(bottom.length)+'下');
		                    //game.log(player,'将'+get.cnNumber(top.length)+'张牌置于牌堆顶');
		                    game.updateRoundNumber();
		                    game.delayx();
		                },*/
                        ai: {
                            threaten: 1.1,
                        },
                    },
                    "ssr_luoshen": {
                        audio: "luoshen",
                        trigger: {
                            player: "damageEnd",
                        },
                        filter: function(event, player) {
                            return event.num > 0;
                        },
                        check: function(event, player) {
                            var num = player.countCards('h') - 4;
                            var num = num + player.countCards('h', {
                                name: 'tao'
                            }) * 2;
                            var num = num + player.countCards('h', {
                                name: 'jiu'
                            }) * 1.2;
                            var num = num + Math.min(player.countCards('h', {
                                name: 'shan'
                            }), 2) * 0.8;
                            var num = num - player.countCards('h', {
                                subtype: 'equip1'
                            }) * 1.2;
                            var num = num - player.countCards('h', {
                                subtype: 'equip3'
                            }) * 0.5;
                            var num = num - player.countCards('h', {
                                subtype: 'equip4'
                            }) * 1.3;
                            var num = num - player.countCards('h', {
                                type: 'delay'
                            }) * 0.8;
                            var num = num - player.countCards('h', {
                                type: 'trick'
                            }) * 0.6;
                            var num = num + player.countCards('h', {
                                name: 'wuxie'
                            }) * 2;
                            var num = num + player.countCards('h', {
                                name: 'du'
                            }) * 2;
                            return num <= 0;
                        },
                        content: function() {
                            'step 0';
                            player.discard(player.getCards('h'));
                            event.cards = [];
                            'step 1';
                            var suits = ['spade', 'club', 'heart', 'diamond'];
                            for (var i = 0; i < suits.length; i++) {
                                var suitcard = get.cardPile(function(card) {
                                    if (get.type(card) == 'equip') return false;
                                    return get.suit(card) == suits[i];
                                });
                                if (suitcard) {
                                    event.cards.push(suitcard);
                                }
                            }
                            player.showCards("洛神赋图", [event.cards]);
                            "step 2";
                            player.line(player, 'water');
                            player.gain(event.cards, 'gain2');
                        },
                        ai: {
                            maixie: true,
                            "maixie_hp": true,
                            effect: {
                                target: function(card, player, target) {
                                    if (player.hasSkillTag('jueqing', false, target)) return [1, -1];
                                    if (get.tag(card, 'damage')) return [1, 0.55];
                                },
                            },
                        },
                    },
                    "ssr_qingcheng": {
                        audio: "qingguo",
                        enable: "phaseUse",
                        usable: 1,
                        filterTarget: function(card, player, target) {
                            return target.sex == 'male' && target != player && target.countGainableCards(player, get.is.single() ? 'he': 'hej') > 0;
                        },
                        selectTarget: -1,
                        content: function() {
                            'step 0';
                            var position = get.is.single() ? 'he': 'hej';
                            if (target.countGainableCards(player, position)) {
                                player.gainPlayerCard(position, target, true);
                                event.gain = true;
                            } else {
                                event.gain = false;
                            }
                            'step 1';
                            if (event.gain) {
                                player.chooseCard('交给' + get.translation(target.name) + '一张牌', 'he', true, 1,
                                function(card, player) {
                                    if (get.attitude(player, target) > 0) {
                                        return get.value(card) - 7;
                                    } else {
                                        return 7 - get.value(card);
                                    }
                                });
                            }
                            'step 2';
                            if (result.bool) {
                                target.gain(result.cards, 'gain2', player);
                                player.logSkill(event.name, target);
                            }
                        },
                        ai: {
                            order: 9,
                            result: {
                                player: function(player, target) {
                                    return 2;
                                },
                                target: function(player, target) {
                                    return get.attitude(player, target);
                                },
                            },
                            threaten: 0.4,
                        },
                    },
                    "ssr_xiaoji": {
                        audio: "xiaoji",
                        trigger: {
                            player: "loseAfter",
                            global: ["equipAfter", "addJudgeAfter", "gainAfter", "loseAsyncAfter"],
                        },
                        frequent: true,
                        filter: function(event, player) {
                            var evt = event.getl(player);
                            return evt && evt.player == player && evt.es && evt.es.length > 0;
                        },
                        content: function() {
                            "step 0";
                            event.count = trigger.getl(player).es.length + 1;
                            "step 1";
                            event.count--;
                            "step 2";
                            if (event.count > 0) {
                                player.chooseTarget(get.prompt2('ssr_xiaoji'),
                                function(card, player, target) {
                                    return true;
                                }).set('ai',
                                function(target) {
                                    if (game.countPlayer(function(current) {
                                        return ((current.hp > 3 || (current.hasSkill('ssr_lianyin_recover') && current.hp > 2)) && get.attitude(player, current) > 0);
                                    }) > 0) {
                                        if (target.hp > 3 || (target.hasSkill('ssr_lianyin_recover') && target.hp > 2)) {
                                            return get.attitude(player, target);
                                        } else {
                                            return - get.attitude(player, target);
                                        }
                                    } else {
                                        return - get.attitude(player, target);
                                    }
                                }).set('prompt', '是否将此装备牌交给一名角色，令该角色摸一张牌并对该角色造成一点伤害？');
                            }
                            "step 3";
                            if (result.bool && event.count > 0) {
                                var num = trigger.getl(player).es.length - event.count;
                                result.targets[0].draw();
                                result.targets[0].damage();
                                player.$giveAuto(trigger.getl(player).es[num], result.targets[0]);
                                result.targets[0].gain(trigger.getl(player).es[num], player);
                                player.logSkill('ssr_xiaoji');
                                event.goto(1);
                            }
                        },
                        ai: {
                            noe: true,
                            reverseEquip: true,
                            effect: {
                                target: function(card, player, target, current) {
                                    if (get.type(card) == 'equip' && !get.cardtag(card, 'gifts')) return [1, 3];
                                },
                            },
                        },
                    },
                    "ssr_weigong": {
                        audio: 'xiaoji',
                        trigger: {
                            target: "useCardToTargeted",
                        },
                        forced: true,
                        preHidden: true,
                        filter: function(event, player) {
                            return event.card.name == 'sha';
                        },
                        content: function() {
                            "step 0";
                            if (trigger.player.hasSkill('ssr_jieyin_zhuang')) {
                                player.gainPlayerCard(trigger.player, get.prompt('ssr_weigong', trigger.player), 'h', true);
                            } else {
                                player.discardPlayerCard(trigger.player, get.prompt('ssr_weigong', trigger.player), 'h', true);
                            }
                        },
                        ai: {
                            effect: {
                                target: function(card, player, target, current) {
                                    if (card.name == 'sha') {
                                        if (player.hasSkill('ssr_jieyin_zhuang')) return [0.4, 0.7, 0, -0.7];
                                        return [0.8, 0.2, 0, -0.2];
                                    }
                                },
                            },
                        },
                    },
                    "ssr_jieyin": {
                        subSkill: {
                            zhuang: {
                                forced: true,
                                direct: true,
                                silent: true,
                                priority: 5,
                                onremove: function(player, skill) {
                                    player.draw();
                                },
                                mark: true,
                                marktext: '红妆',
                                intro: {
                                    name: '红粉胭脂',
                                    content: '失去此标记时你摸一张牌',
                                },
                                sub: true,
                            },
                            gain: {
                                trigger: {
                                    player: "gainEnd",
                                },
                                filter: function(event, player) {
                                    if (!event.source || event.source == player || !event.source.isIn() || event.cards.length < 1) return false;
                                    //if(player.getDamagedHp()<1) return false;
                                    if (event.source.hasSkill('ssr_jieyin_zhuang')) return false;
                                    var evt = event.getl(event.source);
                                    return evt && evt.cards2 && evt.cards2.length > 0;
                                },
                                check: function(event, player) {
                                    return get.attitude(player, event.source) > 0 || player.getHp() < 3 || (Math.random() < 0.3 && player.getDamagedHp() > 0);
                                },
                                priority: 3,
                                logTarget: "source",
                                "prompt2": "回复一点体力并令该角色获得“红妆”标记直到其回合结束",
                                content: function() {
                                    'step 0';
                                    player.recover();
                                    'step 1';
                                    trigger.source.addTempSkill('ssr_jieyin_zhuang', {
                                        player: 'phaseEnd'
                                    });
                                    //trigger.source.addSkill('ssr_jieyin_zhuang');
                                    trigger.source.storage.ssr_jieyin_break = player;
                                },
                                ai: {
                                    expose: 0.1,
                                },
                                sub: true,
                            },
                        },
                        group: 'ssr_jieyin_gain',
                        audio: "rejieyin",
                        enable: "phaseUse",
                        usable: 1,
                        discard: false,
                        lose: false,
                        delay: 0,
                        filter: function(event, player) {
                            return player.countCards('h', {
                                color: 'red'
                            });
                        },
                        filterCard: function(card) {
                            return get.color(card) == 'red';
                        },
                        filterTarget: function(card, player, target) {
                            return player != target;
                        },
                        check: function(card) {
                            return 6 - get.value(card);
                        },
                        content: function() {
                            "step 0";
                            player.give(cards, target);
                            "step 1";
                            player.gainPlayerCard(target, 'hej', true, 'visible');
                        },
                        ai: {
                            result: {
                                target: function(player, target) {
                                    var eqp = (target.countCards('e',
                                    function(card) {
                                        return get.value(card, target) > 0 && card != target.getEquip('jinhe');
                                    }) > 0) ? -1.0 : -0.5;
                                    if (get.attitude(player, target) <= 0) return (target.countCards('he',
                                    function(card) {
                                        return get.value(card, target) > 0 && card != target.getEquip('jinhe');
                                    }) > 0) ? eqp: 0.5;
                                    var vals = (!target.hasSkill('ssr_jieyin_zhuang') && (target.hasSkill('ssr_newrende') || player.getDamagedHp() > 0)) ? 2.5 : 1.5;
                                    var vals2 = (!target.hasSkill('ssr_jieyin_zhuang') && (target.hasSkill('ssr_newrende') || player.getDamagedHp() > 0)) ? 1.0 : 0.5;
                                    return (target.countCards('ej',
                                    function(card) {
                                        if (get.position(card) == 'e') return get.value(card, target) <= 0;
                                        var cardj = card.viewAs ? {
                                            name: card.viewAs
                                        }: card;
                                        return get.effect(target, cardj, target, player) < 0;
                                    }) > 0) ? vals: vals2;
                                },
                                player: function(player, target) {
                                    if (get.attitude(player, target) < 0 && !target.countCards('he',
                                    function(card) {
                                        return get.value(card, target) > 0 && card != target.getEquip('jinhe');
                                    })) {
                                        return 0;
                                    }
                                    if (get.attitude(player, target) > 1) {
                                        return (target.countCards('ej',
                                        function(card) {
                                            if (get.position(card) == 'e') return get.value(card, target) <= 0;
                                            var cardj = card.viewAs ? {
                                                name: card.viewAs
                                            }: card;
                                            return get.effect(target, cardj, target, player) < 0;
                                        }) > 0) ? 1.5 : -1.5;
                                    }
                                    return 1;
                                },
                            },
                            basic: {
                                order: 9,
                            },
                        },
                    },
                    "ssr_lianyin": {
                        subSkill: {
                            recover: {
                                audio: "jieyin",
                                trigger: {
                                    global: ["damage"],
                                },
                                forced: true,
                                filter: function(event, player) {
                                    if (!player.storage.ssr_lianyin_recover) return false;
                                    var him = player.storage.ssr_lianyin_recover;
                                    if (!him.isIn()) return false;
                                    return event.player == player || event.player == him;
                                },
                                content: function() {
                                    'step 0';
                                    game.asyncDraw([player, player.storage.ssr_lianyin_recover]);
                                },
                                mark: true,
                                marktext: '姻缘',
                                intro: {
                                    name: "缘定三生",
                                    content: "player",
                                },
                                sub: true,
                            },
                        },
                        usable: 1,
                        enable: "phaseUse",
                        audio: "jieyin",
                        filterTarget: function(card, player, target) {
                            return target.sex == 'male' && target != player;
                        },
                        filter: function(event, player) {
                            return true;
                        },
                        content: function() {
                            "step 0";
                            event.count = 1;
                            if (1 == 1) {
                                player.addTempSkill('ssr_lianyin_recover', {
                                    player: 'phaseBefore'
                                });
                                player.storage.ssr_lianyin_recover = target;
                            } else {
                                if (player.hp != target.hp) {
                                    if (player.hp > target.hp) {
                                        target.recover();
                                    } else {
                                        player.recover();
                                    }
                                } else {
                                    player.chooseControl(get.translation(player.name) + '(我方)', get.translation(target.name) + '(对方)',
                                    function() {
                                        if (player.hp < player.maxHp) return get.translation(player.name) + '(我方)';
                                        return get.translation(target.name) + '(对方)';
                                    }).set('prompt', '请选择一方回复体力');
                                }
                            }
                            "step 1";
                            if (1 == 0) {
                                if (result.bool) {
                                    if (result.control == get.translation(player.name) + '(我方)') {
                                        player.recover();
                                    } else {
                                        target.recover();
                                    }
                                }
                            }
                            event.him = target;
                            event.count--;
                            event.cards = get.cards(2);
                            player.chooseControl('ok').set('dialog', ['联姻', event.cards]);
                            "step 2";
                            if (event.cards.length > 1) {
                                target.chooseCardButton('联姻：选择一张牌交给' + get.translation(player.name), true, event.cards, 1).set('ai',
                                function(button) {
                                    if (get.attitude(target, player) > 0) {
                                        var num = 0;
                                        if (get.type(button.link) == 'equip') var num = 3;
                                        return get.value(button.link, player) + num;
                                    } else {
                                        var num = 0;
                                        if (get.type(button.link) == 'equip') var num = 3;
                                        return 10 - get.value(button.link, player) - num;
                                    }
                                });
                            } else if (event.cards.length == 1) {
                                event._result = {
                                    links: event.cards.slice(0),
                                    bool: true
                                };
                            } else {
                                event.goto(5);
                            }
                            "step 3";
                            if (result.bool) {
                                for (var i = 0; i < result.links.length; i++) {
                                    event.cards.remove(result.links[i]);
                                }
                                event.togive = result.links.slice(0);
                            }
                            "step 4";
                            if (event.him == target) {
                                event.him = player;
                            } else {
                                event.him = target;
                            }
                            event.him.gain(event.togive, 'draw');
                            player.line(event.him, 'green');
                            game.log(event.him, '获得了' + get.cnNumber(event.togive.length) + '张牌');
                            event.goto(2);
                            "step 5";
                            if (event.count > 0) player.chooseBool(get.prompt2(event.name)).set('frequentSkill', event.name);
                            else {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                            "step 6";
                            if (result.bool) {
                                player.logSkill(event.name);
                                event.goto(1);
                            }
                        },
                        ai: {
                            order: 9,
                            result: {
                                target: function(player, target) {
                                    return 4;
                                },
                            },
                            tag: {
                                draw: 1,
                                multitarget: 1,
                            },
                        },
                    },
                    "ssr_langgu": {
                        audio: "jilue_wansha",
                        locked: true,
                        mod: {
                            globalFrom: function(from, to) {
                                if (to.hasSkill('ssr_langgu_hurt')) return - Infinity;
                            },
                        },
                        subSkill: {
                            hurt: {
                                trigger: {
                                    global: ["phaseEnd", "die"],
                                },
                                filter: function(event, player) {
                                    return event.player.hasSkill('ssr_langgu');
                                },
                                content: function() {
                                    player.removeSkill('ssr_langgu_hurt');
                                },
                                forced: true,
                                silent: true,
                                sub: true,
                                popup: false,
                            },
                        },
                        unique: true,
                        trigger: {
                            player: "damageEnd",
                        },
                        forced: true,
                        filter: function(event) {
                            return event.num > 0;
                        },
                        content: function() {
                            player.addMark('ssr_jilue', trigger.num);
                            if (trigger.source && trigger.source.isIn()) trigger.source.addSkill('ssr_langgu_hurt');
                        },
                        ai: {
                            combo: "ssr_jilue",
                            maixie: true,
                            "maixie_hp": true,
                        },
                    },
                    "ssr_fankui": {
                        usable: 3,
                        audio: "fankui",
                        enable: "phaseUse",
                        prompt: "是否弃置一枚“忍戒”标记并获得距离一以内的一名角色一张牌？",
                        filter: function(event, player) {
                            return player.countMark('ssr_jilue') > 0;
                        },
                        filterTarget: function(card, player, target) {
                            return player != target && get.distance(player, target) <= 1 && target.countGainableCards(player, 'he') > 0;
                        },
                        content: function() {
                            "step 0";
                            player.gainPlayerCard(target, 'he', true);
                            player.removeMark('ssr_jilue');
                            game.delay();
                        },
                        ai: {
                            order: 7.5,
                            result: {
                                target: function(player, target) {
                                    if (get.attitude(player, target) <= 0) return (target.countCards('he',
                                    function(card) {
                                        return get.value(card, target) > 0 && card != target.getEquip('jinhe');
                                    }) > 0) ? -1.5 : 1.5;
                                    return (target.countCards('ej',
                                    function(card) {
                                        if (get.position(card) == 'e') return get.value(card, target) <= 0;
                                        var cardj = card.viewAs ? {
                                            name: card.viewAs
                                        }: card;
                                        return get.effect(target, cardj, target, player) < 0;
                                    }) > 0) ? 1.5 : -1.5;
                                },
                                player: function(player, target) {
                                    if (get.attitude(player, target) < 0 && !target.countCards('he',
                                    function(card) {
                                        return get.value(card, target) > 0 && card != target.getEquip('jinhe');
                                    })) {
                                        return 0;
                                    }
                                    if (get.attitude(player, target) > 1) {
                                        return (target.countCards('ej',
                                        function(card) {
                                            if (get.position(card) == 'e') return get.value(card, target) <= 0;
                                            var cardj = card.viewAs ? {
                                                name: card.viewAs
                                            }: card;
                                            return get.effect(target, cardj, target, player) < 0;
                                        }) > 0) ? 1.5 : -1.5;
                                    }
                                    return 1;
                                },
                            },
                        },
                    },
                    "ssr_tianlang": {
                        trigger: {
                            player: ["phaseZhunbeiBegin"],
                        },
                        audio: "buchen",
                        priority: 91,
                        frequent: true,
                        content: function() {
                            'step 0';
                            var names = ['tianshu', 'tianxuan', 'tianji', 'tianquan', 'yuheng', 'kaiyang', 'yaoguang'];
                            var translists = ['天枢', '天璇', '天玑', '天权', '玉衡', '开阳', '摇光'];
                            event.star = [];
                            event.starlist = {
                                'tianshu': ['quanbian', 'xiongzhi'],
                                'tianxuan': ['yingzi', 'zhiheng'],
                                'tianji': ['guanxing', 'rende'],
                                'tianquan': ['tuxi', 'zhujiu'],
                                'yuheng': ['baiyi', 'jinglue'],
                                'kaiyang': ['zhaoxin', 'langgu'],
                                'yaoguang': ['guixin', 'tianyuan'],
                            };
                            event.skltranslate = {
                                'xiongzhi': "雄志",
                                'xiongzhi_info': "出牌阶段限一次，你可以展示牌堆顶的一张牌并使用之，若如此做，你重复此流程，直到你展示的牌无法使用。",
                                'zhiheng': "制衡",
                                'zhiheng_info': "出牌阶段限一次，你可以弃置任意张牌，然后摸等量的牌，若你因此弃置了所有手牌，则你额外摸一张牌。",
                                'rende': "仁德",
                                'rende_info': "出牌阶段，你可以将至少一张手牌交给其他角色，若你于此阶段内给出的牌首次达到两张，你可以视为使用一张基本牌。",
                                'zhujiu': "煮酒",
                                'zhujiu_info': "每回合限一次，当一名角色需要使用一张【酒】时，其可以向你发出请求，然后你可以打出一张黑色手牌，视为该角色使用了一张【酒】。",
                                'jinglue': "景略",
                                'jinglue_info': "出牌阶段限一次，你可以观看一名角色的手牌，然后你可以将其中的一张牌替换成【毒】并获得替换出来的牌。",
                                'langgu': "狼顾",
                                'langgu_info': "出牌阶段限一次，你可以指定一名角色并进行判定（结果生效前你可以打出一张手牌替换之），然后你可以观看该角色的手牌并弃置其中任意张与判定结果花色相同的牌。",
                                'tianyuan': "天元",
                                'tianyuan_info': "出牌阶段限一次，你可以观看一名其他角色的手牌，然后你可以弃置你与其任意张不同花色的手牌，若你弃置了总共四张牌，你重置武将牌并回复一点体力，然后摸两张牌。",
                                'quanbian': "权变",
                                'quanbian_info': "准备阶段，你可以移动场上的最多三张牌。",
                                'yingzi': "英姿",
                                'yingzi_info': "摸牌阶段摸牌时，你可以额外摸一张牌。",
                                'guanxing': "观星",
                                'guanxing_info': "准备阶段，你可以观看牌堆顶的X张牌，并将其以任意顺序置于牌堆顶或牌堆底。（X为存活角色数且不超过五）",
                                'tuxi': "突袭",
                                'tuxi_info': "摸牌阶段摸牌时，你可以少摸任意张牌，然后获得等量的角色的各一张手牌。",
                                'baiyi': "败移",
                                'baiyi_info': "准备阶段，你可以交换两名其他角色的座次。",
                                'zhaoxin': "昭心",
                                'zhaoxin_info': "准备阶段，你可以展示任意张手牌并指定数量相等的其他角色，这些角色依次选择其中一张牌获得，然后受到你的一点伤害。",
                                'guixin': "归心",
                                'guixin_info': "摸牌阶段，你可以改为按照你选择的区域优先度随机移出每名其他角色区域里的一张牌，然后你从中获得数量不大于你摸牌数的牌。",
                            };
                            for (var i = 0; i < 7; i++) {
                                lib.card['guanxing_' + names[i]] = {
                                    fullskin: true,
                                    image: 'ext:祖安武将/card/guanxing_' + names[i] + '.png',
                                    opacity: 1,
                                    textShadow: 'black 0 0 2px',
                                    value: Math.random(),
                                };
                                lib.translate['guanxing_' + names[i] + ''] = translists[i];
                                var sks = event.starlist[names[i]];
                                var ins1 = event.skltranslate[sks[0]];
                                var inf1 = event.skltranslate[sks[0] + '_info'];
                                var ins2 = event.skltranslate[sks[1]];
                                var inf2 = event.skltranslate[sks[1] + '_info'];
                                lib.translate['guanxing_' + names[i] + '_info'] = "北斗七星<br>〖" + ins1 + "〗<li>" + inf1 + "<br>〖" + ins2 + "〗<li>" + inf2;
                                var card = game.createCard({
                                    name: 'guanxing_' + names[i],
                                    number: '星',
                                    suit: '象'
                                });
                                card.rename = names[i];
                                event.star.push(card);
                            }
                            'step 1';
                            event.gets = event.star.randomGets(3);
                            //event.gets=event.star[6-1];
                            player.showCards(event.gets, '北斗七星');
                            player.chooseCardButton('天狼：请查看今夜的星象', true, event.gets, 1).set('ai',
                            function(button) {
                                return get.value(button);
                            });
                            'step 2';
                            player.$gain2(result.links);
                            player.addTempSkill('ssr_tianlang_' + event.starlist[result.links[0].rename][0]);
                            player.addTempSkill('ssr_tianlang_' + event.starlist[result.links[0].rename][1], {
                                player: 'phaseBefore'
                            });
                            'step 3';
                            var gets = event.starlist[result.links[0].rename];
                            var list = [];
                            list.push('发动〖' + event.skltranslate[gets[0]] + '〗<li>' + event.skltranslate[gets[0] + '_info']);
                            list.push('获得〖' + event.skltranslate[gets[1]] + '〗<li>' + event.skltranslate[gets[1] + '_info']);
                            player.chooseControl('ok').set('choiceList', list).set('prompt', '夜观天象');
                            game.delay();
                        },
                        init: function(player, skill) {
                            var sklist = ['xiongzhi', 'zhiheng', 'rende', 'zhujiu', 'jinglue', 'langgu', 'tianyuan', 'quanbian', 'yingzi', 'guanxing', 'tuxi', 'baiyi', 'zhaoxin', 'guixin', ];
                            var skills = {
                                'xiongzhi': "雄志",
                                'xiongzhi_info': "出牌阶段限一次，你可以展示牌堆顶的一张牌并使用之，若如此做，你重复此流程，直到你展示的牌无法使用。",
                                'zhiheng': "制衡",
                                'zhiheng_info': "出牌阶段限一次，你可以弃置任意张牌，然后摸等量的牌，若你因此弃置了所有手牌，则你额外摸一张牌。",
                                'rende': "仁德",
                                'rende_info': "出牌阶段，你可以将至少一张手牌交给其他角色，若你于此阶段内给出的牌首次达到两张，你可以视为使用一张基本牌。",
                                'zhujiu': "煮酒",
                                'zhujiu_info': "每回合限一次，当一名角色需要使用一张【酒】时，其可以向你发出请求，然后你可以打出一张黑色手牌，视为该角色使用了一张【酒】。",
                                'jinglue': "景略",
                                'jinglue_info': "出牌阶段限一次，你可以观看一名角色的手牌，然后你可以将其中的一张牌替换成【毒】并获得替换出来的牌。",
                                'langgu': "狼顾",
                                'langgu_info': "出牌阶段限一次，你可以指定一名角色并进行判定（结果生效前你可以打出一张手牌替换之），然后你可以观看该角色的手牌并弃置其中任意张与判定结果花色相同的牌。",
                                'tianyuan': "天元",
                                'tianyuan_info': "出牌阶段限一次，你可以观看一名其他角色的手牌，然后你可以弃置你与其任意张不同花色的手牌，若你弃置了总共四张牌，你重置武将牌并回复一点体力，然后摸两张牌。",
                                'quanbian': "权变",
                                'quanbian_info': "",
                                'yingzi': "英姿",
                                'yingzi_info': "",
                                'guanxing': "观星",
                                'guanxing_info': "",
                                'tuxi': "突袭",
                                'tuxi_info': "",
                                'baiyi': "败移",
                                'baiyi_info': "",
                                'zhaoxin': "昭心",
                                'zhaoxin_info': "",
                                'guixin': "归心",
                                'guixin_info': "",
                            };
                            for (var i = 0; i < sklist.length; i++) {
                                lib.translate['ssr_tianlang_' + sklist[i]] = skills[sklist[i]];
                                lib.translate['ssr_tianlang_' + sklist[i] + '_info'] = skills[sklist[i] + '_info'];
                            }
                        },
                        subSkill: {
                            quanbian: {
                                audio: 'quanbian',
                                trigger: {
                                    player: "phaseZhunbeiBegin",
                                },
                                priority: 11,
                                direct: true,
                                filter: function(event, player, cards) {
                                    return player.canMoveCard();
                                },
                                content: function() {
                                    'step 0';
                                    player.logSkill("ssr_tianlang_quanbian");
                                    event.count = 3;
                                    event.cards = [];
                                    'step 1';
                                    event.count--;
                                    if (!player.canMoveCard()) {
                                        if (event && event.finish) {
                                            event.finish();
                                        } else {
                                            return;
                                        }
                                    }
                                    'step 2';
                                    player.moveCard().set('prompt', '权变：移动场上的第' + get.cnNumber(3 - event.count) + '张牌');
                                    'step 3';
                                    if (event.count > 0 && result.bool) event.goto(1);
                                },
                                sub: true,
                            },
                            yingzi: {
                                audio: 'yingzi',
                                priority: 11,
                                trigger: {
                                    player: "phaseDrawBegin2",
                                },
                                direct: true,
                                filter: function(event, player) {
                                    return ! event.numFixed;
                                },
                                content: function() {
                                    player.logSkill("ssr_tianlang_yingzi");
                                    trigger.num++;
                                },
                                sub: true,
                            },
                            guanxing: {
                                audio: 'guanxing',
                                trigger: {
                                    player: 'phaseZhunbeiBegin',
                                },
                                priority: 11,
                                direct: true,
                                preHidden: true,
                                content: function() {
                                    "step 0";
                                    player.logSkill("ssr_tianlang_guanxing");
                                    var num = Math.min(5, game.countPlayer());
                                    var cards = get.cards(num);
                                    game.cardsGotoOrdering(cards);
                                    var next = player.chooseToMove();
                                    next.set('list', [['牌堆顶', cards], ['牌堆底'], ]);
                                    next.set('prompt', '观星：点击将牌移动到牌堆顶或牌堆底');
                                    next.processAI = function(list) {
                                        var cards = list[0][1],
                                        player = _status.event.player;
                                        var top = [];
                                        var judges = player.getCards('j');
                                        var stopped = false;
                                        if (!player.hasWuxie()) {
                                            for (var i = 0; i < judges.length; i++) {
                                                var judge = get.judge(judges[i]);
                                                cards.sort(function(a, b) {
                                                    return judge(b) - judge(a);
                                                });
                                                if (judge(cards[0]) < 0) {
                                                    stopped = true;
                                                    break;
                                                } else {
                                                    top.unshift(cards.shift());
                                                }
                                            }
                                        }
                                        var bottom;
                                        if (!stopped) {
                                            cards.sort(function(a, b) {
                                                return get.value(b, player) - get.value(a, player);
                                            });
                                            while (cards.length) {
                                                if (get.value(cards[0], player) <= 5) break;
                                                top.unshift(cards.shift());
                                            }
                                        }
                                        bottom = cards;
                                        return [top, bottom];
                                    }
                                    "step 1";
                                    var top = result.moved[0];
                                    var bottom = result.moved[1];
                                    top.reverse();
                                    for (var i = 0; i < top.length; i++) {
                                        ui.cardPile.insertBefore(top[i], ui.cardPile.firstChild);
                                    }
                                    for (var i = 0; i < bottom.length; i++) {
                                        ui.cardPile.appendChild(bottom[i]);
                                    }
                                    player.popup(get.cnNumber(top.length) + '上' + get.cnNumber(bottom.length) + '下');
                                    game.log(player, '将' + get.cnNumber(top.length) + '张牌置于牌堆顶');
                                    game.updateRoundNumber();
                                    game.delayx();
                                },
                                sub: true,
                            },
                            tuxi: {
                                audio: "retuxi",
                                trigger: {
                                    player: "phaseDrawBegin1",
                                },
                                priority: 11,
                                direct: true,
                                preHidden: true,
                                filter: function(event, player) {
                                    return event.num > 0 && !event.numFixed && game.hasPlayer(function(target) {
                                        return target.countCards('h') > 0 && player != target;
                                    });
                                },
                                content: function() {
                                    "step 0";
                                    var num = get.copy(trigger.num);
                                    if (get.mode() == 'guozhan' && num > 2) num = 2;
                                    player.chooseTarget(get.prompt('ssr_tianlang_tuxi'), '获得至多' + get.translation(num) + '名角色的各一张手牌，然后少摸等量的牌', [1, num],
                                    function(card, player, target) {
                                        return target.countCards('h') > 0 && player != target;
                                    },
                                    function(target) {
                                        var att = get.attitude(_status.event.player, target);
                                        if (target.hasSkill('tuntian')) return att / 10;
                                        return 1 - att;
                                    }).setHiddenSkill('ssr_tianlang_tuxi');
                                    "step 1";
                                    if (result.bool) {
                                        result.targets.sortBySeat();
                                        player.logSkill('ssr_tianlang_tuxi', result.targets);
                                        player.gainMultiple(result.targets);
                                        trigger.num -= result.targets.length;
                                    } else {
                                        {
                                            if (event && event.finish) {
                                                event.finish();
                                            } else {
                                                return;
                                            }
                                        }
                                    }
                                    "step 2";
                                    if (trigger.num <= 0) game.delay();
                                },
                                sub: true,
                            },
                            baiyi: {
                                audio: "baiyi",
                                trigger: {
                                    player: "phaseDrawBegin2",
                                },
                                priority: 11,
                                direct: true,
                                preHidden: true,
                                filter: function(event, player) {
                                    return game.players.length > 2;
                                },
                                content: function() {
                                    "step 0";
                                    player.chooseTarget(get.prompt('ssr_tianlang_baiyi'), '交换其他两名角色的座次', 2,
                                    function(card, player, target) {
                                        return player != target;
                                    },
                                    function(target) {
                                        if (player.hasUnknown() && target != player.next && target != player.previous) return 0;
                                        var distance = Math.pow(get.distance(player, target, 'absolute'), 2);
                                        if (!ui.selected.targets.length) return distance;
                                        var distance2 = Math.pow(get.distance(player, ui.selected.targets[0], 'absolute'), 2);
                                        return Math.min(0, distance - distance2);
                                    }).setHiddenSkill('ssr_tianlang_baiyi');
                                    "step 1";
                                    if (result.bool) {
                                        //result.targets.sortBySeat();
                                        player.logSkill('ssr_tianlang_baiyi', result.targets);
                                        game.broadcastAll(function(target1, target2) {
                                            game.swapSeat(target1, target2);
                                        },
                                        result.targets[0], result.targets[1])
                                    } else {
                                        {
                                            if (event && event.finish) {
                                                event.finish();
                                            } else {
                                                return;
                                            }
                                        }
                                    }
                                    "step 2";
                                    if (trigger.num <= 0) game.delay();
                                },
                                sub: true,
                            },
                            zhaoxin: {
                                audio: 'xinfu_zhaoxin',
                                trigger: {
                                    player: "phaseZhunbeiBegin",
                                },
                                priority: 11,
                                direct: true,
                                filter: function(event, player) {
                                    return player.countCards('h') > 0;
                                },
                                content: function() {
                                    "step 0";
                                    player.chooseCardTarget({
                                        position: 'h',
                                        filterCard: true,
                                        selectCard: [1, Infinity],
                                        filterTarget: function(card, player, target) {
                                            return player != target;
                                        },
                                        selectTarget: function() {
                                            return ui.selected.cards.length;
                                        },
                                        ai1: function(card) {
                                            return 6 - get.value(card);
                                        },
                                        ai2: function(target) {
                                            var att = get.attitude(_status.event.player, target);
                                            return - att;
                                        },
                                        prompt: "展示任意张手牌并令等量的其他角色各获得其中一张，然后视为你对这些角色各造成一点伤害",
                                    });
                                    "step 1";
                                    if (!result.bool) {
                                        if (event && event.finish) {
                                            event.finish();
                                        } else {
                                            return;
                                        }
                                    }
                                    "step 2";
                                    player.logSkill("ssr_tianlang_zhaoxin", event.target);
                                    event.target = result.targets.sortBySeat();
                                    event.cards = result.cards.slice(0);
                                    player.lose(result.cards);
                                    player.showCards(result.cards, '昭心');
                                    "step 3";
                                    if (event.target.length < 1 || event.cards.length < 1) {
                                        if (event && event.finish) {
                                            event.finish();
                                        } else {
                                            return;
                                        }
                                    }
                                    "step 4";
                                    event.target[0].chooseCardButton('昭心：选择一张牌获得', true, event.cards, 1).set('ai',
                                    function(button) {
                                        return get.value(button);
                                    });
                                    "step 5";
                                    if (!result.bool) event.goto(3);
                                    "step 6";
                                    event.lose = result.links[0];
                                    event.target[0].gain(event.lose, player);
                                    player.$give(event.lose, event.target[0]);
                                    game.delay();
                                    "step 7";
                                    //player.useCard({name:'sha'},event.target[0]);
                                    event.target[0].damage(player);
                                    "step 8";
                                    event.target.remove(event.target[0]);
                                    event.cards.remove(event.lose);
                                    "step 9";
                                    event.goto(3);
                                },
                                sub: true,
                            },
                            guixin: {
                                audio: "choufa",
                                trigger: {
                                    player: "phaseDrawBegin1",
                                },
                                filter: function(event, player) {
                                    return ! event.numFixed;
                                },
                                priority: 11,
                                direct: true,
                                content: function() {
                                    "step 0";
                                    player.logSkill("ssr_tianlang_guixin");
                                    trigger.cancel();
                                    var targets = game.filterPlayer();
                                    targets.remove(player);
                                    targets.sort(lib.sort.seat);
                                    event.targets = targets;
                                    event.count = 1;
                                    event.draw = trigger.num;
                                    event.gain = [];
                                    "step 1";
                                    event.num = 0;
                                    player.line(targets, 'green');
                                    player.chooseControl('手牌区', '装备区', '判定区').set('ai',
                                    function() {
                                        if (game.hasPlayer(function(current) {
                                            return current.countCards('j') && current != player && get.attitude(player, current) > 0;
                                        })) return 2;
                                        return Math.floor(Math.random() * 3);
                                    }).set('prompt', '请选择优先获得的区域');
                                    "step 2";
                                    event.range = {手牌区: ['h', 'e', 'j'],
                                        装备区: ['e', 'h', 'j'],
                                        判定区: ['j', 'h', 'e'],
                                    } [result.control || '手牌区'];
                                    "step 3";
                                    if (num < event.targets.length) {
                                        var target = event.targets[num];
                                        var range = event.range;
                                        for (var i = 0; i < range.length; i++) {
                                            var cards = target.getCards(range[i]);
                                            if (cards.length) {
                                                var card = cards.randomGet();
                                                //player.gain(card,target,'giveAuto','bySelf');
                                                target.lose(card);
                                                target.$give(card, player, false);
                                                event.gain = event.gain.concat(card);
                                                break;
                                            }
                                        }
                                        event.num++;
                                    }
                                    "step 4";
                                    if (num < event.targets.length) event.goto(3);
                                    "step 5";
                                    game.cardsGotoOrdering(event.gain);
                                    event.videoId = lib.status.videoId++;
                                    event.drawnum = Math.min(event.draw, event.gain.length);
                                    game.broadcastAll(function(player, id, cards) {
                                        var str;
                                        if (player == game.me && !_status.auto) {
                                            str = '选择获得其中至多' + get.cnNumber(event.drawnum) + '张牌';
                                        } else {
                                            str = '天下归心';
                                        }
                                        var dialog = ui.create.dialog(str, cards);
                                        dialog.videoId = id;
                                    },
                                    player, event.videoId, event.gain);
                                    event.time = get.utc();
                                    game.addVideo('showCards', player, ['天下归心', get.cardsInfo(event.gain)]);
                                    game.addVideo('delay', null, 2);
                                    "step 6";
                                    var next = player.chooseButton([1, event.drawnum]);
                                    next.set('dialog', event.videoId);
                                    next.set('filterButton',
                                    function(button) {
                                        return true;
                                        for (var i = 0; i < ui.selected.buttons.length; i++) {
                                            if (get.suit(ui.selected.buttons[i].link) == get.suit(button.link)) return false;
                                        }
                                    });
                                    next.set('ai',
                                    function(button) {
                                        return get.value(button.link, player);
                                    });
                                    "step 7";
                                    game.broadcastAll('closeDialog', event.videoId);
                                    if (result.bool && result.links) {
                                        event.cards2 = result.links;
                                    } else {
                                        {
                                            if (event && event.finish) {
                                                event.finish();
                                            } else {
                                                return;
                                            }
                                        }
                                    }
                                    var time = 1000 - (get.utc() - event.time);
                                    if (time > 0) {
                                        game.delay(0, time);
                                    }
                                    "step 8";
                                    var cards2 = event.cards2;
                                    player.gain(cards2, 'log', 'gain2');
                                },
                                sub: true,
                            },
                            xiongzhi: {
                                audio: 'xiongzhi',
                                enable: "phaseUse",
                                usable: 1,
                                content: function() {
                                    'step 0';
                                    var card = get.cards()[0];
                                    event.card = card;
                                    player.showCards(card);
                                    if (!player.hasUseTarget(card)) {
                                        card.fix();
                                        ui.cardPile.insertBefore(card, ui.cardPile.firstChild);
                                        game.updateRoundNumber(); {
                                            if (event && event.finish) {
                                                event.finish();
                                            } else {
                                                return;
                                            }
                                        }
                                    }
                                    'step 1';
                                    var next = player.chooseUseTarget(card, true);
                                    if (get.info(card).updateUsable == 'phaseUse') next.addCount = false;
                                    'step 2';
                                    if (result.bool) event.goto(0);
                                    else {
                                        card.fix();
                                        ui.cardPile.insertBefore(card, ui.cardPile.firstChild);
                                        game.updateRoundNumber();
                                    }
                                },
                                ai: {
                                    order: 1,
                                    result: {
                                        player: function(player) {
                                            var cards = [];
                                            for (var i = 0; i < Math.min(2, player.maxHp); i++) {
                                                var card = ui.cardPile.childNodes[i];
                                                if (card) {
                                                    if (!player.hasValueTarget(card)) return 0;
                                                } else break;
                                            }
                                            return 1;
                                        },
                                    },
                                },
                                sub: true,
                            },
                            zhiheng: {
                                audio: 'rezhiheng',
                                enable: "phaseUse",
                                usable: 1,
                                filter: function(event, player) {
                                    return player.countCards('he') > 0;
                                },
                                position: "he",
                                filterCard: function(card, player, event) {
                                    event = event || _status.event;
                                    if (typeof event != 'string') event = event.getParent().name;
                                    var mod = game.checkMod(card, player, event, 'unchanged', 'cardDiscardable', player);
                                    if (mod != 'unchanged') return mod;
                                    return true;
                                },
                                discard: false,
                                lose: false,
                                delay: false,
                                selectCard: [1, Infinity],
                                prompt: "弃置任意张牌，然后摸等量的牌，若你因此弃置了所有手牌，则你额外摸一张牌。",
                                check: function(card) {
                                    var player = _status.event.player;
                                    if (get.position(card) == 'h' && !player.countCards('h',
                                    function(card) {
                                        return get.value(card) >= 8;
                                    })) {
                                        return 8 - get.value(card);
                                    }
                                    return 6 - get.value(card)
                                },
                                content: function() {
                                    'step 0';
                                    player.discard(cards);
                                    event.num = 1;
                                    var hs = player.getCards('h');
                                    if (!hs.length) event.num = 0;
                                    for (var i = 0; i < hs.length; i++) {
                                        if (!cards.contains(hs[i])) {
                                            event.num = 0;
                                            break;
                                        }
                                    }
                                    'step 1';
                                    player.draw(event.num + cards.length);
                                },
                                ai: {
                                    order: 1,
                                    result: {
                                        player: function(player) {
                                            var num = 0;
                                            var cards = player.getCards('he');
                                            for (var i = 0; i < cards.length; i++) {
                                                if (get.value(cards[i]) < 6) {
                                                    num++;
                                                }
                                            }
                                            if (cards.length > 2) return 1;
                                            if (cards.length == 2) return 2;
                                            return 0;
                                        },
                                    },
                                    threaten: 1.5,
                                },
                                sub: true,
                            },
                            rende: {
                                audio: "rerende",
                                enable: "phaseUse",
                                filterCard: true,
                                selectCard: [1, Infinity],
                                discard: false,
                                lose: false,
                                delay: false,
                                filter: function(event, player) {
                                    return player.countCards('h') > 0;
                                },
                                filterTarget: function(card, player, target) {
                                    return player != target;
                                },
                                onremove: true,
                                check: function(card) {
                                    if (ui.selected.cards.length && ui.selected.cards[0].name == 'du') return 0;
                                    if (!ui.selected.cards.length && card.name == 'du') return 20;
                                    var player = get.owner(card);
                                    if (ui.selected.cards.length >= Math.max(2, player.countCards('h') - player.hp)) return 0;
                                    if (player.hp == player.maxHp || player.storage.ssr_tianlang_rende < 0 || player.countCards('h') <= 1) {
                                        var players = game.filterPlayer();
                                        for (var i = 0; i < players.length; i++) {
                                            if (players[i].hasSkill('haoshi') && !players[i].isTurnedOver() && !players[i].hasJudge('lebu') && get.attitude(player, players[i]) >= 3 && get.attitude(players[i], player) >= 3) {
                                                return 11 - get.value(card);
                                            }
                                        }
                                        if (player.countCards('h') > player.hp) return 10 - get.value(card);
                                        if (player.countCards('h') > 2) return 6 - get.value(card);
                                        return - 1;
                                    }
                                    return 10 - get.value(card);
                                },
                                content: function() {
                                    'step 0';
                                    var evt = _status.event.getParent('phaseUse');
                                    if (evt && evt.name == 'phaseUse' && !evt.ssr_tianlang_rende) {
                                        var next = game.createEvent('ssr_tianlang_rende_clear');
                                        _status.event.next.remove(next);
                                        evt.after.push(next);
                                        evt.ssr_tianlang_rende = true;
                                        next.player = player;
                                        next.setContent(function() {
                                            delete player.storage.ssr_tianlang_rende;
                                        });
                                    }
                                    target.gain(cards, player, 'giveAuto');
                                    if (typeof player.storage.ssr_tianlang_rende != 'number') {
                                        player.storage.ssr_tianlang_rende = 0;
                                    }
                                    if (player.storage.ssr_tianlang_rende >= 0) {
                                        player.storage.ssr_tianlang_rende += cards.length;
                                        if (player.storage.ssr_tianlang_rende >= 2) {
                                            var list = [];
                                            if (lib.filter.cardUsable({
                                                name: 'sha'
                                            },
                                            player, event.getParent('chooseToUse')) && game.hasPlayer(function(current) {
                                                return player.canUse('sha', current);
                                            })) {
                                                list.push(['基本', '', 'sha']);
                                            }
                                            for (var i of lib.inpile_nature) {
                                                if (lib.filter.cardUsable({
                                                    name: 'sha',
                                                    nature: i
                                                },
                                                player, event.getParent('chooseToUse')) && game.hasPlayer(function(current) {
                                                    return player.canUse({
                                                        name: 'sha',
                                                        nature: i
                                                    },
                                                    current);
                                                })) {
                                                    list.push(['基本', '', 'sha', i]);
                                                }
                                            }
                                            if (lib.filter.cardUsable({
                                                name: 'tao'
                                            },
                                            player, event.getParent('chooseToUse')) && game.hasPlayer(function(current) {
                                                return player.canUse('tao', current);
                                            })) {
                                                list.push(['基本', '', 'tao']);
                                            }
                                            if (lib.filter.cardUsable({
                                                name: 'jiu'
                                            },
                                            player, event.getParent('chooseToUse')) && game.hasPlayer(function(current) {
                                                return player.canUse('jiu', current);
                                            })) {
                                                list.push(['基本', '', 'jiu']);
                                            }
                                            if (list.length) {
                                                player.chooseButton(['是否视为使用一张基本牌？', [list, 'vcard']]).set('ai',
                                                function(button) {
                                                    var player = _status.event.player;
                                                    var card = {
                                                        name: button.link[2],
                                                        nature: button.link[3]
                                                    };
                                                    if (card.name == 'tao') {
                                                        if (player.hp == 1 || (player.hp == 2 && !player.hasShan()) || player.needsToDiscard()) {
                                                            return 5;
                                                        }
                                                        return 1;
                                                    }
                                                    if (card.name == 'sha') {
                                                        if (game.hasPlayer(function(current) {
                                                            return player.canUse(card, current) && get.effect(current, card, player, player) > 0
                                                        })) {
                                                            if (card.nature == 'fire') return 2.95;
                                                            if (card.nature == 'thunder' || card.nature == 'ice') return 2.92;
                                                            return 2.9;
                                                        }
                                                        return 0;
                                                    }
                                                    if (card.name == 'jiu') {
                                                        return 0.5;
                                                    }
                                                    return 0;
                                                });
                                            } else {
                                                {
                                                    if (event && event.finish) {
                                                        event.finish();
                                                    } else {
                                                        return;
                                                    }
                                                }
                                            }
                                            player.storage.ssr_tianlang_rende = -1;
                                        } else {
                                            {
                                                if (event && event.finish) {
                                                    event.finish();
                                                } else {
                                                    return;
                                                }
                                            }
                                        }
                                    } else {
                                        {
                                            if (event && event.finish) {
                                                event.finish();
                                            } else {
                                                return;
                                            }
                                        }
                                    }
                                    'step 1';
                                    if (result && result.bool && result.links[0]) {
                                        var card = {
                                            name: result.links[0][2],
                                            nature: result.links[0][3]
                                        };
                                        player.chooseUseTarget(card, true);
                                    }
                                },
                                ai: {
                                    fireAttack: true,
                                    order: function(skill, player) {
                                        if (player.hp < player.maxHp && player.storage.ssr_tianlang_rende < 2 && player.countCards('h') > 1) {
                                            return 10;
                                        }
                                        return 4;
                                    },
                                    result: {
                                        target: function(player, target) {
                                            if (target.hasSkillTag('nogain')) return 0;
                                            if (ui.selected.cards.length && ui.selected.cards[0].name == 'du') {
                                                if (target.hasSkillTag('nodu')) return 0;
                                                return - 10;
                                            }
                                            if (target.hasJudge('lebu')) return 0;
                                            var nh = target.countCards('h');
                                            var np = player.countCards('h');
                                            if (player.hp == player.maxHp || player.storage.ssr_tianlang_rende < 0 || player.countCards('h') <= 1) {
                                                if (nh >= np - 1 && np <= player.hp && !target.hasSkill('haoshi')) return 0;
                                            }
                                            return Math.max(1, 5 - nh);
                                        },
                                    },
                                    effect: {
                                        target: function(card, player, target) {
                                            if (player == target && get.type(card) == 'equip') {
                                                if (player.countCards('e', {
                                                    subtype: get.subtype(card)
                                                })) {
                                                    if (game.hasPlayer(function(current) {
                                                        return current != player && get.attitude(player, current) > 0;
                                                    })) {
                                                        return 0;
                                                    }
                                                }
                                            }
                                        },
                                    },
                                    threaten: 0.8,
                                },
                                sub: true,
                            },
                            zhujiu: {
                                init: function(player, skill) {
                                    lib.translate["ssr_tianlang_jiu"] = '煮酒';
                                },
                                global: "ssr_tianlang_jiu",
                                audio: "guixin",
                                sub: true,
                            },
                            jiu: {
                                usable: 1,
                                audio: "guixin",
                                enable: "chooseToUse",
                                hiddenCard: function(player, name) {
                                    return (name == 'jiu');
                                },
                                filter: function(event, player) {
                                    if (!game.hasPlayer(function(current) {
                                        return current.hasSkill('ssr_tianlang_zhujiu');
                                    })) return false;
                                    return event.filterCard({
                                        name: 'jiu',
                                        isCard: true
                                    },
                                    player, event);
                                },
                                check: function(event, player) {
                                    var num = game.countPlayer(function(current) {
                                        return current.hasSkill('ssr_tianlang_zhujiu') && get.attitude(player, current) > 0;
                                    });
                                    return num >= 1;
                                },
                                content: function() {
                                    'step 0';
                                    event.current = player;
                                    event.okay = false;
                                    'step 1';
                                    if (event.current == player && event.okay) {
                                        {
                                            if (event && event.finish) {
                                                event.finish();
                                            } else {
                                                return;
                                            }
                                        }
                                    } else {
                                        if (event.current == player && !event.okay) event.okay = true;
                                        if (event.current.hasSkill('ssr_tianlang_zhujiu')) {
                                            var next = event.current.chooseToRespond('煮酒：是否为' + get.translation(player.name) + '打出一张黑色手牌，视为其使用了一张【酒】？', {
                                                color: 'black'
                                            });
                                            next.set('ai',
                                            function() {
                                                var event = _status.event;
                                                return (get.attitude(event.player, event.source) - 2);
                                            });
                                            next.set('source', player);
                                            next.set('ssr_tianlang_zhujiu', true);
                                            next.set('skillwarn', '令' + get.translation(player.name) + '使用了一张【酒】');
                                            next.noOrdering = true;
                                            next.autochoose = lib.filter.autoUseJiu;
                                        } else {
                                            event.current = event.current.next;
                                            event.redo();
                                        }
                                    }
                                    "step 2";
                                    if (result.bool) {
                                        if (_status.event.getParent(2).type == 'dying') {
                                            event.dying = player;
                                            event.type = 'dying';
                                        }
                                        player.useCard({
                                            name: 'jiu',
                                            isCard: true
                                        },
                                        result.cards, player);
                                        if (typeof event.current.ai.shown == 'number' && event.current.ai.shown < 0.95) {
                                            event.current.ai.shown += 0.3;
                                            if (event.current.ai.shown > 0.95) event.current.ai.shown = 0.95;
                                        } {
                                            if (event && event.finish) {
                                                event.finish();
                                            } else {
                                                return;
                                            }
                                        }
                                    } else {
                                        event.current = event.current.next;
                                        event.goto(1);
                                    }
                                },
                                ai: {
                                    threaten: 1.4,
                                    order: function() {
                                        return get.order({
                                            name: 'sha'
                                        }) + 0.2;
                                    },
                                    result: {
                                        player: function(player) {
                                            var num = game.countPlayer(function(current) {
                                                return current.hasSkill('ssr_tianlang_zhujiu') && get.attitude(player, current) > 0;
                                            });
                                            if (num < 1) return 0;
                                            if (_status.event.parent.name == 'phaseUse') {
                                                if (player.countCards('h', 'jiu') > 0) return 0;
                                                if (player.getEquip('zhuge') && player.countCards('h', 'sha') > 1) return 0;
                                                if (!player.countCards('h', 'sha')) return 0;
                                                var targets = [];
                                                var target;
                                                var players = game.filterPlayer();
                                                for (var i = 0; i < players.length; i++) {
                                                    if (get.attitude(player, players[i]) < 0) {
                                                        if (player.canUse('sha', players[i], true, true)) {
                                                            targets.push(players[i]);
                                                        }
                                                    }
                                                }
                                                if (targets.length) {
                                                    target = targets[0];
                                                } else {
                                                    return 0;
                                                }
                                                var num = get.effect(target, {
                                                    name: 'sha'
                                                },
                                                player, player);
                                                for (var i = 1; i < targets.length; i++) {
                                                    var num2 = get.effect(targets[i], {
                                                        name: 'sha'
                                                    },
                                                    player, player);
                                                    if (num2 > num) {
                                                        target = targets[i];
                                                        num = num2;
                                                    }
                                                }
                                                if (num <= 0) return 0;
                                                var e2 = target.getEquip(2);
                                                if (e2) {
                                                    if (e2.name == 'tengjia') {
                                                        if (!player.countCards('h', {
                                                            name: 'sha',
                                                            nature: 'fire'
                                                        }) && !player.getEquip('zhuque')) return 0;
                                                    }
                                                    if (e2.name == 'renwang') {
                                                        if (!player.countCards('h', {
                                                            name: 'sha',
                                                            color: 'red'
                                                        })) return 0;
                                                    }
                                                    if (e2.name == 'baiyin') return 0;
                                                }
                                                if (player.getEquip('guanshi') && player.countCards('he') > 2) return 1;
                                                return target.countCards('h') > 3 ? 0 : 1;
                                            }
                                            if (player == _status.event.dying) return 3;
                                        },
                                        target: function(player, target) {
                                            var num = game.countPlayer(function(current) {
                                                return current.hasSkill('ssr_tianlang_zhujiu') && get.attitude(player, current) > 0;
                                            });
                                            if (num < 1) return 0;
                                            if (target && target.isDying()) return 2;
                                            if (target && !target.isPhaseUsing()) return 0;
                                            if (lib.config.mode == 'stone' && !player.isMin()) {
                                                if (player.getActCount() + 1 >= player.actcount) return 0;
                                            }
                                            var shas = player.getCards('h', 'sha');
                                            if (shas.length > 1 && (player.getCardUsable('sha') > 1 || player.countCards('h', 'zhuge'))) {
                                                return 0;
                                            }
                                            shas.sort(function(a, b) {
                                                return get.order(b) - get.order(a);
                                            });
                                            var card;
                                            if (shas.length) {
                                                for (var i = 0; i < shas.length; i++) {
                                                    if (lib.filter.filterCard(shas[i], target)) {
                                                        card = shas[i];
                                                        break;
                                                    }
                                                }
                                            } else if (player.hasSha() && player.needsToDiscard()) {
                                                if (player.countCards('h', 'hufu') != 1) {
                                                    card = {
                                                        name: 'sha'
                                                    };
                                                }
                                            }
                                            if (card) {
                                                if (game.hasPlayer(function(current) {
                                                    return (get.attitude(target, current) < 0 && target.canUse(card, current, true, true) && !current.hasSkillTag('filterDamage', null, {
                                                        player: player,
                                                        card: card,
                                                        jiu: true,
                                                    }) && get.effect(current, card, target) > 0);
                                                })) {
                                                    return 1;
                                                }
                                            }
                                            return 0;
                                        },
                                    },
                                    tag: {
                                        save: 1,
                                    },
                                },
                                sub: true,
                            },
                            jinglue: {
                                audio: 'jinglve',
                                enable: "phaseUse",
                                usable: 1,
                                filter: function(event, player) {
                                    return game.hasPlayer(function(current) {
                                        return current != player && current.countCards('h') > 0;
                                    });
                                },
                                filterTarget: function(card, player, target) {
                                    return target != player && target.countCards('h') > 0;
                                },
                                content: function() {
                                    'step 0';
                                    player.chooseButton(['选择其中一张牌作为「死士」', target.getCards('h')]).set('ai',
                                    function(button) {
                                        /*var target=_status.event.getParent().target;
		                                var card=button.link;
		                                var val=target.getUseValue(card);
		                                if(val>0) return val;*/
                                        return get.value(button);
                                    });
                                    'step 1';
                                    if (result.bool) {
                                        player.gain(result.links[0], target);
                                        var card = [game.createCard({
                                            name: 'du',
                                            suit: get.suit(result.links[0]),
                                            number: get.number(result.links[0])
                                        })];
                                        target.directgain(card);
                                    }
                                },
                                ai: {
                                    order: 12,
                                    result: {
                                        target: -1,
                                    },
                                },
                                sub: true,
                            },
                            langgu: {
                                enable: "phaseUse",
                                audio: "jilue_wansha",
                                usable: 1,
                                filter: function(event, player) {
                                    return game.hasPlayer(function(current) {
                                        return current != player && current.countCards('h') > 0;
                                    });
                                },
                                filterTarget: function(card, player, target) {
                                    return target != player && target.countCards('h') > 0;
                                },
                                logTarget: "source",
                                content: function() {
                                    'step 0';
                                    player.judge();
                                    'step 1';
                                    if (target.countCards('h') > 0) {
                                        var next = player.discardPlayerCard(target, 'h', [1, Infinity]);
                                        next.set('suit', result.suit);
                                        next.set('filterButton',
                                        function(button) {
                                            return get.suit(button.link) == _status.event.suit;
                                        });
                                        next.set('visible', true);
                                    }
                                },
                                group: "ssr_tianlang_rewrite",
                                sub: true,
                            },
                            rewrite: {
                                trigger: {
                                    player: "judge",
                                },
                                audio: "guicai",
                                filter: function(event, player) {
                                    return player.countCards('hs') > 0 && event.getParent().name == 'ssr_tianlang_langgu';
                                },
                                direct: true,
                                content: function() {
                                    "step 0";
                                    player.chooseCard('〖狼顾〗的判定结果为' + get.translation(trigger.player.judging[0]) + '，是否打出一张手牌进行替换？', 'hs',
                                    function(card) {
                                        var player = _status.event.player;
                                        var mod2 = game.checkMod(card, player, 'unchanged', 'cardEnabled2', player);
                                        if (mod2 != 'unchanged') return mod2;
                                        var mod = game.checkMod(card, player, 'unchanged', 'cardRespondable', player);
                                        if (mod != 'unchanged') return mod;
                                        return true;
                                    }).set('ai',
                                    function(card) {
                                        return - 1;
                                    });
                                    "step 1";
                                    if (result.bool) {
                                        player.respond(result.cards, 'highlight', 'splanggu', 'noOrdering');
                                    } else {
                                        {
                                            if (event && event.finish) {
                                                event.finish();
                                            } else {
                                                return;
                                            }
                                        }
                                    }
                                    "step 2";
                                    if (result.bool) {
                                        if (trigger.player.judging[0].clone) {
                                            trigger.player.judging[0].clone.classList.remove('thrownhighlight');
                                            game.broadcast(function(card) {
                                                if (card.clone) {
                                                    card.clone.classList.remove('thrownhighlight');
                                                }
                                            },
                                            trigger.player.judging[0]);
                                            game.addVideo('deletenode', player, get.cardsInfo([trigger.player.judging[0].clone]));
                                        }
                                        player.gain(trigger.player.judging[0]);
                                        player.$gain2(trigger.player.judging[0]);
                                        //game.cardsDiscard(trigger.player.judging[0]);
                                        trigger.player.judging[0] = result.cards[0];
                                        trigger.orderingCards.addArray(result.cards);
                                        game.log(trigger.player, '的判定牌改为', result.cards[0]);
                                    }
                                    "step 3";
                                    game.delay(2);
                                },
                                sub: true,
                            },
                            tianyuan: {
                                audio: 'chengwu',
                                enable: "phaseUse",
                                usable: 1,
                                filterTarget: function(card, player, target) {
                                    return target != player && target.countCards('h') > 0;
                                },
                                content: function() {
                                    'step 0';
                                    event.list1 = [];
                                    event.list2 = [];
                                    if (player.countCards('h') > 0) {
                                        var chooseButton = player.chooseButton([1, 4], ['你的手牌', player.getCards('h'), get.translation(target.name) + '的手牌', target.getCards('h')]);
                                    } else {
                                        var chooseButton = player.chooseButton([1, 4], [get.translation(target.name) + '的手牌', target.getCards('h')]);
                                    }
                                    chooseButton.set('target', target);
                                    chooseButton.set('ai',
                                    function(button) {
                                        var player = _status.event.player;
                                        var target = _status.event.target;
                                        var ps = [];
                                        var ts = [];
                                        for (var i = 0; i < ui.selected.buttons.length; i++) {
                                            var card = ui.selected.buttons[i].link;
                                            if (target.getCards('h').contains(card)) ts.push(card);
                                            else ps.push(card);
                                        }
                                        var card = button.link;
                                        var owner = get.owner(card);
                                        var val = get.value(card) || 1;
                                        if (owner == target) {
                                            if (ts.length > 1) return 0;
                                            if (ts.length == 0 || player.hp > 3) return val;
                                            return 2 * val;
                                        }
                                        return 7 - val;
                                    });
                                    chooseButton.set('filterButton',
                                    function(button) {
                                        for (var i = 0; i < ui.selected.buttons.length; i++) {
                                            if (get.suit(button.link) == get.suit(ui.selected.buttons[i].link)) return false;
                                        };
                                        return true;
                                    });
                                    'step 1';
                                    if (result.bool) {
                                        var list = result.links;
                                        for (var i = 0; i < list.length; i++) {
                                            if (get.owner(list[i]) == player) {
                                                event.list1.push(list[i]);
                                            } else {
                                                event.list2.push(list[i]);
                                            };
                                        };
                                        if (event.list1.length && event.list2.length) {
                                            target.discard(event.list2).delay = false;
                                            player.discard(event.list1);
                                        } else if (event.list2.length) {
                                            target.discard(event.list2);
                                        } else player.discard(event.list1);
                                    };
                                    'step 2';
                                    if (event.list1.length + event.list2.length == 4) {
                                        player.discard(player.getCards('j'));
                                        player.link(false);
                                        player.turnOver(false);
                                        player.recover();
                                        player.draw(2);
                                    };
                                },
                                ai: {
                                    order: 13,
                                    result: {
                                        target: function(target, player) {
                                            return - 1;
                                        },
                                    },
                                },
                                sub: true,
                            },
                        },
                    },
                    "ssr_newjilue": {
                        audio: "quanbian",
                        trigger: {
                            global: "useCardAfter",
                        },
                        filter: function(event, player) {
                            if (!event.card) return false;
                            if (! ['trick', 'delay'].contains(get.type(event.card))) return false;
                            if (event.player == player) return false;
                            if (!event.targets.contains(player)) return false;
                            return (event.targets.length == 1 || player.hasHistory('damage',
                            function(evt) {
                                return evt.card == event.card;
                            }));
                        },
                        content: function() {
                            player.useCard(game.createCard(trigger.card), trigger.player, false);
                        },
                        check:function(event,player){
                            return (get.attitude(player,event.source)<=0);
                        },
                        logTarget:"source",
                    },
                    "ssr_jilue": {
                        locked: true,
                        group: "ssr_jilue_fix",
                        subSkill: {
                            red: {
                                intro: {
                                    name: "红色",
                                    content: "mark",
                                },
                                marktext: "朱",
                                sub: true,
                            },
                            black: {
                                intro: {
                                    name: "黑色",
                                    content: "mark",
                                },
                                marktext: "墨",
                                sub: true,
                            },
                            fix: {
                                filter: function(event, player) {
                                    return player.countMark('ssr_jilue') > 0;
                                },
                                audio: "jilue_guicai",
                                trigger: {
                                    global: "judge",
                                },
                                direct: true,
                                content: function() {
                                    "step 0";
                                    var str = get.translation(trigger.player) + '的' + (trigger.judgestr || '') + '判定为' + get.translation(trigger.player.judging[0]) + '，是否弃置一枚“忍戒”标记并修改判定结果？<br><br><br><br>';
                                    event.suitshow = [];
                                    event.suitbasic = [];
                                    event.suite = ['spade', 'club', 'heart', 'diamond'];
                                    event.suity = ['♠', '♣', '♥', '♦'];
                                    event.suitn = ['♤', '♧', '♡', '♢'];
                                    for (var i = 0; i < 4; i++) {
                                        if (event.suite[i] != get.suit(trigger.player.judging[0])) {
                                            var right = event.suity[i];
                                            var wrong = event.suite[i];
                                        } else {
                                            var right = event.suitn[i];
                                            var wrong = 'cancel2';
                                            event.suit = event.suite[i];
                                        }
                                        event.suitshow.push(right);
                                        event.suitbasic.push(wrong);
                                    }
                                    player.chooseControl(event.suitshow).set('prompt', str).set('ai',
                                    function() {
                                        //return '取消';
                                        var choose = 'none';
                                        var judging = _status.event.judging;
                                        var trigger = _status.event.getTrigger();
                                        var res1 = trigger.judge(judging);
                                        var list = lib.suit.slice(0);
                                        var attitude = get.attitude(player, trigger.player);
                                        if (attitude == 0) return 0;
                                        var getj = function(suit) {
                                            return trigger.judge({
                                                name: get.name(judging),
                                                nature: get.nature(judging),
                                                suit: suit,
                                                number: get.number(judging),
                                            })
                                        };
                                        list.sort(function(a, b) {
                                            return (getj(b) - getj(a)) * get.sgn(attitude);
                                        });
                                        if ((getj(list[0]) - res1) * attitude > 0) var choose = list[0];
                                        if (choose == 'none' || choose == event.suit) {
                                            var choose = 'cancel2';
                                        }
                                        for (var i = 0; i < 4; i++) {
                                            if (event.suitbasic[i] == choose) {
                                                return event.suitshow[i];
                                            }
                                        }
                                    }).set('judging', trigger.player.judging[0]);
                                    "step 1";
                                    event.control = 'cancel2';
                                    for (var i = 0; i < 4; i++) {
                                        if (event.suitshow[i] == result.control) {
                                            event.control = event.suitbasic[i];
                                        }
                                    }
                                    if (event.control != 'cancel2') {
                                        player.removeMark('ssr_jilue');
                                        player.logSkill('ssr_jilue');
                                        //player.line(trigger.player);
                                        player.popup(event.control + 2);
                                        game.log(player, '将判定结果改为了', '#y' + get.translation(event.control + 2));
                                        trigger.fixedResult = {
                                            suit: event.control,
                                            color: get.color({
                                                suit: event.control
                                            }),
                                        };
                                    }
                                },
                                ai: {
                                    rejudge: true,
                                    tag: {
                                        rejudge: 0.3,
                                    },
                                },
                                sub: true,
                            },
                        },
                        audio: "lianpo",
                        marktext: "忍",
                        frequent: true,
                        priority: 50,
                        trigger: {
                            player: ["useCard", "respond"],
                        },
                        forced: true,
                        filter: function(event, player) {
                            if (player != _status.currentPhase) return false;
                            return event.card && (get.color(event.card) == 'red' || get.color(event.card) == 'black');
                        },
                        content: function() {
                            var skill = 'ssr_jilue_' + get.color(trigger.card);
                            if (!player.hasSkill(skill)) {
                                player.addTempSkill(skill);
                                player.removeMark(skill, player.countMark(skill));
                            }
                            player.addMark(skill, 1);
                            if (player.countMark('ssr_jilue_red') && player.countMark('ssr_jilue_black')) {
                                player.removeMark('ssr_jilue_red');
                                player.removeMark('ssr_jilue_black');
                                player.addMark('ssr_jilue', 1);
                            }
                        },
                        intro: {
                            name: "忍戒",
                            content: "mark",
                        },
                        ai: {
                            maixie: true,
                            "maixie_hp": true,
                        },
                    },
                    "ssr_jiyuan": {
                        trigger: {
                            global: "dying",
                        },
                        audio: "xinfu_jiyuan",
                        filter: function(event, player) {
                            if (event.name == 'dying') return true;
                        },
                        check: function(event, player) {
                            return get.attitude(player, event.player) > 0;
                        },
                        logTarget: "player",
                        content: function() {
                            trigger.player.draw();
                            player.draw();
                        },
                    },
                    "ssr_newjiyuan": {
                        subSkill: {
                            yingzi: {
                                trigger: {
                                    player: 'phaseDrawBegin2'
                                },
                                forced: true,
                                filter: function(event, player) {
                                    return event.num > 0 && !event.numFixed;
                                },
                                priority: 17,
                                content: function() {
                                    trigger.num--;
                                },
                                sub: true,
                            },
                            card: {
                                audio: 'xinfu_jiyuan',
                                check: function(event, player) {
                                    return game.hasPlayer(current =>{
                                        if (current == player || current.countCards('h')) return false;
                                        var evt = event.getl(current);
                                        return evt && evt.hs && evt.hs.length;
                                    });
                                },
                                trigger: {
                                    global: ["loseAfter", "equipAfter", "addJudgeAfter", "gainAfter", "loseAsyncAfter", "addToExpansionAfter"],
                                },
                                filter: function(event, player) {
                                    //if(_status.currentPhase!=player) return false;
                                    if (!player.countCards('h')) return false;
                                    return game.hasPlayer(current =>{
                                        if (current == player || current.countCards('h')) return false;
                                        var evt = event.getl(current);
                                        return evt && evt.hs && evt.hs.length && get.attitude(player, current) > 2;
                                    });
                                },
                                direct: true,
                                content: function() {
                                    'step 0';
                                    var targets = game.filterPlayer(current =>{
                                        if (current == player || current.countCards('h')) return false;
                                        var evt = trigger.getl(current);
                                        return evt && evt.hs && evt.hs.length;
                                    });
                                    event.targets = targets;
                                    'step 1';
                                    var target = event.targets.shift();
                                    event.target = target;
                                    if (!_status.auto && (player == game.me || player.isUnderControl())) game.waitClick(6, false, 100);
                                    player.chooseBool(get.prompt2('ssr_newjiyuan', target)).set('ai', () =>{
                                        if (window.aiClicking) return false;
                                        return get.attitude(_status.event.player, _status.event.getParent().target) > 2;
                                    });
                                    'step 2';
                                    if (!_status.auto && (player == game.me || player.isUnderControl())) game.stopClick();
                                    if (result.bool) {
                                        player.logSkill('ssr_newjiyuan', target);
                                        player.give(player.getCards('h'), target);
                                    }
                                    'step 3';
                                    if (targets.length && player.countCards('h')) event.goto(1);
                                },
                                ai: {
                                    threaten: 0.8,
                                    noh: true,
                                    skillTagFilter: function(player, tag) {
                                        if (tag == 'noh') {
                                            if (player.countCards('h') == 0) return false;
                                        }
                                    },
                                },
                                sub: true,
                            },
                            hp: {
                                audio: 'xinfu_jiyuan',
                                trigger: {
                                    global: ["changeHp"],
                                },
                                check: function(event, player) {
                                    return get.attitude(player, event.player) > 2;
                                },
                                filter: function(event, player) {
                                    //if(event.player.countCards('h')) return false;
                                    if (!player.countCards('h')) return false;
                                    return event.player != player && event.player.getHp(true) <= 1 && event.player.getHp(true) - event.num > 1;
                                },
                                direct: true,
                                content: function() {
                                    'step 0';
                                    event.target = trigger.player;
                                    if (!_status.auto && (player == game.me || player.isUnderControl())) game.waitClick(6, false, 100);
                                    player.chooseBool(get.prompt2('ssr_newjiyuan', trigger.player)).set('ai', () =>{
                                        if (window.aiClicking) return false;
                                        return get.attitude(_status.event.player, _status.event.getParent().target) > 2;
                                    });
                                    'step 1';
                                    if (!_status.auto && (player == game.me || player.isUnderControl())) game.stopClick();
                                    if (result.bool) {
                                        player.logSkill('ssr_newjiyuan', trigger.player);
                                        player.give(player.getCards('h'), trigger.player);
                                    }
                                },
                                ai: {
                                    threaten: 0.8,
                                    noh: true,
                                    skillTagFilter: function(player, tag) {
                                        if (tag == 'noh') {
                                            if (player.countCards('h') == 0) return false;
                                        }
                                    },
                                },
                                sub: true,
                            },
                        },
                        group: ['ssr_newjiyuan_hp', 'ssr_newjiyuan_card', 'ssr_newjiyuan_yingzi'],
                        trigger: {
                            global: 'phaseEnd'
                        },
                        frequent: true,
                        locked: true,
                        audio: 'xinfu_jiyuan',
                        filter: function(event, player) {
                            //if(!player.countCards('h')) return true;
                            var types = ['basic', 'trick', 'equip'];
                            var cards = [];
                            for (var i = 0; i < types.length; i++) {
                                if (!player.countCards('h',
                                function(card) {
                                    return get.type(card, 'trick') == types[i];
                                })) return true;
                            }
                            return false;
                        },
                        content: function() {
                            'step 0';
                            player.showCards(player.getCards('h'));
                            'step 1';
                            var types = ['basic', 'trick', 'equip'];
                            var cards = [];
                            for (var i = 0; i < types.length; i++) {
                                if (player.countCards('h',
                                function(card) {
                                    return get.type(card, 'trick') == types[i];
                                })) continue;
                                var suitcard = get.cardPile(function(card) {
                                    return get.type(card, 'trick') == types[i];
                                });
                                if (suitcard) {
                                    cards.push(suitcard);
                                    break;
                                }
                            }
                            if (cards.length) player.gain(cards, 'draw');
                        },
                    },
                    "ssr_newjijie": {
                        mod: {
                            aiValue: function(player, card, num) {
                                if (get.name(card) != 'shan' && !lib.skill.ssr_newjijie.canViewAs(card, player)) return;
                                var cards = player.getCards('hs',
                                function(card) {
                                    return get.name(card) == 'shan' || lib.skill.ssr_newjijie.canViewAs(card, player);
                                });
                                cards.sort(function(a, b) {
                                    return (get.name(b) == 'shan' ? 1 : 2) - (get.name(a) == 'shan' ? 1 : 2);
                                });
                                var geti = function() {
                                    if (cards.contains(card)) {
                                        return cards.indexOf(card);
                                    }
                                    return cards.length;
                                };
                                if (get.name(card) == 'shan') return Math.min(num, [6, 4, 3][Math.min(geti(), 2)]) * 0.6;
                                return Math.max(num, [6.5, 4, 3][Math.min(geti(), 2)]);
                            },
                            aiUseful: function() {
                                return lib.skill.ssr_newjijie.mod.aiValue.apply(this, arguments);
                            },
                        },
                        locked: false,
                        audio: 'xinfu_jijie',
                        audioname: ['sb_zhenji'],
                        enable: ['chooseToRespond', 'chooseToUse'],
                        derivation: 'fudichouxin',
                        filterCard: function(card, player) {
                            if (!player.storage.ssr_newjijie) return true;
                            return ! player.storage.ssr_newjijie.contains(get.type(card, 'trick'));
                        },
                        viewAs: function(cards, player) {
                            var event = _status.event;
                            if (event && event.type == 'respondShan') {
                                return {
                                    name: 'shan'
                                };
                            } else {
                                return {
                                    name: 'fudichouxin'
                                };
                            }
                        },
                        viewAsFilter: function(player) {
                            if (!player.countCards('hes',
                            function(card) {
                                if (!player.storage.ssr_newjijie) return true;
                                return ! player.storage.ssr_newjijie.contains(get.type(card, 'trick'));
                            })) return false;
                        },
                        filter: function(event, player) {
                            if (!player.countCards('hes',
                            function(card) {
                                if (!player.storage.ssr_newjijie) return true;
                                return ! player.storage.ssr_newjijie.contains(get.type(card, 'trick'));
                            })) return false;
                            return true;
                        },
                        canViewAs: function(card, player) {
                            if (!player.storage.ssr_newjijie) return true;
                            return ! player.storage.ssr_newjijie.contains(get.type(card, 'trick'));
                        },
                        position: 'hes',
                        prompt: '将一张未使用过的类型的牌当【闪】或【釜底抽薪】使用或打出',
                        check: function() {
                            return 1
                        },
                        ai: {
                            order: 3,
                            respondShan: true,
                            skillTagFilter: function(player) {
                                if (!player.countCards('hs',
                                function(card) {
                                    if (!player.storage.ssr_newjijie) return true;
                                    return ! player.storage.ssr_newjijie.contains(get.type(card, 'trick'));
                                })) return false;
                            },
                            effect: {
                                target: function(card, player, target, current) {
                                    if (get.tag(card, 'respondShan') && current < 0) return 0.6;
                                }
                            },
                            result: {
                                target: function(player) {
                                    if (player.countCards('h') <= 1) return 0;
                                    return - 1;
                                },
                                player: function(player) {
                                    if (player.countCards('h') <= 1) return 0;
                                    return 0.5;
                                },
                            },
                        },
                        group: ["ssr_newjijie_reset", "ssr_newjijie_count"],
                        subSkill: {
                            reset: {
                                trigger: {
                                    player: "phaseAfter",
                                },
                                silent: true,
                                content: function() {
                                    delete player.storage.ssr_newjijie;
                                    delete player.storage.ssr_newjijie2;
                                },
                                sub: true,
                                parentskill: "ssr_newjijie",
                                forced: true,
                                popup: false,
                                "_priority": 1,
                            },
                            count: {
                                trigger: {
                                    player: ["useCard", "respond"],
                                },
                                silent: true,
                                filter: function(event) {
                                    return event.skill == 'ssr_newjijie';
                                },
                                content: function() {
                                    player.storage.ssr_newjijie2 = trigger.card;
                                    if (!player.storage.ssr_newjijie) {
                                        player.storage.ssr_newjijie = [];
                                        player.storage.ssr_newjijie_mark = [];
                                    }
                                    for (var i = 0; i < trigger.cards.length; i++) {
                                        player.storage.ssr_newjijie.add(get.type(trigger.cards[i], 'trick'));
                                        var color = get.type(trigger.cards[i], 'trick');
                                        if (!player.storage.ssr_newjijie_mark.contains(color)) {
                                            player.storage.ssr_newjijie_mark.push(color);
                                        }
                                    }
                                    player.storage.ssr_newjijie_mark.sort();
                                    var str = '';
                                    for (var color of player.storage.ssr_newjijie_mark) {
                                        str += get.translation(color).slice(0, 1) + ' ';
                                    };
                                    player.storage.ssr_newjijie_mark2 = '';
                                    player.addMark('ssr_newjijie_mark2', str);
                                    player.addTempSkill('ssr_newjijie_mark', {
                                        player: ['phaseBefore', 'phaseAfter']
                                    });
                                },
                                sub: true,
                                parentskill: "reluanji",
                                forced: true,
                                popup: false,
                                "_priority": 1,
                            },
                            mark: {
                                onremove: function(player) {
                                    player.removeMark('ssr_newjijie_mark2');
                                },
                                sub: true,
                                parentskill: "ssr_newjijie",
                                "_priority": 0,
                            },
                            "mark2": {
                                intro: {
                                    content: function(storage, player, skill) {
                                        var str = '';
                                        for (var color of player.storage.ssr_newjijie_mark) {
                                            str += get.translation(color);
                                        }
                                        return str;
                                    },
                                },
                                sub: true,
                                parentskill: "ssr_newjijie",
                                "_priority": 0,
                            },
                        },
                    },
                    "ssr_jijie": {
                        subSkill: {
                            spade: {
                                sub: true,
                            },
                            club: {
                                sub: true,
                            },
                            diamond: {
                                sub: true,
                            },
                            heart: {
                                sub: true,
                            },
                            forbid: {
                                sub: true,
                            },
                        },
                        usable: 2,
                        enable: "phaseUse",
                        audio: "xinfu_jijie",
                        filter: function(event, player) {
                            return true;
                            //return !player.hasSkill('ssr_jijie_forbid');
                        },
                        content: function() {
                            'step 0';
                            //event.card=ui.cardPile.lastChild;
                            event.card = get.bottomCards()[0];
                            var content = ['牌堆底的一张牌', [event.card]];
                            game.log(player, '观看了牌堆底的一张牌');
                            player.showCards(event.card);
                            player.chooseControl('ok').set('dialog', content);
                            'step 1';
                            if (player.hasSkill('ssr_jijie_' + get.suit(event.card))) {
                                player.addTempSkill('ssr_jijie_forbid');
                            } else {
                                player.addTempSkill('ssr_jijie_' + get.suit(event.card));
                            }
                            player.chooseTarget('选择获得此牌的角色').set('ai',
                            function(target) {
                                var att = get.attitude(_status.event.player, target);
                                if (_status.event.du) {
                                    if (target.hasSkillTag('nodu')) return 0.5;
                                    return - att;
                                }
                                if (att > 0) {
                                    if (_status.event.player != target) att += 2;
                                    return att + Math.max(0, 5 - target.countCards('h'));
                                }
                                return att;
                            }).set('du', event.card.name == 'du').set('same', event.same);
                            'step 2';
                            if (result.bool) {
                                event.target = result.targets[0];
                                player.line(event.target, 'green');
                                player.give(event.card, event.target);
                                var card = event.card;
                                event.
                                continue = true;
                                if (!event.target.hasUseTarget(card)) {
                                    card.fix();
                                    ui.cardPile.insertBefore(card, ui.cardPile.firstChild);
                                    game.updateRoundNumber(); {
                                        if (event && event.finish) {
                                            event.finish();
                                        } else {
                                            return;
                                        }
                                    }
                                }
                            } else ui.cardPile.appendChild(event.card);
                            game.updateRoundNumber();
                            'step 3';
                            if (event.
                            continue) {
                                var card = event.card;
                                var next = event.target.chooseUseTarget(card);
                                if (get.info(card).updateUsable == 'phaseUse') next.addCount = false;
                            }
                        },
                        ai: {
                            order: 7.2,
                            result: {
                                player: 1,
                            },
                        },
                    },
                    "ssr_qicai": {
                        //group:"ssr_qicai_trick",
                        subSkill: {
                            jinchan: {
                                trigger: {
                                    player: "loseAfter",
                                    global: "loseAsyncAfter",
                                },
                                forced: true,
                                cardSkill: true,
                                filter: function(event, player) {
                                    if (event.type != 'discard') return false;
                                    var evt = event.getl(player);
                                    if (!evt || !evt.cards2 || !evt.cards2.length) return false;
                                    for (var i of evt.cards2) {
                                        if (get.name(i) == 'jinchan' && i.name != 'jinchan') return true;
                                    }
                                    return false;
                                },
                                content: function() {
                                    var num = 0,
                                    cards = trigger.getl(player).cards2;
                                    for (var i = 0; i < cards.length; i++) {
                                        if (get.name(cards[i]) == 'jinchan' && cards[i].name != 'jinchan') num++;
                                    }
                                    if (num) {
                                        player.draw(num);
                                    }
                                },
                                "_priority": -50,
                            },
                            trick: {
                                audio: "rejizhi",
                                trigger: {
                                    player: "useCard",
                                },
                                priority: 5,
                                filter: function(event, player) {
                                    if (get.type(event.card) != 'trick') return false;
                                    return true;
                                    //if(get.info(event.card).multitarget) return false;
                                    if (event.targets.length < 2) return false;
                                    return true;
                                },
                                direct: true,
                                derivation: 'jinchan',
                                content: function() {
                                    "step 0";
                                    var evt = _status.event.getTrigger();
                                    player.chooseTarget(get.prompt('ssr_qicai'), [1, game.players.length],
                                    function(card, player, target) {
                                        return ! evt.excluded.contains(target);
                                    }).set('ai',
                                    function(target) {
                                        var trigger = _status.event.getTrigger();
                                        if (game.phaseNumber > game.players.length * 2 && trigger.targets.length >= game.players.length - 1) {
                                            return get.effect(target, trigger.card, trigger.player, _status.event.player);
                                        }
                                        return - 1;
                                    });
                                    "step 1";
                                    event.out = [];
                                    var evt = _status.event.getTrigger();
                                    for (var i = 0; i < game.players.length; i++) {
                                        if (!result.targets.contains(game.players[i])) {
                                            event.out.push(game.players[i]);
                                        }
                                    }
                                    player.logSkill('ssr_qicai', result.targets);
                                    trigger.excluded.addArray(event.out);
                                    player.line(result.targets, 'green');
                                    game.delay();
                                },
                                sub: true,
                            },
                        },
                        locked: true,
                        audio: "rejizhi",
                        trigger: {
                            player: "useCard",
                        },
                        group: ["g_jinchan", "g_jinchan2", "ssr_qicai_jinchan"],
                        forced: true,
                        filter: function(event) {
                            return (get.type(event.card) == 'trick');
                        },
                        content: function() {
                            trigger.nowuxie = true;
                        },
                        ai: {
                            threaten: 1.2,
                        },
                        mod: {
                            selectTarget: function(card, player, range) {
                                var type = get.type(card);
                                var name = get.name(card);
                                if (type == 'trick' && range[1] == -1 && (name != 'wuzhong')) range[1] = Infinity;
                                //if(type=='trick'&&range[1]==1) range[1]=2;
                            },
                            targetInRange: function(card, player, target, now) {
                                var type = get.type(card);
                                if (type == 'trick' || type == 'delay') return true;
                            },
                            cardname: function(card, player) {
                                //var type=lib.card[card.name].type;
                                var source = _status.currentPhase;
                                if (player.countCards('h') == 1 && source && source != player
                                /*&&(type=='trick'||type=='delay')&&card.name!='wuxie'*/
                                ) return 'jinchan';
                            },
                        },
                    },
                    "ssr_jiqiao": {
                        audio: "rejiqiao",
                        unique: true,
                        trigger: {
                            global: ["gameDrawAfter", "phaseBefore"],
                            player: ["phaseZhunbeiBegin", "phaseAfter"],
                        },
                        forced: true,
                        priority: -5,
                        filter: function(event, player) {
                            return ! player.storage.ssr_jiqiao || player.storage.ssr_jiqiao.length < 3;
                        },
                        content: function() {
                            "step 0";
                            player.storage.ssr_jiqiao = game.cardsGotoSpecial(get.cards(3)).cards;
                            player.markSkill('ssr_jiqiao');
                            game.addVideo('storage', player, ['ssr_jiqiao', get.cardsInfo(player.storage.ssr_jiqiao), 'cards']);
                            "step 1";
                            player.chooseCard('选择任意张手牌与“辎”交换', [1, Math.min(player.countCards('h'), player.storage.ssr_jiqiao.length)]).set('promptx', [player.storage.ssr_jiqiao]).ai = function(card) {
                                var val = get.value(card);
                                if (val < 0) return 10;
                                if (player.skipList.contains('phaseUse')) {
                                    return val;
                                }
                                return - val;
                            };
                            "step 2";
                            if (result.bool) {
                                player.logSkill('ssr_jiqiao');
                                player.lose(result.cards, ui.special, 'toStorage');
                                player.storage.ssr_jiqiao = player.storage.ssr_jiqiao.concat(result.cards);
                                player.syncStorage('ssr_jiqiao');
                                event.num = result.cards.length;
                                event.choose = result.cards;
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            "step 3";
                            player.chooseCardButton(player.storage.ssr_jiqiao, '选择' + event.num + '张牌作为手牌', event.num, true).set('filterButton',
                            function(button) {
                                return ! event.choose.contains(button.link);
                            }).ai = function(button) {
                                var val = get.value(button.link);
                                if (val < 0) return - 10;
                                if (player.skipList.contains('phaseUse')) {
                                    return - val;
                                }
                                return val;
                            }
                            if (player == game.me && !event.isMine()) {
                                game.delay(0.5);
                            }
                            "step 4";
                            player.gain(result.links, 'fromStorage');
                            for (var i = 0; i < result.links.length; i++) {
                                player.storage.ssr_jiqiao.remove(result.links[i]);
                            }
                            player.syncStorage('ssr_jiqiao');
                            if (player == game.me && _status.auto) {
                                game.delay(0.5);
                            }
                        },
                        marktext: "辎",
                        mark: true,
                        intro: {
                            name: "木牛流马",
                            onunmark: function(storage, player) {
                                if (storage && storage.length) {
                                    player.$throw(storage, 1000);
                                    game.cardsDiscard(storage);
                                    game.log(storage, '被置入了弃牌堆');
                                    storage.length = 0;
                                }
                            },
                            mark: function(dialog, content, player) {
                                if (content && content.length) {
                                    if (!_status.auto && (player == game.me || player.isUnderControl())) {
                                        dialog.addAuto(content);
                                    } else {
                                        return '共有' + get.cnNumber(content.length) + '张“辎”';
                                    }
                                }
                            },
                            content: function(content, player) {
                                if (content && content.length) {
                                    if (!_status.auto && (player == game.me || player.isUnderControl())) {
                                        return get.translation(content);
                                    }
                                    return '共有' + get.cnNumber(content.length) + '张“辎”';
                                }
                            },
                        },
                        global: ["ssr_jiqiao_muniu"],
                        subSkill: {
                            forbid: {
                                sub: true,
                            },
                            muniu: {
                                enable: "phaseUse",
                                filter: function(event, player) {
                                    var num = game.countPlayer(function(current) {
                                        return current.hasSkill('ssr_jiqiao') && current.storage.ssr_jiqiao && current.storage.ssr_jiqiao.length > 0;
                                    });
                                    return num > 0;
                                },
                                usable: 1,
                                content: function() {
                                    "step 0";
                                    if (!player.hasSkill('ssr_jiqiao_forbid')) player.addTempSkill('ssr_jiqiao_forbid');
                                    var num = game.countPlayer(function(current) {
                                        return current.hasSkill('ssr_jiqiao');
                                    });
                                    if (num == 1) {
                                        if (player.hasSkill('ssr_jiqiao')) {
                                            event.him = player;
                                            event.goto(4);
                                        } else {
                                            for (var i = 0; i < game.players.length && typeof(event.him) == 'undefined'; i++) {
                                                if (game.players[i].hasSkill('ssr_jiqiao')) {
                                                    event.him = game.players[i];
                                                }
                                            }
                                            if (typeof(event.him) != 'undefined') {
                                                event.goto(2);
                                            } else {
                                                {
                                                    if (event && event.finish) {
                                                        event.finish();
                                                    } else {
                                                        return;
                                                    }
                                                }
                                            }
                                        }
                                    } else {
                                        player.chooseTarget('机巧：请选择请求使用的“辎”？', get.prompt2('ssr_jiqiao'), 1,
                                        function(card, player, target) {
                                            return target.hasSkill('ssr_jiqiao');
                                        },
                                        function(target) {
                                            return get.attitude(player, target);
                                        });
                                    }
                                    "step 1";
                                    if (result.bool) {
                                        event.him = result.targets[0];
                                        if (event.him == player) {
                                            event.goto(4);
                                        } else {
                                            event.goto(2);
                                        }
                                    } else {
                                        {
                                            if (event && event.finish) {
                                                event.finish();
                                            } else {
                                                return;
                                            }
                                        }
                                    }
                                    "step 2";
                                    event.him.chooseControl('确定', '取消',
                                    function() {
                                        if (get.attitude(event.him, player) > 1) return '确定';
                                        return '取消';
                                    }).set('prompt', '机巧：是否允许' + get.translation(player.name) + '使用你的“辎”？');
                                    "step 3";
                                    if (result.control == '确定') {
                                        event.goto(4);
                                    } else {
                                        event.him.say('不准你用！');
                                        game.log(event.him, '拒绝了', player, '使用“辎”的申请'); {
                                            if (event && event.finish) {
                                                event.finish();
                                            } else {
                                                return;
                                            }
                                        }
                                    }
                                    "step 4";
                                    //alert(event.him.name);
                                    event.first = event.him.storage.ssr_jiqiao;
                                    player.draw();
                                    player.chooseCard('选择任意张手牌与“辎”交换', [1, Math.min(player.countCards('h'), event.him.storage.ssr_jiqiao.length)]).set('promptx', [event.him.storage.ssr_jiqiao]).ai = function(card) {
                                        var val = get.value(card);
                                        if (get.type(card) == 'trick' || get.type(card) == 'delay') {
                                            if (player.hasSkill('ssr_jinnang')) {
                                                return val - 5;
                                            } else {
                                                return val + 3;

                                            }
                                        }
                                        if (val < 0) return 10;
                                        if (player.skipList.contains('phaseUse')) {
                                            return val;
                                        }
                                        return - val;
                                    };
                                    "step 5";
                                    if (result.bool) {
                                        game.log(event.him, '通过了', player, '使用“辎”的申请');
                                        player.logSkill('ssr_jiqiao');
                                        player.lose(result.cards, ui.special, 'toStorage');
                                        event.him.storage.ssr_jiqiao = event.him.storage.ssr_jiqiao.concat(result.cards);
                                        event.him.syncStorage('ssr_jiqiao');
                                        event.num = result.cards.length;
                                        event.choose = result.cards;
                                    } else {
                                        {
                                            if (event && event.finish) {
                                                event.finish();
                                            } else {
                                                return;
                                            }
                                        }
                                    }
                                    "step 6";
                                    player.chooseCardButton(event.him.storage.ssr_jiqiao, '选择' + event.num + '张牌作为手牌', event.num, true).set('filterButton',
                                    function(button) {
                                        return ! event.choose.contains(button.link);
                                    }).ai = function(button) {
                                        var val = get.useful(button.link);
                                        if (get.type(card) == 'trick' || get.type(card) == 'delay') {
                                            if (player.hasSkill('ssr_jinnang')) {
                                                return val + 5;
                                            } else {
                                                return val - 3;

                                            }
                                        }
                                        if (val < 0) return - 10;
                                        if (player.skipList.contains('phaseUse')) {
                                            return - val;
                                        }
                                        return val;
                                    }
                                    if (player == game.me && !event.isMine()) {
                                        game.delay(0.5);
                                    }
                                    "step 7";
                                    player.gain(result.links, 'fromStorage');
                                    for (var i = 0; i < result.links.length; i++) {
                                        event.him.storage.ssr_jiqiao.remove(result.links[i]);
                                    }
                                    event.him.syncStorage('ssr_jiqiao');
                                    if (player == game.me && _status.auto) {
                                        game.delay(0.5);
                                    }
                                    event.second = event.him.storage.ssr_jiqiao;
                                    if (event.him != player) event.him.chooseControl('ok').set('dialog', ['木牛流马（使用前）', event.first, '木牛流马（使用后）', event.second]);
                                },
                                ai: {
                                    order: 11,
                                    result: {
                                        player: function(player) {
                                            var num = game.countPlayer(function(current) {
                                                return current.hasSkill('ssr_jiqiao') && get.attitude(player, current) >= 0;
                                            });
                                            if (player.hasSkill('ssr_jiqiao_forbid') || num < 1) {
                                                return - 1;
                                            } else {
                                                return 1;
                                            }
                                        },
                                    },
                                },
                                sub: true,
                            },
                        },
                    },
                    "ssr_jizhi": {
                        audio: "jizhi",
                        derivation: ["ssr_jizhi_huoji", "ssr_jizhi_bazhen", "ssr_jizhi_kanpo"],
                        group: ["ssr_jizhi_huoji", "ssr_jizhi_bazhen", "ssr_jizhi_kanpo"],
                        subSkill: {
                            kanpo: {
                                audio: "kanpo",
                                enable: "chooseToUse",
                                filterCard: function(card) {
                                    var typeb = get.type(card);
                                    var colorb = get.color(card);
                                    if (ui.selected.cards.length == 0) {
                                        return typeb == 'trick' || typeb == 'delay' || colorb == 'black';
                                    } else {
                                        var typea = get.type(ui.selected.cards[0]);
                                        var colora = get.color(ui.selected.cards[0]);
                                        if ((typea == 'trick' || typea == 'delay') && colorb == 'black') return true;
                                        if (colora == 'black' && (typeb == 'trick' || typeb == 'delay')) return true;
                                        return false;
                                    }
                                },
                                onuse: function(result, player) {
                                    player.draw();
                                },
                                viewAsFilter: function(player) {
                                    var a = player.countCards('hs', {
                                        color: 'black'
                                    });
                                    var b = player.countCards('hs', {
                                        type: 'trick'
                                    }) + player.countCards('hs', {
                                        type: 'delay'
                                    });
                                    var c = player.countCards('hs', {
                                        type: 'trick',
                                        color: 'black'
                                    }) + player.countCards('hs', {
                                        type: 'delay',
                                        color: 'black'
                                    });
                                    return ((a - c) * (b - c) > 0 || c * (a - c) > 0 || c * (b - c) > 0);
                                },
                                viewAs: {
                                    name: "wuxie",
                                },
                                selectCard: 2,
                                position: "hs",
                                prompt: "将一张黑色手牌当无懈可击使用",
                                check: function(card) {
                                    var tri = _status.event.getTrigger();
                                    if (tri && tri.card && tri.card.name == 'chiling') return - 1;
                                    return 8 - get.value(card)
                                },
                                threaten: 1.2,
                                ai: {
                                    basic: {
                                        useful: [6, 4],
                                        value: [6, 4],
                                    },
                                    result: {
                                        player: 1,
                                    },
                                    expose: 0.2,
                                },
                                sub: true,
                            },
                            bazhen: {
                                audio: "bazhen",
                                equipSkill: true,
                                noHidden: true,
                                inherit: "bagua_skill",
                                filter: function(event, player) {
                                    if (!lib.skill.bagua_skill.filter(event, player)) return false;
                                    if (!player.isEmpty(2)) return false;
                                    return (player.countCards('hs', {
                                        type: 'trick'
                                    }) || player.countCards('hs', {
                                        type: 'delay'
                                    }));
                                },
                                ai: {
                                    respondShan: true,
                                    effect: {
                                        target: function(card, player, target) {
                                            if (player == target && get.subtype(card) == 'equip2') {
                                                if (get.equipValue(card) <= 7.5) return 0;
                                            }
                                            if (!target.isEmpty(2)) return;
                                            return lib.skill.bagua_skill.ai.effect.target.apply(this, arguments);
                                        },
                                    },
                                },
                                sub: true,
                                trigger: {
                                    player: ["chooseToRespondBegin", "chooseToUseBegin"],
                                },
                                direct: true,
                                check: function(event, player) {
                                    if (event && (event.ai || event.ai1)) {
                                        var ai = event.ai || event.ai1;
                                        var tmp = _status.event;
                                        _status.event = event;
                                        var result = ai({
                                            name: 'shan'
                                        },
                                        _status.event.player, event);
                                        _status.event = tmp;
                                        return result > 0;
                                    }
                                    return true;
                                },
                                content: function() {
                                    "step 0";
                                    var next = player.chooseToRespond(get.prompt2('ssr_jizhi_bazhen'));
                                    next.set('filterCard',
                                    function(card) {
                                        return get.type(card) == 'trick' || get.type(card) == 'delay';
                                    });
                                    next.set('check',
                                    function(card) {
                                        return 8 - get.value(card);
                                    });
                                    'step 1';
                                    if (!result.bool) {
                                        {
                                            if (event && event.finish) {
                                                event.finish();
                                            } else {
                                                return;
                                            }
                                        }
                                        return;
                                    }
                                    player.draw();
                                    trigger.bagua_skill = true;
                                    player.judge('bagua',
                                    function(card) {
                                        return (get.color(card) == 'red') ? 1.5 : -0.5
                                    });
                                    "step 2";
                                    if (result.judge > 0) {
                                        trigger.untrigger();
                                        trigger.set('responded', true);
                                        trigger.result = {
                                            bool: true,
                                            card: {
                                                name: 'shan',
                                                isCard: true
                                            }
                                        }
                                    }
                                },
                            },
                            huoji: {
                                audio: "huoji",
                                enable: "phaseUse",
                                filterCard: function(card) {
                                    var typeb = get.type(card);
                                    var colorb = get.color(card);
                                    if (ui.selected.cards.length == 0) {
                                        return typeb == 'trick' || typeb == 'delay' || colorb == 'red';
                                    } else {
                                        var typea = get.type(ui.selected.cards[0]);
                                        var colora = get.color(ui.selected.cards[0]);
                                        if ((typea == 'trick' || typea == 'delay') && colorb == 'red') return true;
                                        if (colora == 'red' && (typeb == 'trick' || typeb == 'delay')) return true;
                                        return false;
                                    }
                                },
                                onuse: function(result, player) {
                                    player.draw();
                                },
                                selectCard: 2,
                                viewAs: {
                                    name: "huogong",
                                    nature: "fire",
                                },
                                viewAsFilter: function(player) {
                                    var a = player.countCards('hs', {
                                        color: 'red'
                                    });
                                    var b = player.countCards('hs', {
                                        type: 'trick'
                                    }) + player.countCards('hs', {
                                        type: 'delay'
                                    });
                                    var c = player.countCards('hs', {
                                        type: 'trick',
                                        color: 'red'
                                    }) + player.countCards('hs', {
                                        type: 'delay',
                                        color: 'red'
                                    });
                                    return ((a - c) * (b - c) > 0 || c * (a - c) > 0 || c * (b - c) > 0);
                                },
                                position: "hs",
                                prompt: "将一张红色牌当火攻使用",
                                check: function(card) {
                                    var player = _status.currentPhase;
                                    if (player.needsToDiscard() > 0) {
                                        return 6 - get.value(card);
                                    }
                                    return 3 - get.value(card)
                                },
                                ai: {
                                    fireAttack: true,
                                    basic: {
                                        order: 4,
                                        value: [3, 1],
                                        useful: 1,
                                    },
                                    wuxie: function(target, card, player, current, state) {
                                        if (get.attitude(current, player) >= 0 && state > 0) return false;
                                    },
                                    result: {
                                        player: function(player) {
                                            var nh = player.countCards('h');
                                            if (nh <= player.hp && nh <= 4 && _status.event.name == 'chooseToUse') {
                                                if (typeof _status.event.filterCard == 'function' && _status.event.filterCard({
                                                    name: 'huogong'
                                                },
                                                player, _status.event)) {
                                                    return - 10;
                                                }
                                                if (_status.event.skill) {
                                                    var viewAs = get.info(_status.event.skill).viewAs;
                                                    if (viewAs == 'huogong') return - 10;
                                                    if (viewAs && viewAs.name == 'huogong') return - 10;
                                                }
                                            }
                                            return 0;
                                        },
                                        target: function(player, target) {
                                            if (target.hasSkill('huogong2') || target.countCards('h') == 0) return 0;
                                            if (player.countCards('h') <= 1) return 0;
                                            if (target == player) {
                                                if (typeof _status.event.filterCard == 'function' && _status.event.filterCard({
                                                    name: 'huogong'
                                                },
                                                player, _status.event)) {
                                                    return - 1.5;
                                                }
                                                if (_status.event.skill) {
                                                    var viewAs = get.info(_status.event.skill).viewAs;
                                                    if (viewAs == 'huogong') return - 1.5;
                                                    if (viewAs && viewAs.name == 'huogong') return - 1.5;
                                                }
                                                return 0;
                                            }
                                            return - 1.5;
                                        },
                                    },
                                    tag: {
                                        damage: 1,
                                        fireDamage: 1,
                                        natureDamage: 1,
                                        norepeat: 1,
                                    },
                                },
                                sub: true,
                            },
                        },
                    },
                    "ssr_newweimu": {
                        subSkill: {
                            turned: {
                                group: "undist",
                                charlotte: true,
                                forced: true,
                                popup: false,
                                mark: true,
                                marktext: "帷幕",
                                intro: {
                                    name: "隐匿幕后",
                                    content: "不计入距离和座次的计算",
                                },
                                sub: true,
                                parentskill: "ssr_newweimu",
                                "_priority": 0,
                            },
                            du: {
                                mod: {
                                    cardname: function(card, player) {
                                        if (game.hasPlayer(function(current) {
                                            return current.hasSkill('ssr_newweimu') && current.isTurnedOver();
                                        }) && (!(player.hasSkill('ssr_newweimu') && player.isTurnedOver())) && ['tao', 'jiu'].contains(card.name)) return 'du';
                                    },
                                },
                                charlotte: true,
                                sub: true,
                            },
                            dajie: {
                                audio: 'wansha',
                                enable: "chooseToUse",
                                filterCard: function(card) {
                                    return get.color(card) == 'black';
                                },
                                position: "hes",
                                viewAs: {
                                    name: "chenhuodajie",
                                },
                                viewAsFilter: function(player) {
                                    if (!player.isTurnedOver()) return false;
                                    if (!player.countCards('hes', {
                                        color: 'black'
                                    })) return false;
                                    return true;
                                },
                                prompt: "将一张黑色的牌当【趁火打劫】使用",
                                check: function(card) {
                                    return 6 - get.value(card);
                                },
                                ai: {
                                    basic: {
                                        order: 1,
                                        useful: 6,
                                        value: 6,
                                    },
                                    result: {
                                        target: -1,
                                    },
                                    tag: {
                                        loseCard: 1,
                                    },
                                },
                                "_priority": 0,
                            },
                        },
                        trigger: {
                            player: "turnOverAfter",
                        },
                        global: ['ssr_newweimu_du', 'g_du', 'g_du_give', 'g_chenhuodajie'],
                        group: 'ssr_newweimu_dajie',
                        forced: true,
                        direct: true,
                        priority: 3,
                        derivation: 'ssr_du',
                        audio: "weimu",
                        content: function() {
                            'step 0';
                            if (player.isTurnedOver()) {
                                player.logSkill(event.name);
                                player.addSkill('ssr_newweimu_turned');
                            } else if (player.hasSkill('ssr_newweimu_turned')) {
                                player.removeSkill('ssr_newweimu_turned');
                            }
                        },
                        init: function(player, skill) {
                            lib.skill.g_du_give.filter = function(event, player) {
                                return false;
                            };
                            lib.translate.du_info = '①当此牌正面向上离开你的手牌区，或作为你的拼点牌而亮出时，你失去1点体力。<span style="text-decoration:line-through;">②当你因摸牌或分发起始手牌而获得【毒】后，你可展示之并交给其他角色（不触发〖毒①〗）。</span>';
                            //优化对卡牌viewAs的判断
                            lib.skill.g_du = {
                                trigger: {
                                    player: ['loseAfter', 'compare'],
                                    global: ['equipAfter', 'addJudgeAfter', 'gainAfter', 'loseAsyncAfter', 'addToExpansionAfter'],
                                    target: 'compare',
                                },
                                cardSkill: true,
                                filter: function(event, player, name) {
                                    if (name == 'compare') {
                                        if (player == event.player) {
                                            if (event.iwhile > 0) return false;
                                            return get.name(event.card1, player) == 'du';
                                        }
                                        return get.name(event.card2, player) == 'du';
                                    }
                                    if (event.name != 'equip' && event.name != 'addJudge' && !event.visible) return false;
                                    var evt = event.getl(player);
                                    if (!evt || !evt.hs || !evt.hs.filter(function(i) {
                                        return get.name(i, player) == 'du';
                                    }).length) return false;
                                    for (var i of lib.skill.g_du.whiteListFilter) {
                                        if (i(event, player)) return false;
                                    }
                                    return true;
                                },
                                whiteListFilter: [(event) =>event.getParent().name == 'g_du_give', (event) =>event.getParent(3).name == 'guaguliaodu', ],
                                forced: true,
                                popup: false,
                                content: function() {
                                    'step 0';
                                    if (trigger.delay === false) game.delayx();
                                    'step 1';
                                    game.log(player, '触发了', '#g【毒】', '的效果');
                                    var num = 1;
                                    if (typeof trigger.getl == 'function') {
                                        num = trigger.getl(player).hs.filter(function(i) {
                                            return get.name(i, player) == 'du';
                                        }).length;
                                    }
                                    player.loseHp(num).type = 'du';
                                },
                            };
                        },
                    },
                    "ssr_du": {},
                    "ssr_guimou": {
                        trigger: {
                            player: "phaseUseBegin",
                        },
                        filter: function(event, player) {
                            return game.hasPlayer(function(target) {
                                if (!target.countCards('h')) return false;
                                return game.hasPlayer(function(current) {
                                    if (!current.countCards('h')) return false;
                                    return target.canCompare(current);
                                });
                            });
                        },
                        priority: 5,
                        audio: 'jianshu',
                        direct: true,
                        content: function() {
                            "step 0";
                            var check;
                            var i, num = game.countPlayer(function(current) {
                                return current != player && current.countCards('h') && get.attitude(player, current) <= 0;
                            });
                            check = (num >= 2);
                            player.chooseTarget(get.prompt2('ssr_guimou'), 2,
                            function(card, player, target) {
                                if (!target.countCards('h')) return false;
                                if (!ui.selected.targets.length) {
                                    return game.hasPlayer(function(current) {
                                        if (!current.countCards('h')) return false;
                                        return target.canCompare(current);
                                    });
                                } else {
                                    return ui.selected.targets[0].canCompare(target);
                                }
                            },
                            function(target) {
                                if (!_status.event.aicheck) return 0;
                                var att = get.attitude(_status.event.player, target);
                                if (target.hasSkill('tuntian')) return att / 10;
                                return 1 - att;
                            }).set('aicheck', check).set('targetprompt', ["发起者", "拼点目标"]);
                            "step 1";
                            if (result.bool) {
                                player.logSkill('ssr_guimou', result.targets);
                                //player.gainMultiple(result.targets);
                                player.turnOver();
                                event.targets = result.targets;
                                event.targets[0].chooseToCompare(event.targets[1]);
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            "step 2";
                            if (result.bool) {
                                event.win = event.targets[0];
                                event.lose = event.targets[1];
                            } else if (result.tie) {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                                //result.targets[0].loseHp()
                                //result.targets[1].loseHp()
                            } else {
                                event.win = event.targets[1];
                                event.lose = event.targets[0];
                            }
                            "step 3";
                            event.lose.damage(event.win);
                            //"step 4";
                            //player.gainPlayerCard(event.win, 'he');
                        },
                    },
                    "ssr_newluanwu": {
                        subSkill: {
                            zhendu: {
                                charlotte: true,
                                sub: true,
                                group: 'zhendu',
                                trigger: {
                                    global: "roundStart",
                                    //global:"phaseBefore",
                                },
                                //firstDo:true,
                                priority: 25,
                                forced: true,
                                silent: true,
                                direct: true,
                                filter: function(event, player) {
                                    return game.ssr_newluanwu_round != game.roundNumber;
                                },
                                content: function() {
                                    player.removeSkill('ssr_newluanwu_zhendu');
                                },
                                mark: true,
                                marktext: '鸩毒',
                                intro: {
                                    name: '鸩毒',
                                },
                            },
                        },
                        //audio: 'luanwu',
                        audio: "jxlianpo",
                        unique: true,
                        trigger: {
                            //global:"roundStart",
                            global: "phaseBefore",
                        },
                        firstDo: true,
                        priority: 110,
                        mark: true,
                        limited: true,
                        skillAnimation: true,
                        animationColor: 'gray',
                        init: function(player) {
                            //player.storage.niepan=false;
                            lib.skill.ssr_newluanwu.subSkill.zhendu.intro.content = get.translation('zhendu_info');
                            //优化鸩毒的ai与效果
                            lib.skill.zhendu.content = function() {
                                "step 0";
                                var nono = (Math.abs(get.attitude(player, trigger.player)) < 3);
                                if (player == trigger.player || get.damageEffect(trigger.player, player, player) <= 0 || !trigger.player.hasUseTarget({
                                    name: 'jiu'
                                },
                                null, true)) {
                                    nono = true
                                } else if (trigger.player.hp > 2) {
                                    nono = true;
                                } else if (trigger.player.hp > 1 && player.countCards('h') < 3 && (trigger.player.canUse('sha', player) && !player.countCards('h', 'shan') && trigger.player.countCards('h') >= 3)) {
                                    nono = true;
                                }
                                if (player.hasSkill('ssr_newluanwu_zhendu') && get.damageEffect(trigger.player, player, player) > 0) nono = false;
                                var next = player.chooseToDiscard(get.prompt2('zhendu', trigger.player));
                                next.set('ai',
                                function(card) {
                                    if (_status.event.nono) return - 1;
                                    return 7 - get.useful(card);
                                });
                                next.set('logSkill', ['zhendu', trigger.player]);
                                next.set('nono', nono);
                                next.setHiddenSkill('zhendu');
                                "step 1";
                                if (result.bool) {
                                    trigger.player.chooseUseTarget({
                                        name: 'jiu'
                                    },
                                    true, 'noTargetDelay', 'nodelayx');
                                } else {
                                    event.finish();
                                }
                                "step 2";
                                if (
                                /*result.bool&&*/
                                trigger.player != player) trigger.player.damage();
                            };
                        },
                        filter: function(event, player) {
                            //if(player.storage.niepan) return false;
                            //return player.storage.ssr_newluanwu_round!=game.roundNumber;
                            var isRound = false;
                            if (!event.skill) {
                                isRound = _status.roundSkipped;
                                if (_status.isRoundFilter) {
                                    isRound = _status.isRoundFilter(trigger, player);
                                } else if (_status.seatNumSettled) {
                                    var seatNum = event.player.getSeatNum();
                                    if (seatNum != 0) {
                                        if (typeof _status.lastSeatNum != 'number' || seatNum < _status.lastSeatNum) isRound = true;
                                        //_status.lastSeatNum=seatNum;
                                    }
                                } else if (event.player == _status.roundStart) isRound = true;
                            }
                            if (isRound) return true;
                        },
                        getJump: function(name, tra, info) {
                            lib.card['luanwu_' + name] = {
                                fullskin: true,
                                image: 'ext:祖安武将/card/luanwu_' + name + '.png',
                                opacity: 1,
                                textShadow: 'black 0 0 2px',
                            };
                            lib.translate['luanwu_' + name] = tra;
                            lib.translate['luanwu_' + name + '_info'] = info;
                            return game.createCard({
                                name: 'luanwu_' + name,
                                number: "乱",
                                suit: "舞"
                            });
                        },
                        direct: true,
                        derivation: 'zhendu',
                        content: function() {
                            'step 0';
                            //player.storage.ssr_newluanwu_round=game.roundNumber;
                            if (!_status.auto && (player == game.me || player.isUnderControl())) game.waitClick(Math.min(game.countPlayer(), 10), false, 100);
                            player.chooseBool(get.prompt2('ssr_newluanwu')).set('ai',
                            function() {
                                if (window.aiClicking) return false;
                                return lib.skill.ssr_newluanwu.ai.result.player(player) > 0;
                            });
                            'step 1';
                            if (!_status.auto && (player == game.me || player.isUnderControl())) game.stopClick();
                            if (result.bool) {
                                player.logSkill('ssr_newluanwu', game.filterPlayer());
                                game.ssr_newluanwu_round = game.roundNumber + 1;
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            'step 2';
                            player.awakenSkill('ssr_newluanwu');
                            event.players = game.filterPlayer();
                            event.cholist = [];
                            var cholist = {
                                'yin': '翻面',
                                'jue': '摸牌',
                                'du': '鸩毒',
                            };
                            var tanlist = {
                                'yin': '将武将牌翻面',
                                'jue': '摸两张牌',
                                'du': '本轮获得〖鸩毒〗',
                            };
                            event.cards = [];
                            for (var n in cholist) {
                                event.cards.push(lib.skill.ssr_newluanwu.getJump(n, cholist[n], tanlist[n]));
                            }
                            'step 3';
                            event.parentPlayer = event.players.shift();
                            event.parentPlayer.chooseCardButton('乱武：请选择其中两项', true, event.cards, 2).set('ai',
                            function(button) {
                                return Math.random();
                            });
                            'step 4';
                            if (result.bool) event.cholist.push({
                                player: event.parentPlayer,
                                choice: result.links,
                            });
                            'step 5';
                            if (event.players.length) {
                                event.goto(3);
                            } else {
                                event.num = 0;
                            }
                            'step 6';
                            //for(var i=0;i<event.cholist.length;i++) {
                            var i = event.num;
                            var him = event.cholist[i].player;
                            var cho = event.cholist[i].choice;
                            //alert(get.translation(him)+':'+get.translation(cho));
                            for (var c = 0; c < cho.length; c++) {
                                var type = cho[c].name.slice(7);
                                if (type == 'yin') {
                                    him.turnOver();
                                } else if (type == 'jue') {
                                    him.draw(2);
                                } else if (type == 'du') {
                                    //him.addTempSkill('zhendu',{global:'roundStart'});
                                    him.addTempSkill('ssr_newluanwu_zhendu', {
                                        player: 'die'
                                    });
                                }
                            }
                            //}
                            'step 7';
                            event.num++;
                            'step 8';
                            if (event.num < event.cholist.length) {
                                event.goto(6);
                            }
                        },
                        ai: {
                            order: 1,
                            result: {
                                player: function(player) {
                                    if (lib.config.mode == 'identity' && game.zhu.isZhu && player.identity == 'fan') {
                                        if (game.zhu.hp == 1 && game.zhu.countCards('h') <= 2) return 1;
                                    }
                                    var num = 0;
                                    var players = game.filterPlayer();
                                    for (var i = 0; i < players.length; i++) {
                                        var att = get.attitude(player, players[i]);
                                        if (att > 0) att = 1;
                                        if (att < 0) att = -1;
                                        if (players[i] != player && players[i].hp <= 3) {
                                            if (players[i].countCards('h') == 0) num += att / players[i].hp;
                                            else if (players[i].countCards('h') == 1) num += att / 2 / players[i].hp;
                                            else if (players[i].countCards('h') == 2) num += att / 4 / players[i].hp;
                                        }
                                        if (players[i].hp == 1) num += att * 1.5;
                                    }
                                    if (player.hp == 1) {
                                        return num;
                                    }
                                    if (player.hp == 2) {
                                        return - game.players.length / 4 + num;
                                    }
                                    return - game.players.length / 3 + num;
                                }
                            },
                        },
                        intro: {
                            content: 'limited'
                        }
                    },
                    "ssr_weimu": {
                        group: ["ssr_weimu_defend", "ssr_weimu_lose"],
                        subSkill: {
                            lose: {
                                forced: true,
                                silent: true,
                                priority: -18,
                                trigger: {
                                    player: "useCardToPlayered",
                                },
                                filter: function(event, player) {
                                    if (! ['trick', 'delay'].contains(get.type(event.card))) return false;
                                    return player != event.target && get.color(event.card) == 'black' && event.target.hp >= player.hp;
                                },
                                content: function() {
                                    trigger.target.loseHp();
                                },
                                ai: {
                                    effect: {
                                        player: function(card, player, target) {
                                            //alert(get.translation(target.name));
                                            if (['trick', 'delay'].contains(get.type(card)) && get.color(card) == 'black' && get.attitude(target) > 0) {
                                                return - 2;
                                            } else {
                                                return 2;
                                            }
                                        },
                                    },
                                },
                                sub: true,
                            },
                            defend: {
                                trigger: {
                                    global: "useCard1",
                                },
                                audio: "weimu",
                                forced: true,
                                firstDo: true,
                                filter: function(event, player, card) {
                                    if (get.color(event.card) != 'black') return false;
                                    return event.card.name == 'nanman' && player != event.player || event.card.name == 'wanjian' && player != event.player || event.card.name == 'taoyuan' && player.hp < player.maxHp || event.card.name == 'wugu';
                                },
                                content: function() {},
                                sub: true,
                            },
                        },
                        locked: true,
                        audio: "shenmou",
                        trigger: {
                            player: "useCard",
                        },
                        forced: true,
                        filter: function(event) {
                            return ((get.type(event.card) == 'trick' || get.type(event.card) == 'delay') && get.color(event.card) == 'black');
                        },
                        content: function() {
                            trigger.nowuxie = true;
                            trigger.directHit.addArray(game.players);
                        },
                        ai: {
                            threaten: 1.4,
                            noautowuxie: true,
                        },
                        mod: {
                            targetInRange: function(card, player, target, now) {
                                var type = get.type(card);
                                if ((type == 'trick' || type == 'delay') && get.color(card) == 'black') return true;
                            },
                            targetEnabled: function(card) {
                                if ((get.type(card) == 'trick' || get.type(card) == 'delay') && get.color(card) == 'black') return false;
                            },
                        },
                    },
                    "ssr_zhenlue": {
                        audio: "nsyice",
                        unique: true,
                        enable: "phaseUse",
                        limited: true,
                        skillAnimation: "epic",
                        animationColor: "thunder",
                        content: function() {
                            "step 0";
                            player.awakenSkill('ssr_zhenlue');
                            event.num = 4;
                            event.cardpile = [];
                            'step 1';
                            event.num--;
                            "step 2";
                            event.card = get.cardPile(function(card) {
                                for (var a = 0; a < event.cardpile.length; a++) {
                                    if (get.name(card) == get.name(event.cardpile[a])) return false;
                                }
                                if (!player.hasUseTarget(card)) return false;
                                if (get.type(card) == 'trick' && get.color(card) == 'black') return true;
                                return false;
                            });
                            if (!event.card) {
                                if (event.cardpile.length > 0) {
                                    event.goto(4);
                                } else {
                                    {
                                        if (event && event.finish) {
                                            event.finish();
                                        } else {
                                            return;
                                        }
                                    }
                                    return;
                                }
                            }
                            player.showCards([event.card]);
                            "step 3";
                            event.cardpile.push(event.card);
                            if (event.num > 0) event.goto(1);
                            'step 4';
                            player.chooseControl('ok').set('dialog', ['文和乱武', event.cardpile]);
                            'step 5';
                            player.gain(event.cardpile, 'gain2');
                        },
                        ai: {
                            order: 13,
                            result: {
                                player: function(player) {
                                    if (lib.config.mode == 'identity' && game.zhu.isZhu && player.identity == 'fan') {
                                        if (game.zhu.hp == 1 && game.zhu.countCards('h') <= 2) return 1;
                                    }
                                    var num = 0;
                                    var players = game.filterPlayer();
                                    for (var i = 0; i < players.length; i++) {
                                        var att = get.attitude(player, players[i]);
                                        if (att > 0) att = 1;
                                        if (att < 0) att = -1;
                                        if (players[i] != player && players[i].hp <= 3) {
                                            if (players[i].countCards('h') == 0) num += att / players[i].hp;
                                            else if (players[i].countCards('h') == 1) num += att / 2 / players[i].hp;
                                            else if (players[i].countCards('h') == 2) num += att / 4 / players[i].hp;
                                        }
                                        if (players[i].hp == 1) num += att * 1.5;
                                    }
                                    if (player.hp == 1) {
                                        return - num;
                                    }
                                    if (player.hp == 2) {
                                        return - game.players.length / 4 - num;
                                    }
                                    return - game.players.length / 3 - num;
                                },
                            },
                        },
                        mark: true,
                        intro: {
                            content: "limited",
                        },
                        init: function(player, skill) {
                            player.storage[skill] = false;
                        },
                    },
                    "ssr_juesha": {
                        subSkill: {
                            kill: {
                                mark: true,
                                marktext: "殺",
                                intro: {
                                    content: "你不能使用【酒】或【桃】直到回合结束",
                                },
                                mod: {
                                    cardSavable: function(card, player) {
                                        if (card.name == 'tao' || card.name == 'jiu') return false;
                                    },
                                    cardEnabled: function(card, player) {
                                        if (card.name == 'tao' || card.name == 'jiu') return false;
                                    },
                                },
                                sub: true,
                            },
                        },
                        audio: "luanwu",
                        unique: true,
                        enable: "phaseUse",
                        limited: true,
                        skillAnimation: "epic",
                        animationColor: "thunder",
                        filterTarget: function(card, player, target) {
                            return target != player;
                        },
                        selectTarget: -1,
                        multitarget: true,
                        multiline: true,
                        content: function() {
                            "step 0";
                            player.awakenSkill('ssr_juesha');
                            event.current = player.next;
                            event.currented = [];
                            "step 1";
                            event.currented.push(event.current);
                            event.current.animate('target');
                            /*var lose=false;
					        if(event.current.countCards('hs')>0) {
					            var cards=event.current.getCards('hs');
					            var dis=[];
					            var forbid=['tao','jiu','du'];
					            for(var i=0;i<cards.length;i++) {
					                if(forbid.contains(cards[i].name)) {
					                    dis.push(cards[i]);
					                }
					            }
					            if(dis.length>0) {
					                event.current.discard(dis);
					                lose=true;
					            }
					        }
					        if(!lose) event.current.loseHp();*/
                            event.current.addTempSkill('ssr_juesha_kill');
                            "step 2";
                            event.current = event.current.next;
                            if (event.current != player && !event.currented.contains(event.current)) {
                                game.delay(0.5);
                                event.goto(1);
                            }
                        },
                        ai: {
                            order: 15,
                            result: {
                                player: function(player) {
                                    if (lib.config.mode == 'identity' && game.zhu.isZhu && player.identity == 'fan') {
                                        if (game.zhu.hp == 1 && game.zhu.countCards('h') <= 2) return 1;
                                    }
                                    var num = 0;
                                    var players = game.filterPlayer();
                                    for (var i = 0; i < players.length; i++) {
                                        var att = get.attitude(player, players[i]);
                                        if (att > 0) att = 1;
                                        if (att < 0) att = -1;
                                        if (players[i] != player && players[i].hp <= 3) {
                                            if (players[i].countCards('h') == 0) num += att / players[i].hp;
                                            else if (players[i].countCards('h') == 1) num += att / 2 / players[i].hp;
                                            else if (players[i].countCards('h') == 2) num += att / 4 / players[i].hp;
                                        }
                                        if (players[i].hp == 1) num += att * 1.5;
                                    }
                                    if (player.hp == 1) {
                                        return - num;
                                    }
                                    if (player.hp == 2) {
                                        return - game.players.length / 4 - num;
                                    }
                                    return - game.players.length / 3 - num;
                                },
                            },
                        },
                        mark: true,
                        intro: {
                            content: "limited",
                        },
                        init: function(player, skill) {
                            player.storage[skill] = false;
                        },
                    },
                    "ssr_newbeiming": {
                        subSkill: {
                            draw: {
                                trigger: {
                                    player: ['phaseUseBefore'],
                                },
                                direct: true,
                                init: function(player) {
                                    player.storage.ssr_newbeiming_cho = [];
                                },
                                content: function() {
                                    "step 0";
                                    if (!_status.auto && (player == game.me || player.isUnderControl())) game.waitClick(4, false, 100);
                                    player.chooseTarget(get.prompt('ssr_newbeiming'), '令任意名其他角色获得〖余音〗直到回合结束？', [1, game.players.length - 1],
                                    function(card, player, target) {
                                        return player != target;
                                    },
                                    function(target) {
                                        if (window.aiClicking) {
                                            if (player.storage.ssr_newbeiming_cho.length < 1) {
                                                return 0;
                                            } else {
                                                if (player.storage.ssr_newbeiming_cho.contains(target)) {
                                                    return 2;
                                                }
                                            }
                                        }
                                        if (get.attitude(player, target) > 1) return 2;
                                        return 0;
                                    });
                                    "step 1";
                                    if (!_status.auto && (player == game.me || player.isUnderControl())) game.stopClick();
                                    player.storage.ssr_newbeiming_cho = [];
                                    if (result.bool) {
                                        player.logSkill(event.name, result.targets);
                                        for (var i = 0; i < result.targets.length; i++) {
                                            var target = result.targets[i];
                                            target.addTempSkill('ssr_newbeiming_yin');
                                            player.storage.ssr_newbeiming_cho.push(target);
                                        }
                                    }
                                    game.delay();
                                },
                                sub: true,
                            },
                            yin: {
                                mark: true,
                                marktext: "余音",
                                intro: {
                                    name: "余音绕梁",
                                    content: "<li>因〖悲鸣〗而弃牌时摸等量的牌。",
                                },
                                sub: true,
                            },
                        },
                        group: "ssr_newbeiming_draw",
                        audio: "chenqing",
                        trigger: {
                            player: ['useCard', 'respond'],
                        },
                        priority: -2,
                        forced: true,
                        filter: function(event, player) {
                            return event.card && get.suit(event.card);
                        },
                        content: function() {
                            var them = game.filterPlayer(function(current) {
                                current.line(current.next);
                                return current != player;
                            });
                            //player.line(them,'grey');
                            var number = get.number(trigger.card);
                            var suit = get.suit(trigger.card);
                            for (var i = 0; i < them.length; i++) {
                                if (!them[i].countCards('hej') > 0) continue;
                                var hands = them[i].getCards('hej');
                                var cards = [];
                                for (var h = 0; h < hands.length; h++) {
                                    if (get.suit(hands[h]) == suit) {
                                        //if(get.number(hands[h])==number) {
                                        cards.push(hands[h]);
                                    }
                                }
                                if (cards.length > 0) {
                                    them[i].discard(cards.randomGet());
                                    if (them[i].hasSkill('ssr_newbeiming_yin')) {
                                        them[i].draw();
                                    }
                                }
                            }
                        },
                        ai: {
                            threaten: 1.3,
                        },
                    },
                    "ssr_nianlei": {
                        subSkill: {
                            rec: {
                                charlotte: true,
                                forced: true,
                                silent: true,
                                intro: {
                                    name: "捻泪琵琶",
                                    content: "标识此项时你摸一张牌，你的手牌上限加一。",
                                },
                                mark: true,
                                marktext: "陈情",
                                init: function(player) {
                                    'step 0';
                                    if (player.hasSkill('ssr_nianlei_dam')) player.removeSkill('ssr_nianlei_dam');
                                    player.showCards(lib.skill.ssr_nianlei.getMuse(true, 1));
                                    'step 1';
                                    game.log(player, '标识了「陈情」');
                                    'step 2';
                                    player.draw();
                                },
                                mod: {
                                    maxHandcard:function(player,num){
                                        return num+1;
                                    },
                                },
                                sub: true,
                            },
                            dam: {
                                charlotte: true,
                                forced: true,
                                silent: true,
                                intro: {
                                    name: "捻泪琵琶",
                                    content: "标识此项时你弃一张牌，你的手牌上限减一。",
                                },
                                mark: true,
                                marktext: "殇哀",
                                init: function(player) {
                                    'step 0';
                                    if (player.hasSkill('ssr_nianlei_rec')) player.removeSkill('ssr_nianlei_rec');
                                    player.showCards(lib.skill.ssr_nianlei.getMuse(false, 1));
                                    'step 1';
                                    game.log(player, '标识了「殇哀」');
                                    'step 2';
                                    if (player.countCards('he')) player.discard(player.getCards('he').randomGet());
                                },
                                mod: {
                                    maxHandcard:function(player,num){
                                        return num-1;
                                    },
                                },
                                sub: true,
                            },
                            enter: {
                                trigger: {
                                    global: "phaseBefore",
                                    player: "enterGame",
                                },
                                forced: true,
                                locked: false,
                                priority: 21,
                                filter: function(event, player) {
                                    return (event.name != 'phase' || game.phaseNumber == 0);
                                },
                                content: function() {
                                    player.addSkill('ssr_nianlei_rec');
                                },
                                sub: true,
                            },
                            sha: {
                                trigger: {
                                    global: "useCardToTargeted",
                                },
                                audio: 'beige',
                                forced: true,
                                priority: 3,
                                filter: function(event, player) {
                                    return event.card && event.card.name == 'sha' && event.player != player && event.target.hasSkill('ssr_nianlei_rec');
                                },
                                content: function() {
                                    'step 0';
                                    if (trigger.player.hasSkill('ssr_nianlei_dam')) trigger.player.removeSkill('ssr_nianlei_dam');
                                    'step 1';
                                    trigger.player.addSkill('ssr_nianlei_dam');
                                },
                                sub: true,
                            },
                        },
                        getMuse: function(yins, num) {
                            var yuansu = ['gong', 'shang', 'jue', 'zhi', 'yu'];
                            var yuansuname = ['宫', '商', '角', '徵', '羽'];
                            var yunlv = [];
                            var yin = yins ? 'huan': 'bei';
                            for (var i = 0; i < yuansu.length; i++) {
                                var name = yuansu[i];
                                lib.card['yunlv_' + name] = {
                                    fullskin: true,
                                    image: 'ext:祖安武将/card/yunlv_' + yin + '_' + name + '.png',
                                    opacity: 1,
                                    textShadow: 'black 0 0 2px',
                                };
                                lib.translate['yunlv_' + name] = yuansuname[i] + '音';
                                lib.translate['yunlv_' + name + '_info'] = "<li>灵枢邪客";
                                yunlv.push(game.createCard({
                                    name: 'yunlv_' + name,
                                    number: "韵",
                                    suit: "律"
                                }));
                            }
                            if (!num) return yunlv.randomGet();
                            return yunlv.randomGets(num);
                        },
                        group: ['ssr_nianlei_enter', 'ssr_nianlei_sha'],
                        audio: 'beige',
                        enable: 'phaseUse',
                        usable: 1,
                        discard: false,
                        lose: false,
                        delay: 0,
                        filter: function(event, player) {
                            return player.countCards('h');
                        },
                        filterCard: function(card) {
                            return true;
                        },
                        check: function(card) {
                            return 9 - get.value(card);
                        },
                        filterTarget: function(card, player, target) {
                            return target != player;
                        },
                        content: function() {
                            'step 0';
                            player.give(cards, target);
                            if (target.hasSkill('ssr_nianlei_rec')) target.removeSkill('ssr_nianlei_rec');
                            //player.$give(lib.skill.ssr_nianlei.getMuse(true),target);
                            'step 1';
                            target.addSkill('ssr_nianlei_rec');
                        },
                        ai: {
                            order: 11,
                            result: {
                                target: function(player, target) {
                                    if (target.hp == 1 && target.countCards('he') < 4) return 2;
                                    if (target.hasSkill('ssr_nianlei_dam')) return 1.5;
                                    if (target.hasSkill('ssr_nianlei_rec')) return 0.5;
                                    return 1;
                                }
                            },
                            threaten: 1.7,
                        },
                    },
                    "ssr_newduanxian": {
                        audio: 'duanchang',
                        unique: true,
                        enable: 'phaseUse',
                        limited: true,
                        skillAnimation: 'epic',
                        animationColor: 'gray',
                        filterTarget: function(card, player, target) {
                            return true;
                        },
                        filterCard: function(card, player) {
                            return true;
                        },
                        check: function(card) {
                            return 9 - get.value(card);
                        },
                        filter: function(event, player) {
                            return player.countCards('he') >= 2;
                        },
                        position: "he",
                        selectCard: 2,
                        selectTarget: -1,
                        multiline: true,
                        delay: false,
                        content: function() {
                            "step 0";
                            if (target == player) player.awakenSkill('ssr_newduanxian');
                            if (target.hasSkill('ssr_nianlei_rec')) {
                                target.removeSkill('ssr_nianlei_rec');
                                target.addSkill('ssr_nianlei_rec');
                                event.goto(1);
                            } else if (target.hasSkill('ssr_nianlei_dam')) {
                                target.removeSkill('ssr_nianlei_dam');
                                target.addSkill('ssr_nianlei_dam');
                                event.goto(2);
                            } else {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                            "step 1";
                            if (target.isAlive()) target.recover(2); {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                            "step 2";
                            if (target.isAlive()) target.loseHp(2); {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                        },
                        ai: {
                            order: 10,
                            result: {
                                player: function(player) {
                                    if (player.getHp() < 2) return - 2;
                                    return - 2 * game.countPlayer();
                                },
                                target: function(player, target) {
                                    if (target.hasSkill('ssr_nianlei_dam') && target.countCards('he')) return - 3;
                                    if (target.hasSkill('ssr_nianlei_dam')) return - 2;
                                    if (target.hasSkill('ssr_nianlei_rec') && target.getDamagedHp()) return 3;
                                    if (target.hasSkill('ssr_nianlei_rec')) return 1;
                                    return 0;
                                },
                            }
                        }
                    },
                    "ssr_beiming": {
                        filterTarget: function(card, player, target) {
                            return player != target;
                        },
                        usable: 1,
                        selectTarget: -1,
                        multitarget: true,
                        audio: "chenqing",
                        enable: "phaseUse",
                        prompt: "出牌阶段限一次，你可以指定所有其他角色为目标，然后选择一项：悲愤，手牌数大于你的角色弃置两张手牌，小于你的角色摸两张牌；胡笳，手牌数大于你的角色摸两张牌，小于你的角色弃置两张手牌。",
                        content: function() {
                            "step 0";
                            for (var i = 0; i < game.players.length; i++) {
                                var him = game.players[i];
                                if (him.countCards('h') > player.countCards('h')) {
                                    him.$damagepop('多');
                                } else {
                                    him.$damagepop('少');
                                }
                            }
                            player.chooseControl('悲愤', '胡笳',
                            function() {
                                var basic = 0;
                                var pla = player.countCards('h');
                                for (var i = 0; i < targets.length; i++) {
                                    var tar = targets[i].countCards('h');
                                    if (tar > pla) {
                                        if (get.attitude(player, targets[i]) > 0) {
                                            basic--;
                                        } else {
                                            basic++;
                                        }
                                    } else if (tar < pla) {
                                        if (get.attitude(player, targets[i]) > 0) {
                                            basic++;
                                        } else {
                                            basic--;
                                        }
                                    }
                                }
                                if (basic >= 0) {
                                    return '悲愤';
                                } else {
                                    return '胡笳';
                                }
                            }).set('prompt', '请选择〖悲鸣〗的曲调：<li>悲愤，手牌数大于你的角色弃置两张手牌，小于你的角色摸两张牌<li>胡笳，手牌数大于你的角色摸两张牌，小于你的角色弃置两张手牌');
                            'step 1';
                            game.log(player, '选择了：', result.control);
                            var pla = player.countCards('h');
                            for (var i = 0; i < targets.length; i++) {
                                var tar = targets[i].countCards('h');
                                if (tar > pla) {
                                    if (result.control == '悲愤') {
                                        targets[i].chooseToDiscard(2, 'h', true);
                                    } else {
                                        targets[i].draw(2);
                                    }
                                } else if (tar < pla) {
                                    if (result.control == '悲愤') {
                                        targets[i].draw(2);
                                    } else {
                                        targets[i].chooseToDiscard(2, 'h', true);
                                    }
                                }
                            }
                        },
                        ai: {
                            order: 5,
                            expose: 0.2,
                            result: {
                                player: function(player) {
                                    return 4;
                                },
                            },
                        },
                    },
                    "ssr_duanxian": {
                        subSkill: {
                            yayue: {
                                trigger: {
                                    player: "drawAfter",
                                },
                                filter: function(event, player) {
                                    var evt = event.getParent('phaseDraw');
                                    if (evt && evt.name == 'phaseDraw') return false;
                                    return true;
                                },
                                forced: true,
                                //mark:true,
                                marktext: "欢",
                                priority: 11,
                                content: function() {
                                    'step 0';
                                    player.addMark('ssr_duanxian_yayue');
                                    'step 1';
                                    if (player.countMark('ssr_duanxian_yayue') >= 4) {
                                        var card = player.storage.ssr_duanxian_yin.randomGet();
                                        player.$gain2(card);
                                        player.removeMark('ssr_duanxian_yayue', 4);
                                        player.recover();
                                    }
                                },
                                intro: {
                                    name: "思念",
                                    content: "mark",
                                },
                                sub: true,
                            },
                            aiyue: {
                                trigger: {
                                    player: "discardAfter",
                                },
                                filter: function(event, player) {
                                    //if(event.type!='discard'||!event.cards2) return false;
                                    var evt = event.getParent('phaseDiscard');
                                    if (evt && evt.name == 'phaseDiscard') return false;
                                    return true;
                                },
                                forced: true,
                                //mark:true,
                                marktext: "悲",
                                priority: 11,
                                content: function() {
                                    'step 0';
                                    player.addMark('ssr_duanxian_aiyue');
                                    'step 1';
                                    if (player.countMark('ssr_duanxian_aiyue') >= 4) {
                                        var card = player.storage.ssr_duanxian_yin.randomGet();
                                        player.$gain2(card);
                                        player.removeMark('ssr_duanxian_aiyue', 4);
                                        player.loseHp();
                                    }
                                },
                                intro: {
                                    name: "思念",
                                    content: "mark",
                                },
                                sub: true,
                            },
                            gong: {
                                group: 'ssr_duanxian_yayue',
                                mark: true,
                                marktext: "宫调",
                                priority: 11,
                                intro: {
                                    name: "思念",
                                    content: "弃一张黑牌，可以减少受到伤害",
                                },
                                locked: true,
                                audio: "beige",
                                trigger: {
                                    player: "damageBegin",
                                },
                                frequent: true,
                                filter: function(event) {
                                    return event.num > 0;
                                },
                                content: function() {
                                    'step 0';
                                    player.chooseCard(1, 'he', {
                                        color: 'black'
                                    },
                                    '宫调：是否弃置一张黑牌，然后使伤害值减一？').set('check',
                                    function(card) {
                                        return 9 - get.value(card);
                                    });
                                    'step 1';
                                    if (result.bool) {
                                        player.discard(result.cards);
                                        trigger.num--;
                                    }
                                },
                                sub: true,
                            },
                            zhi: {
                                group: 'ssr_duanxian_yayue',
                                mark: true,
                                marktext: "徵调",
                                priority: 11,
                                intro: {
                                    name: "欢喜",
                                    content: "弃一张黑牌，可以增加回复体力",
                                },
                                locked: true,
                                audio: "beige",
                                trigger: {
                                    player: "recoverBegin",
                                },
                                frequent: true,
                                filter: function(event) {
                                    return event.num > 0;
                                },
                                content: function() {
                                    'step 0';
                                    event.num = player.hp + trigger.num;
                                    player.chooseCard(1, 'he', {
                                        color: 'black'
                                    },
                                    '徵调：是否弃置一张黑牌，然后使回复值加一？').set('check',
                                    function(card) {
                                        if (player.hp + event.num < player.maxHp) {
                                            return 9 - get.value(card);
                                        } else {
                                            return - 1;
                                        }
                                    });
                                    'step 1';
                                    if (result.bool) {
                                        player.discard(result.cards);
                                        trigger.num++;
                                    }
                                },
                                sub: true,
                            },
                            yu: {
                                group: 'ssr_duanxian_aiyue',
                                mark: true,
                                marktext: "羽调",
                                priority: 11,
                                intro: {
                                    name: "惊恐",
                                    content: "弃一张红牌，否则增加受到伤害",
                                },
                                locked: true,
                                audio: "beige",
                                trigger: {
                                    player: "damageBegin",
                                },
                                forced: true,
                                filter: function(event) {
                                    return event.num > 0;
                                },
                                content: function() {
                                    'step 0';
                                    player.chooseCard(1, 'he', {
                                        color: 'red'
                                    },
                                    '羽调：弃置一张红牌，否则使受到的伤害值减加一').set('check',
                                    function(card) {
                                        return 9 - get.value(card);
                                    });
                                    'step 1';
                                    if (result.bool) {
                                        player.discard(result.cards);
                                    } else {
                                        trigger.num++;
                                    }
                                },
                                sub: true,
                            },
                            shang: {
                                group: 'ssr_duanxian_aiyue',
                                mark: true,
                                marktext: "商调",
                                priority: 11,
                                intro: {
                                    name: "悲痛",
                                    content: "弃一张红牌，否则减少回复体力",
                                },
                                locked: true,
                                audio: "beige",
                                trigger: {
                                    player: "recoverBegin",
                                },
                                forced: true,
                                filter: function(event) {
                                    return event.num > 0;
                                },
                                content: function() {
                                    'step 0';
                                    player.chooseCard(1, 'he', {
                                        color: 'red'
                                    },
                                    '商调：弃置一张红牌，否则使体力回复值减一').set('check',
                                    function(card) {
                                        return 9 - get.value(card);
                                    });
                                    'step 1';
                                    if (result.bool) {
                                        player.discard(result.cards);
                                    } else {
                                        trigger.num--;
                                    }
                                },
                                sub: true,
                            },
                        },
                        audio: "mozhi",
                        unique: true,
                        enable: "phaseUse",
                        mark: true,
                        skillAnimation: true,
                        animationColor: "gray",
                        limited: true,
                        init: function(player) {
                            player.storage.ssr_duanxian = false;
                        },
                        filter: function(event, player) {
                            if (player.storage.ssr_duanxian) return false;
                            return true;
                        },
                        filterTarget: function(card, player, target) {
                            return target != player;
                        },
                        content: function() {
                            'step 0';
                            player.awakenSkill('ssr_duanxian');
                            player.storage.ssr_duanxian = true;
                            var tips = ["〖雅乐〗<br>摸牌阶段外，该角色每次摸牌后，其获得一枚“欢”，当其武将牌上存在四枚“欢”时，其回复一点体力。<li>宫调：弃一张黑牌，可以减少受到伤害<li>徵调：弃一张黑牌，可以增加回复体力", "〖哀乐〗<br>弃牌阶段外，该角色每次弃牌后，其获得一枚“悲”，当其武将牌上存在四枚“悲”时，其失去一点体力。<li>羽调：弃一张红牌，否则增加受到伤害<li>商调：弃一张红牌，否则减少回复体力", ];
                            player.chooseControl('雅乐', '哀乐',
                            function() {
                                if (get.attitude(player, target) > 0) {
                                    return '雅乐';
                                } else {
                                    return '哀乐';
                                }
                            }).set('choiceList', tips).set('prompt', '请选择乐曲类型<br>');
                            'step 1';
                            if (result.control == '雅乐') {
                                event.skills = ['gong', 'zhi'].randomGet();
                                event.yin = 'huan';
                            } else {
                                event.skills = ['yu', 'shang'].randomGet();
                                event.yin = 'bei';
                            }
                            event.num = 3;
                            event.yuansu = ['gong', 'shang', 'jue', 'zhi', 'yu'];
                            event.yuansuname = ['宫', '商', '角', '徵', '羽'];
                            event.yunlv = [];
                            for (var i = 0; i < event.yuansu.length; i++) {
                                var name = event.yuansu[i];
                                lib.card['yunlv_' + name] = {
                                    fullskin: true,
                                    image: 'ext:祖安武将/card/yunlv_' + event.yin + '_' + name + '.png',
                                    opacity: 1,
                                    textShadow: 'black 0 0 2px',
                                };
                                lib.translate['yunlv_' + name] = event.yuansuname[i] + '音';
                                lib.translate['yunlv_' + name + '_info'] = "<li>灵枢邪客";
                                event.yunlv.push(game.createCard({
                                    name: 'yunlv_' + name,
                                    number: "韵",
                                    suit: "律"
                                }));
                            }
                            target.storage.ssr_duanxian_yin = event.yunlv;
                            'step 2';
                            event.num--;
                            var card = event.yunlv.randomGet();
                            player.$give(card, target);
                            event.yunlv.remove(card);
                            'step 3';
                            game.delay();
                            if (event.num > 0) event.goto(2);
                            'step 4';
                            target.addSkill('ssr_duanxian_' + event.skills);
                        },
                        ai: {
                            expose: 0.3,
                            order: 13,
                            result: {
                                target: function(player, target) {
                                    var att = get.attitude(player, target);
                                    if (att > -2 && att < 2) return 0;
                                    return att;
                                },
                            },
                        },
                        intro: {
                            content: "limited",
                        },
                    },
                    "ssr_juenian": {
                        derivation: "fengyin",
                        audio: "duanchang",
                        trigger: {
                            player: "die",
                        },
                        forceDie: true,
                        skillAnimation: true,
                        animationColor: "gray",
                        filter: function(event) {
                            return event.source && event.source.isIn();
                        },
                        check: function(event, player) {
                            return (get.attitude(player, event.source) <= -2);
                        },
                        content: function() {
                            'step 0';
                            trigger.source.addSkill('fengyin');
                            trigger.source.loseHp();
                        },
                        logTarget: "source",
                        ai: {
                            threaten: function(player, target) {
                                if (target.hp == 1) return 0.2;
                                return 1.4;
                            },
                            effect: {
                                target: function(card, player, target, current) {
                                    if (!target.hasFriend()) return;
                                    if (target.hp <= 1 && get.tag(card, 'damage')) return [1, 0, 0, -2];
                                },
                            },
                        },
                    },
                    "ssr_newrende": {
                        subSkill: {
                            sha: {
                                mod: {
                                    playerEnabled: function(card, player, target, now) {
                                        if (get.tag(card, 'damage') && target.hasSkill('ssr_newrende')) return false;
                                    },
                                },
                                sub: true,
                            },
                            used: {
                                sub: true,
                            },
                        },
                        audio: "sbrende",
                        usable: 2,
                        enable: "phaseUse",
                        filterCard: true,
                        selectCard: 1,
                        discard: false,
                        lose: false,
                        delay: 0,
                        filter: function(event, player) {
                            return player.countCards('h') > 0;
                        },
                        filterTarget: function(card, player, target) {
                            return player != target && !target.hasSkill('ssr_newrende_used');
                        },
                        content: function() {
                            'step 0';
                            player.give(cards, target);
                            //target.addTempSkill('ssr_newrende_used');
                            target.chooseControl('以礼相待', '背信弃义',
                            function() {
                                if (get.attitude(target, player) >= 0 || player.isFriendOf(target) || (get.attitude(target, player) <= 0 && player.hp >= player.maxHp) || Math.random() * target.maxHp > target.hp || Math.random() < 0.15 || target.identity == 'zhu' && target.hp * 2 + target.countCards('he') < player.hp * 2 + player.countCards('he') + 1) {
                                    return '以礼相待';
                                } else {
                                    return '背信弃义';
                                }
                            }).set('prompt', '仁德：请选择以礼相待或背信弃义。').set('choiceList', ['以礼相待：令' + get.translation(player) + '恢复一点体力，且直到其回合结束，你不能对其使用带伤害标签的卡牌。', '背信弃义：视为' + get.translation(player) + '对你使用一张不计次数的【杀】。', ]);
                            'step 1';
                            game.log(target, '选择了', result.control);
                            if (result.control == '以礼相待') {
                                player.recover();
                                target.addTempSkill('ssr_newrende_sha', {
                                    player: 'phaseEnd'
                                });
                            } else {
                                player.useCard({
                                    name: 'sha'
                                },
                                target, false);
                            }
                        },
                        check: function(card) {
                            if (ui.selected.cards.length > 1) return 0;
                            if (ui.selected.cards.length && ui.selected.cards[0].name == 'du') return 0;
                            if (!ui.selected.cards.length && card.name == 'du') return 20;
                            var player = get.owner(card);
                            var num = 0;
                            var evt2 = _status.event.getParent();
                            var num = 0;
                            player.getHistory('lose',
                            function(evt) {
                                if (evt.getParent().skill == 'rende' && evt.getParent(3) == evt2) num += evt.cards.length;
                            });
                            if (player.hp == player.maxHp || num > 1 || player.countCards('h') <= 1) {
                                if (ui.selected.cards.length) {
                                    return - 1;
                                }
                                var players = game.filterPlayer();
                                for (var i = 0; i < players.length; i++) {
                                    if (players[i].hasSkill('haoshi') && !players[i].isTurnedOver() && !players[i].hasJudge('lebu') && get.attitude(player, players[i]) >= 3 && get.attitude(players[i], player) >= 3) {
                                        return 11 - get.value(card);
                                    }
                                }
                                if (player.countCards('h') > player.hp) return 10 - get.value(card);
                                if (player.countCards('h') > 2) return 6 - get.value(card);
                                return - 1;
                            }
                            return 10 - get.value(card);
                        },
                        ai: {
                            order: function(skill, player) {
                                if (player.hp < player.maxHp && player.countCards('h') > 1) {
                                    return 10;
                                }
                                return 1;
                            },
                            result: {
                                target: function(player, target) {
                                    if (target.hasSkillTag('nogain')) return 0;
                                    if (ui.selected.cards.length && ui.selected.cards[0].name == 'du') {
                                        if (target.hasSkillTag('nodu')) return 0;
                                        return - 10;
                                    }
                                    if (! (ui.selected.cards.length && get.value(ui.selected.cards[0]) > 9)) {
                                        if (get.attitude(player, target) < 0 && player.hp < player.maxHp) return - 2;
                                    }
                                    if (target.hasJudge('lebu')) return 0;
                                    var nh = target.countCards('h');
                                    var np = player.countCards('h');
                                    if (player.hp == player.maxHp || player.countCards('h') <= 1) {
                                        if (nh >= np - 1 && np <= player.hp && !target.hasSkill('haoshi')) return 0;
                                    }
                                    var ssx = target.hasSkill('ssr_jieyin') ? 2 : 0;
                                    return Math.max(1, 5 - nh) + ssx;
                                },
                            },
                            effect: {
                                target: function(card, player, target) {
                                    if (player == target && get.type(card) == 'equip') {
                                        if (player.countCards('e', {
                                            subtype: get.subtype(card)
                                        })) {
                                            var players = game.filterPlayer();
                                            for (var i = 0; i < players.length; i++) {
                                                if (players[i] != player && get.attitude(player, players[i]) > 0) {
                                                    return 0;
                                                }
                                            }
                                        }
                                    }
                                },
                            },
                            threaten: 0.8,
                        },
                        "_priority": 0,
                    },
                    "ssr_rende": {
                        subSkill: {
                            clear: {
                                silent: true,
                                trigger: {
                                    player: "phaseBegin",
                                },
                                forced: true,
                                content: function() {
                                    "step 0";
                                    player.removeMark('ssr_rende', player.countMark('ssr_rende'));
                                },
                                sub: true,
                                popup: false,
                            },
                        },
                        marktext: "仁",
                        intro: {
                            content: function(storage, player, skill) {
                                var num = player.countMark('ssr_rende');
                                var str = '<li>你因〖仁德〗给出了第 ' + num + ' 张牌';
                                if (num == -1) var str = str + '<li>你已发动了来自〖仁德〗的【桃园结义】';
                                return str;
                            },
                        },
                        mod: {
                            selectTarget: function(card, player, range) {
                                if (card.name == 'taoyuan') range[1] = Infinity;
                            },
                        },
                        audio: "rende",
                        enable: "phaseUse",
                        filterCard: true,
                        selectCard: [1, Infinity],
                        discard: false,
                        prepare: "give2",
                        filterTarget: function(card, player, target) {
                            return player != target;
                        },
                        filter: function(event, player) {
                            return player.countCards('h') > 0;
                        },
                        check: function(card) {
                            if (ui.selected.cards.length > 1) return 0;
                            if (ui.selected.cards.length && ui.selected.cards[0].name == 'du') return 0;
                            if (!ui.selected.cards.length && card.name == 'du') return 20;
                            var player = get.owner(card);
                            if (player.storage.ssr_rende < 0 || player.countCards('h') <= 1) {
                                if (ui.selected.cards.length) {
                                    return - 1;
                                }
                                var players = game.filterPlayer();
                                for (var i = 0; i < players.length; i++) {
                                    if (players[i].hasSkill('haoshi') && !players[i].isTurnedOver() && !players[i].hasJudge('lebu') && get.attitude(player, players[i]) >= 3 && get.attitude(players[i], player) >= 3) {
                                        return 11 - get.value(card);
                                    }
                                }
                                if (player.needsToDiscard() > 0) return 10 - get.value(card);
                                if (player.countCards('h') > 1) return 6 - get.value(card);
                                return - 1;
                            }
                            return 10 - get.value(card);
                        },
                        content: function() {
                            'step 0';
                            target.gain(cards, player, 'giveAuto');
                            player.addMark('ssr_rende', cards.length);
                            'step 1';
                            var num = player.countMark('ssr_rende');
                            if (num > 2) {
                                player.removeMark('ssr_rende', 3);
                                result.targets = game.players;
                                result.bool = true;
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            'step 2';
                            if (result.bool) {
                                var target = result.targets;
                                player.chooseUseTarget('taoyuan', target, '仁德：请选择使用【桃园结义】的目标，否则你回复两点体力').set('ai',
                                function(target) {
                                    //var player=_status.event.player;
                                    var num = game.countPlayer(function(current) {
                                        return current.hp < current.maxHp && get.attitude(player, current) > 0;
                                    });
                                    if ((num >= 2 && player.hp > 2) || player.hp >= player.maxHp) {
                                        return get.attitude(player, target);
                                    }
                                    return - 1;
                                });
                                result.bool = false;
                            }
                            'step 3';
                            if (!result.bool) {
                                player.recover(2);
                            }
                            result.bool = false;
                            event.goto(1);
                        },
                        ai: {
                            order: function(skill, player) {
                                if (game.hasPlayer(function(current) {
                                    return get.attitude(player, current) > 0 && current.maxHp > current.hp;
                                }) && player.storage.ssr_rende + player.countCards('h') >= 2 && player.storage.ssr_rende < 3) {
                                    return 10;
                                }
                                return 1;
                            },
                            result: {
                                target: function(player, target) {
                                    if (target.hasSkillTag('nogain')) return 0;
                                    if (ui.selected.cards.length && ui.selected.cards[0].name == 'du') {
                                        if (target.hasSkillTag('nodu')) return 0;
                                        return - 10;
                                    }
                                    if (target.hasJudge('lebu')) return 0;
                                    var nh = target.countCards('h');
                                    var np = player.countCards('h');
                                    if (!game.hasPlayer(function(current) {
                                        return get.attitude(player, current) > 0 && current.maxHp > current.hp;
                                    }) || player.storage.ssr_rende < 0 || player.countCards('h') <= 1) {
                                        if (nh >= np - 1 && np <= player.hp && !target.hasSkill('haoshi')) return 0;
                                    }
                                    return Math.max(1, 5 - nh);
                                },
                            },
                            effect: {
                                target: function(card, player, target) {
                                    if (player == target && get.type(card) == 'equip') {
                                        if (player.countCards('e', {
                                            subtype: get.subtype(card)
                                        })) {
                                            var players = game.filterPlayer();
                                            for (var i = 0; i < players.length; i++) {
                                                if (players[i] != player && get.attitude(player, players[i]) > 0) {
                                                    return 0;
                                                }
                                            }
                                        }
                                    }
                                },
                            },
                            threaten: 0.8,
                        },
                    },
                    "ssr_shichou": {
                        subSkill: {
                            spade: {
                                trigger: {
                                    global: ["phaseBefore", "die"],
                                },
                                filter: function(event, player) {
                                    return event.player == player.storage.ssr_shichou_spade;
                                },
                                charlotte: true,
                                forced: true,
                                silent: true,
                                intro: {
                                    name: "誓仇",
                                    content: "你不能使用或打出黑桃牌。",
                                },
                                mark: true,
                                marktext: "♠",
                                content: function() {
                                    player.removeSkill('ssr_shichou_spade');
                                },
                                mod: {
                                    cardSavable: function(card, player) {
                                        if (get.suit(card) == 'spade') return false;
                                    },
                                    cardEnabled: function(card, player) {
                                        if (get.suit(card) == 'spade') return false;
                                    },
                                    cardResponsabled: function(card, player) {
                                        if (get.suit(card) == 'spade') return false;
                                    },
                                },
                                sub: true,
                            },
                            club: {
                                trigger: {
                                    global: ["phaseBefore", "die"],
                                },
                                filter: function(event, player) {
                                    return event.player == player.storage.ssr_shichou_club;
                                },
                                charlotte: true,
                                forced: true,
                                silent: true,
                                intro: {
                                    name: "誓仇",
                                    content: "你不能使用或打出梅花牌。",
                                },
                                mark: true,
                                marktext: "♣",
                                content: function() {
                                    player.removeSkill('ssr_shichou_club');
                                },
                                mod: {
                                    cardSavable: function(card, player) {
                                        if (get.suit(card) == 'club') return false;
                                    },
                                    cardEnabled: function(card, player) {
                                        if (get.suit(card) == 'club') return false;
                                    },
                                    cardResponsabled: function(card, player) {
                                        if (get.suit(card) == 'club') return false;
                                    },
                                },
                                sub: true,
                            },
                            diamond: {
                                trigger: {
                                    global: ["phaseBefore", "die"],
                                },
                                filter: function(event, player) {
                                    return event.player == player.storage.ssr_shichou_diamond;
                                },
                                charlotte: true,
                                forced: true,
                                silent: true,
                                intro: {
                                    name: "誓仇",
                                    content: "你不能使用或打出方块牌。",
                                },
                                mark: true,
                                marktext: "♦",
                                content: function() {
                                    player.removeSkill('ssr_shichou_diamond');
                                },
                                mod: {
                                    cardSavable: function(card, player) {
                                        if (get.suit(card) == 'diamond') return false;
                                    },
                                    cardEnabled: function(card, player) {
                                        if (get.suit(card) == 'diamond') return false;
                                    },
                                    cardResponsabled: function(card, player) {
                                        if (get.suit(card) == 'diamond') return false;
                                    },
                                },
                                sub: true,
                            },
                            heart: {
                                trigger: {
                                    global: ["phaseBefore", "die"],
                                },
                                filter: function(event, player) {
                                    return event.player == player.storage.ssr_shichou_heart;
                                },
                                charlotte: true,
                                forced: true,
                                silent: true,
                                intro: {
                                    name: "誓仇",
                                    content: "你不能使用或打出红桃牌。",
                                },
                                mark: true,
                                marktext: "♥",
                                content: function() {
                                    player.removeSkill('ssr_shichou_heart');
                                },
                                mod: {
                                    cardSavable: function(card, player) {
                                        if (get.suit(card) == 'heart') return false;
                                    },
                                    cardEnabled: function(card, player) {
                                        if (get.suit(card) == 'heart') return false;
                                    },
                                    cardResponsabled: function(card, player) {
                                        if (get.suit(card) == 'heart') return false;
                                    },
                                },
                                sub: true,
                            },
                        },
                        audio: "nzry_longnu",
                        shaRelated: true,
                        trigger: {
                            player: "useCardToPlayered",
                        },
                        check: function(event, player) {
                            return get.attitude(player, event.target) <= 0;
                        },
                        filter: function(event, player) {
                            return event.card.name == 'sha';
                        },
                        logTarget: "target",
                        content: function() {
                            "step 0";
                            player.judge(function() {
                                return 0
                            });
                            "step 1";
                            var suit = result.suit;
                            var target = trigger.target;
                            var skill = 'ssr_shichou_' + suit;
                            var num = target.countCards('h', 'shan');
                            if (!target.hasSkill(skill)) target.addSkill(skill);
                            target.storage[skill] = player;
                        },
                        ai: {
                            ignoreSkill: true,
                            skillTagFilter: function(player, tag, arg) {
                                if (tag == 'directHit_ai') {
                                    return get.attitude(player, arg.target) <= 0;
                                }
                                if (!arg || arg.isLink || !arg.card || arg.card.name != 'sha') return false;
                                if (!arg.target || get.attitude(player, arg.target) >= 0) return false;
                                if (!arg.skill || !lib.skill[arg.skill] || lib.skill[arg.skill].charlotte || get.is.locked(arg.skill) || !arg.target.getSkills(true, false).contains(arg.skill)) return false;
                            },
                            "directHit_ai": true,
                        },
                    },
                    "ssr_jinnang": {
                        usable: 2,
                        audio: "cangzhuo",
                        enable: "phaseUse",
                        check: function(card) {
                            return 9 - get.useful(card);
                        },
                        filterCard: function(card, player) {
                            var type = get.type(card);
                            return type == 'trick' || type == 'delay';
                        },
                        filterTarget: function(card, player, target) {
                            return true;
                        },
                        ai: {
                            order: 9.5,
                            threaten: 1.6,
                            expose: 0.1,
                            result: {
                                target: function(player, target) {
                                    var add = target.hp > 2 ? 3 : target.hp;
                                    add += get.attitude(player, target) * 0.1;
                                    if (player == target) add += 2.2;
                                    if (target.hasSkill('ssr_qicai')) add += 2.7;
                                    if (target.hasSkill('ssr_manjia')) add += 1.7;
                                    if (target.hasSkill('ssr_rende') && (player.maxHp > player.hp || target.maxHp > target.hp)) add += 1.7;
                                    if (target.hasSkill('ssr_jinnang_pack')) add -= target.storage.ssr_jinnang_pack.length * 1.3;
                                    if (add < 0) add = 0;
                                    if (player.needsToDiscard() > 0) add += 1;
                                    //alert(get.translation(target.name)+' | '+add);
                                    return add;
                                },
                            },
                        },
                        prepare: "give2",
                        //prepare:"throw",
                        complexCard: true,
                        selectCard: 1,
                        discard: false,
                        visible: true,
                        //toStorage:true,
                        filter: function(event, player) {
                            return player.countCards('h', {
                                type: 'delay'
                            }) + player.countCards('h', {
                                type: 'trick'
                            }) > 0;
                        },
                        init: function(player) {
                            lib.translate['ssr_jinnang_pack'] = '妙计';
                            lib.translate['ssr_jinnang_wuxie'] = '妙破';
                        },
                        content: function() {
                            'step 0';
                            var list = [];
                            for (var i = 0; i < lib.inpile.length; i++) {
                                var name = lib.inpile[i];
                                var info = lib.card[name];
                                if (info.autoViewAs || name == 'yuansuhuimie') continue;
                                if (get.type(name) == 'delay' || get.type(name) == 'trick') {
                                    if (get.type(name) == 'delay') {
                                        list.push(['延时', '', name]);
                                    } else {
                                        list.push(['锦囊', '', name]);
                                    }
                                }
                            }
                            var dialog = ui.create.dialog('锦囊妙计', [list, 'vcard']);
                            // for(var i in list){
                            //        dialog.addText(get.translation(i)+'牌');
                            //        dialog.add([list[i],'vcard']);
                            // }
                            var rand1 = Math.random() < 1 / 3;
                            var rand2 = Math.random() < 0.5;
                            var rand3 = Math.random() < 1 / 3;
                            var rand4 = Math.random() < 1 / 3;
                            player.chooseButton(dialog, true).set('filterButton',
                            function(button) {
                                if (target.hasSkill('ssr_jinnang_pack') && target.storage.ssr_jinnang_pack && target.storage.ssr_jinnang_pack.length > 0) {
                                    return ! target.storage.ssr_jinnang_pack.contains(button.link[2]);
                                } else {
                                    return true;
                                }
                            }).ai = function(button) {
                                var val = 0;
                                if (target.hasSkill('ssr_qicai') && name == 'wuxie') val += 0.2;
                                if (target.hasSkill('ssr_manjia') && name == 'nanman') val += 3;
                                if (target.hasSkill('ssr_rende') && name == 'taoyuan') val += 3;
                                var name = button.link[2];
                                var card = game.createCard(name);
                                return get.useful(card) * 0.5 + get.value(card) * 0.5;
                                /*if(target.hasSkill('ssr_qicai')&&name=='wuxie') return 0.2; 
					            if(target.hasSkill('ssr_manjia')&&name=='nanman') return 2; 
					            if(target.hasSkill('ssr_rende')&&name=='taoyuan') return 2; 
					            if(target.hp<=1){
					                switch(name){
					                    case 'zhiliaobo':return 1;
					                    case 'dunpaigedang':return 0.8;
					                    case 'nanman':return 0.5;
					                    default:return 0;
					                }
					            }
					            if(rand4&&target.countCards('h')<=2){
					                switch(name){
					                    case 'zengbin':return 1;
					                    case 'wuzhong':return 0.8;
					                    default:return 0;
					                }
					            }
					            if(target.hasSkill('qinglonglingzhu')){
					                if(rand2) return name=='chiyuxi'?0.8:0;
					                return name=='jingleishan'?0.8:0;
					            }
					            if(rand2) return name=='wanjian'?0.8:0;
					            return name=='nanman'?0.8:0;*/
                            }
                            'step 1';
                            if (result.bool) {
                                player.discard(cards);
                                if (!target.storage.ssr_jinnang_pack || !target.storage.ssr_jinnang_pack.length > 0 || !target.hasSkill('ssr_jinnang_pack')) {
                                    target.addSkill('ssr_jinnang_pack');
                                    target.storage.ssr_jinnang_pack = [];
                                    target.storage.ssr_jinnang_unchoose = [];
                                }
                                target.storage.ssr_jinnang_pack.push(result.links[0][2]);
                                target.storage.ssr_jinnang_unchoose.push(result.links[0][2]);
                                target.markSkill('ssr_jinnang_pack');
                            }
                        },
                        subSkill: {
                            unchoose: {
                                silent: true,
                                trigger: {
                                    player: "phaseBefore",
                                },
                                locked: true,
                                forced: true,
                                filter: function(event, player) {
                                    return true;
                                },
                                content: function() {
                                    player.storage.ssr_jinnang_unchoose = [];
                                },
                                sub: true,
                                popup: false,
                            },
                            wuxie: {
                                audio: "rekanpo",
                                enable: "chooseToUse",
                                filterCard: true,
                                position: "h",
                                selectCard: -1,
                                viewAs: {
                                    name: "wuxie",
                                },
                                hiddenCard: function(player, name) {
                                    return player.storage.ssr_jinnang_pack.contains('wuxie') && !player.storage.ssr_jinnang_unchoose.contains('wuxie');
                                },
                                viewAsFilter: function(player) {
                                    return player.storage.ssr_jinnang_pack.contains('wuxie') && !player.storage.ssr_jinnang_unchoose.contains('wuxie');
                                },
                                precontent: function() {
                                    event.card = get.cards(1);
                                    player.logSkill('ssr_jinnang_wuxie');
                                    event.result.card.cards = event.card;
                                    event.result.cards = event.card;
                                    if (1 == 0) {
                                        delete event.result.skill;
                                        delete event.result.card.suit;
                                        delete event.result.card.number;
                                    }
                                    event.getParent().addCount = false;
                                    event.getParent().ssr_jinnang_wuxie = true;
                                },
                                onuse: function(result, player) {
                                    player.storage.ssr_jinnang_pack.remove('wuxie');
                                    if (player.storage.ssr_jinnang_pack.length <= 0) {
                                        player.unmarkSkill('ssr_jinnang_pack');
                                        player.removeSkill('ssr_jinnang_pack');
                                    } else {
                                        player.markSkill('ssr_jinnang_pack');
                                    }
                                },
                                prompt: "是否使用〖锦囊妙计〗中的【无懈可击】？",
                                check: function(card) {
                                    return 8 - get.equipValue(card)
                                },
                                threaten: 0.6,
                                ai: {
                                    order: 5,
                                    basic: {
                                        useful: [6, 4],
                                        value: [6, 4],
                                    },
                                    result: {
                                        player: 2,
                                    },
                                    expose: 0.2,
                                },
                                sub: true,
                            },
                            aiend: {
                                sub: true,
                            },
                            pack: {
                                audio: "rekanpo",
                                group: ["ssr_jinnang_unchoose", "ssr_jinnang_wuxie"],
                                enable: "phaseUse",
                                marktext: "锦囊",
                                content: function() {
                                    "step 0";
                                    var cardpack = player.storage.ssr_jinnang_pack;
                                    event.choose = player.storage.ssr_jinnang_unchoose;
                                    var dialog = ui.create.dialog('锦囊妙计', [cardpack, 'vcard']);
                                    //var dialog=ui.create.dialog('锦囊妙计',cardpack);
                                    var rand1 = Math.random() < 1 / 3;
                                    var rand2 = Math.random() < 0.5;
                                    var rand3 = Math.random() < 1 / 3;
                                    var rand4 = Math.random() < 1 / 3;
                                    player.chooseButton(dialog).set('filterButton',
                                    function(button) {
                                        return ! event.choose.contains(button.link[2]) && button.link[2] != 'wuxie';
                                    }).ai = function(button) {
                                        var name = button.link[2];
                                        return player.storage.ssr_jinnang_pack.randomGet();
                                        return - 1;
                                        /*
							            if(player.hp<=1){
							                switch(name){
							                    case 'zhiliaobo':return 1;
							                    case 'dunpaigedang':return 0.8;
							                    case 'nanman':return 0.5;
							                    default:return 0;
							                }
							            }
							            if(rand4&&player.countCards('h')<=1){
							                switch(name){
							                    case 'zengbin':return 1;
							                    case 'wuzhong':return 0.8;
							                    default:return 0;
							                }
							            }
							            if(player.hasSkill('qinglonglingzhu')){
							                if(rand2) return name=='chiyuxi'?0.8:0;
							                return name=='jingleishan'?0.8:0;
							            }
							            if(rand2) return name=='wanjian'?0.8:0;
							            return name=='nanman'?0.8:0;
							            */
                                    }
                                    'step 1';
                                    if (result.bool) {
                                        player.storage.ssr_jinnang_pack.remove(result.links[0][2]);
                                        if (player.storage.ssr_jinnang_pack.length <= 0) {
                                            player.unmarkSkill('ssr_jinnang_pack');
                                            player.removeSkill('ssr_jinnang_pack');
                                        } else {
                                            player.markSkill('ssr_jinnang_pack');
                                        }
                                        event.card = get.cards(1);
                                        player.chooseUseTarget(result.links[0][2], event.card, true, false);
                                    } else {
                                        player.addTempSkill('ssr_jinnang_aiend');
                                    }
                                },
                                sub: true,
                                intro: {
                                    name: "锦囊妙计",
                                    onunmark: function(storage, player) {
                                        //寄咯
                                    },
                                    mark: function(dialog, content, player) {
                                        if (content && content.length) {
                                            if (player == game.me || player.isUnderControl() || game.me.hasSkill('ssr_jinnang')) {
                                                dialog.addAuto([content, 'vcard']);
                                            } else {
                                                return '共有' + get.cnNumber(content.length) + '枚锦囊';
                                            }
                                        }
                                    },
                                    content: function(content, player) {
                                        if (content && content.length) {
                                            if (player == game.me || player.isUnderControl() || game.me.hasSkill('ssr_jinnang')) {
                                                return get.translation([content, 'vcard']);
                                            }
                                            return '共有' + get.cnNumber(content.length) + '枚锦囊';
                                        }
                                    },
                                },
                                ai: {
                                    order: 10,
                                    result: {
                                        player: function(player) {
                                            if (player.hasSkill('ssr_jinnang_aiend')) return - 1;
                                            return 2;
                                        },
                                    },
                                    expose: 0.1,
                                },
                            },
                        },
                    },
                    "ssr_xinbazhen_qian_pile": {},
                    "ssr_xinbazhen_kun_pile": {},
                    "ssr_xinbazhen_zhen_pile": {},
                    "ssr_xinbazhen_gen_pile": {},
                    "ssr_xinbazhen_li_pile": {},
                    "ssr_xinbazhen_kan_pile": {},
                    "ssr_xinbazhen_dui_pile": {},
                    "ssr_xinbazhen_xun_pile": {},
                    "ssr_xinbazhen_center_pile": {},
                    "ssr_xinbazhen_unknown_pile": {},
                    "ssr_xinbazhen": {
                        derivation: ["ssr_xinbazhen_qian_pile", "ssr_xinbazhen_kun_pile", "ssr_xinbazhen_zhen_pile", "ssr_xinbazhen_gen_pile", "ssr_xinbazhen_li_pile", "ssr_xinbazhen_kan_pile", "ssr_xinbazhen_dui_pile", "ssr_xinbazhen_xun_pile"],
                        audio: 'bazhen',
                        marktext: "八阵",
                        unique: true,
                        zhuanhuanji: true,
                        trigger: {
                            player: ["enterGame", "showCharacterAfter", "phaseBefore"],
                            global: "gameDrawAfter",
                        },
                        forced: true,
                        filter: function(event, player) {
                            return ! player.storage.ssr_xinbazhen_hascreate;
                        },
                        priority: -81,
                        content: function() {
                            "step 0";
                            player.storage.ssr_xinbazhen_hascreate = true;
                            player.storage.ssr_xinbazhen_phase = [];
                            var names = ['qian', 'kun', 'zhen', 'gen', 'li', 'kan', 'dui', 'xun', 'center', 'unknown'];
                            var translists = ['乾', '坤', '震', '艮', '离', '坎', '兑', '巽', '阵眼', '卦'];
                            var show = ['☰', '☷', '☳', '☶', '☲', '☵', '☱', '☴', '☯', '◈'];
                            var value = [1.5, -2.5, -1.7, 3, 0, 0.5, -2, -1.5, -10, 1];
                            event.cards = [];
                            for (var i = 0; i < names.length; i++) {
                                lib.card['bazhen_' + names[i]] = {
                                    fullskin: true,
                                    //type:"zhenfa",
                                    image: 'ext:祖安武将/card/bagua_' + names[i] + '.png',
                                    opacity: 1,
                                    textShadow: 'black 0 0 2px',
                                    value: value[i],
                                    ai: {
                                        value: value[i],
                                    },
                                };
                                lib.translate['bazhen_' + names[i] + ''] = translists[i];
                                lib.translate['bazhen_' + names[i] + '_info'] = get.translation('ssr_xinbazhen_' + names[i] + '_pile_info');
                                if (i < 8) event.cards.push(['闭', show[i], 'bazhen_' + names[i], 0]);
                            }
                            event.list = {
                                one: [],
                                two: [],
                                three: [],
                            };
                            var sum = [0, 1, 2, 3, 4, 5, 6, 7];
                            var numtype = ['one', 'two', 'three'];
                            var num = event.cards.length + 1;
                            for (var i = 0; i < num; i++) {
                                var num1 = Math.floor(i / 3);
                                var num2 = i % 3;
                                if (num1 == 1 && num2 == 1) {
                                    event.list[numtype[num1]].push(['开', '☯', 'bazhen_center', 0]);
                                } else {
                                    var rannum = sum.randomGet();
                                    event.list[numtype[num1]].push(event.cards[rannum]);
                                    sum.remove(rannum);
                                }
                            }
                            //alert(event.cards);
                            //list['one'].sort(lib.sort.name);
                            "step 1";
                            player.storage.ssr_xinbazhen = event.list;
                            player.markSkill('ssr_xinbazhen');
                            event.dialog = ui.create.dialog([event.list['one'], 'vcard'], '', [event.list['two'], 'vcard'], '', [event.list['three'], 'vcard']);
                            player.chooseButton(event.dialog, 2).set('filterButton',
                            function(button) {
                                if (get.suit(button) == '开') return false;
                                return true;
                                //return button.name!='bazhen_center';
                            }).set('ai',
                            function(button) {
                                return - 1;
                            });
                            "step 2";
                            event.dialog.close();
                            if (!result.bool) {
                                //player.changeZhuanhuanji('ssr_xinbazhen');
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            "step 3";
                            var numtype = ['one', 'two', 'three'];
                            var num = event.cards.length + 1;
                            var card1 = result.links[0];
                            var card2 = result.links[1];
                            for (var i = 0; i < num; i++) {
                                var num1 = Math.floor(i / 3);
                                var num2 = i % 3;
                                if (event.list[numtype[num1]][num2] == card1) {
                                    event.list[numtype[num1]][num2] = card2;
                                } else if (event.list[numtype[num1]][num2] == card2) {
                                    event.list[numtype[num1]][num2] = card1;
                                }
                            }
                            event.goto(1);
                            //player.chooseControl('ok').set('dialog',['风起',list['one'],list['two'],list['three']]);
                        },
                        intro: {
                            name: "八卦阵",
                            content: function(storage, player, skill) {
                                var str = '';
                                var numtype = ['one', 'two', 'three'];
                                for (var j = 0; j < 9; j++) {
                                    var num1 = Math.floor(j / 3);
                                    var num2 = j % 3;
                                    var card = storage[numtype[num1]][num2];
                                    //alert(stg[numtype[num1]][num2].name);
                                    if (card[0] == '开') {
                                        str = str + card[1] + ' ';
                                    } else {
                                        if (!_status.auto && (player == game.me || player.isUnderControl())) {
                                            str = str + '<span class=\"baguatext\" style=\"color:#A9A9A9\">' + card[1] + '</span> ';
                                        } else {
                                            str = str + '<span class=\"baguatext\" style=\"color:#A9A9A9\">◈</span> ';
                                        }
                                    }
                                    if (num2 == 2 && num1 < 2) str = str + '<br>';
                                }
                                return str;
                            },
                        },
                        group: ['ssr_xinbazhen_sha', 'ssr_xinbazhen_fix', 'ssr_xinbazhen_phase'],
                        subSkill: {
                            phase: {
                                trigger: {
                                    player: 'phaseAfter',
                                },
                                content: function() {
                                    player.storage.ssr_xinbazhen_phase = [];
                                },
                                priority: -97,
                                silent: true,
                                forced: true,
                                sub: true,
                            },
                            fix: {
                                audio: 'bazhen',
                                enable: 'phaseUse',
                                filter: function(event, player) {
                                    if (player.countCards('hes', {
                                        name: 'shan'
                                    }) < 1) return false;
                                    if (!player.storage.ssr_xinbazhen_phase) {
                                        player.storage.ssr_xinbazhen_phase = [];
                                    }
                                    var storage = player.storage.ssr_xinbazhen;
                                    if (!storage) return false;
                                    var cannot = player.storage.ssr_xinbazhen_phase;
                                    var numtype = ['one', 'two', 'three'];
                                    for (var i = 0; i < 9; i++) {
                                        var num1 = Math.floor(i / 3);
                                        var num2 = i % 3;
                                        var card = storage[numtype[num1]][num2];
                                        if (card[0] == '开' && card[2] != 'bazhen_center' && !cannot.contains(card[2])) return true;
                                    }
                                    return false;
                                },
                                filterCard: function(card) {
                                    return get.name(card) == 'shan';
                                },
                                position: "hes",
                                check: function(card) {
                                    return 9 - get.value(card);
                                },
                                content: function() {
                                    "step 0";
                                    if (!player.storage.ssr_xinbazhen_phase) {
                                        player.storage.ssr_xinbazhen_phase = [];
                                    }
                                    event.list = {
                                        one: [],
                                        two: [],
                                        three: [],
                                    };
                                    var storage = player.storage.ssr_xinbazhen;
                                    var numtype = ['one', 'two', 'three'];
                                    for (var i = 0; i < 9; i++) {
                                        var num1 = Math.floor(i / 3);
                                        var num2 = i % 3;
                                        var card = storage[numtype[num1]][num2];
                                        event.list[numtype[num1]].push(card);
                                    }
                                    "step 1";
                                    var cannot = player.storage.ssr_xinbazhen_phase;
                                    event.dialog = ui.create.dialog([event.list['one'], 'vcard'], '', [event.list['two'], 'vcard'], '', [event.list['three'], 'vcard']);
                                    player.chooseButton(event.dialog, 1, true).set('filterButton',
                                    function(button) {
                                        if (cannot.contains(get.name(button))) return false;
                                        if (get.name(button) == 'bazhen_center') return false;
                                        if (get.suit(button) == '闭') return false;
                                        return true;
                                    }).set('ai',
                                    function(button) {
                                        var val = Math.abs(get.value(button)) + Math.random() * 0.1;
                                        return val;
                                    });
                                    "step 2";
                                    var numtype = ['one', 'two', 'three'];
                                    var card = result.links[0];
                                    var storage = player.storage.ssr_xinbazhen;
                                    var close = [];
                                    var closenum = [];
                                    for (var i = 0; i < 9; i++) {
                                        var num1 = Math.floor(i / 3);
                                        var num2 = i % 3;
                                        if (event.list[numtype[num1]][num2] == card) {
                                            storage[numtype[num1]][num2][0] = '闭';
                                            event.list[numtype[num1]][num2][0] = '闭';
                                        }
                                        if (storage[numtype[num1]][num2][0] == '闭') {
                                            close.push(storage[numtype[num1]][num2]);
                                            closenum.push(closenum.length);
                                        }
                                    }
                                    player.showCards(game.createCard({
                                        name: card[2],
                                        number: card[1],
                                        suit: card[0]
                                    }), '卦象');
                                    event.open = card[2];
                                    game.log(player, '将〖' + get.translation(card[2]) + '卦〗盖上');
                                    if (close.length > 0) {
                                        for (var i = 0; i < 9; i++) {
                                            var num1 = Math.floor(i / 3);
                                            var num2 = i % 3;
                                            if (storage[numtype[num1]][num2][0] == '闭') {
                                                var luan = closenum.randomGet();
                                                var luancard = close[luan];
                                                storage[numtype[num1]][num2] = luancard;
                                                closenum.remove(luan);
                                            }
                                        }
                                        game.log('卦象已被打乱');
                                    }
                                    "step 3";
                                    player.storage.ssr_xinbazhen = event.list;
                                    player.markSkill('ssr_xinbazhen');
                                    event.dialog = ui.create.dialog([event.list['one'], 'vcard'], '', [event.list['two'], 'vcard'], '', [event.list['three'], 'vcard']);
                                    player.chooseButton(event.dialog, 2).set('filterButton',
                                    function(button) {
                                        if (get.suit(button) == '开') return false;
                                        return true;
                                    }).set('ai',
                                    function(button) {
                                        return - 1;
                                    });
                                    "step 4";
                                    event.dialog.close();
                                    if (!result.bool) {
                                        {
                                            if (event && event.finish) {
                                                event.finish();
                                            } else {
                                                return;
                                            }
                                        }
                                    }
                                    "step 5";
                                    var numtype = ['one', 'two', 'three'];
                                    var num = event.cards.length + 1;
                                    var card1 = result.links[0];
                                    var card2 = result.links[1];
                                    for (var i = 0; i < num; i++) {
                                        var num1 = Math.floor(i / 3);
                                        var num2 = i % 3;
                                        if (event.list[numtype[num1]][num2] == card1) {
                                            event.list[numtype[num1]][num2] = card2;
                                        } else if (event.list[numtype[num1]][num2] == card2) {
                                            event.list[numtype[num1]][num2] = card1;
                                        }
                                    }
                                    event.goto(3);
                                },
                                ai: {
                                    order: 8.5,
                                    result: {
                                        player: function(player, target) {
                                            return 1.5;
                                        },
                                    },
                                    threaten: 1.1,
                                },
                            },
                            sha: {
                                trigger: {
                                    target: "useCardToBefore",
                                },
                                filter: function(event, player) {
                                    if (!event.target) return false;
                                    if (!player.storage.ssr_xinbazhen) return false;
                                    if (event.player == player) return false;
                                    return event.card.name == 'sha' || event.card.name == 'juedou';
                                },
                                locked: true,
                                priority: -4,
                                forced: true,
                                audio: 'bazhen',
                                content: function() {
                                    "step 0";
                                    trigger.cancel();
                                    player.logSkill('ssr_xinbazhen');
                                    "step 1";
                                    event.list = {
                                        one: [],
                                        two: [],
                                        three: [],
                                    };
                                    var storage = player.storage.ssr_xinbazhen;
                                    var numtype = ['one', 'two', 'three'];
                                    var sumval = 0;
                                    var sumadd = 0;
                                    for (var i = 0; i < 9; i++) {
                                        var num1 = Math.floor(i / 3);
                                        var num2 = i % 3;
                                        var card = storage[numtype[num1]][num2];
                                        if (card[0] == '开') {
                                            event.list[numtype[num1]].push(card);
                                        } else {
                                            event.list[numtype[num1]].push(['闭', '◈', 'bazhen_unknown', i + 1]);
                                            sumval += lib.card[card[2]].value;
                                            sumadd++;
                                        }
                                    }
                                    if (sumadd > 0) {
                                        event.hideval = (sumval / sumadd) + 1.2;
                                    } else {
                                        event.hideval = 1.2;
                                    }
                                    //alert(event.hideval);
                                    "step 2";
                                    event.dialog = ui.create.dialog([event.list['one'], 'vcard'], '', [event.list['two'], 'vcard'], '', [event.list['three'], 'vcard']);
                                    trigger.player.chooseButton(event.dialog, 1, true).set('filterButton',
                                    function(button) {
                                        if (get.name(button) == 'bazhen_center') return false;
                                        return true;
                                    }).set('ai',
                                    function(button) {
                                        if (button.name == 'bazhen_unknown') {
                                            var val = event.hideval + Math.random() * 0.1;
                                        } else {
                                            var val = get.value(button) + Math.random() * 0.1;
                                        }
                                        if (get.attitude(trigger.player, player) > 0) {
                                            return - val;
                                        } else {
                                            return val;
                                        }
                                    });
                                    "step 3";
                                    var numtype = ['one', 'two', 'three'];
                                    var card = result.links[0];
                                    var storage = player.storage.ssr_xinbazhen;
                                    var no = false;
                                    for (var i = 0; i < 9; i++) {
                                        var num1 = Math.floor(i / 3);
                                        var num2 = i % 3;
                                        if (event.list[numtype[num1]][num2] == card) {
                                            if (storage[numtype[num1]][num2][0] == '闭') {
                                                var no = true;
                                            }
                                            storage[numtype[num1]][num2][0] = '开';
                                            card = storage[numtype[num1]][num2];
                                            event.list[numtype[num1]][num2] = card;
                                        }
                                    }
                                    if (!player.storage.ssr_xinbazhen_phase) {
                                        player.storage.ssr_xinbazhen_phase = [];
                                    }
                                    if (no) player.storage.ssr_xinbazhen_phase.push(card[2]);
                                    player.showCards(game.createCard({
                                        name: card[2],
                                        number: card[1],
                                        suit: card[0]
                                    }), '卦象');
                                    event.open = card[2];
                                    game.log(trigger.player, '翻开了〖' + get.translation(card[2]) + '卦〗');
                                    "step 4";
                                    //————————————————————————————————————————————
                                    if (event.open == 'bazhen_qian') { //————————乾·开门
                                        var numtype = ['one', 'two', 'three'];
                                        var storage = player.storage.ssr_xinbazhen;
                                        var card = false;
                                        var cho = [];
                                        for (var i = 0; i < 9; i++) {
                                            var num1 = Math.floor(i / 3);
                                            var num2 = i % 3;
                                            if (event.list[numtype[num1]][num2][2] == 'bazhen_center') continue;
                                            if (storage[numtype[num1]][num2][0] == '闭') {
                                                cho.push(storage[numtype[num1]][num2]);
                                            }
                                        }
                                        if (cho.length > 0) {
                                            var card = cho.randomGet();
                                            var no = false;
                                            for (var i = 0; i < 9; i++) {
                                                var num1 = Math.floor(i / 3);
                                                var num2 = i % 3;
                                                if (storage[numtype[num1]][num2] == card) {
                                                    if (storage[numtype[num1]][num2][0] == '闭') {
                                                        var no = true;
                                                    }
                                                    storage[numtype[num1]][num2][0] = '开';
                                                    card = storage[numtype[num1]][num2];
                                                    event.list[numtype[num1]][num2] = card;
                                                }
                                            }
                                            if (no) player.storage.ssr_xinbazhen_phase.push(card[2]);
                                            player.showCards(game.createCard({
                                                name: card[2],
                                                number: card[1],
                                                suit: card[0]
                                            }), '卦象被翻开');
                                            game.log('〖' + get.translation(card[2]) + '卦〗被翻开');
                                        } else {
                                            game.log('已无卦象可被翻开');
                                        }
                                    }
                                    //————————————————————————————————————————————
                                    if (event.open == 'bazhen_xun') { //————————巽·杜门
                                        var numtype = ['one', 'two', 'three'];
                                        var storage = player.storage.ssr_xinbazhen;
                                        var card = false;
                                        var cho = [];
                                        var close = [];
                                        var closenum = [];
                                        for (var i = 0; i < 9; i++) {
                                            var num1 = Math.floor(i / 3);
                                            var num2 = i % 3;
                                            if (event.list[numtype[num1]][num2][2] == 'bazhen_center') continue;
                                            if (storage[numtype[num1]][num2][0] == '闭') {
                                                close.push(storage[numtype[num1]][num2]);
                                                closenum.push(closenum.length);
                                            } else {
                                                cho.push(storage[numtype[num1]][num2]);
                                            }
                                        }
                                        if (cho.length > 0) {
                                            var card = cho.randomGet();
                                            for (var i = 0; i < 9; i++) {
                                                var num1 = Math.floor(i / 3);
                                                var num2 = i % 3;
                                                if (storage[numtype[num1]][num2] == card) {
                                                    storage[numtype[num1]][num2][0] = '闭';
                                                    //card=storage[numtype[num1]][num2];
                                                    event.list[numtype[num1]][num2] = ['闭', '◈', 'bazhen_unknown', i + 1];
                                                    close.push(storage[numtype[num1]][num2]);
                                                    closenum.push(closenum.length);
                                                }
                                            }
                                            player.showCards(game.createCard({
                                                name: card[2],
                                                number: card[1],
                                                suit: card[0]
                                            }), '卦象被盖上');
                                            game.log('〖' + get.translation(card[2]) + '卦〗被盖上');
                                        } else {
                                            game.log('已无卦象可被盖上');
                                        }
                                        if (close.length > 0) {
                                            for (var i = 0; i < 9; i++) {
                                                var num1 = Math.floor(i / 3);
                                                var num2 = i % 3;
                                                if (storage[numtype[num1]][num2][0] == '闭') {
                                                    var luan = closenum.randomGet();
                                                    var luancard = close[luan];
                                                    storage[numtype[num1]][num2] = luancard;
                                                    closenum.remove(luan);
                                                }
                                            }
                                            game.log('卦象已被打乱');
                                        }
                                    }
                                    //————————————————————————————————————————————
                                    if (event.open == 'bazhen_gen') { //————————艮·生门
                                        player.loseHp();
                                    }
                                    if (event.open == 'bazhen_kun') { //————————坤·死门
                                        trigger.player.loseHp();
                                    }
                                    if (event.open == 'bazhen_zhen') { //————————震·伤门
                                        trigger.player.chooseToRespond(1, {
                                            name: 'shan'
                                        },
                                        '打出一张【闪】，否则受到一点伤害').set('check',
                                        function(card) {
                                            return 9 - get.value(card);
                                        });
                                    }
                                    if (event.open == 'bazhen_dui') { //————————兑·惊门
                                        var cards = trigger.player.getCards('he');
                                        var num = Math.min(cards.length, 2);
                                        if (num > 0) trigger.player.discard(cards.randomGets(num));
                                    }
                                    if (event.open == 'bazhen_li') { //————————离·景门
                                        game.log('无事发生');
                                    }
                                    if (event.open == 'bazhen_kan') { //————————坎·休门
                                        trigger.player.draw();
                                    }
                                    "step 5";
                                    if (event.open == 'bazhen_zhen') {
                                        if (!result.bool) {
                                            trigger.player.damage();
                                        }
                                    }
                                    "step 6";
                                    event.dialog = ui.create.dialog([event.list['one'], 'vcard'], '', [event.list['two'], 'vcard'], '', [event.list['three'], 'vcard']);
                                    //trigger.player.chooseControl('ok').set('dialog',event.dialog);
                                    player.showCards(event.dialog);
                                    //game.delay();
                                    "step 7";
                                    setTimeout(function() {
                                        event.dialog.close();
                                    },
                                    800);
                                },
                                sub: true,
                            },
                        },
                    },
                    "ssr_newbazhen_audio": game.zuanSetSSRAudio('bazhen_ol_sp_zhugeliang', 2),
                    "ssr_newbazhen": {
                        group: ['ssr_newbazhen_set'],
                        subSkill: {
                            set: {
                                trigger: {
                                    player: ["phaseZhunbeiBegin"],
                                    /*player:["enterGame","showCharacterAfter","phaseJieshuBegin"],
		                            global:"gameDrawAfter",*/
                                },
                                filter: function(event, player) {
                                    return true;
                                },
                                audio: "sbkongcheng",
                                priority: 49,
                                direct: true,
                                silent: true,
                                //zhuanhuanji:true,
                                forced: true,
                                content: function() {
                                    "step 0";
                                    event.old = player.storage.ssr_newbazhen.slice(0);
                                    event.hasgua = player.storage.ssr_newbazhen_gua.slice(0);
                                    player.storage.ssr_newbazhen = [];
                                    player.storage.ssr_newbazhen_gua = [];
                                    player.markSkill('ssr_newbazhen');
                                    "step 1";
                                    var names = ['qian', 'kun', 'zhen', 'gen', 'li', 'kan', 'dui', 'xun', 'center', 'unknown'];
                                    var translists = ['乾', '坤', '震', '艮', '离', '坎', '兑', '巽', '阵眼', '卦'];
                                    var show = ['☰', '☷', '☳', '☶', '☲', '☵', '☱', '☴', '☯', '◈'];
                                    event.gua = [];
                                    for (var i = 0; i < 8; i++) {
                                        lib.card['guaxiang_' + names[i]] = {
                                            fullskin: true,
                                            image: 'ext:祖安武将/card/bagua_' + names[i] + '.png',
                                            opacity: 1,
                                            textShadow: 'black 0 0 2px',
                                        };
                                        lib.translate['guaxiang_' + names[i] + ''] = translists[i] + '卦';
                                        lib.translate['guaxiang_' + names[i] + '_info'] = "<li>八卦阵诀";
                                        var card = game.createCard({
                                            name: 'guaxiang_' + names[i],
                                            number: show[i],
                                            suit: ''
                                        });
                                        if (!event.hasgua.contains(card)) event.gua.push(card);
                                    }
                                    "step 2";
                                    player.logSkill('ssr_newbazhen');
                                    event.cards = [];
                                    event.show = [];
                                    var suits = ['spade', 'club', 'heart', 'diamond'];
                                    var used = player.storage.ssr_newbazhen_used;
                                    var none = [];
                                    if (used && used.length) {
                                        var uses = used.randomGet();
                                        none = player.storage.ssr_newbazhen_used;
                                        none.remove(uses);
                                        used = [uses];
                                        event.none = none;
                                    }
                                    for (var i = 0; i < suits.length; i++) {
                                        if (event.old.length < 1 || used.contains(suits[i])) {
                                            var has = false;
                                            var suitcard = get.cardPile(function(card) {
                                                if (get.type(card) != 'basic') return false;
                                                return get.suit(card) == suits[i];
                                            });
                                        } else {
                                            var has = true;
                                            var suitcard = event.old[i];
                                        }
                                        if (suitcard) {
                                            //event.cards.push(game.createCard(suitcard));
                                            event.cards.push(suitcard);
                                            if (!has) {
                                                var card = event.gua.randomGet();
                                            } else {
                                                var card = event.hasgua[i];
                                            }
                                            event.show.push(card);
                                            event.gua.remove(card);
                                            suitcard.fix();
                                            suitcard.remove();
                                            suitcard.destroyed = true;
                                            //player.showCards(card,"正在布置卦象");
                                            //player.$give(card,game.players.randomGet(),false);
                                        }
                                    }
                                    event.guas = event.cards.slice(0);
                                    player.storage.ssr_newbazhen_gua = event.show.slice(0);
                                    //player.chooseControl('ok').set('dialog',[event.show,event.guas,event.cards]);
                                    "step 3";
                                    var card = event.show[0];
                                    var gua = event.guas[0];
                                    //player.showCards(card,"正在布置卦象");
                                    //player.$gain2(card,false);
                                    player.$throw(card, false);
                                    event.show.remove(card);
                                    player.storage.ssr_newbazhen.push(gua);
                                    player.markSkill('ssr_newbazhen');
                                    event.guas.remove(gua);
                                    if (event.show.length > 0) event.redo();
                                    "step 4";
                                    event.dialog = ui.create.dialog('八卦阵诀', event.cards);
                                    player.showCards(event.dialog);
                                    player.storage.ssr_newbazhen = event.cards;
                                    player.storage.ssr_newbazhen_used = [];
                                    if (event.none) player.storage.ssr_newbazhen_used = event.none;
                                    player.markSkill('ssr_newbazhen');
                                    //game.delay(2);
                                    "step 5";
                                    setTimeout(function() {
                                        event.dialog.close();
                                    },
                                    800);
                                },
                                sub: true,
                            },
                            backup: {
                                sourceSkill: "ssr_newbazhen",
                                precontent: function() {
                                    delete event.result.skill;
                                    var name = event.result.card.name;
                                    event.result.cards = event.result.card.cards;
                                    event.result.card = get.autoViewAs(event.result.cards[0]);
                                    event.result.card.name = name;
                                },
                                filterCard: function() {
                                    return false
                                },
                                selectCard: -1,
                                sub: true,
                            },
                            used: {
                                charlotte: true,
                                sub: true,
                            },
                        },
                        audio: "bazhen_ol_sp_zhugeliang",
                        enable: ["chooseToUse", "chooseToRespond"],
                        hiddenCard: function(player, name) {
                            //player!=_status.currentPhase&&
                            if (get.type(name) == 'basic' && lib.inpile.contains(name)) return true;
                        },
                        filter: function(event, player) {
                            //player==_status.currentPhase
                            //var evt=event.getParent(2);
                            if (! (!_status.auto && (player == game.me || player.isUnderControl())) && player.hasSkill('ssr_newbazhen_used')) return false;
                            if (game.me.yangedSkills) {
                                if (!game.me.yangedSkills.contains('ssr_newbazhen')) {
                                    game.me.yangedSkills.add('ssr_newbazhen');
                                }
                            }
                            if (!player.storage.ssr_newbazhen) return false;
                            if (player.storage.ssr_newbazhen.length < 1) return false;
                            //if(evt.name=="chooseToUse") return true;
                            if (event.responded || event.ssr_newbazhen) return false;
                            var storage = player.storage.ssr_newbazhen;
                            var canuse = false;
                            for (var i of lib.inpile) {
                                if (get.type(i) == 'basic' && event.filterCard({
                                    name: i
                                },
                                player, event)) {
                                    for (var h = 0; h < storage.length; h++) {
                                        if (storage[h].name == i && !player.storage.ssr_newbazhen_used.contains(get.suit(storage[h]))) canuse = true;
                                    }
                                }
                            }
                            if (canuse) {
                                if (game.me.yangedSkills) {
                                    if (game.me.yangedSkills.contains('ssr_newbazhen')) {
                                        game.me.yangedSkills.remove('ssr_newbazhen');
                                    }
                                }
                                return true;
                            }
                            return false;
                        },
                        zhuanhuanji: true,
                        marktext: "☯",
                        intro: {
                            name: "八卦阵诀",
                            content: "cards",
                        },
                        init: function(player) {
                            player.storage.ssr_newbazhen = [];
                            player.storage.ssr_newbazhen_used = [];
                            player.storage.ssr_newbazhen_gua = [];
                            //player.disableEquip('equip2');
                        },
                        /*onremove:function (player,skill){
					        player.enableEquip('equip2');
					    },*/
                        unique: true,
                        direct: true,
                        delay: false,
                        content: function() {
                            'step 0';
                            /*if(game.me.yangedSkills) {
					            if(game.me.yangedSkills.contains('ssr_newbazhen')) {
					                 game.me.yangedSkills.remove('ssr_newbazhen');
					            }else {
					                 game.me.yangedSkills.add('ssr_newbazhen');
					            }
					        }*/
                            //player.markSkill('ssr_newbazhen');
                            var evt = event.getParent(2);
                            evt.set('ssr_newbazhen', true);
                            event.cards = player.storage.ssr_newbazhen;
                            //event.forbid
                            var cards = event.cards;
                            /*for(var i=cards.length-1;i>=0;i--){
					            ui.cardPile.insertBefore(cards[i].fix(),ui.cardPile.firstChild);
					        }*/
                            var aozhan = player.hasSkill('aozhan');
                            player.chooseButton(['八阵：选择要' + (evt.name == 'chooseToUse' ? '使用': '打出') + '的牌', cards]).set('filterButton',
                            function(button) {
                                if (player.storage.ssr_newbazhen_used.contains(get.suit(button.link))) return false;
                                return _status.event.cards.contains(button.link);
                            }).set('cards', cards.filter(function(card) {
                                if (aozhan && card.name == 'tao') {
                                    return evt.filterCard({
                                        name: 'sha',
                                        isCard: true,
                                        cards: [card],
                                    },
                                    evt.player, evt) || evt.filterCard({
                                        name: 'shan',
                                        isCard: true,
                                        cards: [card],
                                    },
                                    evt.player, evt);
                                }
                                return evt.filterCard(card, evt.player, evt);
                            })).set('ai',
                            function(button) {
                                var evt = _status.event.getParent(3);
                                if (evt && evt.ai) {
                                    var tmp = _status.event;
                                    _status.event = evt;
                                    var result = (evt.ai || event.ai1)(button.link, _status.event.player, evt);
                                    _status.event = tmp;
                                    return result;
                                }
                                return 1;
                            });
                            'step 1';
                            var evt = event.getParent(2);
                            var evt2 = _status.event.getParent('phaseUse');
                            var him = _status.currentPhase;
                            if (result.bool && result.links && result.links.length) {
                                player.logSkill('ssr_newbazhen');
                                var suitlist = {
                                    'spade': 1,
                                    'club': 2,
                                    'heart': 3,
                                    'diamond': 4,
                                };
                                var card = result.links[0];
                                var num = suitlist[get.suit(result.links)] - 1;
                                player.storage.ssr_newbazhen[num] = game.createCard({
                                    name: card.name,
                                    number: "破",
                                    suit: get.suit(card)
                                });
                                player.markSkill('ssr_newbazhen');
                                player.storage.ssr_newbazhen_used.push(get.suit(card));
                                var name = result.links[0].name,
                                aozhan = (player.hasSkill('aozhan') && name == 'tao');
                                if (aozhan) {
                                    name = evt.filterCard({
                                        name: 'sha',
                                        isCard: true,
                                        cards: [card],
                                    },
                                    evt.player, evt) ? 'sha': 'shan';
                                }
                                if (evt.name == 'chooseToUse') {
                                    game.broadcastAll(function(result, name) {
                                        lib.skill.ssr_newbazhen_backup.viewAs = {
                                            name: name,
                                            cards: [result],
                                            isCard: true
                                        };
                                        lib.skill.ssr_newbazhen_backup.prompt = '选择' + get.translation(result) + '的目标';
                                    },
                                    result.links[0], name);
                                    evt.set('_backupevent', 'ssr_newbazhen_backup');
                                    evt.backup('ssr_newbazhen_backup');
                                    /*if(evt2&&evt2.name=='phaseUse'&&him==player) {
					                    player.chooseUseTarget({name:name,cards:[result],isCard:true},true);
					                }*/
                                } else {
                                    delete evt.result.skill;
                                    delete evt.result.used;
                                    evt.result.card = get.autoViewAs(result.links[0]);
                                    if (aozhan) evt.result.card.name = name;
                                    evt.result.cards = [result.links[0]];
                                    evt.redo();
                                    return;
                                }
                                evt.goto(0);
                            } else {
                                if (! (!_status.auto && (player == game.me || player.isUnderControl()))) player.addTempSkill('ssr_newbazhen_used');
                            }
                            //alert(him.name);
                            //if(!(evt2&&evt2.name=='phaseUse'&&him==player&&(player==game.me||player.isUnderControl()))) {
                            //evt.goto(0);
                            //}
                        },
                        ai: {
                            effect: {
                                target: function(card, player, target, effect) {
                                    if (get.tag(card, 'respondShan')) return 0.7;
                                    if (get.tag(card, 'respondSha')) return 0.7;
                                },
                            },
                            order: 11,
                            respondShan: true,
                            respondSha: true,
                            result: {
                                player: function(player) {
                                    if (_status.event.dying) return get.attitude(player, _status.event.dying);
                                    return 1;
                                },
                            },
                        },
                    },
                    "ssr_xingjiang": {
                        locked: true,
                        audio: "guanxing",
                        trigger: {
                            player: "phaseBegin",
                        },
                        priority: 6,
                        forced: true,
                        filter: function(event, player) {
                            return ! event.numFixed;
                        },
                        content: function() {
                            "step 0";
                            event.cards = get.cards(3);
                            "step 1";
                            player.chooseCardButton('将一张“星降”牌交给一名角色', true, event.cards, 1).set('ai',
                            function(button) {
                                if (ui.selected.buttons.length == 0) return 1;
                                return 0;
                            });
                            "step 2";
                            if (result.bool) {
                                event.cards.remove(result.links[0]);
                                event.togive = result.links.slice(0);
                                player.chooseTarget('将' + get.translation(result.links) + '交给一名角色', true).set('ai',
                                function(target) {
                                    if ((get.type(event.togive[0]) == 'trick' || get.type(event.togive[0]) == 'delay') && !player.countCards('j', {
                                        name: 'lubu'
                                    }) > 0) return player;
                                    var att = get.attitude(_status.event.player, target);
                                    if (att > 0) {
                                        return att / (1 + target.countCards('h'));
                                    } else {
                                        return att / 100;
                                    }
                                }).set('enemy', get.value(event.togive[0], player, 'raw') < 0);
                            }
                            "step 3";
                            if (result.targets.length) {
                                result.targets[0].gain(event.togive, 'draw');
                                player.line(result.targets[0], 'green');
                                game.log(result.targets[0], '获得了“星降”牌');
                            }
                        },
                        ai: {
                            threaten: 1.2,
                        },
                    },
                    "ssr_quanbian": {
                        subSkill: {
                            forbid: {
                                sub: true,
                            },
                        },
                        audio: 'zhiheng',
                        trigger: {
                            player: "loseAfter",
                            global: ["equipAfter", "addJudgeAfter", "gainAfter", "loseAsyncAfter"],
                        },
                        priority: -8,
                        frequent: true,
                        filter: function(event, player) {
                            if (player.hasSkill('ssr_quanbian_forbid')) return false;
                            if (player.countCards('h')) return false;
                            var evt = event.getl(player);
                            return evt && evt.player == player && evt.hs && evt.hs.length > 0;
                        },
                        content: function() {
                            player.addTempSkill('ssr_quanbian_forbid', {
                                player: ['phaseBefore', 'phaseAfter']
                            });
                            player.draw();
                        },
                    },
                    "ssr_manjia": {
                        derivation: "tengjia",
                        locked: true,
                        //audio: "spmanwang",
                        //我趣，真有用
                        "audioname2": {
                            "ssr_zhurong": "sbjuxiang",
                            "ssr_menghuo": "spmanwang",
                        },
                        equipSkill: true,
                        noHidden: true,
                        group: ["ssr_manjia_trick", "ssr_manjia_fire", "ssr_manjia_sha"],
                        //inherit: "tengjia_skill",
                        mod: {
                            selectTarget: function(card, player, range) {
                                if (card.name == 'nanman') range[1] = Infinity;
                            },
                            cardname: function(card, player) {
                                var type = lib.card[card.name].type;
                                var subtype = lib.card[card.name].subtype || 'none';
                                if (type == 'equip' && subtype != 'equip1') return 'sha';
                            },
                        },
                        /*init:function (player){
		                    player.disableEquip('equip2');
		                    player.disableEquip('equip3');
		                    player.disableEquip('equip4');
		                    player.disableEquip('equip5');
		                },
		                onremove:function (player,skill){
		                    player.enableEquip('equip2');
		                    player.enableEquip('equip3');
		                    player.enableEquip('equip4');
		                    player.enableEquip('equip5');
		                },*/
                        subSkill: {
                            trick: {
                                trigger: {
                                    target: ["useCardToBefore"],
                                },
                                forced: true,
                                priority: 6,
                                audio: true,
                                filter: function(event, player) {
                                    if (!player.hasEmptySlot(2)) return false;
                                    if (player.hasSkillTag('unequip2')) return false;
                                    if (player.isLinked()) return false;
                                    //if(player.countCards('e')>0) return false;
                                    if (event.card.name == 'nanman') return true;
                                    if (event.card.name == 'wanjian') return true;
                                    //if(event.card.name=='chuqibuyi') return true;
                                    return false;
                                },
                                content: function() {
                                    trigger.tengjia_skill = true;
                                    trigger.cancel();
                                },
                                ai: {
                                    effect: {
                                        target: function(card, player, target, current) {
                                            if (player.hasEmptySlot(2) && !player.isLinked()) {
                                                if (player == target && get.type(card) == 'equip' && player.countCards('e') < 1) {
                                                    if (get.equipValue(card) <= 7) return 0;
                                                }
                                                //if(card.name=='nanman'||card.name=='wanjian'||card.name=='chuqibuyi') return 'zerotarget';
                                                if (card.name == 'nanman' || card.name == 'wanjian') return 'zerotarget';
                                                if (card.name == 'sha') {
                                                    var equip1 = player.getEquip(1);
                                                    if (equip1 && equip1.name == 'zhuque') return 1.9;
                                                    if (!card.nature) return 'zerotarget';
                                                }
                                            }
                                        },
                                    },
                                },
                                sub: true,
                            },
                            fire: {
                                trigger: {
                                    player: "damageBegin3",
                                },
                                filter: function(event, player) {
                                    if (!player.hasEmptySlot(2)) return false;
                                    if (player.hasSkillTag('unequip2')) return false;
                                    if (player.isLinked()) return false;
                                    if (event.nature != 'fire') return false;
                                    //if(player.countCards('e')>0) return false;
                                    return true;
                                },
                                audio: true,
                                forced: true,
                                content: function() {
                                    trigger.tengjia_skill = true;
                                    trigger.num++;
                                },
                                ai: {
                                    fireAttack: true,
                                    effect: {
                                        target: function(card, player, target, current) {
                                            if (player.hasEmptySlot(2) && !player.isLinked()) {
                                                if (card.name == 'sha') {
                                                    if (card.nature == 'fire') return 2;
                                                    if (player.hasSkill('zhuque_skill')) return 1.9;
                                                }
                                                if (get.tag(card, 'fireDamage') && current < 0) return 2;
                                            }
                                        },
                                    },
                                },
                                sub: true,
                            },
                            sha: {
                                audio: "tengjia1",
                                trigger: {
                                    target: "shaBefore",
                                },
                                forced: true,
                                filter: function(event, player) {
                                    if (!player.hasEmptySlot(2)) return false;
                                    if (player.hasSkillTag('unequip2')) return false;
                                    if (player.isLinked()) return false;
                                    //if(player.countCards('e')>0) return false;
                                    if (event.card.name == 'sha' && !event.card.nature) return true;
                                    return false;
                                },
                                content: function() {
                                    trigger.tengjia_skill = true;
                                    trigger.cancel();
                                },
                                /*ai:{
		                            effect:{
		                                target:function(card,player,target){
		                                    if(player==target&&get.type(card)=='equip'){
		                                    if(get.equipValue(card)<=8) return 0;
		                                    }
		                                    if(!target.countCards('e')>0) return;
		                                    //return lib.skill.tengjia_skill.ai.effect.target.apply(this,arguments);
		                                },
		                            },
		                        },*/
                                sub: true,
                            },
                        },
                    },
                    "ssr_zaiqi": {
                        group: 'ssr_zaiqi_link',
                        subSkill: {
                            link: {
                                trigger:{
                                    player:"damageEnd",
                                },
                                filter:function(event,player){
                                    return !player.isLinked() && player.countMark('ssr_zaiqi') > 0;
                                },
                                check:function(event,player){
                                    return true;
                                },
                                audio: "rezaiqi",
                                prompt2: "你受到伤害后，若你未横置，你可以弃置一枚“蛮”标记，横置并回复一点体力。",
                                content:function(){
                                    "step 0";
                                    player.removeMark('ssr_zaiqi');
                                    "step 1";
                                    player.link(true);
                                    "step 2";
                                    player.recover();
                                },
                                sub: true,
                            },
                            revive: {
                                audio: "zaiqi",
                                trigger: {
                                    player: "chooseToUseBefore",
                                },
                                preHidden: true,
                                filter: function(event, player) {
                                    return event.type == 'dying' && player.isDying() && event.dying == player && player.countMark('ssr_zaiqi') > 0;
                                },
                                skillAnimation: true,
                                animationColor: "fire",
                                content: function() {
                                    "step 0";
                                    player.removeMark('ssr_zaiqi');
                                    trigger.cancel();
                                    trigger.result = {
                                        bool: true
                                    };
                                    if (player.hp <= 0) {
                                        player.recover(1 - player.hp);
                                    }
                                },
                                ai: {
                                    save: true,
                                    mingzhi: true,
                                    skillTagFilter: function(player, tag, target) {
                                        if (player != target) return false;
                                    },
                                },
                                sub: true,
                            },
                            damage: {
                                audio: "zaiqi",
                                trigger: {
                                    global: "phaseJieshuBegin",
                                },
                                filter: function(event, player) {
                                    return player.countMark('ssr_zaiqi') > 0;
                                },
                                skillAnimation: true,
                                animationColor: "fire",
                                check: function(event, player) {
                                    var num = 1;
                                    if (game.countPlayer() > 2) num++;
                                    if (player.hp + player.countMark('ssr_zaiqi') < 5) num++;
                                    return game.countPlayer(function(current) {
                                        return get.attitude(player, current) < 0;
                                    }) >= num;
                                },
                                mark: true,
                                marktext: "南蛮",
                                priority: -3,
                                intro: {
                                    name: "南蛮入侵",
                                    content: "回合结束阶段可以弃置一枚“蛮”并视为使用一张【南蛮入侵】。",
                                },
                                content: function() {
                                    player.removeMark('ssr_zaiqi');
                                    player.chooseUseTarget('nanman', true, false);
                                },
                                ai: {
                                    result: {
                                        player: function(player) {
                                            return 1;
                                        },
                                    },
                                },
                                sub: true,
                            },
                        },
                        //mark:true,
                        marktext: "蛮",
                        init: function(player) {
                            lib.translate['ssr_zaiqi_damage'] = "南蛮";
                            lib.translate['ssr_zaiqi_damage_info'] = "弃置一枚“蛮”标记并视为使用一张【南蛮入侵】。";
                            lib.translate['ssr_zaiqi_revive_info'] = "弃置一枚“蛮”标记并将体力回复至一。";
                            if (!player.storage.ssr_zaiqi && player.countMark('ssr_zaiqi') <= 0) {
                                player.addMark('ssr_zaiqi', 7);
                                player.markSkill('ssr_zaiqi');
                            }
                            if (player.countMark('ssr_zaiqi') > 0) player.markSkill('ssr_zaiqi');
                        },
                        audio:"rezaiqi",
                        enable:"phaseUse",
                        position:"hs",
                        viewAs:{
                            name:"nanman",
                        },
                        filter:function(event,player){
                            if(player.countCards('hs', function(card) {
                                return get.name(card, player) == 'sha';
                            }) < 2) return false;
                            return player.countMark('ssr_zaiqi') > 0;
                        },
                        filterCard:function(card,player){
                            return get.name(card, player) == 'sha';
                        },
                        onuse: function(result, player) {
                            player.removeMark('ssr_zaiqi');
                        },
                        selectCard:2,
                        complexCard:true,
                        check:function(card){
                            var player=_status.event.player;
                            var targets=game.filterPlayer(function(current){
                                return player.canUse('nanman',current);
                            });
                            var num=0;
                            for(var i=0;i<targets.length;i++){
                                var eff=get.sgn(get.effect(targets[i],{name:'nanman'},player,player));
                                if(targets[i].hp==1){
                                    eff*=1.5;
                                }
                                num+=eff;
                            }
                            if(!player.needsToDiscard(-1)){
                                if(targets.length>=7){
                                    if(num<2) return 0;
                                }
                                else if(targets.length>=5){
                                    if(num<1.5) return 0;
                                }
                            }
                            return 6-get.value(card);
                        },
                        ai:{
                            basic:{
                                order:8.5,
                                useful:1,
                                value:5,
                            },
                        },
                        intro: {
                            name: "南蛮入侵",
                            content: "mark",
                        },
                        ai: {
                            threaten: function(player, target) {
                                return 1 + target.countMark('ssr_zaiqi') * 0.3;
                            },
                        },
                    },
                    "ssr_lieren": {
                        audio: "sblieren",
                        derivation: "pyzhuren_diamond",
                        group: ["ssr_lieren_draw", "ssr_lieren_back", "ssr_lieren_equip"],
                        enable: "phaseUse",
                        check: function(card) {
                            return 10 - get.value(card);
                        },
                        init: function(player) {
                            /*if(!player.countCards('h',{name:'pyzhuren_diamond'})>0) {
		                        player.gain(game.createCard('pyzhuren_diamond'));
		                    }*/
                            lib.card['pyzhuren_diamond'].ai = {
                                basic: {
                                    equipValue: 9,
                                    order: function(card, player) {
                                        if (player && player.hasSkillTag('reverseEquip')) {
                                            return 8.5 - get.equipValue(card, player) / 20;
                                        } else {
                                            return 8 + get.equipValue(card, player) / 20;
                                        }
                                    },
                                    useful: 4,
                                    value: function(card, player, index, method) {
                                        if (player.hasSkill('ssr_lieren')) return 9;
                                        if (player.isDisabled(get.subtype(card))) return 0.01;
                                        var value = 0;
                                        var info = get.info(card);
                                        var current = player.getEquip(info.subtype);
                                        if (current && card != current) {
                                            value = get.value(current, player);
                                        }
                                        var equipValue = info.ai.equipValue;
                                        if (equipValue == undefined) {
                                            equipValue = info.ai.basic.equipValue;
                                        }
                                        if (typeof equipValue == 'function') {
                                            if (method == 'raw') return equipValue(card, player);
                                            if (method == 'raw2') return equipValue(card, player) - value;
                                            return Math.max(0.1, equipValue(card, player) - value);
                                        }
                                        if (typeof equipValue != 'number') equipValue = 0;
                                        if (method == 'raw') return equipValue;
                                        if (method == 'raw2') return equipValue - value;
                                        return Math.max(0.1, equipValue - value);
                                    },
                                },
                                result: {
                                    target: function(player, target, card) {
                                        if (player.hasSkill('ssr_lieren')) return 15;
                                        return get.equipResult(player, target, card.name);
                                    },
                                },
                            };
                        },
                        position: "he",
                        filterCard: function(card, player) {
                            if (player.storage.ssr_lieren_temp) {
                                if (player.storage.ssr_lieren_temp.contains(card)) return false;
                            }
                            return get.subtype(card) == 'equip1';
                        },
                        filterTarget: function(card, player, target) {
                            return player != target && !target.hasSkill('ssr_lieren_en');
                        },
                        ai: {
                            order: 1,
                            /*effect:{
		                        target:function(card,player,target){
		                            if(player==target&&get.subtype(card)=='equip1'&&player.countCards('hes',{name:'pyzhuren_diamond'})>0){
		                                if(card.name=='pyzhuren_diamond') {
		                                    return 10;
		                                }else {
		                                    return 0;
		                                }
		                            }
		                        },
		                    },*/
                            result: {
                                target: function(player, target) {
                                    if (game.hasPlayer(function(current) {
                                        return player.canUse('sha', current) && get.attitude(player, current) < 0;
                                    }) && player.countCards('hs', {
                                        name: 'sha'
                                    })) return 0;
                                    return get.damageEffect(target, player, target);
                                },
                            },
                        },
                        prepare: "give",
                        complexCard: true,
                        selectCard: 1,
                        discard: false,
                        toStorage: true,
                        visible: true,
                        filter: function(event, player) {
                            return player.countCards('he', {
                                subtype: 'equip1'
                            }) > 0;
                        },
                        content: function() {
                            'step 0';
                            target.addSkill('ssr_lieren_en');
                            target.storage.ssr_lieren_en = cards;
                            target.markSkill('ssr_lieren_en');
                            target.syncStorage('ssr_lieren_en');
                        },
                        subSkill: {
                            equip: {
                                trigger: {
                                    global: "phaseBefore",
                                    player: "enterGame",
                                },
                                forced: true,
                                locked: false,
                                priority: 18,
                                filter: function(event, player) {
                                    return (event.name != 'phase' || game.phaseNumber == 0);
                                },
                                content: function() {
                                    player.gain(game.createCard('pyzhuren_diamond'));
                                },
                                sub: true,
                            },
                            temp: {
                                init: function(player, skill) {
                                    player.storage.ssr_lieren_temp = [];
                                },
                                onremove: function(player, skill) {
                                    player.storage.ssr_lieren_temp = [];
                                },
                                sub: true,
                            },
                            draw: {
                                //enable:"phaseUse",
                                trigger: {
                                    player: ["phaseBegin", "dying"],
                                },
                                audio: "sblieren",
                                priority: -5,
                                forced: true,
                                content: function() {
                                    "step 0";
                                    event.num = 0;
                                    event.players = [];
                                    for (var i = 0; i < game.players.length; i++) {
                                        if (game.players[i].hasSkill('ssr_lieren_en')) {
                                            event.players.push(game.players[i]);
                                        }
                                    }
                                    "step 1";
                                    if (event.num >= event.players.length || event.players.length < 1) {
                                        if (event && event.finish) {
                                            event.finish();
                                        } else {
                                            return;
                                        }
                                    }
                                    "step 2";
                                    var card = event.players[event.num].storage.ssr_lieren_en;
                                    /*if(card.name=='pyzhuren_diamond'&&player.isEmpty(1)) {
		                                player.equip(card);
		                            }else {*/
                                    player.gain(card, event.players[event.num]);
                                    if (!player.hasSkill('ssr_lieren_temp')) {
                                        player.addTempSkill('ssr_lieren_temp');
                                    }
                                    player.storage.ssr_lieren_temp.push(card[0]);
                                    //event.players[event.num].$give(card,player);
                                    //}
                                    event.players[event.num].storage.ssr_lieren_en = [];
                                    event.players[event.num].unmarkSkill('ssr_lieren_en');
                                    event.players[event.num].removeSkill('ssr_lieren_en');
                                    event.players[event.num].chooseToRespond(1, {
                                        name: 'shan'
                                    },
                                    '烈刃：打出一张【闪】，否则受到来自' + get.translation(player.name) + '的一点伤害').set('check',
                                    function(card) {
                                        return 9 - get.value(card);
                                    });
                                    "step 3";
                                    if (!result.bool) {
                                        event.players[event.num].damage();
                                    }
                                    event.num++;
                                    "step 4";
                                    event.goto(1);
                                },
                                sub: true,
                            },
                            back: {
                                trigger: {
                                    global: "die",
                                },
                                audio: "sblieren",
                                forced: true,
                                filter: function(event) {
                                    return event.player.hasSkill('ssr_lieren_en');
                                },
                                content: function() {
                                    "step 0";
                                    player.gain(trigger.player.storage.ssr_lieren_en, 'draw');
                                    trigger.player.storage.ssr_lieren_en = [];
                                    trigger.player.unmarkSkill('ssr_lieren_en');
                                    trigger.player.removeSkill('ssr_lieren_en');
                                },
                                sub: true,
                            },
                            en: {
                                mark: true,
                                marktext: "刃",
                                sub: true,
                                intro: {
                                    content: "cards",
                                    onunmark: function(storage, player) {
                                        if (storage && storage.length) {
                                            player.$throw(storage);
                                            game.cardsDiscard(storage);
                                            delete player.storage.ssr_lieren_en;
                                        }
                                    },
                                },
                            },
                        },
                    },
                    "ssr_weilong": {
                        mod: {
                            cardUsable: function(card, player, num) {
                                if (card.name == 'sha') return num + 1;
                            },
                        },
                        //group:"ssr_weilong_hp",
                        //audio: "tiaoxin",
                        audio: "mxzhuri",
                        enable: ["chooseToUse", "chooseToRespond"],
                        prompt: "危龙：将♦牌当做【杀】，♥牌当做【桃】，♣牌当做【闪】，♠牌当做【酒】使用或打出",
                        viewAs: function(cards, player) {
                            //window.ssr_weilong_hp=player.hp;
                            //window.ssr_weilong_maxhp=player.maxHp;
                            var name = false;
                            var nature = null;
                            switch (get.suit(cards[0], player)) {
                            case 'club':
                                name = 'shan';
                                break;
                            case 'diamond':
                                name = 'sha';
                                nature = 'fire';
                                break;
                            case 'spade':
                                name = 'jiu';
                                break;
                            case 'heart':
                                name = 'tao';
                                break;
                            }
                            if (name) return {
                                name: name,
                                nature: nature,
                                suit: get.suit(cards[0], player),
                                number: 13
                            };
                            return null;
                        },
                        check: function(card) {
                            var player = _status.event.player;
                            if (_status.event.type == 'phase') {
                                var max = 0;
                                var name2;
                                var list = ['sha', 'tao', 'jiu'];
                                var map = {
                                    sha: 'diamond',
                                    tao: 'heart',
                                    jiu: 'spade'
                                }
                                for (var i = 0; i < list.length; i++) {
                                    var name = list[i];
                                    if (player.countCards('hes',
                                    function(card) {
                                        return (name != 'sha' || get.value(card) < 5) && get.suit(card, player) == map[name];
                                    }) > 0 && player.getUseValue({
                                        name: name,
                                        nature: name == 'sha' ? 'fire': null
                                    }) > 0) {
                                        var temp = get.order({
                                            name: name,
                                            nature: name == 'sha' ? 'fire': null
                                        });
                                        if (temp > max) {
                                            max = temp;
                                            name2 = map[name];
                                        }
                                    }
                                }
                                if (name2 == get.suit(card, player)) return (name2 == 'diamond' ? (5 - get.value(card)) : 17 - get.value(card));
                                return 0;
                            }
                            return 1;
                        },
                        selectCard: function(card) {
                            return _status.event.player.maxHp;
                        },
                        complexCard: true,
                        position: "hes",
                        filterCard: function(card, player, event) {
                            //window.ssr_weilong_hp=player.hp;
                            //window.ssr_weilong_maxhp=player.maxHp;
                            if (ui.selected.cards.length) return get.suit(card, player) == get.suit(ui.selected.cards[0], player);
                            event = event || _status.event;
                            var filter = event._backup.filterCard;
                            var name = get.suit(card, player);
                            if (player.countCards('hes', {
                                suit: name
                            }) < player.maxHp) return false;
                            if (name == 'club' && filter({
                                name: 'shan',
                                cards: [card]
                            },
                            player, event)) return true;
                            if (name == 'diamond' && filter({
                                name: 'sha',
                                cards: [card],
                                nature: 'fire'
                            },
                            player, event)) return true;
                            if (name == 'spade' && filter({
                                name: 'jiu',
                                cards: [card]
                            },
                            player, event)) return true;
                            if (name == 'heart' && filter({
                                name: 'tao',
                                cards: [card]
                            },
                            player, event)) return true;
                            return false;
                        },
                        filter: function(event, player) {
                            //window.ssr_weilong_hp=player.hp;
                            //window.ssr_weilong_maxhp=player.maxHp;
                            var filter = event.filterCard;
                            if (filter({
                                name: 'sha',
                                nature: 'fire'
                            },
                            player, event) && player.countCards('hes', {
                                suit: 'diamond'
                            }) >= player.maxHp) return true;
                            if (filter({
                                name: 'shan'
                            },
                            player, event) && player.countCards('hes', {
                                suit: 'club'
                            }) >= player.maxHp) return true;
                            if (filter({
                                name: 'tao'
                            },
                            player, event) && player.countCards('hes', {
                                suit: 'heart'
                            }) >= player.maxHp) return true;
                            if (filter({
                                name: 'jiu'
                            },
                            player, event) && player.countCards('hes', {
                                suit: 'spade'
                            }) >= player.maxHp) return true;
                            return false;
                        },
                        onuse: function(result, player) {
                            player.draw(player.maxHp);
                        },
                        ai: {
                            save: true,
                            respondSha: true,
                            respondShan: true,
                            skillTagFilter: function(player, tag) {
                                var name;
                                switch (tag) {
                                case 'respondSha':
                                    name = 'diamond';
                                    break;
                                case 'respondShan':
                                    name = 'club';
                                    break;
                                case 'save':
                                    name = 'double';
                                    break;
                                }
                                if (name == 'double') {
                                    if ((player.countCards('hes', {
                                        suit: 'heart'
                                    }) < player.maxHp) && (player.countCards('hes', {
                                        suit: 'spade'
                                    }) < player.maxHp)) return false;
                                } else {
                                    if (player.countCards('hes', {
                                        suit: name
                                    }) < player.maxHp) return false;
                                }
                            },
                            order: function(item, player) {
                                if (player && _status.event.type == 'phase') {
                                    var max = 0;
                                    var list = ['sha', 'tao', 'jiu'];
                                    var map = {
                                        sha: 'diamond',
                                        tao: 'heart',
                                        jiu: 'spade'
                                    }
                                    for (var i = 0; i < list.length; i++) {
                                        var name = list[i];
                                        if (player.countCards('hes',
                                        function(card) {
                                            return (name != 'sha' || get.value(card) < 5) && get.suit(card, player) == map[name];
                                        }) > 0 && player.getUseValue({
                                            name: name,
                                            nature: name == 'sha' ? 'fire': null
                                        }) > 0) {
                                            var temp = get.order({
                                                name: name,
                                                nature: name == 'sha' ? 'fire': null
                                            });
                                            if (temp > max) max = temp;
                                        }
                                    }
                                    max /= 1.1;
                                    return max + 0.5;
                                }
                                return 2.5;
                            },
                        },
                        hiddenCard: function(player, name) {
                            //if(name=='wuxie'&&_status.connectMode&&player.countCards('hes')>=player.maxHp) return true;
                            if (name == 'jiu') return player.countCards('hes', {
                                suit: 'spade'
                            }) >= player.maxHp;
                            if (name == 'tao') return player.countCards('hes', {
                                suit: 'heart'
                            }) >= player.maxHp;
                        },
                        subSkill: {
                            hp: {
                                trigger: {
                                    target: ["useCardToTargeted"],
                                    player: ["loseAfter", "changeHp", "enterGame", "phaseAfter"],
                                    global: ["gameDrawAfter", "phaseBegin", "useCardBefore", "dying"],
                                },
                                priority: 95,
                                forced: true,
                                silent: true,
                                filter: function(event, player) {
                                    return true;
                                },
                                content: function() {
                                    window.ssr_weilong_hp = player.hp;
                                    window.ssr_weilong_maxhp = player.maxHp;
                                },
                                sub: true,
                                popup: false,
                            },
                        },
                    },
                    "ssr_fabei": {
                        shaRelated: true,
                        //audio: "fengliang",
                        audio: "olzhiji",
                        trigger: {
                            player: "useCardToPlayered",
                        },
                        check: function(event, player) {
                            return get.attitude(player, event.target) <= 0;
                        },
                        filter: function(event, player) {
                            return event.card.name == 'sha';
                        },
                        logTarget: "target",
                        priority: 8,
                        content: function() {
                            "step 0";
                            if (!trigger.target.hasSkill('fengyin')) {
                                trigger.target.addTempSkill('fengyin');
                            }
                            "step 1";
                            var target = trigger.target;
                            var num = target.countCards('h', 'shan');
                            target.chooseToDiscard('伐北：请弃置一张基本牌，否则不能使用【闪】抵消此【杀】', 'he',
                            function(card) {
                                return get.type(card) == 'basic';
                            }).set('ai',
                            function(card) {
                                var num = _status.event.num;
                                if (num == 0) return 0;
                                if (card.name == 'shan') return num > 1 ? 2 : 0;
                                return 8 - get.value(card);
                            }).set('num', num);
                            "step 2";
                            if (!result.bool) {
                                trigger.getParent().directHit.add(trigger.target);
                            }
                        },
                        ai: {
                            ignoreSkill: true,
                            skillTagFilter: function(player, tag, arg) {
                                if (tag == 'directHit_ai') {
                                    return get.attitude(player, arg.target) <= 0;
                                }
                                if (!arg || arg.isLink || !arg.card || arg.card.name != 'sha') return false;
                                if (!arg.target || get.attitude(player, arg.target) >= 0) return false;
                                if (!arg.skill || !lib.skill[arg.skill] || lib.skill[arg.skill].charlotte || get.is.locked(arg.skill) || !arg.target.getSkills(true, false).contains(arg.skill)) return false;
                            },
                            "directHit_ai": true,
                        },
                    },
                    "ssr_zhengnan": {
                        //audio: "kunfen",
                        audio: "sbtiaoxin",
                        trigger: {
                            target: "useCardToTargeted",
                        },
                        forced: true,
                        preHidden: true,
                        priority: 8,
                        filter: function(event, player) {
                            return event.card.name == 'sha';
                        },
                        content: function() {
                            "step 0";
                            if (!trigger.player.hasSkill('fengyin')) {
                                trigger.player.addTempSkill('fengyin');
                            }
                            "step 1";
                            var eff = get.effect(player, trigger.card, trigger.player, trigger.player);
                            trigger.player.chooseToDiscard('征南：弃置一张基本牌，否则【杀】对' + get.translation(player.name) + '无效',
                            function(card) {
                                return get.type(card) == 'basic';
                            }).set('ai',
                            function(card) {
                                if (_status.event.eff > 0) {
                                    return 10 - get.value(card);
                                }
                                return 0;
                            }).set('eff', eff);
                            "step 2";
                            if (result.bool == false) {
                                trigger.getParent().excluded.add(player);
                            }
                        },
                        ai: {
                            effect: {
                                target: function(card, player, target, current) {
                                    if (card.name == 'sha' && get.attitude(player, target) < 0) {
                                        if (_status.event.name == 'ssr_zhengnan') return;
                                        var bs = player.getCards('h', {
                                            type: 'basic'
                                        });
                                        if (bs.length < 2) return 0;
                                        if (player.hasSkill('jiu') || player.hasSkill('tianxianjiu')) return;
                                        if (bs.length <= 3 && player.countCards('h', 'sha') <= 1) {
                                            for (var i = 0; i < bs.length; i++) {
                                                if (bs[i].name != 'sha' && get.value(bs[i]) < 7) {
                                                    return [1, 0, 1, -0.5];
                                                }
                                            }
                                            return 0;
                                        }
                                        return [1, 0, 1, -0.5];
                                    }
                                },
                            },
                        },
                    },
                    "ssr_wanlan": {
                        //audio: "olzhiji",
                        audio: "mxranji",
                        trigger: {
                            global: ["dying"],
                        },
                        filter: function(event, player) {
                            return ! player.hasSkill('ssr_wanlan_used');
                        },
                        forced: true,
                        priority: 6,
                        content: function() {
                            player.draw(2);
                            player.addTempSkill('ssr_wanlan_used', {
                                player: 'phaseBefore'
                            });
                        },
                        subSkill: {
                            used: {
                                mark: true,
                                marktext: "燃烬",
                                intro: {
                                    content: function(storage, player, skill) {
                                        var str = '<li>你已发动过〖挽澜〗，如今只能殊死一搏了';
                                        return str;
                                    },
                                },
                                sub: true,
                            },
                        },
                    },
                    "ssr_zhiji": {
                        audio: "jiufa",
                        trigger: {
                            global: "dying",
                        },
                        jueixngji: true,
                        priority: 10,
                        skillAnimation: true,
                        animationColor: "fire",
                        forced: true,
                        locked: true,
                        filter: function(event, player) {
                            return player.storage.ssr_zhiji_pack && player.storage.ssr_zhiji_pack.length > 0 && !player.storage.ssr_zhiji.contains(event.player);
                        },
                        init: function(player) {
                            if (!player.storage.ssr_zhiji_pack) {
                                player.storage.ssr_zhiji_pack = ['ssr_zhengnan', 'ssr_fabei', 'ssr_wanlan'];
                            }
                            if (!player.storage.ssr_zhiji) player.storage.ssr_zhiji = [];
                        },
                        content: function() {
                            'step 0';
                            player.changeHujia(1, null, true);
                            if (player.maxHp > 1) player.loseMaxHp();
                            if (!player.storage.ssr_zhiji) player.storage.ssr_zhiji = [];
                            player.storage.ssr_zhiji.add(trigger.player);
                            player.storage.ssr_zhiji.sortBySeat();
                            player.markSkill('ssr_zhiji');
                            var list = [];
                            for (var i = 0; i < player.storage.ssr_zhiji_pack.length; i++) {
                                if (!player.hasSkill(player.storage.ssr_zhiji_pack[i])) {
                                    list.push(player.storage.ssr_zhiji_pack[i]);
                                }
                            }
                            event.list = list;
                            'step 1';
                            if (event.list.length == 1) event._result = {
                                control: event.list[0]
                            };
                            else player.chooseControl(event.list).set('prompt', '志继：选择获得下列技能中的一个').set('ai',
                            function() {
                                if (event.list.contains('ssr_wanlan') && player == trigger.player) return 'ssr_wanlan';
                                return event.list.randomGet();
                            });
                            'step 2';
                            player.storage.ssr_zhiji_pack.remove(result.control);
                            player.addSkill(result.control);
                            player.popup(result.control);
                            game.log(player, '获得了技能', '#g〖' + get.translation(result.control) + '〗');
                            if (!player.storage.ssr_zhiji_pack.length > 0) player.awakenSkill('ssr_zhiji');
                            'step 3';
                            window.ssr_weilong_hp = player.hp;
                            window.ssr_weilong_maxhp = player.maxHp;
                            player.update();
                        },
                        ai: {
                            threaten: function(player, target) {
                                return 3.5 - target.maxHp * 0.5;
                            },
                        },
                        intro: {
                            content: "已因$发动过技能",
                        },
                        derivation: ["ssr_zhengnan", "ssr_fabei", "ssr_wanlan"],
                    },
                    "ssr_hunzi": {
                        audio: "jsrgduxing",
                        //unique:true,
                        enable: "phaseUse",
                        usable: 2,
                        filterTarget: function(card, player, target) {
                            return player.canCompare(target);
                        },
                        filter: function(event, player) {
                            return player.countCards('h') > 0;
                        },
                        content: function() {
                            'step 0';
                            player.chooseToCompare(target);
                            'step 1';
                            if (result.bool) {
                                if (!target.hasSkill('ssr_hunzi_debuff')) target.addSkill('ssr_hunzi_debuff');
                                if (target.countMark('ssr_hunzi_debuff') < 3) target.addMark('ssr_hunzi_debuff');
                                player.draw();
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            'step 2';
                            if (target.countMark('ssr_hunzi_debuff') < 3 || player.storage.ssr_hunzi_log || game.countPlayer(function(current) {
                                return player != current && target != current;
                            }) < 1) {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            } else {
                                if (!_status.auto && (player == game.me || player.isUnderControl())) game.waitClick(5, false, 100);
                                player.chooseControl('确定', '取消',
                                function() {
                                    if (window.aiClicking) return '取消';
                                    if (get.attitude(player, target) < -1) {
                                        if (player.countCards('h') + player.getHp() * 2 >= target.countCards('h') + target.getHp() * 2) return '确定';
                                    };
                                    return '取消';
                                }).set('prompt', '是否对' + get.translation(target.name) + '发动〖魂姿〗？').set('prompt2', '将场上除你和' + get.translation(target.name) + '以外的所有其他角色暂时移出游戏直到你或该角色中有一方死亡');
                            }
                            'step 3';
                            if (!_status.auto && (player == game.me || player.isUnderControl())) game.stopClick();
                            game.delay();
                            if (result.control != '确定') {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                            'step 4';
                            player.logSkill('ssr_hunzi_log');
                            if (game.me == player || game.me == target) {
                                player.storage.ssr_hunzi_me = 'none';
                            } else {
                                var tme = game.me;
                                player.storage.ssr_hunzi_me = game.me;
                                if (_status.event.isMine()) {
                                    if (!ui.auto.classList.contains('hidden')) {
                                        setTimeout(function() {
                                            ui.click.auto();
                                            setTimeout(function() {
                                                ui.click.auto();
                                                game.swapPlayer(player);
                                            },
                                            500);
                                        });
                                    }
                                } else {
                                    game.swapPlayer(player);
                                }
                                /*var player=lib.playerOL[this.id];
		                        player.isAuto=true;
		                        player.setNickname(player.nickname+' - 托管');
		                        game.broadcast(function(player){
		                            player.setNickname(player.nickname+' - 托管');
		                        },player);*/
                                game.addGlobalSkill('autoswap');
                                game.notMe = true;
                                if (!_status.auto) ui.click.auto();
                                if (window.decadeUI && typeof txcsanm != 'undefined') {
                                    var txonopen = localStorage.getItem("txcsHoldchoose");
                                    if (txonopen && txonopen != 'close' && txcsanm.bg_id) txcsanm.hstop(txcsanm.bg_id);
                                }
                            }
                            var themlive = [];
                            var themdead = [];
                            player.awakenSkill('ssr_hunzi_log');
                            player.storage.ssr_hunzi_log = true;
                            for (var i = 0; i < game.players.length; i++) {
                                if (game.players[i] != player && game.players[i] != target) {
                                    themlive.push(game.players[i]);
                                }
                            }
                            for (var i = 0; i < game.dead.length; i++) {
                                themdead.push(game.dead[i]);
                            }
                            for (var i = 0; i < themlive.length; i++) {
                                game.removePlayer(themlive[i]);
                            }
                            for (var i = 0; i < themdead.length; i++) {
                                game.removePlayer(themdead[i]);
                            }
                            player.storage.ssr_hunzi_live = themlive;
                            player.storage.ssr_hunzi_dead = themdead;
                            if (!target.hasSkill('ssr_hunzi_ai') && (get.attitude(target, player) > 0 || get.attitude(player, target) > 0)) {
                                window.ssr_hunzi_ai_eff1 = [];
                                window.ssr_hunzi_ai_eff2 = [];
                                for (var i = 0; i < lib.inpile.length; i++) {
                                    var names = lib.inpile[i];
                                    window.ssr_hunzi_ai_eff1.push(get.effect(target, {
                                        name: names
                                    },
                                    target));
                                    window.ssr_hunzi_ai_eff2.push(get.effect(target, {
                                        name: names
                                    },
                                    player, target));
                                }
                                target.addTempSkill('ssr_hunzi_ai', {
                                    player: 'die'
                                });
                            }
                            player.addSkill('ssr_hunzi_die');
                            player.storage.ssr_hunzi_die = target;
                        },
                        ai: {
                            expose: 0.1,
                            order: 13,
                            result: {
                                target: function(player, target) {
                                    if (get.attitude(player, target) >= 0) return 0;
                                    return 0 - player.hp * 2 - player.countCards('he') + target.hp * 2 + target.countCards('he');
                                },
                            },
                        },
                        subSkill: {
                            debuff: {
                                locked: true,
                                trigger: {
                                    player: "compare",
                                    target: "compare",
                                },
                                mark: true,
                                marktext: "衅",
                                intro: {
                                    name: "畏缩不前",
                                    content: function(storage, player, skill) {
                                        return '你的拼点牌点数-' + player.countMark('ssr_hunzi_debuff') + '（不会小于A）';
                                    },
                                },
                                filter: function(event, player) {
                                    return player.countMark('ssr_hunzi_debuff') && !event.iwhile;
                                },
                                forced: true,
                                preHidden: true,
                                priority: -5,
                                content: function() {
                                    'step 0';
                                    var num = player.countMark('ssr_hunzi_debuff');
                                    game.log(player, '的拼点牌点数〈-' + num + '〉');
                                    if (player == trigger.player) {
                                        trigger.num1 -= num;
                                        if (trigger.num1 < 1) trigger.num1 = 1;
                                        var news = game.createCard({
                                            name: trigger.card1.name,
                                            suit: get.suit(trigger.card1),
                                            number: trigger.num1
                                        });
                                        game.log(player, '拼点牌', trigger.card1, '改为了', news);
                                        trigger.card1.num = trigger.num1;
                                    } else {
                                        trigger.num2 -= num;
                                        if (trigger.num2 < 1) trigger.num2 = 1;
                                        var news = game.createCard({
                                            name: trigger.card2.name,
                                            suit: get.suit(trigger.card2),
                                            number: trigger.num2
                                        });
                                        game.log(player, '拼点牌', trigger.card2, '改为了', news);
                                        trigger.card2.num = trigger.num2;
                                    }
                                },
                                sub: true,
                            },
                            log: {
                                limited: true,
                                skillAnimation: true,
                                animationColor: "green",
                                sub: true,
                                audio: 'sbhunzi',
                                mark: true,
                                init: function(player) {
                                    player.storage.ssr_hunzi_log = false;
                                },
                                intro: {
                                    content: "limited",
                                },
                                sub: true,
                            },
                            ai: {
                                ai: {
                                    effect: {
                                        player: function(card, player, target) {
                                            for (var i = 0; i < lib.inpile.length; i++) {
                                                var name = lib.inpile[i];
                                                if (card.name == name) {
                                                    //alert(card.name);
                                                    //alert(window.ssr_hunzi_ai_eff1[i]);
                                                    return [0, 0, 1, -window.ssr_hunzi_ai_eff1[i]];
                                                }
                                            }
                                        },
                                        target: function(card, player, target, current) {
                                            if (target != player && get.attitude(player, target) >= 0) {
                                                if (card.name == 'jiu' && player.countCards('hs', {
                                                    name: 'sha'
                                                }) > 0) {
                                                    return [0, 0, 1, Infinity];
                                                }
                                                if (card.name == 'sha') {
                                                    return [0, 0, 1, Infinity];
                                                }
                                                for (var i = 0; i < lib.inpile.length; i++) {
                                                    var name = lib.inpile[i];
                                                    if (card.name == name) {
                                                        //alert(card.name);
                                                        //alert(window.ssr_hunzi_ai_eff2[i]);
                                                        return [0, 0, 1, -window.ssr_hunzi_ai_eff2[i]];
                                                    }
                                                }
                                            }
                                        },
                                    },
                                },
                                sub: true,
                            },
                            die: {
                                trigger: {
                                    global: "dieBefore",
                                },
                                audio: 'pinghe',
                                priority: Infinity,
                                forced: true,
                                forceDie: true,
                                skillAnimation: true,
                                animationColor: "fire",
                                filter: function(event, player) {
                                    return event.player == player || event.player == player.storage.ssr_hunzi_die;
                                },
                                content: function() {
                                    'step 0';
                                    var themlive = player.storage.ssr_hunzi_live;
                                    var themdead = player.storage.ssr_hunzi_dead;
                                    for (var i = themdead.length - 1; i >= 0; i--) {
                                        game.restorePlayer(themdead[i]);
                                        game.players.remove(themdead[i]);
                                        game.dead.push(themdead[i]);
                                    }
                                    for (var i = themlive.length - 1; i >= 0; i--) {
                                        game.restorePlayer(themlive[i]);
                                    }
                                    'step 1';
                                    player.removeSkill('ssr_hunzi_die');
                                    if (player.storage.ssr_hunzi_me && player.storage.ssr_hunzi_me != 'none') {
                                        var target = player.storage.ssr_hunzi_me;
                                        if (_status.event.isMine()) {
                                            if (!ui.auto.classList.contains('hidden')) {
                                                setTimeout(function() {
                                                    ui.click.auto();
                                                    setTimeout(function() {
                                                        ui.click.auto();
                                                        game.swapPlayer(target);
                                                    },
                                                    500);
                                                });
                                            }
                                        } else {
                                            game.swapPlayer(target);
                                        }
                                        if (!game.notMe) game.swapPlayerAuto(player._trueMe)
                                        else delete game.notMe;
                                        if (_status.auto) ui.click.auto();
                                        delete player._trueMe;
                                        if (window.decadeUI && typeof txcsanm != 'undefined') {
                                            var txcsshow = localStorage.getItem("txcsHoldchoose");
                                            if (txcsshow && txcsshow != 'close') {
                                                var item = txcsshow;
                                                //var oldHchoose=localStorage.getItem("txcsHoldchoose");
                                                //var directHopen=localStorage.getItem("txcsHdirectopen");
                                                localStorage.setItem("txcsHoldchoose", item);
                                                if (!item || item == 'close') {
                                                    if (txcsanm.bg_id) txcsanm.hstop(txcsanm.bg_id);
                                                } else {
                                                    txcsanm.bg_testing = [];
                                                    var obj = txcsanm.dybg[item];
                                                    if (!obj) {
                                                        alert("动态背景-" + item + "-没有预定义");
                                                        return;
                                                    }
                                                    obj.loop = true;
                                                    var fl = [obj];
                                                    var name = obj.name2 || name;
                                                    if (obj.group && txcsanm.find(obj.group)) fl.add(txcsanm.find(obj.group));
                                                    var pos = txcsanm.ff(obj.position, "", true);
                                                    if (!pos) {
                                                        game.saveExtensionConfig("特效测试", "txcs_dynamicbg", "close");
                                                        return;
                                                    }
                                                    if (txcsanm.bg_id) {
                                                        txcsanm.hstop(txcsanm.bg_id);
                                                        delete txcsanm.bg_id;
                                                    }
                                                    txcsanm.load(fl,
                                                    function() {
                                                        txcsanm.play(obj, obj.args, pos);
                                                    });
                                                }
                                            }
                                        }
                                    }
                                },
                                logTarget: "source",
                                sub: true,
                            },
                            leave: {
                                trigger: {
                                    player: ["phaseBefore", "gainBefore"],
                                },
                                forced: true,
                                silent: true,
                                content: function() {
                                    trigger.cancel();
                                },
                                init: function(player, skill) {
                                    player.addSkillBlocker(skill);
                                },
                                onremove: function(player, skill) {
                                    player.removeSkillBlocker(skill);
                                },
                                charlotte: true,
                                locked: true,
                                skillBlocker: function(skill, player) {
                                    return skill != 'ssr_hunzi_leave' && skill != 'diaohulishan' && !lib.skill[skill].charlotte;
                                },
                                sub: true,
                                popup: false,
                            },
                        },
                    },
                    "ssr_newjiang": {
                        group: 'ssr_newjiang_res',
                        subSkill: {
                            res: {
                                enable: ["chooseToRespond"],
                                filterCard: function(card, player) {
                                    return get.type(card) == 'basic';
                                },
                                position: "hs",
                                viewAs: {
                                    name: "sha",
                                },
                                viewAsFilter: function(player) {
                                    if (!player.countCards('hs', {
                                        type: 'basic'
                                    }) > 0) return false;
                                },
                                filter: function(event, player) {
                                    return player.countCards('hs', {
                                        type: 'basic'
                                    }) > 0;
                                },
                                prompt: "激昂：将一张基本牌当【杀】打出",
                                check: function(card) {
                                    return 15 - get.value(card)
                                },
                                ai: {
                                    skillTagFilter: function(player) {
                                        if (!player.countCards('hs')) return false;
                                    },
                                    respondSha: true,
                                    basic: {
                                        useful: [5, 3, 1],
                                        value: [5, 3, 1],
                                    },
                                    order: function(item, player) {
                                        return 15;
                                    },
                                    result: {
                                        target: function(player, target, card, isLink) {
                                            var eff = function() {
                                                if (!isLink && player.hasSkill('jiu')) {
                                                    if (!target.hasSkillTag('filterDamage', null, {
                                                        player: player,
                                                        card: card,
                                                        jiu: true,
                                                    })) {
                                                        if (get.attitude(player, target) > 0) {
                                                            return - 7;
                                                        } else {
                                                            return - 4;
                                                        }
                                                    }
                                                    return - 0.5;
                                                }
                                                return - 1.5;
                                            } ();
                                            if (!isLink && target.mayHaveShan() && !player.hasSkillTag('directHit_ai', true, {
                                                target: target,
                                                card: card,
                                            },
                                            true)) return eff / 1.2;
                                            return eff;
                                        },
                                    },
                                },
                            },
                        },
                        locked: true,
                        shaRelated: true,
                        audio: 'jiang',
                        preHidden: true,
                        priority: 5,
                        forced: true,
                        trigger: {
                            player: "useCardToPlayered",
                            target: "useCardToTargeted",
                        },
                        filter: function(event, player) {
                            if (event.card.name != 'sha') return false;
                            return player == event.target || event.getParent().triggeredTargets3.length == 1;
                        },
                        content: function() {
                            'step 0';
                            var viewas = game.createCard({
                                name: 'juedou',
                                suit: get.suit(trigger.card),
                                number: get.number(trigger.card)
                            });
                            game.log(trigger.player, '使用的', trigger.card, '视为', viewas);
                            trigger.card.isOldSha = true;
                            trigger.card.name = 'juedou';
                        },
                        ai: {
                            effect: {
                                target: function(card, player, target, current) {
                                    if (card.name == 'sha') return [1, get.effect(target, {
                                        name: 'juedou',
                                        isCard: true
                                    },
                                    player, player) * 0.1];
                                },
                                player: function(card, player, target, current) {
                                    if (card.name == 'sha') return [1, get.effect(target, {
                                        name: 'juedou',
                                        isCard: true
                                    },
                                    player, player) * 0.1];
                                },
                            },
                            wuxie: function(target, card, player, viewer) {
                                if (player == game.me && get.attitude(viewer, player) > 0) {
                                    return 0;
                                }
                            },
                        },
                    },
                    "ssr_jiang": {
                        subSkill: {
                            forbid: {},
                        },
                        shaRelated: true,
                        audio: "rejiang",
                        preHidden: true,
                        trigger: {
                            player: "useCardToPlayered",
                            target: "useCardToTargeted",
                        },
                        filter: function(event, player) {
                            if (player.hasSkill('ssr_jiang_forbid')) return false;
                            if (! (event.card.name == 'juedou' || event.card.name == 'sha')) return false;
                            return player == event.target || event.getParent().triggeredTargets3.length == 1;
                        },
                        frequent: true,
                        priority: 3,
                        content: function() {
                            player.draw();
                            player.addTempSkill('ssr_jiang_forbid', {
                                player: ['phaseBefore', 'phaseEnd']
                            });
                        },
                        ai: {
                            effect: {
                                target: function(card, player, target) {
                                    if (card.name == 'sha') return [1, 0.6];
                                },
                                player: function(card, player, target) {
                                    if (card.name == 'sha') return [1, 1];
                                },
                            },
                        },
                    },
                    "ssr_newzhiba": {
                        locked: true,
                        //audio: "olzhiba",
                        "audioname2": {
                            "ssr_sunce": "olzhiba",
                            "ssr_sunjian": "jsrgpingtao",
                        },
                        trigger: {
                            player: "compare",
                            target: "compare",
                        },
                        filter: function(event, player) {
                            if (!player.hasZhuSkill('ssr_newzhiba')) return false;
                            return ! event.iwhile;
                        },
                        priority: -15,
                        zhuSkill: true,
                        forced: true,
                        direct: true,
                        preHidden: true,
                        content: function() {
                            'step 0';
                            var targets = game.filterPlayer();
                            targets.remove(player);
                            event.targets = targets;
                            event.damages = [];
                            'step 1';
                            if (event.targets.length) {
                                var current = event.targets.shift();
                                if (current.group == 'wu') {
                                    current.chooseToDiscard(get.prompt('ssr_newzhiba'), 'he', '弃置一张牌令' + get.translation(player.name) + '的拼点牌点数+1，且若此次其拼点胜利，你摸一张牌', lib.filter.cardDiscardable).set('ai',
                                    function(card) {
                                        if (get.attitude(current, player) < 1) return 0;
                                        return 7 - get.value(card);
                                    }).set('logSkill', 'ssr_newzhiba').setHiddenSkill('ssr_newzhiba');
                                    event.current = current;
                                } else {
                                    event.redo();
                                }
                            } else {
                                event.goto(3);
                            }
                            'step 2';
                            if (result.bool) {
                                event.damages.push(event.current);
                                event.current.line(player, 'green');
                                game.log(event.current, '令', player, '拼点牌点数〈+1〉');
                            }
                            if (event.targets.length) {
                                event.goto(1);
                            }
                            'step 3';
                            if (event.damages.length) {
                                player.logSkill('ssr_newzhiba');
                                var num = event.damages.length;
                                game.log(player, '的拼点牌点数最终〈+' + num + '〉');
                                event.win = false;
                                if (player == trigger.player) {
                                    trigger.num1 += num;
                                    if (trigger.num1 > 13) trigger.num1 = 13;
                                    var news = game.createCard({
                                        name: trigger.card1.name,
                                        suit: get.suit(trigger.card1),
                                        number: trigger.num1
                                    });
                                    game.log(player, '拼点牌', trigger.card1, '改为了', news);
                                    trigger.card1.num = trigger.num1;
                                    if (trigger.num1 > trigger.num2) event.win = true;
                                } else {
                                    trigger.num2 += num;
                                    if (trigger.num2 > 13) trigger.num2 = 13;
                                    var news = game.createCard({
                                        name: trigger.card2.name,
                                        suit: get.suit(trigger.card2),
                                        number: trigger.num2
                                    });
                                    game.log(player, '拼点牌', trigger.card2, '改为了', news);
                                    trigger.card2.num = trigger.num2;
                                    if (trigger.num2 > trigger.num1) event.win = true;
                                }
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                };
                            }
                            'step 4';
                            if (event.win) {
                                var next = game.createEvent('ssr_newzhiba_next');
                                event.next.remove(next);
                                trigger.after.push(next);
                                next.targets = event.damages;
                                next.setContent(function() {
                                    targets.shift().draw();
                                    if (targets.length) event.redo();
                                });
                            }
                        },
                    },
                    "ssr_zhiba": {
                        audio: "yinghun",
                        trigger: {
                            player: "phaseZhunbeiBegin",
                        },
                        filter: function(event, player) {
                            if (!player.hasZhuSkill('ssr_zhiba')) return false;
                            return player.getDamagedHp() > 0 && game.countPlayer(function(current) {
                                return player != current && current.group == 'wu';
                            }) > 0;
                        },
                        unique: true,
                        zhuSkill: true,
                        direct: true,
                        preHidden: true,
                        content: function() {
                            "step 0";
                            player.chooseTarget(get.prompt2('ssr_zhiba'),
                            function(card, player, target) {
                                return player != target && target.group == 'wu';
                            }).set('ai',
                            function(target) {
                                var player = _status.event.player;
                                if (get.attitude(_status.event.player, target) > 0) {
                                    return 10 + get.attitude(_status.event.player, target);
                                }
                                return 1;
                            }).setHiddenSkill(event.name);
                            "step 1";
                            if (result.bool) {
                                //event.num=player.getDamagedHp();
                                event.num = 2;
                                player.logSkill(event.name, result.targets);
                                event.target = result.targets[0];
                                if (event.num == 1) {
                                    event.directcontrol = true;
                                } else {
                                    var str1 = '摸' + get.cnNumber(event.num, true) + '弃一';
                                    var str2 = '摸一弃' + get.cnNumber(event.num, true);
                                    player.chooseControl(str1, str2,
                                    function(event, player) {
                                        return _status.event.choice;
                                    }).set('choice', get.attitude(player, event.target) > 0 ? str1: str2);
                                    event.str = str1;
                                }
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            "step 2";
                            if (event.directcontrol || result.control == event.str) {
                                event.target.draw(event.num);
                                event.target.chooseToDiscard(true, 'he');
                            } else {
                                event.target.draw();
                                event.target.chooseToDiscard(event.num, true, 'he');
                            }
                        },
                        ai: {
                            threaten: function(player, target) {
                                if (target.hp == target.maxHp) return 0.5;
                                if (target.hp == 1) return 2;
                                if (target.hp == 2) return 1.5;
                                return 0.5;
                            },
                            maixie: true,
                        },
                    },
                    "ssr_hanzhan": {
                        locked: true,
                        audio: "hanzhan",
                        trigger: {
                            player: "compare",
                            target: "compare",
                        },
                        filter: function(event) {
                            return ! event.iwhile;
                        },
                        forced: true,
                        preHidden: true,
                        content: function() {
                            'step 0';
                            player.logSkill('ssr_hanzhan');
                            game.log(player, '拼点牌点数+2');
                            if (player == trigger.player) {
                                trigger.num1 += 2;
                                if (trigger.num1 > 13) trigger.num1 = 13;
                                trigger.card1.num = trigger.num1;

                            } else {
                                trigger.num2 += 2;
                                if (trigger.num2 > 13) trigger.num2 = 13;
                                trigger.card2.num = trigger.num2;
                            }
                        },
                    },
                    "ssr_newhanzhan": {
                        locked: true,
                        audio: "hanzhan",
                        trigger: {
                            player: "compare",
                            target: "compare",
                        },
                        filter: function(event, player) {
                            if (event.iwhile) return false;
                            var card = (player == event.player) ? event.card1: event.card2;
                            return get.name(card) == 'sha' && player.getDamagedHp();
                        },
                        priority: 11,
                        forced: true,
                        preHidden: true,
                        content: function() {
                            'step 0';
                            var num = player.getDamagedHp();
                            game.log(player, '的拼点牌点数〈+' + num + '〉');
                            if (player == trigger.player) {
                                trigger.num1 += num;
                                if (trigger.num1 > 13) trigger.num1 = 13;
                                var news = game.createCard({
                                    name: trigger.card1.name,
                                    suit: get.suit(trigger.card1),
                                    number: trigger.num1
                                });
                                game.log(player, '拼点牌', trigger.card1, '改为了', news);
                                trigger.card1.num = trigger.num1;
                            } else {
                                trigger.num2 += num;
                                if (trigger.num2 > 13) trigger.num2 = 13;
                                var news = game.createCard({
                                    name: trigger.card2.name,
                                    suit: get.suit(trigger.card2),
                                    number: trigger.num2
                                });
                                game.log(player, '拼点牌', trigger.card2, '改为了', news);
                                trigger.card2.num = trigger.num2;
                            }
                        },
                        mod: {
                            maxHandcardBase: function(player, num) {
                                if (player.hujia) return num + player.hujia;
                            },
                        },
                    },
                    "ssr_kuiwei": {
                        subSkill: {
                            break: {
                                intro: {
                                    name: "溃不成军",
                                    content: "你不能使用或打出基本牌",
                                },
                                mark: true,
                                marktext: "溃败",
                                charlotte: true,
                                mod: {
                                    cardSavable: function(card, player) {
                                        if (get.type(card) == 'basic') return false;
                                    },
                                    cardEnabled: function(card, player) {
                                        if (get.type(card) == 'basic') return false;
                                    },
                                    cardResponsabled: function(card, player) {
                                        if (get.type(card) == 'basic') return false;
                                    },
                                },
                                sub: true,
                            },
                        },
                        audio: "tianyi",
                        enable: "phaseUse",
                        usable: 2,
                        filterTarget: function(card, player, target) {
                            return player.canCompare(target);
                        },
                        filter: function(event, player) {
                            return player.countCards('h') > 0;
                        },
                        content: function() {
                            "step 0";
                            player.chooseToCompare(target);
                            "step 1";
                            if (result.player && result.player.name != 'sha') {
                                event.goto(2);
                            } else {
                                if (result.bool) {
                                    target.damage(player);
                                    target.addTempSkill('ssr_kuiwei_break');
                                } else if (result.tie) {

} else {
                                    player.damage(target);
                                    player.addTempSkill('ssr_kuiwei_break');
                                }
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                            "step 2";
                            var list = [];
                            if (get.position(result.player) == 'd') list.push(result.player);
                            if (get.position(result.target) == 'd') list.push(result.target);
                            if (!list.length) {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            } else {
                                event.list = list;
                            }
                            "step 3";
                            event.list.sort(function(a, b) {
                                return b.number - a.number;
                            });
                            player.gain(event.list[0], 'gain2');
                        },
                        ai: {
                            order: function(name, player) {
                                return 9;
                            },
                            result: {
                                player: function(player) {
                                    var num = player.countCards('h');
                                    return num - player.hp + 1;
                                },
                                target: function(player, target) {
                                    var num = target.countCards('h');
                                    if (num == 1) return - 1;
                                    if (num == 2) return - 0.7;
                                    return - 0.5;
                                },
                            },
                            threaten: 1.2,
                        },
                    },
                    "ssr_tianyi": {
                        audio: "tianyi",
                        enable: "phaseUse",
                        usable: 2,
                        filterTarget: function(card, player, target) {
                            return player.canCompare(target);
                        },
                        filter: function(event, player) {
                            return player.countCards('h') > 0;
                        },
                        content: function() {
                            "step 0";
                            player.chooseToCompare(target).callback = lib.skill.ssr_tianyi.callback;
                            "step 1";
                            if (result.bool) {
                                target.damage(player);
                            } else if (result.tie) {

} else {
                                player.damage(target);
                            }
                        },
                        ai: {
                            order: function(name, player) {
                                return 9;
                            },
                            result: {
                                player: function(player) {
                                    var num = player.countCards('h');
                                    return num - player.hp + 1;
                                },
                                target: function(player, target) {
                                    var num = target.countCards('h');
                                    if (num == 1) return - 1;
                                    if (num == 2) return - 0.7;
                                    return - 0.5;
                                },
                            },
                            threaten: 1.2,
                        },
                    },
                    "ssr_huwei": {
                        subSkill: {
                            used: {
                                trigger: {
                                    player: ["enterGame", "phaseBefore"],
                                    global: "gameDrawAfter",
                                },
                                forced: true,
                                priority: 14,
                                silent: true,
                                marktext: "危",
                                content: function() {
                                    player.storage.ssr_huwei_used = 2;
                                    player.markSkill('ssr_huwei_used');
                                    player.syncStorage('ssr_huwei_used');
                                },
                                intro: {
                                    name: "赴汤蹈火",
                                    content: "mark",
                                },
                                //charlotte:true,
                                sub: true,
                            },
                        },
                        group: 'ssr_huwei_used',
                        trigger: {
                            global: "useCardToTarget",
                        },
                        logTarget: "target",
                        audio: "fenji",
                        direct: true,
                        filter: function(event, player) {
                            //if(player.hasSkill('ssr_huwei_used')) return false;
                            if (player.countMark('ssr_huwei_used') < 1) return false;
                            return (event.card.name == 'sha' || event.card.name == 'juedou') && event.player != player && !event.targets.contains(player);
                        },
                        content: function() {
                            'step 0';
                            if (!_status.auto && (player == game.me || player.isUnderControl())) game.waitClick(3, false, 100);
                            player.chooseControl('确定', '取消',
                            function() {
                                if (window.aiClicking) return '取消';
                                if (get.attitude(player, trigger.target) > 0) {
                                    var eff1 = get.effect(trigger.target, trigger.card, trigger.player, player);
                                    var eff2 = get.effect(player, trigger.card, trigger.player, player);
                                    if (eff1 < eff2) return '确定';
                                };
                                return '取消';
                            }).set('prompt', '是否对' + get.translation(trigger.target.name) + '发动〖护危〗？').set('prompt2', '将' + get.translation(trigger.card) + '的目标转移给你');
                            'step 1';
                            if (!_status.auto && (player == game.me || player.isUnderControl())) game.stopClick();
                            if (result.control == '确定') {
                                player.logSkill('ssr_huwei', trigger.target);
                                var evt = trigger.getParent();
                                evt.triggeredTargets2.remove(trigger.target);
                                evt.targets.remove(trigger.target);
                                evt.targets.push(player);
                                game.log(trigger.card, '对', trigger.target, '的目标转移给了', player);
                                //player.addTempSkill('ssr_huwei_used',{player:'phaseBefore'});
                                player.removeMark('ssr_huwei_used');
                            }
                            game.delay();
                        },
                        ai: {
                            expose: 0.2,
                        },
                    },
                    "ssr_newbuqu": {
                        group: ['ssr_newbuqu_sha', 'ssr_newbuqu_use'],
                        audio: 'buqu',
                        trigger: {
                            player: "changeHp",
                        },
                        filter: function(event, player) {
                            return player.hp <= 0 && event.num < 0 && !event.getParent()._ssr_newbuqu;
                        },
                        forced: true,
                        preHidden: true,
                        content: function() {
                            "step 0";
                            player.hp = 0;
                            delete player.nodying;
                            player.update();
                            trigger.getParent()._ssr_newbuqu = true;
                            if (!player.hasSkill('ssr_newbuqu_first')) {
                                player.addTempSkill('ssr_newbuqu_first', {
                                    player: ['recoverAfter', 'dieBefore']
                                });
                                player.nodying = true; {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            "step 1";
                            var card = get.cards()[0];
                            event.card = card;
                            player.addToExpansion(card, 'gain2').gaintag.add('ssr_newbuqu');
                            "step 2";
                            var cards = player.getExpansions('ssr_newbuqu'),
                            num = get.number(card);
                            player.showCards(cards, '钢铁之躯');
                            for (var i = 0; i < cards.length; i++) {
                                if (cards[i] != card && get.number(cards[i]) == num) {
                                    player.loseToDiscardpile(card);
                                    return;
                                };
                            }
                            //trigger.cancel();
                            player.nodying = true;
                            /*trigger.result={bool:true};
					        if(player.hp<=0){
					            player.recover(1-player.hp);
					        }*/
                        },
                        /*mod:{
					        maxHandcardBase:function(player,num){
					            if(player.getExpansions('ssr_newbuqu').length) return player.getExpansions('ssr_newbuqu').length;
					        },
					    },*/
                        ai: {
                            save: true,
                            mingzhi: true,
                            skillTagFilter: function(player, tag, target) {
                                if (player != target) return false;
                            },
                        },
                        marktext: "创",
                        intro: {
                            name: "钢铁之躯",
                            content: "expansion",
                            markcount: "expansion",
                        },
                        subSkill: {
                            first: {
                                mark: true,
                                marktext: "钢躯",
                                intro: {
                                    name: "钢铁之躯",
                                    content: "<li>已发动过首次的〖不屈〗",
                                },
                                sub: true,
                            },
                            use: {
                                audio: "buqu",
                                trigger: {
                                    player: "useCard",
                                },
                                logTarget: "target",
                                check: function(event, player) {
                                    return get.attitude(player, event.target) <= 0;
                                },
                                filter: function(event, player) {
                                    if (player.hp > 0) return false;
                                    if (get.type(event.card) != 'basic') return false;
                                    return true;
                                    //return player==event.target;
                                },
                                priority: -3,
                                forced: true,
                                content: function() {
                                    trigger.baseDamage++;
                                },
                                sub: true,
                            },
                            sha: {
                                audio: "buqu",
                                trigger: {
                                    player: "useCardToPlayered",
                                },
                                logTarget: "target",
                                check: function(event, player) {
                                    return get.attitude(player, event.target) <= 0;
                                },
                                filter: function(event, player) {
                                    if (event.card.name != 'sha') return false;
                                    if (player.getExpansions('ssr_newbuqu').length < 1) return false;
                                    var storage = player.getExpansions('ssr_newbuqu');
                                    for (var i = 0; i < storage.length; i++) {
                                        if (get.number(event.card) == get.number(storage[i])) return true;
                                    }
                                    return false;
                                },
                                priority: -6,
                                forced: true,
                                content: function() {
                                    trigger.getParent().directHit.push(trigger.target);
                                },
                                ai: {
                                    threaten: 0.5,
                                    "directHit_ai": true,
                                    skillTagFilter: function(player, tag, arg) {
                                        if (get.attitude(player, arg.target) <= 0 && arg.card.name == 'sha' && player.countCards('h',
                                        function(card) {
                                            return card != arg.card && (!arg.card.cards || !arg.card.cards.contains(card));
                                        }) >= arg.target.countCards('h')) return true;
                                        return false;
                                    },
                                    aiOrder: function(player, card, num) {
                                        if (card.name == 'tao' && player.hp < 1) return 1;
                                        if (card.name == 'sha' && typeof get.number(card) == 'number' && player.getExpansions('ssr_newbuqu').length > 0) {
                                            var storage = player.getExpansions('ssr_newbuqu');
                                            for (var i = 0; i < storage.length; i++) {
                                                if (get.number(card) == storage[i]) return num + 10;
                                            }
                                        }
                                    },
                                    effect: {
                                        player: function(card, player, target) {
                                            if (card.name == 'sha' && typeof get.number(card) == 'number' && player.getExpansions('ssr_newbuqu').length > 0) {
                                                var storage = player.getExpansions('ssr_newbuqu');
                                                for (var i = 0; i < storage.length; i++) {
                                                    if (get.number(card) == storage[i]) return [1, 2];
                                                }
                                            }
                                        },
                                    },
                                },
                                /*mod:{
					                targetInRange:function(card,player,target){
					                    if(card.name=='sha'&&typeof get.number(card)=='number'&&player.getExpansions('ssr_newbuqu').length>0){
					                        var storage=player.getExpansions('ssr_newbuqu');
					                        for(var i=0;i<storage.length;i++) {
					                            if(get.number(card)==get.number(storage[i])) return true;
					                        }
					                    }
					                },
					            },*/
                                sub: true,
                            },
                        },
                    },
                    "ssr_buqu": {
                        locked: true,
                        forced: true,
                        audio: 'buqu',
                        preHidden: true,
                        trigger: {
                            player: ["damageBegin", "loseHpBegin"],
                        },
                        priority: -29,
                        mod: {
                            selectTarget: function(card, player, range) {
                                if (range[1] == -1 || !player.countMark('ssr_buqu') > 0 || game.countPlayer(function(current) {
                                    return current != player;
                                }) <= 1) return;
                                if (card.name == 'sha') range[1] += 1;
                            },
                        },
                        filter: function(event, player) {
                            return event.num > 0 && player.countMark('ssr_buqu') > 0;
                        },
                        content: function() {
                            if (trigger.num > player.countMark('ssr_buqu')) {
                                var num = player.countMark('ssr_buqu');
                            } else {
                                var num = trigger.num;
                            }
                            if (trigger.name == 'damage') {
                                if (trigger.animate !== false) {
                                    player.$damage(trigger.source);
                                    if (window.zuanDamageAudio) game.playAudio('..', 'extension', '祖安武将', 'audio', 'hudun.mp3');
                                    game.broadcastAll(function(nature, player) {
                                        if (lib.config.animation && !lib.config.low_performance) {
                                            if (nature == 'fire') {
                                                player.$fire();
                                            } else if (nature == 'thunder') {
                                                player.$thunder();
                                            }
                                        }
                                    },
                                    trigger.nature, player);
                                    player.$damagepop( - num, trigger.nature);
                                }
                            }
                            player.removeMark('ssr_buqu', num);
                            trigger.num -= num;
                        },
                        init: function(player) {
                            if (!player.storage.ssr_buqu && player.countMark('ssr_buqu') <= 0) {
                                player.addMark('ssr_buqu', 12);
                                player.markSkill('ssr_buqu');
                            }
                            if (player.countMark('ssr_buqu') > 0) player.markSkill('ssr_buqu');
                        },
                        ai: {
                            "maixie_defend": true,
                        },
                        mark: true,
                        marktext: "创",
                        intro: {
                            name: "破釜沉舟",
                            content: "mark",
                        },
                    },
                    "ssr_shensu_audio": game.zuanSetSSRAudio('shensu1_ol_xiahouyuan', 2),
                    "ssr_shensu": {
                        group: ["ssr_shensu_dis", "ssr_shensu_dam"],
                        audio: "shensu1_ol_xiahouyuan",
                        trigger: {
                            player: ["phaseDrawBegin", "phaseUseBegin"],
                        },
                        preHidden: true,
                        direct: true,
                        priority: 50,
                        content: function() {
                            'step 0';
                            var name = '未知';
                            if (trigger.name == 'phaseDraw') event.phasename = '摸牌';
                            if (trigger.name == 'phaseUse') event.phasename = '出牌';
                            player.chooseControl('确定', '取消',
                            function() {
                                var good = game.countPlayer(function(current) {
                                    return get.attitude(player, current) >= 0;
                                });
                                var bad = game.countPlayer(function(current) {
                                    return get.attitude(player, current) < 0;
                                });
                                //alert(trigger.name=='phaseDraw'&&(player.hp>2||player.countCards('h')>4||good>bad));
                                if (trigger.name == 'phaseDraw' && (player.hp > 2 || player.countCards('h') > 4 || good > bad)) return '确定';
                                if (trigger.name == 'phaseUse' && (!(player.getDamagedHp() > 0 && player.countCards('h', {
                                    name: 'tao'
                                }) > 0 || player.needsToDiscard() > 0) || good > bad)) return '确定';
                                return '取消';
                            }).set('prompt', '神速·阳：是否跳过 ' + event.phasename + '阶段 并获得三枚“速”标记？');
                            'step 1';
                            if (result.control == '确定') {
                                player.logSkill('ssr_shensu');
                                game.log(player, '跳过了' + event.phasename + '阶段');
                                trigger.cancel();
                                player.addMark('ssr_shensu', 3);
                            }
                        },
                        mark: false,
                        marktext: "速",
                        intro: {
                            name: "兵贵神速",
                            content: "mark",
                        },
                        mod: {
                            maxHandcardBase: function(player, num) {
                                if (player.countMark('ssr_shensu') > 0) {
                                    return num - Math.floor(player.countMark('ssr_shensu') * 0.5);
                                }
                            },
                        },
                        subSkill: {
                            dis: {
                                audio: "shensu1",
                                trigger: {
                                    player: ["phaseJudgeBegin", "phaseDiscardBegin"],
                                },
                                filter: function(event, player) {
                                    if (event.name == 'phaseJudge' && !player.countCards('j') > 0) return false;
                                    if (event.name == 'phaseDiscard' && !player.needsToDiscard()) return false;
                                    return player.countMark('ssr_shensu') >= 2;
                                },
                                priority: 50,
                                direct: true,
                                preHidden: true,
                                content: function() {
                                    'step 0';
                                    var name = '未知';
                                    if (trigger.name == 'phaseJudge') event.phasename = '判定';
                                    if (trigger.name == 'phaseDiscard') event.phasename = '弃牌';
                                    player.chooseControl('确定', '取消',
                                    function() {
                                        if (player.countMark('ssr_shensu') >= 12) return '确定';
                                        if (trigger.name == 'phaseJudge' && (player.countCards('j') > 1 || player.countCards('h', {
                                            type: 'trick'
                                        }) + player.countCards('h', {
                                            type: 'delay'
                                        }) + player.countCards('h', {
                                            type: 'equip'
                                        }) > 2)) return '确定';
                                        if (trigger.name == 'phaseDiscard' && player.needsToDiscard() > 1) return '确定';
                                        return '取消';
                                    }).set('prompt', '神速·阴：是否移除两枚“速”标记并跳过 ' + event.phasename + '阶段 ？');
                                    'step 1';
                                    if (result.control == '确定') {
                                        player.logSkill('ssr_shensu');
                                        player.removeMark('ssr_shensu', 2);
                                        game.log(player, '跳过了' + event.phasename + '阶段');
                                        trigger.cancel();
                                    }
                                },
                                sub: true,
                            },
                            dam: {
                                audio: "shensu1",
                                trigger: {
                                    player: "damageEnd",
                                },
                                filter: function(event, player) {
                                    return event.num > 0;
                                },
                                frequent: true,
                                content: function() {
                                    player.addMark('ssr_shensu', 3 * trigger.num);
                                },
                                ai: {
                                    maixie: true,
                                    "maixie_hp": true,
                                },
                                sub: true,
                            },
                        },
                    },
                    "ssr_hubu": {
                        subSkill: {
                            targeted: {
                                mark: true,
                                marktext: '卸甲',
                                intro: {
                                    name: '丢盔卸甲',
                                    content: '你的防具已失效',
                                },
                                ai: {
                                    "unequip2": true,
                                },
                                sub: true,
                                charlotte: true,
                                "_priority": 0,
                            },
                        },
                        audio: "shebian",
                        trigger: {
                            player: "phaseEnd",
                        },
                        direct: true,
                        preHidden: true,
                        filter: function(event, player) {
                            return player.countMark('ssr_shensu') >= 2;
                        },
                        priority: 10,
                        content: function() {
                            'step 0';
                            player.chooseTarget(get.prompt2('ssr_hubu'), 1,
                            function(card, player, target) {
                                return player != target;
                            },
                            function(target) {
                                return - get.attitude(player, target);
                            });
                            'step 1';
                            if (result.bool) {
                                event.target = result.targets[0];
                                event.sum = [];
                                for (var i = 1; i * 2 <= player.countMark('ssr_shensu') && i <= 3; i++) {
                                    event.sum.push(get.cnNumber(i, true));
                                }
                                player.chooseControl(event.sum, '取消',
                                function() {
                                    if (event.target.countCards('e', {
                                        name: 'tengjia'
                                    }) > 0 && !player.countCards('e', {
                                        name: 'qinggang'
                                    }) + player.countCards('e', {
                                        name: 'zhuque'
                                    }) > 0) return '取消';
                                    return get.cnNumber(Math.min(event.target.hp + 1, 3), true);
                                }).set('prompt', '请选择对' + get.translation(event.target) + '使用的【杀】的张数？');
                                event.target.addTempSkill('ssr_hubu_targeted');
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            'step 2';
                            if (result.control != '取消') {
                                event.sum = ['零'].concat(event.sum);
                                for (var a = 0; event.sum[a] != result.control && a < 3 && player.countMark('ssr_shensu') >= 2; a++) {
                                    player.removeMark('ssr_shensu', 2);
                                    player.useCard({
                                        name: 'sha'
                                    },
                                    event.target);
                                    player.update();
                                }
                            }
                            'step 3';
                            if (event.target.hasSkill('ssr_hubu_targeted')) event.target.removeSkill('ssr_hubu_targeted');
                        },
                    },
                    "ssr_jushou": {
                        group: ["ssr_jushou_defend", "ssr_jushou_damage", "ssr_jushou_jiewei",
                            "ssr_jushou_jiewei_use", "ssr_jushou_jiewei_shan", "ssr_jushou_jiewei_wuxie", "ssr_jushou_jiewei_cls"],
                        audio: "xinjushou",
                        unique: true,
                        trigger: {
                            player: ["enterGame", "phaseBegin", "phaseAfter"],
                            global: "gameDrawAfter",
                        },
                        priority: -125,
                        forced: true,
                        filter: function(event, player) {
                            return ! player.storage.ssr_jushou_defend;
                        },
                        content: function() {
                            'step 0';
                            event.chooseList = ['wuxie', 'sha', 'shan', 'tao', 'jiu'];
                            event.cards1 = event.chooseList.map(name =>game.createCard({name: name, suit: 'spade', number: '城'}));
                            event.cards2 = event.chooseList.map(name =>game.createCard({name: name, suit: 'spade', number: '城'}));
                            //event.dialog = ui.create.dialog(['请配置你的「石城汤池」', [event.cards1, 'vcard'], '', [event.cards2, 'vcard']]);
                            player.chooseButton(['请配置你的「石城汤池」', event.cards1, event.cards2], 4).set('ai', function(button) {
                                return Math.random() + 1;
                            });
                            'step 1';
                            if(result.bool && result.links?.length) {
                                event.cardpile = result.links.sort((a, b) =>{
                                    return event.chooseList.indexOf(a.name) - event.chooseList.indexOf(b.name);
                                });
                                player.showCards(event.cardpile);
                            }else {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                            'step 2';
                            //player.storage.ssr_jushou=game.cardsGotoSpecial(event.cardpile).cards;
                            player.storage.ssr_jushou_defend = game.cardsGotoSpecial(event.cardpile).cards;
                            player.markSkill('ssr_jushou_defend');
                            //'step 3';
                            //player.chooseControl('ok').set('dialog', ['石城汤池', event.cardpile]);
                        },
                        content_old: function() {
                            'step 0';
                            event.num = 4;
                            event.cardpile = [];
                            'step 1';
                            event.num--;
                            "step 2";
                            event.card = get.cardPile(function(card) {
                                for (var a = 0; a < event.cardpile.length; a++) {
                                    if (card == event.cardpile[a]) return false;
                                }
                                if (get.type(card) == 'basic') return true;
                                if (get.name(card) == 'wuxie') return true;
                                return false;
                            });
                            if (!event.card) {
                                if (event.cardpile.length > 0) {
                                    event.goto(4);
                                } else {
                                    {
                                        if (event && event.finish) {
                                            event.finish();
                                        } else {
                                            return;
                                        }
                                    }
                                    return;
                                }
                            }
                            player.showCards([event.card]);
                            "step 3";
                            event.cardpile.push(event.card);
                            if (event.num > 0) event.goto(1);
                            'step 4';
                            player.chooseControl('ok').set('dialog', ['石城汤池', event.cardpile]);
                            'step 5';
                            //player.storage.ssr_jushou=game.cardsGotoSpecial(event.cardpile).cards;
                            player.storage.ssr_jushou = game.cardsGotoSpecial(event.cardpile).cards;
                            player.markSkill('ssr_jushou');
                        },
                        getUsableDun: function(player) {
                            if (!player.storage.ssr_jushou_jiewei) {
                                player.storage.ssr_jushou_jiewei = [];
                            }
                            if (!player.storage.ssr_jushou_defend?.length) return [];
                            var enableDun = [];
                            var jiewei = player.storage.ssr_jushou_jiewei.slice(0);
                            for (var i = 0; i < player.storage.ssr_jushou_defend.length; i++) {
                                var current = player.storage.ssr_jushou_defend[i];
                                if (!jiewei.contains(current.name)) {
                                    enableDun.push(current);
                                }else {
                                    jiewei.remove(current.name);
                                }
                            }
                            return enableDun;
                        },
                        ai: {
                            combo: "ssr_jiewei",
                        },
                        subSkill: {
                            defend: {
                                forced: true,
                                marktext: "城",
                                group: ["ssr_jushou_damage", "ssr_jushou_jiewei",
                                    "ssr_jushou_jiewei_use", "ssr_jushou_jiewei_shan", "ssr_jushou_jiewei_wuxie", "ssr_jushou_jiewei_cls"],
                                intro: {
                                    name: "石城汤池",
                                    /*onunmark:function(storage,player){
        		                        if(storage&&storage.length){
        		                            player.$throw(storage,1000);
        		                            game.cardsDiscard(storage);
        		                            game.log(storage,'被置入了弃牌堆');
        		                            storage.length=0;
        		                        }
        		                    },*/
                                    mark: function(dialog, content, player) {
                                        if (content && content.length) {
                                            var enbaleDun = get.info("ssr_jushou").getUsableDun(player);
                                            content.forEach(card => {
                                                card.init([card.suit, enbaleDun.contains(card) ? '城' : '○', card.name]);
                                            });
                                            dialog.addAuto(content);
                                        }
                                    },
                                    content: function(content, player) {
                                        if (content && content.length) {
                                            return get.translation(content);
                                        }
                                    },
                                },
                                sub: true,
                            },
                            damage: {
                				trigger: {
                				    player: 'damageBegin4',
            				    },
                				forced: true,
                				audio: "xinjushou",
                				filter: function(event,player){
                					if(event.num <= 1) return false;
                					return true;
                				},
                				priority:-10,
                				content:function(){
                					trigger.num = 1;
                				},
                                sub: true,
                            },
                            damage_old: {
                                trigger: {
                                    player: 'damageBegin4',
                                },
                                direct: true,
                                audio: 'jushou',
                                filter: function(event, player) {
                                    if (event.num < 2) return false;
                                    if (!player.storage.ssr_jushou_jiewei) {
                                        player.storage.ssr_jushou_jiewei = [];
                                    }
                                    event.enableDun = get.info("ssr_jushou").getUsableDun(player);
                                    /*player.storage.ssr_jushou_defend.filter(card =>{
                                        return !player.storage.ssr_jushou_jiewei.contains(card.name);
                                    }):*/
                                    return event.enableDun.length >= 2;
                                },
                                priority: -1,
                                content: function() {
                                    'step 0';
                                    event.defend = trigger.num;
                                    //trigger.num=1;
                                    event.cards = [];
                                    var st = trigger.enableDun;
                                    for (var i = 0; i < st.length; i++) {
                                        if (!event.cards[st[i].name]) {
                                            event.cards[st[i].name] = 1;
                                        } else {
                                            event.cards[st[i].name]++;
                                        }
                                    }
                                    'step 1';
                                    //刷新一下
                                    player.storage.ssr_jushou_defend.forEach(card => {
                                        card.init([card.suit, trigger.enableDun.contains(card) ? '城' : '○', card.name]);
                                    });
                                    player.chooseCardButton(player.storage.ssr_jushou_defend, '据守：是否用两张“盾”抵挡接下来即将受到的' + get.cnNumber(event.defend) + '点伤害', 2).set('filterButton',
                                    function(button) {
                                        return trigger.enableDun.contains(button.link);
                                    }).ai = function(button) {
                                        var val = get.value(button.link);
                                        var val2 = val / event.cards[button.name];
                                        var val3 = 8 + event.defend + 6.5 - val2 - player.hp;
                                        //alert(button.link.name+' | '+val+' | '+val3);
                                        return val3;
                                    }
                                    'step 2';
                                    if (result.bool && result.links?.length) {
                                        player.logSkill('ssr_jushou_damage');
                                        player.showCards(result.links);
                                        trigger.cancel();
                                        //player.storage.ssr_jushou.remove(result.links[0]);
                                        result.links.forEach(card => {
                                            player.storage.ssr_jushou_jiewei.push(card.name);
                                        });
                                        game.log(player, '的', get.translation(result.links),'抵挡了', get.cnNumber(event.defend), '点伤害');
                                        if (!player.storage.ssr_jushou_defend.length > 0) {
                                            player.unmarkSkill('ssr_jushou_defend');
                                        } else {
                                            player.markSkill('ssr_jushou_defend');
                                        }
                                    }
                                },
                                ai: {
                                    "maixie_defend": true,
                                    threaten: 0.9,
                                    skillTagFilter: function(player, tag, arg) {
                                        if (arg && arg.player) {
                                            if (arg.player.hasSkillTag('jueqing', false, player)) return false;
                                        }
                                    },
                                },
                                sub: true,
                            },
                            baiyin: {
                                trigger: {
                                    player: 'damageBegin4'
                                },
                                forced: true,
                                audio: 'jushou',
                                filter: function(event, player) {
                                    if (! (event.num >= Math.min(2, player.getHp() + player.hujia))) return false;
                                    return player.storage.ssr_jushou && player.storage.ssr_jushou.length > 0;
                                },
                                priority: -1,
                                content: function() {
                                    'step 0';
                                    event.defend = trigger.num;
                                    //trigger.num=1;
                                    event.cards = [];
                                    var st = player.storage.ssr_jushou;
                                    for (var i = 0; i < st.length; i++) {
                                        if (!event.cards[st[i].name]) {
                                            event.cards[st[i].name] = 1;
                                        } else {
                                            event.cards[st[i].name]++;
                                        }
                                    }
                                    'step 1';
                                    player.chooseCardButton(player.storage.ssr_jushou, '抵挡：选择弃置的“盾”并防止即将受到的' + get.cnNumber(event.defend) + '点伤害', 1).set('filterButton',
                                    function(button) {
                                        return true;
                                    }).ai = function(button) {
                                        var val = get.value(button.link);
                                        var val2 = val / event.cards[button.name];
                                        var val3 = event.defend + 6.5 - val2 - player.hp;
                                        //alert(button.link.name+' | '+val+' | '+val3);
                                        return val3;
                                    }
                                    'step 2';
                                    if (result.bool) {
                                        trigger.cancel();
                                        player.changeHujia(1, null, true);
                                        //trigger.num=1;
                                        player.storage.ssr_jushou.remove(result.links[0]);
                                        game.log(player, '的“盾”抵挡了', get.cnNumber(event.defend), '点伤害');
                                        if (!player.storage.ssr_jushou.length > 0) {
                                            player.unmarkSkill('ssr_jushou');
                                        } else {
                                            player.markSkill('ssr_jushou');
                                        }
                                    }
                                },
                                ai: {
                                    "maixie_defend": true,
                                    threaten: 0.9,
                                    skillTagFilter: function(player, tag, arg) {
                                        if (arg && arg.player) {
                                            if (arg.player.hasSkillTag('jueqing', false, player)) return false;
                                        }
                                    },
                                },
                            },
                        },
                    },
                    "ssr_jushou_jiewei": {
                        audio: "xinjiewei",
                        enable: "chooseToUse",
                        filter: function(event, player) {
                            return event.type != 'wuxie' && event.type != 'respondShan' && player.countCards('hes') > 0;
                        },
                        mod: {
                            cardUsable: function(card, player, num) {
                                if (!card.isCard) return Infinity;
                            },
                        },
                        init: function(player) {
                            lib.translate['ssr_jushou_jiewei_shan'] = '避围';
                            lib.translate['ssr_jushou_jiewei_wuxie'] = '破围';
                            if(!player.storage.ssr_jushou_jiewei) {
                                player.storage.ssr_jushou_jiewei = [];
                            }
                        },
                        chooseButton: {
                            dialog: function(event, player) {
                                var list = [];
                                var enbaleDunName = player.storage.ssr_jushou_defend.map(card =>card.name);
                                //get.info("ssr_jushou").getUsableDun(player).map(card =>card.name);
                                for (var i = 0; i < lib.inpile.length; i++) {
                                    var name = lib.inpile[i];
                                    /*if (!player.storage.ssr_jushou_defend) continue;
                                    var hascard = 0;
                                    for (q = 0; q < player.storage.ssr_jushou_defend.length; q++) {
                                        if (player.storage.ssr_jushou_defend[q].name == name) hascard++;
                                    }
                                    for (q = 0; q < player.storage.ssr_jushou_jiewei.length; q++) {
                                        if (player.storage.ssr_jushou_jiewei[q] == name) hascard--;
                                    }
                                    if (hascard < 1) continue;*/
                                    if(!enbaleDunName.contains(name)) continue;
                                    if (name == 'sha') {
                                        list.push(['基本', '', 'sha']);
                                        for (var j of lib.inpile_nature) list.push(['基本', '', 'sha', j]);
                                    } else if (get.type(name) == 'basic') list.push(['基本', '', name]);
                                    else if (name == 'wuxie') list.push(['锦囊', '', name]);
                                }
                                if (list.length == 0) {
                                    return ui.create.dialog('〖解围〗已无可用牌');
                                }
                                return ui.create.dialog('突出重围', [list, 'vcard']);
                            },
                            filter: function(button, player) {
                                //if (!player.storage.ssr_jushou_defend) return false;
                                var enbaleDunName = get.info("ssr_jushou").getUsableDun(player).map(card =>card.name);
                                if(!enbaleDunName.contains(button.link[2])) return false;
                                return _status.event.getParent().filterCard({
                                    name: button.link[2]
                                },
                                player, _status.event.getParent());
                            },
                            check: function(button) {
                                var player = _status.event.player;
                                if (player.countCards('hs', button.link[2]) > 0) return 0;
                                var effect = player.getUseValue(button.link[2]);
                                if (effect > 0) return effect;
                                return 0;
                            },
                            backup: function(links, player) {
                                return {
                                    filterCard: true,
                                    audio: 'jiewei',
                                    selectCard: 1,
                                    popname: true,
                                    check: function(card) {
                                        return 8 - get.value(card);
                                    },
                                    position: 'hes',
                                    viewAs: {
                                        name: links[0][2],
                                        nature: links[0][3]
                                    },
                                    onuse: function(result, player) {
                                        player.storage.ssr_jushou_jiewei.push(result.card.name);
                                    },
                                }
                            },
                            prompt: function(links, player) {
                                return '将一张牌当做【' + (get.translation(links[0][3]) || '') + get.translation(links[0][2]) + '】使用';
                            },
                        },
                        ai: {
                            save: true,
                            order: 4,
                            result: {
                                player: function(player) {
                                    return 2;
                                },
                            },
                            threaten: 1.9,
                        },
                        //group: ["ssr_jushou_jiewei_use", "ssr_jushou_jiewei_shan", "ssr_jushou_jiewei_wuxie", "ssr_jushou_jiewei_cls"],
                        subSkill: {
                            cls: {
                                trigger: {
                                    player: ["enterGame"/*, "phaseBegin", "phaseAfter"*/],
                                    global: ["gameDrawAfter", "roundStart"],
                                },
                                priority: -6,
                                silent: true,
                                direct: true,
                                forced: true,
                                content: function() {
                                    player.storage.ssr_jushou_jiewei = [];
                                },
                            },
                            use: {
                                trigger: {
                                    player: ["useCard"],
                                },
                                priority: -11,
                                silent: true,
                                forced: true,
                                filter: function(event, player) {
                                    return ! event.card.isCard;
                                },
                                content: function() {
                                    'step 0';
                                    game.delayx();
                                    'step 1';
                                    if (trigger.addCount !== false) {
                                        trigger.addCount = false;
                                        if (trigger.card.name == 'sha') player.getStat().card.sha--;
                                        if (trigger.card.name == 'jiu') player.getStat().card.jiu--;
                                    }
                                },
                            },
                            wuxie: {
                                audio: "xinjiewei",
                                enable: 'chooseToUse',
                                prompt: '将一张牌当做【无懈可击】使用',
                                filter: function(event, player) {
                                    if (!player.storage.ssr_jushou_defend) return false;
                                    var hascard = 0;
                                    for (var i = 0; i < player.storage.ssr_jushou_defend.length; i++) {
                                        if (player.storage.ssr_jushou_defend[i].name == 'wuxie') hascard++;
                                    }
                                    for (var i = 0; i < player.storage.ssr_jushou_jiewei.length; i++) {
                                        if (player.storage.ssr_jushou_jiewei[i] == 'wuxie') hascard--;
                                    }
                                    return player.countCards('hes') && hascard > 0;
                                },
                                viewAsFilter: function(player) {
                                    if (!player.storage.ssr_jushou_defend) return false;
                                    var hascard = 0;
                                    for (var i = 0; i < player.storage.ssr_jushou_defend.length; i++) {
                                        if (player.storage.ssr_jushou_defend[i].name == 'wuxie') hascard++;
                                    }
                                    for (var i = 0; i < player.storage.ssr_jushou_jiewei.length; i++) {
                                        if (player.storage.ssr_jushou_jiewei[i] == 'wuxie') hascard--;
                                    }
                                    return player.countCards('hes') && hascard > 0;
                                },
                                onuse: function(result, player) {
                                    player.storage.ssr_jushou_jiewei.push('wuxie');
                                },
                                filterCard: true,
                                position: 'hes',
                                selectCard: 1,
                                viewAs: {
                                    name: 'wuxie'
                                },
                                check: function(card) {
                                    return 8 - get.value(card);
                                },
                            },
                            shan: {
                                audio: "xinjiewei",
                                prompt: "将一张牌当做【闪】使用",
                                enable: "chooseToUse",
                                filter: function(event, player) {
                                    if (!player.storage.ssr_jushou_defend) return false;
                                    var hascard = 0;
                                    for (var i = 0; i < player.storage.ssr_jushou_defend.length; i++) {
                                        if (player.storage.ssr_jushou_defend[i].name == 'shan') hascard++;
                                    }
                                    for (var i = 0; i < player.storage.ssr_jushou_jiewei.length; i++) {
                                        if (player.storage.ssr_jushou_jiewei[i] == 'shan') hascard--;
                                    }
                                    return player.countCards('hes') && hascard > 0;
                                },
                                onuse: function(result, player) {
                                    player.storage.ssr_jushou_jiewei.push('shan');
                                },
                                filterCard: true,
                                position: "hes",
                                selectCard: 1,
                                viewAs: {
                                    name: "shan",
                                },
                                check: function(card) {
                                    return 8 - get.value(card);
                                },
                                ai: {
                                    skillTagFilter: function(player) {
                                        var hascard = 0;
                                        for (var i = 0; i < player.storage.ssr_jushou_defend.length; i++) {
                                            if (player.storage.ssr_jushou_defend[i].name == 'shan') hascard++;
                                        }
                                        for (var i = 0; i < player.storage.ssr_jushou_jiewei.length; i++) {
                                            if (player.storage.ssr_jushou_jiewei[i] == 'shan') hascard--;
                                        }
                                        return player.countCards('hes') && hascard > 0;
                                    },
                                    threaten: 1.5,
                                    respondShan: true,
                                },
                            },
                        },
                    },
                    "ssr_zhuzhen": {
                        audio: "dcsujun",
                        group: "ssr_zhuzhen_gain",
        				enable: 'phaseUse',
        				filter: function(event, player) {
        				    return player.storage.ssr_jushou_defend?.length && player.storage.ssr_zhuzhen > 0;
        				},
        				filterTarget: function(card,player,target){
        					if(target == player) return false;
        					return true;
        				},
        				init: function(player, skill) {
        				    if(typeof player.storage.ssr_zhuzhen!='number') {
        				        player.storage.ssr_zhuzhen = 2;
        				    }
        				},
        				direct: true,
        				content: function(){
        					'step 0';
                            player.chooseCardButton(player.storage.ssr_jushou_defend, '筑阵：选择将一张“城”交给'+get.translation(target), 1).set('filterButton',
                            function(button) {
                                return true;
                            }).ai = function(button) {
                                var valueList = {
                                    'sha': 5,
                                    'shan': 7,
                                    'tao': 9,
                                    'jiu': 8,
                                    'wuxie': 7,
                                };
                                var value = valueList[button.name] || 6;
                                return value + 5 * Math.random();
                            }
                            'step 1';
                            if (result.bool && result.links?.length) {
                                player.logSkill('ssr_zhuzhen', target);
                                player.storage.ssr_zhuzhen--;
                                player.storage.ssr_jushou_defend.remove(result.links[0]);
                                game.log(player, '将一张', '#r“城”（'+get.translation(result.links[0])+'）', '交给了', target);
                                if (!player.storage.ssr_jushou_defend.length > 0) {
                                    player.unmarkSkill('ssr_jushou_defend');
                                } else {
                                    player.markSkill('ssr_jushou_defend');
                                }
                                if(!target.storage.ssr_jushou_defend) {
                                    target.storage.ssr_jushou_defend = [];
                                }
                                target.storage.ssr_jushou_defend.push(result.links[0]);
                                target.markSkill('ssr_jushou_defend');
                                target.addSkill('ssr_jushou_defend');
                            }
        				},
        				ai:{
        					order: 1,
        					result: {
        						target: function(player,target){
        							if(get.attitude(player, target) < 2) return 0;
        							if(target.hp == 1) return 4;
        							return 3;
        						}
        					},
        				},
        				subSkill: {
        				    gain: {
        				        audio: "dcsujun",
                				trigger: {
                				    player: 'damageEnd',
            				    },
                				filter: function(event, player){
                					return game.hasPlayer(current => {
                					    return current != player && current.storage.ssr_jushou_defend?.length;
                					});
                				},
                				forced: true,
                				priority: -3,
                				content:function(){
                					"step 0";
                					event.players = game.filterPlayer(current => {
                					    return current != player && current.storage.ssr_jushou_defend?.length;
                					}).sortBySeat(player);
                					//game.asyncDraw(event.players.sortBySeat(player));
                					"step 1";
                					if(event.players.length < 1) event.finish();
                					"step 2";
                					event.current = event.players.shift();
                					event.current.draw();
                					"step 3";
                					if(event.current.countCards('h') > 0) {
                					    event.current.chooseCard('h','筑阵：需交给' + get.translation(player) + '一张牌', true).set('ai',function(card){
                                            return 20-get.value(card, event.link);
                                        });
                                    }else {
                                        event.goto(1);
                                    };
                                    "step 4";
                                    if(result.bool && result.cards?.length) {
                                        event.current.give(result.cards, player, 'give');
                					}
                					event.goto(1);
                				},
                				ai:{
                					maixie:true,
                					effect:{
                						target:function(card,player,target){
                							if(get.tag(card,'damage')){
                								if(player.hasSkillTag('jueqing',false,target)) return [1,-2];
                								var draw = game.filterPlayer(current => {
                            					    return current != target && current.storage.ssr_jushou_defend?.length;
                            					}).length;
                            					if(draw > 0 && player.getHp() > 1) {
                            					    if(player.getHp() == 2) return [1, draw * 0.2];
                            					    return [1, draw * 0.4];
                            					}
                							}
                						}
                					}
                				},
                				sub: true,
        				    },
        				},
                    },
                    "ssr_tuntian": {
                        audio: "oltuntian",
                        usable: 1,
                        group: ["ssr_tuntian_gain"],
                        marktext: "田",
                        intro: {
                            name: "养精蓄锐",
                            content: function(storage, player, skill) {
                                var suits = ['spade', 'club', 'heart', 'diamond'];
                                var str = '<li>你拥有的“田”：';
                                var num = 0;
                                for (var i = 0; i < suits.length; i++) {
                                    if (storage.contains(suits[i])) {
                                        if (num > 0) str += '、';
                                        str += get.translation(suits[i]);
                                        num++;
                                    }
                                }
                                return str;
                            },
                        },
                        complexCard: true,
                        enable: "phaseUse",
                        position: "he",
                        selectCard: 2,
                        filterCard: function(card, player) {
                            //if(get.type(card)!='basic') return false;
                            var marks = player.storage.ssr_tuntian;
                            if (marks && marks.length > 0) {
                                for (var i = 0; i < marks.length; i++) {
                                    if (marks[i] == get.suit(card)) return false;
                                }
                            }
                            if (ui.selected.cards.length) {
                                if (get.suit(card) != get.suit(ui.selected.cards[0])) return false;
                            }
                            var cards = player.getCards('he');
                            for (var i = 0; i < cards.length; i++) {
                                if (card != cards[i]) {
                                    if (get.suit(card) == get.suit(cards[i])) return true;
                                }
                            }
                            return false;
                        },
                        filter: function(event, player) {
                            if (player.storage.ssr_tuntian && player.storage.ssr_tuntian.length >= 4) return false;
                            var marks = player.storage.ssr_tuntian;
                            var suits = ['spade', 'club', 'diamond', 'heart'];
                            if (marks && marks.length > 0) {
                                for (var i = 0; i < suits.length; i++) {
                                    var blank = 1;
                                    for (var j = 0; j < marks.length; j++) {
                                        if (marks[j] == suits[i]) blank = 0;
                                    }
                                    if (blank == 1 && player.countCards('he', {
                                        suit: suits[i]
                                    }) >= 2) return true;
                                }
                                return false;
                            }
                            for (var i = 0; i < suits.length; i++) {
                                if (player.countCards('he', {
                                    suit: suits[i]
                                }) >= 2) return true;
                            }
                            return false;
                        },
                        check: function(card) {
                            return 7 - get.value(card);
                        },
                        discard: false,
                        lose: false,
                        content: function() {
                            player.discard(cards);
                            if (!player.storage.ssr_tuntian) player.storage.ssr_tuntian = [];
                            player.storage.ssr_tuntian.push(cards[0].suit);
                            /*player.lose(cards,ui.special,'toStorage');
					        if(!player.storage.ssr_tuntian) player.storage.ssr_tuntian=[];
					        player.storage.ssr_tuntian.addArray(cards);*/
                            player.markSkill('ssr_tuntian');
                        },
                        ai: {
                            order: 1,
                            result: {
                                player: 1,
                            },
                        },
                        subSkill: {
                            gain: {
                                audio: "tuntian",
                                trigger: {
                                    player: ["damageEnd", "phaseEnd"],
                                },
                                priority: 2,
                                frequent: true,
                                filter: function(event, player) {
                                    return (player.storage.ssr_tuntian && player.storage.ssr_tuntian.length > 0 && (event.name != 'damage' || event.num > 0));
                                },
                                content: function() {
                                    "step 0";
                                    event.count = trigger.name == 'damage' ? trigger.num: 1;
                                    "step 1";
                                    event.count--;
                                    event.cards = get.cards(player.storage.ssr_tuntian.length);
                                    "step 2";
                                    if (event.cards.length > 1) {
                                        player.chooseCardButton('屯田：选择一张牌并交给一名角色', true, event.cards, 1).set('ai',
                                        function(button) {
                                            return get.value(button);
                                        });
                                    } else if (event.cards.length == 1) {
                                        event._result = {
                                            links: event.cards.slice(0),
                                            bool: true
                                        };
                                    } else {
                                        event.goto(5);
                                    }
                                    "step 3";
                                    if (result.bool) {
                                        for (var i = 0; i < result.links.length; i++) {
                                            event.cards.remove(result.links[i]);
                                        }
                                        event.togive = result.links.slice(0);
                                        player.chooseTarget(get.prompt2('ssr_tuntian'), '将' + get.translation(result.links) + '交给一名角色', true).set('ai',
                                        function(target) {
                                            var att = get.attitude(_status.event.player, target);
                                            if (_status.event.enemy) {
                                                return - att;
                                            } else if (att > 0) {
                                                return att / (1 + target.countCards('h'));
                                            } else {
                                                return att / 100;
                                            }
                                        }).set('enemy', get.value(event.togive[0], player, 'raw') < 0);
                                    }
                                    "step 4";
                                    if (result.targets.length) {
                                        result.targets[0].gain(event.togive, 'draw');
                                        player.line(result.targets[0], 'green');
                                        game.log(result.targets[0], '获得了' + get.cnNumber(event.togive.length) + '张牌');
                                        event.goto(5);
                                    }
                                    "step 5";
                                    if (event.count > 0) player.chooseBool(get.prompt2(event.name)).set('frequentSkill', event.name);
                                    else {
                                        if (event && event.finish) {
                                            event.finish();
                                        } else {
                                            return;
                                        }
                                    }
                                    "step 6";
                                    if (result.bool) {
                                        player.logSkill(event.name);
                                        event.goto(1);
                                    }
                                },
                                ai: {
                                    maixie: true,
                                    "maixie_hp": true,
                                    effect: {
                                        target: function(card, player, target) {
                                            if (player.hasSkillTag('jueqing', false, target)) return [1, -1];
                                            if (get.tag(card, 'damage')) return [1, 0.55];
                                        },
                                    },
                                },
                                sub: true,
                            },
                        },
                    },
                    "ssr_zaoxian": {
                        skillAnimation: true,
                        animationColor: "thunder",
                        audio: "dctuoyu",
                        unique: true,
                        juexingji: true,
                        trigger: {
                            player: "phaseZhunbeiBegin",
                        },
                        forced: true,
                        priority: 15,
                        filter: function(event, player) {
                            if (player.storage.ssr_tuntian) return player.storage.ssr_tuntian.length >= 4 && !player.storage.ssr_zaoxian;
                        },
                        derivation: "ssr_jixi",
                        content: function() {
                            player.loseMaxHp();
                            player.changeHujia(1, null, true);
                            player.addSkill('ssr_jixi');
                            //player.gain(player.storage.ssr_tuntian,'draw');
                            //player.storage.ssr_tuntian=[];
                            player.unmarkSkill('ssr_tuntian');
                            player.storage.ssr_zaoxian = true;
                            player.awakenSkill('ssr_zaoxian');
                        },
                    },
                    "ssr_jixi": {
                        audio: "olzaoxian",
                        trigger: {
                            player: "phaseUseBegin",
                        },
                        direct: true,
                        filter: function(event, player) {
                            return true;
                        },
                        priority: 5,
                        content: function() {
                            "step 0";
                            var check;
                            var i, num = game.countPlayer(function(current) {
                                return current != player && current.countCards('he') && get.attitude(player, current) <= 0 && get.distance(player, current) <= (2 + player.getDamagedHp());
                            });
                            check = (num >= 1);
                            player.chooseTarget(get.prompt('ssr_jixi'), '获得与你距离不大于' + get.cnNumber(2 + player.getDamagedHp(), true) + '的一名其他角色的一张牌', 1,
                            function(card, player, target) {
                                return target.countCards('he') > 0 && player != target && get.distance(player, target) <= (2 + player.getDamagedHp());
                            },
                            function(target) {
                                if (!_status.event.aicheck) return 0;
                                var att = get.attitude(_status.event.player, target);
                                if (target.hasSkill('tuntian')) return att / 10;
                                return 1 - att;
                            }).set('aicheck', check);
                            "step 1";
                            if (result.bool) {
                                player.logSkill('ssr_jixi', result.targets);
                                player.gainMultiple(result.targets, 'he');
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            "step 2";
                            game.delay();
                        },
                        ai: {
                            threaten: 1.7,
                            expose: 0.3,
                        },
                    },
                    "ssr_hengzheng": {
                        audio: "dcjuchui",
                        trigger: {
                            player: "phaseDrawBegin1",
                        },
                        filter: function(event, player) {
                            return ! event.numFixed;
                        },
                        derivation: "ssr_taofa",
                        priority: -5,
                        forced: true,
                        content: function() {
                            "step 0";
                            event.cards = get.cards(1);
                            event.draw = trigger.num;
                            trigger.changeToZero();
                            var targets = game.filterPlayer();
                            targets.remove(player);
                            targets.sort(lib.sort.seat);
                            event.targets = targets;
                            event.num = 0;
                            player.line(targets, 'green');
                            "step 1";
                            if (event.num < event.targets.length) {
                                if (event.targets[event.num].countCards('he') > 0) {
                                    player.choosePlayerCard(event.targets[event.num], 'he', true);
                                    //player.gainPlayerCard(event.targets[num],'he',true);
                                } else {
                                    event.num++;
                                    event.redo();
                                }
                            } else {
                                event.goto(3);
                            }
                            "step 2";
                            event.cards = event.cards.concat(result.links);
                            event.targets[event.num].lose(result.links, ui.special);
                            event.targets[event.num].$give(result.links, player, false);
                            if (get.type(result.links[0]) == 'equip' && !event.targets[event.num].hasSkill("ssr_taofa")) event.targets[event.num].addTempSkill("ssr_taofa", {
                                player: ['die']
                            });
                            event.num++;
                            event.goto(1);
                            "step 3";
                            if (event.draw < 1 || event.cards.length < 1) {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                            "step 4";
                            //get.value(button.link,_status.event.player);
                            game.cardsGotoOrdering(event.cards);
                            event.videoId = lib.status.videoId++;
                            event.drawnum = Math.min(event.draw, event.cards.length);
                            game.broadcastAll(function(player, id, cards) {
                                var str;
                                if (player == game.me && !_status.auto) {
                                    str = '横征：选择获得其中至多' + get.cnNumber(event.drawnum) + '张牌';
                                } else {
                                    str = '横征';
                                }
                                var dialog = ui.create.dialog(str, cards);
                                dialog.videoId = id;
                            },
                            player, event.videoId, event.cards);
                            event.time = get.utc();
                            game.addVideo('showCards', player, ['横征', get.cardsInfo(event.cards)]);
                            game.addVideo('delay', null, 2);
                            "step 5";
                            var next = player.chooseButton([1, event.drawnum]);
                            next.set('dialog', event.videoId);
                            next.set('filterButton',
                            function(button) {
                                return true;
                                for (var i = 0; i < ui.selected.buttons.length; i++) {
                                    if (get.suit(ui.selected.buttons[i].link) == get.suit(button.link)) return false;
                                }
                            });
                            next.set('ai',
                            function(button) {
                                //return get.value(button.link,_status.event.player);
                                return get.value(button.link, player);
                            });
                            "step 6";
                            game.broadcastAll('closeDialog', event.videoId);
                            if (result.bool && result.links) {
                                event.cards2 = result.links;
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            var time = 1000 - (get.utc() - event.time);
                            if (time > 0) {
                                game.delay(0, time);
                            }
                            "step 7";
                            var cards2 = event.cards2;
                            player.gain(cards2, 'log', 'gain2');
                        },
                        ai: {
                            noh: true,
                            skillTagFilter: function(player, tag) {
                                if (tag == 'noh') {
                                    if (player.countCards('h') != 1) return false;
                                }
                            },
                            threaten: function(player, target) {
                                return 2.3;
                            },
                        },
                    },
                    "ssr_newhengzheng": {
                        subSkill: {
                            draw: {
                                trigger: {
                                    player: 'phaseDrawBegin1'
                                },
                                forced: true,
                                filter: function(event, player) {
                                    return player.getHp() < player.maxHp * 0.5 && !event.numFixed;
                                },
                                priority: 5,
                                content: function() {
                                    trigger.num++;
                                },
                                sub: true,
                            },
                        },
                        //group: 'ssr_newhengzheng_draw',
                        audio: "dcjuchui",
                        trigger: {
                            player: "phaseDrawBegin2",
                        },
                        filter: function(event, player) {
                            return ! event.numFixed;
                        },
                        derivation: "ssr_taofa",
                        priority: -5,
                        forced: true,
                        content: function() {
                            "step 0";
                            event.cards = get.cards(1);
                            event.draw = trigger.num;
                            trigger.changeToZero();
                            var targets = game.filterPlayer();
                            targets.remove(player);
                            targets.sort(lib.sort.seat);
                            event.targets = targets;
                            event.num = 0;
                            player.line(targets, 'green');
                            player.chooseControl('手牌区', '装备区', '判定区').set('ai',
                            function() {
                                if (game.hasPlayer(function(current) {
                                    return current.countCards('j') && current != player && get.attitude(player, current) > 0;
                                })) return 2;
                                return Math.floor(Math.random() * 3);
                            }).set('prompt', '请选择优先获得的区域');
                            "step 1";
                            event.range = {手牌区: ['h', 'e', 'j'],
                                装备区: ['e', 'h', 'j'],
                                判定区: ['j', 'h', 'e'],
                            } [result.control || '手牌区'];
                            "step 2";
                            if (event.num < event.targets.length) {
                                if (event.targets[event.num].countCards('hej') > 0) {
                                    var target = event.targets[event.num];
                                    var range = event.range;
                                    for (var i = 0; i < range.length; i++) {
                                        var cards = target.getCards(range[i]);
                                        if (cards.length) {
                                            var card = cards.randomGet();
                                            event.links = [card];
                                            //player.gain(card,target,'giveAuto','bySelf');
                                            break;
                                        }
                                    }
                                } else {
                                    event.num++;
                                    event.redo();
                                }
                            } else {
                                event.goto(4);
                            }
                            "step 3";
                            event.cards = event.cards.concat(event.links);
                            event.targets[event.num].lose(event.links, ui.special);
                            event.targets[event.num].$give(event.links, player, false);
                            if (get.type(event.links[0]) == 'equip' && !event.targets[event.num].hasSkill("ssr_taofa")) event.targets[event.num].addTempSkill("ssr_taofa", {
                                player: ['die']
                            });
                            event.num++;
                            event.goto(2);
                            "step 4";
                            if (event.draw < 1 || event.cards.length < 1) {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                            "step 5";
                            //get.value(button.link,_status.event.player);
                            game.cardsGotoOrdering(event.cards);
                            event.videoId = lib.status.videoId++;
                            event.drawnum = Math.min(event.draw, event.cards.length);
                            game.broadcastAll(function(player, id, cards) {
                                var str;
                                if (player == game.me && !_status.auto) {
                                    str = '横征：选择获得其中至多' + get.cnNumber(event.drawnum) + '张牌';
                                } else {
                                    str = '横征';
                                }
                                var dialog = ui.create.dialog(str, cards);
                                dialog.videoId = id;
                            },
                            player, event.videoId, event.cards);
                            event.time = get.utc();
                            game.addVideo('showCards', player, ['横征', get.cardsInfo(event.cards)]);
                            game.addVideo('delay', null, 2);
                            "step 6";
                            var next = player.chooseButton([1, event.drawnum]);
                            next.set('dialog', event.videoId);
                            next.set('filterButton',
                            function(button) {
                                return true;
                                for (var i = 0; i < ui.selected.buttons.length; i++) {
                                    if (get.suit(ui.selected.buttons[i].link) == get.suit(button.link)) return false;
                                }
                            });
                            next.set('ai',
                            function(button) {
                                //return get.value(button.link,_status.event.player);
                                return get.value(button.link, player);
                            });
                            "step 7";
                            game.broadcastAll('closeDialog', event.videoId);
                            if (result.bool && result.links) {
                                event.cards2 = result.links;
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            var time = 1000 - (get.utc() - event.time);
                            if (time > 0) {
                                game.delay(0, time);
                            }
                            "step 8";
                            var cards2 = event.cards2;
                            player.gain(cards2, 'log', 'gain2');
                        },
                        ai: {
                            noh: true,
                            skillTagFilter: function(player, tag) {
                                if (tag == 'noh') {
                                    if (player.countCards('h') != 1) return false;
                                }
                            },
                            threaten: function(player, target) {
                                return 2.3;
                            },
                        },
                    },
                    "ssr_taofa_audio": game.zuanSetSSRAudio('benghuai_re_dongzhuo', 2),
                    "ssr_taofa": {
                        audio: "benghuai_re_dongzhuo",
                        trigger: {
                            source: "damageBefore",
                        },
                        filter: function(event, player) {
                            return event.player.hasSkill("ssr_newhengzheng") && event.card && event.card.name == 'sha';
                        },
                        forced: true,
                        preHidden: true,
                        mark: true,
                        marktext: "讨伐",
                        intro: {
                            name: "讨伐强权",
                            content: "你对拥有〖横征〗的角色：【杀】造成的伤害加一，距离始终视为减二。",
                        },
                        mod: {
                            globalFrom: function(from, to) {
                                if (to.hasSkill("ssr_newhengzheng")) return - 2;
                            },
                        },
                        content: function() {
                            trigger.num++;
                            player.removeSkill("ssr_taofa");
                        },
                    },
                    "ssr_baonue_audio": game.zuanSetSSRAudio('baonue2_re_dongzhuo', 2),
                    "ssr_baonue": {
                        audio: "baonue2_re_dongzhuo",
                        trigger: {
                            player: "useCardToPlayered",
                            target: "useCardToTargeted",
                        },
                        forced: true,
                        filter: function(event, player) {
                            if (event.card.name != 'sha') return false;
                            return player.getHp() > 2;
                        },
                        check: function(event, player) {
                            return player == event.player;
                        },
                        content: function() {
                            var id = (player == trigger.player ? trigger.target: player).playerid;
                            var map = trigger.getParent().customArgs;
                            if (!map[id]) map[id] = {};
                            if (typeof map[id].shanRequired == 'number') {
                                map[id].shanRequired++;
                            } else {
                                map[id].shanRequired = 2;
                            }
                        },
                        ai: {
                            "directHit_ai": true,
                            skillTagFilter: function(player, tag, arg) {
                                if (arg.card.name != 'sha' || arg.target.countCards('h', 'shan') > 1 || arg.target.getHp() <= 2) return false;
                            },
                        },
                    },
                    "ssr_newjiuchi_audio": game.zuanSetSSRAudio('jiuchi_re_dongzhuo', 2),
                    "ssr_newjiuchi": {
                        trigger: {
                            global: 'phaseUseBegin'
                        },
                        frequent: true,
                        filter: function(event, player) {
                            return event.player != player && event.player.group == 'qun' && event.player.hasSkill('ssr_taofa') && player.hasZhuSkill('ssr_newjiuchi');
                        },
                        audio: 'jiuchi_re_dongzhuo',
                        zhuSkill: true,
                        direct: true,
                        priority: 3,
                        content: function() {
                            'step 0';
                            trigger.player.chooseBool(get.prompt2('ssr_newjiuchi')).ai = function() {
                                return get.attitude(trigger.player, player) > 0 && player.hasSha();
                            };
                            'step 1';
                            if (result.bool) {
                                trigger.player.line(player, 'gray');
                                trigger.player.logSkill('ssr_newjiuchi', player);
                                player.draw();
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            'step 2';
                            trigger.player.removeSkill('ssr_taofa');
                            trigger.player.chooseUseTarget({
                                name: 'jiu'
                            },
                            true, 'noTargetDelay', 'nodelayx');
                        },
                    },
                    "ssr_jiuchi": {
                        unique: true,
                        global: "ssr_jiuchi_jiu",
                        audio: "jiuchi",
                        zhuSkill: true,
                        subSkill: {
                            jiu: {
                                audio: "jiuchi",
                                trigger: {
                                    player: "useCardAfter",
                                },
                                filter: function(event, player) {
                                    if (event.card.name != 'jiu') return false;
                                    if (player.group != 'qun') return false;
                                    //if(_status.currentPhase!=player) return false;
                                    if (!game.hasPlayer(function(target) {
                                        return player != target && target.hasZhuSkill('ssr_jiuchi', player);
                                    })) return false;
                                    for (var i = 0; i < event.cards.length; i++) {
                                        if (get.position(event.cards[i], true) == 'o') {
                                            return true;
                                        }
                                    }
                                    return false;
                                },
                                direct: true,
                                content: function() {
                                    'step 0';
                                    var list = game.filterPlayer(function(target) {
                                        return player != target && target.hasZhuSkill('ssr_jiuchi', player);
                                    });
                                    player.chooseTarget(get.prompt('ssr_jiuchi'), '将' + get.translation(trigger.cards) + '交给' + get.translation(list) + (list.length > 1 ? '中的一人': ''),
                                    function(card, player, target) {
                                        return player != target && target.hasZhuSkill('ssr_jiuchi', player);
                                    }).ai = function(target) {
                                        return 1;
                                        if (get.attitude(_status.event.player, target) >= 0) {
                                            return target.hp - 3;
                                        } else {
                                            return 1;
                                        }
                                    };
                                    'step 1';
                                    if (!result.bool) {
                                        if (event && event.finish) {
                                            event.finish();
                                        } else {
                                            return;
                                        }
                                    } else {
                                        var zhu = result.targets[0];
                                        player.line(zhu, 'green');
                                        zhu.logSkill('ssr_jiuchi');
                                        var list = [];
                                        for (var i = 0; i < trigger.cards.length; i++) {
                                            if (get.position(trigger.cards[i], true) == 'o') {
                                                list.push(trigger.cards[i]);
                                            }
                                        }
                                        player.give(list, zhu);
                                        zhu.loseHp();
                                        zhu.chooseBool().set('ai',
                                        function() {
                                            if (get.attitude(zhu, player) > 0) return true;
                                            return false;
                                        }).set('prompt', '是否令' + get.translation(player.name) + '摸两张牌？');
                                    }
                                    'step 2';
                                    if (result.bool) {
                                        player.draw(2);
                                    }
                                },
                                sub: true,
                            },
                        },
                    },
                    "ssr_newguhuo": {
                        trigger: {
                            player: "phaseJieshuBegin",
                        },
                        direct: true,
                        audio: 2,
                        init: function(player) {
                            if (!player.storage.ssr_newguhuo) player.storage.ssr_newguhuo = [];
                            if (!player.storage.ssr_newguhuo_use) player.storage.ssr_newguhuo_use = [];
                        },
                        filter: function(event, player) {
                            return player.countCards('he') > 0;
                        },
                        onremove: function(player, skill) {
                            var cards = player.getExpansions(skill);
                            if (cards.length) player.loseToDiscardpile(cards);
                        },
                        intro: {
                            content: "cards",
                            onunmark: function(storage, player) {
                                player.storage.ssr_newguhuo = [];
                                player.storage.ssr_newguhuo_use = [];
                            },
                            mark: function(dialog, content, player) {
                                if (content && content.length) {
                                    dialog.addAuto(content);
                                    if (player.isUnderControl(true)) {
                                        var str = '';
                                        for (var i = 0; i < player.storage.ssr_newguhuo_use.length; i++) {
                                            str += get.translation(player.storage.ssr_newguhuo_use[i]);
                                            if (i < player.storage.ssr_newguhuo_use.length - 1) {
                                                str += '、';
                                            }
                                        }
                                        dialog.add('<div class="text center">' + str + '</div>')
                                    }
                                }
                            },
                        },
                        content: function() {
                            'step 0';
                            var list1 = [],
                            list2 = [],
                            list3 = [];
                            for (var i = 0; i < lib.inpile.length; i++) {
                                var type = get.type(lib.inpile[i]);
                                if (type == 'basic') {
                                    list1.push(['基本', '', lib.inpile[i]]);
                                } else if (type == 'trick') {
                                    list2.push(['锦囊', '', lib.inpile[i]]);
                                } else if (type == 'delay') {
                                    list3.push(['锦囊', '', lib.inpile[i]]);
                                }
                            }
                            player.chooseButton([get.prompt('ssr_newguhuo'), [list1.concat(list2).concat(list3), 'vcard']]).set('filterButton',
                            function(button) {
                                var player = _status.event.player;
                                if (player.storage.ssr_newguhuo_use && player.storage.ssr_newguhuo_use.contains(button.link[2])) return false;
                                return true;
                            }).set('ai',
                            function(button) {
                                var rand = _status.event.rand;
                                switch (button.link[2]) {
                                case 'sha':
                                    return 5 + rand[1];
                                case 'tao':
                                    return 4 + rand[2];
                                case 'lebu':
                                    return 3 + rand[3];
                                case 'shan':
                                    return 4.5 + rand[4];
                                case 'wuzhong':
                                    return 4 + rand[5];
                                case 'shunshou':
                                    return 3 + rand[6];
                                case 'nanman':
                                    return 2 + rand[7];
                                case 'wanjian':
                                    return 2 + rand[8];
                                default:
                                    return rand[0];
                                }
                            }).set('rand', [Math.random(), Math.random(), Math.random(), Math.random(), Math.random(), Math.random(), Math.random(), Math.random(), Math.random()]);
                            'step 1';
                            if (result.bool) {
                                event.cardname = result.links[0][2];
                                player.logSkill('ssr_newguhuo');
                                player.chooseCard('he', '选择一张牌作为“伏兵”', true);
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            'step 2';
                            if (result.bool) {
                                var card = result.cards[0];
                                event.card = card;
                                player.addToExpansion(card, player, 'give').gaintag.add('ssr_newguhuo');
                            }
                            'step 3';
                            if (player.getExpansions('ssr_newguhuo').contains(event.card)) {
                                player.storage.ssr_newguhuo.push(card);
                                player.storage.ssr_newguhuo_use.push(event.cardname);
                                if (player.isOnline2()) {
                                    player.send(function(storage) {
                                        game.me.storage.ssr_newguhuo_use = storage;
                                    },
                                    player.storage.ssr_newguhuo_use);
                                }
                                player.syncStorage('ssr_newguhuo');
                                player.markSkill('ssr_newguhuo');
                            }
                        },
                        group: ["ssr_newguhuo_use"],
                        subSkill: {
                            use: {
                                trigger: {
                                    global: ["useCard"],
                                },
                                audio: "ssr_newguhuo",
                                filter: function(event, player) {
                                    if (_status.currentPhase == player || event.player == player) return false;
                                    return player.storage.ssr_newguhuo_use && player.storage.ssr_newguhuo_use.contains(event.card.name) && event.player.getHistory('lose',
                                    function(evt) {
                                        return evt.getParent() == event && evt.hs && evt.hs.length == event.cards.length;
                                    }).length;
                                },
                                direct: true,
                                content: function() {
                                    "step 0";
                                    var effect = 0;
                                    if (trigger.card.name == 'wuxie' || trigger.card.name == 'shan') {
                                        if (get.attitude(player, trigger.player) < -1) {
                                            effect = -1;
                                        }
                                    } else if (trigger.targets && trigger.targets.length) {
                                        for (var i = 0; i < trigger.targets.length; i++) {
                                            effect += get.effect(trigger.targets[i], trigger.card, trigger.player, player);
                                        }
                                    }
                                    var str = '秘咒：是否令' + get.translation(trigger.player);
                                    if (trigger.targets && trigger.targets.length) {
                                        str += '对' + get.translation(trigger.targets);
                                    }
                                    str += '使用的' + get.translation(trigger.card) + '失效？'
                                    var next = player.chooseBool(str,
                                    function() {
                                        var player = _status.event.player;
                                        var trigger = _status.event.getTrigger();
                                        if (_status.event.effect < 0) {
                                            if (trigger.card.name == 'sha') {
                                                var target = trigger.targets[0];
                                                if (target == player) {
                                                    return ! player.countCards('h', 'shan');
                                                } else {
                                                    return target.hp == 1 || (target.countCards('h') <= 2 && target.hp <= 2);
                                                }
                                            } else {
                                                return true;
                                            }
                                        }
                                        return false;
                                    });
                                    next.set('effect', effect);
                                    "step 1";
                                    if (result.bool) {
                                        player.logSkill('ssr_newguhuo', trigger.player);
                                        var index = player.storage.ssr_newguhuo_use.indexOf(trigger.card.name);
                                        if (index != -1) {
                                            var card = player.storage.ssr_newguhuo[index];
                                            player.loseToDiscardpile(card);
                                            player.storage.ssr_newguhuo.splice(index, 1);
                                            player.storage.ssr_newguhuo_use.splice(index, 1);
                                            if (player.storage.ssr_newguhuo.length == 0) {
                                                player.unmarkSkill('ssr_newguhuo');
                                            } else {
                                                player.syncStorage('ssr_newguhuo');
                                                player.markSkill('ssr_newguhuo');
                                                if (player.isOnline2()) {
                                                    player.send(function(storage) {
                                                        game.me.storage.ssr_newguhuo_use = storage;
                                                    },
                                                    player.storage.ssr_newguhuo_use);
                                                }
                                            }
                                        }
                                        trigger.targets.length = 0;
                                        trigger.all_excluded = true;
                                        if (trigger.player == _status.currentPhase) trigger.player.addTempSkill('baiban');
                                    }
                                },
                                ai: {
                                    threaten: 1.8,
                                    expose: 0.3,
                                },
                                sub: true,
                            },
                        },
                    },
                    "ssr_newmizhou": {
                        audio: "reguhuo",
                        group: ["ssr_newmizhou_use", "ssr_newmizhou_change"],
                        marktext: "箓",
                        intro: {
                            name: "法箓秘咒",
                            mark: function(dialog, content, player) {
                                if (content && content.length) {
                                    if (player == game.me || player.isUnderControl() || player.classList.contains('dead') == true) {
                                        dialog.addAuto(content);
                                    } else {
                                        return '<li>共有' + get.cnNumber(content.length) + '张牌';
                                    }
                                }
                            },
                            content: function(content, player) {
                                if (content && content.length) {
                                    if (player == game.me || player.isUnderControl() || player.classList.contains('dead') == true) {
                                        return get.translation(content);
                                    }
                                    return '<li>共有' + get.cnNumber(content.length) + '张牌';
                                }
                            },
                        },
                        complexCard: true,
                        enable: "phaseUse",
                        filterCard: function(card, player) {
                            if (player.storage.ssr_newmizhou.length >= 4) return false;
                            return true;
                        },
                        selectCard: 1,
                        filter: function(event, player) {
                            if (player.storage.ssr_newmizhou.length >= 4) return false;
                            return player.countCards('h') > 0;
                        },
                        check: function(card) {
                            //var player=_status.event.player;
                            return 9 - get.value(card);
                        },
                        discard: false,
                        lose: false,
                        init: function(player) {
                            player.storage.ssr_newmizhou = [];
                        },
                        content: function() {
                            "step 0";
                            var list1 = [],
                            list2 = [],
                            list3 = [];
                            for (var i = 0; i < lib.inpile.length; i++) {
                                var type = get.type(lib.inpile[i]);
                                if (type == 'basic') {
                                    list1.push(['基本', '', lib.inpile[i]]);
                                } else if (type == 'trick') {
                                    list2.push(['锦囊', '', lib.inpile[i]]);
                                } else if (type == 'delay') {
                                    list3.push(['锦囊', '', lib.inpile[i]]);
                                }
                            }
                            var str = '秘咒：请选择要对 ' + get.translation(cards) + ' 声明的牌';
                            player.chooseButton([str, [list1.concat(list2).concat(list3), 'vcard']]).set('filterButton',
                            function(button) {
                                var player = _status.event.player;
                                //if(player.storage.ssr_newmizhou_use&&player.storage.ssr_newmizhou_use.contains(button.link[2])) return false;
                                return true;
                            }).set('ai',
                            function(button) {
                                var val = 0;
                                var type1 = get.type(button.link) == 'delay' ? 'trick': 'delay';
                                var type2 = get.type(cards[0]) == 'delay' ? 'trick': 'delay';
                                if (button.link[2] == cards[0].name) {
                                    val += 3;
                                } else if (type1 == type2) {
                                    val += 1.5;
                                }
                                var storage = player.storage.ssr_newmizhou.length;
                                if (storage.length > 0) {
                                    for (var a = 0; a < storage.length; a++) {
                                        if (get.suit(storage[i]) == button.link[2]) val -= 2;
                                    }
                                }
                                var rand = _status.event.rand;
                                switch (button.link[2]) {
                                case 'sha':
                                    return val + 5 + rand[1];
                                case 'tao':
                                    return val + 4 + rand[2];
                                case 'lebu':
                                    return val + 3 + rand[3];
                                case 'shan':
                                    return val + 4.5 + rand[4];
                                case 'wuzhong':
                                    return val + 4 + rand[5];
                                case 'shunshou':
                                    return val + 3 + rand[6];
                                case 'nanman':
                                    return val + 2 + rand[7];
                                case 'wanjian':
                                    return val + 2 + rand[8];
                                default:
                                    return val + rand[0];
                                }
                            }).set('rand', [Math.random(), Math.random(), Math.random(), Math.random(), Math.random(), Math.random(), Math.random(), Math.random(), Math.random()]);
                            "step 1";
                            if (result.bool) {
                                event.yuansu = ['duanchang', 'fenghou', 'gouwen', 'qinghua', 'zhenjiu'];
                                event.yuansuname = ['断肠', '封喉', '钩吻', '情花', '鸩酒'];
                                event.mizhou = [];
                                for (var i = 0; i < event.yuansu.length; i++) {
                                    var name = event.yuansu[i];
                                    lib.card['mizhou_' + name] = {
                                        fullskin: true,
                                        image: 'ext:祖安武将/card/mizhou_' + name + '.png',
                                        opacity: 1,
                                        textShadow: 'black 0 0 2px',
                                    };
                                    lib.translate['mizhou_' + name] = event.yuansuname[i];
                                    lib.translate['mizhou_' + name + '_info'] = "<li>法箓秘咒";
                                    event.mizhou.push(game.createCard({
                                        name: 'mizhou_' + name,
                                        number: "秘",
                                        suit: "咒"
                                    }));
                                }
                                event.cardname = result.links[0][2];
                                player.lose(cards, ui.special, 'toStorage');
                                var lose = cards[0];
                                //event.suity=['♠','♣','♥','♦'];
                                //event.suitn=['♤','♧','♡','♢'];
                                var card = game.createCard({
                                    name: lose.name,
                                    suit: event.cardname,
                                    number: get.translation(get.suit(lose))
                                });
                                card.realsuit = get.suit(lose);
                                player.$gain2(event.mizhou.randomGet(), false);
                                //player.show([card]);
                                player.storage.ssr_newmizhou.push(card);
                                player.markSkill('ssr_newmizhou');
                            }
                        },
                        ai: {
                            order: 3,
                            result: {
                                player: 1,
                            },
                        },
                        subSkill: {
                            change: {
                                //enable:'phaseUse',
                                trigger: {
                                    player: "phaseJieshuBegin",
                                },
                                filter: function(event, player) {
                                    if (player.storage.ssr_newmizhou.length < 1) return false;
                                    var storage = player.storage.ssr_newmizhou;
                                    for (var i = 0; i < storage.length; i++) {
                                        if (storage[i].realsuit != 'gu') return true;
                                    }
                                    return false;
                                },
                                forced: true,
                                priority: -6,
                                content: function() {
                                    "step 0";
                                    event.storage = player.storage.ssr_newmizhou;
                                    event.num = 0;
                                    "step 1";
                                    if (event.num >= event.storage.length) {
                                        if (event && event.finish) {
                                            event.finish();
                                        } else {
                                            return;
                                        }
                                    }
                                    //var storage=event.storage[event.num];
                                    //alert(storage.realsuit);
                                    "step 2";
                                    var storage = event.storage[event.num];
                                    if (storage.realsuit != 'gu') {
                                        var mark = lib.card[storage.name];
                                        var shen = lib.card[storage.suit];
                                        //alert(storage.suit);
                                        var type1 = mark.type == 'delay' ? 'trick': mark.type;
                                        var type2 = shen.type == 'delay' ? 'trick': shen.type;
                                        //alert(type1==type2);
                                        var suit = storage.realsuit;
                                        /*var transuit=['spade','club','heart','diamond'];
					                    var suit='none';
					                    for(var i=0;i<transuit.length;i++) {
					                        if(nsuit==get.translation(transuit[i])) {
					                            suit=transuit[i];
					                        }
					                    }*/
                                        var judge = game.createCard({
                                            name: 'sha',
                                            number: 13,
                                            suit: suit
                                        });
                                        if (storage.name == storage.suit) {
                                            var check = 'none';
                                            var info2 = '无条件';
                                        } else if (type1 == type2) {
                                            var check = 'color';
                                            var info2 = get.translation(get[check](judge)) + '的';
                                        } else {
                                            var check = 'suit';
                                            var info2 = get.translation(get[check](judge)) + '花色';
                                        }
                                        var info = game.createCard({
                                            name: storage.name,
                                            number: '箓',
                                            suit: suit
                                        });
                                        if (!_status.auto && (player == game.me || player.isUnderControl())) {
                                            var str = ' 在进行【' + get.translation(info) + '】' + info2 + ' ';
                                        } else {
                                            var str = ' 在进行“箓”的';
                                        }
                                        str += '判定';
                                        player.judge(str,
                                        function(card) {
                                            if (check == 'none') return 2;
                                            if (get[check](card) == get[check](judge)) return 2;
                                            return - 0.5;
                                        }).judge2 = function(result) {
                                            return result.bool;
                                        };
                                    } else {
                                        event.goto(4);
                                    }
                                    "step 3";
                                    if (result.bool) {
                                        var gucard = game.createCard({
                                            name: event.storage[event.num].suit,
                                            number: '☬',
                                            suit: '蛊',
                                            nature: 'poison'
                                        });
                                        gucard.realsuit = 'gu';
                                        player.storage.ssr_newmizhou[event.num] = gucard;
                                    }
                                    "step 4";
                                    event.num++;
                                    event.goto(1);
                                },
                            },
                            use: {
                                audio: "reguhuo",
                                trigger: {
                                    global: ["useCard", "respond"],
                                },
                                check: function(event, player) {
                                    return get.attitude(player, event.player) < 0;
                                },
                                priority: 15,
                                direct: true,
                                filter: function(event, player) {
                                    /*if(event.name=='useCard'&&!window.ssr_newmizhou_using) {
					                    window.ssr_newmizhou_use=event.card;
					                    window.ssr_newmizhou_player=event.player;
					                }*/
                                    if (event.player == player) return false;
                                    if (!player.storage.ssr_newmizhou) return false;
                                    if (player.storage.ssr_newmizhou.length < 1) return false;
                                    var mark = player.storage.ssr_newmizhou;
                                    for (var i = 0; i < mark.length; i++) {
                                        if (mark[i].realsuit != 'gu') continue;
                                        if (event.card.name == mark[i].name) return true;
                                    }
                                    return false;
                                },
                                content: function() {
                                    "step 0";
                                    //window.ssr_newmizhou_using=true;
                                    if (!_status.auto && (player == game.me || player.isUnderControl())) game.waitClick(3, false, 100);
                                    window.ssr_newmizhou_using = true;
                                    player.chooseControl('确定', '取消', trigger.card,
                                    function() {
                                        if (window.aiClicking) return '取消';
                                        if (get.attitude(player, trigger.player) < 0) return '确定';
                                        return '取消';
                                    }).set('prompt', '秘咒：' + get.translation(trigger.player.name) + '的【' + get.translation(trigger.card.name) + '】即将生效，是否令该牌无效并令该角色流失一点体力？');
                                    "step 1";
                                    if (!_status.auto && (player == game.me || player.isUnderControl())) game.stopClick();
                                    if (result.control == '取消') {
                                        if (event && event.finish) {
                                            event.finish();
                                        } else {
                                            return;
                                        }
                                    }
                                    "step 2";
                                    event.yuansu = ['duanchang', 'fenghou', 'gouwen', 'qinghua', 'zhenjiu'];
                                    event.yuansuname = ['断肠', '封喉', '钩吻', '情花', '鸩酒'];
                                    event.mizhou = [];
                                    for (var i = 0; i < event.yuansu.length; i++) {
                                        var name = event.yuansu[i];
                                        lib.card['mizhou_' + name] = {
                                            fullskin: true,
                                            image: 'ext:祖安武将/card/mizhou_' + name + '.png',
                                            opacity: 1,
                                            textShadow: 'black 0 0 2px',
                                        };
                                        lib.translate['mizhou_' + name] = event.yuansuname[i];
                                        lib.translate['mizhou_' + name + '_info'] = "<li>法箓秘咒";
                                        event.mizhou.push(game.createCard({
                                            name: 'mizhou_' + name,
                                            number: "秘",
                                            suit: "咒"
                                        }));
                                    }
                                    player.logSkill('ssr_newmizhou', trigger.player, 'poison');
                                    var dis = 0;
                                    var give = event.mizhou.randomGet();
                                    player.$give(give, trigger.player, false);
                                    var mark = player.storage.ssr_newmizhou;
                                    for (var i = 0; i < mark.length || dis == 0; i++) {
                                        if (mark[i].realsuit != 'gu') continue;
                                        if (trigger.card.name == mark[i].name && dis == 0) {
                                            var dis = 1;
                                            player.storage.ssr_newmizhou.remove(mark[i]);
                                            if (player.storage.ssr_newmizhou && player.storage.ssr_newmizhou.length > 0) {
                                                player.markSkill('ssr_newmizhou');
                                            } else {
                                                player.unmarkSkill('ssr_newmizhou');
                                            }
                                            //game.cardsDiscard(mark[i]);
                                            /*var card=mark[i];
					                        card.fix();
					                        card.remove();
					                        card.destroyed=true;*/
                                            game.log(player, '失去了一张“蛊”');
                                        }
                                    }
                                    "step 3";
                                    //if(trigger.card) trigger.player.discard(trigger.card);
                                    trigger.cancel();
                                    "step 4";
                                    trigger.player.loseHp();
                                    game.delay(2);
                                    /*if((trigger.name=='respond'||(trigger.card&&trigger.card.name=='shan'))&&window.ssr_newmizhou_use&&window.ssr_newmizhou_player&&trigger.player.isIn()) {
					                    window.ssr_newmizhou_player.useCard(window.ssr_newmizhou_use,trigger.player,false,'nowuxie','noai').animate=false;
					                }else {
					                    trigger.cancel();
					                }*/
                                    //"step 5";
                                    //window.ssr_newmizhou_using=false;
                                },
                                ai: {
                                    result: {
                                        target: -2,
                                    },
                                    expose: 0.2,
                                },
                            },
                        },
                    },
                    "ssr_mizhou": {
                        audio: "reguhuo",
                        group: ["ssr_mizhou_use", "ssr_mizhou_draw"],
                        marktext: "咒",
                        intro: {
                            name: "法箓秘咒",
                            mark: function(dialog, content, player) {
                                if (content && content.length) {
                                    if (player == game.me || player.isUnderControl() || player.classList.contains('dead') == true) {
                                        dialog.addAuto(content);
                                    } else {
                                        return '<li>共有' + get.cnNumber(content.length) + '张牌';
                                    }
                                }
                            },
                            content: function(content, player) {
                                if (content && content.length) {
                                    if (player == game.me || player.isUnderControl() || player.classList.contains('dead') == true) {
                                        return get.translation(content);
                                    }
                                    return '<li>共有' + get.cnNumber(content.length) + '张牌';
                                }
                            },
                        },
                        complexCard: true,
                        enable: "phaseUse",
                        filterCard: function(card, player) {
                            var length = ui.selected.cards.length;
                            if (player.storage.ssr_mizhou && length >= 4 - player.storage.ssr_mizhou.length) return false;
                            return true;
                        },
                        selectCard: [1, 4],
                        filter: function(event, player) {
                            if (player.storage.ssr_mizhou && player.storage.ssr_mizhou.length >= 4) return false;
                            return player.countCards('h') > 0;
                        },
                        check: function(card) {
                            var player = _status.event.player;
                            if (player.storage.ssr_mizhou && (4 - player.storage.ssr_mizhou.length) <= player.countCards('h')) return 1;
                            return 5 - get.value(card);
                        },
                        discard: false,
                        lose: false,
                        content: function() {
                            player.lose(cards, ui.special, 'toStorage');
                            if (!player.storage.ssr_mizhou) player.storage.ssr_mizhou = [];
                            player.storage.ssr_mizhou.addArray(cards);
                            player.markSkill('ssr_mizhou');
                        },
                        ai: {
                            order: 3,
                            result: {
                                player: 1,
                            },
                        },
                        subSkill: {
                            draw: {
                                trigger: {
                                    player: "phaseUseBegin",
                                },
                                filter: function(event, player) {
                                    return player.storage.ssr_mizhou && player.storage.ssr_mizhou.length;
                                },
                                forced: true,
                                priority: 1,
                                content: function() {
                                    var mark = player.storage.ssr_mizhou;
                                    player.gain(mark, 'fromStorage');
                                    player.storage.ssr_mizhou = [];
                                    player.unmarkSkill('ssr_mizhou');
                                },
                            },
                            use: {
                                audio: "reguhuo",
                                trigger: {
                                    global: ["useCard", "respond"],
                                },
                                check: function(event, player) {
                                    return get.attitude(player, event.player) < 0;
                                },
                                priority: 15,
                                direct: true,
                                filter: function(event, player) {
                                    if (event.name == 'useCard' && !window.ssr_mizhou_using) {
                                        window.ssr_mizhou_use = event.card;
                                        window.ssr_mizhou_player = event.player;
                                    }
                                    if (event.player == player) return false;
                                    if (!player.storage.ssr_mizhou) return false;
                                    if (!player.storage.ssr_mizhou.length) return false;
                                    var mark = player.storage.ssr_mizhou;
                                    for (var i = 0; i < mark.length; i++) {
                                        if (event.card.name == mark[i].name) return true;
                                    }
                                    return false;
                                },
                                content: function() {
                                    "step 0";
                                    window.ssr_mizhou_using = true;
                                    player.chooseControl('确定', '取消', trigger.card,
                                    function() {
                                        if (get.attitude(player, trigger.player) < 0) return '确定';
                                        return '取消';
                                    }).set('prompt', '秘咒：' + get.translation(trigger.player.name) + '的【' + get.translation(trigger.card.name) + '】即将生效，是否令该牌无效并令该角色流失一点体力？');
                                    //.set('prompt','秘咒：是否对'+get.translation(trigger.player.name)+'发动秘咒？')
                                    //.set('dialog',['秘咒人心',cards])
                                    "step 1";
                                    if (result.control == '取消') {
                                        if (event && event.finish) {
                                            event.finish();
                                        } else {
                                            return;
                                        }
                                    }
                                    "step 2";
                                    player.logSkill('ssr_mizhou', trigger.player, 'poison');
                                    var dis = 0;
                                    var mark = player.storage.ssr_mizhou;
                                    for (var i = 0; i < mark.length || dis == 0; i++) {
                                        if (trigger.card.name == mark[i].name && dis == 0) {
                                            var dis = 1;
                                            player.storage.ssr_mizhou.remove(mark[i]);
                                            if (player.storage.ssr_mizhou && player.storage.ssr_mizhou.length > 0) {
                                                player.markSkill('ssr_mizhou');
                                            } else {
                                                player.unmarkSkill('ssr_mizhou');
                                            }
                                            game.cardsDiscard(mark[i]);
                                            game.log(player, '将' + get.translation(mark[i], true) + '置入了弃牌堆')
                                        }
                                    }
                                    "step 3";
                                    if (trigger.card) trigger.player.discard(trigger.card);
                                    trigger.player.loseHp();
                                    "step 4";
                                    if (trigger.name == 'respond' && window.ssr_mizhou_use && window.ssr_mizhou_player && trigger.player.isAlive()) {
                                        /*trigger.player.chooseToRespond({name:trigger.card.name}).set('check',function(card){
						                    return get.value(trigger.card)-get.value(card)+0.1;
						                });*/
                                        window.ssr_mizhou_player.useCard(window.ssr_mizhou_use, trigger.player, false, 'nowuxie', 'noai').animate = false;
                                    } else {
                                        trigger.cancel();
                                    }
                                    "step 5";
                                    window.ssr_mizhou_using = false;
                                    /*
							        "step 4";
						            if(trigger.name=='respond'&&window.ssr_mizhou_use) {
						                if(!result.bool) {
						                    window.ssr_mizhou_player.useCard(window.ssr_mizhou_use,'nowuxie',targets[0],'noai').animate=false;
						                }
						            }
						            */
                                },
                                ai: {
                                    result: {
                                        target: -2,
                                    },
                                    expose: 0.2,
                                },
                            },
                        },
                    },
                    "ssr_chanyuan": {
                        subSkill: {
                            crazy: {
                                group: 'mad',
                                mark: true,
                                marktext: "怨",
                                intro: {
                                    name: "怨气缠身",
                                    content: function(storage, player, skill) {
                                        var num = player.countMark('ssr_chanyuan_crazy');
                                        var str = '<li>怨念持续还剩 ' + num + ' 个回合';
                                        return str;
                                    },
                                },
                                trigger: {
                                    global: "roundStart",
                                },
                                content: function() {
                                    'step 0';
                                    player.removeMark('ssr_chanyuan_crazy');
                                    'step 1';
                                    if (player.countMark('ssr_chanyuan_crazy') < 1) {
                                        player.removeSkill('ssr_chanyuan_crazy');
                                        game.log(player, '解除了缠怨');
                                    }
                                },
                                forced: true,
                                priority: 15,
                                init: function(player, skill) {
                                    player.addMark('ssr_chanyuan_crazy', 4);
                                },
                                ai: {
                                    threaten: function(player, target) {
                                        return 5;
                                    },
                                },
                                sub: true,
                            },
                        },
                        audio: 'guhuo_guess',
                        //forbid:["boss"],
                        trigger: {
                            player: "die",
                        },
                        priority: 15,
                        forced: true,
                        forceDie: true,
                        skillAnimation: true,
                        animationColor: "gray",
                        filter: function(event, player) {
                            return event.source && event.source.isIn();
                        },
                        content: function() {
                            trigger.source.addSkill('ssr_chanyuan_crazy');
                            game.log(trigger.source, '进入混乱状态');
                        },
                        logTarget: "source",
                        ai: {
                            threaten: function(player, target) {
                                if (target.hp == 1) return 0.2;
                                return 1.5;
                            },
                            effect: {
                                target: function(card, player, target, current) {
                                    if (!target.hasFriend()) return;
                                    if (target.hp <= 1 && get.tag(card, 'damage')) return [1, 0, 0, -2];
                                },
                            },
                        },
                    },
                    "ssr_wanjian": {},
                    'ssr_newluanji': {
                        derivation: 'ssr_wanjian',
                        audio: 'reluanji',
                        enable: 'phaseUse',
                        viewAs: {
                            name: 'wanjian'
                        },
                        filterCard: function(card, player) {
                            if (!player.storage.ssr_newluanji) return true;
                            if (get.type(card) == 'basic') return true;
                            var cards = [];
                            cards = cards.concat(player.storage.ssr_newluanji);
                            if (ui.selected.cards.length) cards = cards.concat(ui.selected.cards);
                            var num = 1;
                            for (var i = 0; i < cards.length; i++) {
                                if (get.type(cards[i]) != 'basic') num++;
                            }
                            return num <= 2;
                        },
                        filter: function(event, player) {
                            if (player.countCards('hes') >= 2 && !player.storage.ssr_newluanji) return true;
                            if (player.countCards('hs', {
                                type: 'basic'
                            }) >= 2) return true;
                            var cards = [];
                            if (player.storage.ssr_newluanji) cards = cards.concat(player.storage.ssr_newluanji);
                            if (ui.selected.cards.length) cards = cards.concat(ui.selected.cards);
                            var num = 0;
                            for (var i = 0; i < cards.length; i++) {
                                if (get.type(cards[i]) != 'basic') num++;
                            }
                            return (Math.min(2 - num, player.countCards('hes') - player.countCards('hs', {
                                type: 'basic'
                            })) + player.countCards('hs', {
                                type: 'basic'
                            })) >= 2;
                        },
                        complexCard: true,
                        usable: 3,
                        position: 'hes',
                        selectCard: 2,
                        check: function(card) {
                            var player = _status.event.player;
                            var targets = game.filterPlayer(function(current) {
                                return player.canUse('wanjian', current);
                            });
                            var num = 0;
                            for (var i = 0; i < targets.length; i++) {
                                var eff = get.sgn(get.effect(targets[i], {
                                    name: 'wanjian'
                                },
                                player, player));
                                if (targets[i].hp == 1) {
                                    eff *= 1.5;
                                }
                                num += eff;
                            }
                            if (!player.needsToDiscard( - 1)) {
                                if (targets.length >= 7) {
                                    if (num < 2) return 0;
                                } else if (targets.length >= 5) {
                                    if (num < 1.5) return 0;
                                }
                            }
                            return 6 - get.value(card);
                        },
                        ai: {
                            basic: {
                                order: 8.9
                            }
                        },
                        group: ['ssr_newluanji_count', 'ssr_newluanji_reset', 'ssr_newluanji_wanjian'],
                        subSkill: {
                            reset: {
                                trigger: {
                                    player: 'phaseAfter'
                                },
                                silent: true,
                                content: function() {
                                    delete player.storage.ssr_newluanji;
                                    delete player.storage.ssr_newluanji2;
                                }
                            },
                            count: {
                                trigger: {
                                    player: 'useCard'
                                },
                                silent: true,
                                filter: function(event) {
                                    return event.skill == 'ssr_newluanji';
                                },
                                content: function() {
                                    player.storage.ssr_newluanji2 = trigger.card;
                                    if (!player.storage.ssr_newluanji) {
                                        player.storage.ssr_newluanji = [];
                                    }
                                    for (var i = 0; i < trigger.cards.length; i++) {
                                        player.storage.ssr_newluanji.push(trigger.cards[i]);
                                    }
                                }
                            },
                            wanjian: {
                                trigger: {
                                    player: ["enterGame"],
                                    global: "phaseBefore",
                                },
                                forced: true,
                                priority: 21,
                                filter: function(event) {
                                    return (event.name != 'phase' || game.phaseNumber == 0);
                                },
                                content: function() {
                                    lib.translate['wanjian_info'] = '出牌阶段,对所有其他角色使用。每名目标角色选择一项：①打出一张【闪】；②弃置一张装备牌和非装备牌并视为受到你造成的1点伤害；③受到你造成的1点伤害。';
                                    lib.card.wanjian.content = player.ssr_newluanji_wanjian;
                                },
                                init: function(player, skill) {
                                    player.ssr_newluanji_wanjian = function() {
                                        "step 0";
                                        if (typeof event.baseDamage != 'number') event.baseDamage = 1;
                                        if (event.directHit) event._result = {
                                            bool: false
                                        };
                                        else {
                                            var next = target.chooseCard('选择一项：①打出一张闪；②弃置装备牌和非装备牌各一张并视为受到伤害；③直接受到伤害', 'hes',
                                            function(card, player) {
                                                if (ui.selected.cards.length) {
                                                    if (get.type(ui.selected.cards[0]) == 'equip') return get.type(card) != 'equip';
                                                    if (get.type(ui.selected.cards[0]) != 'equip') return get.type(card) == 'equip';
                                                }
                                                return true;
                                            });
                                            next.set('selectCard',
                                            function() {
                                                if (ui.selected.cards.length) {
                                                    if (get.name(ui.selected.cards[0], target) != 'shan') return 2;
                                                }
                                                return [1, 2];
                                            });
                                            next.set('ai',
                                            function(card) {
                                                var evt = _status.event.getParent();
                                                if (get.damageEffect(evt.target, evt.player, evt.target) >= 0) return 0;
                                                if (evt.player.hasSkillTag('notricksource')) return 0;
                                                if (evt.target.hasSkillTag('notrick')) return 0;
                                                if (evt.player.hasZhuSkill('ssr_newshiyi') && evt.target.group == 'qun' && get.attitude(evt.target, evt.player) > 0 && (evt.target.countCards('hes', {
                                                    type: 'basic'
                                                }) > 0 && (evt.target.countCards('hes') - evt.target.countCards('hes', {
                                                    type: 'basic'
                                                }) > 0))) return 9 - get.value(card);
                                                if (evt.target.hasSkillTag('noShan')) {
                                                    return 8 - get.value(card);
                                                }
                                                if (!ui.selected.cards.length && get.name(card) == 'shan') {
                                                    return get.order(card) + 10;
                                                } else {
                                                    if (ui.selected.cards.length && get.name(ui.selected.cards[0]) == 'shan') return 0;
                                                    return 8 - get.value(card);
                                                }
                                            });
                                            next.autochoose = lib.filter.autoRespondShan;
                                        }
                                        "step 1";
                                        if (result.bool == false || (result.cards.length == 1 && get.name(result.cards[0], target) != 'shan')) {
                                            target.damage(event.baseDamage);
                                        } else {
                                            if (result.cards.length == 1) {
                                                target.respond(result.cards, 'highlight', 'noOrdering');
                                            } else {
                                                target.discard(result.cards);
                                                target.damage(event.baseDamage, 'unreal');
                                            }
                                        }
                                    };

                                },
                                sub: true,
                            },
                        }
                    },
                    "ssr_luanji": {
                        subSkill: {
                            ext: {
                                firstDo: true,
                                ai: {
                                    "unequip2": true,
                                },
                                init: function(player, skill) {
                                    if (!player.storage[skill]) player.storage[skill] = [];
                                },
                                onremove: true,
                                trigger: {
                                    player: ["damage", "damageCancelled", "damageZero"],
                                    source: ["damage", "damageCancelled", "damageZero"],
                                    target: ["shaMiss", "useCardToExcluded", "useCardToEnd"],
                                    global: ["useCardEnd"],
                                },
                                charlotte: true,
                                filter: function(event, player) {
                                    return player.storage.ssr_luanji_ext && event.card && player.storage.ssr_luanji_ext.contains(event.card) && (event.name != 'damage' || event.notLink());
                                },
                                silent: true,
                                forced: true,
                                popup: false,
                                priority: 12,
                                content: function() {
                                    player.storage.ssr_luanji_ext.remove(trigger.card);
                                    if (!player.storage.ssr_luanji_ext.length) player.removeSkill('ssr_luanji_ext');
                                },
                                sub: true,
                            },
                            wanjian: {
                                priority: 25,
                                trigger: {
                                    player: "useCardToPlayered",
                                },
                                filter: function(event) {
                                    return event.card.name == 'wanjian';
                                },
                                silent: true,
                                forced: true,
                                logTarget: "target",
                                content: function() {
                                    trigger.target.addTempSkill('ssr_luanji_ext');
                                    trigger.target.storage.ssr_luanji_ext.add(trigger.card);
                                },
                                ai: {
                                    "unequip_ai": true,
                                    skillTagFilter: function(player, tag, arg) {
                                        if (arg && arg.name == 'wanjian') return true;
                                        return false;
                                    },
                                },
                            },
                        },
                        group: ['ssr_luanji_wanjian'],
                        audio: "luanji",
                        enable: "phaseUse",
                        position: "hs",
                        viewAs: {
                            name: "wanjian",
                        },
                        filterCard: function(card, player) {
                            return get.type(card) == 'basic';
                        },
                        filter: function(event, player) {
                            return player.countCards('hs') >= 2;
                        },
                        //usable:2,
                        selectCard: 2,
                        complexCard: true,
                        check: function(card) {
                            return 7 - get.value(card);
                        },
                        ai: {
                            basic: {
                                order: 8.5,
                                useful: 1,
                                value: 5,
                            },
                            wuxie: function(target, card, player, viewer) {
                                if (get.attitude(viewer, target) > 0 && target.countCards('h', 'shan')) {
                                    if (!target.countCards('h') || target.hp == 1 || Math.random() < 0.7) return 0;
                                }
                            },
                            result: {
                                "target_use": function(player, target) {
                                    if (player.hasUnknown(2) && get.mode() != 'guozhan') return 0;
                                    var nh = target.countCards('h');
                                    if (get.mode() == 'identity') {
                                        if (target.isZhu && nh <= 2 && target.hp <= 1) return - 100;
                                    }
                                    if (nh == 0) return - 2;
                                    if (nh == 1) return - 1.7
                                    return - 1.5;
                                },
                                target: function(player, target) {
                                    var nh = target.countCards('h');
                                    if (get.mode() == 'identity') {
                                        if (target.isZhu && nh <= 2 && target.hp <= 1) return - 100;
                                    }
                                    if (nh == 0) return - 2;
                                    if (nh == 1) return - 1.7
                                    return - 1.5;
                                },
                            },
                            tag: {
                                respond: 1,
                                respondShan: 1,
                                damage: 1,
                                multitarget: 1,
                                multineg: 1,
                            },
                        },
                    },
                    "ssr_newdingsheng": {
                        trigger: {
                            player: "loseAfter",
                        },
                        audio: 'sbxueyi',
                        forced: true,
                        preHidden: true,
                        priority: 9,
                        usable: 1,
                        filter: function(event, player) {
                            return event.num >= 2;
                        },
                        content: function() {
                            var suitcard = get.cardPile(function(card) {
                                return get.type(card) == 'equip';
                            });
                            if (suitcard) {
                                game.log(player, '获得了一张', suitcard);
                                player.gain(suitcard, 'draw');
                            }
                        },
                        ai: {
                            threaten: 1.1,
                        },
                        group: ['ssr_newdingsheng_wuxie', 'ssr_newdingsheng_wanjian'],
                        subSkill: {
                            wuxie: {
                                trigger: {
                                    player: "useCard",
                                },
                                forced: true,
                                filter: function(event) {
                                    return (event.card.name == 'wanjian');
                                },
                                content: function() {
                                    trigger.nowuxie = true;
                                },
                            },
                            ext: {
                                firstDo: true,
                                ai: {
                                    "unequip2": true,
                                },
                                init: function(player, skill) {
                                    if (!player.storage[skill]) player.storage[skill] = [];
                                },
                                onremove: true,
                                trigger: {
                                    player: ["damage", "damageCancelled", "damageZero"],
                                    source: ["damage", "damageCancelled", "damageZero"],
                                    target: ["shaMiss", "useCardToExcluded", "useCardToEnd"],
                                    global: ["useCardEnd"],
                                },
                                charlotte: true,
                                filter: function(event, player) {
                                    return player.storage.ssr_newdingsheng_ext && event.card && player.storage.ssr_newdingsheng_ext.contains(event.card) && (event.name != 'damage' || event.notLink());
                                },
                                silent: true,
                                forced: true,
                                popup: false,
                                priority: 12,
                                content: function() {
                                    player.storage.ssr_newdingsheng_ext.remove(trigger.card);
                                    if (!player.storage.ssr_newdingsheng_ext.length) player.removeSkill('ssr_newdingsheng_ext');
                                },
                                sub: true,
                            },
                            wanjian: {
                                priority: 25,
                                trigger: {
                                    player: "useCardToPlayered",
                                },
                                filter: function(event) {
                                    return event.card.name == 'wanjian';
                                },
                                silent: true,
                                forced: true,
                                logTarget: "target",
                                content: function() {
                                    trigger.target.addTempSkill('ssr_newdingsheng_ext');
                                    trigger.target.storage.ssr_newdingsheng_ext.add(trigger.card);
                                },
                                ai: {
                                    "unequip_ai": true,
                                    skillTagFilter: function(player, tag, arg) {
                                        if (arg && arg.name == 'wanjian') return true;
                                        return false;
                                    },
                                },
                            },
                        },
                    },
                    "ssr_dingsheng": {
                        audio: "xueyi",
                        trigger: {
                            target: "useCardToBefore",
                        },
                        forced: true,
                        priority: 15,
                        filter: function(event, player) {
                            return (event.card.name == 'wanjian');
                        },
                        content: function() {
                            trigger.cancel();
                        },
                        locked: true,
                        ai: {
                            effect: {
                                target: function(card, player, target) {
                                    if (card.name == 'wanjian') return 0;
                                },
                            },
                        },
                        group: ["ssr_dingsheng_wuxie", "ssr_dingsheng_draw"],
                        subSkill: {
                            delete: {
                                trigger: {
                                    player: "useCardAfter",
                                },
                                silent: true,
                                filter: function(event, player) {
                                    if (!player.storage.ssr_dingsheng_delete) return false;
                                    return event.card.name == 'wanjian';
                                },
                                content: function() {
                                    player.removeSkill('ssr_dingsheng_delete');
                                    for (var i = 0; i < game.players.length; i++) {
                                        if (game.players[i].hasSkill('ssr_dingsheng_res')) game.players[i].removeSkill('ssr_dingsheng_res');
                                    }
                                },
                                sub: true,
                                forced: true,
                            },
                            res: {
                                trigger: {
                                    player: ["respond", "useCard"],
                                },
                                priority: -5,
                                forced: true,
                                silent: true,
                                filter: function(event, player) {
                                    if (!player.storage.ssr_dingsheng_res) return false;
                                    if (!player.storage.ssr_dingsheng_res.isIn()) return false;
                                    return event.card.name == 'shan';
                                },
                                charlotte: true,
                                content: function() {
                                    player.storage.ssr_dingsheng_res.draw();
                                },
                                mark: true,
                                marktext: "盟军",
                                intro: {
                                    name: "盟军令牌",
                                    content: function(storage, player) {
                                        return "当你使用或打出【闪】时，你令" + get.translation(storage.name) + "摸一张牌";
                                    },
                                },
                            },
                            remove: {
                                trigger: {
                                    player: "useCard2",
                                },
                                direct: true,
                                filter: function(event, player) {
                                    return ['wanjian', 'sha'].contains(event.card.name) && event.targets.length > 0;
                                },
                                priority: 3,
                                line: false,
                                content: function() {
                                    'step 0';
                                    player.chooseTarget(get.prompt('ssr_dingsheng'), '为' + get.translation(trigger.card) + '减少一个目标',
                                    function(card, player, target) {
                                        return _status.event.targets.contains(target)
                                    }).set('targets', trigger.targets).set('ai',
                                    function(target) {
                                        var player = _status.event.player;
                                        return - get.effect(target, _status.event.getTrigger().card, player, player)
                                    });
                                    'step 1';
                                    if (result.bool) {
                                        player.logSkill('olluanji', result.targets);
                                        player.addTempSkill('ssr_dingsheng_delete');
                                        player.storage.ssr_dingsheng_delete = trigger.card;
                                        result.targets[0].addTempSkill('ssr_dingsheng_res');
                                        result.targets[0].storage.ssr_dingsheng_res = player;
                                        result.targets[0].draw();
                                        //trigger.targets.remove(result.targets[0]);
                                    }
                                },
                                sub: true,
                            },
                            draw: {
                                trigger: {
                                    player: "loseAfter",
                                },
                                forced: true,
                                preHidden: true,
                                priority: 9,
                                usable: 1,
                                filter: function(event, player) {
                                    return event.num >= 2;
                                },
                                content: function() {
                                    player.draw();
                                },
                                ai: {
                                    threaten: 1.1,
                                },
                            },
                            wuxie: {
                                trigger: {
                                    player: "useCard",
                                },
                                forced: true,
                                filter: function(event) {
                                    return (event.card.name == 'wanjian');
                                },
                                content: function() {
                                    trigger.nowuxie = true;
                                },
                            },
                        },
                    },
                    "ssr_newshiyi": {
                        trigger: {
                            global: "loseAfter",
                        },
                        direct: true,
                        preHidden: true,
                        priority: 11,
                        zhuSkill: true,
                        filter: function(event, player) {
                            if (_status.currentPhase != player && _status.currentPhase != event.player) return false;
                            return event.num >= 2 && player.hasZhuSkill('ssr_newshiyi') && event.player != player && event.player.group == 'qun';
                        },
                        audio: 'xueyi',
                        content: function() {
                            'step 0';
                            var adds = '';
                            if (!trigger.player.hasSkill('ssr_newdingsheng')) adds = '并获得一枚“爵”标记';
                            trigger.player.chooseBool('世裔：是否令' + get.translation(player) + '摸一张牌' + adds + '？').set('ai',
                            function() {
                                return get.attitude(trigger.player, player) > 0;
                            });
                            'step 1';
                            if (result.bool) {
                                trigger.player.line(player, 'gray');
                                trigger.player.logSkill(event.name, player);
                                //player.draw();
                                game.asyncDraw([trigger.player, player]);
                                if (!trigger.player.hasSkill('ssr_newdingsheng')) {
                                    trigger.player.addMark('ssr_newshiyi');
                                    if (trigger.player.countMark('ssr_newshiyi') >= 3) {
                                        trigger.player.removeMark('ssr_newshiyi', trigger.player.countMark('ssr_newshiyi'));
                                        trigger.player.addSkill('ssr_newdingsheng');
                                        game.log(trigger.player, '获得了技能', '#g〖鼎盛〗');
                                    }
                                }
                            }
                        },
                        marktext: '爵',
                        intro: {
                            name: '封爵赏地',
                            content: 'mark',
                        },
                    },
                    "ssr_shiyi": {
                        global: "ssr_shiyi_zhong",
                        audio: "xueyi",
                        zhuSkill: true,
                        trigger: {
                            global: "dieBegin",
                        },
                        forced: true,
                        filter: function(event, player) {
                            if (!player.hasZhuSkill('ssr_shiyi')) return false;
                            return event.source && event.source == player;
                        },
                        content: function() {
                            trigger.source = undefined;
                            player.draw();
                        },
                        subSkill: {
                            zhong: {
                                group: "ssr_shiyi_jia",
                                audio: "xueyi",
                                unique: true,
                                trigger: {
                                    //global:["useCardAfter","respondAfter"],
                                    source: "damageSource",
                                },
                                mark: false,
                                skillAnimation: true,
                                animationStr: "世裔",
                                limited: true,
                                animationColor: "orange",
                                init: function(player) {
                                    player.storage.ssr_shiyi_zhong = false;
                                },
                                filter: function(event, player) {
                                    if (! ['mingzhong', 'zhong'].contains(player.identity) || player.group != 'qun') return false;
                                    if (!event.card || event.card.name != 'sha') return false;
                                    if (_status.currentPhase != player) return false;
                                    if (player.storage.ssr_shiyi_zhong) return false;
                                    return game.hasPlayer(function(current) {
                                        if (!current.hasZhuSkill('ssr_shiyi')) return false;
                                        return current != player;
                                    });
                                    /*if(event.type=='dying'){
		                                if(player!=event.dying) return false;
		                                return game.hasPlayer(function(current){
		                                    if(!current.hasZhuSkill('ssr_shiyi')) return false;
		                                    return current!=player;
		                                });
		                            }*/
                                },
                                content: function() {
                                    'step 0';
                                    player.awakenSkill('ssr_shiyi_zhong');
                                    player.storage.ssr_shiyi_zhong = true;
                                    'step 1';
                                    player.identityShown = true;
                                    player.markSkill('ssr_shiyi_zhong');
                                    player.addMark('ssr_shiyi_jia');
                                    player.addSkill('ssr_dingsheng');
                                    'step 2';
                                    player.draw(2);
                                    player.chooseToDiscard(2, 'he', true);
                                },
                                ai: {
                                    order: 10,
                                    skillTagFilter: function(player, arg, target) {
                                        if (player != target || player.storage.ssr_shiyi_zhong) return false;
                                    },
                                    save: function(player) {
                                        if (player.storage.ssr_shiyi_zhong) return false;
                                        if (player.identity != 'zhong') return false;
                                        return true;
                                    },
                                    result: {
                                        player: function(player) {
                                            if (player.hp <= 0) return 5;
                                            return 0;
                                        },
                                    },
                                },
                                intro: {
                                    name: "四世三公",
                                    content: "limited",
                                },
                            },
                            jia: {
                                audio: "jieyue",
                                preHidden: true,
                                trigger: {
                                    player: ["damageBegin"],
                                },
                                forced: true,
                                locked: true,
                                priority: -23,
                                filter: function(event, player) {
                                    return event.num > 0 && player.countMark('ssr_shiyi_jia') > 0;
                                },
                                content: function() {
                                    if (trigger.num > player.countMark('ssr_shiyi_jia')) {
                                        var num = player.countMark('ssr_shiyi_jia');
                                    } else {
                                        var num = trigger.num;
                                    }
                                    if (trigger.name == 'damage') {
                                        if (trigger.animate !== false) {
                                            player.$damage(trigger.source);
                                            if (window.zuanDamageAudio) game.playAudio('..', 'extension', '祖安武将', 'audio', 'hudun.mp3');
                                            game.broadcastAll(function(nature, player) {
                                                if (lib.config.animation && !lib.config.low_performance) {
                                                    if (nature == 'fire') {
                                                        player.$fire();
                                                    } else if (nature == 'thunder') {
                                                        player.$thunder();
                                                    }
                                                }
                                            },
                                            trigger.nature, player);
                                            player.$damagepop( - num, trigger.nature);
                                        }
                                    }
                                    game.log(player, '的精兵受到了', get.cnNumber(num), '点伤害');
                                    player.removeMark('ssr_shiyi_jia', num);
                                    trigger.num -= num;
                                },
                                marktext: "兵",
                                intro: {
                                    name: "兵临城下",
                                    content: "mark",
                                },
                                mod: {
                                    maxHandcardBase: function(player, num) {
                                        return num + player.countMark('ssr_shiyi_jia');
                                    },
                                },
                                sub: true,
                            },
                        },
                    },
                    "ssr_xueyi": {
                        global: "ssr_xueyi_zhong",
                        audio: "xueyi",
                        zhuSkill: true,
                        subSkill: {
                            zhong: {
                                audio: "xueyi",
                                unique: true,
                                enable: "chooseToUse",
                                mark: false,
                                skillAnimation: true,
                                animationStr: "血裔",
                                limited: true,
                                animationColor: "orange",
                                init: function(player) {
                                    player.storage.ssr_xueyi_zhong = false;
                                },
                                filter: function(event, player) {
                                    if (player.storage.ssr_xueyi_zhong) return false;
                                    if (player.identity != 'zhong') return false;
                                    if (event.type == 'dying') {
                                        if (player != event.dying) return false;
                                        return game.hasPlayer(function(current) {
                                            if (!current.hasZhuSkill('ssr_xueyi')) return false;
                                            return current != player;
                                        });
                                    }
                                    return false;
                                },
                                content: function() {
                                    'step 0';
                                    player.awakenSkill('ssr_xueyi_zhong');
                                    player.storage.ssr_xueyi_zhong = true;
                                    'step 1';
                                    player.identityShown = true;
                                    player.markSkill('ssr_xueyi_zhong');
                                    if (player.hp < 1) {
                                        player.recover(1 - player.hp);
                                    }
                                    if (player.group == 'qun' && !player.hasSkill('ssr_dingsheng')) {
                                        player.addSkill('ssr_dingsheng');
                                    }
                                },
                                ai: {
                                    order: 10,
                                    skillTagFilter: function(player, arg, target) {
                                        if (player != target || player.storage.ssr_xueyi_zhong) return false;
                                    },
                                    save: function(player) {
                                        if (player.storage.ssr_xueyi_zhong) return false;
                                        if (player.identity != 'zhong') return false;
                                        return true;
                                    },
                                    result: {
                                        player: function(player) {
                                            if (player.hp <= 0) return 5;
                                            return 0;
                                        },
                                    },
                                },
                                intro: {
                                    content: "limited",
                                },
                            },
                        },
                    },
                    "ssr_juejing": {
                        group: ['ssr_juejing_link'],
                        subSkill: {
                            link: {
                                trigger: {
                                    player: ["linkBefore", "enterGame"],
                                    global: "phaseBefore",
                                },
                                forced: true,
                                filter: function(event, player) {
                                    if (event.name == 'link') return ! player.isLinked();
                                    return (event.name != 'phase' || game.phaseNumber == 0) && player.isLinked();
                                },
                                content: function() {
                                    if (trigger.name != 'link') player.link(false);
                                    else trigger.cancel();
                                },
                                sub: true,
                            },
                        },
                        audio: "juejing",
                        init: function(player, skill) {
                            if (player.isTurnedOver()) player.turnOver();
                            player.disableJudge();
                        },
                        onremove: function(player, skill) {
                            player.enableJudge();
                        },
                        trigger: {
                            player: ["turnOverBefore"],
                        },
                        priority: 3,
                        forced: true,
                        locked: true,
                        filter: function(event, player) {
                            return ! player.isTurnedOver();
                        },
                        content: function() {
                            trigger.cancel();
                            game.log(player, '取消了翻面');
                        },
                        ai: {
                            noturn: true,
                            noCompareTarget: true,
                            effect: {
                                target: function(card, player, target) {
                                    if (card.name == 'tiesuo') return 'zeroplayertarget';
                                    if (get.type(card) == 'delay') return - 1;
                                },
                            },
                        },
                    },
                    "ssr_kuangao": {
                        subSkill: {
                            sha: {
                                mark: true,
                                marktext: "狂骨",
                                intro: {
                                    name: "狂骨破军",
                                    content: "<li>本回合内你可额外使用一张【杀】，你使用的【杀】没有距离限制且不能被响应。",
                                },
                                audio: 'kuanggu',
                                shaRelated: true,
                                trigger: {
                                    player: "useCardToPlayered",
                                },
                                filter: function(event, player) {
                                    return event.card.name == 'sha';
                                },
                                forced: true,
                                logTarget: "target",
                                preHidden: true,
                                content: function() {
                                    "step 0";
                                    trigger.getParent().directHit.add(trigger.target);
                                },
                                ai: {
                                    "directHit_ai": true,
                                },
                                mod: {
                                    targetInRange: function(card, player, target, now) {
                                        if (card.name == 'sha') return true;
                                    },
                                    cardUsable: function(card, player, num) {
                                        if (card.name == 'sha') return num + 1;
                                    },
                                },
                                sub: true,
                            },
                        },
                        audio: 'kuanggu',
                        enable: "phaseUse",
                        usable: 1,
                        filterTarget: function(card, player, target) {
                            return target != player;
                        },
                        content: function() {
                            "step 0";
                            target.chooseCard('交给' + get.translation(player.name) + '一张【杀】或弃置其的一张牌',
                            function(card) {
                                return get.name(card) == 'sha';
                            }).set('ai',
                            function(card) {
                                if (get.attitude(target, player) > 0) {
                                    if (player.countCards('j') > 0) {
                                        return 3 - get.value(card);
                                    } else {
                                        return 10 - get.value(card);
                                    }
                                } else {
                                    return 0;
                                }
                            });
                            "step 1";
                            if (result.bool == false && player.countCards('hej') > 0) {
                                target.discardPlayerCard(player, 'hej', true);
                            } else {
                                player.gain(result.cards, 'giveAuto', target);
                                player.addTempSkill("ssr_kuangao_sha");
                            }
                        },
                        ai: {
                            order: 11,
                            expose: 0.1,
                            result: {
                                target: 0.5,
                                player: function(player, target) {
                                    if (get.attitude(player, target) <= 0) return - 1;
                                    if (target.countCards('h') <= 1) return - 1;
                                    if (player.countCards('he') < 1) return 0;
                                    return target.countCards('h') - 2;
                                },
                            },
                            threaten: 1.1,
                        },
                    },
                    "ssr_qimou": {
                        subSkill: {
                            die: {
                                mark: true,
                                marktext: "困窘",
                                intro: {
                                    name: "陷入窘境",
                                    content: "<li>你不能使用或打出任何牌。",
                                },
                                mod: {
                                    "cardEnabled2": function(card, player) {
                                        return false;
                                    },
                                },
                                ai: {
                                    effect: {
                                        target: function(card, player, target) {
                                            if (get.tag(card, 'damage')) return [0, -999999];
                                        },
                                    },
                                },
                                charlotte: true,
                                sub: true,
                            },
                            kill: {
                                trigger: {
                                    source: "damageBegin4",
                                },
                                filter: function(event, player) {
                                    return event.player.hasSkill('ssr_qimou_die');
                                },
                                priority: -39,
                                forced: true,
                                content: function() {
                                    'step 0';
                                    trigger.num *= 2;
                                },
                                sub: true,
                            },
                        },
                        audio: 'qimou',
                        unique: true,
                        enable: "phaseUse",
                        mark: true,
                        skillAnimation: true,
                        animationColor: "fire",
                        limited: true,
                        init: function(player) {
                            player.storage.ssr_qimou = false;
                        },
                        filter: function(event, player) {
                            if (player.storage.ssr_qimou) return false;
                            return true;
                        },
                        filterTarget: function(card, player, target) {
                            return target != player;
                        },
                        content: function() {
                            player.awakenSkill('ssr_qimou');
                            player.storage.ssr_qimou = true;
                            player.turnOver();
                            player.addTempSkill('ssr_qimou_kill');
                            //player.storage.ssr_qimou_kill=target;
                            target.addTempSkill('ssr_qimou_die');
                            //target.markSkillCharacter('ssr_qimou_die',player,'困窘','无法使用或打出任何手牌');
                        },
                        ai: {
                            order: 13,
                            result: {
                                target: function(player, target) {
                                    if (target.getEquip('bagua') || target.getEquip('rewrite_bagua')) return 0;
                                    var hs = player.countCards('h',
                                    function(card) {
                                        return ['sha', 'juedou'].contains(card.name) && get.effect(target, card, player, player) != 0;
                                    });
                                    var ts = target.hp;
                                    if (hs >= ts && ts > 1) return - 1;
                                    return 0;
                                },
                            },
                        },
                        intro: {
                            content: "limited",
                        },
                    },
                    "ssr_xuanhuo": {
                        subSkill: {
                            draw: {
                                trigger: {
                                    global: "useCard",
                                },
                                priority: 11,
                                forced: true,
                                silent: true,
                                filter: function(event, player) {
                                    if (event.card.name != 'sha') return false;
                                    if (!event.player.hasSkill('ssr_xuanhuo_break')) return false;
                                    if (event.player.storage.ssr_xuanhuo_break != player) return false;
                                    if (!event.player.getHp() > 0) return false;
                                    var evt = event.getParent('phaseUse');
                                    if (!evt || evt.player != event.player) return false;
                                    var index = event.player.getHistory('useCard',
                                    function(evtx) {
                                        return (evtx.card.name == 'sha' || evtx.card.isOldSha) && evtx.getParent('phaseUse') == evt;
                                    }).indexOf(event);
                                    return index == 1

                                    if (_status.currentPhase != event.player) return false;
                                    var history = event.player.getHistory('useCard');
                                    var num = 0;
                                    for (var i = 0; i < history.length; i++) {
                                        if ((get.name(history[i].card, event.player) == 'sha' || history[i].card.isOldSha) && history[i].isPhaseUsing()) num++;
                                    }
                                    return num == 2;
                                },
                                content: function() {
                                    "step 0";
                                    trigger.player.line(player);
                                    player.draw();
                                    "step 1";
                                    if (trigger.player == player) {
                                        trigger.player.removeSkill('ssr_xuanhuo_break');
                                    }
                                },
                                sub: true,
                            },
                            break: {
                                trigger: {
                                    global: ["phaseBefore", "die"],
                                },
                                filter: function(event, player) {
                                    return event.player == player.storage.ssr_xuanhuo_break;
                                },
                                forced: true,
                                silent: true,
                                charlotte: true,
                                intro: {
                                    name: "头晕目眩",
                                    content: "锁定技，若你的体力值大于零，你的手牌均视为【杀】，出牌阶段你可以额外使用一张【杀】。",
                                },
                                mark: true,
                                marktext: "眩惑",
                                content: function() {
                                    player.removeSkill('ssr_xuanhuo_break');
                                },
                                mod: {
                                    cardname: function(card, player) {
                                        if (player.hp > 0) return 'sha';
                                    },
                                    cardUsable: function(card, player, num) {
                                        if (player.hp > 0 && card.name == 'sha') return num + 1;
                                    },
                                },
                                ai: {
                                    skillTagFilter: function(player) {
                                        if (!player.countCards('h')) return false;
                                    },
                                    respondSha: true,
                                },
                                sub: true,
                            },
                        },
                        usable: 1,
                        audio: "sbxuanhuo",
                        enable: "phaseUse",
                        group: 'ssr_xuanhuo_draw',
                        filterCard: function(card) {
                            return get.type(card) != 'basic';
                        },
                        selectCard: 1,
                        position: "he",
                        //discard:false,
                        //lose:false,
                        filter: function(event, player) {
                            return player.countCards('h') - player.countCards('h', {
                                type: 'basic'
                            }) > 0;
                        },
                        filterTarget: function(card, player, target) {
                            //if(player==target) return false;
                            if (target.hasSkill('ssr_xuanhuo_break')) return false;
                            return true;
                        },
                        content: function() {
                            "step 0";
                            //target.gain(cards,player,'giveAuto');
                            target.storage.ssr_xuanhuo_break = player;
                            "step 1";
                            target.addSkill('ssr_xuanhuo_break');
                        },
                        check: function(card) {
                            return 9 - get.value(card);
                        },
                        ai: {
                            order: function(name, player) {
                                return get.order({
                                    name: 'sha'
                                }) + 1;
                            },
                            result: {
                                target: function(player, target) {
                                    if (((target.countCards('e', {
                                        name: 'zhuge'
                                    }) || target.hasSkill('paoxiao') || target.hasSkill('olpaoxiao') || target.hasSkill('new_repaoxiao') || target.hasSkill('zhuge_skill') || target.hasSkill('rw_zhuge_skill') || target.countCards('e', {
                                        subtype: 'equip2'
                                    })) && target.getHp() >= 2) || target.getHp() >= 3) {
                                        return 1 + target.countCards('h');
                                    } else {
                                        return 1 - target.countCards('h');
                                    }

                                },
                            },
                            threaten: 1.2,
                        },
                    },
                    "ssr_newfabing": {
                        locked: true,
                        shaRelated: true,
                        audio: 'sbenyuan',
                        preHidden: true,
                        priority: 5,
                        forced: true,
                        trigger: {
                            player: "useCardToPlayered",
                        },
                        filter: function(event, player) {
                            if (event.card.name != 'sha') return false;
                            return true; //event.getParent().triggeredTargets3.length==1;
                        },
                        content: function() {
                            'step 0';
                            var list = {
                                basic: [],
                                equip: [],
                                trick: [],
                                delay: [],
                                sha: []
                            };
                            for (var i = 0; i < lib.inpile.length; i++) {
                                var name = lib.inpile[i];
                                var info = lib.card[name];
                                if (info.autoViewAs || name == 'yuansuhuimie') continue;
                                //if(!(info.selectTarget==1||info.toself)) continue;
                                if (lib.filter.cardEnabled({
                                    name: name
                                },
                                player)) {
                                    if (!list[info.type]) {
                                        list[info.type] = [];
                                    }
                                    if (name == 'sha') {
                                        list['sha'].push([get.translation(lib.card[name].type), '', 'sha']);
                                        list['sha'].push([get.translation(lib.card[name].type), '', 'sha', 'fire']);
                                        list['sha'].push([get.translation(lib.card[name].type), '', 'sha', 'thunder']);
                                        list['sha'].push([get.translation(lib.card[name].type), '', 'sha', 'ice']);
                                    } else list[info.type].push([get.translation(lib.card[name].type), '', name]);
                                }
                            }
                            list.trick.sort(lib.sort.name);
                            var dialog = ui.create.dialog('以法令兵', [list.sha.concat(list.trick), 'vcard']);
                            player.chooseButton(dialog, true).set('filterButton',
                            function(button) {
                                var name = button.link[2];
                                var nature = button.link[3];
                                var players = trigger.getParent().triggeredTargets3;
                                for (var i = 0; i < trigger.getParent().triggeredTargets3.length; i++) {
                                    if (!player.canUse({
                                        name: name,
                                        nature: nature,
                                        suit: get.suit(trigger.card),
                                        number: get.number(trigger.card)
                                    },
                                    players[i], false, true)) return false;
                                }
                                return true;
                            }).ai = function(button) {
                                var name = button.link[2];
                                var nature = button.link[3];
                                var eff = 0;
                                for (var i = 0; i < trigger.getParent().triggeredTargets3.length; i++) {
                                    eff += get.effect(trigger.getParent().triggeredTargets3[i], {
                                        name: name,
                                        suit: get.suit(trigger.card),
                                        number: get.number(trigger.card),
                                        nature: nature
                                    },
                                    player, player);
                                }
                                return eff;
                            }
                            'step 1';
                            if (result.bool) {
                                var viewas = game.createCard({
                                    name: result.links[0][2],
                                    nature: result.links[0][3],
                                    suit: get.suit(trigger.card),
                                    number: get.number(trigger.card)
                                });
                                game.log(player, '使用的', trigger.card, '视为', viewas);
                                trigger.card.isOldSha = true;
                                trigger.card.name = result.links[0][2];
                                trigger.card.nature = result.links[0][3];
                            }
                        },
                        ai: {
                            effect: {
                                player: function(card, player, target) {
                                    if (get.name(card, player) == 'sha') {
                                        if (card.name == 'sha') return [1, 1];
                                        return [1, 0.7];
                                    }
                                },
                            },
                        },
                    },
                    "ssr_fabing": {
                        subSkill: {
                            sha: {
                                sub: true,
                            },
                            unable: {
                                sub: true,
                            },
                        },
                        trigger: {
                            player: ["useCard"],
                        },
                        mod: {
                            //selectTarget:function(card,player,range){
                            //       if(card.name=='sha'&&range[1]!=-1&&!player.hasSkill('ssr_fabing_sha')) range[1]=-1;
                            //},
                            //targetInRange:function(card,player,target,now){
                            //    if(card.name=='sha'&&!player.hasSkill('ssr_fabing_sha')) return true;
                            //},
                            cardname: function(card, player) {
                                if (card.name == 'sha' && !player.hasSkill('ssr_fabing_sha') && _status.currentPhase == player) return 'ssr_fabing_card';
                            },
                        },
                        priority: 9,
                        forced: true,
                        filter: function(event, player) {
                            return event.card.name == 'ssr_fabing_card' && !player.hasSkill('ssr_fabing_sha');
                        },
                        init: function(player, skill) {
                            //lib.arenaReady.push(function(){
                            var name = 'ssr_fabing_card';
                            lib.card[name] = {
                                fullskin: true,
                                color: 'white',
                                type: 'basic',
                                enable: true,
                                selectTarget: -1,
                                filterTarget: function(card, player, target) {
                                    return player == target;
                                },
                                content: function() {},
                                ai: {
                                    basic: {
                                        useful: [5, 3, 1],
                                        value: [5, 3, 1],
                                    },
                                    order: 3,
                                    result: {
                                        player: 1.5,
                                    },
                                }
                            };
                            lib.translate[name] = "法杀";
                            lib.translate[name + '_info'] = "视为使用一张任意属性的【杀】或单个目标的非延时锦囊牌。（计入【杀】的使用次数）";
                            //});
                        },
                        audio: 'sbenyuan',
                        direct: true,
                        content: function() {
                            'step 0';
                            var list = {
                                basic: [],
                                equip: [],
                                trick: [],
                                delay: [],
                                sha: []
                            };
                            for (var i = 0; i < lib.inpile.length; i++) {
                                var name = lib.inpile[i];
                                var info = lib.card[name];
                                if (info.autoViewAs || name == 'yuansuhuimie') continue;
                                if (! (info.selectTarget == 1 || info.toself)) continue;
                                if (lib.filter.cardEnabled({
                                    name: name
                                },
                                player)) {
                                    if (!list[info.type]) {
                                        list[info.type] = [];
                                    }
                                    if (name == 'sha') {
                                        list['sha'].push([get.translation(lib.card[name].type), '', 'sha']);
                                        list['sha'].push([get.translation(lib.card[name].type), '', 'sha', 'fire']);
                                        list['sha'].push([get.translation(lib.card[name].type), '', 'sha', 'thunder']);
                                        list['sha'].push([get.translation(lib.card[name].type), '', 'sha', 'ice']);
                                    } else list[info.type].push([get.translation(lib.card[name].type), '', name]);
                                }
                            }
                            list.trick.sort(lib.sort.name);
                            var dialog = ui.create.dialog('以法令兵', [list.sha.concat(list.trick), 'vcard']);
                            // for(var i in list){
                            //        dialog.addText(get.translation(i)+'牌');
                            //        dialog.add([list[i],'vcard']);
                            // }
                            var rand1 = Math.random() < 1 / 3;
                            var rand2 = Math.random() < 0.5;
                            var rand3 = Math.random() < 1 / 3;
                            var rand4 = Math.random() < 1 / 3;
                            player.chooseButton(dialog, true).ai = function(button) {
                                var name = button.link[2];
                                if (player.hp <= 1) {
                                    switch (name) {
                                    case 'zhiliaobo':
                                        return 1;
                                    case 'dunpaigedang':
                                        return 0.8;
                                    case 'wangmeizhike':
                                        return 0.6;
                                    default:
                                        return 0;
                                    }
                                }
                                if (rand4 && player.countCards('h') <= 3) {
                                    switch (name) {
                                    case 'zengbin':
                                        return 1;
                                    case 'wuzhong':
                                        return 0.8;
                                    default:
                                        return 0;
                                    }
                                }
                                if (rand3 && (player.countCards('h', {
                                    name: 'shan'
                                }) >= 1 || player.countCards('e', {
                                    subtype: 'equip2'
                                }) >= 1)) {
                                    switch (name) {
                                    case 'caochuanjiejian':
                                        return 0.6;
                                    default:
                                        return 0;
                                    }
                                }
                                if (rand1 && game.countPlayer(function(current) {
                                    if (get.attitude(player, current) < 0) {
                                        return get.distance(player, current) <= 1;
                                    }
                                }) >= 1) {
                                    switch (name) {
                                    case 'shunshou':
                                        return 0.7;
                                    default:
                                        return 0;
                                    }
                                }
                                if (rand1) {
                                    switch (name) {
                                    case 'shunshou':
                                        return 0.6;
                                    default:
                                        return 0;
                                    }
                                }
                                if (rand3 && (player.countCards('h', {
                                    number: 13
                                }) + player.countCards('h', {
                                    number: 12
                                }) + player.countCards('h', {
                                    number: 11
                                })) >= 1) {
                                    switch (name) {
                                    case 'shezhanqunru':
                                        return 0.8;
                                    default:
                                        return 0;
                                    }
                                }
                                if (player.hasSkill('qinglonglingzhu')) {
                                    if (rand2) return name == 'chiyuxi' ? 0.8 : 0;
                                    return name == 'jingleishan' ? 0.8 : 0;
                                }
                                switch (name) {
                                case 'sha':
                                    return 0.4;
                                default:
                                    return 0;
                                }
                            }
                            'step 1';
                            if (result.bool) {
                                player.addTempSkill('ssr_fabing_sha');
                                player.getStat().card.sha++;
                                player.chooseUseTarget({
                                    name: result.links[0][2],
                                    nature: result.links[0][3]
                                },
                                true, false);
                            }
                        },
                        ai: {
                            threaten: 1.5,
                        },
                    },
                    "ssr_lianhuan": {
                        subSkill: {
                            usedraw: {
                                trigger: {
                                    global: "useCardEnd",
                                },
                                charlotte: true,
                                priority: 973,
                                forced: true,
                                silent: true,
                                filter: function(event, player) {
                                    return event.card.name != 'wuxie';
                                },
                                content: function() {
                                    game.filterPlayer(function(current) {
                                        if (!current.hasSkill('ssr_lianhuan')) return false;
                                        current.draw();
                                    });
                                    player.removeSkill('ssr_lianhuan_usedraw');
                                },
                                sub: true,
                            },
                            relink: {
                                trigger: {
                                    global: "useCardBefore",
                                },
                                charlotte: true,
                                priority: 974,
                                forced: true,
                                silent: true,
                                filter: function(event, player) {
                                    if (event.targets.length != 1) return false;
                                    if (event.targets[0] == player && game.hasPlayer(function(current) {
                                        return player != current && current.hasSkill('ssr_lianhuan_relink');
                                    })) return false;
                                    if (!event.targets[0].hasSkill('ssr_lianhuan_relink')) return false;
                                    return (event.card.name == 'sha' || get.type(event.card) == 'trick' || get.type(event.card) == 'delay');
                                },
                                content: function() {
                                    "step 0";
                                    trigger.targets[0].removeSkill('ssr_lianhuan_relink');
                                    player.storage.ssr_lianhuan_relink = trigger.card;
                                    if (trigger.targets[0] == player) {
                                        if (event && event.finish) {
                                            event.finish();
                                        } else {
                                            return;
                                        }
                                    }
                                    "step 1";
                                    player.addTempSkill('ssr_lianhuan_link');
                                },
                                onremove: function(player) {
                                    if(game.hasPlayer(function(current){
                                        if (current == player) return false;
                                        return current.hasSkill('ssr_lianhuan_relink');
                                    })) return false;
                                    if (_status.event && _status.event.name != 'ssr_lianhuan') {
                                        player.addTempSkill('ssr_lianhuan_usedraw');
                                    } else {
                                        game.filterPlayer(function(current) {
                                            if (!current.hasSkill('ssr_lianhuan')) return false;
                                            current.draw();
                                        });
                                    }
                                },
                                intro: {
                                    name: "连环妙计",
                                    content: "锁定技，当你成为锦囊牌或【杀】的唯一目标后，你解除连环状态，然后其他一名处于连锁状态的角色视为也被使用同样的牌。",
                                },
                                mark: true,
                                marktext: "连锁",
                            },
                            link: {
                                trigger: {
                                    global: "useCardAfter",
                                },
                                charlotte: true,
                                priority: 26,
                                forced: true,
                                preHidden: true,
                                filter: function(event, player) {
                                    if (!player.storage.ssr_lianhuan_relink) return false;
                                    return player.storage.ssr_lianhuan_relink == event.card;
                                    /*
							        if(event.targets.length!=1) return false;
							        if(event.targets[0]==player) return false;
							        if(!event.targets[0].hasSkill('ssr_lianhuan_link')) return false;
							        return (event.card.name=='sha'||get.type(event.card)=='trick'||get.type(event.card)=='delay');
							        */
                                },
                                content: function() {
                                    'step 0';
                                    if (game.countPlayer(function(current) {
                                        return current.hasSkill('ssr_lianhuan_relink');
                                    }) <= 1 && player.hasSkill('ssr_lianhuan_relink')) player.removeSkill('ssr_lianhuan_relink');
                                    event.card = game.createCard(trigger.card);
                                    trigger.player.useCard(event.card, player, false);
                                    'step 1';
                                    player.removeSkill('ssr_lianhuan_link');
                                    /*
							        if(game.countPlayer(function(current){
							            return current.hasSkill('ssr_lianhuan_link');
							        })<=1) player.removeSkill('ssr_lianhuan_link');
							        
							        trigger.getParent().excluded.add(player);
							        player.removeSkill('ssr_lianhuan_link');
							        event.targets=game.filterPlayer(function(current){
							            //if(current==player) return false;
							            return current.hasSkill('ssr_lianhuan_link');
							        });
							        event.num=0;
							        'step 1';
							        event.card=get.cards(1);
							        event.targets[event.num].removeSkill('ssr_lianhuan_link');
							        'step 2';
							        trigger.player.useCard(trigger.card,event.targets[event.num],event.card,false);
							        'step 3';
							        event.num++;
							        'step 4';
							        if(event.num<event.targets.length) event.goto(1);
							        'step 5';
							        {if(event&&event.finish){event.finish();}else {return;}}*/
                                }
                            },
                        },
                        audio: 'lianhuan1',
                        enable: "phaseUse",
                        usable: 2,
                        position: "he",
                        check: function(card) {
                            return 9 - get.value(card);
                        },
                        filterCard: function(card, player) {
                            if (get.suit(card) == 'club') return true;
                            if (player.storage.ssr_lianhuan_suits) {
                                var suits = player.storage.ssr_lianhuan_suits;
                                if (suits.contains(get.suit(card))) return true;
                            } else {
                                player.storage.ssr_lianhuan_suits = [];
                            }
                            return false;
                            //return get.suit(card)=='club';
                        },
                        filter: function(event, player) {
                            if (player.countCards('he', {
                                suit: 'club'
                            }) > 0) return true;
                            if (player.storage.ssr_lianhuan_suits) {
                                var suits = player.storage.ssr_lianhuan_suits;
                                for (var i = 0; i < suits.length; i++) {
                                    if (player.countCards('he', {
                                        suit: suits[i]
                                    }) > 0) return true;
                                }
                            } else {
                                player.storage.ssr_lianhuan_suits = [];
                            }
                            return false;
                            //return player.countCards('he',{suit:'club'})>0;
                        },
                        filterTarget: function(card, player, target) {
                            return true;
                            //return target!=player;
                        },
                        init: function(player, skill) {
                            player.storage.ssr_lianhuan_suits = [];
                        },
                        selectTarget: [1, 3],
                        /*onuse:function(result,player){
					        player.draw();
					    },*/
                        content: function() {
                            if (!target.hasSkill('ssr_lianhuan_relink')) {
                                target.addSkill('ssr_lianhuan_relink');
                            } else {
                                target.removeSkill('ssr_lianhuan_relink');
                            }
                        },
                        ai: {
                            order: 9,
                            result: {
                                player: function(player, target) {
                                    /*if(game.countPlayer(function(current){
					                    return get.attitude(player,current)<0;
					                })>1) return -2.5;
					                return -1;*/
                                    if (target.hasSkill('ssr_lianhuan_relink') && get.attitude(player, target) > 0) {
                                        return 1.5;
                                    } else {
                                        return 0.5;
                                    }
                                    //return 0.5;
                                },
                                target: function(player, target) {
                                    if (target.hasSkill('ssr_lianhuan_relink')) {
                                        return 2;
                                    } else {
                                        return - 2;
                                    }
                                },
                            },
                            threaten: 1.3,
                        },
                    },
                    "ssr_newsance_xicheng_pile": {},
                    "ssr_newsance_weicheng_pile": {},
                    "ssr_newsance_shoucheng_pile": {},
                    "ssr_newsance": {
                        group: 'ssr_newsance_achieve',
                        subSkill: {
                            achieve: {
                                trigger: {
                                    //source:["damageSource","recoverEnd"],
                                    global: ['damageEnd', 'recoverEnd'],
                                },
                                filter: function(event, player) {
                                    if (!event.source || event.source != player) return false;
                                    return (event.card && (event.card.isSance || event.card.name.indexOf('ssr_newsance_') == 0));
                                },
                                silent: true,
                                forced: true,
                                priority: 12,
                                content: function() {
                                    if (!player.storage.ssr_lianhuan_suits) player.storage.ssr_lianhuan_suits = [];
                                    var suit = get.suit(trigger.card);
                                    if (trigger.card.isSance) suit = get.suit(game.createCard({
                                        name: trigger.card.name,
                                        number: trigger.card.number,
                                        suit: trigger.card.isSance
                                    }));
                                    player.storage.ssr_lianhuan_suits.add(suit);
                                    player.addTempSkill('ssr_newsance_adds');
                                },
                                sub: true,
                            },
                            adds: {
                                mod: {
                                    maxHandcardBase: function(player, num) {
                                        return num + 2;
                                    },
                                },
                                charlotte: true,
                                mark: true,
                                marktext: "计成",
                                intro: {
                                    name: "直取西川",
                                    content: function(storage, player, skill) {
                                        var suits = player.storage.ssr_lianhuan_suits ? player.storage.ssr_lianhuan_suits: [];
                                        suits.add('club');
                                        var str = '本回合你的手牌上限加二<li>你的〖连环〗已解锁' + get.translation(suits) + '花色';
                                        return str;
                                    },
                                },
                                sub: true,
                            },
                            used: {
                                charlotte: true,
                                sub: true,
                            },
                            ai: {
                                charlotte: true,
                                sub: true,
                            },
                        },
                        enable: 'phaseUse',
                        init: function(player, skill) {
                            //袭城————————————————————————————————————————————
                            lib.card['ssr_newsance_xicheng'] = {
                                image: 'ext:祖安武将/card/sance_xicheng.png',
                                opacity: 1,
                                textShadow: 'black 0 0 2px',
                                fullskin: true,
                                type: "trick",
                                enable: true,
                                filterTarget: function(card, player, target) {
                                    return target != player;
                                },
                                content: function() {
                                    "step 0";
                                    if (target.countCards('h') == 0) {
                                        //{if(event&&event.finish){event.finish();}else {return;}}
                                        //return;
                                        game.log(target, '无可展示牌');
                                        event.goto(2);
                                    } else {
                                        target.chooseCard().ai = function(card) {
                                            if (card.name == 'sha' && get.attitude(target, player) < 0) return 99;
                                            if (_status.event.getRand() < 0.5) return Math.random();
                                            return get.value(card);
                                        };
                                    }
                                    "step 1";
                                    if (result.bool) {
                                        event.dialog = ui.create.dialog(get.translation(target) + '展示的手牌', result.cards);
                                        event.videoId = lib.status.videoId++;

                                        game.broadcast('createDialog', event.videoId, get.translation(target) + '展示的手牌', result.cards);
                                        game.addVideo('cardDialog', null, [get.translation(target) + '展示的手牌', get.cardsInfo(result.cards), event.videoId]);
                                        event.card2 = result.cards[0];
                                        game.log(target, '展示了', event.card2);
                                        event._result = {};
                                        game.delay();
                                    } else {
                                        game.log(target, '未展示手牌');
                                    }
                                    "step 2";
                                    if (event.card2 && event.card2.name == 'sha') {
                                        target.useCard(event.card2, player);
                                    } else {
                                        target.damage(event.baseDamage || 1);
                                    }
                                    if (event.dialog) {
                                        event.dialog.close();
                                        game.addVideo('cardDialog', null, event.videoId);
                                        game.broadcast('closeDialog', event.videoId);
                                    }
                                },
                                ai: {
                                    basic: {
                                        order: 4,
                                        value: [3, 1],
                                        useful: 1,
                                    },
                                    wuxie: function(target, card, player, current, state) {
                                        if (get.attitude(current, player) >= 0 && state > 0) return false;
                                    },
                                    result: {
                                        player: function(player, target) {
                                            var num = player.countCards('h', {
                                                name: 'shan'
                                            });
                                            if (target.hasSkill('ssr_lianhuan_relink')) {
                                                num += 0.2;
                                                num -= game.countPlayer(function(current) {
                                                    return current != target && current.hasSkill('ssr_lianhuan_relink') && get.attitude(player, current) > 0;
                                                }) * 0.5;
                                                num += game.countPlayer(function(current) {
                                                    return current != target && current.hasSkill('ssr_lianhuan_relink') && get.attitude(player, current) <= 0;
                                                }) * 0.5;
                                            }
                                            return num - 0.5;
                                        },
                                        target: function(player, target) {
                                            //if(target.countCards('h')==0) return 0;
                                            return - Math.max(5 - target.countCards('h'), 0) * 0.5;
                                        },
                                    },
                                    tag: {
                                        damage: 1,
                                        norepeat: 1,
                                    },
                                },
                                selectTarget: 1,
                            };
                            lib.translate['ssr_newsance_xicheng'] = '袭城';
                            lib.translate['ssr_newsance_xicheng_info'] = get.translation('ssr_newsance_xicheng_pile_info');
                            //围城————————————————————————————————————————————
                            lib.card['ssr_newsance_weicheng'] = {
                                image: 'ext:祖安武将/card/sance_weicheng.png',
                                opacity: 1,
                                textShadow: 'black 0 0 2px',
                                fullskin: true,
                                type: "trick",
                                enable: true,
                                filterTarget: function(card, player, target) {
                                    return target != player;
                                },
                                content: function() {
                                    "step 0";
                                    target.draw();
                                    "step 1";
                                    if (target.countCards('h') == 0) {
                                        {
                                            if (event && event.finish) {
                                                event.finish();
                                            } else {
                                                return;
                                            }
                                        }
                                        return;
                                    }
                                    "step 2";
                                    target.chooseCard(true).ai = function(card) {
                                        if (get.attitude(target, player) > 0) {
                                            return get.value(card);
                                        } else {
                                            return - get.value(card);
                                        }
                                    };
                                    "step 3";
                                    event.card2 = result.cards[0];
                                    player.gain(event.card2, target, 'gain2');
                                    "step 4";
                                    var str = '是否弃置' + get.translation(result.cards) + '并对' + get.translation(target.name) + '使用一张无次数限制的【杀】？';
                                    player.chooseControl('确定', '取消',
                                    function() {
                                        if (get.attitude(player, target) < 0 && get.value(event.card2) < 7) return '确定';
                                        return '取消';
                                    }).set('dialog', [str, result.cards]);
                                    "step 5";
                                    if (result.control == '确定') {
                                        player.discard(event.card2);
                                        player.useCard({
                                            name: 'sha',
                                            isSance: 'diamond'
                                        },
                                        target, false);
                                    }
                                },
                                ai: {
                                    basic: {
                                        order: 4,
                                        value: [3, 1],
                                        useful: 1,
                                    },
                                    wuxie: function(target, card, player, current, state) {
                                        if (get.attitude(current, player) >= 0 && state > 0) return false;
                                    },
                                    result: {
                                        player: function(player, target) {
                                            var num = 1.5;
                                            if (target.hasSkill('ssr_lianhuan_relink')) {
                                                num += 0.2;
                                                num -= game.countPlayer(function(current) {
                                                    return current != target && current.hasSkill('ssr_lianhuan_relink') && get.attitude(player, current) > 0;
                                                }) * 0.5;
                                                num += game.countPlayer(function(current) {
                                                    return current != target && current.hasSkill('ssr_lianhuan_relink') && get.attitude(player, current) <= 0;
                                                }) * 0.5;
                                            }
                                            return num;
                                        },
                                    },
                                    tag: {
                                        damage: 1,
                                        norepeat: 1,
                                    },
                                },
                                selectTarget: 1,
                            };
                            lib.translate['ssr_newsance_weicheng'] = '围城';
                            lib.translate['ssr_newsance_weicheng_info'] = get.translation('ssr_newsance_weicheng_pile_info');
                            //守城————————————————————————————————————————————
                            lib.card['ssr_newsance_shoucheng'] = {
                                image: 'ext:祖安武将/card/sance_shoucheng.png',
                                opacity: 1,
                                textShadow: 'black 0 0 2px',
                                fullskin: true,
                                type: "trick",
                                enable: true,
                                selectTarget: -1,
                                toself: true,
                                filterTarget: function(card, player, target) {
                                    return target == player;
                                },
                                modTarget: true,
                                content: function() {
                                    "step 0";
                                    event.cards = get.cards(3);
                                    "step 1";
                                    target.chooseCardButton('选择其中一张牌', true, event.cards, 1).set('ai',
                                    function(button) {
                                        if (get.suit(button) == 'heart' && target.hp < target.maxHp) return 99;
                                        if (get.suit(button) == 'heart') return - 1;
                                        return get.value(button);
                                    });
                                    "step 2";
                                    var card = result.links[0];
                                    if (get.suit(card) == 'heart') {
                                        game.log(target, '选择的牌为红桃牌');
                                        target.recover();
                                    } else {
                                        game.log(target, '获得了一张牌');
                                        target.gain(card, 'draw');
                                    }
                                },
                                ai: {
                                    basic: {
                                        order: 7.2,
                                        useful: 4.5,
                                        value: 7,
                                    },
                                    result: {
                                        player: function(player, target) {
                                            var num = 0;
                                            if (target.hasSkill('ssr_lianhuan_relink')) {
                                                num += 0.2;
                                                num += game.countPlayer(function(current) {
                                                    return current != target && current.hasSkill('ssr_lianhuan_relink') && get.attitude(player, current) > 0;
                                                }) * 0.5;
                                                num -= game.countPlayer(function(current) {
                                                    return current != target && current.hasSkill('ssr_lianhuan_relink') && get.attitude(player, current) <= 0;
                                                }) * 0.5;
                                            }
                                            return num;
                                        },
                                        target: 1.5,
                                    },
                                    tag: {
                                        draw: 1,
                                    },
                                },
                            };
                            lib.translate['ssr_newsance_shoucheng'] = '守城';
                            lib.translate['ssr_newsance_shoucheng_info'] = get.translation('ssr_newsance_shoucheng_pile_info');
                        },
                        derivation: ['ssr_newsance_xicheng_pile', 'ssr_newsance_weicheng_pile', 'ssr_newsance_shoucheng_pile'],
                        filter: function(event, player) {
                            return ! player.hasSkill('ssr_newsance_used');
                        },
                        audio: 'xinfu_zhanji',
                        content: function() {
                            'step 0';
                            var cards = [];
                            var trick = ['xicheng', 'weicheng', 'shoucheng'];
                            var suits = ['spade', 'diamond', 'heart'];
                            for (var i = 0; i < trick.length; i++) {
                                cards.push(game.createCard({
                                    name: 'ssr_newsance_' + trick[i],
                                    number: 12,
                                    suit: suits[i]
                                }));
                            }
                            //cards.sort(lib.sort.name);
                            var dialog = ui.create.dialog('取川三策', [cards, 'vcard']);
                            player.chooseButton(dialog).ai = function(button) {
                                return Math.random() * 10;
                            }
                            'step 1';
                            if (result.bool) {
                                player.chooseUseTarget(result.links[0], true, false);
                                player.addTempSkill('ssr_newsance_used');
                            } else {
                                player.addTempSkill('ssr_newsance_ai');
                            }
                        },
                        ai: {
                            order: 4,
                            result: {
                                player: function(player) {
                                    if (player.hasSkill('ssr_newsance_ai')) return 0;
                                    return 1;
                                },
                                target: function(player, target) {
                                    if (player.hasSkill('ssr_newsance_ai')) return 0;
                                    return - 1;
                                },
                            },
                            threaten: 1.2,
                        },
                    },
                    "ssr_sance": {
                        group: ['ssr_sance_respond', 'ssr_sance_wuxie', 'ssr_sance_shan'],
                        subSkill: {
                            wuxie: {
                                audio: 'xinfu_zhanji',
                                enable: "chooseToUse",
                                filterCard: true,
                                position: "h",
                                selectCard: -1,
                                viewAs: {
                                    name: "wuxie",
                                },
                                hiddenCard: function(player, name) {
                                    return player.countMark('ssr_sance') > 0;
                                },
                                viewAsFilter: function(player) {
                                    return player.countMark('ssr_sance') > 0;
                                },
                                precontent: function() {
                                    event.card = get.cards(1);
                                    player.logSkill('ssr_sance_wuxie');
                                    event.result.card.cards = event.card;
                                    event.result.cards = event.card;
                                    event.getParent().addCount = false;
                                    event.getParent().ssr_sance_wuxie = true;
                                },
                                onuse: function(result, player) {
                                    player.removeMark('ssr_sance');
                                },
                                prompt: "是否发动〖三策〗，将一枚“策”标记当做【无懈可击】打出？",
                                check: function(card) {
                                    return 8 - get.equipValue(card)
                                },
                                ai: {
                                    order: 1,
                                    basic: {
                                        useful: [6, 4],
                                        value: [6, 4],
                                    },
                                    result: {
                                        player: 2,
                                    },
                                    expose: 0.2,
                                },
                                sub: true,
                            },
                            shan: {
                                audio: 'xinfu_zhanji',
                                prompt: "是否发动〖三策〗，将一枚“策”标记当做【闪】使用？",
                                enable: "chooseToUse",
                                filter: function(event, player) {
                                    return player.countMark('ssr_sance') > 0; //&&!_status.dying.length;
                                },
                                onuse: function(result, player) {
                                    player.removeMark('ssr_sance');
                                },
                                filterCard: true,
                                position: "hes",
                                selectCard: -1,
                                viewAs: {
                                    name: "shan",
                                },
                                ai: {
                                    skillTagFilter: function(player) {
                                        return player.countCards('hes') && !player.getStorage('taoluan').contains('shan') && !player.hasSkill('taoluan3');
                                    },
                                    respondShan: true,
                                    order: 1,
                                    basic: {
                                        useful: [7, 2],
                                        value: [7, 2],
                                    },
                                    result: {
                                        player: 1,
                                    },
                                },
                                sub: true,
                            },
                            respond: {
                                trigger: {
                                    player: "chooseToRespondBegin",
                                },
                                filter: function(event, player) {
                                    if (event.responded) return false;
                                    if (!event.filterCard({
                                        name: 'shan'
                                    }) && !event.filterCard({
                                        name: 'sha'
                                    })) return false;
                                    if (!lib.filter.cardRespondable({
                                        name: 'shan'
                                    },
                                    player, event) && !lib.filter.cardRespondable({
                                        name: 'sha'
                                    },
                                    player, event)) return false;
                                    return player.countMark('ssr_sance') > 0;
                                },
                                direct: true,
                                audio: 'xinfu_zhanji',
                                content: function() {
                                    "step 0";
                                    if (trigger.filterCard({
                                        name: 'shan'
                                    }) && lib.filter.cardRespondable({
                                        name: 'shan'
                                    },
                                    player, trigger)) event.name = 'shan';
                                    else event.name = 'sha';
                                    player.chooseControl('确定', '取消').set('ai',
                                    function() {
                                        if (Math.random() * 3 + 2.5 > (player.hp * 2 + player.countCards('h'))) return '确定';
                                        return '取消';
                                    }).set('prompt', '是否发动〖三策〗，将一枚“策”标记当做【' + get.translation(event.name) + '】打出？');
                                    "step 1";
                                    if (result.control == '确定') {
                                        trigger.untrigger();
                                        trigger.responded = true;
                                        trigger.result = {
                                            bool: true,
                                            card: {
                                                name: event.name
                                            },
                                            cards: [event.card],
                                            noanimate: true
                                        };
                                        player.removeMark('ssr_sance');
                                    }
                                },
                                ai: {
                                    order: 1,
                                    useful: -1,
                                    value: -1,
                                },
                                sub: true,
                            },
                        },
                        //mark:true,
                        marktext: "策",
                        init: function(player) {
                            if (!player.storage.ssr_sance && player.countMark('ssr_sance') <= 0) {
                                player.addMark('ssr_sance', 3);
                                player.markSkill('ssr_sance');
                            }
                            if (player.countMark('ssr_sance') > 0) player.markSkill('ssr_sance');
                        },
                        intro: {
                            name: "取川三策",
                            content: "mark",
                        },
                        enable: "chooseToUse",
                        filter: function(event, player) {
                            return event.type != 'wuxie' && event.type != 'respondShan' && player.countMark('ssr_sance') > 0;
                        },
                        hiddenCard: function(player, name) {
                            return (player.countMark('ssr_sance') > 0 && lib.inpile.contains(name));
                        },
                        onremove: true,
                        chooseButton: {
                            dialog: function(event, player) {
                                var list = [];
                                for (var i = 0; i < lib.inpile.length; i++) {
                                    var name = lib.inpile[i];
                                    if (name == 'sha') {
                                        list.push(['基本', '', 'sha']);
                                        list.push(['基本', '', 'sha', 'fire']);
                                        list.push(['基本', '', 'sha', 'thunder']);
                                        list.push(['基本', '', 'sha', 'ice']);
                                    } else if (get.type(name) == 'trick') list.push(['锦囊', '', name]);
                                    else if (get.type(name) == 'delay') list.push(['延时', '', name]);
                                    else if (get.type(name) == 'basic') list.push(['基本', '', name]);
                                }
                                if (list.length == 0) {
                                    return ui.create.dialog('〖三策〗已无可用牌');
                                }
                                return ui.create.dialog('取川三策', [list, 'vcard']);
                            },
                            filter: function(button, player) {
                                return _status.event.getParent().filterCard({
                                    name: button.link[2]
                                },
                                player, _status.event.getParent());
                            },
                            check: function(button) {
                                var player = _status.event.player;
                                if (player.countCards('h', button.link[2]) == 1) return 0;
                                if (button.link[2] == 'wugu') return 0;
                                var effect = player.getUseValue(button.link[2]);
                                if (effect > 0) return effect;
                                return 0;
                            },
                            backup: function(links, player) {
                                return {
                                    filterCard: true,
                                    audio: 'xinfu_zhanji',
                                    selectCard: -1,
                                    popname: true,
                                    check: function(card) {
                                        return 11 - get.value(card);
                                    },
                                    position: 'h',
                                    viewAs: {
                                        name: links[0][2],
                                        nature: links[0][3]
                                    },
                                    onuse: function(result, player) {
                                        player.removeMark('ssr_sance');
                                    },
                                    precontent: function() {
                                        event.card = get.cards(1);
                                        player.logSkill('ssr_sance');
                                        event.result.card.cards = event.card;
                                        event.result.cards = event.card;
                                        event.getParent().addCount = false;
                                        event.getParent().ssr_sance = true;
                                    },
                                }
                            },
                            prompt: function(links, player) {
                                return '将一枚“策”标记当做【' + (get.translation(links[0][3]) || '') + get.translation(links[0][2]) + '】使用';
                            },
                        },
                        ai: {
                            skillTagFilter: function(player) {
                                if (player.countMark('ssr_sance') < 1) return false;
                                return true;
                            },
                            order: 1,
                            result: {
                                player: function(player) {
                                    var allshown = true,
                                    players = game.filterPlayer();
                                    for (var i = 0; i < players.length; i++) {
                                        if (players[i].ai.shown == 0) {
                                            allshown = false;
                                        }
                                        if (players[i] != player && players[i].countCards('h') && get.attitude(player, players[i]) > 0) {
                                            return 1;
                                        }
                                    }
                                    if (allshown) return 1;
                                    return 0;
                                },
                            },
                            threaten: 1.1,
                        },
                    },
                    "ssr_motu": {
                        audio: 'jsrgqiongtu',
                        trigger: {
                            player: 'damageEnd'
                        },
                        priority: 4,
                        round: 1,
                        forced: true,
                        filter: function(event, player) {
                            return player.getHp() <= 1 && player.countCards('h') > 0;
                        },
                        content: function() {
                            'step 0';
                            player.discard(player.getCards('h').randomGet());
                            'step 1';
                            player.changeHujia(1, null, true);
                        },
                        ai: {
                            maixie: true,
                        }
                    },
                    "ssr_newxiebian_futu_pile": {},
                    "ssr_newxiebian_fantian_pile": {},
                    "ssr_newxiebian_xiuluo_pile": {},
                    "ssr_newxiebian_shijia_pile": {},
                    "ssr_newxiebian": {
                        subSkill: {
                            futu: {
                                intro: {
                                    name: "浮屠",
                                    content: "<li>直到下回合开始，你不能成为延时锦囊牌的目标",
                                },
                                locked: true,
                                mark: true,
                                marktext: "浮屠",
                                mod: {
                                    targetEnabled: function(card) {
                                        if (get.type(card) == 'delay') return false;
                                    },
                                },
                                sub: true,
                            },
                            fantian: {
                                intro: {
                                    name: "梵天",
                                    content: "<li>直到下回合开始，你不能成为普通锦囊牌的目标",
                                },
                                locked: true,
                                mark: true,
                                marktext: "梵天",
                                mod: {
                                    targetEnabled: function(card) {
                                        if (get.type(card) == 'trick') return false;
                                    },
                                },
                                sub: true,
                            },
                            xiuluo: {
                                intro: {
                                    name: "修罗",
                                    content: "<li>直到下回合开始，你不能成为基本牌的目标",
                                },
                                locked: true,
                                mark: true,
                                marktext: "修罗",
                                mod: {
                                    targetEnabled: function(card) {
                                        if (get.type(card) == 'basic') return false;
                                    },
                                },
                                sub: true,
                            },
                            shijia: {
                                intro: {
                                    name: "释迦",
                                    content: "<li>直到下回合开始，你不能成为装备牌的目标",
                                },
                                locked: true,
                                mark: true,
                                marktext: "释迦",
                                mod: {
                                    targetEnabled: function(card) {
                                        if (get.type(card) == 'equip') return false;
                                    },
                                },
                                sub: true,
                            },
                        },
                        derivation: ['ssr_newxiebian_futu_pile', 'ssr_newxiebian_fantian_pile', 'ssr_newxiebian_xiuluo_pile', 'ssr_newxiebian_shijia_pile'],
                        trigger: {
                            player: ["phaseZhunbeiBegin"],
                        },
                        audio: 'qiaobian1',
                        direct: true,
                        priority: 49,
                        filter: function(event, player) {
                            return true;
                        },
                        init: function(player, skill) {
                            var names = ['futu', 'fantian', 'xiuluo', 'shijia'];
                            var translists = ['浮屠', '梵天', '修罗', '释迦'];
                            var suits = ['spade', 'club', 'diamond', 'heart'];
                            var color = ['black', 'black', 'red', 'red'];
                            var phasename = ['phaseJudge', 'phaseDraw', 'phaseUse', 'phaseDiscard'];
                            for (var i = 0; i < 4; i++) {
                                lib.card['xiebian_' + names[i]] = {
                                    fullskin: true,
                                    //type:"zhenfa",
                                    image: 'ext:祖安武将/card/xiebian_' + names[i] + '.png',
                                    color: color[i],
                                    suit: suits[i],
                                    number: 13,
                                    opacity: 1,
                                    textShadow: 'black 0 0 2px',
                                    skip: phasename[i],
                                    realname: names[i],
                                    realnum: i + 1,
                                };
                                lib.translate['xiebian_' + names[i] + ''] = translists[i];
                                lib.translate['xiebian_' + names[i] + '_info'] = get.translation('ssr_newxiebian_' + names[i] + '_pile_info');
                            }
                        },
                        content: function() {
                            "step 0";
                            var names = ['futu', 'fantian', 'xiuluo', 'shijia'];
                            event.phasename = ['phaseJudge', 'phaseDraw', 'phaseUse', 'phaseDiscard'];
                            event.cards = [];
                            for (var i = 0; i < 4; i++) {
                                var suit = lib.card['xiebian_' + names[i]].suit;
                                event.cards.push(game.createCard({
                                    name: 'xiebian_' + names[i],
                                    suit: suit,
                                    number: 0
                                }));
                            }
                            player.chooseCardButton('是否选择发动〖诡变〗的一项', event.cards, 1).set('filterButton',
                            function(button) {
                                var skip = lib.card[button.link.name].skip;
                                return ! player.skipList.contains(skip);
                            }).set('ai',
                            function(button) {
                                if (button.link.name == "xiebian_futu") {
                                    return player.countCards('j') * 3;
                                }
                                if (button.link.name == "xiebian_fantian") {
                                    return Math.min(game.countPlayer(function(current) {
                                        return get.attitude(player, current) < 0 && current.countCards('h');
                                    }), 2) * 2 - 2;
                                }
                                if (button.link.name == "xiebian_xiuluo") {
                                    if (player.canMoveCard(true)) {
                                        if (game.hasPlayer(function(current) {
                                            if (get.attitude(player, current) > 0 && current.countCards('j')) return true;
                                            if (get.attitude(player, current) < 0 && current.countCards('e')) return true;
                                            return false;
                                        })) {
                                            return 2.5;
                                        }
                                    }
                                    return 0;
                                }
                                if (button.link.name == "xiebian_shijia") {
                                    return player.needsToDiscard() + 2 - player.countCards('j') * 2 + Math.min(game.countPlayer(function(current) {
                                        return get.attitude(player, current) < 0 && current.countCards('h');
                                    }), 1) * 0.5;
                                }
                                return 0;
                            });
                            "step 1";
                            if (result.bool && result.links) {
                                event.skillname = get.translation(result.links[0].name);
                                event.realname = lib.card[result.links[0].name].realname;
                                event.realnum = lib.card[result.links[0].name].realnum;
                                var addskill = 'ssr_newxiebian_' + event.realname;
                                event.skip = lib.card[result.links[0].name].skip;
                                player.skip(event.skip);
                                game.log(player, '发动了〖诡变〗的', event.skillname, '效果');
                                player.addTempSkill(addskill, {
                                    player: 'phaseZhunbeiBegin'
                                });
                                if (event.realnum == 1) event.goto(3);
                                if (event.realnum == 2) event.goto(4);
                                if (event.realnum == 3) event.goto(8);
                                if (event.realnum == 4) event.goto(9);
                            }
                            "step 2"; {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                            "step 3";
                            if (player.countCards('j') > 0) player.gain(player.getCards('j'), 'gain2'); {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                            "step 4";
                            player.chooseTarget([1, 2], '获得至多两名角色各一张手牌',
                            function(card, player, target) {
                                return target != player && target.countCards('h');
                            }).set('ai',
                            function(target) {
                                return - get.attitude(_status.event.player, target);
                            });
                            "step 5";
                            if (result.bool) {
                                result.targets.sortBySeat();
                                player.line(result.targets, 'green');
                                event.targets = result.targets;
                                if (!event.targets.length) {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            "step 6";
                            player.gainMultiple(event.targets);
                            "step 7";
                            game.delay(); {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                            "step 8";
                            player.moveCard(); {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                            "step 9";
                            player.chooseTarget('观看一名角色的手牌并弃置其中一张', 1,
                            function(card, player, target) {
                                return target.countCards('h');
                            },
                            function(target) {
                                return - get.attitude(player, target);
                            });
                            'step 10';
                            event.target = result.targets[0];
                            event.videoId = lib.status.videoId++;
                            var cards = event.target.getCards('h');
                            var str = get.translation(event.target.name) + '的手牌';
                            if (player.isOnline2()) {
                                player.send(function(cards, id) {
                                    ui.create.dialog(str, cards).videoId = id;
                                },
                                cards, event.videoId);
                            }
                            event.dialog = ui.create.dialog(str, cards);
                            event.dialog.videoId = event.videoId;
                            if (!event.isMine()) {
                                event.dialog.style.display = 'none';
                            }
                            player.chooseButton().set('filterButton',
                            function(button) {
                                return true;
                            }).set('dialog', event.videoId);
                            'step 11';
                            if (result.bool && result.links) {
                                event.card = result.links[0];
                                event.dialog.close();
                                event.target.discard(event.card);
                            } {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                        },
                        ai: {
                            threaten: 1.7,
                        },
                    },
                    "ssr_xiebian": {
                        derivation: ['ssr_xiebian_futu', 'ssr_xiebian_fantian', 'ssr_xiebian_xiuluo', 'ssr_xiebian_shijia'],
                        group: ['ssr_xiebian_judge', 'ssr_xiebian_draw', 'ssr_xiebian_use', 'ssr_xiebian_dis', 'ssr_xiebian_jia'],
                        subSkill: {
                            jia: {
                                audio: 'spolzhouxuan',
                                preHidden: true,
                                trigger: {
                                    player: ["damageBegin"],
                                },
                                forced: true,
                                locked: true,
                                priority: -31,
                                filter: function(event, player) {
                                    return event.num > 0 && player.countMark('ssr_xiebian_jia') > 0;
                                },
                                content: function() {
                                    if (trigger.num > player.countMark('ssr_xiebian_jia')) {
                                        var num = player.countMark('ssr_xiebian_jia');
                                    } else {
                                        var num = trigger.num;
                                    }
                                    if (trigger.name == 'damage') {
                                        if (trigger.animate !== false) {
                                            player.$damage(trigger.source);
                                            if (window.zuanDamageAudio) game.playAudio('..', 'extension', '祖安武将', 'audio', 'hudun.mp3');
                                            game.broadcastAll(function(nature, player) {
                                                if (lib.config.animation && !lib.config.low_performance) {
                                                    if (nature == 'fire') {
                                                        player.$fire();
                                                    } else if (nature == 'thunder') {
                                                        player.$thunder();
                                                    }
                                                }
                                            },
                                            trigger.nature, player);
                                            player.$damagepop( - num, trigger.nature);
                                        }
                                    }
                                    game.log(player, '的器械抵挡了', get.cnNumber(num), '点伤害');
                                    player.removeMark('ssr_xiebian_jia', num);
                                    trigger.num -= num;
                                },
                                marktext: "械",
                                intro: {
                                    name: "机巧械具",
                                    content: "mark",
                                },
                                mod: {
                                    maxHandcardBase: function(player, num) {
                                        return num + player.countMark('ssr_xiebian_jia');
                                    },
                                },
                                sub: true,
                            },
                            disable: {
                                sub: true,
                            },
                            judge: {
                                audio: 'qiaobian1',
                                trigger: {
                                    player: "phaseJudgeBefore",
                                },
                                filter: function(event, player) {
                                    if (player.hasSkill('ssr_xiebian_disable')) return false;
                                    return player.countCards('he') > 0;
                                },
                                direct: true,
                                frequent: true,
                                content: function() {
                                    "step 0";
                                    if (1 == 0 && player.countCards('j') == 0 && !event.isOnline() && (!event.isMine() || !lib.config.autoskilllist.contains('qiaobian1'))) {
                                        {
                                            if (event && event.finish) {
                                                event.finish();
                                            } else {
                                                return;
                                            }
                                        }
                                    } else {
                                        var next = player.chooseToDiscard(get.prompt('ssr_xiebian'), 'he', '跳过判定阶段并获得判定区的所有牌，然后获得技能〖浮屠〗');
                                        next.set('ai', get.unuseful2);
                                        next.set('logSkill', 'ssr_xiebian');
                                        next.setHiddenSkill('ssr_xiebian');
                                    }
                                    "step 1";
                                    if (result.bool) {
                                        player.addTempSkill('ssr_xiebian_disable', {
                                            player: 'phaseBegin'
                                        });
                                        player.addTempSkill('ssr_xiebian_futu', {
                                            player: 'phaseBegin'
                                        });
                                        trigger.cancel();
                                        if (player.countCards('j') > 0) player.gain(player.getCards('j'), 'gain2');
                                    }
                                },
                                sub: true,
                            },
                            draw: {
                                audio: 'qiaobian2',
                                trigger: {
                                    player: "phaseDrawBefore",
                                },
                                filter: function(event, player) {
                                    if (player.hasSkill('ssr_xiebian_disable')) return false;
                                    return player.countCards('he') > 0;
                                },
                                direct: true,
                                content: function() {
                                    "step 0";
                                    var check, i, num = 0,
                                    num2 = 0,
                                    players = game.filterPlayer();
                                    for (var i = 0; i < players.length; i++) {
                                        if (player != players[i] && players[i].countCards('he')) {
                                            var att = get.attitude(player, players[i]);
                                            if (att <= 0) {
                                                num++;
                                            }
                                            if (att < 0) {
                                                num2++;
                                            }
                                        }
                                    }
                                    check = (num >= 2 && num2 > 0);

                                    player.chooseToDiscard(get.prompt('ssr_xiebian'), 'he', '跳过摸牌阶段并获得至多两名角色各一张手牌，然后获得技能〖梵天〗', lib.filter.cardDiscardable).set('ai',
                                    function(card) {
                                        if (!_status.event.check) return 0;
                                        return 7 - get.value(card);
                                    }).set('check', check).set('logSkill', 'ssr_xiebian').setHiddenSkill('ssr_xiebian');
                                    "step 1";
                                    if (result.bool) {
                                        trigger.cancel();
                                        player.chooseTarget([1, 2], '获得至多两名角色各一张手牌',
                                        function(card, player, target) {
                                            return target != player && target.countCards('h');
                                        }).set('ai',
                                        function(target) {
                                            return 1 - get.attitude(_status.event.player, target);
                                        })
                                    } else {
                                        {
                                            if (event && event.finish) {
                                                event.finish();
                                            } else {
                                                return;
                                            }
                                        }
                                    }
                                    "step 2";
                                    if (result.bool) {
                                        player.addTempSkill('ssr_xiebian_disable', {
                                            player: 'phaseBegin'
                                        });
                                        player.addTempSkill('ssr_xiebian_fantian', {
                                            player: 'phaseBegin'
                                        });
                                        result.targets.sortBySeat();
                                        player.line(result.targets, 'green');
                                        event.targets = result.targets;
                                        if (!event.targets.length) {
                                            if (event && event.finish) {
                                                event.finish();
                                            } else {
                                                return;
                                            }
                                        }
                                    } else {
                                        {
                                            if (event && event.finish) {
                                                event.finish();
                                            } else {
                                                return;
                                            }
                                        }
                                    }
                                    "step 3";
                                    player.gainMultiple(event.targets);
                                    "step 4";
                                    game.delay();
                                },
                                ai: {
                                    expose: 0.2,
                                },
                                sub: true,
                            },
                            use: {
                                audio: 'qiaobian3',
                                trigger: {
                                    player: "phaseUseBefore",
                                },
                                filter: function(event, player) {
                                    if (player.hasSkill('ssr_xiebian_disable')) return false;
                                    return player.countCards('he') > 0;
                                },
                                direct: true,
                                content: function() {
                                    "step 0";
                                    var check;
                                    if (!player.canMoveCard(true)) {
                                        check = false;
                                    } else {
                                        check = game.hasPlayer(function(current) {
                                            return get.attitude(player, current) > 0 && current.countCards('j');
                                        });
                                        if (!check) {
                                            if (player.needsToDiscard() > 1) {
                                                check = false;
                                            } else if (player.countCards('h', {
                                                name: ['wuzhong']
                                            })) {
                                                check = false;
                                            } else {
                                                check = true;
                                            }
                                        }
                                    }
                                    player.chooseToDiscard(get.prompt('ssr_xiebian'), 'he', '跳过出牌阶段并移动场上的一张牌，然后获得技能〖修罗〗', lib.filter.cardDiscardable).set('ai',
                                    function(card) {
                                        if (!_status.event.check) return 0;
                                        return 7 - get.value(card);
                                    }).set('check', check).set('logSkill', 'ssr_xiebian').setHiddenSkill('ssr_xiebian');
                                    "step 1";
                                    if (result.bool) {
                                        player.addTempSkill('ssr_xiebian_disable', {
                                            player: 'phaseBegin'
                                        });
                                        player.addTempSkill('ssr_xiebian_xiuluo', {
                                            player: 'phaseBegin'
                                        });
                                        trigger.cancel();
                                        player.moveCard();
                                    } else {
                                        {
                                            if (event && event.finish) {
                                                event.finish();
                                            } else {
                                                return;
                                            }
                                        }
                                    }
                                },
                                ai: {
                                    expose: 0.2,
                                },
                                sub: true,
                            },
                            dis: {
                                audio: 'qiaobian4',
                                trigger: {
                                    player: "phaseDiscardBefore",
                                },
                                direct: true,
                                filter: function(event, player) {
                                    if (player.hasSkill('ssr_xiebian_disable')) return false;
                                    return player.countCards('he') > 0;
                                },
                                content: function() {
                                    "step 0";
                                    var discard = player.needsToDiscard() > 0;
                                    var next = player.chooseToDiscard(get.prompt('ssr_xiebian'), 'he', '跳过弃牌阶段并重置一张牌，然后获得技能〖释迦〗');
                                    next.setHiddenSkill('ssr_xiebian');
                                    next.logSkill = 'ssr_xiebian';
                                    next.ai = function(card) {
                                        if (discard) {
                                            return 100 - get.useful(card);
                                        } else {
                                            return - 1;
                                        }
                                    };
                                    "step 1";
                                    if (result.bool) {
                                        player.addTempSkill('ssr_xiebian_disable', {
                                            player: 'phaseBegin'
                                        });
                                        player.addTempSkill('ssr_xiebian_shijia', {
                                            player: 'phaseBegin'
                                        });
                                        trigger.cancel();
                                        if (player.countCards('he') > 0) {
                                            player.chooseToDiscard('he', 1, true, '请重铸一张牌');
                                            player.draw();
                                        }
                                    }
                                },
                                sub: true,
                            },
                        },
                    },
                    "ssr_xiebian_futu": {
                        audio: 'qiaobian1',
                        trigger: {
                            player: "damageEnd",
                        },
                        filter: function(event, player) {
                            return event.num > 0;
                        },
                        intro: {
                            name: "浮屠",
                            content: "<li>锁定技，每当你受到一点伤害后，你进行一次判定：若为黑桃，你获得一枚“械”标记，否则你随机获得一张装备牌并可以使用之",
                        },
                        locked: true,
                        mark: true,
                        marktext: "浮屠",
                        forced: true,
                        content: function() {
                            "step 0";
                            event.num = trigger.num;
                            "step 1";
                            if (event.num < 1) {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                            "step 2";
                            event.num--;
                            player.judge(function(card) {
                                if (get.suit(card) == 'spade') return 2;
                                return - 0.5;
                            }).judge2 = function(result) {
                                return result.bool;
                            };
                            "step 3";
                            if (result.bool) {
                                player.addMark('ssr_xiebian_jia');
                                event.goto(1);
                            }
                            "step 4";
                            event.card = get.cardPile(function(card) {
                                if (get.type(card, 'trick') == 'equip') return true;
                                return false;
                            });
                            if (!event.card) {
                                event.goto(1);
                            }
                            "step 5";
                            player.line(player, 'green');
                            player.give(event.card, player);
                            "step 6";
                            if (!player.hasUseTarget(event.card)) {
                                //event.card.fix();
                                //ui.cardPile.insertBefore(event.card,ui.cardPile.firstChild);
                                game.updateRoundNumber();
                                event.goto(1);
                            }
                            'step 7';
                            var next = player.chooseUseTarget(event.card);
                            if (get.info(event.card).updateUsable == 'phaseUse') next.addCount = false;
                            event.goto(1);
                        },
                        ai: {
                            maixie: true,
                            "maixie_hp": true,
                            effect: {
                                target: function(card, player, target) {
                                    if (player.hasSkillTag('jueqing', false, target)) return [1, -1];
                                    return [1, 0.2];
                                },
                            },
                        },
                    },
                    "ssr_xiebian_fantian": {
                        audio: 'qiaobian2',
                        trigger: {
                            player: "damageEnd",
                        },
                        filter: function(event, player) {
                            return event.num > 0;
                        },
                        intro: {
                            name: "梵天",
                            content: "<li>锁定技，每当你受到一点伤害后，你进行一次判定：若为红桃，你获得一枚“械”标记，否则你随机获得一张延时锦囊牌并可以使用之",
                        },
                        locked: true,
                        mark: true,
                        marktext: "梵天",
                        forced: true,
                        content: function() {
                            "step 0";
                            event.num = trigger.num;
                            "step 1";
                            if (event.num < 1) {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                            "step 2";
                            event.num--;
                            player.judge(function(card) {
                                if (get.suit(card) == 'heart') return 2;
                                return - 0.5;
                            }).judge2 = function(result) {
                                return result.bool;
                            };
                            "step 3";
                            if (result.bool) {
                                player.addMark('ssr_xiebian_jia');
                                event.goto(1);
                            }
                            "step 4";
                            event.card = get.cardPile(function(card) {
                                if (get.type(card, 'trick') == 'delay') return true;
                                return false;
                            });
                            if (!event.card) {
                                event.goto(1);
                            }
                            "step 5";
                            player.line(player, 'green');
                            player.give(event.card, player);
                            "step 6";
                            if (!player.hasUseTarget(event.card)) {
                                //event.card.fix();
                                //ui.cardPile.insertBefore(event.card,ui.cardPile.firstChild);
                                game.updateRoundNumber();
                                event.goto(1);
                            }
                            'step 7';
                            var next = player.chooseUseTarget(event.card);
                            if (get.info(event.card).updateUsable == 'phaseUse') next.addCount = false;
                            event.goto(1);
                        },
                        ai: {
                            maixie: true,
                            "maixie_hp": true,
                            effect: {
                                target: function(card, player, target) {
                                    if (player.hasSkillTag('jueqing', false, target)) return [1, -1];
                                    return [1, 0.2];
                                },
                            },
                        },
                    },
                    "ssr_xiebian_xiuluo": {
                        audio: "qiaobian3",
                        trigger: {
                            player: "damageEnd",
                        },
                        filter: function(event, player) {
                            return event.num > 0;
                        },
                        intro: {
                            name: "修罗",
                            content: "<li>锁定技，每当你受到一点伤害后，你进行一次判定：若为梅花，你获得一枚“械”标记，否则你随机获得一张基本牌并可以使用之",
                        },
                        locked: true,
                        mark: true,
                        marktext: "修罗",
                        forced: true,
                        content: function() {
                            "step 0";
                            event.num = trigger.num;
                            "step 1";
                            if (event.num < 1) {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                            "step 2";
                            event.num--;
                            player.judge(function(card) {
                                if (get.suit(card) == 'club') return 2;
                                return - 0.5;
                            }).judge2 = function(result) {
                                return result.bool;
                            };
                            "step 3";
                            if (result.bool) {
                                player.addMark('ssr_xiebian_jia');
                                event.goto(1);
                            }
                            "step 4";
                            event.card = get.cardPile(function(card) {
                                if (get.type(card, 'trick') == 'basic') return true;
                                return false;
                            });
                            if (!event.card) {
                                event.goto(1);
                            }
                            "step 5";
                            player.line(player, 'green');
                            player.give(event.card, player);
                            "step 6";
                            if (!player.hasUseTarget(event.card)) {
                                //event.card.fix();
                                //ui.cardPile.insertBefore(event.card,ui.cardPile.firstChild);
                                game.updateRoundNumber();
                                event.goto(1);
                            }
                            'step 7';
                            var next = player.chooseUseTarget(event.card);
                            if (get.info(event.card).updateUsable == 'phaseUse') next.addCount = false;
                            event.goto(1);
                        },
                        ai: {
                            maixie: true,
                            "maixie_hp": true,
                            effect: {
                                target: function(card, player, target) {
                                    if (player.hasSkillTag('jueqing', false, target)) return [1, -1];
                                    return [1, 0.2];
                                },
                            },
                        },
                    },
                    "ssr_xiebian_shijia": {
                        audio: 'qiaobian4',
                        trigger: {
                            player: "damageEnd",
                        },
                        filter: function(event, player) {
                            return event.num > 0;
                        },
                        intro: {
                            name: "释迦",
                            content: "<li>锁定技，每当你受到一点伤害后，你进行一次判定：若为方块，你获得一枚“械”标记，否则你随机获得一张普通锦囊牌并可以使用之",
                        },
                        locked: true,
                        mark: true,
                        marktext: "释迦",
                        forced: true,
                        content: function() {
                            "step 0";
                            event.num = trigger.num;
                            "step 1";
                            if (event.num < 1) {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                            "step 2";
                            event.num--;
                            player.judge(function(card) {
                                if (get.suit(card) == 'diamond') return 2;
                                return - 0.5;
                            }).judge2 = function(result) {
                                return result.bool;
                            };
                            "step 3";
                            if (result.bool) {
                                player.addMark('ssr_xiebian_jia');
                                event.goto(1);
                            }
                            "step 4";
                            event.card = get.cardPile(function(card) {
                                if (get.type(card, 'trick') == 'trick') return true;
                                return false;
                            });
                            if (!event.card) {
                                event.goto(1);
                            }
                            "step 5";
                            player.line(player, 'green');
                            player.give(event.card, player);
                            "step 6";
                            if (!player.hasUseTarget(event.card)) {
                                //event.card.fix();
                                //ui.cardPile.insertBefore(event.card,ui.cardPile.firstChild);
                                game.updateRoundNumber();
                                event.goto(1);
                            }
                            'step 7';
                            var next = player.chooseUseTarget(event.card);
                            if (get.info(event.card).updateUsable == 'phaseUse') next.addCount = false;
                            event.goto(1);
                        },
                        ai: {
                            maixie: true,
                            "maixie_hp": true,
                            effect: {
                                target: function(card, player, target) {
                                    if (player.hasSkillTag('jueqing', false, target)) return [1, -1];
                                    return [1, 0.2];
                                },
                            },
                        },
                    },
                    "ssr_xunxun": {
                        subSkill: {
                            draw: {
                                audio: 'xunxun',
                                trigger: {
                                    player: "phaseZhunbeiBegin",
                                },
                                priority: -25,
                                filter: function(event, player) {
                                    return ! player.hujia;
                                    //return player.countMark('ssr_xunxun')<1;
                                },
                                prompt2: "准备阶段，若你没有护甲，你可以观看牌堆顶的四张牌，然后将其中的两张牌置于牌堆顶，将其余的牌置于牌堆底。",
                                content: function() {
                                    'step 0';;
                                    event.tops = get.cards(4);
                                    var hasEquip = false;
                                    for (var i = 0; i < event.tops.length; i++) {
                                        if (get.type(event.tops[i]) == 'equip') hasEquip = true;
                                    }
                                    if (hasEquip) {
                                        player.recover();
                                        game.delay();
                                    }
                                    'step 1';;
                                    var cards = event.tops;
                                    var player = event.player;
                                    var xunxun = decadeUI.content.chooseGuanXing(player, cards, cards.length, null, 2);
                                    xunxun.caption = '恂恂善诱';
                                    xunxun.header1 = '牌堆顶';
                                    xunxun.header2 = '牌堆底';
                                    xunxun.callback = function() {
                                        return this.cards[0].length == 2 && this.cards[1].length == 2;
                                    };

                                    game.broadcast(function(player, cards, callback) {
                                        if (!window.decadeUI) return;
                                        var xunxun = decadeUI.content.chooseGuanXing(player, cards, cards.length, null, 2);
                                        xunxun.caption = '恂恂善诱';
                                        xunxun.header1 = '牌堆顶';
                                        xunxun.header2 = '牌堆底';
                                        xunxun.callback = callback;
                                    },
                                    player, cards, xunxun.callback);

                                    event.switchToAuto = function() {
                                        var cards = decadeUI.get.bestValueCards(xunxun.cards[0].concat(), player);
                                        var time = 500;
                                        for (var i = 0; i < 2; i++) {
                                            setTimeout(function(card, index, finished) {
                                                xunxun.move(card, index, 1);
                                                if (finished) xunxun.finishTime(1000);
                                            },
                                            time, cards[i], i, i >= 1);
                                            time += 500;
                                        }
                                    };

                                    if (event.isOnline()) {
                                        event.player.send(function() {
                                            if (!window.decadeUI && decadeUI.eventDialog) _status.event.finish();
                                        },
                                        event.player);

                                        event.player.wait();
                                        decadeUI.game.wait();
                                    } else if (!event.isMine()) {
                                        event.switchToAuto();
                                    }

                                    'step 2';;
                                    var first = ui.cardPile.firstChild;
                                    var cards = event.cards1;
                                    for (var i = 0; i < cards.length; i++) {
                                        ui.cardPile.insertBefore(cards[i], first);
                                    }

                                    cards = event.cards2;
                                    for (var i = 0; i < cards.length; i++) {
                                        ui.cardPile.appendChild(cards[i]);
                                    }
                                },
                                sub: true,
                            },
                            hujia: {
                                audio: "xunxun",
                                preHidden: true,
                                trigger: {
                                    player: ["damageBegin"],
                                },
                                frequent: true,
                                priority: -25,
                                filter: function(event, player) {
                                    return event.num > 0 && player.countMark('ssr_xunxun') > 0;
                                },
                                content: function() {
                                    if (trigger.num > player.countMark('ssr_xunxun')) {
                                        var num = player.countMark('ssr_xunxun');
                                    } else {
                                        var num = trigger.num;
                                    }
                                    if (trigger.name == 'damage') {
                                        if (trigger.animate !== false) {
                                            player.$damage(trigger.source);
                                            if (window.zuanDamageAudio) game.playAudio('..', 'extension', '祖安武将', 'audio', 'hudun.mp3');
                                            game.broadcastAll(function(nature, player) {
                                                if (lib.config.animation && !lib.config.low_performance) {
                                                    if (nature == 'fire') {
                                                        player.$fire();
                                                    } else if (nature == 'thunder') {
                                                        player.$thunder();
                                                    }
                                                }
                                            },
                                            trigger.nature, player);
                                            player.$damagepop( - num, trigger.nature);
                                        }
                                    }
                                    game.log(player, '的护甲抵挡了', get.cnNumber(num), '点伤害');
                                    player.removeMark('ssr_xunxun', num);
                                    trigger.num -= num;
                                },
                                mod: {
                                    maxHandcardBase: function(player, num) {
                                        return num + player.countMark('ssr_xunxun');
                                    },
                                },
                                sub: true,
                            },
                        },
                        group: [
                        /*'ssr_xunxun_hujia',*/
                        'ssr_xunxun_draw'],
                        trigger: {
                            player: ["changeHp", "enterGame"],
                            global: "gameDrawAfter",
                        },
                        loced: true,
                        forced: true,
                        priority: 15,
                        audio: "xunxun",
                        filter: function(event, player) {
                            return player.hp > player.maxHp - 1;
                        },
                        content: function() {
                            'step 0';
                            event.num = player.hp - player.maxHp + 1;
                            player.hp = player.maxHp - 1;
                            player.update();
                            //player.addMark('ssr_xunxun',event.num);
                            player.changeHujia(event.num, null, true);
                            'step 1';
                            //if(player.countMark('ssr_xunxun')>1) {
                            if (player.hujia > 1) {
                                //player.removeMark('ssr_xunxun');
                                player.changeHujia( - 1, null, true);
                                player.chooseUseTarget('diaobingqianjiang', false, false);
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            'step 2';
                            event.goto(1);
                        },
                        mod: {
                            maxHandcardBase: function(player, num) {
                                if (player.hujia) return num + 1;
                            },
                        },
                        /*mark:true,
		                marktext:"谨",
		                intro:{
		                    name:"恭谨谦卑",
		                    content:"mark",
		                },*/
                    },
                    "ssr_wangxi": {
                        audio: 'wangxi',
                        trigger: {
                            player: "damageEnd",
                            source: "damageSource",
                        },
                        filter: function(event, player) {
                            if (event._notrigger.contains(event.player)) return false;
                            return event.num && event.source && event.player && event.player.isAlive() && event.source.isAlive() && event.source != event.player;
                        },
                        priority: 5,
                        direct: true,
                        check: function(event, player) {
                            if (player.isPhaseUsing()) return true;
                            if (event.player == player) return get.attitude(player, event.source) > -5;
                            return get.attitude(player, event.player) > -5;
                        },
                        logTarget: function(event, player) {
                            if (event.player == player) return event.source;
                            return event.player;
                        },
                        preHidden: true,
                        content: function() {
                            "step 0";
                            event.count = trigger.num;
                            "step 1";
                            event.cards = get.cards(2);
                            //player.chooseControl('ok').set('dialog',['义忘私隙',event.cards]);
                            //game.asyncDraw([trigger.player,trigger.source]);
                            event.him = player == trigger.player ? trigger.source: trigger.player;
                            "step 2";
                            if (trigger.num > 1) {
                                var num = '·' + (trigger.num - event.count + 1) + '/' + trigger.num;
                            } else {
                                var num = '';
                            }
                            var devalue = get.value(event.cards[0], player) * get.value(event.cards[1], player);
                            player.chooseCardButton('义忘私隙' + num, event.cards, 1).set('ai',
                            function(button) {
                                if (player.isPhaseUsing()) return get.value(button.link, player);
                                if (get.attitude(player, event.him) > -5) {
                                    return get.value(button.link, player);
                                } else if (devalue < 0) {
                                    return get.value(button.link, player);
                                } else {
                                    return 0;
                                }
                            }).set('prompt2', get.translation('ssr_wangxi_info'));
                            "step 3";
                            if (result.bool) {
                                player.line([trigger.player, trigger.source], 'green');
                                event.togive = result.links.slice(0);
                                event.cards.remove(result.links[0]);
                                player.gain(event.togive, 'draw');
                                event.him.gain(event.cards, 'draw');
                                game.log(event.him, '和', player, '各获得了一张牌');
                            }
                            event.count--;
                            "step 4";
                            game.delay();
                            "step 5";
                            if (event.count) {
                                //player.chooseBool(get.prompt2('ssr_wangxi',lib.skill.wangxi.logTarget(event.him)))
                                result.bool = true;
                            } else {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                            "step 6";
                            if (result.bool) {
                                player.logSkill('ssr_wangxi', lib.skill.wangxi.logTarget(event.him));
                                event.goto(1);
                            }
                        },
                        ai: {
                            maixie: true,
                            "maixie_hp": true,
                        },
                    },
                    "ssr_jueqing": {
                        trigger: {
                            source: "damageBefore",
                            player: "damageBefore",
                        },
                        loced: true,
                        forced: true,
                        audio: "jueqing",
                        check: function() {
                            return false;
                        },
                        content: function() {
                            trigger.cancel();
                            trigger.player.loseHp(trigger.num);
                        },
                        ai: {
                            jueqing: true,
                        },
                    },
                    "ssr_shangshi": {
                        subSkill: {
                            use: {
                                mark: true,
                                marktext: "逝",
                                intro: {
                                    name: "伤逝",
                                    content: "mark",
                                },
                                sub: true,
                            },
                        },
                        audio: "shangshi",
                        trigger: {
                            global: "loseHpEnd",
                        },
                        filter: function(event, player) {
                            return event.player.isIn();
                        },
                        usable: 4,
                        frequent: true,
                        checkx: function(event, player) {
                            var att1 = get.attitude(player, event.player);
                            var att2 = get.attitude(player, event.source);
                            return att1 > 0 && att2 <= 0;
                        },
                        content: function() {
                            "step 0";
                            if (!player.hasSkill('ssr_shangshi_use')) {
                                player.storage.ssr_shangshi_use = 0;
                                player.addTempSkill('ssr_shangshi_use');
                            }
                            player.addMark('ssr_shangshi_use');
                            trigger.player.chooseToDiscard(trigger.num, 'he', '伤逝：弃置' + get.cnNumber(trigger.num) + '张牌，或令' + get.translation(player.name) + '摸' + get.cnNumber(trigger.num) + '张牌', lib.filter.cardDiscardable).set('ai',
                            function(card) {
                                if (get.attitude(trigger.player, player) < 0) {
                                    return 4 - get.value(card);
                                } else {
                                    return - 1;
                                }
                            }).setHiddenSkill('ssr_shangshi_use');
                            "step 1";
                            if (!result.bool) player.draw(trigger.num);
                        },
                    },
                    "ssr_fangzhu": {
                        audio: 'fangzhu',
                        enable: "phaseUse",
                        usable: 1,
                        filterTarget: function(card, player, target) {
                            return target != player;
                        },
                        content: function() {
                            "step 0";
                            event.cards = get.cards(3);
                            "step 1";
                            if (event.cards.length > 1) {
                                player.chooseCardButton('令' + get.translation(target.name) + '获得其中任意张牌并令其翻面', true, event.cards, [1, event.cards.length]).set('ai',
                                function(button) {
                                    if (get.attitude(player, target) > 0) {
                                        return get.value(button);
                                    } else {
                                        return - get.value(button);
                                    }
                                });
                            }
                            "step 2";
                            event.cards = result.links;
                            target.chooseControl('确定', '取消').set('ai',
                            function() {
                                if ((event.cards.length < 2) && (!target.isTurnedOver()) && (target.hp + target.countCards('hs', {
                                    name: 'tao'
                                }) > 2)) return '确定';
                                return '取消';
                            }).set('prompt', '是否流失一点体力并拒绝被翻面和获得' + get.translation(player.name) + '选择的' + get.cnNumber(event.cards.length) + '张牌？');
                            "step 3";
                            if (result.control == '取消') {
                                target.gain(event.cards, 'draw');
                                player.line(target, 'green');
                                game.log(target, '获得了' + get.cnNumber(event.cards.length) + '张牌');
                                target.turnOver();
                            } else {
                                target.loseHp();
                            }
                        },
                        ai: {
                            order: 3,
                            expose: 0.3,
                            result: {
                                target: function(player, target) {
                                    var val = 0;
                                    if (target.hasSkillTag('noturn')) val += 2;
                                    if (target.classList.contains('turnedover')) {
                                        val += 5 - Math.min(5, target.countCards('h')) * 0.5;
                                    } else {
                                        if (get.attitude(player, target) > 0) {
                                            val += 1.5 - Math.min(5, target.countCards('h')) * 0.1;
                                        } else {
                                            val -= 1 + Math.min(10, target.countCards('h')) * 0.1;
                                        }
                                    }
                                    return val;
                                },
                            },
                            threaten: 1.2,
                        },
                    },
                    "ssr_xingshang": {
                        audio: 'xingshang',
                        derivation: "ssr_jiushi",
                        trigger: {
                            global: "damage",
                        },
                        filter: function(event, player) {
                            if (event.player.hasSkill('ssr_jiushi')) return false;
                            if (event.player.hasSkill('rejiushi')) return false;
                            if (event.player.hasSkill('rejiushi_mark')) return false;
                            return event.player.classList.contains('dead') == false;
                        },
                        direct: true,
                        checkx: function(event, player) {
                            var att1 = get.attitude(player, event.player);
                            return att1 > 0;
                        },
                        preHidden: true,
                        content: function() {
                            "step 0";
                            player.chooseControl('确定', '取消').set('ai',
                            function() {
                                if (get.attitude(player, trigger.player) > 0) return '确定';
                                return '取消';
                            }).set('prompt', '是否发动〖行殇〗，令' + get.translation(trigger.player.name) + '摸一张牌并获得技能〖酒诗〗？');
                            "step 1";
                            if (result.control == '确定') {
                                if (trigger.player.isTurnedOver()) trigger.ssr_jiushi = true;
                                trigger.player.draw();
                                trigger.player.addTempSkill('ssr_jiushi', {
                                    player: ['phaseEnd', 'die']
                                });
                                trigger.player.markSkill('ssr_jiushi');
                            }
                        },
                        ai: {
                            expose: 0.3,
                        },
                    },
                    "ssr_jiushi": {
                        audio: 'rejiushi',
                        group: ["ssr_jiushi_choose", "ssr_jiushi_judge", "ssr_jiushi_turn"],
                        mark: false,
                        marktext: "酒诗",
                        intro: {
                            name: "曲水流觞",
                            content: function(storage, player, skill) {
                                var str = '<li>你拥有技能〖酒诗〗直到你的回合结束。';
                                return str;
                            },
                        },
                        subSkill: {
                            turn: {
                                audio: "rejiushi",
                                trigger: {
                                    player: "damageEnd",
                                },
                                check: function(event, player) {
                                    return player.isTurnedOver();
                                },
                                filter: function(event, player) {
                                    if (event.ssr_jiushi) {
                                        return player.isTurnedOver();
                                    }
                                    return false;
                                },
                                prompt: function(event, player) {
                                    var str = '是否发动【酒诗】，将武将牌翻面并摸一张牌？';
                                    return str;
                                },
                                content: function() {
                                    delete trigger.ssr_jiushi;
                                    player.turnOver();
                                    player.draw();
                                },
                                sub: true,
                            },
                            judge: {
                                trigger: {
                                    player: "damageBegin3",
                                },
                                silent: true,
                                firstDo: true,
                                filter: function(event, player) {
                                    return player.classList.contains('turnedover');
                                },
                                content: function() {
                                    trigger.ssr_jiushi = true;
                                },
                                forced: true,
                                popup: false,
                                sub: true,
                            },
                            choose: {
                                hiddenCard: function(player, name) {
                                    if (name == 'jiu') return ! player.isTurnedOver();
                                    return false;
                                },
                                audio: "rejiushi",
                                enable: "chooseToUse",
                                filter: function(event, player) {
                                    if (player.classList.contains('turnedover')) return false;
                                    return event.filterCard({
                                        name: 'jiu',
                                        isCard: true
                                    },
                                    player, event);
                                },
                                content: function() {
                                    if (_status.event.getParent(2).type == 'dying') {
                                        event.dying = player;
                                        event.type = 'dying';
                                    }
                                    player.turnOver();
                                    player.useCard({
                                        name: 'jiu',
                                        isCard: true
                                    },
                                    player);
                                },
                                ai: {
                                    order: 5,
                                    result: {
                                        player: function(player) {
                                            if (_status.event.parent.name == 'phaseUse') {
                                                if (player.countCards('h', 'jiu') > 0) return 0;
                                                if (player.getEquip('zhuge') && player.countCards('h', 'sha') > 1) return 0;
                                                if (!player.countCards('h', 'sha')) return 0;
                                                var targets = [];
                                                var target;
                                                var players = game.filterPlayer();
                                                for (var i = 0; i < players.length; i++) {
                                                    if (get.attitude(player, players[i]) < 0) {
                                                        if (player.canUse('sha', players[i], true, true)) {
                                                            targets.push(players[i]);
                                                        }
                                                    }
                                                }
                                                if (targets.length) {
                                                    target = targets[0];
                                                } else {
                                                    return 0;
                                                }
                                                var num = get.effect(target, {
                                                    name: 'sha'
                                                },
                                                player, player);
                                                for (var i = 1; i < targets.length; i++) {
                                                    var num2 = get.effect(targets[i], {
                                                        name: 'sha'
                                                    },
                                                    player, player);
                                                    if (num2 > num) {
                                                        target = targets[i];
                                                        num = num2;
                                                    }
                                                }
                                                if (num <= 0) return 0;
                                                var e2 = target.getEquip(2);
                                                if (e2) {
                                                    if (e2.name == 'tengjia') {
                                                        if (!player.countCards('h', {
                                                            name: 'sha',
                                                            nature: 'fire'
                                                        }) && !player.getEquip('zhuque')) return 0;
                                                    }
                                                    if (e2.name == 'renwang') {
                                                        if (!player.countCards('h', {
                                                            name: 'sha',
                                                            color: 'red'
                                                        })) return 0;
                                                    }
                                                    if (e2.name == 'baiyin') return 0;
                                                }
                                                if (player.getEquip('guanshi') && player.countCards('he') > 2) return 1;
                                                return target.countCards('h') > 3 ? 0 : 1;
                                            }
                                            if (player == _status.event.dying || player.isTurnedOver()) return 3;
                                        },
                                    },
                                    effect: {
                                        target: function(card, player, target) {
                                            if (card.name == 'guiyoujie') return [0, 0.5];
                                            if (target.isTurnedOver()) {
                                                if (get.tag(card, 'damage')) {
                                                    if (player.hasSkillTag('jueqing', false, target)) return [1, -2];
                                                    if (target.hp == 1) return;
                                                    return [1, target.countCards('h') / 2];
                                                }
                                            }
                                        },
                                    },
                                },
                                sub: true,
                            },
                        },
                    },
                    "ssr_songwei": {
                        audio: 'songwei',
                        firstDo: true,
                        trigger: {
                            global: "phaseBefore",
                        },
                        forced: true,
                        zhuSkill: true,
                        unique: true,
                        skillAnimation: "epic",
                        animationColor: "thunder",
                        filter: function(event, player) {
                            return ! player.storage.ssr_songwei && player.hasZhuSkill('ssr_songwei');
                        },
                        content: function() {
                            "step 0";
                            player.storage.ssr_songwei = true;
                            event.fans = game.filterPlayer(function(current) {
                                return current.identity == 'fan';
                            });
                            event.weis = game.filterPlayer(function(current) {
                                return current.group == 'wei';
                            });
                            "step 1";
                            for (var i = 0; i < event.fans.length; i++) {
                                event.fans[i].setIdentity('反');
                                event.fans[i].node.identity.dataset.color = 'fan';
                                event.fans[i].identityShown = true;
                            }
                            for (var i = 0; i < event.weis.length; i++) {
                                event.weis[i].draw();
                            }
                        },
                    },
                    "ssr_jieliang": {
                        subSkill: {
                            cards: {
                                group: ['ssr_jieliang_break', 'ssr_jieliang_dam'],
                                init: function(player) {
                                    if (!player.storage.ssr_jieliang_cards) player.storage.ssr_jieliang_cards = [];
                                },
                                audio: 'olduanliang',
                                trigger: {
                                    player: "gainBefore",
                                },
                                charlotte: true,
                                locked: true,
                                forced: true,
                                filter: function(event, player) {
                                    if (player.ssr_jieliang_gaining) return false;
                                    return event.cards && event.cards.length > 0 && player.countMark('ssr_jieliang_break') > 0;
                                },
                                content: function() {
                                    "step 0";
                                    player.judge(function(card) {
                                        if (get.suit(card) != 'club') return - 2;
                                        return 1;
                                    }).judge2 = function(result) {
                                        return result.bool;
                                    };
                                    "step 1";
                                    if (!result.bool) {
                                        trigger.cancel();
                                    } else {
                                        {
                                            if (event && event.finish) {
                                                event.finish();
                                            } else {
                                                return;
                                            }
                                        }
                                    }
                                    "step 2";
                                    var him = (trigger.source && trigger.source.isIn()) ? trigger.source: player;
                                    player.storage.ssr_jieliang_cards = player.storage.ssr_jieliang_cards.concat(trigger.cards);
                                    player.markSkill('ssr_jieliang_cards');
                                    player.syncStorage('ssr_jieliang_cards');
                                    him.$give(trigger.cards, player, false);
                                    him.lose(trigger.cards, ui.special, 'toStorage');
                                },
                                mark: false,
                                marktext: "粮",
                                intro: {
                                    name: "粮草被截",
                                    content: "cards",
                                    onunmark: function(storage, player) {
                                        if (storage && storage.length) {
                                            player.$throw(storage, 1000);
                                            game.cardsDiscard(storage);
                                            game.log(storage, '被置入了弃牌堆');
                                            storage.length = 0;
                                        }
                                    },
                                },
                                sub: true,
                            },
                            break: {
                                trigger: {
                                    player: "phaseEnd",
                                },
                                priority: -3,
                                forced: true,
                                filter: function(event, player) {
                                    return true;
                                },
                                content: function() {
                                    "step 0";
                                    if (player.countMark('ssr_jieliang_break') > 0) {
                                        player.removeMark('ssr_jieliang_break');
                                    } else {
                                        player.gain(player.storage.ssr_jieliang_cards, 'gain2', 'fromStorage');
                                        player.unmarkAuto('ssr_jieliang_cards', player.storage.ssr_jieliang_cards);
                                        player.removeSkill('ssr_jieliang_cards');
                                    }
                                },
                                //mark:true,
                                marktext: "截",
                                intro: {
                                    name: "兵粮寸断",
                                    content: "mark",
                                },
                                sub: true,
                            },
                            dam: {
                                audio: "duanliang1",
                                trigger: {
                                    player: ["damageBegin4"],
                                },
                                priority: -44,
                                direct: true,
                                filter: function(event, player) {
                                    return (player.storage.ssr_jieliang_cards && player.storage.ssr_jieliang_cards.length > 0 && event.num > 0 && event.source != undefined);
                                },
                                content: function() {
                                    "step 0";
                                    //trigger.source.chooseCardButton('截粮：是否获得'+get.translation(player.name)+'的至多'+get.cnNumber(trigger.num)+'张“粮”？',player.storage.ssr_jieliang_cards,[1,trigger.num]).set('ai',function(button){
                                    trigger.source.chooseCardButton('截粮：是否获得' + get.translation(player.name) + '的一张“粮”？', player.storage.ssr_jieliang_cards, 1).set('ai',
                                    function(button) {
                                        if (get.attitude(trigger.source, player) > 0 && (player.hp > 1 || player.countMark('ssr_jieliang_break') < 2)) {
                                            return - 1;
                                        } else return get.value(button);
                                    });
                                    "step 1";
                                    if (result.bool) {
                                        for (var i = 0; i < result.links.length; i++) {
                                            player.storage.ssr_jieliang_cards.remove(result.links[i]);
                                        }
                                        trigger.source.gain(result.links, 'draw');
                                        player.line(trigger.source, 'green');
                                        game.log(trigger.source, '获得了' + get.cnNumber(result.links.length) + '张牌');
                                        player.logSkill(event.name);
                                    } else {
                                        {
                                            if (event && event.finish) {
                                                event.finish();
                                            } else {
                                                return;
                                            }
                                        }
                                    }
                                    "step 2";
                                    if (player.storage.ssr_jieliang_cards.length > 0) {
                                        player.markSkill('ssr_jieliang_cards');
                                        player.syncStorage('ssr_jieliang_cards');
                                    } else {
                                        player.unmarkSkill('ssr_jieliang_cards'); {
                                            if (event && event.finish) {
                                                event.finish();
                                            } else {
                                                return;
                                            }
                                        }
                                    }
                                    //让本人也能摸到牌
                                    "step 3";
                                    //trigger.source.chooseCardButton('截粮：是否获得'+get.translation(player.name)+'的至多'+get.cnNumber(trigger.num)+'张“粮”？',player.storage.ssr_jieliang_cards,[1,trigger.num]).set('ai',function(button){
                                    player.chooseCardButton('截粮：是否取回一张“粮”？', player.storage.ssr_jieliang_cards, 1).set('ai',
                                    function(button) {
                                        return get.value(button);
                                    });
                                    "step 4";
                                    if (result.bool) {
                                        player.ssr_jieliang_gaining = true;
                                        for (var i = 0; i < result.links.length; i++) {
                                            player.storage.ssr_jieliang_cards.remove(result.links[i]);
                                        }
                                        player.gain(result.links, 'draw');
                                        player.line(trigger.source, 'green');
                                        game.log(player, '获得了' + get.cnNumber(result.links.length) + '张牌');
                                        player.logSkill(event.name);
                                    }
                                    "step 5";
                                    player.ssr_jieliang_gaining = false;
                                    if (player.storage.ssr_jieliang_cards.length > 0) {
                                        player.markSkill('ssr_jieliang_cards');
                                        player.syncStorage('ssr_jieliang_cards');
                                    } else {
                                        player.unmarkSkill('ssr_jieliang_cards');
                                    }
                                },
                                sub: true,
                            },
                        },
                        enable: "phaseUse",
                        filterCard: function(card) {
                            return get.color(card) == 'black' && get.type(card) != 'trick' && get.type(card) != 'delay';
                        },
                        selectCard: 1,
                        filter: function(event, player) {
                            return player.countCards('he', {
                                color: 'black'
                            }) - player.countCards('he', {
                                color: 'black',
                                type: 'trick'
                            }) - player.countCards('he', {
                                color: 'black',
                                type: 'delay'
                            }) > 0;
                        },
                        usable: 2,
                        audio: 'olduanliang',
                        position: "he",
                        filterTarget: function(card, player, target) {
                            if (player == target) return false;
                            //if(target.countMark('ssr_jieliang_break')>1) return false;
                            //if(target.hasSkill('ssr_zhenjun_break')) return false;
                            return true;
                        },
                        content: function() {
                            "step 0";
                            if (!target.hasSkill('ssr_jieliang_cards')) {
                                target.addSkill('ssr_jieliang_cards');
                            }
                            target.addMark('ssr_jieliang_break');
                        },
                        check: function(card) {
                            return 7 - get.value(card);
                        },
                        ai: {
                            order: 3,
                            player: -0.5,
                            result: {
                                target: function(player, target) {
                                    //if(player.countCards('he',{color:'black'})-player.countCards('he',{color:'black',type:'trick'})-player.countCards('he',{color:'black',type:'delay'})<2) return 0;
                                    return Math.min( - target.countCards('he') - target.maxHp + target.hp - Math.max(10 - target.countMark('ssr_jieliang_break'), 0) * 0.5, -1);
                                },
                            },
                            threaten: 1.3,
                        },
                    },
                    "ssr_zhiyan": {
                        audio: 'oljiezi',
                        preHidden: true,
                        trigger: {
                            player: "damageEnd",
                        },
                        filter: function(event, player) {
                            return true;
                        },
                        frequent: true,
                        priority: -17,
                        content: function() {
                            "step 0";
                            event.num = 0;
                            if (player.countCards('h') < player.maxHp) event.num++;
                            if (player.countCards('e') < player.hp) event.num++;
                            if (event.num < 1) {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            };
                            event.cards = [];
                            "step 1";
                            event.card = get.cardPile(function(card) {
                                if (get.type(card) == 'trick') return false;
                                if (get.type(card) == 'delay') return false;
                                if (get.color(card) != 'black') return false;
                                if (event.cards.contains(card)) return false;
                                return true;
                            });
                            if (!event.card) {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                                return;
                            } else {
                                player.showCards([event.card]);
                                event.cards.push(event.card);
                            }
                            "step 2";
                            event.num--;
                            //player.gain(event.card,'gain2');
                            "step 3";
                            if (event.num > 0) {
                                event.goto(1);
                            } else {
                                player.gain(event.cards, 'gain2');
                            }
                            /*if(player.countCards('h')>player.maxHp) {
					            player.chooseToDiscard(1,'he',true);
					        }*/
                        },
                        ai: {
                            maixie: true,
                            "maixie_hp": true,
                            effect: {
                                target: function(card, player, target) {
                                    if (player.hasSkillTag('jueqing', false, target)) return [1, -1];
                                    if (get.tag(card, 'damage')) return [1, 0.5];
                                },
                            },
                        },
                    },
                    "ssr_newyinghun": {
                        subSkill: {
                            sha: {
                                audio: 'polu',
                                trigger: {
                                    source: "damageSource",
                                },
                                forced: true,
                                filter: function(event, player) {
                                    return event.num > 0;
                                },
                                priority: -45,
                                content: function() {
                                    player.addMark('ssr_newyinghun');
                                },
                                mod: {
                                    //targetInRange:function(card,player,target,now){
                                    //    if(card.name=='sha') return true;
                                    //},
                                    //selectTarget:function(card,player,range){
                                    //    if(card.name=='sha'&&range[1]!=-1) range[1]++;
                                    //},
                                    //cardUsable:function(card,player,num){
                                    //    if(card.name=='sha') return num+1;
                                    //},
                                    //cardUsable:function(card,player,num){
                                    //    if(card.name=='sha'||lib.card[card.name].type=='basic') {
                                    //        return Infinity;
                                    //    }
                                    //},
                                    attackRange: function(player, distance) {
                                        return distance + Infinity;
                                    },
                                    cardname: function(card) {
                                        if (lib.card[card.name].type == 'basic') return 'sha';
                                        if (['trick', 'delay'].contains(lib.card[card.name].type)) return 'juedou';
                                        //if(lib.card[card.name].type=='equip'&&lib.card[card.name].subtype!='equip1') return 'juedou';
                                    },
                                },
                                sub: true,
                            },
                        },
                        trigger: {
                            player: "phaseUseBefore",
                        },
                        priority: -45,
                        usable: 1,
                        forced: true,
                        audio: "yinghun",
                        content: function() {
                            "step 0";
                            player.addTempSkill('ssr_newyinghun_sha');
                            player.addMark('ssr_newyinghun');
                            "step 1";
                            player.phaseUse();
                            "step 2";
                            player.removeSkill('ssr_newyinghun_sha');
                            "step 3";
                            event.num = player.countMark('ssr_newyinghun');
                            player.chooseTarget(get.prompt2('gzyinghun'),
                            function(card, player, target) {
                                return true;
                            }).set('ai',
                            function(target) {
                                var player = _status.event.player;
                                if (player.getDamagedHp() == 1 && target.countCards('he') == 0) {
                                    return 0;
                                }
                                if (get.attitude(_status.event.player, target) > 0) {
                                    return 10 + get.attitude(_status.event.player, target);
                                }
                                if (player.getDamagedHp() == 1) {
                                    return - 1;
                                }
                                return 1;
                            }).setHiddenSkill(event.name);
                            "step 4";
                            if (result.bool) {
                                player.logSkill(event.name, result.targets);
                                event.target = result.targets[0];
                                if (event.num == 1) {
                                    event.directcontrol = true;
                                } else {
                                    var str1 = '摸' + get.cnNumber(event.num, true) + '弃一';
                                    var str2 = '摸一弃' + get.cnNumber(event.num, true);
                                    player.chooseControl(str1, str2,
                                    function(event, player) {
                                        return _status.event.choice;
                                    }).set('choice', get.attitude(player, event.target) > 0 ? str1: str2);
                                    event.str = str1;
                                }
                            } else {
                                event.goto(6);
                            }
                            "step 5";
                            if (event.directcontrol || result.control == event.str) {
                                event.target.draw(event.num);
                                event.target.chooseToDiscard(true, 'he');
                            } else {
                                event.target.draw();
                                event.target.chooseToDiscard(event.num, true, 'he');
                            }
                            "step 6";
                            player.removeMark('ssr_newyinghun', event.num);
                        },
                        marktext: "疆",
                        intro: {
                            name: "大吴疆土",
                            content: "mark",
                        },
                        ai: {
                            threaten: 1.7,
                        },
                    },
                    "ssr_xinyinghun": {
                        audio: "gzyinghun",
                        trigger: {
                            player: "phaseDrawBegin2",
                        },
                        forced: true,
                        priority: 3,
                        preHidden: true,
                        filter: function(event, player) {
                            return ! event.numFixed;
                        },
                        content: function() {
                            trigger.num++;
                        },
                        ai: {
                            threaten: 1.3,
                        },
                        mod: {
                            maxHandcardBase: function(player, num) {
                                return num + game.countPlayer(function(current) {
                                    return current.hasSkill('ssr_futu_win');
                                });
                            },
                        },
                    },
                    "ssr_newpolu": {
                        skillAnimation: true,
                        animationColor: 'wood',
                        audio: 'jsrgjuelie',
                        juexingji: true,
                        derivation: ['ssr_xinyinghun', 'ssr_newzhiba'],
                        unique: true,
                        trigger: {
                            player: 'phaseZhunbeiBegin'
                        },
                        filter: function(event, player) {
                            return ! game.hasPlayer(function(current) {
                                return current != player && !current.hasSkill('ssr_futu_win');
                            }) && !player.storage.ssr_newpolu;
                        },
                        forced: true,
                        priority: 3,
                        content: function() {
                            player.loseMaxHp();
                            player.changeHujia(1, null, true);
                            player.addSkill('ssr_xinyinghun');
                            player.addSkill('ssr_newzhiba');
                            game.log(player, '获得了技能', '#g【英魂】和【制霸】');
                            player.awakenSkill(event.name);
                            player.storage[event.name] = true;
                        },
                    },
                    "ssr_futu": {
                        subSkill: {
                            win: {
                                charlotte: true,
                                mark: true,
                                marktext: '归疆',
                                intro: {
                                    name: "大吴霸业",
                                    content: function(storage, player, skill) {
                                        return "<li>场上存在" + game.countPlayer(function(current) {
                                            return current.hasSkill('ssr_futu_win');
                                        }) + "枚“归疆”标记";
                                    },
                                },
                                sub: true,
                            },
                            lose: {
                                locked: true,
                                trigger: {
                                    //player:"compare",
                                    target: "compare",
                                },
                                filter: function(event, player) {
                                    return ! player.hasSkill('ssr_futu') && !player.hasSkill('ssr_futu_win') && !event.iwhile && game.countPlayer(function(current) {
                                        return current.hasSkill('ssr_futu_win');
                                    }) > 0;
                                    //return ((player==event.target&&event.player.hasSkill('ssr_futu'))||(player==event.player&&event.target.hasSkill('ssr_futu')))&&!event.iwhile;
                                },
                                forced: true,
                                preHidden: true,
                                priority: -5,
                                content: function() {
                                    'step 0';
                                    var num = game.countPlayer(function(current) {
                                        return current.hasSkill('ssr_futu_win');
                                    });
                                    game.log(player, '的拼点牌点数〈-' + num + '〉');
                                    if (player == trigger.player) {
                                        trigger.num1 -= num;
                                        if (trigger.num1 < 1) trigger.num1 = 1;
                                        var news = game.createCard({
                                            name: trigger.card1.name,
                                            suit: get.suit(trigger.card1),
                                            number: trigger.num1
                                        });
                                        game.log(player, '拼点牌', trigger.card1, '改为了', news);
                                        trigger.card1.num = trigger.num1;
                                    } else {
                                        trigger.num2 -= num;
                                        if (trigger.num2 < 1) trigger.num2 = 1;
                                        var news = game.createCard({
                                            name: trigger.card2.name,
                                            suit: get.suit(trigger.card2),
                                            number: trigger.num2
                                        });
                                        game.log(player, '拼点牌', trigger.card2, '改为了', news);
                                        trigger.card2.num = trigger.num2;
                                    }
                                },
                                sub: true,
                            },
                            draw: {
                                shaRelated: true,
                                audio: 'wulie',
                                preHidden: true,
                                trigger: {
                                    player: "useCardToPlayered",
                                    target: "useCardToTargeted",
                                },
                                filter: function(event, player) {
                                    if (event.card.name != 'sha') return false;
                                    return (player == event.target && event.player.hasSkill('ssr_futu_win')) || (event.getParent().triggeredTargets3.length == 1 && event.target.hasSkill('ssr_futu_win'));
                                },
                                priority: 25,
                                forced: true,
                                content: function() {
                                    player.draw();
                                },
                                ai: {
                                    effect: {
                                        target: function(card, player, target) {
                                            if (card.name == 'sha' && target.hasSkill('ssr_futu_win')) return [1, 0.6];
                                        },
                                        player: function(card, player, target) {
                                            if (card.name == 'sha' && target.hasSkill('ssr_futu_win')) return [1, 1];
                                        },
                                    },
                                },
                                sub: true,
                            },
                        },
                        //group:'ssr_futu_draw',
                        global: 'ssr_futu_lose',
                        audio: 'wulie',
                        enable: "phaseUse",
                        usable: 2,
                        filterTarget: function(card, player, target) {
                            return player.canCompare(target);
                        },
                        filter: function(event, player) {
                            return player.countCards('h') > 0 && game.hasPlayer(function(target) {
                                return player.canCompare(target);
                            });
                        },
                        content: function() {
                            "step 0";
                            player.chooseToCompare(target);
                            "step 1";
                            if (result.bool) {
                                //game.asyncDraw([player,target]);
                                //target.addSkill('ssr_futu_win');
                                if (target.hasSkill('ssr_futu_win')) {
                                    event.goto(3);
                                } else {
                                    player.chooseControl('授予标记', '对其出杀',
                                    function() {
                                        if (!player.isZhu && get.attitude(player, target) < 0) return '对其出杀';
                                        return '授予标记';
                                    }).set('prompt', '选择令' + get.translation(target.name) + '获得“归疆”标记并摸牌或视为对其使用无距离次数限制的杀');
                                }
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            "step 2";
                            if (result.control == '授予标记') {
                                target.addSkill('ssr_futu_win');
                                game.asyncDraw([player, target]);
                            } else {
                                player.useCard({
                                    name: 'sha'
                                },
                                target, false);
                            } {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                            "step 3";
                            if (result.bool) {
                                var list = [];
                                if (get.position(result.player) == 'd') list.push(result.player);
                                if (get.position(result.target) == 'd') list.push(result.target);
                                if (!list.length) {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                } else {
                                    event.list = list;
                                }
                            } else {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            };
                            "step 4";
                            if (result.bool) player.gain(event.list, 'gain2');
                        },
                        /*mod:{
			                globalFrom:function(from,to,distance){
				                if(to.hasSkill('ssr_futu_win')) return distance-2;
			                },
			                maxHandcardBase:function(player,num){
				                return num+game.countPlayer(function(current){
				                    return current.hasSkill('ssr_futu_win');
				                });
			                },
		                },*/
                        ai: {
                            order: function(name, player) {
                                return 9;
                            },
                            result: {
                                player: function(player) {
                                    if (player.countCards('h',
                                    function(card) {
                                        return get.number(card) + game.countPlayer(function(current) {
                                            return current.hasSkill('ssr_futu_win');
                                        }) > 6;
                                    }) > 0) return 2;
                                    return - 1;
                                },
                                target: function(player, target) {
                                    var hs = player.getCards('h').sort(function(a, b) {
                                        return b.number - a.number;
                                    });
                                    var ts = target.getCards('h').sort(function(a, b) {
                                        return b.number - a.number;
                                    });
                                    if (!hs.length || !ts.length) return 0;
                                    if (target.hasSkill('ssr_futu_win')) {
                                        if (player.isZhu && game.countPlayer(function(current) {
                                            return current != player && !current.hasSkill('ssr_futu_win');
                                        }) > 0) return 0;
                                        if (hs[0].number > ts[0].number) return - 2;
                                        return - 1.5;
                                    }
                                    if (hs[0].number + game.countPlayer(function(current) {
                                        return current.hasSkill('ssr_futu_win');
                                    }) > ts[0].number) return get.attitude(player, target) > 0 ? 1.5 : 1;
                                    return - 0.5;
                                }
                            },
                        },
                    },
                    "ssr_yinghun_audio": game.zuanSetSSRAudio('yinghun_ol_sunjian', 2),
                    "ssr_yinghun": {
                        audio: "yinghun_ol_sunjian",
                        trigger: {
                            player: "phaseZhunbeiBegin",
                        },
                        filter: function(event, player) {
                            return true;
                        },
                        priority: 3,
                        direct: true,
                        preHidden: true,
                        content: function() {
                            "step 0";
                            if (get.isLuckyStar(player)) {
                                event.num = 6;
                                player.throwDice(6);
                            } else player.throwDice();
                            "step 1";
                            event.num1 = event.num;
                            "step 2";
                            if (get.isLuckyStar(player)) {
                                event.num = 1;
                                player.throwDice(1);
                            } else player.throwDice();
                            "step 3";
                            event.num2 = event.num;
                            "step 4";
                            event.dis = Math.abs(event.num1 - event.num2);
                            event.min = Math.min(event.num1, event.num2);
                            player.chooseTarget(get.prompt2('ssr_yinghun'), '是否选择一名角色发动〖英魂〗？（🎲' + event.num1 + '：🎲' + event.num2 + '）',
                            function(card, player, target) {
                                return true;
                                //return player!=target;
                            }).set('ai',
                            function(target) {
                                var player = _status.event.player;
                                if (get.attitude(player, target) > 0) {
                                    if (event.dis == 0 && target.countCards('he') == 0) {
                                        return 1;
                                    }
                                    return 2 + get.attitude(player, target) + target.getDamagedHp() + event.min * 0.5;
                                } else if (get.attitude(player, target) < 0) {
                                    if (event.dis == 0) {
                                        return - 1;
                                    }
                                    return 3 - get.attitude(player, target);
                                } else return - 1;
                            }).setHiddenSkill(event.name);
                            "step 5";
                            if (result.bool) {
                                //event.num=player.getDamagedHp();
                                player.logSkill(event.name, result.targets);
                                event.target = result.targets[0];
                                if (event.dis == 0) {
                                    event.directcontrol = true;
                                } else {
                                    var str1 = '🎲摸' + get.cnNumber(event.num1, true) + '弃' + get.cnNumber(event.num2, true);
                                    var str2 = '🎲摸' + get.cnNumber(event.num2, true) + '弃' + get.cnNumber(event.num1, true);
                                    if (event.num1 > event.num2) {
                                        var dra = str1;
                                        var dis = str2;
                                    } else {
                                        var dra = str2;
                                        var dis = str1;
                                    }
                                    player.chooseControl(str1, str2,
                                    function(event, player) {
                                        return _status.event.choice;
                                    }).set('choice', get.attitude(player, event.target) > 0 ? dra: dis).set('prompt', '请选择对' + get.translation(event.target.name) + '执行的摸牌弃牌效果');
                                    event.str = str1;
                                }
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            "step 6";
                            if (event.directcontrol || result.control == event.str) {
                                event.target.draw(event.num1);
                                event.target.chooseToDiscard(event.num2, true, 'he');
                            } else {
                                event.target.draw(event.num2);
                                event.target.chooseToDiscard(event.num1, true, 'he');
                            }
                        },
                        ai: {
                            expose: 0.2,
                            threaten: function(player, target) {
                                return 1.4;
                            },
                            maixie: true,
                        },
                    },
                    "ssr_polu": {
                        audio: 'repolu',
                        shaRelated: true,
                        trigger: {
                            player: "useCardToPlayered",
                        },
                        check: function(event, player) {
                            return get.attitude(player, event.target) <= 0;
                        },
                        filter: function(event, player) {
                            return event.card.name == 'sha';
                        },
                        forced: true,
                        priority: 11,
                        logTarget: "target",
                        preHidden: true,
                        content: function() {
                            "step 0";
                            if (get.isLuckyStar(player)) {
                                event.num = 6;
                                player.throwDice(6);
                            } else player.throwDice();
                            "step 1";
                            if (!event.num) event.num = 0;
                            var cards = trigger.target.getCards('he');
                            var dis = [];
                            for (var j = 0; j < cards.length; j++) {
                                if (get.number(cards[j]) == event.num) dis.push(cards[j]);
                            }
                            if (dis.length > 0) {
                                trigger.target.discard(dis);
                                trigger.getParent().directHit.add(trigger.target);
                            }
                        },
                        ai: {
                            "directHit_ai": true,
                        },
                    },
                    "ssr_kuangbao": {
                        subSkill: {
                            forbid: {
                                sub: true,
                            },
                        },
                        audio: "baonu",
                        marktext: "暴",
                        trigger: {
                            source: "damageSource",
                            player: ["damageEnd"],
                            //player:"useCardToPlayered",
                            //target:"useCardToTargeted",
                        },
                        priority: -2,
                        unique: true,
                        forced: true,
                        filter: function(event, player) {
                            if (player.countMark('ssr_kuangbao') > 5) return false;
                            if (event.card) {
                                var card = player.storage.ssr_kuangbao_card;
                                var num = player.storage.ssr_kuangbao_num;
                                if (event.card == card) {
                                    if (event.num <= num) return false;
                                }
                            }
                            //if(event.name!='damage') return true;
                            return event.num > 0 && !player.hasSkill('ssr_kuangbao_forbid');
                            //if(!(event.card.name=='juedou'||event.card.name=='sha')) return false;
                            //return player==event.target||event.getParent().triggeredTargets3.length==1;
                        },
                        init: function(player, skill) {
                            player.storage.ssr_kuangbao_card = 'none';
                            player.storage.ssr_kuangbao_num = 0;
                            if (!player.storage.ssr_kuangbao && player.countMark('ssr_kuangbao') <= 0) {
                                player.addMark('ssr_kuangbao', 2);
                                player.markSkill('ssr_kuangbao');
                            }
                            if (player.countMark('ssr_kuangbao') > 0) player.markSkill('ssr_kuangbao');
                        },
                        content: function() {
                            'step 0';
                            var num = trigger.num;
                            if (trigger.card) {
                                if (trigger.card == player.storage.ssr_kuangbao_card) num -= player.storage.ssr_kuangbao_num;
                                player.storage.ssr_kuangbao_card = trigger.card;
                                player.storage.ssr_kuangbao_num = trigger.num;
                            }
                            event.add = num;
                            'step 1';
                            /*if(trigger.name=='damage') {
					            player.addTempSkill('ssr_kuangbao_forbid');
					            player.addMark('ssr_kuangbao');
					        }else player.addMark('ssr_kuangbao',2);*/
                            player.addMark('ssr_kuangbao', Math.min(event.add, 6 - player.countMark('ssr_kuangbao')));
                        },
                        intro: {
                            name: "暴怒",
                            content: "mark",
                        },
                        ai: {
                            combo: "ssr_shenfen",
                            maixie: true,
                            "maixie_hp": true,
                        },
                    },
                    "ssr_shenfen": {
                        derivation: ["ssr_zhanshen_lianyu", "ssr_zhanshen_xiuluo", "ssr_zhanshen_mengyan", "ssr_zhanshen_xieshen", "ssr_newshenwei"],
                        skillAnimation: true,
                        animationColor: "grey",
                        audio: "ol_shenfen",
                        trigger: {
                            source: "damageSource",
                            player: ["damageEnd", "enterGame"],
                            global: "gameDrawAfter",
                            //player:"useCardToPlayered",
                            //target:"useCardToTargeted",
                        },
                        forced: true,
                        priority: -3,
                        unique: true,
                        juexingji: true,
                        filter: function(event, player) {
                            //var num=game.players.length;
                            return player.countMark('ssr_kuangbao') >= 6 && !player.storage.ssr_shenfen;
                        },
                        check: function(event, player) {
                            return true;
                        },
                        content: function() {
                            "step 0";
                            player.setBackground('shen_lvbu', 'character');
                            player.flashAvatar('ssr_shenfen', 'shen_lvbu');
                            var num = game.players.length;
                            //player.removeMark('ssr_zhanshen',num);
                            var equiplist = ['lianyu', 'xiuluo', 'mengyan', 'xieshen'];
                            var suitlist = ['spade', 'club', 'heart', 'diamond'];
                            for (var i = 0; i < equiplist.length; i++) {
                                var name = 'ssr_zhanshen_' + equiplist[i] + '_card';
                                player.equip(game.createCard({
                                    name: name,
                                    suit: suitlist[i],
                                    number: 13
                                }));
                            }
                            player.addSkill("ssr_newshenwei");
                            game.log(player, '获得了技能', '#g〖神威〗');
                            player.awakenSkill('ssr_shenfen');
                            player.storage.ssr_shenfen = true;
                        },
                        ai: {
                            order: 15,
                            result: {
                                player: function(player) {
                                    return 5;
                                },
                            },
                            threaten: 3.5,
                        },
                        init: function(player, skill) {
                            player.storage.ssr_shenfen = false;

                            //====================炼狱斩戟===================
                            var blockname = 'lianyu';
                            var name = 'ssr_zhanshen_' + blockname + '_card';
                            lib.card[name] = {
                                skills: ['ssr_zhanshen_' + blockname],
                                fullskin: true,
                                type: "equip",
                                image: 'ext:祖安武将/card/zhanshen_' + blockname + '.png',
                                color: 'black',
                                suit: 'spade',
                                number: 13,
                                opacity: 1,
                                textShadow: 'black 0 0 2px',
                                subtype: "equip1",
                                enable: true,
                                selectTarget: -1,
                                filterTarget: function(card, player, target) {
                                    return target == player;
                                },
                                distance: {
                                    attackFrom: -3,
                                },
                                modTarget: true,
                                allowMultiple: false,
                                content: function() {
                                    if (cards.length && get.position(cards[0], true) == 'o') target.equip(cards[0]);
                                },
                                toself: true,
                                ai: {
                                    equipValue: 9,
                                    basic: {
                                        order: 15,
                                        useful: 15,
                                        equipValue: 10,
                                        value: 10,
                                    },
                                    result: {
                                        target: function(player, target, card) {
                                            return get.equipResult(player, target, card.name);
                                        },
                                    },
                                },
                            };
                            lib.translate[name] = "炼狱斩戟";
                            lib.translate[name + '_info'] = "锁定技，你的【杀】时可以为此额外指定两个目标，且你的【杀】无视目标的防具。";

                            //====================修罗重铠===================
                            var blockname = 'xiuluo';
                            var name = 'ssr_zhanshen_' + blockname + '_card';
                            lib.card[name] = {
                                skills: ['ssr_zhanshen_' + blockname],
                                fullskin: true,
                                type: "equip",
                                image: 'ext:祖安武将/card/zhanshen_' + blockname + '.png',
                                color: 'black',
                                suit: 'club',
                                number: 13,
                                opacity: 1,
                                textShadow: 'black 0 0 2px',
                                subtype: "equip2",
                                enable: true,
                                selectTarget: -1,
                                filterTarget: function(card, player, target) {
                                    return target == player;
                                },
                                modTarget: true,
                                allowMultiple: false,
                                content: function() {
                                    if (cards.length && get.position(cards[0], true) == 'o') target.equip(cards[0]);
                                },
                                toself: true,
                                ai: {
                                    equipValue: 9,
                                    basic: {
                                        order: 15,
                                        useful: 15,
                                        equipValue: 10,
                                        value: 10,
                                    },
                                    result: {
                                        target: function(player, target, card) {
                                            return get.equipResult(player, target, card.name);
                                        },
                                    },
                                },
                            };
                            lib.translate[name] = "修罗重铠";
                            lib.translate[name + '_info'] = "锁定技，你最多只能受到一点伤害，你在回合外受到伤害后立即结束当前角色的出牌阶段。";

                            //====================梦魇赤兔===================
                            var blockname = 'mengyan';
                            var name = 'ssr_zhanshen_' + blockname + '_card';
                            lib.card[name] = {
                                skills: ['ssr_zhanshen_' + blockname],
                                fullskin: true,
                                type: "equip",
                                image: 'ext:祖安武将/card/zhanshen_' + blockname + '.png',
                                color: 'red',
                                suit: 'heart',
                                number: 13,
                                opacity: 1,
                                textShadow: 'black 0 0 2px',
                                subtype: "equip6",
                                enable: true,
                                selectTarget: -1,
                                filterTarget: function(card, player, target) {
                                    return target == player;
                                },
                                distance: {
                                    globalFrom: -2,
                                },
                                /*onEquip:function(){
	                                if(!player.isDisabled(3)) player.disableEquip(3);
	                            },
	                            onLose:function(){
	                                if(player.isDisabled(3)) player.enableEquip(3);
	                            },*/
                                modTarget: true,
                                allowMultiple: false,
                                content: function() {
                                    if (cards.length && get.position(cards[0], true) == 'o') target.equip(cards[0]);
                                },
                                toself: true,
                                ai: {
                                    equipValue: 9,
                                    basic: {
                                        order: 15,
                                        useful: 15,
                                        equipValue: 10,
                                        value: 10,
                                    },
                                    result: {
                                        target: function(player, target, card) {
                                            return get.equipResult(player, target, card.name);
                                        },
                                    },
                                },
                            };
                            lib.translate[name] = "梦魇赤兔";
                            lib.translate[name + '_info'] = "锁定技，你与其他角色计算距离减二，你造成的伤害均视为火属性且防止即将受到的火属性伤害。";

                            //====================邪神面具===================
                            var blockname = 'xieshen';
                            var name = 'ssr_zhanshen_' + blockname + '_card';
                            lib.card[name] = {
                                skills: ['ssr_zhanshen_' + blockname],
                                fullskin: true,
                                type: "equip",
                                image: 'ext:祖安武将/card/zhanshen_' + blockname + '.png',
                                color: 'red',
                                suit: 'diamond',
                                number: 13,
                                opacity: 1,
                                textShadow: 'black 0 0 2px',
                                subtype: "equip5",
                                enable: true,
                                selectTarget: -1,
                                filterTarget: function(card, player, target) {
                                    return target == player;
                                },
                                onEquip: function() {
                                    player.link(false);
                                    player.turnOver(false);
                                    //player.disableJudge();
                                },
                                /*onLose:function(){
	                                player.enableJudge();
	                            },*/
                                modTarget: true,
                                allowMultiple: false,
                                content: function() {
                                    if (cards.length && get.position(cards[0], true) == 'o') target.equip(cards[0]);
                                },
                                toself: true,
                                ai: {
                                    equipValue: 9,
                                    basic: {
                                        order: 15,
                                        useful: 15,
                                        equipValue: 10,
                                        value: 10,
                                    },
                                    result: {
                                        target: function(player, target, card) {
                                            return get.equipResult(player, target, card.name);
                                        },
                                    },
                                },
                            };
                            lib.translate[name] = "邪神面具";
                            lib.translate[name + '_info'] = "锁定技，你的武将牌始终正面朝上，你不能被横置，且不能成为延时锦囊牌和拼点的目标。";
                        },
                    },
                    "ssr_zhanshen_lianyu": {
                        equipSkill: true,
                        trigger: {
                            player: "useCard1",
                        },
                        group: 'ssr_pojia',
                        forced: true,
                        firstDo: true,
                        filter: function(event, player) {
                            if (event.card.name != 'sha' || get.mode() == 'guozhan') return false;
                            var card = event.card;
                            var range;
                            var select = get.copy(get.info(card).selectTarget);
                            if (select == undefined) {
                                if (get.info(card).filterTarget == undefined) return false;
                                range = [1, 1];
                            } else if (typeof select == 'number') range = [select, select];
                            else if (get.itemtype(select) == 'select') range = select;
                            else if (typeof select == 'function') range = select(card, player);
                            game.checkMod(card, player, range, 'selectTarget', player);
                            return range[1] != -1 && event.targets.length > range[1];
                        },
                        content: function() {},
                        mod: {
                            selectTarget: function(card, player, range) {
                                if (card.name == 'sha') range[1] += 2;
                            },
                        },
                    },
                    "ssr_zhanshen_xiuluo": {
                        equipSkill: true,
                        trigger: {
                            player: "damageBegin4",
                        },
                        priority: -2,
                        forced: true,
                        filter: function(event, player) {
                            //if(event.num<=1) return false;
                            if (player.hasSkillTag('unequip2')) return false;
                            if (event.source && event.source.hasSkillTag('unequip', false, {
                                name: event.card ? event.card.name: null,
                                target: player,
                                card: event.card
                            })) return false;
                            return true;
                        },
                        content: function() {
                            'step 0';
                            if (trigger.num > 1) trigger.num = 1;
                            'step 1';
                            if (_status.currentPhase != player) {
                                var evt = _status.event.getParent('phaseUse');
                                if (evt && evt.name == 'phaseUse') {
                                    evt.skipped = true;
                                }
                            }
                        },
                        ai: {
                            filterDamage: true,
                            skillTagFilter: function(player, tag, arg) {
                                if (player.hasSkillTag('unequip2')) return false;
                                if (arg && arg.player) {
                                    if (arg.player.hasSkillTag('unequip', false, {
                                        name: arg.card ? arg.card.name: null,
                                        target: player,
                                        card: arg.card,
                                    })) return false;
                                    if (arg.player.hasSkillTag('unequip_ai', false, {
                                        name: arg.card ? arg.card.name: null,
                                        target: player,
                                        card: arg.card,
                                    })) return false;
                                    if (arg.player.hasSkillTag('jueqing', false, player)) return false;
                                }
                            },
                        },
                    },
                    "ssr_zhanshen_mengyan": {
                        equipSkill: true,
                        trigger: {
                            source: "damageBegin1",
                            player: "damageBegin4",
                        },
                        filter: function(event, player) {
                            return true;
                        },
                        priority: 2,
                        direct: true,
                        content: function() {
                            "step 0";
                            if (trigger.player != player) {
                                trigger.nature = 'fire';
                            } else if (trigger.nature == 'fire') {
                                trigger.cancel();
                            }
                        },
                        ai: {
                            nofire: true,
                            effect: {
                                target: function(card, player, target, current) {
                                    if (get.tag(card, 'fireDamage')) return 'zerotarget';
                                },
                            },
                        },
                    },
                    "ssr_zhanshen_xieshen": {
                        equipSkill: true,
                        trigger: {
                            player: ["turnOverBefore"],
                        },
                        priority: 25,
                        forced: true,
                        filter: function(event, player) {
                            return ! player.isTurnedOver();
                        },
                        content: function() {
                            trigger.cancel();
                            game.log(player, '取消了翻面');
                        },
                        mod: {
                            targetEnabled: function(card, player, target) {
                                if (get.type(card) == 'delay') return false;
                            },
                            effect: {
                                target: function(card) {
                                    if (card.name == 'tiesuo') return 'zeroplayertarget';
                                },
                            },
                        },
                        ai: {
                            noCompareTarget: true,
                        },
                        group: ['ssr_zhanshen_xieshen_link'],
                        subSkill: {
                            link: {
                                trigger: {
                                    player: "linkBegin",
                                },
                                forced: true,
                                filter: function(event, player) {
                                    return ! player.isLinked();
                                },
                                content: function() {
                                    trigger.cancel();
                                },
                                sub: true,
                            },
                        },
                    },
                    "ssr_newshenwei": {
                        group: 'ssr_newshenwei_die',
                        trigger: {
                            global: ["loseAfter", "equipAfter", "addJudgeAfter", "gainAfter", "loseAsyncAfter"],
                        },
                        priority: 2,
                        forced: true,
                        mod: {
                            cardname: function(card, player) {
                                if (get.position(card) != 'e' && lib.card[card.name].type == 'equip') return 'sha';
                            },
                        },
                        ai: {
                            skillTagFilter: function(player) {
                                if (!player.countCards('h', {
                                    type: 'equip'
                                })) return false;
                            },
                            respondSha: true,
                        },
                        filter: function(event, player) {
                            //if(event.type!='discard') return false;
                            var evt = event.getl(player);
                            if (evt && (evt.player == player || 1 == 1)) {
                                //if (['useCard'].contains(event.getParent().name)) return false;
                                var sumcard = [];
                                var equiplist = ['ssr_zhanshen_lianyu_card', 'ssr_zhanshen_xiuluo_card', 'ssr_zhanshen_mengyan_card', 'ssr_zhanshen_xieshen_card'];
                                if (evt.es && evt.es.length > 0) {
                                    var sumcard = sumcard.concat(evt.es);
                                }
                                if (evt.hs && evt.hs.length > 0) {
                                    var sumcard = sumcard.concat(evt.hs);
                                }
                                if (sumcard && sumcard.length > 0) {
                                    for (var i = 0; i < sumcard.length; i++) {
                                        if (equiplist.contains(sumcard[i].name)) return true;
                                    }
                                }
                            }
                        },
                        init: function(player, skill) {
                            player.storage.ssr_newshenwei_equip = [];
                        },
                        content: function() {
                            'step 0';
                            event.num = 0;
                            event.cards = [];
                            var evt = trigger.getl(player);
                            var sumcard = [];
                            var equiplist = ['ssr_zhanshen_lianyu_card', 'ssr_zhanshen_xiuluo_card', 'ssr_zhanshen_mengyan_card', 'ssr_zhanshen_xieshen_card'];
                            if (evt.es && evt.es.length > 0) {
                                var sumcard = sumcard.concat(evt.es);
                            }
                            if (evt.hs && evt.hs.length > 0) {
                                var sumcard = sumcard.concat(evt.hs);
                            }
                            for (var i = 0; i < sumcard.length; i++) {
                                if (equiplist.contains(sumcard[i].name)) {
                                    event.cards.push(sumcard[i]);
                                    event.num++;
                                }
                            }
                            'step 1';
                            if (!player.hasSkill('ssr_newshenwei_gain')) {
                                player.addSkill('ssr_newshenwei_gain');
                                player.storage.ssr_newshenwei_gain = [];
                            }
                            player.lose(event.cards, ui.special, 'toStorage');
                            player.$give(event.cards, player, false);
                            player.storage.ssr_newshenwei_gain = player.storage.ssr_newshenwei_gain.concat(event.cards);
                            player.markSkill('ssr_newshenwei_gain');
                            if (player.hp < 1 || player.isDying()) {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                            'step 2';
                            if (player.countMark('ssr_kuangbao') < 1) {
                                player.loseHp(event.num); {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            } else {
                                if (event.num <= 1) {
                                    player.chooseControl('移去标记', '受到伤害',
                                    function() {
                                        if (player.hp > 3 && player.countMark('ssr_kuangbao') < 4) return '受到伤害';
                                        return '移去标记';
                                    }).set('prompt', '选择移去标记或者受到伤害');
                                } else {
                                    player.chooseCardButton('选择弃置标记的数量', true, event.cards, [0, player.countMark('ssr_kuangbao')]).set('ai',
                                    function(button) {
                                        var num = ui.selected.buttons.length;
                                        if (player.hp > 3 && num >= event.cards - 1) {
                                            return 0;
                                        } else {
                                            return 1;
                                        }
                                    });
                                }
                            }
                            'step 3';
                            if (event.num <= 1) {
                                if (result.control == '移去标记') {
                                    player.removeMark('ssr_kuangbao');
                                } else {
                                    //player.loseHp();
                                    player.damage('nosource');
                                }
                            } else {
                                var num1 = result.links.length;
                                var num2 = event.num - num1;
                                if (num1 > 0) player.removeMark('ssr_kuangbao', num1);
                                //if(num2>0) player.loseHp(num2);
                                if (num2 > 0) player.damage(num2, 'nosource');
                            }
                        },
                        subSkill: {
                            gain: {
                                trigger: {
                                    player: ["phaseZhunbeiBegin"],
                                },
                                intro: {
                                    name: "神器重铸",
                                    content: function(storage, player, skill) {
                                        return "<li>正在重铸装备：" + get.translation(storage);
                                    },
                                },
                                mark: true,
                                marktext: "神",
                                priority: -99,
                                forced: true,
                                //silent:true,
                                content: function() {
                                    "step 0";
                                    var equiplist = player.storage.ssr_newshenwei_gain;
                                    //player.gain(player.storage.ssr_newshenwei_gain,'gain2');
                                    for (var i = 0; i < equiplist.length; i++) {
                                        player.equip(equiplist[i]);
                                    }
                                    "step 1";
                                    player.storage.ssr_newshenwei_gain = [];
                                    player.removeSkill('ssr_newshenwei_gain');
                                },
                                sub: true,
                            },
                            die: {
                                trigger: {
                                    player: ["dieBefore"],
                                },
                                priority: 131,
                                forced: true,
                                forceDie: true,
                                filter: function(event, player) {
                                    return true;
                                },
                                content: function() {
                                    player.discard(player.getCards('e'));
                                },
                                sub: true,
                            },
                        },
                    },
                    "ssr_jiwu": {
                        audio: "ol_wuqian",
                        hiddenCard: function(player, name) {
                            if (name == 'jiu') return player.countMark('ssr_kuangbao') >= 2;
                            return false;
                        },
                        enable: "chooseToUse",
                        filter: function(event, player) {
                            if (player.countMark('ssr_kuangbao') < 3) return false;
                            return event.filterCard({
                                name: 'jiu',
                                isCard: true
                            },
                            player, event);
                        },
                        content: function() {
                            'step 0';
                            player.removeMark('ssr_kuangbao', 3);
                            'step 1';
                            if (_status.event.getParent(2).type == 'dying') {
                                event.dying = player;
                                event.type = 'dying';
                            }
                            var card = game.createCard('jiu');
                            player.useCard(card, player);
                            //player.useCard({name:'jiu',isCard:true},player);
                        },
                        ai: {
                            order: 5,
                            result: {
                                player: function(player) {
                                    if (_status.event.parent.name == 'phaseUse') {
                                        if (player.countCards('h', 'jiu') > 0) return 0;
                                        if (player.getEquip('zhuge') && player.countCards('h', 'sha') > 1) return 0;
                                        if (!player.countCards('h', 'sha')) return 0;
                                        var targets = [];
                                        var target;
                                        var players = game.filterPlayer();
                                        for (var i = 0; i < players.length; i++) {
                                            if (get.attitude(player, players[i]) < 0) {
                                                if (player.canUse('sha', players[i], true, true)) {
                                                    targets.push(players[i]);
                                                }
                                            }
                                        }
                                        if (targets.length) {
                                            target = targets[0];
                                        } else {
                                            return 0;
                                        }
                                        var num = get.effect(target, {
                                            name: 'sha'
                                        },
                                        player, player);
                                        for (var i = 1; i < targets.length; i++) {
                                            var num2 = get.effect(targets[i], {
                                                name: 'sha'
                                            },
                                            player, player);
                                            if (num2 > num) {
                                                target = targets[i];
                                                num = num2;
                                            }
                                        }
                                        if (num <= 0) return 0;
                                        var e2 = target.getEquip(2);
                                        if (e2) {
                                            if (e2.name == 'tengjia') {
                                                if (!player.countCards('h', {
                                                    name: 'sha',
                                                    nature: 'fire'
                                                }) && !player.getEquip('zhuque')) return 0;
                                            }
                                            if (e2.name == 'renwang') {
                                                if (!player.countCards('h', {
                                                    name: 'sha',
                                                    color: 'red'
                                                })) return 0;
                                            }
                                            if (e2.name == 'baiyin') return 0;
                                        }
                                        if (player.getEquip('guanshi') && player.countCards('he') > 2) return 1;
                                        return target.countCards('h') > 3 ? 0 : 1;
                                    }
                                    if (player == _status.event.dying || player.isTurnedOver()) return 3;
                                },
                            },
                            effect: {
                                target: function(card, player, target) {
                                    if (card.name == 'guiyoujie') return [0, 0.5];
                                    if (target.isTurnedOver()) {
                                        if (get.tag(card, 'damage')) {
                                            if (player.hasSkillTag('jueqing', false, target)) return [1, -2];
                                            if (target.hp == 1) return;
                                            return [1, target.countCards('h') / 2];
                                        }
                                    }
                                },
                            },
                        },
                    },
                    "ssr_dimeng": {
                        group: 'ssr_dimeng_sha',
                        subSkill: {
                            sha: {
                                shaRelated: true,
                                audio: 'dimeng',
                                preHidden: true,
                                priority: -8,
                                trigger: {
                                    target: "useCardToTargeted",
                                },
                                filter: function(event, player) {
                                    if (!event.player.countMark("ssr_dimeng_draw") > 0) return false;
                                    if (event.card.name != 'sha') return false;
                                    return player == event.target;
                                },
                                frequent: true,
                                content: function() {
                                    "step 0";
                                    trigger.player.removeMark("ssr_dimeng_draw");
                                    if (trigger.player.countMark("ssr_dimeng_draw") < 1) {
                                        trigger.player.removeSkill("ssr_dimeng_draw");
                                    }
                                    "step 1";
                                    player.draw();
                                },
                                ai: {
                                    effect: {
                                        target: function(card, player, target) {
                                            if (player.countMark("ssr_dimeng_draw") > 0) {
                                                if (card.name == 'sha') return [1, 0.6];
                                            }
                                        },
                                    },
                                },
                                sub: true,
                            },
                            draw: {
                                trigger: {
                                    player: "phaseDrawBegin2",
                                },
                                frequent: true,
                                filter: function(event, player) {
                                    return player.countMark("ssr_dimeng_draw") > 0 && !event.numFixed;
                                },
                                mark: true,
                                marktext: "盟",
                                charlotte: true,
                                intro: {
                                    name: "盟军盛宴",
                                    content: "mark",
                                },
                                content: function() {
                                    trigger.num++;
                                    player.removeMark("ssr_dimeng_draw");
                                    if (player.countMark("ssr_dimeng_draw") < 1) {
                                        player.removeSkill("ssr_dimeng_draw");
                                    }
                                },
                                ai: {
                                    threaten: 1.2,
                                },
                            },
                        },
                        audio: 'dimeng',
                        trigger: {
                            player: "phaseZhunbeiBegin",
                        },
                        priority: 2,
                        direct: true,
                        filter: function(event, player) {
                            return true;
                        },
                        content: function() {
                            "step 0";
                            player.chooseTarget(get.prompt('ssr_dimeng'), '选择交换手牌的角色', 2,
                            function(card, player, target) {
                                return player != target;
                            },
                            function(target) {
                                if (ui.selected.targets.length == 0) {
                                    if (get.attitude(player, target) > 0) {
                                        return Math.max(10 - target.countCards('h'), 1);
                                    } else {
                                        return - 1;
                                    }
                                } else {
                                    if (get.attitude(player, target) > 0) {
                                        return target.countCards('h');
                                    } else {
                                        if (target.countCards('h') < ui.selected.targets[0].countCards('h')) {
                                            return - 1;
                                        } else {
                                            return target.countCards('h');
                                        }
                                    }
                                }
                                /*var list=[];
				                var num=player.countCards('he');
				                var players=game.filterPlayer();
				                if(ui.selected.targets.length==0){
				                    for(var i=0;i<players.length;i++){
				                        if(players[i]!=player&&get.attitude(player,players[i])>3) list.push(players[i]);
				                    }
				                    list.sort(function(a,b){
				                        return a.countCards('h')-b.countCards('h');
				                    });
				                    if(target==list[0]) return get.attitude(player,target);
				                    return -get.attitude(player,target);
				                }
				                else{
				                    var from=ui.selected.targets[0];
				                    for(var i=0;i<players.length;i++){
				                        if(players[i]!=player&&get.attitude(player,players[i])<1) list.push(players[i]);
				                    }
				                    list.sort(function(a,b){
				                        return b.countCards('h')-a.countCards('h');
				                    });
				                    if(from.countCards('h')>=list[0].countCards('h')) return -get.attitude(player,target);
				                    for(var i=0;i<list.length&&from.countCards('h')<list[i].countCards('h');i++){
				                        if(list[i].countCards('h')-from.countCards('h')<=num){
				                            var count=list[i].countCards('h')-from.countCards('h');
				                            if(count<2&&from.countCards('h')>=2) return -get.attitude(player,target);
				                            if(target==list[i]) return get.attitude(player,target);
				                            return -get.attitude(player,target);
				                        }
				                    }
				                }*/
                            }).set('check',
                            function(card) {
                                var list = [],
                                player = _status.event.player;
                                var num = player.countCards('he');
                                var count;
                                var players = game.filterPlayer();
                                for (var i = 0; i < players.length; i++) {
                                    if (players[i] != player && get.attitude(player, players[i]) > 3) list.push(players[i]);
                                }
                                list.sort(function(a, b) {
                                    return a.countCards('h') - b.countCards('h');
                                });
                                if (list.length == 0) return - 1;
                                var from = list[0];
                                list.length = 0;

                                for (var i = 0; i < players.length; i++) {
                                    if (players[i] != player && get.attitude(player, players[i]) < 1) list.push(players[i]);
                                }
                                if (list.length == 0) return - 1;
                                list.sort(function(a, b) {
                                    return b.countCards('h') - a.countCards('h');
                                });
                                if (from.countCards('h') >= list[0].countCards('h')) return - 1;
                                for (var i = 0; i < list.length && from.countCards('h') < list[i].countCards('h'); i++) {
                                    if (list[i].countCards('h') - from.countCards('h') <= num) {
                                        count = list[i].countCards('h') - from.countCards('h');
                                        break;
                                    }
                                }
                                if (count < 2 && from.countCards('h') >= 2) return - 1;
                                if (ui.selected.cards.length < count) return 11 - get.value(card);
                                return - 1;
                            });
                            "step 1";
                            if (result.bool) {
                                event.num = Math.abs(result.targets[0].countCards('h') - result.targets[1].countCards('h'));
                                if (result.targets[0].countCards('h') > result.targets[1].countCards('h')) {
                                    event.max = result.targets[0];
                                    event.min = result.targets[1];
                                } else {
                                    event.max = result.targets[1];
                                    event.min = result.targets[0];
                                }
                                player.logSkill('ssr_dimeng', result.targets);
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            "step 2";
                            event.max.swapHandcards(event.min);
                            if (event.num > 0) {
                                if (!event.max.hasSkill("ssr_dimeng_draw")) event.max.addSkill("ssr_dimeng_draw");
                                event.max.addMark("ssr_dimeng_draw", event.num);
                            }
                            game.delay();
                        },
                        ai: {
                            threaten: 2,
                            expose: 0.3,
                        },
                    },
                    "ssr_fuhui": {
                        subSkill: {
                            compare: {
                                locked: true,
                                audio: "twyangming",
                                trigger: {
                                    player: "compare",
                                    target: "compare",
                                },
                                filter: function(event, player) {
                                    if (event.iwhile) return false;
                                    var card = (player == event.player) ? event.card1: event.card2;
                                    return player.countCards('h');
                                },
                                priority: 10,
                                forced: true,
                                preHidden: true,
                                content: function() {
                                    'step 0';
                                    var num = player.countCards('h');
                                    game.log(player, '的拼点牌点数〈+' + num + '〉');
                                    if (player == trigger.player) {
                                        trigger.num1 += num;
                                        if (trigger.num1 > 13) trigger.num1 = 13;
                                        var news = game.createCard({
                                            name: trigger.card1.name,
                                            suit: get.suit(trigger.card1),
                                            number: trigger.num1
                                        });
                                        game.log(player, '拼点牌', trigger.card1, '改为了', news);
                                        trigger.card1.num = trigger.num1;
                                    } else {
                                        trigger.num2 += num;
                                        if (trigger.num2 > 13) trigger.num2 = 13;
                                        var news = game.createCard({
                                            name: trigger.card2.name,
                                            suit: get.suit(trigger.card2),
                                            number: trigger.num2
                                        });
                                        game.log(player, '拼点牌', trigger.card2, '改为了', news);
                                        trigger.card2.num = trigger.num2;
                                    }
                                },
                                sub: true,
                            },
                        },
                        group: 'ssr_fuhui_compare',
                        shaRelated: true,
                        audio: "haoshi",
                        preHidden: true,
                        priority: -12,
                        trigger: {
                            player: "useCardToPlayered",
                            target: "useCardToTargeted",
                        },
                        filter: function(event, player) {
                            if (player == event.player && player == event.target) return false;
                            if (! (event.card.name == 'juedou' || event.card.name == 'sha')) return false;
                            var him = (player == event.target) ? event.player: event.target;
                            if (him.hasSkillTag('noCompareSource') || him.hasSkillTag('noCompareTarget')) return false;
                            if (!him.countCards('h') > 0) return false;
                            return player == event.target || event.getParent().triggeredTargets3.length == 1;
                        },
                        content: function() {
                            'step 0';
                            player.draw();
                            'step 1';
                            trigger.player.chooseToCompare(trigger.target);
                            'step 2';
                            if (result.bool) {
                                trigger.getParent().directHit.add(trigger.target);
                            } else if (!result.tie) {
                                trigger.getParent().excluded.add(trigger.target);
                            }
                        },
                        ai: {
                            effect: {
                                target: function(card, player, target) {
                                    if (card.name == 'sha') return [1, 0.6];
                                },
                                player: function(card, player, target) {
                                    if (card.name == 'sha') return [1, 1];
                                },
                            },
                        },
                    },
                    "ssr_zhijian": {
                        subSkill: {
                            gain: {
                                marktext: "谏书",
                                mark: true,
                                intro: {
                                    name: "直言上谏",
                                    content: function(storage, player, skill) {
                                        var cards = player.getCards('h');
                                        var list = [];
                                        for (var i = 0; i < cards.length; i++) {
                                            if (cards[i].hasGaintag('ssr_zhijian')) list.push(cards[i]);
                                        }
                                        return '<li>〖直谏〗牌：' + get.translation(list);
                                    },
                                },
                                mod: {
                                    cardDiscardable: function(card, player) {
                                        if (card.hasGaintag('ssr_zhijian')) return false;
                                    },
                                    "cardEnabled2": function(card, player) {
                                        if (get.itemtype(card) == 'card' && card.hasGaintag('ssr_zhijian')) {} else return false;
                                    },
                                },
                                trigger: {
                                    player: ["damageAfter", "loseAfter"],
                                },
                                forced: true,
                                popup: false,
                                charlotte: true,
                                filter: function(event, player) {
                                    if (player.countCards('h') < 1) {
                                        var has = false;
                                    } else {
                                        var cards = player.getCards('h');
                                        var has = false;
                                        for (var i = 0; i < cards.length; i++) {
                                            if (cards[i].hasGaintag('ssr_zhijian')) has = true;
                                        }
                                    }
                                    return (event.name == 'damage' || !has);
                                },
                                content: function() {
                                    'step 0';
                                    if (trigger.name == 'damage') {
                                        game.filterPlayer(function(current) {
                                            if (current.hasSkill('ssr_zhijian') && current.countCards('h')) current.discard(current.getCards('h').randomGet());
                                        });
                                    } else {
                                        game.filterPlayer(function(current) {
                                            if (current.hasSkill('ssr_zhijian')) current.draw(2);
                                        });
                                    }
                                    'step 1';
                                    player.removeSkill('ssr_zhijian_gain');
                                },
                                onremove: function(player) {
                                    player.removeGaintag('ssr_zhijian');
                                },
                                sub: true,
                            },
                        },
                        audio: 'olzhijian',
                        enable: "phaseUse",
                        //usable:1,
                        filterCard: true,
                        position: "he",
                        filterTarget: function(card, player, target) {
                            return target != player;
                        },
                        filter: function(event, player) {
                            return player.countCards('he') > 0;
                        },
                        check: function(card) {
                            var num = get.value(card);
                            if (_status.event.player.needsToDiscard()) {
                                return 20 - num;
                            } else {
                                return 7 - num;
                            }
                        },
                        discard: false,
                        lose: false,
                        delay: false,
                        content: function() {
                            'step 0';
                            target.gain(cards, player, 'giveAuto');
                            'step 1';
                            if (!target.hasSkill('ssr_zhijian_gain')) target.addSkill('ssr_zhijian_gain');
                            target.addGaintag(cards, 'ssr_zhijian');
                        },
                        ai: {
                            order: 8,
                            expose: 0.2,
                            result: {
                                target: function(player, target) {
                                    if (target.hasSkill('ssr_zhijian_gain')) return 0;
                                    return - 1.5;
                                },
                            },
                            threaten: 1.1,
                        },
                    },
                    "ssr_guzheng": {
                        subSkill: {
                            used: {
                                charlotte: true,
                                sub: true,
                            },
                        },
                        audio: "olguzheng",
                        trigger: {
                            global: "loseAfter",
                        },
                        filter: function(event, player) {
                            if (player.hasSkill('ssr_guzheng_used')) return false;
                            if (event.type != 'discard') return false;
                            return event.cards2.length >= 1 && event.player.isIn();
                        },
                        /*usable:1,*/
                        priority: -96,
                        direct: true,
                        content: function() {
                            "step 0";
                            if (trigger.delay == false) game.delay();
                            "step 1";
                            if (!_status.auto && (player == game.me || player.isUnderControl())) game.waitClick(3, false, 100);
                            player.chooseCardButton('固政：是否选择一张牌交回给' + get.translation(trigger.player.name) + '？', trigger.cards2, 1).set('ai',
                            function(button) {
                                //if(_status.currentPhase!=player&&trigger.player==player&&get.type(button)=='basic') return 2+get.value(button);
                                if (window.aiClicking) return - 1;
                                if (get.attitude(player, trigger.player) > 0) {
                                    return get.value(button);
                                } else {
                                    return - 1;
                                }
                            });
                            "step 2";
                            if (!_status.auto && (player == game.me || player.isUnderControl())) game.stopClick();
                            if (result.bool) {
                                event.togive = result.links[0];
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            "step 3";
                            player.logSkill('ssr_guzheng', trigger.player);
                            trigger.player.gain(event.togive);
                            trigger.player.$gain2(event.togive);
                            game.log(trigger.player, '收回了', event.togive);
                            player.addTempSkill('ssr_guzheng_used')
                            //trigger.player.gain(event.togive, 'gain2', 'log');
                            //if(_status.currentPhase!=player&&trigger.player==player&&get.type(event.togive)=='basic') player.draw();
                        },
                        ai: {
                            expose: 0.3,
                            threaten: 1.1,
                        },
                    },
                    "ssr_zhuji": {
                        audio: 'xinleiji',
                        forceaudio: true,
                        unique: true,
                        zhuSkill: true,
                    },
                    "ssr_guidao": {
                        audio: 'xinguidao',
                        enable: "phaseUse",
                        usable: 2,
                        position: "h",
                        filter: function(event, player) {
                            return player.countCards('h') > 0;
                        },
                        filterCard: true,
                        filterTarget: function(card, player, target) {
                            return target != player && !target.hasSkill('ssr_guidao_zhou') && !target.hasSkill('ssr_guidao');
                        },
                        check: function(card) {
                            var player = _status.event.player;
                            return 9 - get.value(card);
                            if (player.hasSkill('ssr_huangtian')) {
                                if (get.suit(card) == 'spade' && get.number(card) > 1 && get.number(card) < 10) {
                                    return 10 - get.value(card);
                                } else {
                                    return - 1;
                                }
                            } else if (player.hasSkill('ssr_houtu')) {
                                if (get.suit(card) == 'heart' && get.number(card) > 1 && get.number(card) < 10) {
                                    return 10 - get.value(card);
                                } else {
                                    return - 1;
                                }
                            } else if (player.hasSkill('ssr_cangsheng')) {
                                if (get.suit(card) == 'club' && get.number(card) > 1 && get.number(card) < 10) {
                                    return 10 - get.value(card);
                                } else {
                                    return - 1;
                                }
                            } else return 8 - get.value(card);
                        },
                        //position:"he",
                        discard: false,
                        toStorage: true,
                        prepare: "give2",
                        content: function() {
                            if (!target.storage.ssr_guidao_zhou_markcount) target.storage.ssr_guidao_zhou_markcount = 0;
                            //player.$give(cards,target,false);
                            target.markAuto('ssr_guidao_zhou', cards);
                            target.addSkill('ssr_guidao_zhou');
                            var nature = [];
                            target.storage.ssr_guidao_zhou_player = player;
                            if (player.hasSkill('ssr_huangtian_thunder')) nature.push('thunder');
                            if (player.hasSkill('ssr_houtu_fire')) nature.push('fire');
                            if (player.hasSkill('ssr_cangsheng_water')) nature.push('ice');
                            if (nature.length < 1) nature = ['basic'];
                            var realnature = nature.randomGet();
                            target.storage.ssr_guidao_zhou_nature = realnature;
                            var str = '咒缚';
                            if (['thunder', 'fire', 'ice'].contains(realnature)) {
                                str = str + "·" + get.translation(realnature);
                            }
                            game.log(target, '被', player, '贴上了', str);
                        },
                        ai: {
                            order: 1,
                            result: {
                                target: -1,
                            },
                        },
                        //group:["ssr_guidao_judge"],
                        group: ["ssr_guidao_phaseD", "ssr_guidao_phaseJ"],
                        subSkill: {
                            phaseD: {
                                trigger: {
                                    player: "phaseJieshuBegin",
                                },
                                priority: 15,
                                forced: true,
                                filter: function(event, player) {
                                    return ! player.storage.ssr_guidao_phase;
                                },
                                content: function() {
                                    'step 0';
                                    player.storage.ssr_guidao_phase = true;
                                    //trigger.cancel();
                                    'step 1';
                                    player.phaseJudge();
                                    'step 2';
                                    player.storage.ssr_guidao_phase = false;
                                },
                            },
                            phaseJ: {
                                trigger: {
                                    player: "phaseJudgeBefore",
                                },
                                priority: 15,
                                forced: true,
                                silent: true,
                                filter: function(event, player) {
                                    return ! player.storage.ssr_guidao_phase;
                                },
                                content: function() {
                                    'step 0';
                                    player.storage.ssr_guidao_phase = true;
                                    trigger.cancel();
                                    'step 1';
                                    //player.phaseDiscard();
                                    'step 2';
                                    player.storage.ssr_guidao_phase = false;
                                },
                                mod: {
                                    targetEnabled: function(card, player, target, now) {
                                        if (get.type(card) == 'delay' && player != target) return false;
                                    },
                                },
                            },
                            use: {
                                audio: "zhoufu",
                                trigger: {
                                    player: "useCard",
                                },
                                forced: true,
                                silent: true,
                                filter: function(event, player) {
                                    if (player.getStorage('ssr_guidao_zhou').length) {
                                        if (player.storage.ssr_guidao_zhou_nature != undefined) {
                                            var nature = player.storage.ssr_guidao_zhou_nature;
                                        } else {
                                            var nature = 'basic';
                                        }
                                        var cards = player.getStorage('ssr_guidao_zhou');
                                        if (nature == 'thunder') {
                                            return get.suit(event.card) == get.suit(cards[0]);
                                        } else if (nature == 'fire') {
                                            if (['trick', 'delay'].contains(get.type(event.card))) {
                                                return ['trick', 'delay'].contains(get.type(cards[0]));
                                            } else return get.type(event.card) == get.type(cards[0]);
                                        } else if (nature == 'ice') {
                                            return true;
                                        } else {
                                            return get.color(event.card) == get.color(cards[0]);
                                        }
                                    }
                                    return false;
                                },
                                priority: 15,
                                logTarget: "player",
                                content: function() {
                                    "step 0";
                                    player.storage.ssr_guidao_zhouing = true;
                                    event.zhou = player.getStorage('ssr_guidao_zhou')[0];
                                    event.color = get.color(event.zhou);
                                    event.suit = get.suit(event.zhou);
                                    event.type = get.type(event.zhou);
                                    event.number = get.number(event.zhou);
                                    event.him = player.storage.ssr_guidao_zhou_player;
                                    if (player.storage.ssr_guidao_zhou_nature != undefined) {
                                        event.nature = player.storage.ssr_guidao_zhou_nature;
                                    } else {
                                        event.nature = 'basic';
                                    }
                                    var str = '咒缚';
                                    if (['thunder', 'fire', 'ice'].contains(event.nature)) {
                                        str = str + "·" + get.translation(event.nature);
                                    }
                                    player.showCards(event.zhou, str);
                                    "step 1";
                                    //基本
                                    if (event.nature == 'basic') {
                                        trigger.targets.length = 0;
                                        trigger.all_excluded = true;
                                        event.goto(7);
                                    }
                                    "step 2";
                                    //闪电
                                    if (event.nature == 'thunder') {
                                        game.log(player, '触犯了天雷');
                                        player.addTempSkill('fengyin');
                                        player.damage(2, 'thunder', 'nosource');
                                        event.goto(7);
                                    }
                                    "step 3";
                                    //火山
                                    if (event.nature == 'fire') {
                                        if (event.him.isIn()) {
                                            player.chooseCard('咒缚：交给' + get.translation(event.him.name) + '一张' + get.translation(event.type) + '牌，否则受到一点火焰伤害且本回合内不能再使用或打出任何牌', 'he',
                                            function(card) {
                                                return get.type(card) == event.type;
                                            }).set('ai',
                                            function(card) {
                                                return 9 - get.value(card);
                                            });
                                        } else {
                                            result.bool = false;
                                        }
                                    } else {
                                        event.goto(5);
                                    }
                                    "step 4";
                                    if (result.bool) {
                                        event.him.gain(result.cards, player, 'giveAuto');
                                    } else {
                                        game.log(player, '触犯了业火');
                                        player.damage('fire', 'nosource');
                                        player.addTempSkill('ssr_guidao_fengyin');
                                    }
                                    event.goto(7);
                                    "step 5";
                                    //洪水
                                    if (event.nature == 'ice') {
                                        var cards = player.getCards('h');
                                        var cardpiles = [];
                                        //ps1
                                        for (var i = 0; i < cards.length; i++) {
                                            if (get.number(cards[i]) >= event.number) cardpiles.push(cards[i]);
                                        }
                                        //ps2
                                        if (cardpiles.length > 0) {
                                            var val = 99;
                                            var cho = [];
                                            for (var i = 0; i < cards.length; i++) {
                                                if (get.value(cards[i]) < val) {
                                                    cho = [];
                                                    cho.push(cards[i]);
                                                    val = get.value(cards[i]);
                                                }
                                            }
                                        } else {
                                            var val = 99;
                                            var cho = [];
                                            for (var j = 13; j > 0; j--) {
                                                for (var i = 0; i < cards.length; i++) {
                                                    if (get.number(cards[i]) == j) {
                                                        var card1 = cards[i];
                                                        for (var a = 13; a > 0; a--) {
                                                            for (var b = 0; b < cards.length; b++) {
                                                                if (get.number(cards[b]) == a) {
                                                                    var card2 = cards[b];
                                                                    if (get.number(card1) + get.number(card2) >= event.number) {
                                                                        if (get.value(card1) + get.value(card2) < val) {
                                                                            cho = [];
                                                                            cho.push(card1);
                                                                            cho.push(card2);
                                                                            val = get.value(card1) + get.value(card2);
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                        //ps3
                                        player.chooseToDiscard('咒缚：弃置任意张点数总和不小于' + event.number + '的手牌，否则' + get.translation(trigger.card) + '无效，且你将武将牌翻至背面', 'h', [1, Infinity],
                                        function(card) {
                                            return true;
                                        }).set('complexCard', true).set('selectCard',
                                        function() {
                                            var sum = 0;
                                            for (var i = 0; i < ui.selected.cards.length; i++) {
                                                sum += get.number(ui.selected.cards[i]);
                                            }
                                            if (sum >= event.number) return [ui.selected.cards.length, Infinity];
                                            return ui.selected.cards.length + 2;
                                        }).set('ai',
                                        function(card) {
                                            if (cho.contains(card)) return 10;
                                            return 0;
                                        });
                                    } else {
                                        event.goto(7);
                                    }
                                    "step 6";
                                    if (!result.bool) {
                                        game.log(player, '触犯了沧洪');
                                        if (trigger.card) {
                                            player.discard(trigger.card);
                                        }
                                        trigger.cancel();
                                        player.turnOver(true);
                                    }
                                    if (_status.currentPhase == player) {
                                        var evt = _status.event.getParent('phaseUse');
                                        if (evt && evt.name == 'phaseUse') {
                                            evt.skipped = true;
                                        }
                                    }
                                    "step 7";
                                    var str = '失去了咒缚';
                                    if (event.nature && ['thunder', 'fire', 'ice'].contains(event.nature)) {
                                        str = str + "·" + get.translation(event.nature);
                                    }
                                    game.log(player, str);
                                    player.storage.ssr_guidao_zhou_nature = false;
                                    player.storage.ssr_guidao_zhou = [];
                                    player.unmarkSkill('ssr_guidao_zhou');
                                    player.removeSkill('ssr_guidao_zhou');
                                    player.storage.ssr_guidao_zhouing = false;
                                    /*"step 8";
				                    if(event.him.isIn()) {
				                        event.him.draw();
				                    }*/
                                },
                            },
                            zhou: {
                                group: ["ssr_guidao_use", "ssr_guidao_die"],
                                audio: "zhoufu",
                                trigger: {
                                    player: "judgeBefore",
                                },
                                forced: true,
                                filter: function(event, player) {
                                    var nature = player.storage.ssr_guidao_zhou_nature;
                                    if (nature && ['thunder', 'fire', 'ice'].contains(nature)) {
                                        if (!event.cardname) return false;
                                        if (nature == 'thunder' && event.cardname != 'shandian') return false;
                                        if (nature == 'fire' && event.cardname != 'huoshan') return false;
                                        if (nature == 'hongshui' && event.cardname != 'hongshui') return false;
                                    } else {
                                        var evt = event.getParent('phaseJudge');
                                        if (!evt || evt.name != 'phaseJudge' || evt.player != player) return false;
                                    }
                                    if (!event.player.getStorage('ssr_guidao_zhou').length) return false;
                                    if (event.judge(event.player.getStorage('ssr_guidao_zhou')[0]) >= 0) return false;
                                    return ! event.directresult;
                                },
                                priority: -2,
                                logTarget: "player",
                                content: function() {
                                    "step 0";
                                    player.storage.ssr_guidao_zhouing = true;
                                    if (player.storage.ssr_guidao_zhou_nature != undefined) {
                                        event.nature = player.storage.ssr_guidao_zhou_nature;
                                    } else {
                                        event.nature = 'basic';
                                    }
                                    var str = '咒缚';
                                    if (['thunder', 'fire', 'ice'].contains(event.nature)) {
                                        str = str + "·" + get.translation(event.nature);
                                    }
                                    player.showCards(event.zhou, str);
                                    "step 1";
                                    event.him = player.storage.ssr_guidao_zhou_player;
                                    var cards = [player.getStorage('ssr_guidao_zhou')[0]];
                                    trigger.directresult = cards[0];
                                    var str = '咒缚';
                                    if (event.nature && ['thunder', 'fire', 'ice'].contains(event.nature)) {
                                        str = str + "·" + get.translation(event.nature);
                                    }
                                    game.log(str, '被作为了判定牌');
                                    player.storage.ssr_guidao_zhou_nature = false;
                                    player.storage.ssr_guidao_zhou = [];
                                    player.unmarkSkill('ssr_guidao_zhou');
                                    player.removeSkill('ssr_guidao_zhou');
                                    player.storage.ssr_guidao_zhouing = false;
                                    /*"step 1";
				                    if(event.him.isIn()) {
				                        event.him.draw();
				                    }*/
                                },
                                sub: true,
                                mark: true,
                                marktext: "咒",
                                intro: {
                                    name: function(storage, player) {
                                        var str = "咒缚";
                                        if (player.storage.ssr_guidao_zhou_nature && ['thunder', 'fire', 'ice'].contains(player.storage.ssr_guidao_zhou_nature)) {
                                            str = str + "·" + get.translation(player.storage.ssr_guidao_zhou_nature);
                                        }
                                        return str;
                                    },
                                    //markcount:"expansion",
                                    mark: function(dialog, content, player) {
                                        var him = player.storage.ssr_guidao_zhou_player;
                                        var content = player.storage.ssr_guidao_zhou;
                                        if (content && content.length) {
                                            if (him == game.me || him.isUnderControl()) {
                                                dialog.addAuto(content);
                                            } else {
                                                return '<li>来自' + get.translation(player.storage.ssr_guidao_zhou_player.name) + '的咒缚';
                                            }
                                        }
                                    },
                                    content: function(content, player) {
                                        var him = player.storage.ssr_guidao_zhou_player;
                                        var content = player.storage.ssr_guidao_zhou;
                                        if (content && content.length) {
                                            if (him == game.me || him.isUnderControl()) {
                                                return get.translation(content);
                                            }
                                            return '<li>来自' + get.translation(him.name) + '的咒缚';
                                        }
                                    },
                                    onunmark: function(storage, player) {
                                        if (storage && storage.length) {
                                            player.$throw(storage, 1000);
                                            game.cardsDiscard(storage);
                                            game.log(storage, '被置入了弃牌堆');
                                            storage.length == 0;
                                        }
                                        delete ssr_guidao_zhou;
                                    },
                                },
                            },
                            die: {
                                trigger: {
                                    player: "die",
                                },
                                priority: 2,
                                silent: true,
                                forced: true,
                                forceDie: true,
                                filter: function(event, player) {
                                    return true;
                                },
                                content: function() {
                                    event.him = player.storage.ssr_guidao_zhou_player;
                                    if (player.storage.ssr_guidao_zhou_nature != undefined) {
                                        event.nature = player.storage.ssr_guidao_zhou_nature;
                                    } else {
                                        event.nature = 'basic';
                                    }
                                    var str = '咒缚';
                                    if (event.nature && ['thunder', 'fire', 'ice'].contains(event.nature)) {
                                        str = str + "·" + get.translation(event.nature);
                                    }
                                    if (event.him && event.him.isIn() && !player.storage.ssr_guidao_zhouing) {
                                        if (player.storage.ssr_guidao_zhou_nature != undefined) {
                                            event.nature = player.storage.ssr_guidao_zhou_nature;
                                        } else {
                                            event.nature = 'basic';
                                        }
                                        var cards = [player.getStorage('ssr_guidao_zhou')[0]];
                                        event.him.gain(cards, player, false);
                                        game.log(str, '回到了', event.him, '的手牌');
                                    } else {
                                        game.log(str, '消失了');
                                    }
                                    player.storage.ssr_guidao_zhou_nature = false;
                                    player.storage.ssr_guidao_zhou = [];
                                    player.unmarkSkill('ssr_guidao_zhou');
                                    player.removeSkill('ssr_guidao_zhou');
                                },
                            },
                            fengyin: {
                                /*trigger:{
			                        player:"useCardToBefore",
			                    },
			                    forced:true,
			                    priority:27,
			                    filter:function(event,player){
			                        return true;
			                    },
			                    content:function(){
			                        trigger.cancel();
			                    },
			                    ai:{
			                        effect:{
			                            player:function(card,player,target,current){
			                                return 'zeroplayertarget';
			                            },
			                        },
			                    },*/
                                mod: {
                                    cardSavable: function(card, player) {
                                        return false;
                                    },
                                    cardEnabled: function(card, player) {
                                        return false;
                                    },
                                    cardResponsabled: function(card, player) {
                                        return false;
                                    },
                                },
                                intro: {
                                    name: "灰飞烟灭",
                                    content: "<li>你不能使用或打出任何的牌",
                                },
                                mark: true,
                                marktext: "湮灭",
                                sub: true,
                            },
                            judge: {
                                trigger: {
                                    player: "judgeBefore",
                                },
                                //usable:1,
                                audio: 'guidao',
                                frequent: true,
                                priority: -1,
                                //unique:true,
                                content: function() {
                                    "step 0";
                                    event.cards = get.cards(2);
                                    player.chooseCardButton(true, event.cards, '鬼道：选择一张牌作为你' + trigger.judgestr + '的判定结果').ai = function(button) {
                                        if (get.attitude(player, trigger.player) > 0) {
                                            return 1 + trigger.judge(button.link);
                                        }
                                        if (get.attitude(player, trigger.player) < 0) {
                                            return 1 - trigger.judge(button.link);
                                        }
                                        return 0;
                                    };
                                    "step 1";
                                    if (result.bool) {
                                        //player.logSkill('ssr_guidao',trigger.player);
                                        var card = result.links[0];
                                        event.cards.remove(card);
                                        trigger.directresult = card;
                                    } else {
                                        {
                                            if (event && event.finish) {
                                                event.finish();
                                            } else {
                                                return;
                                            }
                                        }
                                    }
                                    "step 2";
                                    var first = ui.cardPile.firstChild;
                                    var cards = event.cards;
                                    for (var i = 0; i < cards.length; i++) {
                                        ui.cardPile.insertBefore(cards[i], first);
                                    }
                                },
                            },
                        },
                    },
                    "ssr_guidao_thunder": {},
                    "ssr_guidao_fire": {},
                    "ssr_guidao_ice": {},
                    "ssr_xianji": {
                        trigger: {
                            player: ["logSkill", "useSkillAfter"],
                        },
                        usable: 1,
                        filter: function(event, player) {
                            var skill = event.sourceSkill || event.skill;
                            var list = ['ssr_tianlei', 'ssr_dihuo', 'ssr_renhong'];
                            if (!list.contains(skill) || !player.hasSkill(skill)) return false;
                            if (event.skill == 'ssr_zhangsan' || event.skill == 'ssr_xianji') return false;
                            event.triggerSkill = skill;
                            return true;
                        },
                        direct: true,
                        content: function() {
                            "step 0";
                            player.chooseBool(get.prompt('ssr_xianji'), '是否对自己造成一点伤害并发动“献祭”，额外执行一次〖' + get.translation(trigger.triggerSkill) + '〗？').set('ai',
                            function() {
                                var player = _status.event.player;
                                var hp = player.getHp() + player.hujia + player.countCards('hs', {
                                    name: 'tao'
                                });
                                if (hp > 3 && player.getHp() > 1) return true;
                                return false;
                            });
                            "step 1";
                            if (result.bool) {
                                player.logSkill('ssr_xianji');
                                player.damage();
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            "step 2";
                            var next = game.createEvent('phaseXianjiOver');
                            next.player = player;
                            next.setContent(function() {
                                game.log(player, '成功执行献祭仪式');
                                event.trigger('phaseXianjiOver');
                            });
                            return next;
                        },
                    },
                    ssr_gaiming: {
                        audio: 'sbguidao',
                        trigger: {
                            player: 'judge'
                        },
                        filter: function(event, player) {
                            return player.countCards('hes') > 0;
                        },
                        direct: true,
                        content: function() {
                            "step 0";
                            player.chooseCard(get.translation(trigger.player) + '的' + (trigger.judgestr || '') + '判定为' + get.translation(trigger.player.judging[0]) + '，' + get.prompt('ssr_gaiming'), 'hes',
                            function(card) {
                                //if(get.color(card)!='black') return false;
                                var player = _status.event.player;
                                var mod2 = game.checkMod(card, player, 'unchanged', 'cardEnabled2', player);
                                if (mod2 != 'unchanged') return mod2;
                                var mod = game.checkMod(card, player, 'unchanged', 'cardRespondable', player);
                                if (mod != 'unchanged') return mod;
                                return true;
                            }).set('ai',
                            function(card) {
                                var trigger = _status.event.getTrigger();
                                var player = _status.event.player;
                                var judging = _status.event.judging;
                                var result = trigger.judge(card) - trigger.judge(judging);
                                var attitude = get.attitude(player, trigger.player);
                                if (attitude == 0 || result == 0) return 0;
                                if (attitude > 0) {
                                    return result;
                                } else {
                                    return - result;
                                }
                            }).set('judging', trigger.player.judging[0]);
                            "step 1";
                            if (result.bool) {
                                player.respond(result.cards, 'highlight', 'ssr_gaiming', 'noOrdering');
                            } else {
                                event.finish();
                            }
                            "step 2";
                            if (result.bool) {
                                player.$gain2(trigger.player.judging[0]);
                                player.gain(trigger.player.judging[0]);
                                trigger.player.judging[0] = result.cards[0];
                                trigger.orderingCards.addArray(result.cards);
                                game.log(trigger.player, '的判定牌改为', result.cards[0]);
                            }
                            "step 3";
                            game.delay(2);
                        },
                        ai: {
                            rejudge: true,
                            tag: {
                                rejudge: 1
                            }
                        }
                    },
                    "ssr_zhangsan": {
                        trigger: {
                            player: "judge",
                        },
                        filter: function(event, player) {
                            if (player.countCards('hs') < 1) return false;
                            var list = ['ssr_tianlei', 'ssr_dihuo', 'ssr_renhong'];
                            for (var i = 0; i < list.length; i++) {
                                if (player.hasSkill(list[i]) && event.getParent().name == list[i]) return true;
                            }
                            return false;
                        },
                        direct: true,
                        content: function() {
                            "step 0";
                            var name = get.translation(trigger.getParent().name);
                            player.chooseCard(name + '的判定结果为' + get.translation(trigger.player.judging[0]) + '，是否打出一张手牌进行“改命”？', 'hs',
                            function(card) {
                                var player = _status.event.player;
                                var mod2 = game.checkMod(card, player, 'unchanged', 'cardEnabled2', player);
                                if (mod2 != 'unchanged') return mod2;
                                var mod = game.checkMod(card, player, 'unchanged', 'cardRespondable', player);
                                if (mod != 'unchanged') return mod;
                                return true;
                            }).set('ai',
                            function(card) {
                                return - 1;
                            });
                            "step 1";
                            if (result.bool) {
                                player.respond(result.cards, 'highlight', 'ssr_zhangsan'
                                /*trigger.getParent().name*/
                                , 'noOrdering');
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            "step 2";
                            if (result.bool) {
                                if (trigger.player.judging[0].clone) {
                                    trigger.player.judging[0].clone.classList.remove('thrownhighlight');
                                    game.broadcast(function(card) {
                                        if (card.clone) {
                                            card.clone.classList.remove('thrownhighlight');
                                        }
                                    },
                                    trigger.player.judging[0]);
                                    game.addVideo('deletenode', player, get.cardsInfo([trigger.player.judging[0].clone]));
                                }
                                /*game.cardsDiscard(trigger.player.judging[0]);
					            trigger.player.judging[0]=result.cards[0];
					            trigger.orderingCards.addArray(result.cards);*/
                                player.$gain2(trigger.player.judging[0]);
                                player.gain(trigger.player.judging[0]);
                                trigger.player.judging[0] = result.cards[0];
                                trigger.orderingCards.addArray(result.cards);
                                game.log(trigger.player, '的判定牌改为', result.cards[0]);
                                game.delay(2);
                            }
                        },
                        "_priority": 0,
                    },
                    "ssr_newguidao": {
                        audio: 'guidao',
                        enable: "chooseToUse",
                        filterCard: function(card) {
                            return get.color(card) == 'black';
                        },
                        filter: function(event, player) {
                            return player.countCards('hes', {
                                color: 'black'
                            })
                        },
                        position: "hes",
                        viewAs: {
                            name: "caomu",
                        },
                        prompt: "将一黑色的牌当【草木皆兵】使用",
                        check: function(card) {
                            return 6 - get.value(card)
                        },
                        ai: {
                            order: 9,
                            basic: {
                                order: 1,
                                useful: 1,
                                value: 4,
                            },
                            result: {
                                player: function(player, target) {
                                    return game.countPlayer(function(current) {
                                        if (get.distance(target, current) <= 1 && current != target) {
                                            var att = get.attitude(player, current);
                                            if (att > 3) {
                                                return 1.1;
                                            } else if (att > 0) {
                                                return 1;
                                            } else if (att < -3) {
                                                return - 1.1;
                                            } else if (att < 0) {
                                                return - 1;
                                            }
                                        }
                                    });
                                },
                                target: function(player, target) {
                                    if (target.hasJudge('bingliang')) return 0;
                                    return - 1.5 / Math.sqrt(target.countCards('h') + 1);
                                },
                            },
                            tag: {
                                skip: "phaseDraw",
                            },
                        },
                        "_priority": 0,
                    },
                    "ssr_tianlei": {
                        audio: "huangtian2",
                        trigger: {
                            global: "phaseZhunbeiBegin",
                            player: "phaseXianjiOver",
                        },
                        //usable:1,
                        priority: 109,
                        filter: function(event, player) {
                            if (_status.currentPhase != player) return player.hasZhuSkill('ssr_zhuji') && _status.currentPhase.group == 'qun' && _status.currentPhase.countCards('he') > 0;
                            return true;
                        },
                        direct: true,
                        unique: true,
                        forced: true,
                        content: function() {
                            "step 0";
                            if (_status.currentPhase != player && trigger.name != 'phaseXianjiOver') {
                                if (get.attitude(_status.currentPhase, player) > 1) {
                                    var check = true;
                                } else {
                                    var check = false;
                                }
                                _status.currentPhase.chooseToDiscard(get.prompt('ssr_zhuji'), 'he', '是否弃置一张牌，然后令' + get.translation(player.name) + '发动一次〖皇天〗？', lib.filter.cardDiscardable).set('ai',
                                function(card) {
                                    if (!_status.event.check) return 0;
                                    return 7 - get.value(card);
                                }).set('check', check).set('logSkill', 'ssr_zhuji').setHiddenSkill('ssr_zhuji');
                            } else {
                                event.goto(2);
                            }
                            "step 1";
                            if (!result.bool) {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            "step 2";
                            player.logSkill('ssr_tianlei');
                            if (!event.twiced) event.twiced = function() {
                                if (!event.times) event.times = 0;
                                event.times++;
                                if (event.times >= 2) return true;
                                return false;
                            };
                            "step 3";
                            //player.draw();
                            if (!player.storage.ssr_tianlei) player.storage.ssr_tianlei = [];
                            var suits = player.storage.ssr_tianlei;
                            player.judge(function(card) {
                                if (suits.contains(get.suit(card))) return - 0.5;
                                return 2;
                            }).judge2 = function(result) {
                                return result.bool;
                            };
                            "step 4";
                            if (!player.storage.ssr_tianlei.contains(result.suit)) {
                                player.storage.ssr_tianlei.push(result.suit);
                                player.syncStorage('ssr_tianlei');
                                player.markSkill('ssr_tianlei');
                            }
                            /*else {
				                {if(event&&event.finish){event.finish();}else {return;}}
				            }*/
                            "step 5";
                            if (player.storage.ssr_tianlei.length < 4) {
                                if (event.twiced()) {
                                    {
                                        if (event && event.finish) {
                                            event.finish();
                                        } else {
                                            return;
                                        }
                                    }
                                } else {
                                    event.goto(3);
                                }
                            }
                            "step 6";
                            player.logSkill('ssr_tianlei_log');
                            player.storage.ssr_tianlei = [];
                            player.unmarkSkill('ssr_tianlei');
                            player.chooseTarget('是否对一名角色造成三点雷电伤害？').setHiddenSkill(event.name).ai = function(target) {
                                return get.damageEffect(target, _status.event.player, _status.event.player, 'thunder');
                            };
                            "step 7";
                            if (result.bool) {
                                event.target = result.targets[0];
                                event.target.damage(3, 'thunder');
                            }
                        },
                        marktext: "震",
                        intro: {
                            name: "震雷祭坛",
                            content: function(storage, player) {
                                return get.translation(storage);
                            },
                            onunmark: function(storage, player) {
                                player.storage.ssr_tianlei = [];
                            },
                        },
                        ai: {
                            threaten: 1.1,
                        },
                        group: ['ssr_tianlei_log'],
                        subSkill: {
                            log: {
                                audio: "tianjie",
                                skillAnimation: true,
                                animationColor: "thunder",
                                sub: true,
                                init: function(player, skill) {
                                    player.storage[skill] = false;
                                },
                            },
                        },
                    },
                    "ssr_guifu": {
                        audio: 'zhoufu',
                        enable: "phaseUse",
                        usable: 2,
                        position: "h",
                        filter: function(event, player) {
                            return player.countCards('h') > 0;
                        },
                        filterCard: true,
                        filterTarget: function(card, player, target) {
                            return target != player && !target.hasSkill('ssr_guifu_zhou') && !target.hasSkill('ssr_guifu');
                        },
                        check: function(card) {
                            return 9 - get.value(card);
                        },
                        discard: false,
                        toStorage: true,
                        prepare: "give2",
                        content: function() {
                            if (!target.storage.ssr_guifu_zhou_markcount) target.storage.ssr_guifu_zhou_markcount = 0;
                            target.markAuto('ssr_guifu_zhou', cards);
                            target.addSkill('ssr_guifu_zhou');
                            target.storage.ssr_guifu_zhou_player = player;
                            var str = '咒缚';
                            game.log(target, '被', player, '贴上了', str);
                        },
                        ai: {
                            order: 1,
                            result: {
                                target: -1,
                            },
                        },
                        subSkill: {
                            use: {
                                audio: "zhoufu",
                                trigger: {
                                    player: "useCard",
                                },
                                forced: true,
                                silent: true,
                                filter: function(event, player) {
                                    if (player.getStorage('ssr_guifu_zhou').length) {
                                        var cards = player.getStorage('ssr_guifu_zhou');
                                        return get.color(event.card) == get.color(cards[0]);
                                    }
                                    return false;
                                },
                                priority: 15,
                                logTarget: "player",
                                content: function() {
                                    "step 0";
                                    player.storage.ssr_guifu_zhouing = true;
                                    event.zhou = player.getStorage('ssr_guifu_zhou')[0];
                                    event.color = get.color(event.zhou);
                                    event.suit = get.suit(event.zhou);
                                    event.type = get.type(event.zhou);
                                    event.number = get.number(event.zhou);
                                    event.him = player.storage.ssr_guifu_zhou_player;
                                    var str = '咒缚';
                                    player.showCards(event.zhou, str);
                                    "step 1";
                                    trigger.targets.length = 0;
                                    trigger.all_excluded = true;
                                    player.link(true);
                                    "step 2";
                                    var str = '失去了咒缚';
                                    game.log(player, str);
                                    player.storage.ssr_guifu_zhou = [];
                                    player.unmarkSkill('ssr_guifu_zhou');
                                    player.removeSkill('ssr_guifu_zhou');
                                    player.storage.ssr_guifu_zhouing = false;
                                },
                            },
                            zhou: {
                                group: ["ssr_guifu_use", "ssr_guifu_die"],
                                audio: "zhoufu",
                                sub: true,
                                mark: true,
                                marktext: "咒",
                                intro: {
                                    name: function(storage, player) {
                                        var str = "咒缚";
                                        return str;
                                    },
                                    mark: function(dialog, content, player) {
                                        var him = player.storage.ssr_guifu_zhou_player;
                                        var content = player.storage.ssr_guifu_zhou;
                                        if (content && content.length) {
                                            if (him == game.me || him.isUnderControl()) {
                                                dialog.addAuto(content);
                                            } else {
                                                return '<li>来自' + get.translation(player.storage.ssr_guifu_zhou_player.name) + '的咒缚';
                                            }
                                        }
                                    },
                                    content: function(content, player) {
                                        var him = player.storage.ssr_guifu_zhou_player;
                                        var content = player.storage.ssr_guifu_zhou;
                                        if (content && content.length) {
                                            if (him == game.me || him.isUnderControl()) {
                                                return get.translation(content);
                                            }
                                            return '<li>来自' + get.translation(him.name) + '的咒缚';
                                        }
                                    },
                                    onunmark: function(storage, player) {
                                        if (storage && storage.length) {
                                            player.$throw(storage, 1000);
                                            game.cardsDiscard(storage);
                                            game.log(storage, '被置入了弃牌堆');
                                            storage.length == 0;
                                        }
                                        delete ssr_guifu_zhou;
                                    },
                                },
                            },
                            die: {
                                trigger: {
                                    player: "die",
                                },
                                priority: 2,
                                silent: true,
                                forced: true,
                                forceDie: true,
                                filter: function(event, player) {
                                    return true;
                                },
                                content: function() {
                                    event.him = player.storage.ssr_guifu_zhou_player;
                                    var str = '咒缚';
                                    if (event.him && event.him.isIn() && !player.storage.ssr_guifu_zhouing) {
                                        var cards = [player.getStorage('ssr_guifu_zhou')[0]];
                                        event.him.gain(cards, player, false);
                                        game.log(str, '回到了', event.him, '的手牌');
                                    } else {
                                        game.log(str, '消失了');
                                    }
                                    player.storage.ssr_guifu_zhou = [];
                                    player.unmarkSkill('ssr_guifu_zhou');
                                    player.removeSkill('ssr_guifu_zhou');
                                },
                            },
                        },
                    },
                    "ssr_dihuo": {
                        audio: "yingbin",
                        trigger: {
                            player: ["phaseZhunbeiBegin", "phaseXianjiOver"],
                        },
                        //usable:1,
                        priority: 108,
                        filter: function(event, player) {
                            return true;
                        },
                        unique: true,
                        forced: true,
                        content: function() {
                            "step 0";
                            if (!event.twiced) event.twiced = function() {
                                if (!event.times) event.times = 0;
                                event.times++;
                                if (event.times >= 2) return true;
                                return false;
                            };
                            if (!player.storage.ssr_dihuo) player.storage.ssr_dihuo = [];
                            var suits = player.storage.ssr_dihuo;
                            player.judge(function(card) {
                                var type = get.type(card);
                                if (get.type(card) == 'delay') type = 'trick';
                                if (suits.contains(get.type(card))) return - 0.5;
                                return 2;
                            }).judge2 = function(result) {
                                return result.bool;
                            };
                            "step 1";
                            var type = get.type(result.card);
                            if (get.type(result.card) == 'delay') type = 'trick';
                            if (!player.storage.ssr_dihuo.contains(type)) {
                                player.storage.ssr_dihuo.push(type);
                                player.syncStorage('ssr_dihuo');
                                player.markSkill('ssr_dihuo');
                            }
                            /*else {
				                {if(event&&event.finish){event.finish();}else {return;}}
				            }*/
                            "step 2";
                            if (player.storage.ssr_dihuo.length < 3) {
                                if (event.twiced()) {
                                    {
                                        if (event && event.finish) {
                                            event.finish();
                                        } else {
                                            return;
                                        }
                                    }
                                } else {
                                    event.goto(0);
                                }
                            }
                            "step 3";
                            player.logSkill('ssr_dihuo_log');
                            player.storage.ssr_dihuo = [];
                            player.unmarkSkill('ssr_dihuo');
                            player.chooseTarget('是否对一名已横置角色造成两点火焰伤害？').set('filterTarget',
                            function(card, player, target) {
                                if (target == player) return false;
                                return target.isLinked();
                            }).setHiddenSkill(event.name).ai = function(target) {
                                return get.damageEffect(target, _status.event.player, _status.event.player, 'fire');
                            };
                            "step 4";
                            if (result.bool) {
                                event.target = result.targets[0];
                                event.target.damage(2, 'fire');
                            }
                        },
                        marktext: "离",
                        intro: {
                            name: "离火祭坛",
                            content: function(storage, player) {
                                return get.translation(storage);
                            },
                            onunmark: function(storage, player) {
                                player.storage.ssr_dihuo = [];
                            },
                        },
                        ai: {
                            threaten: 1.1,
                        },
                        group: ['ssr_dihuo_log'],
                        subSkill: {
                            log: {
                                audio: "tianjie",
                                skillAnimation: true,
                                animationColor: "fire",
                                sub: true,
                                init: function(player, skill) {
                                    player.storage[skill] = false;
                                },
                            },
                        },
                    },
                    "ssr_renhong": {
                        audio: "xinfu_fangtong",
                        trigger: {
                            player: ["phaseZhunbeiBegin", "phaseXianjiOver"],
                        },
                        //usable:1,
                        priority: 107,
                        filter: function(event, player) {
                            return true;
                        },
                        unique: true,
                        forced: true,
                        content: function() {
                            "step 0";
                            if (!event.twiced) event.twiced = function() {
                                if (!event.times) event.times = 0;
                                event.times++;
                                if (event.times >= 2) return true;
                                return false;
                            };
                            player.judge(function(card) {
                                return get.number(card);
                            }).judge2 = function(result) {
                                return result.bool;
                            };
                            "step 1";
                            player.addMark('ssr_renhong', result.number);
                            player.syncStorage('ssr_renhong');
                            player.markSkill('ssr_renhong');
                            "step 2";
                            if (player.countMark('ssr_renhong') < 36) {
                                if (event.twiced()) {
                                    {
                                        if (event && event.finish) {
                                            event.finish();
                                        } else {
                                            return;
                                        }
                                    }
                                } else {
                                    event.goto(0);
                                }
                            }
                            "step 3";
                            player.logSkill('ssr_renhong_log');
                            player.removeMark('ssr_renhong', 36);
                            player.unmarkSkill('ssr_renhong');
                            player.chooseTarget('是否令至多两名其他角色随机弃置两张牌？', [1, 2]).set('filterTarget',
                            function(card, player, target) {
                                if (target == player) return false;
                                return target.countCards('he') > 0;
                            }).setHiddenSkill(event.name).ai = function(target) {
                                if (get.attitude(player, target) > 0) return - 1;
                                return Math.max(10 - target.countCards('he'), 0.5);
                            };
                            "step 4";
                            if (result.bool) {
                                var targets = result.targets;
                                for (var i = 0; i < targets.length; i++) {
                                    targets[i].discard(targets[i].getCards('he').randomGets(2));
                                }
                            }
                        },
                        marktext: "坎",
                        intro: {
                            name: "坎水祭坛",
                            content: "mark",
                            onunmark: function(storage, player) {
                                player.storage.ssr_renhong = 0;
                            },
                        },
                        ai: {
                            threaten: 1.1,
                        },
                        group: ['ssr_renhong_log'],
                        subSkill: {
                            log: {
                                audio: "tianjie",
                                skillAnimation: true,
                                animationColor: "water",
                                sub: true,
                                init: function(player, skill) {
                                    player.storage[skill] = false;
                                },
                            },
                        },
                    },
                    "ssr_fangtong": {
                        usable: 1,
                        audio: "xinfu_jijun",
                        enable: "phaseUse",
                        filterCard: function(card) {
                            return true;
                        },
                        selectCard: function() {
                            return 1;
                        },
                        discard: false,
                        lose: false,
                        filter: function(event, player) {
                            return player.countCards('h') > 0;
                        },
                        filterTarget: function(card, player, target) {
                            if (player == target) return false;
                            return true;
                            //return target.countCards('h');
                        },
                        content: function() {
                            "step 0";
                            player.showCards(cards, '统领方队');
                            "step 1";
                            target.chooseCard('h',
                            function(card, player) {
                                return get.number(card) <= get.number(cards[0]);
                            },
                            '方统：请展示一张点数不大于' + get.translation(cards[0]) + '的手牌，否则受到一点伤害').set('ai',
                            function(card) {
                                var player = _status.event.player;
                                if (get.damageEffect(target, player, player) >= 0) return - 1;
                                return 99 - get.value(card);
                            });
                            'step 2';
                            if (result.bool) {
                                target.showCards(result.cards);
                            } else {
                                target.damage();
                                player.discard(cards);
                            }
                        },
                        check: function(card) {
                            return 99 - get.number(card);
                        },
                        position: "h",
                        ai: {
                            order: 13,
                            result: {
                                target: function(player, target) {
                                    return get.damageEffect(target, player, target);
                                },
                            },
                            threaten: 1.2,
                        },
                    },
                    "ssr_huangtian": {
                        derivation: ['ssr_guidao_thunder'],
                        audio: "huangtian2",
                        trigger: {
                            global: "phaseZhunbeiBegin",
                        },
                        usable: 1,
                        priority: 109,
                        filter: function(event, player) {
                            if (player.storage.ssr_huangtian_break) return false;
                            if (_status.currentPhase != player) return player.hasZhuSkill('ssr_zhuji') && _status.currentPhase.group == 'qun' && _status.currentPhase.countCards('he') > 0;
                            return true;
                        },
                        direct: true,
                        unique: true,
                        forced: true,
                        content: function() {
                            "step 0";
                            if (_status.currentPhase != player) {
                                if (get.attitude(_status.currentPhase, player) > 1) {
                                    var check = true;
                                } else {
                                    var check = false;
                                }
                                _status.currentPhase.chooseToDiscard(get.prompt('ssr_zhuji'), 'he', '是否弃置一张牌，然后令' + get.translation(player.name) + '发动一次〖皇天〗？', lib.filter.cardDiscardable).set('ai',
                                function(card) {
                                    if (!_status.event.check) return 0;
                                    return 7 - get.value(card);
                                }).set('check', check).set('logSkill', 'ssr_zhuji').setHiddenSkill('ssr_zhuji');
                            } else {
                                event.goto(2);
                            }
                            "step 1";
                            if (!result.bool) {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            "step 2";
                            player.logSkill('ssr_huangtian');
                            //player.draw();
                            if (!player.storage.ssr_huangtian) player.storage.ssr_huangtian = [];
                            var suits = player.storage.ssr_huangtian;
                            player.judge(function(card) {
                                if (suits.contains(get.suit(card))) return - 0.5;
                                return 2;
                            }).judge2 = function(result) {
                                return result.bool;
                            };
                            "step 3";
                            if (!player.storage.ssr_huangtian.contains(result.suit)) {
                                player.storage.ssr_huangtian.push(result.suit);
                                player.syncStorage('ssr_huangtian');
                                player.markSkill('ssr_huangtian');
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            "step 4";
                            if (player.storage.ssr_huangtian.length < 4) {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            "step 5";
                            player.recover(2);
                            player.logSkill('ssr_huangtian_log');
                            player.addJudge(game.createCard('shandian'));
                            player.addSkill('ssr_huangtian_thunder');
                            player.storage.ssr_huangtian_break = true;
                            player.unmarkSkill('ssr_huangtian');
                        },
                        marktext: "震",
                        intro: {
                            name: "震雷祭坛",
                            content: function(storage, player) {
                                return get.translation(storage);
                            },
                            onunmark: function(storage, player) {
                                player.storage.ssr_huangtian = [];
                            },
                        },
                        ai: {
                            threaten: 1.1,
                        },
                        group: ['ssr_huangtian_log', 'ssr_huangtian_damage'],
                        subSkill: {
                            log: {
                                juexingji: true,
                                skillAnimation: true,
                                animationColor: "thunder",
                                sub: true,
                                init: function(player, skill) {
                                    player.storage[skill] = false;
                                },
                            },
                            thunder: {
                                sub: true,
                                mark: true,
                                marktext: "惊雷",
                                intro: {
                                    name: "震雷祭坛",
                                    content: "〖鬼道〗已获得惊雷效果：“咒”的①时机改为进行【闪电】判定时；“咒”的②效果改为，当武将牌上有“咒”的角色使用与“咒”相同花色的牌时，其技能被封印直到回合结束并受到两点雷属性伤害，结算完成后其失去此“咒”。",
                                },
                            },
                            damage: {
                                sub: true,
                                trigger: {
                                    player: "damageBegin4",
                                    target: "useCardToTargeted",
                                },
                                filter: function(event) {
                                    if (!event.card) return false;
                                    if (event.card.nature && event.card.nature == 'thunder') return true;
                                    if (event.card.name) {
                                        return get.translation(event.card.name).indexOf("雷") != -1 || get.translation(event.card.name).indexOf("电") != -1;
                                    }
                                    return true;
                                },
                                priority: 444,
                                forced: true,
                                content: function() {
                                    if (trigger.name == 'damage') {
                                        trigger.cancel();
                                    } else {
                                        trigger.getParent().excluded.push(player);
                                        //trigger.excluded.addArray(player);
                                    }
                                    //trigger.excluded.addArray(player);
                                },
                                ai: {
                                    nothunder: true,
                                    effect: {
                                        target: function(card, player, target, current) {
                                            if (get.tag(card, 'fireDamage')) return 'zerotarget';
                                        },
                                    },
                                },
                            },
                        },
                    },
                    "ssr_houtu": {
                        derivation: ['ssr_guidao_fire'],
                        audio: "yingbin",
                        trigger: {
                            player: "phaseZhunbeiBegin",
                        },
                        usable: 1,
                        priority: 108,
                        filter: function(event, player) {
                            return ! player.storage.ssr_houtu_break;
                            //return event.player.countCards('j',{name:'shandian'})<1;
                        },
                        unique: true,
                        forced: true,
                        content: function() {
                            "step 0";
                            //player.draw();
                            if (!player.storage.ssr_houtu) player.storage.ssr_houtu = [];
                            var suits = player.storage.ssr_houtu;
                            player.judge(function(card) {
                                var type = get.type(card);
                                if (get.type(card) == 'delay') type = 'trick';
                                if (suits.contains(get.type(card))) return - 0.5;
                                return 2;
                            }).judge2 = function(result) {
                                return result.bool;
                            };
                            "step 1";
                            var type = get.type(result.card);
                            if (get.type(result.card) == 'delay') type = 'trick';
                            if (!player.storage.ssr_houtu.contains(type)) {
                                player.storage.ssr_houtu.push(type);
                                player.syncStorage('ssr_houtu');
                                player.markSkill('ssr_houtu');
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            "step 2";
                            if (player.storage.ssr_houtu.length < 3) {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            "step 3";
                            player.recover(2);
                            player.logSkill('ssr_houtu_log');
                            player.addJudge(game.createCard('huoshan'));
                            player.addSkill('ssr_houtu_fire');
                            player.storage.ssr_houtu_break = true;
                            player.unmarkSkill('ssr_houtu');
                        },
                        marktext: "离",
                        intro: {
                            name: "离火祭坛",
                            content: function(storage, player) {
                                return get.translation(storage);
                            },
                            onunmark: function(storage, player) {
                                player.storage.ssr_houtu = [];
                            },
                        },
                        ai: {
                            threaten: 1.1,
                        },
                        group: ['ssr_houtu_log', 'ssr_houtu_damage'],
                        subSkill: {
                            log: {
                                juexingji: true,
                                skillAnimation: true,
                                animationColor: "fire",
                                sub: true,
                                init: function(player, skill) {
                                    player.storage[skill] = false;
                                },
                            },
                            fire: {
                                sub: true,
                                mark: true,
                                marktext: "烈火",
                                intro: {
                                    name: "离火祭坛",
                                    content: "〖鬼道〗已获得烈火效果：“咒”的①时机改为进行【火山】判定时；“咒”的②效果改为，当武将牌上有“咒”的角色使用与“咒”相同类别的牌时，其需交给施咒者一张与“咒”类别相同的牌，否则其受到一点火属性伤害，之后本回合内其不能使用或打出任何的牌，结算完成后其失去此“咒”。",
                                },
                            },
                            damage: {
                                sub: true,
                                trigger: {
                                    player: "damageBegin4",
                                    target: "useCardToTargeted",
                                },
                                filter: function(event) {
                                    if (!event.card) return false;
                                    if (event.card.nature && event.card.nature == 'fire') return true;
                                    if (event.card.name) {
                                        return get.translation(event.card.name).indexOf("火") != -1;
                                    }
                                    return true;
                                },
                                priority: 444,
                                forced: true,
                                content: function() {
                                    if (trigger.name == 'damage') {
                                        trigger.cancel();
                                    } else {
                                        trigger.getParent().excluded.push(player);
                                        //trigger.excluded.addArray(player);
                                    }
                                    //trigger.excluded.addArray(player);
                                },
                                ai: {
                                    nofire: true,
                                    effect: {
                                        target: function(card, player, target, current) {
                                            if (get.tag(card, 'fireDamage')) return 'zerotarget';
                                        },
                                    },
                                },
                            },
                        },
                    },
                    "ssr_cangsheng": {
                        derivation: ['ssr_guidao_ice'],
                        audio: "fangtong",
                        trigger: {
                            player: "phaseZhunbeiBegin",
                        },
                        usable: 1,
                        priority: 107,
                        filter: function(event, player) {
                            return ! player.storage.ssr_cangsheng_break;
                            //return event.player.countCards('j',{name:'shandian'})<1;
                        },
                        unique: true,
                        forced: true,
                        content: function() {
                            "step 0";
                            //player.draw();
                            player.judge(function(card) {
                                return get.number(card);
                            }).judge2 = function(result) {
                                return result.bool;
                            };
                            "step 1";
                            player.addMark('ssr_cangsheng', result.number);
                            player.syncStorage('ssr_cangsheng');
                            player.markSkill('ssr_cangsheng');
                            "step 2";
                            if (player.countMark('ssr_cangsheng') < 36) {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            "step 3";
                            player.recover(2);
                            player.logSkill('ssr_cangsheng_log');
                            player.addJudge(game.createCard('hongshui'));
                            player.addSkill('ssr_cangsheng_water');
                            player.storage.ssr_cangsheng_break = true;
                            player.unmarkSkill('ssr_cangsheng');
                        },
                        marktext: "坎",
                        intro: {
                            name: "坎水祭坛",
                            content: "mark",
                            onunmark: function(storage, player) {
                                player.storage.ssr_cangsheng = [];
                            },
                        },
                        ai: {
                            threaten: 1.1,
                        },
                        group: ['ssr_cangsheng_log', 'ssr_cangsheng_damage'],
                        subSkill: {
                            log: {
                                juexingji: true,
                                skillAnimation: true,
                                animationColor: "water",
                                sub: true,
                                init: function(player, skill) {
                                    player.storage[skill] = false;
                                },
                            },
                            water: {
                                sub: true,
                                mark: true,
                                marktext: "寒冰",
                                intro: {
                                    name: "坎水祭坛",
                                    content: "〖鬼道〗已获得寒冰效果：“咒”的①时机改为进行【洪水】判定时；“咒”的②效果改为，当武将牌上有“咒”的角色使用一张牌时，其需弃置与点数总和不小于“咒”的手牌，否则此牌无效，该角色翻至背面，结算完成后若本回合为该角色的回合，其立即结束回合并失去此“咒”。",
                                },
                            },
                            damage: {
                                sub: true,
                                trigger: {
                                    player: ["damageBegin4", "loseHpBegin"],
                                    target: "useCardToTargeted",
                                },
                                filter: function(event) {
                                    if (!event.card) return false;
                                    if (event.card.nature && event.card.nature == 'ice') return true;
                                    if (event.name == 'loseHp') return true;
                                    if (event.card.name) {
                                        return get.translation(event.card.name).indexOf("水") != -1 || get.translation(event.card.name).indexOf("河") != -1;
                                    }
                                    return true;
                                },
                                priority: 444,
                                forced: true,
                                content: function() {
                                    if (trigger.name == 'damage' || trigger.name == 'loseHp') {
                                        trigger.cancel();
                                    } else {
                                        trigger.getParent().excluded.push(player);
                                        //trigger.excluded.addArray(player);
                                    }
                                    //trigger.excluded.addArray(player);
                                },
                                ai: {
                                    noice: true,
                                    effect: {
                                        target: function(card, player, target, current) {
                                            if (get.tag(card, 'fireDamage')) return 'zerotarget';
                                        },
                                    },
                                },
                            },
                        },
                    },
                    "ssr_zhuhai": {
                        audio: 'zhuhai',
                        trigger: {
                            global: "phaseJieshuBegin",
                        },
                        direct: true,
                        filter: function(event, player) {
                            return player != event.player && event.player.getHistory('sourceDamage').length > 0 && event.player.isIn() && player.countCards('h') > 0;
                        },
                        content: function() {
                            'step 0';
                            player.chooseCard('h',
                            function(card, player) {
                                if (!game.checkMod(card, player, 'unchanged', 'cardEnabled2', player)) return false;
                                return player.canUse(get.autoViewAs({
                                    name: 'sha'
                                },
                                'h'), _status.event.getTrigger().player, false);
                            },
                            get.prompt2('ssr_zhuhai'), '诛害：选择一张手牌当做【杀】对' + get.translation(trigger.player) + '使用').set('ai',
                            function(card) {
                                var player = _status.event.player;
                                return get.effect(_status.event.getTrigger().player, get.autoViewAs({
                                    name: 'sha'
                                },
                                'h'), player, player) / Math.max(1, get.value(card));
                            });
                            'step 1';
                            if (result.bool) {
                                player.useCard({
                                    name: 'sha'
                                },
                                result.cards, 'rezhuhai', trigger.player, false);
                            }
                        },
                    },
                    "ssr_yijian": {
                        derivation: ['ssr_wuyan', 'ssr_wolong'],
                        subSkill: {
                            log: {
                                limited: true,
                                skillAnimation: true,
                                animationColor: "green",
                                sub: true,
                            },
                            mark: {
                                mark: true,
                                marktext: '遗荐',
                                intro: {
                                    content: '已发动',
                                },
                            },
                        },
                        trigger: {
                            target: "useCardToTargeted",
                        },
                        filter: function(event, player) {
                            if (player.storage.ssr_yijian_limited) return false;
                            //if(event.targets&&event.targets.length>1) return false;
                            if (event.card && event.player != player) return (get.type(event.card) == 'trick' || get.type(event.card) == 'delay');
                        },
                        init: function(player) {
                            player.storage.ssr_yijian_limited = false;
                        },
                        forced: true,
                        audio: 'jianyan',
                        priority: 2,
                        content: function() {
                            'step 0';
                            player.addMark('ssr_yijian');
                            player.draw();
                            'step 1';
                            if (player.countMark('ssr_yijian') > 2) {
                                trigger.cancel();
                                player.logSkill('ssr_yijian_log');
                                player.awakenSkill('ssr_yijian');
                                player.loseMaxHp();
                                player.addSkill('ssr_wuyan');
                                player.addSkill('ssr_yijian_mark');
                                player.storage.ssr_yijian_limited = true;
                                player.chooseTarget('是否令一名其他角色获得技能〖卧龙〗？', 1,
                                function(card, player, target) {
                                    return player != target;
                                },
                                function(target) {
                                    return get.attitude(player, target) - 1;
                                });
                            } else {
                                {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            'step 2';
                            player.removeMark('ssr_yijian', player.countMark('ssr_yijian'));
                            if (result.bool) {
                                var target = result.targets[0];
                                player.line(target);
                                target.addSkill('ssr_wolong');
                            }
                        },
                        marktext: "言",
                        intro: {
                            name: "荐言",
                            content: "mark",
                        },
                        ai: {
                            effect: {
                                target: function(card, player, target, current) {
                                    if ((get.type(card) == 'trick' || get.type(card) == 'delay') && player != target && target.countMark('ssr_yijian') >= 2) return 'zeroplayertarget';
                                },
                            },
                        },
                    },
                    "ssr_wuyan": {
                        audio: "wuyan",
                        trigger: {
                            target: "useCardToBefore",
                            player: "useCardToBefore",
                        },
                        forced: true,
                        priority: 25,
                        check: function(event, player) {
                            return get.effect(event.target, event.card, event.player, player) < 0;
                        },
                        filter: function(event, player) {
                            if (!event.target) return false;
                            if (event.player == player && event.target == player) return false;
                            return (get.type(event.card) == 'trick' || get.type(event.card) == 'delay');
                        },
                        content: function() {
                            trigger.cancel();
                        },
                        ai: {
                            effect: {
                                target: function(card, player, target, current) {
                                    if ((get.type(card) == 'trick' || get.type(card) == 'delay') && player != target) return 'zeroplayertarget';
                                },
                                player: function(card, player, target, current) {
                                    if ((get.type(card) == 'trick' || get.type(card) == 'delay') && player != target) return 'zeroplayertarget';
                                },
                            },
                        },
                    },
                    "ssr_wolong": {
                        derivation: ['huoji', 'kanpo'],
                        mark: true,
                        locked: true,
                        zhuanhuanji: true,
                        marktext: "☯",
                        intro: {
                            content: function(storage, player, skill) {
                                if (player.storage.ssr_wolong == true) return '阴·看破：你可以将你的任意一张黑色手牌当做【无懈可击】使用。';
                                return '阳·火计：出牌阶段，你可以将你的任意一张红色手牌当作【火攻】使用。';
                            },
                        },
                        priority: 56,
                        audio: 'cangzhuo',
                        trigger: {
                            player: "phaseZhunbeiBegin",
                        },
                        forced: true,
                        content: function() {
                            'step 0';
                            if (player.hasSkill('huoji')) player.removeSkill('huoji');
                            if (player.hasSkill('kanpo')) player.removeSkill('kanpo');
                            player.changeZhuanhuanji('ssr_wolong');
                            player.draw();
                            /*if(player.storage.ssr_wolong!=true){
				                player.loseMaxHp();
				            }
				            else{
				                player.loseHp();
				            }*/
                            'step 1';
                            if (player.storage.ssr_wolong != true) {
                                player.addSkill('huoji');
                            } else {
                                player.addSkill('kanpo');
                            };
                        },
                        ai: {
                            fireAttack: true,
                            halfneg: true,
                            threaten: 1.05,
                        },
                    },
                    // ---------------------------------------标包技能------------------------------------------//
                },
                translate: {
                    hpunshow: "战危",
                    "hpunshow_info": "",
                    thunderunshow: "闪电",
                    "thunderunshow_info": "",
                    huoshanunshow: "火山",
                    "huoshanunshow_info": "",
                    hongshuiunshow: "洪水",
                    "hongshuiunshow_info": "",
                    fuleiunshow: "浮雷",
                    "fuleiunshow_info": "",
                    norecover: "京城",
                    "norecover_info": "",
                    jingcheng: "京城",
                    "jingcheng_info": "",
                    nopha: "京城",
                    "nopha_info": "",
                    nodraw: "京城",
                    "nodraw_info": "",
                    nodam: "京城",
                    "nodam_info": "",
                    protecting: "京城",
                    "protecting_info": "",
                    shanres: "京城",
                    "shanres_info": "",
                    qunxiongkill: "霸主",
                    "qunxiongkill_info": "",
                    bakill: "霸主",
                    "bakill_info": "",
                    batime: "霸主",
                    "batime_info": "",
                    guanfu: "官府",
                    "guanfu_info": "",
                    hellfire: "官府",
                    "hellfire_info": "",
                    "zuan_guanbing": "官兵",
                    "zuan_guanbing_info": "",
                    "zuan_panjun": "叛军",
                    "zuan_panjun_info": "",
                    unre: "官府",
                    "unre_info": "",
                    firedam: "官府",
                    "firedam_info": "",
                    "firedam2": "官府",
                    "firedam2_info": "",
                    turnoverfalse: "京城",
                    "turnoverfalse_info": "",
                    notarget: "官府",
                    "notarget_info": "",
                    "guifu_fire": "鬼符",
                    "guifu_fire_info": "",
                    "guifu_dam": "鬼符",
                    "guifu_dam_info": "",
                    "guifu_nei": "鬼符",
                    "guifu_nei_info": "",
                    "renxin_dam": "人心",
                    "renxin_dam_info": "",
                    "renxin_add": "人心",
                    "renxin_add_info": "",
                    "renxin_draw": "人心",
                    "renxin_draw_info": "",
                    maxlevel: "号令",
                    "maxlevel_info": "",
                    levelcard: "号令",
                    "levelcard_info": "",
                    canghaizhu: "沧海",
                    "canghaizhu_info": "",
                    huanhai: "幻海",
                    "huanhai_info": "",
                    huanhaicls: "幻海",
                    "huanhaicls_info": "",
                    qiyue: "契约",
                    "qiyue_info": "",
                    jianghun: "将魂",
                    "jianghun_info": "",
                    hunskill: "将魂",
                    "hunskill_info": "",
                    jianghuncold: "将魂",
                    "jianghuncold_info": "",
                    revivehun: "重生",
                    "revivehun_info": "",
                    jiwuskill: "极武",
                    "jiwuskill_info": "",
                    taoluo: "桃铸",
                    "taoluo_info": "",
                    dis: "京城",
                    "dis_info": "",
                    nolink: "京城",
                    "nolink_info": "",
                    plusdistance: "号令",
                    "plusdistance_info": "",
                    "ansha_nei": "暗杀",
                    "ansha_nei_info": "",
                    "ansha_zhong": "暗杀",
                    "ansha_zhong_info": "",
                    qunxiongdraw: "霸主",
                    "qunxiongdraw_info": "",
                    qunxiongdis: "霸主",
                    "qunxiongdis_info": "",
                    qunxiongsha: "霸主",
                    "qunxiongsha_info": "",
                    anyezhu: "暗夜",
                    "anyezhu_info": "",
                    "zuan_hudun": "元气",
                    "zuan_hudun_info": "",
                    "yuanqi_landun_detect": "免伤",
                    "yuanqi_landun": "蓝盾",
                    "yuanqi_landun_info": "你的护盾消失后，你免疫多余的伤害，并且直到下回合开始，你免疫一次伤害。",
                    "yuanqi_huodun": "火盾",
                    "yuanqi_huodun_info": "每回合限一次，当你即将受到火属性的伤害时，你令此伤害减一。",
                    "yuanqi_dudun": "毒盾",
                    "yuanqi_dudun_info": "每回合限两次，当你即将受【毒】影响或流失体力时，你减少一点造成的体力流失。",
                    "yuanqi_cidun": "刺盾",
                    "yuanqi_cidun_info": "当受到与你距离不大于一的角色除【杀】或【决斗】外造成，或没有来源的伤害时，你防止此伤害。",
                    "yuanqi_xuedun": "血盾",
                    "yuanqi_xuedun_info": "你获得一点体力上限，并回复一点体力。（当你失去此天赋时，你减少一点体力上限）",
                    "yuanqi_hudun": "护盾",
                    "yuanqi_hudun_info": "你获得一点护盾上限，并恢复一点护盾。（当你失去此天赋时，你减少一点护盾上限）",
                    "yuanqi_suidun": "碎盾",
                    "yuanqi_suidun_info": "当你的护盾受到攻击后，伤害来源弃一张牌，本回合内你不能再受到伤害。",
                    "yuanqi_zishou": "紫手",
                    "yuanqi_zishou_info": "当一名其他角色使用【杀】指定你为目标时，其需弃置一张手牌，否则此【杀】对你无效。",
                    "yuanqi_yaoshui": "药水",
                    "yuanqi_yaoshui_info": "当你对濒死的角色使用【桃】恢复体力时，你令此【桃】能额外回复一点体力。",
                    "yuanqi_xilan": "吸蓝",
                    "yuanqi_xilan_info": "每回合限两次，当有一名其他角色进入濒死状态时，你摸一张牌。",
                    "yuanqi_xixue": "吸血",
                    "yuanqi_xixue_info": "每当你造成一点伤害后，你可进行一次判定：若为红色非锦囊，你回复一点体力。",
                    "yuanqi_xuli": "蓄力",
                    "yuanqi_xuli_info": "回合结束阶段，若你于本回合的出牌阶段内没有过使用或打出过【杀】，则你摸一张牌。",
                    "yuanqi_xiandan": "霰弹",
                    "yuanqi_xiandan_info": "当你使用一张【杀】指定一名角色作为目标后，你可为此【杀】额外指定一个目标。",
                    "yuanqi_miaozhun": "瞄准",
                    "yuanqi_miaozhun_info": "每当你使用【杀】指定目标后，你进行判定：若为黑色非锦囊，则此【杀】不可被闪避。",
                    "yuanqi_jiguang": "激光",
                    "yuanqi_jiguang_info": "当你即将使用【杀】或【决斗】造成伤害时，你令此伤害变为雷属性并令目标弃一张牌。",
                    "yuanqi_fanshe": "折射",
                    "yuanqi_fanshe_info": "每回合限一次，当你的【杀】被闪避后，你可为此【杀】指定另一个目标。",
                    "yuanqi_yuansu": "元素",
                    "yuanqi_yuansu_info": "当你即将造成属性伤害时，你令此伤害加一。（冷却时间：2轮）",
                    "yuanqi_chuantou": "穿透",
                    "yuanqi_chuantou_info": "你无视场上所有其他角色的防具，所有其他角色的防具对你无法产生效果。",
                    "yuanqi_fangyu": "防御",
                    "yuanqi_fangyu_info": "你最多只能受到一点伤害，你最多只能流失一点体力。",
                    "yuanqi_xiudun": "修盾",
                    "yuanqi_xiudun_info": "你的回合开始时，你恢复护盾可以不受到恢复的条件限制。（冷却时间：2轮）",
                    "zuan_gaindun": "天赋",
                    "zuan_gaindun_info": "",
                    "yuanqi_xuanze": "选择",
                    "yuanqi_xuanze_info": "你可以提前选一次天赋，当你在选择天赋的过程中，你可额外增加两个可选择的选项。",
                    "yuanqi_yiwang": "遗忘",
                    "yuanqi_yiwang_info": "你选择遗忘并且删除一个天赋，你的下个回合开始时你可重新选择一次天赋。",
                    "yuanqi_shangdian": "商店",
                    "yuanqi_shangdian_info": "你的摸牌阶段开始时进行一次判定：若为基本牌，则你令摸牌数增加一。",
                    "yuanqi_bingdun": "冰盾",
                    "yuanqi_bingdun_info": "你的武将牌始终正面向上，你移除你的判定区。（失去此天赋后你恢复判定区）",
                    "yuanqi_jinzhan": "近战",
                    "yuanqi_jinzhan_info": "当你与其他角色计算距离时，你令你与该角色计算的距离减少一。",
                    "yuanqi_lengque": "冷却",
                    "yuanqi_lengque_info": "每回合更新一次，你将你原武将牌上除限定技、觉醒技和主公技以外的随机一个技能克隆。",
                    "yuanqi_nengliang": "能量",
                    "yuanqi_nengliang_info": "你的弃牌阶段时，你的手牌上限始终视为增加两张。",
                    "yuanqi_suji": "速击",
                    "yuanqi_suji_info": "你的出牌阶段内，你可使用【杀】的次数上限加一。",
                    "yuanqi_leidun": "雷盾",
                    "yuanqi_leidun_info": "每回合限一次，当你即将受到雷属性的伤害时，你令此伤害减一。",
                    "yuanqi_zhenshang": "真伤",
                    "yuanqi_zhenshang_info": "你即将造成伤害时，你令你造成的伤害无视伤害目标的护盾。",
                    "firedam3": "官府",
                    "firedam3_info": "",
                    "yuanqi_diaoxiang": "雕像",
                    "yuanqi_diaoxiang_info": "你随机展示四个未拥有的限定技，然后选择获得其中一个。",
                    "yuanqi_diaoxiang2": "雕像",
                    "yuanqi_diaoxiang2_info": "你可以将手牌交给拥有〖雕像〗天赋的角色。",
                    "yuanqi_taoyi": "逃逸",
                    "yuanqi_taoyi_info": "当你没有护盾，与其他角色计算距离时，你令该角色与你计算的距离增加一。",
                    "yuanqi_fantan": "反弹",
                    "yuanqi_fantan_info": "当你使用【闪】闪避了一名角色对你使用的【杀】后，你视为对其使用此【杀】。",
                    "yuanqi_xuexiang": "血箱",
                    "yuanqi_xuexiang_info": "当你的手牌或装备牌中存在红桃牌时，你可以将其当做【桃】使用。",
                    "yuanqi_qianghua": "强化",
                    "yuanqi_qianghua_info": "你可以强化一次装备区的标准/军争/SP包防具，当你失去强化的防具时，你将其重置并重新装备。（冷却时间：3轮）",
                    "yuanqi_shuangwu": "双武",
                    "yuanqi_shuangwu_info": "当你失去装备区的武器牌时，你保留该武器的技能直到你失去下一张武器牌。",
                    "yuanqi_chongwu": "宠物",
                    "yuanqi_chongwu_info": "你装备区内的坐骑牌不能够被弃置，当你即将受到伤害时，你区域内的坐骑牌会替你抵挡等量的伤害。",
                    "yuanqi_guidun": "归盾",
                    "yuanqi_guidun_info": "当你的护盾受到伤害后，你获得等伤害的量的牌。",
                    "yuanqi_shixue": "嗜血",
                    "yuanqi_shixue_info": "当你受到伤害后，直到你的下回合结束，你的【杀】不可被闪避。",
                    "yuanqi_kuangbao": "狂暴",
                    "yuanqi_kuangbao_info": "每当你的【杀】造成一点伤害后，你摸一张牌。",
                    "yuanqi_zhadan": "炸弹",
                    "yuanqi_zhadan_info": "当一名角色死亡时，你可以立即令至多两名其他角色受到随机〇至两点火焰伤害。",
                    "yuanqi_jindun": "金盾",
                    "yuanqi_jindun_info": "你每有两张手牌时，你的护盾上限增加一。（最多增加三点）",
                    "ssr_qianxun": "谦逊",
                    "ssr_qianxun_info": "当其他角色对你使用普通锦囊牌或延时锦囊牌时，若你是此牌的唯一目标，你可以将手牌调整至一张。",
                    "ssr_jueji": "绝计",
                    "ssr_jueji_info": "每回合限三次，当你的手牌数量为一的时候，你可以将此牌当做任意一张基本牌或普通锦囊牌使用或打出并摸一张牌。（你的回合内或者回合外，同名的卡牌各只能使用或打出一次）",
                    "ssr_zhiheng": "制衡",
                    "ssr_zhiheng_info": "出牌阶段，你可以弃置任意张牌，然后选择令一名角色摸等量的牌或弃置等量的牌，该角色可以失去一点体力并拒绝此次摸牌或弃牌。（每名角色限一次）",
                    "ssr_jiuyuan": "救援",
                    "ssr_jiuyuan_info": "主公技，当你成为【杀】的目标时，其他没有“集兵”的吴势力角色可以依次令你摸一张牌，若如此做，该角色获得“集兵”标记：拥有此标记的角色下个回合摸牌阶段摸牌数加一，手牌上限减一。",
                    "ssr_fuzhen": "覆阵",
                    "ssr_fuzhen_info": "锁定技，出牌阶段你使用【杀】的次数+1；当你使用【杀】指定一名角色为目标后，你可以失去一点体力，然后令该角色的非锁定技失效直到回合结束，该角色需弃置一张基本牌才能相应此【杀】。",
                    "ssr_longdan": "龙胆",
                    "ssr_longdan_info": "锁定技，游戏开始时，你获得两枚“龍”标记；你的武将牌上最多可以拥有七枚“龍”标记；每当你使用或打出一张非转换的锦囊牌时，你获得一枚“龍”标记；你的“龍”标记可以当【杀】或【闪】使用或打出。",
                    "ssr_newlongdan": '龙胆',
                    "ssr_newlongdan_info": '每回合限两次，你可以将一张【杀】当做【闪】、【闪】当做【杀】、【酒】当做【桃】、【桃】当做【酒】使用或打出。',
                    "ssr_pozhen": "破阵",
                    "ssr_pozhen_info": "当你因〖龙胆〗使用一张牌后，你可弃置此牌指定的目标的一张牌；当你因〖龙胆〗打出一张牌后，你可以弃置当前回合角色的一张牌。",
                    "ssr_newpozhen": '破阵',
                    "ssr_newpozhen_info": '当你使用使用或打出基本牌时，你根据其性质获得以下标记直到你的下个回合开始：实体牌，战意，锁定技，当你使用【杀】指定或成为【杀】的目标后，你令此牌需要弃置一张基本牌才能响应或生效；转换牌，冲锋，当你使用或打出【杀】或【闪】时，你可以获得对方的一张手牌。（你每有一枚上述标记，你的手牌上限、与其他角色计算距离便减一）',
                    "ssr_tianxing_old": "天星",
                    "ssr_tianxing_info": "你的回合开始时，你可翻开牌堆顶的七张牌，你选择并获得其中一张，然后将剩下的牌按原来顺序放回牌堆顶。",
                    "ssr_tianxing": "天星",
                    "ssr_tianxing_info": "你的回合内，当一名角色进行判定、或你的回合外，当你进行判定时：在判定牌生效前，你可以打出一张牌替换该判定牌。",
                    "ssr_jilei": "祭雷",
                    "ssr_jilei_info": "限定技，准备阶段开始时，若你的判定区内没有【闪电】，则你可以将一张【闪电】置于你的判定区内。",
                    "ssr_kongcheng": "空城",
                    "ssr_kongcheng_info": "锁定技，当你的手牌中没有一种种类的牌时，你不能成为该种类牌的目标。",
                    "ssr_tuxi": "突袭",
                    "ssr_tuxi_info": "陨星技，锁定技，游戏开始时，你获得两枚“袭”标记；当你杀死一名角色后，你获得一枚“袭”标记；摸牌阶段，你可以弃置一枚“袭”标记并获得一名角色的手牌区和装备区的所有牌，然后若其体力值大于你，你视为对其使用一张【调虎离山】。",
                    "ssr_mubing": "募兵",
                    "ssr_mubing_info": "当你受到伤害后，你可以跳过你的下一个弃牌阶段。",
                    "ssr_newmubing": "募兵",
                    "ssr_newmubing_info": "当你于弃牌阶段弃置了至少两张牌，你翻开牌堆顶的三张牌，然后可以选择获得其中数量小于你弃牌数的牌。",
                    "ssr_xuanfeng": "旋风",
                    "ssr_xuanfeng_info": "锁定技，每当你失去一张黑色的牌时，获得一枚“铃”标记；每名角色的回合结束阶段，你清空所有的“铃”标记，然后你每失去一张“铃”，你可以弃置一名角色区域内的一张牌，若你因此弃置了一枚角色的最后一张手牌，你对该角色造成一点伤害。",
                    "ssr_jinfan": "锦帆",
                    "ssr_jinfan_info": "出牌阶段限两次，你可以弃置一张黑色的牌或装备牌，然后将牌堆顶的两张牌置于你的武将牌上，称之为“铃”：当你的武将牌上有“铃”时，你对手牌数小于其数量的角色使用【杀】无视距离和防具。",
                    "ssr_qixi": "奇袭",
                    "ssr_qixi_info": "锁定技，结束阶段，若你的武将牌上有“铃”，你须指定一名其他角色并对“铃”进行清算：①基本牌，你随机弃置该角色一张手牌区内的牌；②锦囊牌，你随机弃置该角色一张装备区内的牌；③装备牌，你对该角色造成一点伤害。清算结束后，你将所有剩余的“铃”置入弃牌堆，然后摸等量的牌。",
                    "ssr_tieji": "铁骑",
                    "ssr_tieji_info": "当你使用【杀】指定一名角色为目标后，你可以翻开牌堆顶的一张牌并令该角色的非锁定技失效直到回合结束，若你的武将牌上拥有此花色，则你令此【杀】不可被闪避，否则将此牌置于你的武将牌上。",
                    "ssr_zhuiji": "追击",
                    "ssr_zhuiji_info": "锁定技，你计算与其他角色的距离时-X，你每有一点护甲，你的手牌上限便加一，当你对距离一以内的角色造成伤害后，你可以获得该角色的一张牌。（X为你的已失体力值）",
                    "ssr_yingzi": "英姿",
                    "ssr_yingzi_info": "锁定技，摸牌阶段摸牌时，你额外摸一张牌，你的手牌上限始终为四。",
                    "ssr_youqin": "游琴",
                    "ssr_youqin_info": "锁定技，你的手牌上限始终为你的体力值上限，游戏开始时，你获得两枚标记“魂”〈普通锦囊/延时锦囊〉和“姿”〈基本牌/装备牌〉，摸牌阶段，你少摸一张牌，然后根据“魂”和“姿”的类型从牌堆中随机各获得一张符合要求的牌。",
                    "ssr_yeyan": "业炎",
                    "ssr_yeyan_info": "当你即将受到火焰伤害时，你可以弃置一张牌并使此伤害减一；当你即将造成火焰伤害时，你可以弃置一张牌并使此伤害加一。",
                    "ssr_anhun": "安魂",
                    "ssr_anhun_info": "锁定技，①游戏开始时，你获得2枚“幽弦”标记，你最多同时拥有8枚此标记；②场上每有一名角色失去/回复1点体力，你获得1枚“幽弦”标记；③每当你使用或打出牌时，你弃置1枚“幽弦”标记并摸一张牌；④当你受到火属性伤害时，防止此伤害。",
                    "ssr_newfanjian": "反间",
                    "ssr_newfanjian_info": "出牌阶段限一次，你可以选择一张手牌并指定一名有手牌的其他角色，该角色需选择一张手牌，然后你们各自展示选择的牌：若花色相同，则你们弃置展示的牌，然后你改变“姿”标记；否则你对该角色造成一点伤害，直到你的下回合开始或死亡后，该角色不能再使用或打出与展示的牌花色相同的牌，然后你改变“魂”标记。",
                    "ssr_fanjian": "反间",
                    "ssr_fanjian_info": "其他角色的摸牌阶段开始时，若你有手牌，你须选择一张手牌，然后选择一项：隐藏此牌，将此牌移出游戏，下个角色的摸牌阶段开始时你重新获得此牌；发动反间，你将此牌置于牌堆顶，然后你按任意顺序调整牌堆顶的三张牌。若该角色使用你置于牌堆中的牌，你可令此牌无效，你对该角色造成一点火焰伤害并回收此牌，若如此做，直到你的下个回合开始，你不能再选择“发动反间”选项。（你在使用此技能的过程中，其他角色不能看到你的行为）",
                    "ssr_rende": "仁德",
                    "ssr_rende_info": "出牌阶段，你可以将任意张手牌交给其他角色。每当你以此法给出第三张牌时，你选择视为使用一张【桃园结义】或回复两点体力。你的【桃园结义】可以任意选择目标。",
                    "ssr_newrende": "仁德",
                    "ssr_newrende_info": "出牌阶段限两次，你可以交给一名其他角色一张手牌，然后令其选择一项：①令你恢复一点体力，且直到其回合结束，其不能对你使用带伤害标签的卡牌；②视为你对其使用一张不计次数的【杀】。",
                    "ssr_shichou": "誓仇",
                    "ssr_shichou_info": "当你使用【杀】指定一名角色为目标后，你可以进行一次判定：该角色不能使用或打出与判定结果花色相同的牌直到你的回合开始。",
                    "ssr_jijiang": "激将",
                    "ssr_jijiang_info": "主公技，你的回合结束阶段，若你于本回合的出牌阶段内没有过使用过【杀】或手牌中没有【杀】，则你可以指定一名其他蜀势力的角色：该角色的下个回合内可以额外使用一张【杀】，且视为拥有技能〖誓仇〗。",
                    "ssr_qiangxi": "强袭",
                    "ssr_qiangxi_info": "锁定技，游戏开始时，你获得两枚“戟”标记；你每受到一点伤害或失去一张武器牌后，你获得一枚“戟”标记。出牌阶段限两次，你可弃置一枚“戟”标记并对一名其他角色造成一点伤害。",
                    "ssr_qingji": "擎戟",
                    "ssr_qingji_info": "出牌阶段限一次，你可以受到一点伤害，然后从牌堆或弃牌堆中获得一张武器牌。",
                    "ssr_yunchou": "运筹",
                    "ssr_yunchou_info": "每轮每种类型的牌限一次，你可以将这种类型的一张牌当作任意一张锦囊牌使用。",
                    "ssr_bailun": "败论",
                    "ssr_bailun_info": "锁定技，①当你进入濒死状态时，你防止进行结算直到你的弃牌阶段开始前，此期间每当你失去最后一张手牌时你摸一张牌；②准备阶段，你进行一次判定：若结果为黑桃，你获得此判定牌并失去一点体力；否则本回合出牌阶段内你使用的锦囊牌无距离限制且不能被响应。",
                    "ssr_tianyun": "天陨",
                    "ssr_tianyun_info": "锁定技，当你的判定牌生效后，你可以获得之；每回合开始时你须进行一次判定，若为黑桃2~9，你受到一点无来源的雷属性伤害。",
                    "ssr_newyice": "遗策",
                    "ssr_newyice_info": "出牌阶段限X次，你可以将一张手牌转化为【出其不意】、【洞烛先机】、【逐近弃远】、【声东击西】中的一张交给一名其他角色，然后该角色获得一枚“谏”标记，其使用上述牌名的锦囊牌或【杀】时移除一枚此标记并摸一张牌。（X为本轮内你受到伤害或失去体力的次数加一）",
                    "ssr_yice": "遗策",
                    "ssr_yice_info": "每当你受到一点伤害时，在结算完毕前，你可以从牌堆中随机获得三张锦囊牌，然后将其分配给任意角色。",
                    "ssr_jianxiong": "奸雄",
                    "ssr_jianxiong_info": "当你受到伤害后，你可以获得对你造成伤害的牌，然后你可以弃置一张手牌并移动场上的一张牌。",
                    "ssr_tumeng": "屠梦",
                    "ssr_tumeng_info": "游戏开始时，你将一张【七宝刀】加入手牌：①准备阶段或当你受到伤害后，你尝试从牌堆中获得一张【七宝刀】，若不成功，则你令当前回合角色本回合手牌上限减一；②当你受到伤害后，你可以获得对你造成伤害的牌，然后若场上有角色装备着【七宝刀】，你可以移动场上的一张牌，移动结束后你令所有装备了【七宝刀】的角色弃置一张牌。",
                    "ssr_hujia": "护驾",
                    "ssr_hujia_info": "主公技，场上一名其他魏势力角色进入濒死状态时，其可以摸一张牌并交给你一张牌，然后若其没有〖飞影〗，你令其获得〖飞影〗直到回合结束。",
                    "ssr_zhujiu": "煮酒",
                    "ssr_zhujiu_info": "每回合限一次，当一名角色需要使用一张【酒】时，其可以向你发出请求：你可以打出一张黑色的牌，视为该角色使用了一张【酒】。",
                    "ssr_wushuang": "无双",
                    "ssr_wushuang_info": "锁定技，当你使用【杀】或【决斗】指定目标后，你令此牌需要依次使用或打出两张【闪】或【杀】响应。",
                    "ssr_zhanshen": "战神",
                    "ssr_zhanshen_info": "锁定技，游戏开始时你获得两枚“神”标记，你每造成或受到一点伤害后，你获得一枚“神”标记；觉醒技，出牌阶段，你可以弃置X枚“神”标记，将你的装备区的牌收入手牌并废除你的判定区和装备区，然后获得技能〖神威〗、〖神戟〗、〖破甲〗。（X为当前场上存活角色的数量）",
                    "ssr_shenji": "神戟",
                    "ssr_shenji_info": "锁定技，你始终视为装备着【方天画戟】；每回合限一次，你可以将一张装备牌当做【酒】使用。",
                    "ssr_shenwei": "神威",
                    "ssr_shenwei_info": "出牌阶段限一次，你可以将所有手牌置于武将牌上，再从中选择一张作为手牌，若如此做，你获得技能〖完杀〗，回合结束时你可以重新获得武将牌上的牌。",
                    "ssr_liegong": "烈弓",
                    "ssr_liegong_info": "锁定技，你使用【杀】无距离限制；当你使用【杀】指定一名角色时，你可弃置一张牌令此【杀】不可被响应；当你的【杀】对一名角色造成伤害后，你可以将该角色装备区的一张牌置于其武将牌上，直到你的回合开始或死亡后，该角色重新装备这张牌。",
                    "ssr_pojia": "破甲",
                    "ssr_pojia_info": "锁定技，当你使用【杀】指定一名目标角色后，你令其防具技能无效直到此【杀】被抵消或造成伤害。",
                    "ssr_wansha": "完杀",
                    "ssr_wansha_info": "锁定技，你的回合内，除你以外，不处于濒死状态的角色不能使用【桃】。",
                    "ssr_ganglie": "刚烈",
                    "ssr_ganglie_info": "每当你受到一点伤害后，你可以视为对伤害来源使用一张【杀】，若此【杀】没有命中，你弃伤害来源一张牌。",
                    "ssr_newganglie": "刚烈",
                    "ssr_newganglie_info": "当你使用【杀】指定一名其他角色为目标后，若你和该角色的手牌数均大于一，你可以令你和该角色各随机保留一张手牌然后弃置其他的手牌。当你受到伤害后，你可以视为对伤害来源使用一张【杀】。",
                    "ssr_danjing": "啖睛",
                    "ssr_danjing_info": "锁定技，当你受到【万箭齐发】造成的伤害后，你回复一点体力。",
                    "ssr_chuli": "除疠",
                    //"ssr_chuli_info":"出牌阶段，你可以将一名角色的一张手牌置于你的武将牌上，称为“药”，然后若该角色为你或其体力值不为满，你令该角色回复一点体力，然后在你回合结束后摸一张牌。（当你于回合内第二次获得相同花色的“药”时，本回合内你不能再发动此技能）",
                    "ssr_chuli_info": "出牌阶段，你可以将一名角色的一张手牌置于你的武将牌上，称为“药”，令该角色回复一点体力，然后若该角色为你或此牌为基本牌，则其在你回合结束后摸一张牌。（当你于回合内第二次获得相同花色的“药”时，本回合内你不能再发动此技能）",
                    "ssr_xianfang": "仙方",
                    "ssr_xianfang_info": "每轮限一次，当有角色进入濒死状态时，你可以弃置四枚花色均不同的“药”，令该角色回复两点体力并摸两张牌。",
                    "ssr_yizhong": "毅重",
                    "ssr_yizhong_info": "锁定技，当你受到不为红色的牌造成的伤害后，你获得等量的“甲”标记，你的“甲”标记可以替你承受等量的伤害。（你每有一枚“甲”，你的手牌上限便加一）",
                    "ssr_newyizhong": "毅重",
                    "ssr_newyizhong_info": "锁定技，①当你即将受到一点伤害时，若你的体力值大于一，则你改为失去一点体力并获得一点护甲；②你每有一点护甲，你的手牌上限便加一；③准备阶段，若你于上一轮内未受到过红色【杀】造成的伤害，你翻开牌堆顶的X张牌：其中每有一张黑桃牌，你将一点护甲转化为体力值。（X为你的护甲数量）",
                    "ssr_zhenjun": "镇军",
                    "ssr_zhenjun_info": "出牌阶段，你可以弃置一张黑桃牌，然后指定一名其他角色：该角色不能使用或打出黑色的牌直到你的下个回合开始或你死亡后。",
                    "ssr_newzhenjun": "镇军",
                    "ssr_newzhenjun_info": "出牌阶段限两次，你可以指定一名其他角色：你受到一点伤害，然后该角色不能使用或打出黑色的牌且防具失效直到你的下个回合开始或你死亡后。",
                    "ssr_shendao": "神道",
                    "ssr_shendao_info": "出牌阶段限一次，你可以弃置两张手牌并指定一名角色，然后从技能库中随机抽取三个限定技，你选择其中一个作为“神符”置于其武将牌上：①武将牌上有“神符”的角色可以使用“神符”上的技能；②每个角色的回合结束时，武将牌上有“神符”的角色，若其“神符”上的技能已被使用，则其失去该“神符”；③每名角色的武将牌上最多同时存在两张“符”，多余的“符”会被按顺序挤出。",
                    "ssr_jiahe": "驾鹤",
                    "ssr_jiahe_info": "当你成为带伤害标签卡牌的目标后，你可以进入潜行状态直到你的下个回合开始。",
                    "ssr_newjiahe": "驾鹤",
                    "ssr_newjiahe_info": "当你成为带伤害标签卡牌的目标后，你可以进入潜行状态直到回合结束，若你已受伤，则你每失去一点体力，此效果延长一回合。（至多到你的下个回合开始）",
                    "ssr_qianxing": "潜行",
                    "ssr_qianxing_info": "锁定技，你不能成为其他角色的卡牌的目标。",
                    "ssr_huanhua": "幻化",
                    "ssr_huanhua_info": "你的回合开始或结束时，你可以指定场上的一名其他非神势力的角色，你化身成为该角色。（你拥有该角色的所有觉醒技以外的技能，你的名称与该角色相同）",
                    "ssr_xinsheng": "新生",
                    "ssr_xinsheng_info": "当你处于濒死状态时，若你处于化身状态，你可以放弃化身变为本体并将体力值回复至一点，然后你可以弃置一张红桃牌并获得〖潜行〗直到你的回合开始。",
                    "ssr_miedi": "蔑敌",
                    "ssr_miedi_info": "出牌阶段限两次，你可以令一名其他角色摸一张牌，然后其选择一项：①交给你两张牌；②对你使用一张无距离限制的【杀】。若此期间你受到了伤害，则本回合你不能再发动此技能。",
                    "ssr_shiyong": "恃勇",
                    "ssr_shiyong_info": "锁定技，①你可以将一张锦囊牌当【闪】使用或打出；②当指定你为目标的【杀】没有命中时，【杀】的来源流失一点体力；③当一张红色的【杀】指定你为目标时，你需要依次打出两张【闪】来响应。",
                    "ssr_qingjian": "清俭",
                    "ssr_qingjian_info": "摸牌阶段摸牌时，你可以少摸一张牌，然后令至多两名其他角色各摸一张牌。",
                    "ssr_zuni": "阻逆",
                    "ssr_zuni_info": "当一名角色的牌于弃牌阶段外因弃置而进入弃牌堆时，你可以弃置一张手牌并令弃置的牌回到该角色的手牌。",
                    "ssr_yaowu": "耀武",
                    "ssr_yaowu_info": "当你使用黑色的【杀】被【闪】抵消时，你可以弃置目标角色一张手牌。",
                    "ssr_kurou": "苦肉",
                    "ssr_kurou_info": "出牌阶段限两次，你可以失去一点体力，然后观看一名其他角色的手牌，并可以获得其中至多两张牌。",
                    "ssr_newkurou": "苦肉",
                    "ssr_newkurou_info": "出牌阶段限一次，你可以失去一点体力并指定一名有手牌的其他角色：你观看其手牌并选择获取其中一张，直到你的下个回合开始，该角色的所有手牌和判定牌均视为该牌的花色。",
                    "ssr_fenchuan": "焚船",
                    "ssr_fenchuan_info": "当你使用【杀】指定一名角色为目标后，你可以令其展示一张手牌：你可以弃置一张与之花色相同的牌，然后令此牌不可被【闪】响应，伤害加一且变成火属性。",
                    "ssr_lihun": "离魂",
                    "ssr_lihun_info": "准备阶段，你观看牌堆顶的两张牌，然后你可以跳过自己的回合，将这两张牌交给一名男性角色并控制其进行一个出牌阶段和弃牌阶段。（你控制该角色期间你免疫所有伤害和体力流失）",
                    "ssr_newlihun": "离魂",
                    "ssr_newlihun_info": "出牌阶段限一次，若场上角色存在两名以上角色，则你可以选择一张手牌并指定一名其他角色，令其猜测此牌的种类，然后你将此牌交给该角色：若猜中，你失去一点体力，本回合你的手牌上限为零；若没猜中，其下个回合由拥有〖离魂〗的角色来控制。（在控制该角色期间你获得潜行效果）",
                    "ssr_biyue": "闭月",
                    "ssr_biyue_info": "锁定技，你不能成为描述带有“杀”字的锦囊牌的目标，你的手牌区、装备区、判定区每有一个区域没有牌，其他角色与你计算的距离则加一。",
                    "ssr_wangzun": "妄尊",
                    "ssr_wangzun_info": "主公的摸牌阶段，你可让其少摸一张牌，然后你观看场上一名角色的手牌并将其中一张移动到另一名角色的手牌中，如若此做，主公本回合内可以额外使用一张【杀】。",
                    "ssr_yongsi": "庸肆",
                    "ssr_yongsi_info": "主公技，锁定技，游戏开始时，你获得并装备【玉玺】。准备阶段，若玉玺在弃牌堆中，则视为你将其使用。",
                    "ssr_yuxi_cardskill": "玉玺",
                    "ssr_yuxi_cardskill_info": "锁定技：一、所有角色终视为在你的攻击范围内；二、当你成为【杀】的目标时，你可以弃置两张手牌（不足则全弃，无牌则不弃），然后摸两张牌。",
                    "ssr_yuxi": "玉玺",
                    "ssr_yuxi_info": "锁定技，①你视为拥有你武将牌上的主公技；②你的手牌上限加一，摸牌阶段你额外摸一张牌；③你和所有其他角色互相视为在彼此的攻击范围内。（此牌在装备区时不能被其他角色弃置）",
                    "ssr_yjixi": "觊玺",
                    "ssr_yjixi_info": "锁定技，①游戏开始时，你令本局游戏明置的主公/主帅/君主/地主/自己获得并装备【玉玺】；②其他角色的准备阶段，若其装备区内有【玉玺】且手牌数大于体力值，则你随机获得该角色区域内的一张牌；③若你的区域内没有【玉玺】，则出牌阶段你可以额外使用一张【杀】。",
                    "ssr_yanji": "延疾",
                    "ssr_yanji_info": "攻击范围包含你的其他角色使用【杀】时不能指定你以外的角色为目标，当你成为【杀】的目标时，你可以弃一张牌，为此【杀】额外指定一名其他角色为目标。（此目标无视其他限制，但不能是【杀】的使用者）",
                    "ssr_cuandi": "篡帝",
                    "ssr_cuandi_info": "主公技，当你成为【杀】的目标时，你可以令其他其他群雄角色进行响应：每有一名角色响应，你弃置一张手牌（不足则全弃，无牌则不弃），然后摸等量的牌。",
                    "ssr_tongji": "同疾",
                    "ssr_tongji_info": "当你成为【杀】的目标时，你可以为此【杀】额外指定一名你攻击范围内的其他角色为目标。（此目标不能是【杀】的使用者）",
                    "ssr_wushen": "武神",
                    "ssr_wushen_info": "你可以将一张红色牌当做【杀】使用或打出；你使用红色的【杀】造成的伤害加一；体力值为一的角色不能闪避你的红色【杀】。",
                    "ssr_wusheng": "武圣",
                    "ssr_wusheng_info": "锁定技，你的酒【杀】不能被响应；出牌阶段，你可以将一张红色的牌当【杀】使用或打出。",
                    "ssr_yijue": "义绝",
                    "ssr_yijue_info": "出牌阶段限一次，你可以指定一名其他角色并展示一张牌：若该角色装备区有牌，则视为你将此牌当【水淹七军】对该角色使用；否则你令该角色摸一张牌，视为你将此牌当【酒】对自己使用（不计入次数），然后你获得技能〖马术〗直到回合结束。",
                    "ssr_nuzhan": "怒斩",
                    "ssr_nuzhan_info": "锁定技，当你杀死一名角色时，你不进行结算，改为摸两张牌，然后本回合内你使用【杀】没有次数限制。",
                    "ssr_liecheng": "猎城",
                    "ssr_liecheng_info": "准备阶段，你可以令一名其他角色选择打出一张【杀】，否则你从牌堆中获得一张装备牌，然后直到你的下个回合开始，该角色的所有手牌和判定牌均视为红桃花色。",
                    "ssr_newbaiyi": "白衣",
                    "ssr_newbaiyi_info": "出牌阶段限两次，你可以将一张装备牌置于一名没有“渡”角色的武将牌上，称为“渡”：①拥有“渡”的角色不能成为其他角色使用的锦囊牌或红色【杀】的目标；②每回合结束时，场上所有的“渡”点数减一，当点数清零时“渡”进入弃牌堆，然后持有者摸两张牌。",
                    "ssr_baiyi": "白衣",
                    "ssr_baiyi_info": "当一名角色使用一张多目标的锦囊牌时，你可以取消任意一个目标。",
                    "ssr_gongxin": "攻心",
                    "ssr_gongxin_info": "出牌阶段，你可以弃置一张红桃牌，然后指定一名其他角色：该角色不能使用或打出红色的牌直到你的下个回合开始或你死亡后。",
                    "ssr_keji": "克己",
                    "ssr_keji_info": "锁定技，你的【杀】不计入手牌上限。",
                    "ssr_shelie": "涉猎",
                    "ssr_shelie_info": "摸牌阶段，你可以改为从牌堆顶亮出四张牌，然后选择获得其中两张牌。",
                    "ssr_yicong": "义从",
                    "ssr_yicong_info": "锁定技，你装备区的坐骑牌不能被其他角色弃置；当一名角色即将受到锦囊牌造成的伤害时，你可以弃置其一张装备区的坐骑牌并减少一点伤害。",
                    "ssr_yucong": "驭骢",
                    "ssr_yucong_info": "出牌阶段限两次，你可以弃置一张手牌并指定一名角色：你可选择随机将牌堆中一张攻击马或防御马置于其装备区内，或者弃置其一张坐骑牌。",
                    "ssr_newyicong": "义从",
                    "ssr_newyicong_info": "锁定技，你与装备区有坐骑牌的角色拥有以下效果：①计算时距离始终视为一；②你对其使用【杀】或【决斗】时你可以随机弃置其两张手牌；③其对你使用【杀】或【决斗】时你可以随机获得其装备区的一张坐骑牌并摸一张牌。",
                    "ssr_newyucong": "驭骢",
                    "ssr_newyucong_info": "出牌阶段限一次，你可以弃置任意张手牌并指定场上不超过两倍数量的角色：你令该角色获得并装备一张【的卢】。",
                    "ssr_newtongque": "铜雀",
                    "ssr_newtongque_info": "锁定技，①游戏开始时你获得2个骰子，每名角色最多拥有2个骰子，准备阶段你回收场上的骰子；②其他角色即将对你造成伤害时，你进行一次猜骰[3]，若成功则你防止此伤害。",
                    "ssr_newguose": "国色",
                    "ssr_newguose_info": "出牌阶段，你可以将一个骰子暂时交给一名其他角色，该角色的手牌上限-1，出牌阶段开始时需进行一次猜骰[4]，若成功则其跳过此阶段。且除该角色外每个角色的出牌阶段均可以与其进行一次拼点：若成功则将其猜骰数-1。",
                    "ssr_newtianxiang": "天香",
                    "ssr_newtianxiang_info": "场上拥有骰子的角色区域内的牌和判定牌均视为红桃牌。出牌阶段，你可以将一个骰子暂时交给一名其他角色，该角色即将受到伤害时，若该伤害，①有对应卡牌，则进行一次猜骰[3]：若成功则防止此伤害；②无对应卡牌，则进行一次猜骰：若满足[2]则该伤害+1；若满足[4]则该伤害+2。",
                    "ssr_newtongque_about": "关于猜骰",
                    "ssr_newtongque_about_info": "角色将拥有的骰子全部投掷出，然后比较结果，只要有一枚骰子的点数大于猜骰要求的[点数]，则视为成功。",
                    "ssr_tongque": "铜雀",
                    "ssr_tongque_info": "游戏开始时，你获得四枚“璃”标记，当你即将受到伤害时，你可以投掷一枚骰子：①若点数不大于你拥有“璃”标记的个数，则你防止此伤害并失去一枚“璃”；②若点数大于你拥有“璃”标记的个数，则你摸一张牌并获得一枚“璃”；③当你于弃牌阶段内弃置牌时，若你“璃”标记的个数小于六，则你获得一枚“璃”。",
                    "ssr_guose": "国色",
                    "ssr_guose_info": "出牌阶段，若你的“璃”标记大于你的体力值，你可以弃置一枚“璃”标记并摸一张牌，然后将一张【乐不思蜀】从一名角色的判定区置入或弃置。",
                    "ssr_tianxiang": "天香",
                    "ssr_tianxiang_info": "出牌阶段，若你的“璃”标记大于你的体力值，你可以弃置一枚“璃”标记并指定一名其他角色：该角色流失一点体力，然后你与其各摸一张牌。（每个角色限一次）",
                    "ssr_aozhan": "鏖战",
                    "ssr_aozhan_info": "当你成为【杀】的目标后，你可以摸一张牌，然后选择对此【杀】的来源使用一张【杀】：若你使用的【杀】造成伤害，则该角色的【杀】对你无效；否则你弃置一张手牌。",
                    "ssr_luoyi": "裸衣",
                    "ssr_luoyi_info": "锁定技，游戏开始时，你废除你的防具栏；你的锦囊牌均视为【决斗】；当你使用【杀】或【决斗】指定目标后，你令此牌需要依次使用或打出两张【闪】或【杀】响应。",
                    "ssr_huchi": "虎痴",
                    "ssr_huchi_info": "锁定技，你的锦囊牌均视为【决斗】，你除武器的装备牌均视为【杀】，你使用【决斗】可以额外指定一名角色为目标。",
                    "ssr_huchi_info2": "锁定技，你的锦囊牌均视为【决斗】，你除武器的装备牌均视为【杀】，每回合限一次，当你使用【杀】或【决斗】造成伤害后，你摸一张牌。",
                    "ssr_newluoyi": "裸衣",
                    "ssr_newluoyi_info": "锁定技，①当你即将受到【杀】或【决斗】造成的伤害时，你防止此伤害，获得等量“疤”标记然后视为对伤害来源使用一张【决斗】；②出牌阶段开始时，若你有“疤”，则你须选择一项：弃置X张【杀】，若你因此弃置了至少两张牌，你移去一枚“疤”；或失去X点体力，移去X枚“疤”并从牌堆中获得X张【杀】。（X为你拥有“疤”标记的数量的一半，向上取整）",
                    "ssr_paoxiao": "咆哮",
                    "ssr_paoxiao_info": "当你对一名角色使用【杀】结算后，你可以视为对该角色再次使用同一张【杀】。（每张【杀】限一次，且不计入次数）",
                    "ssr_zhenhun": "镇魂",
                    "ssr_zhenhun_info": "锁定技，准备阶段，你令所有其他角色的非锁定技失效、不能使用或打出【杀】直到回合结束；当你使用【杀】对一名其他角色造成伤害后，你令该角色失去所有技能直到你的下个回合开始。",
                    "ssr_luoshen": "洛神",
                    "ssr_luoshen_info": "当你受到伤害后，你可以弃置所有手牌，然后从牌堆中随机获得四张花色不同的非装备牌。",
                    "ssr_newluoshen": "洛神",
                    "ssr_newluoshen_info": "摸牌阶段结束时，若你有手牌，你可以翻开牌堆顶四张花色各不相同的锦囊牌，然后可以用相同花色的手牌对其进行替换，结束后若这四张牌存在不少于两张非锦囊牌，你回复一点体力。",
                    "ssr_yushui": "御水",
                    "ssr_yushui_info": "锁定技，当你即将受到伤害时，防止此伤害并展示手牌，你尝试从牌堆中抽出一张与手牌和装备牌的花色均不同的牌：若成功，则你失去一点体力并获得此牌。",
                    "ssr_qingcheng": "倾城",
                    "ssr_qingcheng_info": "出牌阶段限一次，你可以指定所有其他区域内有牌的男性角色为目标：你获得该角色区域内的一张牌，然后交给其一张牌。",
                    "ssr_newqingcheng": "倾城",
                    "ssr_newqingcheng_info": "结束阶段，你移除场上所有的“酒诗”标记，然后你可以展示牌堆顶的两张牌并获得之，之后你将多余体力上限的手牌交给下家，并从其中选择一张牌，称为“锦绣”：从其开始，场上所有的玩家依次将多余体力上限的手牌交给下家（至少交出一张牌），执行完毕后场上拥有“锦绣”的玩家失去“锦绣”并获得一枚“酒诗”标记；你不能成为酒【杀】的目标。（“酒诗”标记可以当做一张【酒】使用）",
                    "ssr_xiaoji": "枭姬",
                    "ssr_xiaoji_info": "当你失去一张装备区内的牌后，你可以将此装备牌交给一名角色，令该角色摸一张牌并对该角色造成一点伤害。",
                    "ssr_lianyin": "联姻",
                    "ssr_lianyin_info": "出牌阶段限一次，你可以指定一名其他男性角色，直到你的下个回合开始，双方中有一方受到伤害时双方各摸一张牌，然后你翻开牌堆顶两张牌：该角色选择一张牌交给你，然后获得另一张牌。",
                    "ssr_jieyin": "结姻",
                    "ssr_jieyin_info": "出牌阶段限一次，你可以交给一名其他角色一张红色手牌，然后观看并获得其区域内的一张牌：当你获得一名其他角色的牌时，若该角色没有“红妆”标记，你可以回复一点体力并令该角色获得“红妆”标记直到其回合结束。（拥有“红妆”标记的角色失去此标记时摸一张牌）",
                    "ssr_weigong": "卫宫",
                    "ssr_weigong_info": "锁定技，当你成为一名其他角色【杀】的目标时：①若该角色没有“红妆”标记，你弃置其一张手牌；②若该角色有“红妆”标记，你获得其一张手牌。",
                    "ssr_tianlang": "天狼",
                    "ssr_tianlang_info": "准备阶段，你进行一次夜观天象，然后根据所占得的星象对应发动技能、获得技能直到下个回合开始：<li>天枢：你可以发动一次〖权变〗，然后获得技能〖雄志〗；<li>天璇：你可以发动一次〖英姿〗，然后获得技能〖制衡〗；<li>天玑：你可以发动一次〖观星〗，然后获得技能〖仁德〗；<li>天权：你可以发动一次〖突袭〗，然后获得技能〖煮酒〗；<li>玉衡：你可以发动一次〖败移〗，然后获得技能〖景略〗；<li>开阳：你可以发动一次〖昭心〗，然后获得技能〖狼顾〗；<li>摇光：你可以发动一次〖归心〗，然后获得技能〖天元〗。",
                    "ssr_newjilue": "极略",
                    "ssr_newjilue_info": "当一名其他角色对你使用锦囊牌结算结束后，若你是此牌的唯一目标或你因此牌受过伤，则可以视为你对其使用此牌。",
                    "ssr_langgu": "狼顾",
                    "ssr_langgu_info": "锁定技，你每受到一点伤害，你获得一枚“忍”标记；你与本轮对你造成过伤害的角色计算距离始终为一。",
                    "ssr_fankui": "反馈",
                    "ssr_fankui_info": "出牌阶段限三次，你可以弃置一枚“忍”标记并获得距离一以内的一名其他角色一张牌。",
                    "ssr_jilue": "极略",
                    "ssr_jilue_info": "你的回合内，每当你使用了两种颜色不同的牌后，你可获得一枚“忍”标记；一名角色的判定结果生效前，你可弃置一枚“忍”标记并更改其花色。",
                    "ssr_jiyuan": "急援",
                    "ssr_jiyuan_info": "当一名角色进入濒死状态时，你可以与其各摸一张牌。",
                    "ssr_jijie": "机捷",
                    "ssr_jijie_info": "出牌阶段限两次，你可以观看牌堆底的一张牌并展示之，然后将其交给一名角色，该角色可以立即使用此牌。",
                    "ssr_newjiyuan": "急援",
                    "ssr_newjiyuan_info": "锁定技，①摸牌阶段你的摸牌数减一；②当一名其他角色失去最后一张手牌或体力值变化到不大于一时，你可以将所有手牌交给该角色；③一名角色回合结束后，若你手牌种类不全，则你展示所有手牌，然后从牌堆中按基本牌、锦囊牌、装备牌的优先度补一张牌。",
                    "ssr_newjijie": "机捷",
                    "ssr_newjijie_info": "你的回合内或回合外每种类型的牌各限一次，你可以将一张牌当【闪】或【釜底抽薪】使用。",
                    "ssr_qicai": "奇才",
                    "ssr_qicai_info": "锁定技，你使用的锦囊牌无距离限制，且不能被【无懈可击】响应；你使用“对所有其他角色使用”的锦囊牌可以任意选择目标；在你的回合外，你的最后一张手牌视为【金蝉脱壳】。",
                    "ssr_jiqiao": "机巧",
                    "ssr_jiqiao_info": "游戏开始时，你将牌堆顶的三张牌置于你的武将牌上，称之为“辎”。所有角色的出牌阶段限一次，经过你的同意后，其可摸一张牌然后观看并用任意数量的手牌等量交换这些“辎”。",
                    "ssr_jizhi": "集智",
                    "ssr_jizhi_info": "你可以重铸一张锦囊牌，视为发动一次〖火计〗、〖八阵〗或〖看破〗。",
                    "ssr_jizhi_huoji": "火计",
                    "ssr_jizhi_huoji_info": "出牌阶段，你可以将你的任意一张红色手牌当作【火攻】使用。",
                    "ssr_jizhi_kanpo": "看破",
                    "ssr_jizhi_kanpo_info": "你可以将你的任意一张黑色手牌当做【无懈可击】使用。",
                    "ssr_jizhi_bazhen": "八阵",
                    "ssr_jizhi_bazhen_info": "锁定技，若你的防具栏内没有牌且没有被废除，则你视为装备着【八卦阵】。",
                    "ssr_weimu": "帷幕",
                    "ssr_weimu_info": "锁定技，你不能成为黑色锦囊牌的目标；你使用的黑色锦囊牌没有距离限制且不能被其他牌响应，你使用的黑色锦囊牌指定体力值不小于你的目标后，你令目标失去一点体力。",
                    "ssr_zhenlue": "缜略",
                    "ssr_zhenlue_info": "限定技，出牌阶段，你可从牌堆中随机展示四张各不相同，且你可以立即使用的黑色非延时锦囊牌，然后你获得这些牌。",
                    "ssr_juesha": "绝杀",
                    "ssr_juesha_info": "限定技，出牌阶段，你可令除你外的所有角色不能使用【酒】或【桃】直到回合结束。",
                    "ssr_newweimu": "帷幕",
                    "ssr_newweimu_info": "锁定技，你的武将牌背面朝上时，①你不计入距离和座次的计算；②所有其它角色的【桃】和【酒】均视为【毒】；③你可以将一张黑色的牌当【趁火打劫】使用。",
                    "ssr_du": "毒",
                    "ssr_du_info": "①当此牌正面向上离开你的手牌区，或作为你的拼点牌而亮出时，你失去1点体力。<span style='text-decoration:line-through;'>②当你因摸牌或分发起始手牌而获得【毒】后，你可展示之并交给其他角色（不触发〖毒①〗）。</span>",
                    "ssr_guimou": "诡谋",
                    "ssr_guimou_info": "出牌阶段开始时，你可以将武将牌翻面，令两名有手牌的角色进行拼点：赢的角色对输的角色造成一点伤害。",
                    "ssr_newluanwu": "乱武",
                    "ssr_newluanwu_info": "限定技，每轮开始时，你可以令所有角色同时选择两项：①将武将牌翻面；②摸两张牌；③本轮获得技能〖鸩毒〗。",
                    "ssr_newbeiming": "悲鸣",
                    "ssr_newbeiming_info": "出牌阶段开始时，你可以令任意名角色获得〖余音〗；锁定技，每当你使用或打出一张牌时，场上所有其他角色若其区域内存在与此牌花色相同的牌，则将其中随机一张置入弃牌堆，若该角色拥有〖余音〗，则其摸一张牌。",
                    "ssr_beiming": "悲鸣",
                    "ssr_beiming_info": "出牌阶段限一次，你可以指定所有其他角色为目标，然后选择一项：悲愤，手牌数大于你的角色弃置两张手牌，小于你的角色摸两张牌；胡笳，手牌数大于你的角色摸两张牌，小于你的角色弃置两张手牌。",
                    "ssr_nianlei": "捻泪",
                    "ssr_nianlei_info": "锁定技，游戏开始时，你标识“陈情”：①出牌阶段限一次，你可以将一张手牌交给一名其他角色并令其标识“陈情”；②当一名拥有“陈情”的角色成为其他角色【杀】的目标时，你令【杀】的来源标识“殇哀”；③标识效果：「陈情」·标识的角色摸一张牌，手牌上限加一；「殇哀」·标识的角色随机失去一张牌，手牌上限减一。",
                    "ssr_newduanxian": "断弦",
                    "ssr_newduanxian_info": "限定技，出牌阶段，你可以弃置两张牌并令场上所有角色依次重新标识，然后进行判断：若其标识“陈情”，其回复两点体力；若其标识“殇哀”，其失去两点体力。",
                    "ssr_duanxian": "断弦",
                    "ssr_duanxian_info": "限定技，出牌阶段，你可以指定一名其他角色并选择一种乐曲类型，该角色获得该类型的乐曲效果，然后该角色从你选择的类型中随机获得一种曲调效果：<br>〖雅乐〗摸牌阶段外，该角色每次摸牌后，其获得一枚“欢”，当其武将牌上存在四枚“欢”时，其回复一点体力。<li>宫调：弃一张黑牌，可以减少受到伤害；<li>徵调：弃一张黑牌，可以增加回复体力。<br>〖哀乐〗弃牌阶段外，该角色每次弃牌后，其获得一枚“悲”，当其武将牌上存在四枚“悲”时，其失去一点体力。<li>羽调：弃一张红牌，否则增加受到伤害；<li>商调：弃一张红牌，否则减少回复体力。",
                    "ssr_juenian": "绝念",
                    "ssr_juenian_info": "当你死亡时，你可以令杀死你的角色所有非锁定技全部失效，然后流失一点体力。",
                    "ssr_jinnang": "锦囊",
                    "ssr_jinnang_info": "出牌阶段限两次，你可以将一张锦囊牌牌置于一名角色的武将牌上，并为其声明一张锦囊牌名，称为“锦囊妙计”，该角色的下个回合开始后，其可以将这张“锦囊妙计”按照你声明的牌名使用。（每名角色武将牌上“锦囊”声明的牌名不能重复）",
                    "ssr_newbazhen": "八阵",
                    "ssr_newbazhen_info": "准备阶段，你从牌堆中往武将牌上随机获得一张花色各不相同的基本牌（首次发动时改为补齐全部花色）：当你需要使用或打出一张基本牌时，你可以将这些牌使用或打出。",
                    "ssr_xinbazhen": "八阵",
                    "ssr_xinbazhen_info": "锁定技，游戏开始时，你获得八张卦象并背面朝上按任意顺序放置在你的武将牌上；当你成为一名角色【杀】或【决斗】的目标时，你令其对你无效，然后其需选择一个卦象：若其背面朝上，则将其翻开，然后对该角色执行对应卦象的效果；出牌阶段，你可以弃置一张闪并将一张不是本轮内被翻开的卦象盖上。",
                    "ssr_xinbazhen_qian_pile": "乾卦",
                    "ssr_xinbazhen_qian_pile_info": "开门·随机翻开一个卦象，不触发效果。",
                    "ssr_xinbazhen_kun_pile": "坤卦",
                    "ssr_xinbazhen_kun_pile_info": "死门·卡牌的来源立即失去一点体力。",
                    "ssr_xinbazhen_zhen_pile": "震卦",
                    "ssr_xinbazhen_zhen_pile_info": "伤门·卡牌的来源需打出一张闪，否则受到一点伤害。",
                    "ssr_xinbazhen_gen_pile": "艮卦",
                    "ssr_xinbazhen_gen_pile_info": "生门·你立即失去一点体力。",
                    "ssr_xinbazhen_li_pile": "离卦",
                    "ssr_xinbazhen_li_pile_info": "景门·不发生任何事件。",
                    "ssr_xinbazhen_kan_pile": "坎卦",
                    "ssr_xinbazhen_kan_pile_info": "休门·卡牌的来源摸一张牌。",
                    "ssr_xinbazhen_dui_pile": "兑卦",
                    "ssr_xinbazhen_dui_pile_info": "惊门·卡牌的来源随机弃置两张牌。",
                    "ssr_xinbazhen_xun_pile": "巽卦",
                    "ssr_xinbazhen_xun_pile_info": "杜门·随机盖上一个卦象，然后打乱顺序。",
                    "ssr_xinbazhen_center_pile": "阴阳",
                    "ssr_xinbazhen_center_pile_info": "阵眼·维持着整个阵法的运行，不可被破坏。",
                    "ssr_xinbazhen_unknown_pile": "巽卦",
                    "ssr_xinbazhen_unknown_pile_info": "隐门·未知的阵门，效果不明。",
                    "ssr_xingjiang": "星降",
                    "ssr_xingjiang_info": "锁定技，回合开始阶段，你翻开牌堆顶的三张牌，选择一张交给一名角色，然后将剩余的牌置入弃牌堆。",
                    "ssr_jianye": "建业",
                    "ssr_jianye_info": "锁定技，你的出牌阶段内，累计摸牌或弃牌超过两张的角色获得一枚“统业”标记，出牌阶段结束时，你移除场上所有的“统业”标记并摸等量的牌。",
                    "ssr_quanbian": "权变",
                    "ssr_quanbian_info": "你的回合内或回合外各限一次，当你失去最后一张手牌时，你可以摸一张牌。",
                    "ssr_manjia": "蛮甲",
                    "ssr_manjia_info": "锁定技，若你的防具栏存在且为空，且你未横置，则你视为装备着【藤甲】；你手牌中除武器的装备牌均视为【杀】；你使用的南蛮入侵可以任意选择目标。",
                    "ssr_zaiqi": "再起",
                    "ssr_zaiqi_info": "陨星技，游戏开始时，你获得七枚“蛮”标记：①出牌阶段，你可以弃置一枚“蛮”标记，将两张【杀】当【南蛮入侵】使用；②你受到伤害后，若你未横置，你可以弃置一枚“蛮”标记，横置并回复一点体力。",
                    "ssr_zaiqi_old_info": "陨星技，游戏开始时，你获得七枚“蛮”标记：①一名角色的回合结束阶段，若你于本回合内受到过伤害或使用过【杀】，你可以弃置一枚“蛮”并视为使用一张【南蛮入侵】；②每轮限一次，当你进入濒死状态时，你可以弃置一枚“蛮”并将体力值回复至一。",
                    "ssr_lieren": "烈刃",
                    "ssr_lieren_info": "锁定技，游戏开始时，你将一张【烈淬刀】加入手牌：①出牌阶段，你可以将一张武器牌置于一名其他角色的武将牌上，称为“刃”；②你的回合开始时或当你进入濒死状态时，你获得所有角色武将牌上的“刃”并令其打出一张【闪】，否则你对其造成一点伤害；③你获得一张“刃”之后，本回合内〖烈刃〗不能再指定此牌发动。（每名角色最多只能置入一枚“刃”）",
                    "ssr_weilong": "危龙",
                    "ssr_weilong_info2": "出牌阶段，你可以额外使用一张【杀】；你可以将花色相同的X张牌按下列规则使用或打出：♥️当【桃】；♦️当火【杀】；♣️当【闪】；♠️当【酒】。当你因此法使用或打出牌后，你摸X张牌。（X为你的体力上限且最少为一）",
                    "ssr_weilong_info": "出牌阶段，你可以额外使用一张【杀】；你可以将花色相同的X张牌按下列规则使用或打出：红桃当【桃】；方块当火【杀】；梅花当【闪】；黑桃当【酒】。当你因此法使用或打出牌后，你摸X张牌。（X为你的体力上限且最少为一）",
                    "ssr_fabei": "伐北",
                    "ssr_fabei_info": "锁定技，你的【杀】指定一名角色为目标后，你令其非锁定技全部失效直到回合结束，该角色须弃置一张基本牌，否则此【杀】不可被闪避。",
                    "ssr_zhengnan": "征南",
                    "ssr_zhengnan_info": "锁定技，当你成为【杀】的目标后，你令【杀】的使用者非锁定技全部失效直到回合结束，其须弃置一张基本牌，否则此【杀】对你无效。",
                    "ssr_wanlan": "挽澜",
                    "ssr_wanlan_info": "锁定技，当一名角色进入濒死状态时，你立即摸两张牌，直到你的下个回合开始，你不能再发动此技能。",
                    "ssr_zhiji": "志继",
                    "ssr_zhiji_info": "觉醒技，锁定技，当场上有一名角色进入濒死状态时，你立即减少一点体力上限并获得一点护甲，然后选择获得以下一个技能：【征南】、【伐北】、【挽澜】。（每名角色限一次，且当你已获得所有技能后，此技能失效）",
                    "ssr_hunzi": "魂姿",
                    "ssr_hunzi_info": "终焉技，出牌阶段限两次，你可以与一名其他角色进行拼点：①若你赢，则你摸一张牌，然后令该角色获得一枚“衅”标记；②拥有“衅”标记的角色其标记不能超过三枚，且其每拥有一枚此标记，该角色拼点时点数则减一（不会小于A点）；③此技能拼点胜利后，若目标的“衅”标记达到三枚时，则你可以视为发动限定技，将场上除你和该角色以外的所有其他角色暂时移出游戏直到你或该角色中有一方死亡。",
                    "ssr_jiang": "激昂",
                    "ssr_jiang_info": "你的回合内或回合外各限一次，当你使用（指定目标后）或被使用（成为目标后）一张【决斗】或【杀】时，你可以摸一张牌。",
                    "ssr_newjiang": "激昂",
                    "ssr_newjiang_info": "锁定技，你使用的【杀】和其他角色对你使用的【杀】均视为【决斗】；你可以将一张基本牌当【杀】打出。",
                    "ssr_zhiba": "制霸",
                    "ssr_zhiba_info": "主公技，准备阶段开始时，若你已受伤，你可令一名吴势力角色执行一项：摸两张牌，然后弃置一张牌；或摸一张牌，然后弃置两张牌。",
                    "ssr_newzhiba": "制霸",
                    "ssr_newzhiba_info": "主公技，当你进行拼点时，其他吴势力角色可以弃置一张牌令你的拼点牌点数+1，且若此次你拼点胜利，这些角色各摸一张牌。（不会超过K点）",
                    "ssr_hanzhan": "酣战",
                    "ssr_hanzhan_info": "锁定技，当你的拼点牌亮出以后，你令此牌的点数加二。（至多为K）",
                    "ssr_newhanzhan": "酣战",
                    "ssr_newhanzhan_info": "锁定技，你每有一点护甲，你的手牌上限便加一，当你进行拼点时，若你的拼点牌为【杀】且你已受伤，则你的拼点牌点数加X。（X为你的已失体力值数量，且点数最终不会超过K点）",
                    "ssr_tianyi": "天义",
                    "ssr_tianyi_info": "出牌阶段限两次，你可以和一名其他角色拼点：赢的一方对没赢的一方造成一点伤害。",
                    "ssr_kuiwei": "溃围",
                    "ssr_kuiwei_info": "出牌阶段限两次，你可以与一名其他角色拼点：若你的拼点牌为【杀】，则拼点胜利的角色对对方造成一点伤害且令其本回合内不能再使用或打出基本牌；若你的拼点牌不为【杀】，则你获得双方拼点牌中点数较大的一张牌。",
                    "ssr_huwei": "护危",
                    "ssr_huwei_info": "每轮限两次，当一名其他角色成为【杀】或【决斗】的目标时，若你不是此牌的来源或目标，你可将此目标转移给你。",
                    "ssr_buqu": "不屈",
                    "ssr_buqu_info": "陨星技，锁定技，游戏开始时，你获得十二枚“创”标记，你的“创”可以替你承受等量的伤害或体力流失；只要你的武将牌有“创”，你使用【杀】时可额外指定一个目标。",
                    "ssr_newbuqu": "不屈",
                    "ssr_newbuqu_info": "锁定技，当你处于濒死状态时，你将体力值变为零，然后若你是首次进入濒死状态，你直接终止濒死结算，当你回复体力后重新计算；否则你将牌堆顶的一张牌置于你的武将牌上，称为“创”：若没有与此“创”点数相同的其他“创”，你终止濒死结算；若有与此“创”点数相同的其他“创”，你将此“创”置入弃牌堆。当你使用与“创”存在点数相等的【杀】时，你令此【杀】不可被闪避。当你处于濒死状态时，你使用的基本牌的伤害或回复数值加一。",
                    "ssr_shensu": "神速",
                    "ssr_shensu_info": "你可以跳过你的摸牌阶段或出牌阶段，且每当你跳过上述任一阶段或者受到一点伤害后，你获得三枚“速”标记；你可以弃置两枚“速”标记并跳过你的判定阶段或弃牌阶段；当你的武将牌上有“速”标记时，每持有两枚“速”标记，你的手牌上限便减一。",
                    "ssr_hubu": "虎步",
                    "ssr_hubu_info": "结束阶段，你可以视为对任意一名其他角色使用任意张无视距离的【杀】，并弃置两倍的量的“速”标记。（每次不能超过三张【杀】，且期间无视目标防具）",
                    "ssr_jushou": "据守",
                    "ssr_jushou_jiewei": "解围",
                    "ssr_jushou_info": "锁定技，游戏开始时，你调整出游戏外的四张牌置于你的武将牌上，称为“城”；你可以将一张牌当做与你武将牌上的“城”同名的牌使用，然后这张“城”于本轮内失效；当你受到超过一点的伤害时，你将伤害值扣减至一点。",
                    //"当你即将受到超过一点的伤害时，你可以令两张有效的“城”于本轮内失效，然后你防止此伤害。",
                    "ssr_jushou_old_info": "锁定技，游戏开始时，你从牌堆中获得四张随机的基本牌或【无懈可击】置于武将牌上，称为“盾”；当你即将受到不小于“你体力值与护盾之和”或“两点”的伤害时，你可以选择失去一枚“盾”并获得一点护甲，然后防止该伤害。",
                    "ssr_zhuzhen": "筑阵",
                    "ssr_zhuzhen_info": "每局游戏限两次，出牌阶段，你可以将一枚“城”交给一名其他角色；你受到伤害后，武将牌上有“城”的角色需摸一张牌，然后交给你一张手牌。",
                    "ssr_jiewei": "解围",
                    "ssr_jiewei_info": "你可以将一张牌当做你的武将牌上的“盾”同名的牌使用。（每张“盾”限一次，直到你的下个回合开始时重置）",
                    "ssr_tuntian": "屯田",
                    "ssr_tuntian_info": "出牌阶段限一次，你可以弃置两张花色相同的牌并获得一枚该花色的标记，称为“田”。结束阶段，或每当你受到一点伤害时，你可以翻开牌堆顶的X张牌，然后选择获得其中的一张牌。（X为你拥有“田”标记的数量，你武将牌上的“田”花色不能重复）",
                    "ssr_zaoxian": "凿险",
                    "ssr_zaoxian_info": "觉醒技，准备阶段，当你拥有不少于四枚“田”标记时，你失去一点体力上限并获得一点护甲，然后获得技能〖急袭〗。",
                    "ssr_jixi": "急袭",
                    "ssr_jixi_info": "出牌阶段开始时，你可以获得一名与你距离不大于X+2的角色的一张牌。（X为你的已失体力值）",
                    "ssr_hengzheng": "横征",
                    "ssr_hengzheng_info": "锁定技，摸牌阶段，你改为将牌堆顶，以及所有其他角色手牌中或装备区域中的一张牌移出，然后你从中获得不大于你应摸牌数量的牌。若你因此移走了一名角色的装备牌，该角色获得技能〖讨伐〗。",
                    "ssr_newhengzheng": "横征",
                    "ssr_newhengzheng_info": "锁定技，摸牌阶段，你改为将牌堆顶的一张牌，以及按照你选择的区域优先度随机将每名其他角色区域里的一张牌移出，然后你从中获得不大于你应摸牌数量的牌，剩下的牌进入弃牌堆。若你因此移走了一名角色的装备牌，该角色获得技能〖讨伐〗。",
                    "ssr_taofa": "讨伐",
                    "ssr_taofa_info": "锁定技，你对拥有〖横征〗的角色：【杀】造成的伤害加一，距离始终视为减二，你使用【杀】对其造成的伤害产生效果后你失去此技能。",
                    "ssr_baonue": "暴虐",
                    "ssr_baonue_info": "锁定技，当你的体力值大于2时，你对其他角色、其他角色对你使用【杀】时，都需连续使用两张【闪】来进行响应。",
                    "ssr_jiuchi": "酒池",
                    "ssr_jiuchi_info": "主公技，其他群雄角色使用的【酒】结算后，可以将此【酒】对应的实体牌交给你并令你流失一点体力，然后你可以令其摸两张牌。",
                    "ssr_newjiuchi": "酒池",
                    "ssr_newjiuchi_info": "主公技，其他群雄角色的出牌阶段开始时，若该角色拥有技能〖讨伐〗，其可以令你摸一张牌，然后移除〖讨伐〗并视为使用一张【酒】。",
                    "ssr_newmizhou": "秘咒",
                    "ssr_newmizhou_info": "出牌阶段，你可以将一张牌置于武将牌上，然后为其声明一种基本牌或锦囊牌，称之为“箓”。结束阶段，你将每张未转化的“箓”进行判定：①若声明的牌与“箓”不为同一个类型，则需花色与“箓”相同；②若声明的牌与“箓”为同一个类型，则需颜色与“箓”相同；③若声明的牌与“箓”为同一个名称，则无任何判定条件。判定成功后，此“箓”转化为“蛊”，当一名其他角色使用或打出一张与“蛊”名称相同的牌时，你可以将“蛊”弃置并令该牌无效，然后该角色失去一点体力。（你的武将牌上最多可同时存在四张“箓”）",
                    "ssr_mizhou": "秘咒",
                    "ssr_mizhou_info": "出牌阶段，你可以将任意张手牌反面朝上置于你的武将牌上，称之为“咒”；当其他角色使用或打出与“咒”同名的牌时，你可展示并弃置该“咒”，使此牌无效，然后使该角色流失一点体力。（你的武将牌上最多只能存在四张“咒”，且你于出牌阶段开始时获得所有的“咒”）",
                    "ssr_chanyuan": "缠怨",
                    "ssr_chanyuan_info": "锁定技，杀死你的角色在之后四轮内进入并保持混乱状态。（进入混乱状态的角色无法自我控制，以对自我不利的形式进行操作）",
                    "ssr_newluanji": "乱击",
                    "ssr_newluanji_info": "出牌阶段限三次，你可以将两张牌当【万箭齐发】使用，每回合你以此法使用的牌中不能超过两张非基本牌；游戏开始时，你修改【万箭齐发】的效果。",
                    'ssr_wanjian': '万箭齐发',
                    'ssr_wanjian_info': '出牌阶段,对所有其他角色使用。每名目标角色选择一项：①打出一张【闪】；②弃置一张装备牌和非装备牌并视为受到你造成的1点伤害；③受到你造成的1点伤害。',
                    "ssr_luanji": "乱击",
                    "ssr_luanji_info": "你可以将任意两张基本牌当做【万箭齐发】使用，你使用的【万箭齐发】无视防具。",
                    "ssr_dingsheng": "鼎盛",
                    "ssr_dingsheng_info": "锁定技，每回合限一次，当你失去牌时，若你失去牌的数量不少于两张，你摸一张牌；【万箭齐发】对你无效；你的【万箭齐发】不能被【无懈可击】响应。",
                    "ssr_newdingsheng": "鼎盛",
                    "ssr_newdingsheng_info": "锁定技，①每回合限一次，当你一次性失去至少两张牌后，你从牌堆中随机获得一张装备牌；②你使用【万箭齐发】无视目标防具且不能被【无懈可击】响应。",
                    "ssr_xueyi": "血裔",
                    "ssr_xueyi_info": "主公技，每名角色限一次：当一名角色进入濒死状态时，若其为忠臣，其可亮出身份牌并将体力回复至一，然后若其势力为群雄，其获得技能〖鼎盛〗。",
                    "ssr_newshiyi": "世裔",
                    "ssr_newshiyi_info": "主公技，你或该角色的回合内，当一名其他群雄角色一次性失去至少两张牌后，其可以与你各摸一张牌，然后若其没有〖鼎盛〗，其获得一枚“爵”标记；当一名角色拥有三枚“爵”标记时，其移除所有标记并获得技能〖鼎盛〗。",
                    "ssr_shiyi": "世裔",
                    "ssr_shiyi_info": "主公技，锁定技，你即将杀死一名角色时，你取消其击杀来源并摸一张牌；限定技，一名角色的【杀】造成伤害后，若其身份为忠臣，其可以将身份牌明置，获得一枚“兵”和技能〖鼎盛〗，你的“兵”标记可以替你承受等量的伤害。（你每有一枚“兵”，你的手牌上限便加一）",
                    "ssr_juejing": "绝境",
                    "ssr_juejing_info": "锁定技，游戏开始时，你废除你的判定区；你的武将牌始终正面向上，且你不能被横置或成为拼点的目标。",
                    "ssr_kuangao": "狂傲",
                    "ssr_kuangao_info": "出牌阶段限一次，你可以令一名其他角色进行选择：交给你一张【杀】，然后令你本回合内使用【杀】不能被响应，且可以额外使用一张【杀】；或弃置你的一张牌。",
                    "ssr_qimou": "奇谋",
                    "ssr_qimou_info": "限定技，出牌阶段，你可以将武将牌翻面，然后指定一名其他角色：本回合内你对其造成的所有伤害翻倍，且其不能使用或打出任何牌。",
                    "ssr_xuanhuo": "眩惑",
                    "ssr_xuanhuo_info": "出牌阶段限一次，你可以弃置一张非基本牌并指定一名其他角色，直到你的下个回合开始，若其体力值大于零：①该角色的所有手牌均视为【杀】；②其出牌阶段可以额外使用一张【杀】；③其出牌阶段使用第二张【杀】时你摸一张牌，然后若该角色为你，你移除〖眩惑〗的效果。",
                    "ssr_fabing": "法兵",
                    "ssr_fabing_info": "锁定技，出牌阶段，当你使用第一张【杀】时，你改为视为使用一张任意属性的【杀】或单个目标的非延时锦囊牌。（计入【杀】的使用次数）",
                    "ssr_newfabing": "法兵",
                    "ssr_newfabing_info": "当你使用一张【杀】指定目标后，你可以令此牌改成一张任意锦囊牌或任意属性的【杀】。",
                    "ssr_lianhuan": "连环",
                    "ssr_lianhuan_info": "出牌阶段限两次，你可以弃置一张梅花牌并指定至多三名角色：这些角色进入或解除连锁状态：①当处于连锁状态的角色成为锦囊牌或【杀】的唯一目标后，其解除连环状态，然后其他一名处于连锁状态的角色视为也被使用同样的牌；②当场上最后一名角色解除连环状态时，在结算后你摸一张牌。",
                    "ssr_newsance": "三策",
                    "ssr_newsance_info": "出牌阶段限一次，你可以视为使用一张【袭城】、【围城】或【守城】：当你因此牌造成了伤害或回复体力，则本回合你的手牌上限加二，本局游戏内你可以使用此牌的花色来发动〖连环〗。",
                    "ssr_newsance_xicheng_pile": "袭城",
                    "ssr_newsance_xicheng_pile_info": "出牌阶段对一名其他角色使用，你可以令一名角色展示一张手牌：若其选择展示且牌为【杀】，则视为其对你使用此【杀】；否则你对其造成一点伤害。",
                    "ssr_newsance_weicheng_pile": "围城",
                    "ssr_newsance_weicheng_pile_info": "出牌阶段对一名其他角色使用，你可以令一名角色摸一张牌并交给你一张牌，你可以弃置其交给你的牌然后视为对其使用一张无次数限制的【杀】。",
                    "ssr_newsance_shoucheng_pile": "守城",
                    "ssr_newsance_shoucheng_pile_info": "出牌阶段对自己使用，你翻开牌堆顶的三张牌，然后你选择其中的一张：若该牌为红桃牌，则你回复一点体力；否则你获得此牌。",
                    "ssr_sance": "三策",
                    "ssr_sance_info": "陨星技，游戏开始时，你获得三枚“策”标记，你的“策”标记可以当作任意基本牌或锦囊牌使用或打出。",
                    "ssr_newxiebian": "诡变",
                    "ssr_newxiebian_info": "准备阶段，你可以选择并执行以下其中一项：〖浮屠〗、〖梵天〗、〖修罗〗或〖释迦〗。",
                    "ssr_newxiebian_futu_pile": "浮屠",
                    "ssr_newxiebian_futu_pile_info": "跳过判定阶段，获得判定区的所有牌，直到下回合开始你不能成为延时锦囊牌的目标。",
                    "ssr_newxiebian_fantian_pile": "梵天",
                    "ssr_newxiebian_fantian_pile_info": "跳过摸牌阶段，获得至多两名角色各一张手牌，直到下回合开始你不能成为普通锦囊牌的目标。",
                    "ssr_newxiebian_xiuluo_pile": "修罗",
                    "ssr_newxiebian_xiuluo_pile_info": "跳过出牌阶段，移动场上的一张牌，直到下回合开始你不能成为基本牌的目标。",
                    "ssr_newxiebian_shijia_pile": "释迦",
                    "ssr_newxiebian_shijia_pile_info": "跳过弃牌阶段，观看一名角色的手牌并弃置其中一张，直到下回合开始你不能成为装备牌的目标。",
                    "ssr_motu": "末途",
                    "ssr_motu_info": "每轮限一次，当你受到伤害后，若你有手牌且体力值不大于一，你随机失去一张手牌然后获得一点护甲。",
                    "ssr_xiebian": "械变",
                    "ssr_xiebian_info": "每回合限一次，你可以选择一项：跳过你的摸牌阶段，然后获得至多两名角色各一张手牌，并获得技能〖梵天〗；跳过你的出牌阶段，然后移动场上的一张牌，并获得技能〖修罗〗；跳过你的弃牌阶段，然后摸一张牌，并获得技能〖释迦〗，你的“械”标记可以替你承受等量的伤害。（你因〖诡变〗获得的技能在你的下个回合开始失效，你每有一枚“械”，你的手牌上限便加一）",
                    "ssr_xiebian_futu": "浮屠",
                    "ssr_xiebian_futu_info": "锁定技，每当你受到一点伤害后，你进行一次判定：若为黑桃，你获得一枚“械”标记，否则你随机获得一张装备牌并可以使用之。",
                    "ssr_xiebian_fantian": "梵天",
                    "ssr_xiebian_fantian_info": "锁定技，每当你受到一点伤害后，你进行一次判定：若为红桃，你获得一枚“械”标记，否则你随机获得一张延时锦囊牌并可以使用之。",
                    "ssr_xiebian_xiuluo": "修罗",
                    "ssr_xiebian_xiuluo_info": "锁定技，每当你受到一点伤害后，你进行一次判定：若为梅花，你获得一枚“械”标记，否则你随机获得一张基本牌并可以使用之。",
                    "ssr_xiebian_shijia": "释迦",
                    "ssr_xiebian_shijia_info": "锁定技，每当你受到一点伤害后，你进行一次判定：若为方块，你获得一枚“械”标记，否则你随机获得一张普通锦囊牌并可以使用之。",
                    "ssr_xunxun": "恂恂",
                    "ssr_xunxun_info": "锁定技，你最大的一点体力始终转化为一点护甲：①当你拥有超过一点护甲时，你移除多余的护甲并可以视为使用一张【调兵遣将】；②当你拥有护甲时你增加一张手牌上限；③准备阶段，若你没有护甲，你可以观看牌堆顶的四张牌，若其中存在装备牌则你回复一点体力，然后将其中的两张牌置于牌堆顶，将其余的牌置于牌堆底。",
                    "ssr_wangxi": "忘隙",
                    "ssr_wangxi_info": "每当你受到/造成一点伤害后，你观看并展示牌堆顶的两张牌，然后你可以选择获得其中一张牌，若如此做，来源/目标获得另一张牌。",
                    "ssr_jueqing": "绝情",
                    "ssr_jueqing_info": "锁定技，你造成或受到的伤害均视为流失体力。",
                    "ssr_shangshi": "伤逝",
                    "ssr_shangshi_info": "每回合限四次，当场上有一名角色流失体力后，若其存活，你可以令该角色选择一项：弃X张牌；或令你摸X张牌。（X为该角色流失体力的数值）",
                    "ssr_fangzhu": "放逐",
                    "ssr_fangzhu_info": "出牌阶段限一次，你可以翻开牌堆顶的三张牌，选择至少一张交给一名其他角色，然后令该角色翻面。",
                    "ssr_xingshang": "行殇",
                    "ssr_xingshang_info": "当有一名角色受到伤害时，若其没有技能〖酒诗〗，你可以立即令其获得技能〖酒诗〗并摸一张牌直到其回合结束。",
                    "ssr_jiushi": "酒诗",
                    "ssr_jiushi_info": "当你需要使用【酒】时，你可以翻面并视为使用一张【酒】。当你受到伤害后，若你的武将牌背面朝上，你可以将武将牌翻面并摸一张牌。",
                    "ssr_songwei": "颂威",
                    "ssr_songwei_info": "主公技，锁定技，游戏开始时，你令所有的反贼展示身份，然后令所有魏势力的角色各摸一张牌。",
                    "ssr_jieliang": "截粮",
                    "ssr_jieliang_info": "出牌阶段限两次，你可以弃置一张黑色非锦囊牌，然后令一名其他角色获得一枚“截”标记。每当有“截”标记的角色获得牌时，其进行一次判定：若不为梅花，其将获得的所有牌置于武将牌上，称为“粮”，对该角色造成伤害的角色可以从其武将牌上获得一张“粮”，若如此做，之后其可以拿回一张“粮”；该角色每回合结束时若其有“截”标记，其移除一枚“截”，若其没有“截”标记，其获得武将牌上所有的“粮”。",
                    "ssr_zhiyan": "治严",
                    "ssr_zhiyan_info": "当你受到伤害后，你每满足以下一项，你可以从牌堆中获得一张黑色非锦囊牌：①你的手牌数小于体力上限；②你的装备数小于你的体力值。",
                    "ssr_newyinghun": "英魂",
                    "ssr_newyinghun_info": "锁定技，每回合限一次，出牌阶段开始前，你获得一枚“疆”标记并进行一个额外的出牌阶段：此阶段内，你的锦囊牌均视为【决斗】，你的基本牌均视为【杀】且没有距离限制；你于本阶段内每造成一次伤害，你获得一枚“疆”标记。此阶段结束时，你移除所有的“疆”标记，指定一名角色并选择一项：令其摸X张牌然后弃一张牌；或令其摸一张牌然后弃X张牌。（X为你弃置“疆”标记的数量）",
                    "ssr_xinyinghun": "英魂",
                    "ssr_xinyinghun_info": "锁定技，摸牌阶段你额外摸一张牌，你的手牌上限+X。（X为场上存在“归疆”标记的数量）",
                    "ssr_futu": "伏土",
                    "ssr_futu_info": "出牌阶段限两次，你可以与一名其他角色进行拼点：①若你胜利，且该角色未有“归疆”标记，则你选择令其获得一枚“归疆”标记然后双方各摸一张牌，或者视为对其使用一张无距离和次数限制的【杀】；②若你胜利，且该角色拥有“归疆”标记，则你获得双方的拼点牌；③场上每有一枚“归疆”标记，未拥有此标记的其他角色在成为拼点目标时点数便减一。（不会小于A）",
                    "ssr_newpolu": "破虏",
                    "ssr_newpolu_info": "觉醒技，准备阶段，当场上所有的其它角色均拥有“归疆”标记，你扣减一点体力上限，增加一点护甲并获得技能〖英魂〗和〖制霸〗。",
                    "ssr_yinghun": "英魂",
                    "ssr_yinghun_info": "准备阶段，你可以投掷两枚骰子并指定一名角色：你令该角色摸一枚骰子点数的牌，然后弃置另一枚骰子点数的牌。",
                    "ssr_polu": "破虏",
                    "ssr_polu_info": "锁定技，当你使用【杀】指定目标后，你投掷一枚骰子：若该角色的手牌或装备牌中存在该点数的牌，你令该角色弃置这些牌，且此【杀】不可被闪避。",
                    "ssr_shenfen": "神愤",
                    "ssr_shenfen_info": "觉醒技，锁定技，当你的“暴怒”标记首次达到六枚时，你立即获得技能〖神威〗，然后装备【炼狱斩戟】、【修罗重铠】、【梦魇赤兔】和【邪神面具】。",
                    "ssr_kuangbao": "狂暴",
                    "ssr_kuangbao_info": "锁定技，游戏开始时，你获得两枚“暴怒”标记，当你造成或受到伤害后，你获得X枚“暴怒”标记。（X为伤害的点数，且每张牌只取最高的一次伤害，你的“暴怒”标记最多不超过六枚）",
                    "ssr_jiwu": "极武",
                    "ssr_jiwu_info": "当你拥有“暴怒”标记时，你可以将三枚“暴怒”标记当做一张【酒】使用。",
                    "ssr_newshenwei": "神威",
                    "ssr_newshenwei_info": "锁定技，你装备区外的装备牌均视为【杀】；每当你失去【炼狱斩戟】、【修罗重铠】、【梦魇赤兔】和【邪神面具】中的任意一张装备牌时，你须选择移去一枚“暴怒”标记或者受到一点伤害，然后进行重铸：你的下个准备阶段，你重新获得并装备这张牌。",
                    "ssr_zhanshen_lianyu": "炼狱斩戟",
                    "ssr_zhanshen_lianyu_info": "锁定技，你的【杀】时可以为此额外指定两个目标，且你的【杀】无视目标的防具。",
                    "ssr_zhanshen_xiuluo": "修罗重铠",
                    "ssr_zhanshen_xiuluo_info": "锁定技，你最多只能受到一点伤害，你在回合外受到伤害后立即结束当前角色的出牌阶段。",
                    "ssr_zhanshen_mengyan": "梦魇赤兔",
                    "ssr_zhanshen_mengyan_info": "锁定技，你与其他角色计算距离减二，你造成的伤害均视为火属性且防止即将受到的火属性伤害。",
                    "ssr_zhanshen_xieshen": "邪神面具",
                    "ssr_zhanshen_xieshen_info": "锁定技，你的武将牌始终正面朝上，你不能被横置，且不能成为延时锦囊牌和拼点的目标。",
                    "ssr_dimeng": "缔盟",
                    "ssr_dimeng_info": "准备阶段，你可以指定两名其他角色：你令手牌数量少的一方获得X枚“盟”标记，然后双方交换手牌；拥有“盟”的角色对你使用【杀】时，你移除其一枚“盟”标记并摸一张牌。（X为两名角色的手牌数量差，拥有“盟”的角色摸牌阶段可弃置一枚“盟”标记并额外摸一张牌）",
                    "ssr_fuhui": "赴会",
                    "ssr_fuhui_info": "锁定技，当你进行拼点时，若你的手牌区有牌，则你的拼点牌点数加X；当你使用【杀】或【决斗】指定目标或成为【杀】或【决斗】的目标后，若对方有手牌，你可以摸一张牌然后令此牌的来源与目标进行拼点：若来源胜利，则此牌不可被目标闪避；若目标胜利，则此牌对目标无效。（X为你的手牌数，且点数最终不会超过K）",
                    "ssr_zhijian": "直谏",
                    "ssr_zhijian_info": "出牌阶段，你可以将一张牌交给一名角色：①直到这张牌离开该角色的手牌区或该角色受到伤害，该角色不能弃置这张牌，不能使用或打出这张牌以外的牌；②当该角色因失去此牌而完全解锁①效果时，拥有〖直谏〗的角色摸两张牌，因受到伤害而完全解锁①效果时，拥有〖直谏〗的角色随机弃置一张手牌。",
                    "ssr_guzheng": "固政",
                    "ssr_guzheng_info": "每回合限一次，当有一名角色因弃置而失去了牌时，你可以从弃置的牌中选择一张回到该角色的手牌。",
                    "ssr_guidao": "鬼道",
                    "ssr_guidao_info": "锁定技，你的判定阶段改为在结束阶段前进行；出牌阶段限两次，你可以将一张手牌背面朝上置于一名没有“咒”的其他角色的武将牌上，称为“咒”：①当武将牌上有“咒”的角色进行判定阶段判定时，若此“咒”作为判定结果能使判定效果不利，则这张“咒”作为判定牌生效；②当武将牌上有“咒”的角色使用与“咒”相同颜色的牌时，取消该牌的所有目标，然后该角色失去此“咒”；③当武将牌上有“咒”的角色死亡后，“咒”回到施咒者的手牌。（“咒”的牌对其他角色不可见）",
                    "ssr_zhuji": "助祭",
                    "ssr_zhuji_info": "主公技，其他群雄角色的准备阶段，其可以弃置一张牌并令你发动一次〖皇天〗。",
                    "ssr_zhangsan": "改命",
                    "ssr_xianji": "献祭",
                    "ssr_huangtian": "皇天",
                    "ssr_huangtian_info": "祈天技，雷电相关卡牌不能对你产生效果，准备阶段，你进行一次判定，当你的判定结果包含了四种花色，则此技能视为觉醒技发动：你回复两点体力，若你的判定区内没有【闪电】，你将一张【闪电】置入判定区，然后你令“咒”增加〖惊雷〗的效果。",
                    "ssr_houtu": "后土",
                    "ssr_houtu_info": "祈天技，火焰相关卡牌不能对你产生效果，准备阶段，你进行一次判定，当你的判定结果包含了三种类别，则此技能视为觉醒技发动：你回复两点体力，若你的判定区内没有【火山】，你将一张【火山】置入判定区，然后你令“咒”增加〖烈火〗的效果。",
                    "ssr_cangsheng": "苍生",
                    "ssr_cangsheng_info": "祈天技，寒冰相关卡牌不能对你产生效果，准备阶段，你进行一次判定，当你的判定结果点数和不少于36点，则此技能视为觉醒技发动：你回复两点体力，若你的判定区内没有【洪水】，你将一张【洪水】置入判定区，然后你令“咒”增加〖寒冰〗的效果。",
                    "ssr_newguidao": "鬼道",
                    "ssr_newguidao_info": "你可以将一张黑色的牌当【草木皆兵】使用。",
                    "ssr_gaiming": "改命",
                    "ssr_gaiming_info": "在你的判定牌生效前，你可以打出一张牌替换之。",
                    "ssr_tianlei": "黄天",
                    "ssr_tianlei_info": "祈天技，锁定技，准备阶段你进行两次判定：当你之前的判定结果累积四种花色后，你清空计数，然后可以对一名角色造成三点雷电伤害。",
                    "ssr_dihuo": "后土",
                    "ssr_dihuo_info": "祈天技，锁定技，准备阶段你进行两次判定：当你之前的判定结果累积三种类型后，你清空计数，然后可以对一名已横置的其他角色造成两点火焰伤害。",
                    "ssr_renhong": "苍生",
                    "ssr_renhong_info": "祈天技，锁定技，准备阶段你进行两次判定：当你之前的判定结果点数累积满足36后，你清空计数，然后可以令至多两名其他角色随机弃置两张牌。",
                    "ssr_guifu": "诡符",
                    "ssr_guifu_info": "出牌阶段限两次，你可以将一张手牌置于一名其他角色的武将牌上：当该角色使用与其颜色相同的牌时，其取消此牌的所有目标，然后该角色横置并移除武将牌上的牌。",
                    "ssr_fangtong": "方统",
                    "ssr_fangtong_info": "出牌阶段限一次，你可以指定一名其他角色并展示一张手牌，然后你令该角色选择：①展示一张点数不大于此牌的手牌；②受到来自你的一点伤害，然后你弃置此牌。",
                    "ssr_guidao_thunder": "惊雷",
                    "ssr_guidao_thunder_info": "“咒”的①时机改为进行【闪电】判定时；“咒”的②效果改为：当武将牌上有“咒”的角色使用与“咒”相同花色的牌时，其受到两点雷属性伤害，然后其非锁定技失效直到回合结束，结算完成后其失去此“咒”。",
                    "ssr_guidao_fire": "烈火",
                    "ssr_guidao_fire_info": "“咒”的①时机改为进行【火山】判定时；“咒”的②效果改为：当武将牌上有“咒”的角色使用与“咒”相同类别的牌时，其需交给施咒者一张与“咒”类别相同的牌，否则其受到一点火属性伤害，之后本回合内其不能使用或打出任何的牌，结算完成后其失去此“咒”。",
                    "ssr_guidao_ice": "寒冰",
                    "ssr_guidao_ice_info": "“咒”的①时机改为进行【洪水】判定时；“咒”的②效果改为：当武将牌上有“咒”的角色使用一张牌时，其需弃置与点数总和不小于“咒”的手牌，否则此牌无效，该角色翻至背面，结算完成后若本回合为该角色的回合，其立即结束回合并失去此“咒”。",
                    "ssr_zhuhai": "诛害",
                    "ssr_zhuhai_info": "其他角色的结束阶段开始时，若其于本回合内造成过伤害，你可以将一张手牌当做【杀】对其使用。",
                    "ssr_yijian": "遗荐",
                    "ssr_yijian_info": "终焉技，当你成为其他角色锦囊牌的目标时，你获得一枚“言”标记并摸一张牌，当你的“言”标记超过两枚时，则此技能视为觉醒技发动，你立即失去一点体力上限，获得技能〖无言〗，然后可以令一名其他角色获得技能〖卧龙〗。",
                    "ssr_wuyan": "无言",
                    "ssr_wuyan_info": "锁定技，你使用的锦囊牌对其他角色无效；其他角色使用的锦囊牌对你无效。",
                    "ssr_wolong": "卧龙",
                    "ssr_wolong_info": "转换技，锁定技，准备阶段，你摸一张牌，阴：你获得技能〖看破〗直到下次转换；阳：你获得技能〖火计〗直到下次转换。",
                    //lib.translate._XC7_zhengli = "整理";
                    "yuanqi_yidun": "移盾",
                    "yuanqi_yidun_info": "每轮限一次，当你使用或打出一张【闪】时，你回复一点护盾。",
                    "yuanqi_fazhang": "法杖",
                    "yuanqi_fazhang_info": "你使用单体非延时锦囊牌时可以额外指定一名角色作为目标。",
                    "yuanqi_xingyun": "幸运",
                    "yuanqi_xingyun_info": "在你进行判定前，你将牌堆顶的三张牌中对你判定结果最有利的一张牌置于牌堆顶。",
                    "yuanqi_lianfa": "连发",
                    "yuanqi_lianfa_info": "你使用【杀】对一名距离大于一或非上下家的角色结算完毕后，你视为对该角色再使用一张【杀】。",
                    "yuanqi_shuangdun": "双盾",
                    "yuanqi_shuangdun_info": "你的护盾上限加二，受到无属性伤害加一，护盾消失后，你将护盾恢复至满。（冷却时间：3轮）",
                    "yuanqi_yisu": "移速",
                    "yuanqi_yisu_info": "每张卡限一次，当你使用的【杀】命中角色目标后，你摸一张牌。",
                    "yuanqi_yizhi": "抑制",
                    "yuanqi_yizhi_info": "当你使用【杀】造成伤害时，你令该角色的护盾恢复延迟一个回合。（不可叠加）",
                    "yuanqi_zengxiao": "增效",
                    "yuanqi_zengxiao_info": "每回合限一次，当你于摸牌阶段外摸牌时，你额外摸一张牌。",
                    "yuanqi_zhiyu": "治愈",
                    "yuanqi_zhiyu_info": "当你回复体力时，若你的体力值不大于上限的一半，你额外回复一点体力。（冷却时间：3回合）",
                    "yuanqi_tubian": "突变",
                    "yuanqi_tubian_info": "你令你的手牌上限始终视为减少一张，然后你增加两个天赋槽位。",
                },
            },
            intro: "",
            //author:"<span class=\"helasisytext\" style=\"color:#87CEFA\">Helasisy星云</span>",
            author: "",
            diskURL: "",
            forumURL: "",
            version: game.zuanversion,
        },
        files: {
            "character": [],
            "card": [],
            "skill": []
        }
    }
});
game.import("extension",
function(lib, game, ui, get, ai, _status) {
    return {
        name: "祖安设置",
        editable: false,
        content: function(config, pack) {
            //delete lib.extensionMenu.extension_祖安设置.author;
            delete lib.extensionMenu.extension_祖安设置.delete;
            delete lib.extensionMenu.extension_祖安设置.enable;
            //delete lib.extensionMenu.extension_祖安设置.edit;
            /*var zuangroups=['wei','shu','wu','qun'];
		    for(var i=0;i<zuangroups.length;i++) {
		        var sort='zuanpack_'+zuangroups[i];
		        if(!lib.characterSort['mode_extension_祖安设置'][sort]) {
		            lib.characterSort['mode_extension_祖安设置'][sort]=[];
		            lib.translate[sort]=get.translation(zuangroups[i])+'武将包';
		        }
		    }*/
            // ---------------------------------------删除key------------------------------------------//
            if (lib.config['extension_祖安设置_delkey']) {
                for (var a in lib.character) {
                    var him = lib.character[a];
                    if (!him || (a.indexOf('key_') == -1 && lib.character[a][1] != 'key')) continue;
                    lib.character[a][4].push('unseen');
                    lib.character[a][4].push('forbidai');
                }
            }
            // ---------------------------------------武将包分类------------------------------------------//
            lib.zuanPack = lib.characterPack["mode_extension_祖安武将"];
            lib.zuanCard = lib.cardPack["mode_extension_祖安武将"];
            var zuanpack = lib.characterPack["mode_extension_祖安武将"];
            var groups = ['wei', 'shu', 'wu', 'qun'];
            lib.characterSort['mode_extension_祖安武将'] = {};
            for (; groups.length > 0;) {
                var group = groups.randomGet();
                var sort = 'zuanpack_' + group;
                if (!lib.characterSort['mode_extension_祖安武将'][sort]) {
                    lib.characterSort['mode_extension_祖安武将'][sort] = [];
                    lib.translate[sort] = get.translation(group) + '·势力武将';
                }
                groups.remove(group);
            }
            for (var a in zuanpack) {
                var name = a;
                var sort = 'zuanpack_' + lib.character[a][1];
                if (!lib.characterSort['mode_extension_祖安武将'][sort]) {
                    lib.characterSort['mode_extension_祖安武将'][sort] = [];
                    lib.translate[sort] = get.translation(lib.character[a][1]) + '·势力武将';
                }
                lib.characterSort['mode_extension_祖安武将'][sort].push(a);
                if (lib.config['extension_祖安设置_hidessr']) {
                    //delete lib.characterPack['mode_extension_祖安武将'][a];
                    lib.character[a][4].push("unseen");
                    lib.character[a][4].push("minskin");
                }
            }
            if (lib.config['extension_祖安设置_hidessr']) {
                delete lib.characterPack["mode_extension_祖安武将"];
            }
            delete lib.cardPack["mode_extension_祖安武将"];
            game.getRandomInt = function(min, max) {
                return Math.floor(Math.random() * (max - min + 1)) + min;
            };
            // ---------------------------------------开发者模式------------------------------------------//
            if (1 == 0) {
                lib.config['extension_祖安设置_upspeed'] = '0';
                lib.config['extension_祖安设置_newui'] = '4';
                lib.config['extension_祖安设置_helasisy'] = true;
                if (1 == 0) {
                    lib.config['extension_祖安设置_bizhi'] = '3';
                    lib.config['extension_祖安设置_wallpaper'] = '10';
                }
                lib.config['extension_祖安设置_text'] = true;
                lib.config['extension_祖安设置_isPC'] = '1';
            }
            if (lib.config.plays.contains('coin')) {
                if (lib.config.coin != 99999999) game.changeCoin(99999999 - lib.config.coin);
            }
            //这个表示我打开了这个扩展
            game.zuanwujiang = true;
            game.zuanversion = 19;
            // ---------------------------------------武将评级------------------------------------------//
            // 我全部SSS哼
            lib.characterPackSSRPingji = {
                "ssr": lib.zuanPack
            }
            var rank = lib.rank.rarity;
            for (var a in lib.characterPackSSRPingji) {
                for (var b in lib.characterPackSSRPingji[a]) {
                    var name = b;
                    if (!rank.legend.contains(name)) rank.legend.push(name);
                    //lib.character[name][4].add('No_Outcrop');
                }
            }
            // ---------------------------------------手机端检测------------------------------------------//
            // ---------------------------------------手机端检测------------------------------------------//
            // ---------------------------------------错误还原------------------------------------------//
            localStorage.setItem("zuanasset", lib.assetURL);
            if (lib.config['extension_祖安设置_startgame']) {
                var itemd = lib.config['extension_祖安设置_startgame'];
                if (itemd.indexOf('next_') != -1) {
                    lib.config['extension_祖安设置_startgame'] = itemd.slice(5);
                }
                localStorage.setItem("zuanstart", lib.config['extension_祖安设置_startgame']);
            } else {
                localStorage.setItem("zuanstart", 'off');
            }
            lib.config.yuanqilist = ['yuanqi_xuexiang', 'yuanqi_qianghua', 'yuanqi_fantan', 'yuanqi_taoyi', 'yuanqi_diaoxiang', 'yuanqi_zhenshang', 'yuanqi_suji', 'yuanqi_nengliang', 'yuanqi_lengque', 'yuanqi_jinzhan', 'yuanqi_bingdun', 'yuanqi_yiwang', 'yuanqi_shangdian', 'yuanqi_xuanze', 'yuanqi_landun', 'yuanqi_huodun', 'yuanqi_dudun', 'yuanqi_cidun', 'yuanqi_xuedun', 'yuanqi_hudun', 'yuanqi_suidun', 'yuanqi_zishou', 'yuanqi_yaoshui', 'yuanqi_xilan', 'yuanqi_xixue', 'yuanqi_xuli', 'yuanqi_xiandan', 'yuanqi_miaozhun', 'yuanqi_jiguang', 'yuanqi_fanshe', 'yuanqi_yuansu', 'yuanqi_chuantou', 'yuanqi_fangyu', 'yuanqi_xiudun', 'yuanqi_leidun', 'yuanqi_shuangwu', 'yuanqi_chongwu', 'yuanqi_guidun', 'yuanqi_shixue', 'yuanqi_kuangbao', 'yuanqi_zhadan', 'yuanqi_jindun', 'yuanqi_yidun', 'yuanqi_fazhang', 'yuanqi_xingyun', 'yuanqi_lianfa', 'yuanqi_shuangdun', 'yuanqi_yisu', 'yuanqi_yizhi', 'yuanqi_zengxiao', 'yuanqi_zhiyu', 'yuanqi_tubian'];
            lib.config['extension_祖安设置_informknow'] = '0';
            lib.config['extension_祖安设置_about3'] = '1';
            lib.config['extension_祖安设置_falseedit'] = '0';
            lib.config.zuanboss = 1;
            lib.config.zuanusecardTX = 'none';
            if (parseFloat(lib.config['extension_祖安设置_mode']) != '1' && parseFloat(lib.config['extension_祖安设置_upspeed']) == '0') {
                game.saveConfig('extension_祖安设置_upspeed', '10');
            }
            var wallpaper = parseFloat(lib.config['extension_祖安设置_wallpaper']);
            if (wallpaper == '0' || wallpaper == '2' || wallpaper == '6') lib.config['extension_祖安设置_wallpaper']++;
            var bizhi = parseFloat(lib.config['extension_祖安设置_bizhi']);
            if (bizhi == '0' || bizhi == '2' || bizhi == '4') lib.config['extension_祖安设置_bizhi']++;
            var items = lib.config['extension_祖安设置_zhishixian'];
            if (items.indexOf('next_') != -1) {
                lib.config['extension_祖安设置_zhishixian'] = items.slice(5);
            }
            if (parseFloat(lib.config['extension_祖安设置_zuancoveropacity']) != 'NaN') {
                lib.config.zuancoveropacity = parseFloat(lib.config['extension_祖安设置_zuancoveropacity'] * 0.1);
            } else {
                lib.config.zuancoveropacity = '0.8';
            }
            /*
		    if(parseFloat(lib.config['extension_祖安设置_isPC'])=='2') {
		        if(parseFloat(lib.config['extension_祖安设置_fun'])=='7') {
		        lib.config['extension_祖安设置_fun']='1';
		        alert('抱歉！   _(´ཀ`」 ∠)__ \n      目前由于特殊字符的原因，为防止出现错误，元气系统 在电脑端暂不能使用！\n      已为您暂时关闭此 娱乐玩法。\n      再次选择 娱乐玩法 的其他选项后将不会再次出现此弹窗。');
		        }
		    }
		    */
            //getitem
            // ---------------------------------------本地变量获取------------------------------------------//
            game.getLocalItem = function(filename, part) {
                var getsum = localStorage.getItem(filename);
                if (!getsum) getsum = "";
                if (!part) {
                    return getsum;
                } else {
                    return getsum.indexOf(part) != -1;
                }
            };
            // ---------------------------------------千幻聆音的文件判断系统------------------------------------------//
            //ccad
            game.giveChkCad = function() {
                if (!game.folderExt('extension/祖安武将/character')) return false;
                lib.chkcad = [];
                lib.chkreplace = [];
                var add = 0;
                for (var name in lib.character) {
                    var infile = name;
                    lib.chkreplace[name] = false;
                    if (!game.folderExt('extension/祖安武将/character/' + name)) {
                        var pushnum = name.lastIndexOf('_') + 1;
                        var name2 = name.slice(pushnum);
                        //alert(pushnum);
                        //alert(name2);
                        if (game.folderExt('extension/祖安武将/character/' + name2)) {
                            infile = name2;
                            lib.chkreplace[name] = name2;
                        }
                    }
                    game.cadfolder('extension/祖安武将/character/' + infile, name);
                }
            };
            game.isExt = function(path, callback) {
                if (lib.node && lib.node.fs) {
                    try {
                        var stat = lib.node.fs.statSync(__dirname + '/' + path);
                        callback(stat);
                    } catch(e) {
                        callback(false);
                        return;
                    }
                } else {
                    resolveLocalFileSystemURL(lib.assetURL + path, (function(name) {
                        return function(entry) {
                            callback(true);
                        }
                    } (name)),
                    function() {
                        callback(false);
                    });
                }
            };
            game.isExttrue = false;
            game.cadfolder = function(folder, him) {
                game.isExt(folder,
                function(s) {
                    if (s) {
                        game.getFileList(folder,
                        function(folders, files) {
                            //alert(files);
                            if (files) {
                                lib.chkcad[him] = files;
                                //return files;
                            } else {
                                lib.chkcad[him] = false;
                                //return false;
                            }
                            return game.cadpic;
                        });
                    } else {
                        lib.chkcad[him] = false;
                    }
                    return;
                });
                return;
            };
            game.folderExt = function(fs) {
                game.isExt(fs,
                function(s) {
                    if (s) {
                        game.isExttrue = true;
                    } else {
                        game.isExttrue = false;
                    }
                });
                return game.isExttrue;
            };
            // ---------------------------------------处理dying显示------------------------------------------//
            game.dyingShow = function(player, newui) {
                'step 0';
                if (!game.getLocalItem('ZUANbingletexiaoSET', '_')) {
                    if (event && event.finish) {
                        event.finish();
                    } else {
                        return;
                    }
                }
                'step 1';
                //alert(player.name);
                var rdying = false;
                if (player.hasSkill('zuan_hudun')) {
                    if (player.hp <= 1 && player.countMark('zuan_hudun') < 1) rdying = true;
                } else {
                    if (player.maxHp > 1) {
                        if (player.hp <= 1) rdying = true;
                    } else {
                        if (player.hp <= 0) rdying = true;
                    }
                }

                if (rdying && !player.storage.dyingimgshow && game.getLocalItem('ZUANbingletexiaoSET', 'dying')) {

                    var translists = ['none', 'tutou', 'shousha', 'zhounian'];
                    player.storage.dyingimgshow = true;
                    game.broadcastAll(function(player) {
                        player.storage.dying_img = document.createElement('div');
                        if (newui != '0') {
                            player.storage.dying_img.setBackgroundImage('extension/祖安武将/cover/' + translists[newui] + '_dying.png');
                        }
                        player.storage.dying_img.style.opacity = lib.config.zuancoveropacity;
                        player.storage.dying_img.style.backgroundSize = 'cover';
                        player.storage.dying_img.style.width = '100%';
                        player.storage.dying_img.style.height = '100%';
                        player.storage.dying_img.style.opacity = 0; //'translateY(-200px)'
                        player.node.avatar.appendChild(player.storage.dying_img);
                        ui.refresh(player.storage.dying_img);
                        player.storage.dying_img.style.opacity = 1; //transform='';
                    },
                    player);

                } else if (player.storage.dyingimgshow && !rdying) {

                    player.storage.dyingimgshow = false;
                    game.broadcastAll(function(player) {
                        player.storage.dying_img.style.opacity = 0; //'translateY(-200px)'
                        player.storage.dying_img.delete();
                    },
                    player)

                }
            };
            // ---------------------------------------新播放alive------------------------------------------//
            game.checkWH = function(width, height) {
                var widther = window.innerWidth / width;
                if (height * widther > window.innerHeight) {
                    return 'width: 100%';
                } else {
                    return 'height: 100%';
                }
            }
            window.newaliveusing = false;
            game.newalive = function(file, time, lawer) {
                "step 0";
                if (!file || !time || !lawer) return;
                if (window.zuanalivegif) return;
                if (window.newaliveusing || time <= 0.5) return;
                "step 1";
                window.newaliveusing = true;
                setTimeout(function() {
                    window.newaliveusing = false;
                },
                time * 1000 + 250);
                //('extension/祖安武将/mode/mode_hellfire.gif',3); 
                function zuangif(file, opa, click) {
                    window.zuanalivegif = ui.create.node('img');
                    zuanalivegif.src = lib.assetURL + file;
                    //alert(window.innerWidth);
                    var zuanwid = game.checkWH(zuanalivegif.width, zuanalivegif.height);
                    if (click) {
                        zuanalivegif.style.cssText = 'pointer-events: none;text-align: center;margin: auto;opacity: ' + opa * 0.1 * lawer + ';display: block;position: absolute;background:none;z-index: 999;' + zuanwid + '!important;left: 0;bottom: 0';
                    } else {
                        zuanalivegif.style.cssText = 'text-align: center;margin: auto;opacity: ' + opa * 0.1 * lawer + ';display: block;position: absolute;background:none;z-index: 999;' + zuanwid + '!important;left: 0;bottom: 0';
                    }
                    document.body.appendChild(zuanalivegif);
                }
                function zuanfora(a) {
                    zuangif(file, a, false);
                    setTimeout(function() {
                        if (a < 10) {
                            zuanalivegif.remove();
                            zuanfora(a + 1);
                        } else {
                            setTimeout(function() {
                                zuanalivegif.remove();
                                zuanforb(a - 1);
                            },
                            time * 1000 - 500);
                        }
                    },
                    25);
                }
                function zuanforb(b) {
                    zuangif(file, b, true);
                    setTimeout(function() {
                        zuanalivegif.remove();
                        if (b > 0) {
                            zuanforb(b - 1);
                        } else {
                            window.zuanalivegif = false;
                        }
                    },
                    25);
                }
                zuanfora(0);
                /*setTimeout(function () {
		            zuanalivegif.remove();
		        }, time*1000);*/
            };
            window.newaudiousing = false;
            game.newaudio = function(file, time) {
                if (window.newaudiousing) return;
                window.newaudiousing = true;
                setTimeout(function() {
                    window.newaudiousing = false;
                },
                time * 1000 + 250);
                var mp3 = lib.assetURL + file;
                var mp3 = new Audio(mp3);
                mp3.volume = lib.config.volumn_audio / 8; //mp3 的音量
                mp3.play(); //播放 mp3这个音频对象
                setTimeout(function() {
                    zuanaud(10);
                },
                time * 1000);
                function zuanaud(x) {
                    if (x < 0) {
                        mp3.remove();
                        return;
                    }
                    mp3.volume = lib.config.volumn_audio * x * 0.1 / 8;
                    setTimeout(function() {
                        zuanaud(x - 1);
                    },
                    200);
                }
            };
            // ---------------------------------------等待操作------------------------------------------//
            window.showClick = false;
            window.stopClick = false;
            window.isClicking = false;
            window.aiClicking = false;
            game.waitClick = function(time, right, wait) { //完成点击后调用game.stopClick终止计时
                window.isClicking = true;
                window.aiClicking = false;
                game.runLastTime(time, right);
                setTimeout(function() {
                    if (!window.stopClick) {
                        window.aiClicking = true;
                        ui.click.auto('forced');
                        setTimeout(function() {
                            window.aiClicking = false;
                            ui.click.auto('forced');
                        },
                        wait);
                    }
                    window.isClicking = false;
                    window.stopClick = false;
                },
                1200 * time + 1000);
            };
            game.stopClick = function() {
                window.showClick = true;
                window.stopClick = true;
                window.isLastingTime = false;
                window.isShowScreen = false;
            }
            // ---------------------------------------大弹幕倒计时------------------------------------------//
            window.isLastingTime = false;
            window.StopLastingTime = false;
            game.runLastTime = function(time, hard) {
                "step 0";
                if (window.showClick || window.StopLastingTime || window.isLastingTime || time < 0 || time >= 11) {
                    window.showClick = false;
                    window.isLastingTime = false;
                    window.StopLastingTime = false;
                    return;
                }
                "step 1";
                window.isLastingTime = true;
                game.lastTimeNum = Math.floor(time);
                if (!hard) {
                    game.lastTimeHard = 'easy';
                } else {
                    game.lastTimeHard = 'hard';
                }
                var load = 'time/' + game.lastTimeHard + '/' + time + '.png';
                game.newaudio('extension/祖安武将/audio/end.ogg', 0.5);
                game.showScreen_new(load, 0.9,
                function() {
                    game.runLastTime(time - 1, hard, event);
                });
                "step 2";
                /*setTimeout(function () {
		            game.runLastTime(time-1,hard,event);
		        }, 1000);*/
                "step 3";
                window.isLastingTime = false;
            };
            //
            game.showScreen_new = function(png, large, next) {
                'step 0';
                if (window.isShowScreen || window.showClick || !png) {
                    window.isShowScreen = false;
                    window.showClick = false;
                    return;
                }
                if (!large) large = 1;
                window.isShowScreen = true;
                if (parseFloat(lib.config['extension_祖安设置_isPC']) == '1') {
                    var present = 0.7;
                } else {
                    var present = 0.9;
                }
                var left = 30;
                var img = 'extension/祖安武将/' + png;
                var width = large * 270 * present * (img.width * present / img.height * present) * 2;
                var height = large * 270 * present * 2;
                var wwid = window.innerWidth;
                var whig = window.innerHeight;
                if (game.phshow) delete game.phshow;
                game.phshow = ui.create.node('img');
                game.phshow.src = lib.assetURL + 'extension/祖安武将/' + png;
                var huihe = parseFloat(lib.config['extension_祖安设置_huihe']);
                if (!huihe) huihe = 8;
                game.phshow.style.cssText = 'text-align: center;margin: auto;pointer-events: none;opacity: 0;display: block;width: ' + width + 'px;height: ' + height + 'px;position: absolute;top: 0;left: ' + (50 - left) + '%;bottom: 0;background:none;z-index:6;transform: translateX(-50%);';
                game.phshow.style.transition = "all 0.4s ease";
                document.body.appendChild(game.phshow);
                // ---------------------------------------图片加载失败处理------------------------------------------//  
                document.addEventListener("error",
                function(event) {
                    var asset = localStorage.getItem("zuanasset");
                    var ev = event ? event: window.event;
                    var elem = ev.target;
                    if (elem.tagName.toLowerCase() == 'img') {
                        // 图片加载失败  --替换为默认 
                        elem.src = asset + 'extension/祖安武将/effects/unknow.jpg';
                    }
                },
                true);
                setTimeout(function() {
                    game.phshow.style.left = '50%';
                    game.phshow.style.opacity = 10 / huihe;
                    setTimeout(function() {
                        game.phshow.style.left = (left + 50) + '%';
                        game.phshow.style.opacity = 0;
                        setTimeout(function() {
                            if (game.phshow) {
                                delete game.phshow;
                                game.phshow = false;
                                //if(game.phshow) game.phshow.remove();
                                window.isShowScreen = false;
                                setTimeout(function() {
                                    if (next) next();
                                },
                                100);
                            }
                        },
                        500);
                    },
                    500);
                },
                100);
            };
            // ---------------------------------------大弹幕播报------------------------------------------//
            window.isShowScreen = false;
            game.showScreen = function(png, large) {
                'step 0';
                if (window.isShowScreen || window.showClick || !png) {
                    window.isShowScreen = false;
                    window.showClick = false;
                    return;
                }
                if (!large) large = 1;
                window.isShowScreen = true;
                if (parseFloat(lib.config['extension_祖安设置_isPC']) == '1') {
                    var present = 0.7;
                } else {
                    var present = 0.9;
                }
                var img = 'extension/祖安武将/' + png;
                var width = large * 270 * present * (img.width * present / img.height * present) * 2;
                var height = large * 270 * present * 2;
                var wwid = window.innerWidth;
                var whig = window.innerHeight;
                if (parseFloat(lib.config['extension_祖安设置_isPC']) == '1') {
                    var sp = 2;
                } else {
                    var sp = 1;
                }
                if (parseFloat(lib.config['extension_祖安设置_huiheopa']) == 'NaN') {
                    var zuanspeed = 1;
                } else {
                    var zuanspeed = parseFloat(lib.config['extension_祖安设置_huiheopa']) * 0.1;
                }
                var phshow = function(num, zuanspeed, width, height, left, png) {
                    game.phshow = ui.create.node('img');
                    game.phshow.src = lib.assetURL + 'extension/祖安武将/' + png;
                    var huihe = parseFloat(lib.config['extension_祖安设置_huihe']);
                    if (!huihe) huihe = 8;
                    game.phshow.style.cssText = 'text-align: center;margin: auto;pointer-events: none;opacity: ' + num * 0.01 * huihe / zuanspeed + ';display: block;width: ' + width + 'px;height: ' + height + 'px;position: absolute;top: 0;left: calc(' + left + 'px + 50%);bottom: 0;background:none;z-index:6;transform: translateX(-50%);';
                    document.body.appendChild(game.phshow);
                    // ---------------------------------------图片加载失败处理------------------------------------------//  
                    document.addEventListener("error",
                    function(event) {
                        var asset = localStorage.getItem("zuanasset");
                        var ev = event ? event: window.event;
                        var elem = ev.target;
                        if (elem.tagName.toLowerCase() == 'img') {
                            // 图片加载失败  --替换为默认 
                            elem.src = asset + 'extension/祖安武将/effects/unknow.jpg';
                        }
                    },
                    true);
                };
                /*setTimeout(function () {
		            game.runLastTime(time-1,hard,event);
		        }, 1000);*/
                var timerun = function(num, add, zuanspeed, width, height, sp, png, wwid) {
                    if (game.phshow) game.phshow.remove();
                    var wait = 0;
                    var adds = add;
                    if (adds == 1) {
                        var left = 0 * wwid * 0.31 * sp - (10 * zuanspeed - num) * (10 * zuanspeed - num) * wwid * 0.0025 * sp / zuanspeed;
                        var plus = 1;
                        if (num < 10 * zuanspeed) {
                            wait = 10;
                        } else {
                            adds = 0;
                            wait = 500;
                        }
                    } else {
                        var left = 0 * wwid * 0.31 * sp + (10 * zuanspeed - num) * (10 * zuanspeed - num) * wwid * 0.0025 * sp / zuanspeed;
                        var plus = -1;
                        if (num > 0) {
                            wait = 10;
                        }
                    }
                    phshow(num, zuanspeed, width, height, left, png);
                    if (wait > 0) setTimeout(function() {
                        timerun(num + plus, adds, zuanspeed, width, height, sp, png, wwid);
                    },
                    wait);
                };
                timerun(0, 1, zuanspeed, width, height, sp, png, wwid);
                'step 2';
                if (game.phshow) game.phshow.remove();
                'step 3';
                window.isShowScreen = false;
            };
            game.expRevive = function(dd) {
                if (parseFloat(lib.config['extension_祖安设置_audio']) >= '2') game.playAudio('..', 'extension', '祖安武将', 'audio', 'revive.ogg');
                dd.revive(dd.maxHp);
                game.addVideo('revive', dd);
                dd.draw(Math.ceil(dd.storage._levelskill * 0.5));
                dd.storage.relife = Math.ceil(dd.storage._levelskill * 0.4 + 0.1);
                dd.markSkill('_expskill');
                dd.syncStorage('_expskill');
                dd.markSkill('_levelskill');
                dd.syncStorage('_levelskill');
                if (dd.hasSkill('zuan_hudun')) {
                    dd.storage.zuan_hudun = dd.storage.zuan_maxhujia;
                    dd.seeMark('zuan_hudun');
                    //dd.markSkill('zuan_hudun');
                    //dd.syncStorage('zuan_hudun');   
                }
                dd.update();
                dd.$damagepop('重生');
                game.log(dd, '<span class=\"zuantext\" style=\"color: #7CFC00\">获得了重生</span>');
                return get.translation(dd.name);
            };
            game.zuanExp = function(player, exp) {
                if (parseFloat(lib.config['extension_祖安设置_upspeed']) != '0') {
                    var speed = 0.1 * parseFloat(lib.config['extension_祖安设置_upspeed']);
                } else {
                    var speed = 1;
                }
                var adds = Math.ceil(exp * speed);
                player.addMark('_expskill', adds, false);
                if (lib.config['extension_祖安设置_levelsay']) player.say('获得了' + adds + '点经验');
                var maxexp = 20 + 2 * player.storage._levelskill;
                if (player.storage._expskill >= maxexp && player.storage._levelskill < 10) {
                    if (parseFloat(lib.config['extension_祖安设置_audio']) >= '4') {
                        if (parseFloat(lib.config['extension_祖安设置_audio']) == '4') {
                            var versons = 'shousha';
                        } else {
                            var versons = 'ten';
                        }
                        game.playAudio('..', 'extension', '祖安武将', 'audio', versons, 'level.mp3');
                    } else if (parseFloat(lib.config['extension_祖安设置_audio']) >= '2') game.playAudio('..', 'extension', '祖安武将', 'audio', 'level.ogg');
                    player.removeMark('_expskill', maxexp, false);
                    player.addMark('_levelskill', 1, false);
                    game.log(player, '提升了一个<span class=\"zuantext\" style=\"color: #FFFF00\">等级</span>');
                    if (!lib.config['extension_祖安设置_balance']) player.draw();
                    if (player.storage._levelskill == 4) {
                        if (parseFloat(lib.config['extension_祖安设置_mode']) == '6') {
                            var skillget = ['hongyan', 'lianhuan', 'tiandu'].randomGet();
                            if (player.hasSkill('lianhuan')) var skillget = ['hongyan', 'tiandu'].randomGet();
                            if (player.hasSkill('tiandu')) var skillget = ['hongyan', 'lianhuan'].randomGet();
                            if (player.hasSkill('hongyan')) var skillget = ['lianhuan', 'tiandu'].randomGet();
                            player.addSkill(skillget);
                        }
                    }
                    if (player.storage._levelskill == 8) {
                        if (parseFloat(lib.config['extension_祖安设置_mode']) == '6') {
                            var skillget = ['guanxing', 'kanpo', 'guicai'].randomGet();
                            if (player.hasSkill('guanxing')) var skillget = ['kanpo', 'guicai'].randomGet();
                            if (player.hasSkill('kanpo')) var skillget = ['guanxing', 'guicai'].randomGet();
                            if (player.hasSkill('guicai')) var skillget = ['guanxing', 'kanpo'].randomGet();
                            player.addSkill(skillget);
                        }
                    }
                    if (lib.config['extension_祖安设置_levelstrong'] == 'old') {
                        if (player.storage._levelskill == 4) {
                            player.changeHujia();
                        }
                        //if(player.storage._levelskill==7) player.addSkill('plusdistance');
                        if (player.storage._levelskill == 8) {
                            player.gainMaxHp();
                        }
                        //if(player.storage._levelskill==10) player.addSkill('maxlevel');
                    } else if (lib.config['extension_祖安设置_levelstrong'] == 'new') {
                        if (player.storage._levelskill == 8) {
                            player.gainMaxHp();
                        }
                    }
                    if (lib.config['extension_祖安设置_levelsay']) player.say('提升了一个等级');
                    player.storage.relife = Math.ceil(player.storage._levelskill * 0.4 + 0.1);
                    if (parseFloat(lib.config['extension_祖安设置_mode']) == '7' && player.group != 'western' && Math.ceil(player.storage._levelskill * 0.5) != player.storage._levelskill * 0.5) {
                        player.logSkill('huanhai');
                        var list = [];
                        var list2 = [];
                        var players = game.players.concat(game.dead);
                        for (var i = 0; i < players.length; i++) {
                            list2.add(players[i].name);
                            list2.add(players[i].name1);
                            list2.add(players[i].name2);
                        }
                        for (var i in lib.character) {
                            if (lib.character[i][1] != player.group) continue;
                            if (lib.character[i][3].length < 1) continue;
                            if (lib.character[i][4]) {
                                if (lib.character[i][4].contains('forbidai')) continue;
                                if (lib.character[i][4].contains('boss')) continue;
                                if (lib.character[i][4].contains('minskin')) continue;
                            }
                            if (player.storage.huanhai.contains(i)) continue;
                            if (list2.contains(i)) continue;
                            list.push(i);
                        }
                        var name = list.randomGet();
                        player.storage.huanhai.push(name);
                        player.markSkill('huanhai');
                        var skills = lib.character[name][3];
                        player.addSkill(skills.randomGet());
                        game.delay();
                    }
                }
                if (player.storage._levelskill >= 10) player.removeMark('_expskill', player.storage._expskill);
                return player.storage._levelskill;
            };
            game.strengthPlayer = function(player) {
                'step 0';
                game.sthpla = [];
                game.sthpla.oldhp = player.hp;
                game.sthpla.oldmaxhp = player.maxHp;
                //game.sthpla.oldstorage=player.storage;
                lib.characterPackSsr = {
                    "mode_extension_祖安武将": lib.zuanPack
                }
                if (player.name.indexOf('unknown') == -1 || player.name == player.name1) {
                    game.sthpla.hisname = "name";
                } else {
                    game.sthpla.hisname = "name1";
                }
                game.sthpla.num = 1;
                'step 1';
                game.sthpla.changehp = false;
                game.sthpla.namelist = ['fazheng', 'xin_fazheng', 'yuanshu', 're_yuanshu', 'yiji', 'xf_yiji', 'yuanshao', 're_yuanshao', 'yuji', 're_yuji', 'lusu', 're_lusu', 'zhangliang', 're_zhangliang', 'xuhuang', 're_xuhuang', 'xiahouyuan', 're_xiahouyuan', 'xushu', 're_xushu'];
                //alert(player.name);
                game.sthpla.myname1 = player[game.sthpla.hisname];
                if (player.name2) {
                    game.sthpla.myname2 = player.name2;
                } else {
                    game.sthpla.myname2 = 'none';
                }
                game.sthpla.sklists = [];
                var oldlist = lib.character[game.sthpla.myname1][3];
                if (game.sthpla.myname2 != 'none') {
                    oldlist = oldlist.concat(lib.character[game.sthpla.myname2][3]);
                }
                var sklist = player.skills;
                for (var i = 0; i < sklist.length; i++) {
                    if (!oldlist.contains(sklist[i])) {
                        game.sthpla.sklists.push(sklist[i]);
                    }
                }
                game.sthpla.changehpnum = 0;
                var str = '' + lib.character[game.sthpla.myname1][2];
                var index = str.indexOf('/');
                var myhp = str.substr(index + 1, str.length);
                'step 2';
                if (game.sthpla.myname1 == 're_sunben') game.sthpla.myname1 = 're_sunce';
                if (game.sthpla.myname2 == 're_sunben') game.sthpla.myname2 = 're_sunce';
                if (game.sthpla.myname1.indexOf('ssr_') != -1) {
                    var inited = false;
                    for (p = 0; p * 2 < game.sthpla.namelist.length; p++) {
                        if (game.sthpla.myname1 == 'ssr_' + game.sthpla.namelist[p * 2]) {
                            if (game.sthpla.myname2 != 'none') {
                                player.init(game.sthpla.namelist[p * 2 + 1]);
                            } else {
                                player.init(game.sthpla.namelist[p * 2 + 1], game.sthpla.myname2);
                            }
                            game.sthpla.changehp = true;
                            inited = true;
                            break;
                        }
                    }
                    if (!inited) {
                        if (game.sthpla.myname2 != 'none') {
                            player.init(game.sthpla.myname1.slice(4));
                        } else {
                            player.init(game.sthpla.myname1.slice(4), game.sthpla.myname2);
                        }
                        game.sthpla.changehp = true;
                    }
                }
                if (game.sthpla.myname2 != 'none' && game.sthpla.myname2.indexOf('ssr_') != -1) {
                    var inited = false;
                    for (p = 0; p * 2 < game.sthpla.namelist.length; p++) {
                        if (game.sthpla.myname2 == 'ssr_' + game.sthpla.namelist[p]) {
                            player.init(player[game.sthpla.hisname], game.sthpla.namelist[p + 1]);
                            game.sthpla.changehp = true;
                            inited = true;
                            break;
                        }
                    }
                    if (!inited) {
                        player.init(player[game.sthpla.hisname], player.name2.slice(4));
                        game.sthpla.changehp = true;
                    }
                }
                'step 3';
                game.sthpla.skill = 'none';
                for (var a in lib.characterPackSsr) {
                    for (var b in lib.characterPackSsr[a]) {
                        var role = lib.characterPackSsr[a][b];
                        if (game.sthpla.myname1.indexOf(b.slice(4)) != -1 && (!(player[game.sthpla.hisname].indexOf('yujin') != -1 && b == 'ssr_yuji')) && (!(player[game.sthpla.hisname].indexOf('zhangheng') != -1 && b == 'ssr_zhanghe'))) {
                            var lists = lib.character[player[game.sthpla.hisname]][3];
                            for (var i = 0; i < lists.length; i++) {
                                if (player.hasSkill(lists[i])) {
                                    player.removeSkill(lists[i]);
                                }
                            }
                            player.addSkill(role[3].slice(0));
                        }
                        if (game.sthpla.myname2.indexOf(b.slice(4)) != -1 && (!(player.name2.indexOf('yujin') != -1 && b == 'ssr_yuji')) && (!(player.name2.indexOf('zhangheng') != -1 && b == 'ssr_zhanghe'))) {
                            var lists = lib.character[player.name2][3];
                            for (var i = 0; i < lists.length; i++) {
                                if (player.hasSkill(lists[i])) {
                                    player.removeSkill(lists[i]);
                                }
                            }
                            player.addSkill(role[3].slice(0));
                        }
                        player.update();
                    }
                }
                'step 4';
                for (var i = 0; i < game.sthpla.sklists.length; i++) {
                    player.addSkill(game.sthpla.sklists[i]);
                }
                player.hp = game.sthpla.oldhp;
                player.maxHp = game.sthpla.oldmaxhp;
                //player.storage=game.sthpla.oldstorage;
                player.update();
                return 'Finished.';
            };
            // ---------------------------------------节日播报------------------------------------------//
            var datehappen = localStorage.getItem("zuanfestival");
            if (!datehappen) happen = 0;
            var d = new Date();
            var month = d.getMonth() + 1;
            var date = d.getDate();
            var year = d.getFullYear();
            var checkhappen = year * 10000 + month * 100 + date;
            if (lib.config['extension_祖安设置_festival'] && datehappen != checkhappen) {
                localStorage.setItem("zuanfestival", checkhappen);
                var birmon = parseFloat(lib.config['extension_祖安设置_birthdaymonth']);
                var birday = parseFloat(lib.config['extension_祖安设置_birthdaydate']);
                //month = 5;
                //date = 4;
                //alert(date);
                //生日
                if (month == birmon && date == birday) {
                    game.newaudio('extension/祖安武将/effects/Festival/Birthday.mp3', 14);
                    game.newalive('extension/祖安武将/effects/Festival/Birthday.gif', 6, 0.8);
                }
                //新年1天
                if (month == 1 && date == 1) {
                    game.newaudio('extension/祖安武将/effects/Festival/Newyear.mp3', 14);
                    game.newalive('extension/祖安武将/effects/Festival/Newyear.gif', 13, 0.7);
                }
                //新春2天
                if (month == 1 && date <= 3 && date > 1) {
                    game.newaudio('extension/祖安武将/effects/Festival/Spring.mp3', 10);
                    game.newalive('extension/祖安武将/effects/Festival/Spring.gif', 6, 0.7);
                }
                //元宵1天
                if (month == 1 && date == 15) {
                    game.newaudio('extension/祖安武将/effects/Festival/Lantern.mp3', 8);
                    game.newalive('extension/祖安武将/effects/Festival/Lantern.gif', 6, 0.7);
                }
                //情人节1天
                if (month == 2 && date == 14) {
                    game.newaudio('extension/祖安武将/effects/Festival/Valentine.mp3', 7);
                    game.newalive('extension/祖安武将/effects/Festival/Valentine.gif', 6, 0.7);
                }
                //妇女1天
                if (month == 3 && date == 8) {
                    game.newaudio('extension/祖安武将/effects/Festival/Women.mp3', 9);
                    game.newalive('extension/祖安武将/effects/Festival/Women.gif', 6, 0.7);
                }
                //植树1天
                if (month == 3 && date == 12) {
                    game.newaudio('extension/祖安武将/effects/Festival/Arbor.mp3', 7);
                    game.newalive('extension/祖安武将/effects/Festival/Arbor.gif', 6, 0.7);
                }
                //愚人1天
                if (month == 4 && date == 1) {
                    game.newaudio('extension/祖安武将/effects/Festival/AprilFools.mp3', 13);
                    game.newalive('extension/祖安武将/effects/Festival/AprilFools.gif', 11, 0.7);
                }
                //清明1天
                if (month == 4 && date == 5) {
                    game.newaudio('extension/祖安武将/effects/Festival/Qingming.mp3', 10);
                    game.newalive('extension/祖安武将/effects/Festival/Qingming.gif', 8, 0.7);
                }
                //劳动1天
                if (month == 5 && date == 1) {
                    game.newaudio('extension/祖安武将/effects/Festival/InternationalLabour.mp3', 8);
                    game.newalive('extension/祖安武将/effects/Festival/InternationalLabour.gif', 6, 0.7);
                }
                //青年1天
                if (month == 5 && date == 4) {
                    game.newaudio('extension/祖安武将/effects/Festival/ChineseYouth.mp3', 14);
                    game.newalive('extension/祖安武将/effects/Festival/ChineseYouth.gif', 14, 0.7);
                }
                //儿童1天
                if (month == 6 && date == 1) {
                    game.newaudio('extension/祖安武将/effects/Festival/Children.mp3', 8);
                    game.newalive('extension/祖安武将/effects/Festival/Children.gif', 6, 0.7);
                }
                //建军1天
                if (month == 8 && date == 1) {
                    game.newaudio('extension/祖安武将/effects/Festival/ArmyDay.mp3', 19);
                    game.newalive('extension/祖安武将/effects/Festival/ArmyDay.gif', 5, 0.7);
                }
                //教师1天
                if (month == 8 && date == 12) {
                    game.newaudio('extension/祖安武将/effects/Festival/Teacher.mp3', 11);
                    game.newalive('extension/祖安武将/effects/Festival/Teacher.gif', 8, 0.7);
                }
                //中秋1天 坑爹我不会算农历
                /*if(month==8&&date==15) {
				    game.newaudio('extension/祖安武将/effects/Festival/MidAutumn.mp3',10);
				    game.newalive('extension/祖安武将/effects/Festival/MidAutumn.gif',8,0.7);
				}*/
                //国庆7天
                if (month == 10 && date <= 7) {
                    game.newaudio('extension/祖安武将/effects/Festival/NationalDay.mp3', 21);
                    game.newalive('extension/祖安武将/effects/Festival/NationalDay.gif', 10, 0.7);
                }
                //万圣1天
                if (month == 10 && date == 31) {
                    game.newaudio('extension/祖安武将/effects/Festival/Halloween.mp3', 12);
                    game.newalive('extension/祖安武将/effects/Festival/Halloween.gif', 10, 0.8);
                }
                //平安夜1天
                if (month == 12 && date == 24) {
                    game.newaudio('extension/祖安武将/effects/Festival/BaiSilent.mp3', 9);
                    game.newalive('extension/祖安武将/effects/Festival/BaiSilent.gif', 8, 0.7);
                }
                //圣诞1天
                if (month == 12 && date == 25) {
                    game.newaudio('extension/祖安武将/effects/Festival/MerryChristmas.mp3', 11);
                    game.newalive('extension/祖安武将/effects/Festival/MerryChristmas.gif', 10, 0.7);
                }
            }
            // ---------------------------------------名称命名------------------------------------------//
            lib.translate._levelskill = "等级";
            lib.translate._expskill = "经验";
            lib.translate._seadreammodeskill = "幻海";
            lib.translate._diycharacterskill = "♞调试" //"开发工具";
            // ---------------------------------------壁纸栏------------------------------------------//
            // ---------------------------------------前置背景------------------------------------------//
            lib.config.standardbackground = ui.background.style.backgroundImage;
            lib.config.zuanexwallpaper = 'off';
            var bizhi = parseFloat(lib.config['extension_祖安设置_bizhi']);
            if (bizhi == '3') game.broadcastAll() + ui.background.setBackgroundImage("extension/祖安武将/wallpaper/menu/gif_chunri.jpg");
            if (bizhi == '5') game.broadcastAll() + ui.background.setBackgroundImage("extension/祖安武将/wallpaper/menu/chunri.jpg");
            if (bizhi == '6') game.broadcastAll() + ui.background.setBackgroundImage("extension/祖安武将/wallpaper/menu/xiahe.jpg");
            if (bizhi == '7') game.broadcastAll() + ui.background.setBackgroundImage("extension/祖安武将/wallpaper/menu/yueye.jpg");
            if (bizhi == '8') game.broadcastAll() + ui.background.setBackgroundImage("extension/祖安武将/wallpaper/menu/qinbing.jpg");
            if (bizhi == '9') game.broadcastAll() + ui.background.setBackgroundImage("extension/祖安武将/wallpaper/menu/caojiegarden.jpg");
            if (bizhi == '10') game.broadcastAll() + ui.background.setBackgroundImage("extension/祖安武将/wallpaper/menu/shengong.jpg");
            if (bizhi == '11') game.broadcastAll() + ui.background.setBackgroundImage("extension/祖安武将/wallpaper/menu/yuanxi.jpg");
            if (bizhi == '12') game.broadcastAll() + ui.background.setBackgroundImage("extension/祖安武将/wallpaper/menu/canglong.jpg");
            if (bizhi == '13') game.broadcastAll() + ui.background.setBackgroundImage("extension/祖安武将/wallpaper/menu/posui.jpg");
            if (lib.config['extension_祖安设置_exwallpaper']) {
                /*if(lib.config.mode=='boss') {
                    lib.config.zuanexwallpaper='on';
                    game.broadcastAll()+ui.background.setBackgroundImage("extension/祖安武将/wallpaper/boss/menu.jpg");
                }
                if(lib.config.mode=='chess'||lib.config.mode=='tafang'||lib.config.mode=='stone') {
                    lib.config.zuanexwallpaper='on';
                    game.broadcastAll()+ui.background.setBackgroundImage("extension/祖安武将/wallpaper/chess/chess.jpg");
                }*/
                if (lib.config.mode == 'versus' || lib.config.mode == 'single') {
                    lib.config.zuanexwallpaper = 'on';
                    game.broadcastAll() + ui.background.setBackgroundImage("extension/祖安武将/wallpaper/versus/menu.jpg");
                }
            }
            if (1 == 0) {
                alert("最后：\n给你呈现一张壁纸，它是来自作者的广告\n你可以在拓展页面中“前置壁纸”选项中关闭！\n（本弹窗只会弹出一次）");
            }

            // ---------------------------------------开始界面------------------------------------------//
            if (typeof(czuanbackground) != 'undefined' && czuanbackground) {
                tlogo.remove();
                backgroundtop.remove();
                var plogo = localStorage.getItem("backgroundlogo");
                if (! (plogo == "5" || plogo == "9")) {
                    backgroundpaper.remove();
                }
                forunderlinefinish = true;
                //backunderline.remove();
                czuanbackground = false;
            }
            if (typeof(formovepaperfinish) != 'undefined' && !formovepaperfinish) {
                movepaper.remove();
                movepaperbasic.remove();
                formovepaperfinish = true;
            }

            // ---------------------------------------指示线------------------------------------------//
            if (lib.config['extension_祖安设置_zhishixian'] && lib.config['extension_祖安设置_zhishixian'] != 'moren') {
                if (['yulong', 'jingdian', 'guanjie'].contains(lib.config['extension_祖安设置_zhishixian'])) {
                    var jianqiLineAnim = {
                        "time": 1400,
                        "position": "screen",
                        "width": "81px",
                        "height": "256px",
                        "backgroundSize": "100% 100%",
                        "opacity": 1,
                        "show": "none",
                        "fade": true,
                        "pause": false,
                        "rate_zhen": 24,
                        "jump_zhen": false,
                        "qianzhui": "",
                        "liang": false,
                        "isLine": true,
                        "cycle": true,
                        "style": {},
                        "skills": [],
                        "cards": [],
                        "forbid": false,
                        "image": "jianqilinexy"
                    };
                    if (lib.config['extension_祖安设置_zhishixian'] == "yulong") {
                        lib.skill._player_xxgg_zhishixian_xxxxx_ggg = {
                            trigger: {
                                source: 'damageBegin4'
                            },
                            charlotte: true,
                            forced: true,
                            content: function() {
                                'step 0';
                                if (trigger.num > 1) {
                                    game.linexy = game.zsbaojiLineXy;
                                    player.line(trigger.player);
                                }
                                'step 1';
                                game.linexy = game.zsyulongLineXy;

                            },
                        }
                        game.zsPlayLineAnimation = function(name, node, fake, points) {
                            var animation = jianqiLineAnim;
                            //     alert(jianqiLineAnim);
                            animation["image"] = name;
                            if (lib.config.zsGuideTime) {
                                animation["time"] = parseInt(lib.config.zsGuideTime);
                            }
                            if (animation == undefined) return;
                            if (animation.time <= 100000) {
                                if (animation.pause != false && !_status.paused2 && !_status.nopause) {
                                    _status.zhx_onAnimationPause = true;
                                    game.pause2();
                                };
                                if (_status.zhx_onAnimation == undefined) _status.zhx_onAnimation = 0;
                                _status.zhx_onAnimation++;
                            };
                            var src;
                            if (animation.image != undefined) src = 'extension/祖安武将/pointer/' + animation.image + '?' + new Date().getTime();
                            var finish = function() {
                                var animationID;
                                var timeoutID;
                                var interval;
                                var div = ui.create.div();
                                if (fake == true) {
                                    ui.window.appendChild(div);
                                } else {
                                    if (node == undefined || node == false) {
                                        ui.window.appendChild(div);
                                    } else {
                                        node.appendChild(div);
                                    };
                                };
                                if (animation.style != undefined) {
                                    for (var i in animation.style) {
                                        if (i == 'innerHTML') continue;
                                        div.style[i] = animation.style[i];
                                    };
                                };
                                var judgeStyle = function(style) {
                                    if (animation.style == undefined) return false;
                                    if (animation.style != undefined && animation.style[style] != undefined) return true;
                                    return false;
                                };
                                if (judgeStyle('innerHTML')) div.innerHTML = animation.style.innerHTML;
                                if (judgeStyle('width') == false) div.style.width = animation.width;
                                if (judgeStyle('height') == false) div.style.height = animation.height;
                                if (judgeStyle('backgroundSize') == false && judgeStyle('background-size') == false) div.style.backgroundSize = animation.backgroundSize;
                                if (judgeStyle('opacity') == false) div.style.opacity = animation.opacity;
                                if (judgeStyle('zIndex') == false && judgeStyle('z-index') == false) div.style.zIndex = 1001;
                                if (judgeStyle('borderRadius') == false && judgeStyle('border-radius') == false) div.style.borderRadius = '5px';
                                if (judgeStyle('pointer-events') == false && judgeStyle('pointerEvents') == false) div.style['pointer-events'] = 'none';
                                if (src != undefined) {
                                    if (animation.image.indexOf('.') != -1) {
                                        div.setBackgroundImage(src);
                                    } else {
                                        var type_frame1 = 0;
                                        var type_frame = '.jpg';
                                        var num_frame = 1;
                                        type_frame = '.png';
                                        num_frame = 8;
                                        var folder_frame = lib.assetURL + 'extension/祖安武将/pointer/' + animation.image + '/';
                                        var div1 = ui.create.div();
                                        div1.style.height = '100%';
                                        div1.style.width = '100%';
                                        div1.style.top = '0px';
                                        div1.style.left = '0px';
                                        div1.style.opacity = '0.7';
                                        div.appendChild(div1);
                                        var canvas = document.createElement("canvas");
                                        canvas.width = div1.offsetWidth;
                                        canvas.height = div1.offsetHeight;
                                        div1.appendChild(canvas);
                                        var context = canvas.getContext("2d");
                                        var start;
                                        var imgs = [];
                                        var imgs_num = 0;
                                        for (var i = 0; i < num_frame; i++) {
                                            var img = new Image();
                                            img.src = folder_frame + (animation.qianzhui == undefined ? '': animation.qianzhui) + (animation.liang == true ? (i < 10 ? '0' + i: i) : i) + type_frame;
                                            if (i >= num_frame - 1) img.zhx_final = true;
                                            img.onload = function() {
                                                imgs.push(this);
                                                if (this.zhx_final == true) start();
                                            };
                                            img.onerror = function() {
                                                if (this.zhx_final == true) start();
                                            };
                                        };
                                        start = function() {
                                            var play = function() {
                                                if (imgs_num >= imgs.length) return;
                                                var img = imgs[imgs_num];
                                                context.clearRect(0, 0, img.width, img.height);
                                                context.drawImage(img, 0, 0, img.width, img.height, 0, 0, div1.offsetWidth, div1.offsetHeight);
                                                imgs_num++;
                                                if (animation.jump_zhen == true && imgs[imgs_num + 1] != undefined) imgs.remove(imgs_num + 1);
                                                if (imgs_num >= imgs.length) {
                                                    if (animation.cycle == true) {
                                                        imgs_num = 0;
                                                    } else {
                                                        if (interval != undefined) clearInterval(interval);
                                                        if (timeoutID != undefined) clearTimeout(timeoutID);
                                                        if (animationID != undefined) cancelAnimationFrame(animationID);
                                                    };
                                                };
                                            };
                                            interval = setInterval(play, animation.rate_zhen == undefined ? 45 : (1000 / animation.rate_zhen));
                                        };

                                    };
                                };
                                if (points == undefined) {
                                    if (fake == true) {
                                        div.style.top = (top - div.offsetHeight / 2) + 'px';
                                        div.style.left = (left - div.offsetWidth / 2) + 'px';
                                    } else {
                                        if (judgeStyle('top') == false) div.style.top = 'calc(50% - ' + (div.offsetHeight / 2) + 'px)';
                                        if (judgeStyle('left') == false) div.style.left = 'calc(50% - ' + (div.offsetWidth / 2) + 'px)';
                                    };
                                } else {
                                    div.style.top = (points[0][1] - div.offsetHeight / 2) + 'px';
                                    div.style.left = (points[0][0]) + 'px';
                                };
                                if (points != undefined) {
                                    var timeS = ((animation.fade == true ? animation.time - 450 : animation.time - 100) / 1000) / 2;
                                    var getAngle = function(x1, y1, x2, y2, bool) {
                                        var x = x1 - x2;
                                        var y = y1 - y2;
                                        var z = Math.sqrt(Math.pow(x, 2) + Math.pow(y, 2));
                                        var cos = y / z;
                                        var radina = Math.acos(cos);
                                        var angle = 180 / (Math.PI / radina);
                                        if (x2 > x1 && y2 === y1) angle = 0;
                                        if (x2 > x1 && y2 < y1) angle = angle - 90;
                                        if (x2 === x1 && y1 > y2) angle = -90;
                                        if (x2 < x1 && y2 < y1) angle = 270 - angle;
                                        if (x2 < x1 && y2 === y1) angle = 180;
                                        if (x2 < x1 && y2 > y1) angle = 270 - angle;
                                        if (x2 === x1 && y2 > y1) angle = 90;
                                        if (x2 > x1 && y2 > y1) angle = angle - 90;
                                        if (bool == true && angle > 90) angle -= 180;
                                        return angle;
                                    };
                                    var p1 = points[0];
                                    var p2 = points[1];
                                    var x0 = p1[0];
                                    var y0 = p1[1];
                                    var x1 = p2[0];
                                    var y1 = p2[1];
                                    div.style.transition = 'all 0s';
                                    div.style.transform = 'rotate(' + getAngle(x0, y0, x1, y1, true) + 'deg)' + (x0 > x1 ? '': ' rotateY(180deg)');
                                    div.style['transform-origin'] = '0 50%';
                                    var div2 = ui.create.div();
                                    div2.style.zIndex = 1000;
                                    div2.style['pointer-events'] = 'none';
                                    div2.style.height = '50px';
                                    div2.style.width = (Math.pow(Math.pow(x1 - x0, 2) + Math.pow(y1 - y0, 2), 0.5) + 2) + 'px';
                                    div2.style.left = (x0) + 'px';
                                    div2.style.top = (y0 - 30) + 'px';
                                    div2.style.transform = 'rotate(' + getAngle(x0, y0, x1, y1) + 'deg) scaleX(0)';
                                    div2.style['transform-origin'] = '0 50%';
                                    div2.style.transition = 'all ' + (timeS * 4 / 3) + 's';
                                    if (src != undefined && animation.image.indexOf('.') == -1) {
                                        div2.style.backgroundSize = '100% 100%';
                                        div2.style.opacity = '1';
                                        div2.setBackgroundImage('extension/祖安武将/pointer/' + animation.image + '/line.png');
                                    } else {
                                        div2.style.background = '#ffffff';
                                    };
                                    setTimeout(function() {
                                        div.style.transition = 'all ' + (timeS * 4 / 3) + 's';
                                        div.style.transform += ' translateX(' + ( - (Math.pow(Math.pow(x1 - x0, 2) + Math.pow(y1 - y0, 2), 0.5) + 2)) + 'px)';
                                        div2.style.transform = 'rotate(' + getAngle(x0, y0, x1, y1) + 'deg) scaleX(1)';
                                    },
                                    50);
                                    setTimeout(function() {
                                        div2.style.transition = 'all ' + (timeS * 2 / 3) + 's';
                                        div2.style.transform = 'rotate(' + getAngle(x0, y0, x1, y1) + 'deg) translateX(' + (Math.pow(Math.pow(x1 - x0, 2) + Math.pow(y1 - y0, 2), 0.5) + 2 - Math.pow(Math.pow(div.offsetHeight / 2, 2) + Math.pow(div.offsetWidth / 2, 2), 0.1)) + 'px) scaleX(0.01)';
                                    },
                                    50 + timeS * 4 / 3 * 1000);
                                    node.appendChild(div2);
                                };
                                if (animation.time <= 100000) {
                                    if (animation.fade == true) {
                                        if (div2 != undefined) {
                                            setTimeout(function() {
                                                div2.hide();
                                            },
                                            animation.time - 350);
                                            setTimeout(function() {
                                                div.hide();
                                            },
                                            animation.time - 400);
                                        } else {
                                            setTimeout(function() {
                                                div.hide();
                                            },
                                            animation.time - 350);
                                        };
                                    };
                                    setTimeout(function() {
                                        if (interval != undefined) clearInterval(interval);
                                        if (timeoutID != undefined) clearTimeout(timeoutID);
                                        if (animationID != undefined) cancelAnimationFrame(animationID);
                                        if (fake == true) {
                                            ui.window.removeChild(div);
                                        } else {
                                            if (node == undefined || node == false) {
                                                ui.window.removeChild(div);
                                            } else {
                                                node.removeChild(div);
                                            };
                                        };
                                        if (div2 != undefined) node.removeChild(div2);
                                        _status.zhx_onAnimation--;
                                        if (_status.zhx_onAnimationPause == true && _status.zhx_onAnimation == 0) {
                                            delete _status.zhx_onAnimationPause;
                                            game.resume2();
                                        };
                                    },
                                    animation.time);
                                };
                            };
                            if (animation.delay != undefined) {
                                setTimeout(finish, animation.delay);
                            } else {
                                finish();
                            };
                        };
                    }
                    if (lib.config['extension_祖安设置_zhishixian'] == "jingdian") {
                        lib.skill._player_xxgg_zhishixian2_xxxxx_ggg = {
                            trigger: {
                                source: 'damageBegin4'
                            },
                            charlotte: true,
                            forced: true,
                            content: function() {
                                'step 0';
                                if (trigger.num > 1) {
                                    game.linexy = game.zsbaojiLineXy;
                                    player.line(trigger.player);
                                }
                                'step 1';
                                game.linexy = game.zsjingdianLineXy;
                            },
                        }
                        game.zsPlayLineAnimation = function(name, node, fake, points) {
                            var animation = jianqiLineAnim;
                            //     alert(jianqiLineAnim);
                            animation["image"] = name;
                            if (lib.config.zsGuideTime) {
                                animation["time"] = parseInt(lib.config.zsGuideTime);
                            }
                            if (animation == undefined) return;
                            if (animation.time <= 100000) {
                                if (animation.pause != false && !_status.paused2 && !_status.nopause) {
                                    _status.zhx_onAnimationPause = true;
                                    game.pause2();
                                };
                                if (_status.zhx_onAnimation == undefined) _status.zhx_onAnimation = 0;
                                _status.zhx_onAnimation++;
                            };
                            var src;
                            if (animation.image != undefined) src = 'extension/祖安武将/pointer/' + animation.image + '?' + new Date().getTime();
                            var finish = function() {
                                var animationID;
                                var timeoutID;
                                var interval;
                                var div = ui.create.div();
                                if (fake == true) {
                                    ui.window.appendChild(div);
                                } else {
                                    if (node == undefined || node == false) {
                                        ui.window.appendChild(div);
                                    } else {
                                        node.appendChild(div);
                                    };
                                };
                                if (animation.style != undefined) {
                                    for (var i in animation.style) {
                                        if (i == 'innerHTML') continue;
                                        div.style[i] = animation.style[i];
                                    };
                                };
                                var judgeStyle = function(style) {
                                    if (animation.style == undefined) return false;
                                    if (animation.style != undefined && animation.style[style] != undefined) return true;
                                    return false;
                                };
                                if (judgeStyle('innerHTML')) div.innerHTML = animation.style.innerHTML;
                                if (judgeStyle('width') == false) div.style.width = animation.width;
                                if (judgeStyle('height') == false) div.style.height = animation.height;
                                if (judgeStyle('backgroundSize') == false && judgeStyle('background-size') == false) div.style.backgroundSize = animation.backgroundSize;
                                if (judgeStyle('opacity') == false) div.style.opacity = animation.opacity;
                                if (judgeStyle('zIndex') == false && judgeStyle('z-index') == false) div.style.zIndex = 1001;
                                if (judgeStyle('borderRadius') == false && judgeStyle('border-radius') == false) div.style.borderRadius = '5px';
                                if (judgeStyle('pointer-events') == false && judgeStyle('pointerEvents') == false) div.style['pointer-events'] = 'none';
                                if (src != undefined) {
                                    if (animation.image.indexOf('.') != -1) {
                                        div.setBackgroundImage(src);
                                    } else {
                                        var type_frame1 = 0;
                                        var type_frame = '.jpg';
                                        var num_frame = 1;
                                        type_frame = '.png';
                                        num_frame = 8;
                                        var folder_frame = lib.assetURL + 'extension/祖安武将/pointer/' + animation.image + '/';
                                        var div1 = ui.create.div();
                                        div1.style.height = '100%';
                                        div1.style.width = '100%';
                                        div1.style.top = '0px';
                                        div1.style.left = '0px';
                                        div1.style.opacity = '0.7';
                                        div.appendChild(div1);
                                        var canvas = document.createElement("canvas");
                                        canvas.width = div1.offsetWidth;
                                        canvas.height = div1.offsetHeight;
                                        div1.appendChild(canvas);
                                        var context = canvas.getContext("2d");
                                        var start;
                                        var imgs = [];
                                        var imgs_num = 0;
                                        for (var i = 0; i < num_frame; i++) {
                                            var img = new Image();
                                            img.src = folder_frame + (animation.qianzhui == undefined ? '': animation.qianzhui) + (animation.liang == true ? (i < 10 ? '0' + i: i) : i) + type_frame;
                                            if (i >= num_frame - 1) img.zhx_final = true;
                                            img.onload = function() {
                                                imgs.push(this);
                                                if (this.zhx_final == true) start();
                                            };
                                            img.onerror = function() {
                                                if (this.zhx_final == true) start();
                                            };
                                        };
                                        start = function() {
                                            var play = function() {
                                                if (imgs_num >= imgs.length) return;
                                                var img = imgs[imgs_num];
                                                context.clearRect(0, 0, img.width, img.height);
                                                context.drawImage(img, 0, 0, img.width, img.height, 0, 0, div1.offsetWidth, div1.offsetHeight);
                                                imgs_num++;
                                                if (animation.jump_zhen == true && imgs[imgs_num + 1] != undefined) imgs.remove(imgs_num + 1);
                                                if (imgs_num >= imgs.length) {
                                                    if (animation.cycle == true) {
                                                        imgs_num = 0;
                                                    } else {
                                                        if (interval != undefined) clearInterval(interval);
                                                        if (timeoutID != undefined) clearTimeout(timeoutID);
                                                        if (animationID != undefined) cancelAnimationFrame(animationID);
                                                    };
                                                };
                                            };
                                            interval = setInterval(play, animation.rate_zhen == undefined ? 45 : (1000 / animation.rate_zhen));
                                        };

                                    };
                                };
                                if (points == undefined) {
                                    if (fake == true) {
                                        div.style.top = (top - div.offsetHeight / 2) + 'px';
                                        div.style.left = (left - div.offsetWidth / 2) + 'px';
                                    } else {
                                        if (judgeStyle('top') == false) div.style.top = 'calc(50% - ' + (div.offsetHeight / 2) + 'px)';
                                        if (judgeStyle('left') == false) div.style.left = 'calc(50% - ' + (div.offsetWidth / 2) + 'px)';
                                    };
                                } else {
                                    div.style.top = (points[0][1] - div.offsetHeight / 2) + 'px';
                                    div.style.left = (points[0][0]) + 'px';
                                };
                                if (points != undefined) {
                                    var timeS = ((animation.fade == true ? animation.time - 450 : animation.time - 100) / 1000) / 2;
                                    var getAngle = function(x1, y1, x2, y2, bool) {
                                        var x = x1 - x2;
                                        var y = y1 - y2;
                                        var z = Math.sqrt(Math.pow(x, 2) + Math.pow(y, 2));
                                        var cos = y / z;
                                        var radina = Math.acos(cos);
                                        var angle = 180 / (Math.PI / radina);
                                        if (x2 > x1 && y2 === y1) angle = 0;
                                        if (x2 > x1 && y2 < y1) angle = angle - 90;
                                        if (x2 === x1 && y1 > y2) angle = -90;
                                        if (x2 < x1 && y2 < y1) angle = 270 - angle;
                                        if (x2 < x1 && y2 === y1) angle = 180;
                                        if (x2 < x1 && y2 > y1) angle = 270 - angle;
                                        if (x2 === x1 && y2 > y1) angle = 90;
                                        if (x2 > x1 && y2 > y1) angle = angle - 90;
                                        if (bool == true && angle > 90) angle -= 180;
                                        return angle;
                                    };
                                    var p1 = points[0];
                                    var p2 = points[1];
                                    var x0 = p1[0];
                                    var y0 = p1[1];
                                    var x1 = p2[0];
                                    var y1 = p2[1];
                                    div.style.transition = 'all 0s';
                                    div.style.transform = 'rotate(' + getAngle(x0, y0, x1, y1, true) + 'deg)' + (x0 > x1 ? '': ' rotateY(180deg)');
                                    div.style['transform-origin'] = '0 50%';
                                    var div2 = ui.create.div();
                                    div2.style.zIndex = 1000;
                                    div2.style['pointer-events'] = 'none';
                                    div2.style.height = '60px';
                                    div2.style.width = (Math.pow(Math.pow(x1 - x0, 2) + Math.pow(y1 - y0, 2), 0.5) + 2) + 'px';
                                    div2.style.left = (x0) + 'px';
                                    div2.style.top = (y0 - 30) + 'px';
                                    div2.style.transform = 'rotate(' + getAngle(x0, y0, x1, y1) + 'deg) scaleX(0)';
                                    div2.style['transform-origin'] = '0 50%';
                                    div2.style.transition = 'all ' + (timeS * 4 / 3) + 's';
                                    if (src != undefined && animation.image.indexOf('.') == -1) {
                                        div2.style.backgroundSize = '100% 100%';
                                        div2.style.opacity = '1';
                                        div2.setBackgroundImage('extension/祖安武将/pointer/' + animation.image + '/line.png');
                                    } else {
                                        div2.style.background = '#ffffff';
                                    };
                                    setTimeout(function() {
                                        div.style.transition = 'all ' + (timeS * 4 / 3) + 's';
                                        div.style.transform += ' translateX(' + ( - (Math.pow(Math.pow(x1 - x0, 2) + Math.pow(y1 - y0, 2), 0.5) + 2)) + 'px)';
                                        div2.style.transform = 'rotate(' + getAngle(x0, y0, x1, y1) + 'deg) scaleX(1)';
                                    },
                                    50);
                                    setTimeout(function() {
                                        div2.style.transition = 'all ' + (timeS * 2 / 3) + 's';
                                        div2.style.transform = 'rotate(' + getAngle(x0, y0, x1, y1) + 'deg) translateX(' + (Math.pow(Math.pow(x1 - x0, 2) + Math.pow(y1 - y0, 2), 0.5) + 2 - Math.pow(Math.pow(div.offsetHeight / 2, 2) + Math.pow(div.offsetWidth / 2, 2), 0.1)) + 'px) scaleX(0.01)';
                                    },
                                    50 + timeS * 4 / 3 * 1000);
                                    node.appendChild(div2);
                                };
                                if (animation.time <= 100000) {
                                    if (animation.fade == true) {
                                        if (div2 != undefined) {
                                            setTimeout(function() {
                                                div2.hide();
                                            },
                                            animation.time - 350);
                                            setTimeout(function() {
                                                div.hide();
                                            },
                                            animation.time - 400);
                                        } else {
                                            setTimeout(function() {
                                                div.hide();
                                            },
                                            animation.time - 350);
                                        };
                                    };
                                    setTimeout(function() {
                                        if (interval != undefined) clearInterval(interval);
                                        if (timeoutID != undefined) clearTimeout(timeoutID);
                                        if (animationID != undefined) cancelAnimationFrame(animationID);
                                        if (fake == true) {
                                            ui.window.removeChild(div);
                                        } else {
                                            if (node == undefined || node == false) {
                                                ui.window.removeChild(div);
                                            } else {
                                                node.removeChild(div);
                                            };
                                        };
                                        if (div2 != undefined) node.removeChild(div2);
                                        _status.zhx_onAnimation--;
                                        if (_status.zhx_onAnimationPause == true && _status.zhx_onAnimation == 0) {
                                            delete _status.zhx_onAnimationPause;
                                            game.resume2();
                                        };
                                    },
                                    animation.time);
                                };
                            };
                            if (animation.delay != undefined) {
                                setTimeout(finish, animation.delay);
                            } else {
                                finish();
                            };
                        };
                    }

                    if (lib.config['extension_祖安设置_zhishixian'] == "guanjie") {
                        /*lib.skill._player_xxgg_zhishixian3_xxxxx_ggg = {
			                trigger: {
			                    source: 'damageBegin4'
			                },
			                charlotte: true,
			                forced: true,
			                content: function () {
			                    'step 0';
			                    if (trigger.num > 1) {
			                        game.linexy = game.zsbaojiLineXy;
			                        player.line(trigger.player);
			                    }
			                    'step 1';
			                    game.linexy = game.zsguanjieLineXy;
			                },
			            }*/
                        game.jianqiLineAnim = jianqiLineAnim;
                        game.jianqiLineAnim = {
                            "time": 1400,
                            "position": "screen",
                            "width": "81px",
                            "height": "256px",
                            "backgroundSize": "100% 100%",
                            "opacity": 1,
                            "show": "none",
                            "fade": true,
                            "pause": false,
                            "rate_zhen": 24,
                            "jump_zhen": false,
                            "qianzhui": "",
                            "liang": false,
                            "isLine": true,
                            "cycle": true,
                            "style": {},
                            "skills": [],
                            "cards": [],
                            "forbid": false,
                            "image": "jianqilinexy"
                        };
                        game.jianqiLineAnim2 = {
                            "time": 1200,
                            "position": "screen",
                            "width": "256px",
                            "height": "128px",
                            "backgroundSize": "100% 100%",
                            "opacity": 1,
                            "show": "none",
                            "fade": true,
                            "pause": false,
                            "rate_zhen": 18,
                            "jump_zhen": false,
                            "qianzhui": "",
                            "liang": false,
                            "isLine": true,
                            "cycle": true,
                            "style": {},
                            "skills": [],
                            "cards": [],
                            "forbid": false,
                            "image": "jianqilinexy"
                        };
                        /*game.zsBaojiLineAnimation = function (name, node, fake, points) {
				            let image = new Image();
				          image.src = `${lib.assetURL}extension/祖安武将/pointer/baojilinexy/line.png`;
				          image.classList.add("jszsx");
				          image.onload = function () {
				            let rect = s.getBoundingClientRect();
				            const sourceX = rect.x + rect.width / 2;
				            const sourceY = rect.y + rect.height / (s == ui.window ? 1.5 : 2);
				            let targetRect = player.getBoundingClientRect();
				            const targetX = targetRect.x + targetRect.width / 2;
				            const targetY = targetRect.y + targetRect.height / 2;
				            var getDistance = function (x1, y1, x2, y2) {
				                const dx = x2 - x1;
				                const dy = y2 - y1;
				                return Math.sqrt(dx*dx + dy*dy);
				              }
				            let distance = getDistance(sourceX, sourceY, targetX, targetY);
				            console.log("distance: ",distance);
				            let that = this;
				            let currentSize = 0;
				            let lastRenderTime = 0;
				            let sc1 = 0;
				            let sc2 = 0;
				            if (s != ui.window) {
				              if (distance >= 650 && distance <= 700) {
				                sc2 = 4
				              } else if (distance > 700 && distance <= 800) {
				                sc2 = 3.5
				              } else if (distance > 800 && distance <= 900) {
				                sc2 = 2.5
				              } else if (distance > 900 && distance <= 1000) {
				                sc2 = 2
				              } else if (distance > 1000) {
				                sc2 = 1.5
				              }

				              if (distance <= 200) {
				                sc1 = 4;
				              } else if (distance <= 350) {
				                sc1 = 4.5;
				              } else if (distance <= 600) {
				                sc1 = 5;
				              } else if (distance < 800) {
				                sc1 = 5.2;
				              } else if (distance < 900) {
				                sc1 = 5.3;
				              }
				            } else {
				              if (distance > 350) {
				                sc2 = 2.5
				              }
				            }

				            this.style.transform = `translate(${sourceX}px,${sourceY}px)`;
				            var checkElementPosition = function (target) {
				                let rect = target.getBoundingClientRect();
				                let s = ui.window.getBoundingClientRect();
				                if (rect.left < s.width / 2 && rect.right < s.width / 2) {
				                  return 0;
				                } else if (rect.left >= s.width / 2 && rect.right >= s.width / 2) {
				                  return 2;
				                } else {
				                  return 1
				                }
				              }
				            let res = checkElementPosition(player);
				            function p(t) {
				              const timeSinceLastRender = t - lastRenderTime;
				              var size=[1, 2, 3, 2, 1, 0, 3.5, 4, 4.5, 5, 5.5];
				              var getAngle = function (target, source, initialDirection = "up", me) {
				                const targetRect = target.getBoundingClientRect();
				                const sourceRect = source.getBoundingClientRect();
				                const targetX = targetRect.x + targetRect.width / 2;
				                const targetY = targetRect.y + targetRect.height / 2;
				                const sourceX = sourceRect.x + sourceRect.width / 2;
				                const sourceY = sourceRect.y + sourceRect.height / (me ? 1.5 : 2);
				        
				                let dx = targetX - sourceX;
				                let dy = targetY - sourceY;
				        
				                let angle = Math.atan2(dy, dx) * 180 / Math.PI;
				                let initialAngle = 0;
				                switch (initialDirection) {
				                  case 'up':
				                    initialAngle = -270;
				                    break;
				                  case 'down':
				                    initialAngle = -90;
				                    break;
				                  case 'left':
				                    initialAngle = -180;
				                    break;
				                }
				        
				                return angle + initialAngle;
				              }
				              if (timeSinceLastRender >= 1000 / 40) {
				                lastRenderTime = t;
				                let nn = distance / size[size.length - 1];
				                that.style.width = `${nn + 11}px`;
				                let angle2 = getAngle(player, s, "r", s == ui.window);
				                // console.log("角度: ", angle2);
				                // angle2 += res == 0 ? 0 : -3;
				                let c = size[currentSize];
				                let scale = sc1 ? c == 5.5 ? sc1 : c : c;
				                let scale2 = sc2 ? c == 5.5 ? sc2 : c : c;
				                // console.log("倍数: ", c);
				                // console.log("scale: ", scale);
				                if (s == ui.window) {
				                  angle2 += res == 0 ? 0 : -3;
				                  if (sc2) that.style.transform = `translate(${sourceX}px,${sourceY}px) rotate(${angle2}deg) scale(${scale}, ${sc2})`;
				                  else that.style.transform = `translate(${sourceX}px,${sourceY}px) rotate(${angle2}deg) scale(${scale}, ${scale2})`;
				                } else {
				                  if (sc2) that.style.transform = `translate(${sourceX}px,${sourceY - rect.height / 2 + 44}px) rotate(${angle2}deg) scale(${scale}, ${sc2})`;
				                  else that.style.transform = `translate(${sourceX}px,${sourceY - rect.height / 2 + 44}px) rotate(${angle2}deg) scale(${scale}, ${scale2})`;
				                }

				                currentSize++;
				                if (currentSize < size.length) {
				                  requestAnimationFrame(p);
				                } else {
				                  console.log("结束");
				                  setTimeout(() => {
				                    that.remove();
				                  },50);
				                }
				              } else {
				                requestAnimationFrame(p);
				              }
				            }
				            p();
				          }
				          ui.arena.appendChild(image);
				        };*/
                        if (game.createCss) {
                            game.createCss(`.baojiJankyBox {
                                transform: scale(2);
                                animation - timing -
                                function: steps(4, end);
                                /* 数字越小卡顿越明显 */
                            }`);
                            game.createCss(`.jszsx {
                                width: 100px;
                                position: absolute;
                                transition: none;
                                z - index: 12;
                                transform - origin: left;
                                pointer - events: none;
                            }`); //原本是z-index: 5;//zzidx
                        }
                        lib.skill._jszsx = {
                            trigger: {
                                player: "damageBegin5",
                            },
                            filter: function(event, player) {
                                if (typeof event.num != "number") return false;
                                if (event.source == undefined || event.source == player) return false;
                                return event.num >= 2;
                            },
                            forced: true,
                            popup: false,
                            priority: -1000,
                            lastDo: true,
                            content: function(event, step, source, player, target, targets, card, cards, skill, forced, num, trigger, result) {
                                // player 受伤者
                                // trigger.source 伤害来源
                                let s = trigger.source == game.me ? ui.window: trigger.source;
                                let image = new Image();
                                image.style.opacity = 0;
                                image.src = `$ {
                                    lib.assetURL
                                }
                                extension / 祖安武将 / pointer / baojilinexy / line.png`;
                                image.classList.add("jszsx");
                                image.onload = function() {
                                    let rect = s.getBoundingClientRect();
                                    let targetRect = player.getBoundingClientRect();
                                    if (trigger.source.lineInfo && trigger.source.lineInfo(player)) {
                                        var [sourceX, sourceY, targetX, targetY] = trigger.source.lineInfo(player)[0];
                                    } else {
                                        var sourceX = rect.x + rect.width / 2;
                                        var sourceY = rect.y + rect.height / (s == ui.window ? 1.5 : 2);
                                        var targetX = targetRect.x + targetRect.width / 2;
                                        var targetY = targetRect.y + targetRect.height / 2;
                                    }
                                    if (! (trigger.source == game.me && !ui.fakeme && !ui.chess)) {
                                        sourceX -= 15;
                                    }
                                    if (! (player == game.me && !ui.fakeme && !ui.chess)) {
                                        targetX -= 15;
                                    }
                                    var getDistance = function(x1, y1, x2, y2) {
                                        const dx = x2 - x1;
                                        const dy = y2 - y1;
                                        return Math.sqrt(dx * dx + dy * dy);
                                    }
                                    let distance = getDistance(sourceX, sourceY, targetX, targetY);
                                    console.log("distance: ", distance);
                                    let that = this;
                                    let currentSize = 0;
                                    let lastRenderTime = 0;
                                    let sc1 = 0;
                                    let sc2 = 0;
                                    if (s != ui.window) {
                                        if (distance >= 650 && distance <= 700) {
                                            sc2 = 4
                                        } else if (distance > 700 && distance <= 800) {
                                            sc2 = 3.5
                                        } else if (distance > 800 && distance <= 900) {
                                            sc2 = 2.5
                                        } else if (distance > 900 && distance <= 1000) {
                                            sc2 = 2
                                        } else if (distance > 1000) {
                                            sc2 = 1.5
                                        }

                                        if (distance <= 200) {
                                            sc1 = 4;
                                        } else if (distance <= 350) {
                                            sc1 = 4.5;
                                        } else if (distance <= 600) {
                                            sc1 = 5;
                                        } else if (distance < 800) {
                                            sc1 = 5.2;
                                        } else if (distance < 900) {
                                            sc1 = 5.3;
                                        }
                                    } else {
                                        if (distance > 350) {
                                            sc2 = 2.5
                                        }
                                    }

                                    this.style.transform = `translate($ {
                                        sourceX
                                    }
                                    px, $ {
                                        sourceY
                                    }
                                    px)`;
                                    var checkElementPosition = function(target) {
                                        let rect = target.getBoundingClientRect();
                                        let s = ui.window.getBoundingClientRect();
                                        if (rect.left < s.width / 2 && rect.right < s.width / 2) {
                                            return 0;
                                        } else if (rect.left >= s.width / 2 && rect.right >= s.width / 2) {
                                            return 2;
                                        } else {
                                            return 1
                                        }
                                    }
                                    let res = checkElementPosition(player);
                                    function p(t) {
                                        const timeSinceLastRender = t - lastRenderTime;
                                        var size = [1, 2, 3, 2, 1, 0, 3.5, 4, 4.5, 5, 5.5];
                                        /*var getAngle = function (target, source, initialDirection = "up", me) {
						                    const targetRect = target.getBoundingClientRect();
						                    const sourceRect = source.getBoundingClientRect();
						                    const targetX = targetRect.x + targetRect.width / 2;
						                    const targetY = targetRect.y + targetRect.height / 2;
						                    const sourceX = sourceRect.x + sourceRect.width / 2;
						                    const sourceY = sourceRect.y + sourceRect.height / (me ? 1.5 : 2);
						            
						                    let dx = targetX - sourceX;
						                    let dy = targetY - sourceY;
						            
						                    let angle = Math.atan2(dy, dx) * 180 / Math.PI;
						                    let initialAngle = 0;
						                    switch (initialDirection) {
						                      case 'up':
						                        initialAngle = -270;
						                        break;
						                      case 'down':
						                        initialAngle = -90;
						                        break;
						                      case 'left':
						                        initialAngle = -180;
						                        break;
						                    }
						            
						                    return angle + initialAngle;
						                  }*/

                                        var getAngle = function(x1, y1, x2, y2, bool) {
                                            var x = x1 - x2;
                                            var y = y1 - y2;
                                            var z = Math.sqrt(Math.pow(x, 2) + Math.pow(y, 2));
                                            var cos = y / z;
                                            var radina = Math.acos(cos);
                                            var angle = 180 / (Math.PI / radina);
                                            if (x2 > x1 && y2 === y1) angle = 0;
                                            if (x2 > x1 && y2 < y1) angle = angle - 90;
                                            if (x2 === x1 && y1 > y2) angle = -90;
                                            if (x2 < x1 && y2 < y1) angle = 270 - angle;
                                            if (x2 < x1 && y2 === y1) angle = 180;
                                            if (x2 < x1 && y2 > y1) angle = 270 - angle;
                                            if (x2 === x1 && y2 > y1) angle = 90;
                                            if (x2 > x1 && y2 > y1) angle = angle - 90;
                                            if (bool == true && angle > 90) angle -= 180;
                                            return angle;
                                        };
                                        if (timeSinceLastRender >= 1000 / 40) {
                                            lastRenderTime = t;
                                            let nn = distance / size[size.length - 1];
                                            that.style.width = `$ {
                                                nn + 11
                                            }
                                            px`;
                                            //let angle2 = getAngle(player, s, "r", s == ui.window);
                                            let angle2 = getAngle(sourceX, sourceY, targetX, targetY);
                                            // console.log("角度: ", angle2);
                                            // angle2 += res == 0 ? 0 : -3;
                                            let c = size[currentSize];
                                            let scale = sc1 ? c == 5.5 ? sc1: c: c;
                                            let scale2 = sc2 ? c == 5.5 ? sc2: c: c;
                                            // console.log("倍数: ", c);
                                            // console.log("scale: ", scale);
                                            if (s == ui.window) {
                                                angle2 += res == 0 ? 0 : -3;
                                                if (sc2) that.style.transform = `translate($ {
                                                    sourceX
                                                }
                                                px, $ {
                                                    sourceY
                                                }
                                                px) rotate($ {
                                                    angle2
                                                }
                                                deg) scale($ {
                                                    scale
                                                },
                                                $ {
                                                    sc2
                                                })`;
                                                else that.style.transform = `translate($ {
                                                    sourceX
                                                }
                                                px, $ {
                                                    sourceY
                                                }
                                                px) rotate($ {
                                                    angle2
                                                }
                                                deg) scale($ {
                                                    scale
                                                },
                                                $ {
                                                    scale2
                                                })`;
                                            } else {
                                                if (sc2) that.style.transform = `translate($ {
                                                    sourceX
                                                }
                                                px, $ {
                                                    sourceY - rect.height / 2 + 44
                                                }
                                                px) rotate($ {
                                                    angle2
                                                }
                                                deg) scale($ {
                                                    scale
                                                },
                                                $ {
                                                    sc2
                                                })`;
                                                else that.style.transform = `translate($ {
                                                    sourceX
                                                }
                                                px, $ {
                                                    sourceY - rect.height / 2 + 44
                                                }
                                                px) rotate($ {
                                                    angle2
                                                }
                                                deg) scale($ {
                                                    scale
                                                },
                                                $ {
                                                    scale2
                                                })`;
                                            }
                                            that.style.opacity = 1;

                                            currentSize++;
                                            if (currentSize < size.length) {
                                                requestAnimationFrame(p);
                                            } else {
                                                console.log("结束");
                                                setTimeout(() =>{
                                                    that.remove();
                                                },
                                                50);
                                            }
                                        } else {
                                            requestAnimationFrame(p);
                                        }
                                    }
                                    p();
                                }
                                ui.arena.appendChild(image);
                            }
                        };
                        game.zsPlayLineAnimation = function(name, node, fake, points) {
                            var animation = game.jianqiLineAnim;
                            //     alert(jianqiLineAnim);
                            animation["image"] = name;
                            if (lib.config.zsGuideTime) {
                                animation["time"] = parseInt(lib.config.zsGuideTime);
                            }
                            //暴击指示线加速
                            if (name == 'baojilinexy') {
                                animation["time"] = parseInt(0.7 * 1400);
                            } else {
                                animation["time"] = parseInt(1400);
                            }
                            //alert(animation["time"]);
                            if (animation == undefined) return;
                            if (animation.time <= 100000) {
                                if (animation.pause != false && !_status.paused2 && !_status.nopause) {
                                    _status.zhx_onAnimationPause = true;
                                    game.pause2();
                                };
                                if (_status.zhx_onAnimation == undefined) _status.zhx_onAnimation = 0;
                                _status.zhx_onAnimation++;
                            };
                            var src;
                            if (animation.image != undefined) src = 'extension/祖安武将/pointer/' + animation.image + '?' + new Date().getTime();
                            var finish = function() {
                                var animationID;
                                var timeoutID;
                                var interval;
                                var div = ui.create.div();
                                if (fake == true) {
                                    ui.window.appendChild(div);
                                } else {
                                    if (node == undefined || node == false) {
                                        ui.window.appendChild(div);
                                    } else {
                                        node.appendChild(div);
                                    };
                                };
                                if (animation.style != undefined) {
                                    for (var i in animation.style) {
                                        if (i == 'innerHTML') continue;
                                        div.style[i] = animation.style[i];
                                    };
                                };
                                var judgeStyle = function(style) {
                                    if (animation.style == undefined) return false;
                                    if (animation.style != undefined && animation.style[style] != undefined) return true;
                                    return false;
                                };
                                if (judgeStyle('innerHTML')) div.innerHTML = animation.style.innerHTML;
                                if (judgeStyle('width') == false) div.style.width = animation.width;
                                if (judgeStyle('height') == false) div.style.height = animation.height;
                                if (judgeStyle('backgroundSize') == false && judgeStyle('background-size') == false) div.style.backgroundSize = animation.backgroundSize;
                                if (judgeStyle('opacity') == false) div.style.opacity = animation.opacity;
                                if (judgeStyle('zIndex') == false && judgeStyle('z-index') == false) {
                                    div.style.zIndex = name == 'baojilinexy' ? 12 : 11; //zzidx
                                    if (name == 'baojilinexy') {
                                        //div.classList.add('baojiJankyBox');
                                        div.style.setProperty("animation-timing-function", "steps(3, end)", "important");
                                        div.style.setProperty("transform", "scale(2)", "important");
                                    }
                                }
                                if (judgeStyle('borderRadius') == false && judgeStyle('border-radius') == false) div.style.borderRadius = '5px';
                                if (judgeStyle('pointer-events') == false && judgeStyle('pointerEvents') == false) div.style['pointer-events'] = 'none';
                                if (src != undefined) {
                                    if (animation.image.indexOf('.') != -1) {
                                        div.setBackgroundImage(src);
                                    } else {
                                        var type_frame1 = 0;
                                        var type_frame = '.jpg';
                                        var num_frame = 1;
                                        type_frame = '.png';
                                        num_frame = 8;
                                        var folder_frame = lib.assetURL + 'extension/祖安武将/pointer/' + animation.image + '/';
                                        var div1 = ui.create.div();
                                        div1.style.height = '100%';
                                        div1.style.width = '100%';
                                        div1.style.top = '0px';
                                        div1.style.left = '0px';
                                        //div1.style.opacity = '0.7';
                                        div1.style.opacity = '1';
                                        div.appendChild(div1);
                                        var canvas = document.createElement("canvas");
                                        canvas.width = div1.offsetWidth;
                                        canvas.height = div1.offsetHeight;
                                        div1.appendChild(canvas);
                                        var context = canvas.getContext("2d");
                                        var start;
                                        var imgs = [];
                                        var imgs_num = 0;
                                        for (var i = 0; i < num_frame; i++) {
                                            var img = new Image();
                                            img.src = folder_frame + (animation.qianzhui == undefined ? '': animation.qianzhui) + (animation.liang == true ? (i < 10 ? '0' + i: i) : i) + type_frame;
                                            if (i >= num_frame - 1) img.zhx_final = true;
                                            img.onload = function() {
                                                imgs.push(this);
                                                if (this.zhx_final == true) start();
                                            };
                                            img.onerror = function() {
                                                if (this.zhx_final == true) start();
                                            };
                                        };
                                        start = function() {
                                            var play = function() {
                                                if (imgs_num >= imgs.length) return;
                                                var img = imgs[imgs_num];
                                                context.clearRect(0, 0, img.width, img.height);
                                                context.drawImage(img, 0, 0, img.width, img.height, 0, 0, div1.offsetWidth, div1.offsetHeight);
                                                imgs_num++;
                                                if (animation.jump_zhen == true && imgs[imgs_num + 1] != undefined) imgs.remove(imgs_num + 1);
                                                if (imgs_num >= imgs.length) {
                                                    if (animation.cycle == true) {
                                                        imgs_num = 0;
                                                    } else {
                                                        if (interval != undefined) clearInterval(interval);
                                                        if (timeoutID != undefined) clearTimeout(timeoutID);
                                                        if (animationID != undefined) cancelAnimationFrame(animationID);
                                                    };
                                                };
                                            };
                                            interval = setInterval(play, animation.rate_zhen == undefined ? 45 : (1000 / animation.rate_zhen));
                                        };

                                    };
                                };
                                if (points == undefined) {
                                    if (fake == true) {
                                        div.style.top = (top - div.offsetHeight / 2) + 'px';
                                        div.style.left = (left - div.offsetWidth / 2) + 'px';
                                    } else {
                                        if (judgeStyle('top') == false) div.style.top = 'calc(50% - ' + (div.offsetHeight / 2) + 'px)';
                                        if (judgeStyle('left') == false) div.style.left = 'calc(50% - ' + (div.offsetWidth / 2) + 'px)';
                                    };
                                } else {
                                    div.style.top = (points[0][1] - div.offsetHeight / 2) + 'px';
                                    div.style.left = (points[0][0]) + 'px';
                                };
                                if (points != undefined) {
                                    var timeS = ((animation.fade == true ? animation.time - 450 : animation.time - 100) / 1000) / 2;
                                    var getAngle = function(x1, y1, x2, y2, bool) {
                                        var x = x1 - x2;
                                        var y = y1 - y2;
                                        var z = Math.sqrt(Math.pow(x, 2) + Math.pow(y, 2));
                                        var cos = y / z;
                                        var radina = Math.acos(cos);
                                        var angle = 180 / (Math.PI / radina);
                                        if (x2 > x1 && y2 === y1) angle = 0;
                                        if (x2 > x1 && y2 < y1) angle = angle - 90;
                                        if (x2 === x1 && y1 > y2) angle = -90;
                                        if (x2 < x1 && y2 < y1) angle = 270 - angle;
                                        if (x2 < x1 && y2 === y1) angle = 180;
                                        if (x2 < x1 && y2 > y1) angle = 270 - angle;
                                        if (x2 === x1 && y2 > y1) angle = 90;
                                        if (x2 > x1 && y2 > y1) angle = angle - 90;
                                        if (bool == true && angle > 90) angle -= 180;
                                        return angle;
                                    };
                                    var p1 = points[0];
                                    var p2 = points[1];
                                    var x0 = p1[0];
                                    var y0 = p1[1];
                                    var x1 = p2[0];
                                    var y1 = p2[1];
                                    div.style.transition = 'all 0s';
                                    div.style.transform = 'rotate(' + getAngle(x0, y0, x1, y1, true) + 'deg)' + (x0 > x1 ? '': ' rotateY(180deg)');
                                    div.style['transform-origin'] = '0 50%';
                                    var div2 = ui.create.div();
                                    div2.style.zIndex = 10; //zzidx
                                    div2.style['pointer-events'] = 'none';
                                    var scale = name == 'baojilinexy' ? 1.2 : 1;
                                    div2.style.height = (60 * scale) + 'px';
                                    div2.style.width = (Math.pow(Math.pow(x1 - x0, 2) + Math.pow(y1 - y0, 2), 0.5) + 2) + 'px';
                                    div2.style.left = (x0) + 'px';
                                    div2.style.top = (y0 - 30) + 'px';
                                    div2.style.transform = 'rotate(' + getAngle(x0, y0, x1, y1) + 'deg) scaleX(0)';
                                    div2.style['transform-origin'] = '0 50%';
                                    div2.style.transition = 'all ' + (timeS * 4 / 3) + 's';
                                    if (src != undefined && animation.image.indexOf('.') == -1) {
                                        div2.style.backgroundSize = '100% 100%';
                                        div2.style.opacity = '1';
                                        div2.setBackgroundImage('extension/祖安武将/pointer/' + animation.image + '/line.png');
                                    } else {
                                        div2.style.background = '#ffffff';
                                    };
                                    setTimeout(function() {
                                        div.style.transition = 'all ' + (timeS * 4 / 3) + 's';
                                        div.style.transform += ' translateX(' + ( - (Math.pow(Math.pow(x1 - x0, 2) + Math.pow(y1 - y0, 2), 0.5) + 2)) + 'px)';
                                        div2.style.transform = 'rotate(' + getAngle(x0, y0, x1, y1) + 'deg) scaleX(1)';
                                    },
                                    50);
                                    setTimeout(function() {
                                        div2.style.transition = 'all ' + (timeS * 2 / 3) + 's';
                                        div2.style.transform = 'rotate(' + getAngle(x0, y0, x1, y1) + 'deg) translateX(' + (Math.pow(Math.pow(x1 - x0, 2) + Math.pow(y1 - y0, 2), 0.5) + 2 - Math.pow(Math.pow(div.offsetHeight / 2, 2) + Math.pow(div.offsetWidth / 2, 2), 0.1)) + 'px) scaleX(0.01)';
                                    },
                                    50 + timeS * 4 / 3 * 1000);
                                    node.appendChild(div2);
                                };
                                if (animation.time <= 100000) {
                                    if (animation.fade == true) {
                                        if (div2 != undefined) {
                                            setTimeout(function() {
                                                div2.hide();
                                            },
                                            animation.time - 350);
                                            setTimeout(function() {
                                                div.hide();
                                            },
                                            animation.time - 400);
                                        } else {
                                            setTimeout(function() {
                                                div.hide();
                                            },
                                            animation.time - 350);
                                        };
                                    };
                                    setTimeout(function() {
                                        if (interval != undefined) clearInterval(interval);
                                        if (timeoutID != undefined) clearTimeout(timeoutID);
                                        if (animationID != undefined) cancelAnimationFrame(animationID);
                                        if (fake == true) {
                                            ui.window.removeChild(div);
                                        } else {
                                            if (node == undefined || node == false) {
                                                ui.window.removeChild(div);
                                            } else {
                                                node.removeChild(div);
                                            };
                                        };
                                        if (div2 != undefined) node.removeChild(div2);
                                        _status.zhx_onAnimation--;
                                        if (_status.zhx_onAnimationPause == true && _status.zhx_onAnimation == 0) {
                                            delete _status.zhx_onAnimationPause;
                                            game.resume2();
                                        };
                                    },
                                    animation.time);
                                };
                            };
                            if (animation.delay != undefined) {
                                setTimeout(finish, animation.delay);
                            } else {
                                finish();
                            };
                        };
                        game.zsPlayLineAnimation2 = function(name, node, fake, points) {
                            var animation = game.jianqiLineAnim2;
                            animation["image"] = name;
                            if (lib.config.zsGuideTime) {
                                animation["time"] = parseInt(lib.config.zsGuideTime);
                            }
                            //调整大小
                            var scale = 1;
                            if (name == 'ShenjianTongLineXy') {
                                scale = 1.05;
                            } else if (name == 'shezhanglinexy') {
                                scale = 0.97;
                            }
                            animation.width = (256 * scale) + 'px';
                            animation.height = (128 * scale) + 'px';
                            if (animation == undefined) return;
                            if (animation.time <= 100000) {
                                if (animation.pause != false && !_status.paused2 && !_status.nopause) {
                                    _status.zhx_onAnimationPause = true;
                                    game.pause2();
                                };
                                if (_status.zhx_onAnimation == undefined) _status.zhx_onAnimation = 0;
                                _status.zhx_onAnimation++;
                            };
                            var src;
                            if (animation.image != undefined) src = 'extension/祖安武将/pointer/' + animation.image + '?' + new Date().getTime();
                            var finish = function() {
                                var animationID;
                                var timeoutID;
                                var interval;
                                var div = ui.create.div();
                                if (fake == true) {
                                    ui.window.appendChild(div);
                                } else {
                                    if (node == undefined || node == false) {
                                        ui.window.appendChild(div);
                                    } else {
                                        node.appendChild(div);
                                    };
                                };
                                if (animation.style != undefined) {
                                    for (var i in animation.style) {
                                        if (i == 'innerHTML') continue;
                                        div.style[i] = animation.style[i];
                                    };
                                };
                                var judgeStyle = function(style) {
                                    if (animation.style == undefined) return false;
                                    if (animation.style != undefined && animation.style[style] != undefined) return true;
                                    return false;
                                };
                                if (judgeStyle('innerHTML')) div.innerHTML = animation.style.innerHTML;
                                if (judgeStyle('width') == false) div.style.width = animation.width;
                                if (judgeStyle('height') == false) div.style.height = animation.height;
                                if (judgeStyle('backgroundSize') == false && judgeStyle('background-size') == false) div.style.backgroundSize = animation.backgroundSize;
                                if (judgeStyle('opacity') == false) div.style.opacity = animation.opacity;
                                if (judgeStyle('zIndex') == false && judgeStyle('z-index') == false) div.style.zIndex = 1001;
                                if (judgeStyle('borderRadius') == false && judgeStyle('border-radius') == false) div.style.borderRadius = '5px';
                                if (judgeStyle('pointer-events') == false && judgeStyle('pointerEvents') == false) div.style['pointer-events'] = 'none';
                                if (src != undefined) {
                                    if (animation.image.indexOf('.') != -1) {
                                        div.setBackgroundImage(src);
                                    } else {
                                        var type_frame1 = 0;
                                        var type_frame = '.jpg';
                                        var num_frame = 1;
                                        type_frame = '.png';
                                        num_frame = 8;
                                        var folder_frame = lib.assetURL + 'extension/祖安武将/pointer/' + animation.image + '/';
                                        var div1 = ui.create.div();
                                        div1.style.height = '100%';
                                        div1.style.width = '100%';
                                        div1.style.top = '0px';
                                        div1.style.left = '0px';
                                        div1.style.opacity = lib.config['extension_祖安设置_zhishiopi'] / 10;
                                        div.appendChild(div1);
                                        var canvas = document.createElement("canvas");
                                        canvas.width = div1.offsetWidth;
                                        canvas.height = div1.offsetHeight;
                                        div1.appendChild(canvas);
                                        var context = canvas.getContext("2d");
                                        var start;
                                        var imgs = [];
                                        var imgs_num = 0;
                                        for (var i = 0; i < num_frame; i++) {
                                            var img = new Image();
                                            img.src = folder_frame + (animation.qianzhui == undefined ? '': animation.qianzhui) + (animation.liang == true ? (i < 10 ? '0' + i: i) : i) + type_frame;
                                            if (i >= num_frame - 1) img.zhx_final = true;
                                            img.onload = function() {
                                                imgs.push(this);
                                                if (this.zhx_final == true) start();
                                            };
                                            img.onerror = function() {
                                                if (this.zhx_final == true) start();
                                            };
                                        };
                                        start = function() {
                                            var play = function() {
                                                if (imgs_num >= imgs.length) return;
                                                var img = imgs[imgs_num];
                                                context.clearRect(0, 0, img.width, img.height);
                                                context.drawImage(img, 0, 0, img.width, img.height, 0, 0, div1.offsetWidth, div1.offsetHeight);
                                                imgs_num++;
                                                if (animation.jump_zhen == true && imgs[imgs_num + 1] != undefined) imgs.remove(imgs_num + 1);
                                                if (imgs_num >= imgs.length) {
                                                    if (animation.cycle == true) {
                                                        imgs_num = 0;
                                                    } else {
                                                        if (interval != undefined) clearInterval(interval);
                                                        if (timeoutID != undefined) clearTimeout(timeoutID);
                                                        if (animationID != undefined) cancelAnimationFrame(animationID);
                                                    };
                                                };
                                            };
                                            interval = setInterval(play, animation.rate_zhen == undefined ? 45 : (1000 / animation.rate_zhen));
                                        };

                                    };
                                };
                                if (points == undefined) {
                                    if (fake == true) {
                                        div.style.top = (top - div.offsetHeight / 2) + 'px';
                                        div.style.left = (left - div.offsetWidth / 2) + 'px';
                                    } else {
                                        if (judgeStyle('top') == false) div.style.top = 'calc(50% - ' + (div.offsetHeight / 2) + 'px)';
                                        if (judgeStyle('left') == false) div.style.left = 'calc(50% - ' + (div.offsetWidth / 2) + 'px)';
                                    };
                                } else {
                                    div.style.top = (points[0][1] - div.offsetHeight / 2) + 'px';
                                    div.style.left = (points[0][0]) + 'px';
                                };
                                if (points != undefined) {
                                    var timeS = ((animation.fade == true ? animation.time - 450 : animation.time - 100) / 1000) / 2;
                                    var getAngle = function(x1, y1, x2, y2, bool) {
                                        var x = x1 - x2;
                                        var y = y1 - y2;
                                        var z = Math.sqrt(Math.pow(x, 2) + Math.pow(y, 2));
                                        var cos = y / z;
                                        var radina = Math.acos(cos);
                                        var angle = 180 / (Math.PI / radina);
                                        if (x2 > x1 && y2 === y1) angle = 0;
                                        if (x2 > x1 && y2 < y1) angle = angle - 90;
                                        if (x2 === x1 && y1 > y2) angle = -90;
                                        if (x2 < x1 && y2 < y1) angle = 270 - angle;
                                        if (x2 < x1 && y2 === y1) angle = 180;
                                        if (x2 < x1 && y2 > y1) angle = 270 - angle;
                                        if (x2 === x1 && y2 > y1) angle = 90;
                                        if (x2 > x1 && y2 > y1) angle = angle - 90;
                                        if (bool == true && angle > 90) angle -= 180;
                                        return angle;
                                    };
                                    var p1 = points[0];
                                    var p2 = points[1];
                                    var x0 = p1[0];
                                    var y0 = p1[1];
                                    var x1 = p2[0];
                                    var y1 = p2[1];
                                    div.style.transition = 'all 0s';
                                    div.style.transform = 'rotate(' + getAngle(x0, y0, x1, y1, true) + 'deg)' + (x0 > x1 ? '': ' rotateY(180deg)');
                                    div.style['transform-origin'] = '0 50%';
                                    var div2 = ui.create.div();
                                    div2.style.zIndex = 1000;
                                    div2.style['pointer-events'] = 'none';
                                    div2.style.height = '20px';
                                    div2.style.width = (Math.pow(Math.pow(x1 - x0, 2) + Math.pow(y1 - y0, 2), 0.5) + 2) + 'px';
                                    div2.style.left = (x0) + 'px';
                                    div2.style.top = (y0 - 10) + 'px';
                                    div2.style.transform = 'rotate(' + getAngle(x0, y0, x1, y1) + 'deg) scaleX(0)';
                                    div2.style['transform-origin'] = '0 50%';
                                    div2.style.transition = 'all ' + (timeS * 4 / 3) + 's';
                                    if (src != undefined && animation.image.indexOf('.') == -1) {
                                        div2.style.backgroundSize = '100% 100%';
                                        div2.style.opacity = lib.config['extension_祖安设置_zhishiopi'] / 10;
                                        div2.setBackgroundImage('extension/祖安武将/pointer/' + animation.image + '/line.png');
                                    } else {
                                        div2.style.background = '#ffffff';
                                    };
                                    setTimeout(function() {
                                        div.style.transition = 'all ' + (timeS * 4 / 3) + 's';
                                        div.style.transform += ' translateX(' + ( - (Math.pow(Math.pow(x1 - x0, 2) + Math.pow(y1 - y0, 2), 0.5) + 2)) + 'px)';
                                        div2.style.transform = 'rotate(' + getAngle(x0, y0, x1, y1) + 'deg) scaleX(1)';
                                    },
                                    50);
                                    setTimeout(function() {
                                        div2.style.transition = 'all ' + (timeS * 2 / 3) + 's';
                                        div2.style.transform = 'rotate(' + getAngle(x0, y0, x1, y1) + 'deg) translateX(' + (Math.pow(Math.pow(x1 - x0, 2) + Math.pow(y1 - y0, 2), 0.5) + 2 - Math.pow(Math.pow(div.offsetHeight / 2, 2) + Math.pow(div.offsetWidth / 2, 2), 0.5)) + 'px) scaleX(0.01)';
                                    },
                                    50 + timeS * 4 / 3 * 1000);
                                    node.appendChild(div2);
                                };
                                if (animation.time <= 100000) {
                                    if (animation.fade == true) {
                                        if (div2 != undefined) {
                                            setTimeout(function() {
                                                div2.hide();
                                            },
                                            animation.time - 350);
                                            setTimeout(function() {
                                                div.hide();
                                            },
                                            animation.time - 400);
                                        } else {
                                            setTimeout(function() {
                                                div.hide();
                                            },
                                            animation.time - 350);
                                        };
                                    };
                                    setTimeout(function() {
                                        if (interval != undefined) clearInterval(interval);
                                        if (timeoutID != undefined) clearTimeout(timeoutID);
                                        if (animationID != undefined) cancelAnimationFrame(animationID);
                                        if (fake == true) {
                                            ui.window.removeChild(div);
                                        } else {
                                            if (node == undefined || node == false) {
                                                ui.window.removeChild(div);
                                            } else {
                                                node.removeChild(div);
                                            };
                                        };
                                        if (div2 != undefined) node.removeChild(div2);
                                        _status.zhx_onAnimation--;
                                        if (_status.zhx_onAnimationPause == true && _status.zhx_onAnimation == 0) {
                                            delete _status.zhx_onAnimationPause;
                                            game.resume2();
                                        };
                                    },
                                    animation.time);
                                };
                            };
                            if (animation.delay != undefined) {
                                setTimeout(finish, animation.delay);
                            } else {
                                finish();
                            };
                        };
                    }
                    game.zsOriginLineXy = game.linexy;
                    game.zsShuimoLineXy = function(path, config, bool, player, target) {
                        var from = [path[0], path[1]];
                        var to = [path[2], path[3]];
                        var total = typeof arguments[1] === 'number' ? arguments[1] : lib.config.duration * 2;
                        var opacity = 0.85;
                        r = Math.floor(Math.random() * 256); //随机生成256以内r值
                        g = Math.floor(Math.random() * 256); //随机生成256以内g值
                        b = Math.floor(Math.random() * 256); //随机生成256以内b值
                        var color = [r, g, b];
                        var dashed = false;
                        var drag = false;
                        if (typeof arguments[1] == 'object') {
                            for (var i in arguments[1]) {
                                switch (i) {
                                case 'opacity':
                                    opacity = arguments[1][i];
                                    break;
                                case 'color':
                                    color = arguments[1][i];
                                    break;
                                case 'dashed':
                                    dashed = arguments[1][i];
                                    break;
                                case 'duration':
                                    total = arguments[1][i];
                                    break;
                                }
                            }
                        } else if (arguments[1] == 'fire' || arguments[1] == 'thunder' || arguments[1] == 'green') {
                            color = arguments[1];
                        }
                        total *= 2;
                        var longtou = ui.create.div('.zhx-longtou');
                        ui.create.div('.zhx-longtou-image', longtou);
                        color = [r, g, b];
                        var node;
                        if (arguments[1] == 'drag') {
                            color = [r, g, b];
                            drag = true;
                            if (arguments[2]) {
                                node = arguments[2]
                            } else {
                                node = ui.create.div('.linexy.drag');
                                ui.create.div('.zhx-shuimo-line', node);
                                node.style.left = from[0] + 'px';
                                node.style.top = from[1] + 'px';
                                node.style.opacity = 0.7;
                                longtou.style.left = from[0] + 'px';
                                longtou.style.top = from[1] + 'px';
                                longtou.style.opacity = 0;
                                node.style.background = 'linear-gradient(transparent,rgba(' + color.toString() + ',' + opacity + '),rgba(' + color.toString() + ',' + opacity + '))';
                                if (game.chess) {
                                    ui.chess.appendChild(node);
                                    ui.chess.appendChild(longtou);
                                } else {
                                    ui.arena.appendChild(node);
                                    ui.arena.appendChild(longtou);
                                }
                            }
                        } else {
                            node = ui.create.div('.linexy.hidden');
                            ui.create.div('.zhx-shuimo-line', node);
                            node.style.left = from[0] + 'px';
                            node.style.top = from[1] + 'px';
                            node.style.opacity = 0.7;
                            node.style.background = 'linear-gradient(transparent,rgba(' + color.toString() + ',' + opacity + '),rgba(' + color.toString() + ',' + opacity + '))';
                            if (lib.config.zsGuideTime) {
                                node.style.transitionDuration = (parseInt(lib.config.zsGuideTime) / 1000) + 's';
                            } else {
                                node.style.transitionDuration = (1200 / 1000) + 's';
                            }
                            longtou.style.left = from[0] + 'px';
                            longtou.style.top = from[1] + 'px';
                            longtou.style.opacity = 0;
                            if (lib.config.zsGuideTime) {
                                longtou.style.transitionDuration = (parseInt(lib.config.zsGuideTime) / 1000) + 's';
                            } else {
                                longtou.style.transitionDuration = (1200 / 1000) + 's';
                            }
                        }
                        var dy = to[1] - from[1];
                        var dx = to[0] - from[0];
                        var deg = Math.atan(Math.abs(dy) / Math.abs(dx)) / Math.PI * 180;
                        if (dx >= 0) {
                            if (dy <= 0) {
                                deg += 90;
                            } else {
                                deg = 90 - deg;
                            }
                        } else {
                            if (dy <= 0) {
                                deg = 270 - deg;
                            } else {
                                deg += 270;
                            }
                        }
                        if (drag) {
                            node.style.transform = 'rotate(' + ( - deg) + 'deg)';
                            node.style.height = get.xyDistance(from, to) + 'px';

                            longtou.style.transform = 'rotate(' + ( - deg) + 'deg)';
                            longtou.style.opacity = 0.7;
                        } else {
                            node.style.transform = 'rotate(' + ( - deg) + 'deg) scaleY(0)';
                            node.style.height = get.xyDistance(from, to) + 'px';

                            longtou.style.transform = 'rotate(' + ( - deg) + 'deg) translate(0,0)';
                            if (game.chess) {
                                ui.chess.appendChild(node);
                                ui.chess.appendChild(longtou);
                            } else {
                                ui.arena.appendChild(node);
                                ui.arena.appendChild(longtou);
                            }
                            ui.refresh(node);
                            node.show();
                            node.style.transform = 'rotate(' + ( - deg) + 'deg) scaleY(1)';
                            ui.refresh(longtou);
                            longtou.show();
                            longtou.style.transform = 'rotate(' + ( - deg) + 'deg) translate(0,' + get.xyDistance(from, to) + 'px)';
                            longtou.style.opacity = 0.7;
                            node.listenTransition(function() {
                                setTimeout(function() {
                                    if (node.classList.contains('removing')) return;
                                    node.delete();
                                },
                                total / 3);
                            });
                            longtou.listenTransition(function() {
                                //setTimeout(function(){
                                if (longtou.classList.contains('removing')) return;
                                longtou.delete();
                                //},total/3);
                            });
                        }
                        return node;
                    };
                    //借鉴了极光的扩展OL，以及玄武江湖。
                    //官阶祖安武将
                    game.zsguanjieLineXy = function(path, config, bool, player, target) {
                        var from = [path[0], path[1]];
                        var to = [path[2], path[3]];
                        var line = 'jingdian';
                        var source = player || _status.event?.player;
                        if (source && source.guanjie && source.guanjie == 'taixuhuanjing') line = 'ShenjianTongLineXy';
                        if (get.mode() == 'boss' && source && source != game.me) {
                            if (source.identity == 'zhu') line = 'jinlonglinexy';
                            if (source.identity == 'zhong') line = 'shezhanglinexy';
                        }
                        //alert(from[1]/window.innerHeight);
                        //修正一下偏移
                        if (source && (source == game.me || (source.guanjie && source.guanjie.indexOf('da') == 0))) line = 'yulong';
                        /*if(from[1]<=350) from[0]-=10;
	                    if(to[1]<=350) to[0]-=10;*/
                        if (! (source == game.me && !ui.fakeme && !ui.chess)) {
                            from[0] -= 15;
                        }
                        if (! (target == game.me && !ui.fakeme && !ui.chess)) {
                            to[0] -= 15;
                        }
                        if (['ShenjianTongLineXy', 'shezhanglinexy', 'jinlonglinexy'].contains(line)) {
                            game.zsPlayLineAnimation2(line, ui.arena, false, [from, to], player, target);
                        } else {
                            game.zsPlayLineAnimation(line + 'LineXy', ui.arena, false, [from, to], player, target);
                        }
                    };
                    //玉龙祖安武将
                    game.zsyulongLineXy = function(path, config, bool, player, target) {
                        var from = [path[0], path[1]];
                        var to = [path[2], path[3]];
                        from[0] -= 10;
                        to[0] -= 10;
                        if (game.chess) {
                            game.zsPlayLineAnimation('yulongLineXy', ui.chess, false, [from, to], player, target);
                        } else {
                            game.zsPlayLineAnimation('yulongLineXy', ui.arena, false, [from, to], player, target);
                        };
                    };
                    //经典祖安武将
                    game.zsjingdianLineXy = function(path, config, bool, player, target) {
                        var from = [path[0], path[1]];
                        var to = [path[2], path[3]];
                        from[0] -= 10;
                        to[0] -= 10;
                        if (game.chess) {
                            game.zsPlayLineAnimation('jingdianLineXy', ui.chess, false, [from, to], player, target);
                        } else {
                            game.zsPlayLineAnimation('jingdianLineXy', ui.arena, false, [from, to], player, target);
                        };
                    };
                    //暴击祖安武将
                    game.zsbaojiLineXy = function(path, config, bool, player, target) {
                        var from = [path[0], path[1]];
                        var to = [path[2], path[3]];
                        from[0] -= 10;
                        to[0] -= 10;
                        if (game.chess) {
                            game.zsPlayLineAnimation('baojilinexy', ui.chess, false, [from, to], player, target);
                        } else {
                            game.zsPlayLineAnimation('baojilinexy', ui.arena, false, [from, to], player, target);
                        };
                    };

                    if (lib.config.zuanzhishixian && lib.config.zuanzhishixian !== 'moren') {
                        game.saveConfig('extension_十周年UI_playerLineEffect', false);
                        if (window.decadeUI) decadeUI.config.playerLineEffect = false;
                        game.linexy = game['zs' + lib.config.zuanzhishixian + 'LineXy'];
                    }

                    game.saveConfig('zuanzhishixian', lib.config['extension_祖安设置_zhishixian']);
                    game.saveConfig('extension_十周年UI_playerLineEffect', lib.config['extension_祖安设置_zhishixian']);
                    if (window.decadeUI) decadeUI.config.playerLineEffect = lib.config['extension_祖安设置_zhishixian'];
                    if (lib.config['extension_祖安设置_zhishixian'] == 'moren') {
                        game.linexy = game.zsOriginLineXy;
                    } else {
                        game.linexy = game['zs' + lib.config['extension_祖安设置_zhishixian'] + 'LineXy'];
                    }
                    // ---------------------------------------祖安武将------------------------------------------//
                    // ---------------------------------------祖安武将确认------------------------------------------//
                    lib.skill._zuanattacklinecheck = {
                        trigger: {
                            global: ['gameDrawBefore'],
                            player: "enterGame",
                        },
                        direct: true,
                        priority: 105,
                        filter: function(event, player) {
                            return player == game.me;
                        },
                        content: function() {
                            game.saveConfig('zuanzhishixian', lib.config['extension_祖安设置_zhishixian']);
                            game.saveConfig('extension_十周年UI_playerLineEffect', lib.config['extension_祖安设置_zhishixian']);
                            if (window.decadeUI) decadeUI.config.playerLineEffect = lib.config['extension_祖安设置_zhishixian'];
                            if (lib.config['extension_祖安设置_zhishixian'] == 'moren') {
                                game.linexy = game.zsOriginLineXy;
                            } else {
                                game.linexy = game['zs' + lib.config['extension_祖安设置_zhishixian'] + 'LineXy'];
                            }
                        },
                    }
                } else { //玉龙转折点
                    var jianqiLineAnim = {
                        "time": 1200,
                        "position": "screen",
                        "width": "256px",
                        "height": "128px",
                        "backgroundSize": "100% 100%",
                        "opacity": 1,
                        "show": "none",
                        "fade": true,
                        "pause": false,
                        "rate_zhen": 18,
                        "jump_zhen": false,
                        "qianzhui": "",
                        "liang": false,
                        "isLine": true,
                        "cycle": true,
                        "style": {},
                        "skills": [],
                        "cards": [],
                        "forbid": false,
                        "image": "jianqilinexy"
                    };
                    game.zsPlayLineAnimation = function(name, node, fake, points) {
                        var animation = jianqiLineAnim;
                        animation["image"] = name;
                        if (lib.config.zsGuideTime) {
                            animation["time"] = parseInt(lib.config.zsGuideTime);
                        }
                        if (animation == undefined) return;
                        if (animation.time <= 100000) {
                            if (animation.pause != false && !_status.paused2 && !_status.nopause) {
                                _status.zhx_onAnimationPause = true;
                                game.pause2();
                            };
                            if (_status.zhx_onAnimation == undefined) _status.zhx_onAnimation = 0;
                            _status.zhx_onAnimation++;
                        };
                        var src;
                        if (animation.image != undefined) src = 'extension/祖安武将/pointer/' + animation.image + '?' + new Date().getTime();
                        var finish = function() {
                            var animationID;
                            var timeoutID;
                            var interval;
                            var div = ui.create.div();
                            if (fake == true) {
                                ui.window.appendChild(div);
                            } else {
                                if (node == undefined || node == false) {
                                    ui.window.appendChild(div);
                                } else {
                                    node.appendChild(div);
                                };
                            };
                            if (animation.style != undefined) {
                                for (var i in animation.style) {
                                    if (i == 'innerHTML') continue;
                                    div.style[i] = animation.style[i];
                                };
                            };
                            var judgeStyle = function(style) {
                                if (animation.style == undefined) return false;
                                if (animation.style != undefined && animation.style[style] != undefined) return true;
                                return false;
                            };
                            if (judgeStyle('innerHTML')) div.innerHTML = animation.style.innerHTML;
                            if (judgeStyle('width') == false) div.style.width = animation.width;
                            if (judgeStyle('height') == false) div.style.height = animation.height;
                            if (judgeStyle('backgroundSize') == false && judgeStyle('background-size') == false) div.style.backgroundSize = animation.backgroundSize;
                            if (judgeStyle('opacity') == false) div.style.opacity = animation.opacity;
                            if (judgeStyle('zIndex') == false && judgeStyle('z-index') == false) div.style.zIndex = 1001;
                            if (judgeStyle('borderRadius') == false && judgeStyle('border-radius') == false) div.style.borderRadius = '5px';
                            if (judgeStyle('pointer-events') == false && judgeStyle('pointerEvents') == false) div.style['pointer-events'] = 'none';
                            if (src != undefined) {
                                if (animation.image.indexOf('.') != -1) {
                                    div.setBackgroundImage(src);
                                } else {
                                    var type_frame1 = 0;
                                    var type_frame = '.jpg';
                                    var num_frame = 1;
                                    type_frame = '.png';
                                    num_frame = 8;
                                    var folder_frame = lib.assetURL + 'extension/祖安武将/pointer/' + animation.image + '/';
                                    var div1 = ui.create.div();
                                    div1.style.height = '100%';
                                    div1.style.width = '100%';
                                    div1.style.top = '0px';
                                    div1.style.left = '0px';
                                    div1.style.opacity = lib.config['extension_祖安设置_zhishiopi'] / 10;
                                    div.appendChild(div1);
                                    var canvas = document.createElement("canvas");
                                    canvas.width = div1.offsetWidth;
                                    canvas.height = div1.offsetHeight;
                                    div1.appendChild(canvas);
                                    var context = canvas.getContext("2d");
                                    var start;
                                    var imgs = [];
                                    var imgs_num = 0;
                                    for (var i = 0; i < num_frame; i++) {
                                        var img = new Image();
                                        img.src = folder_frame + (animation.qianzhui == undefined ? '': animation.qianzhui) + (animation.liang == true ? (i < 10 ? '0' + i: i) : i) + type_frame;
                                        if (i >= num_frame - 1) img.zhx_final = true;
                                        img.onload = function() {
                                            imgs.push(this);
                                            if (this.zhx_final == true) start();
                                        };
                                        img.onerror = function() {
                                            if (this.zhx_final == true) start();
                                        };
                                    };
                                    start = function() {
                                        var play = function() {
                                            if (imgs_num >= imgs.length) return;
                                            var img = imgs[imgs_num];
                                            context.clearRect(0, 0, img.width, img.height);
                                            context.drawImage(img, 0, 0, img.width, img.height, 0, 0, div1.offsetWidth, div1.offsetHeight);
                                            imgs_num++;
                                            if (animation.jump_zhen == true && imgs[imgs_num + 1] != undefined) imgs.remove(imgs_num + 1);
                                            if (imgs_num >= imgs.length) {
                                                if (animation.cycle == true) {
                                                    imgs_num = 0;
                                                } else {
                                                    if (interval != undefined) clearInterval(interval);
                                                    if (timeoutID != undefined) clearTimeout(timeoutID);
                                                    if (animationID != undefined) cancelAnimationFrame(animationID);
                                                };
                                            };
                                        };
                                        interval = setInterval(play, animation.rate_zhen == undefined ? 45 : (1000 / animation.rate_zhen));
                                    };

                                };
                            };
                            if (points == undefined) {
                                if (fake == true) {
                                    div.style.top = (top - div.offsetHeight / 2) + 'px';
                                    div.style.left = (left - div.offsetWidth / 2) + 'px';
                                } else {
                                    if (judgeStyle('top') == false) div.style.top = 'calc(50% - ' + (div.offsetHeight / 2) + 'px)';
                                    if (judgeStyle('left') == false) div.style.left = 'calc(50% - ' + (div.offsetWidth / 2) + 'px)';
                                };
                            } else {
                                div.style.top = (points[0][1] - div.offsetHeight / 2) + 'px';
                                div.style.left = (points[0][0]) + 'px';
                            };
                            if (points != undefined) {
                                var timeS = ((animation.fade == true ? animation.time - 450 : animation.time - 100) / 1000) / 2;
                                var getAngle = function(x1, y1, x2, y2, bool) {
                                    var x = x1 - x2;
                                    var y = y1 - y2;
                                    var z = Math.sqrt(Math.pow(x, 2) + Math.pow(y, 2));
                                    var cos = y / z;
                                    var radina = Math.acos(cos);
                                    var angle = 180 / (Math.PI / radina);
                                    if (x2 > x1 && y2 === y1) angle = 0;
                                    if (x2 > x1 && y2 < y1) angle = angle - 90;
                                    if (x2 === x1 && y1 > y2) angle = -90;
                                    if (x2 < x1 && y2 < y1) angle = 270 - angle;
                                    if (x2 < x1 && y2 === y1) angle = 180;
                                    if (x2 < x1 && y2 > y1) angle = 270 - angle;
                                    if (x2 === x1 && y2 > y1) angle = 90;
                                    if (x2 > x1 && y2 > y1) angle = angle - 90;
                                    if (bool == true && angle > 90) angle -= 180;
                                    return angle;
                                };
                                var p1 = points[0];
                                var p2 = points[1];
                                var x0 = p1[0];
                                var y0 = p1[1];
                                var x1 = p2[0];
                                var y1 = p2[1];
                                div.style.transition = 'all 0s';
                                div.style.transform = 'rotate(' + getAngle(x0, y0, x1, y1, true) + 'deg)' + (x0 > x1 ? '': ' rotateY(180deg)');
                                div.style['transform-origin'] = '0 50%';
                                var div2 = ui.create.div();
                                div2.style.zIndex = 1000;
                                div2.style['pointer-events'] = 'none';
                                div2.style.height = '20px';
                                div2.style.width = (Math.pow(Math.pow(x1 - x0, 2) + Math.pow(y1 - y0, 2), 0.5) + 2) + 'px';
                                div2.style.left = (x0) + 'px';
                                div2.style.top = (y0 - 10) + 'px';
                                div2.style.transform = 'rotate(' + getAngle(x0, y0, x1, y1) + 'deg) scaleX(0)';
                                div2.style['transform-origin'] = '0 50%';
                                div2.style.transition = 'all ' + (timeS * 4 / 3) + 's';
                                if (src != undefined && animation.image.indexOf('.') == -1) {
                                    div2.style.backgroundSize = '100% 100%';
                                    div2.style.opacity = lib.config['extension_祖安设置_zhishiopi'] / 10;
                                    div2.setBackgroundImage('extension/祖安武将/pointer/' + animation.image + '/line.png');
                                } else {
                                    div2.style.background = '#ffffff';
                                };
                                setTimeout(function() {
                                    div.style.transition = 'all ' + (timeS * 4 / 3) + 's';
                                    div.style.transform += ' translateX(' + ( - (Math.pow(Math.pow(x1 - x0, 2) + Math.pow(y1 - y0, 2), 0.5) + 2)) + 'px)';
                                    div2.style.transform = 'rotate(' + getAngle(x0, y0, x1, y1) + 'deg) scaleX(1)';
                                },
                                50);
                                setTimeout(function() {
                                    div2.style.transition = 'all ' + (timeS * 2 / 3) + 's';
                                    div2.style.transform = 'rotate(' + getAngle(x0, y0, x1, y1) + 'deg) translateX(' + (Math.pow(Math.pow(x1 - x0, 2) + Math.pow(y1 - y0, 2), 0.5) + 2 - Math.pow(Math.pow(div.offsetHeight / 2, 2) + Math.pow(div.offsetWidth / 2, 2), 0.5)) + 'px) scaleX(0.01)';
                                },
                                50 + timeS * 4 / 3 * 1000);
                                node.appendChild(div2);
                            };
                            if (animation.time <= 100000) {
                                if (animation.fade == true) {
                                    if (div2 != undefined) {
                                        setTimeout(function() {
                                            div2.hide();
                                        },
                                        animation.time - 350);
                                        setTimeout(function() {
                                            div.hide();
                                        },
                                        animation.time - 400);
                                    } else {
                                        setTimeout(function() {
                                            div.hide();
                                        },
                                        animation.time - 350);
                                    };
                                };
                                setTimeout(function() {
                                    if (interval != undefined) clearInterval(interval);
                                    if (timeoutID != undefined) clearTimeout(timeoutID);
                                    if (animationID != undefined) cancelAnimationFrame(animationID);
                                    if (fake == true) {
                                        ui.window.removeChild(div);
                                    } else {
                                        if (node == undefined || node == false) {
                                            ui.window.removeChild(div);
                                        } else {
                                            node.removeChild(div);
                                        };
                                    };
                                    if (div2 != undefined) node.removeChild(div2);
                                    _status.zhx_onAnimation--;
                                    if (_status.zhx_onAnimationPause == true && _status.zhx_onAnimation == 0) {
                                        delete _status.zhx_onAnimationPause;
                                        game.resume2();
                                    };
                                },
                                animation.time);
                            };
                        };
                        if (animation.delay != undefined) {
                            setTimeout(finish, animation.delay);
                        } else {
                            finish();
                        };
                    };
                    game.zsOriginLineXy = game.linexy;
                    game.zsShuimoLineXy = function(path, config, bool, player, target) {
                        var from = [path[0], path[1]];
                        var to = [path[2], path[3]];
                        var total = typeof arguments[1] === 'number' ? arguments[1] : lib.config.duration * 2;
                        var opacity = 0.85;
                        r = Math.floor(Math.random() * 256); //随机生成256以内r值
                        g = Math.floor(Math.random() * 256); //随机生成256以内g值
                        b = Math.floor(Math.random() * 256); //随机生成256以内b值
                        var color = [r, g, b];
                        var dashed = false;
                        var drag = false;
                        if (typeof arguments[1] == 'object') {
                            for (var i in arguments[1]) {
                                switch (i) {
                                case 'opacity':
                                    opacity = arguments[1][i];
                                    break;
                                case 'color':
                                    color = arguments[1][i];
                                    break;
                                case 'dashed':
                                    dashed = arguments[1][i];
                                    break;
                                case 'duration':
                                    total = arguments[1][i];
                                    break;
                                }
                            }
                        } else if (arguments[1] == 'fire' || arguments[1] == 'thunder' || arguments[1] == 'green') {
                            color = arguments[1];
                        }
                        total *= 2;
                        var longtou = ui.create.div('.zhx-longtou');
                        ui.create.div('.zhx-longtou-image', longtou);
                        color = [r, g, b];
                        var node;
                        if (arguments[1] == 'drag') {
                            color = [r, g, b];
                            drag = true;
                            if (arguments[2]) {
                                node = arguments[2]
                            } else {
                                node = ui.create.div('.linexy.drag');
                                ui.create.div('.zhx-shuimo-line', node);
                                node.style.left = from[0] + 'px';
                                node.style.top = from[1] + 'px';
                                node.style.opacity = 0.7;
                                longtou.style.left = from[0] + 'px';
                                longtou.style.top = from[1] + 'px';
                                longtou.style.opacity = 0;
                                node.style.background = 'linear-gradient(transparent,rgba(' + color.toString() + ',' + opacity + '),rgba(' + color.toString() + ',' + opacity + '))';
                                if (game.chess) {
                                    ui.chess.appendChild(node);
                                    ui.chess.appendChild(longtou);
                                } else {
                                    ui.arena.appendChild(node);
                                    ui.arena.appendChild(longtou);
                                }
                            }
                        } else {
                            node = ui.create.div('.linexy.hidden');
                            ui.create.div('.zhx-shuimo-line', node);
                            node.style.left = from[0] + 'px';
                            node.style.top = from[1] + 'px';
                            node.style.opacity = 0.7;
                            node.style.background = 'linear-gradient(transparent,rgba(' + color.toString() + ',' + opacity + '),rgba(' + color.toString() + ',' + opacity + '))';
                            if (lib.config.zsGuideTime) {
                                node.style.transitionDuration = (parseInt(lib.config.zsGuideTime) / 1000) + 's';
                            } else {
                                node.style.transitionDuration = (1200 / 1000) + 's';
                            }
                            longtou.style.left = from[0] + 'px';
                            longtou.style.top = from[1] + 'px';
                            longtou.style.opacity = 0;
                            if (lib.config.zsGuideTime) {
                                longtou.style.transitionDuration = (parseInt(lib.config.zsGuideTime) / 1000) + 's';
                            } else {
                                longtou.style.transitionDuration = (1200 / 1000) + 's';
                            }
                        }
                        var dy = to[1] - from[1];
                        var dx = to[0] - from[0];
                        var deg = Math.atan(Math.abs(dy) / Math.abs(dx)) / Math.PI * 180;
                        if (dx >= 0) {
                            if (dy <= 0) {
                                deg += 90;
                            } else {
                                deg = 90 - deg;
                            }
                        } else {
                            if (dy <= 0) {
                                deg = 270 - deg;
                            } else {
                                deg += 270;
                            }
                        }
                        if (drag) {
                            node.style.transform = 'rotate(' + ( - deg) + 'deg)';
                            node.style.height = get.xyDistance(from, to) + 'px';

                            longtou.style.transform = 'rotate(' + ( - deg) + 'deg)';
                            longtou.style.opacity = 0.7;
                        } else {
                            node.style.transform = 'rotate(' + ( - deg) + 'deg) scaleY(0)';
                            node.style.height = get.xyDistance(from, to) + 'px';

                            longtou.style.transform = 'rotate(' + ( - deg) + 'deg) translate(0,0)';
                            if (game.chess) {
                                ui.chess.appendChild(node);
                                ui.chess.appendChild(longtou);
                            } else {
                                ui.arena.appendChild(node);
                                ui.arena.appendChild(longtou);
                            }
                            ui.refresh(node);
                            node.show();
                            node.style.transform = 'rotate(' + ( - deg) + 'deg) scaleY(1)';
                            ui.refresh(longtou);
                            longtou.show();
                            longtou.style.transform = 'rotate(' + ( - deg) + 'deg) translate(0,' + get.xyDistance(from, to) + 'px)';
                            longtou.style.opacity = 0.7;
                            node.listenTransition(function() {
                                setTimeout(function() {
                                    if (node.classList.contains('removing')) return;
                                    node.delete();
                                },
                                total / 3);
                            });
                            longtou.listenTransition(function() {
                                //setTimeout(function(){
                                if (longtou.classList.contains('removing')) return;
                                longtou.delete();
                                //},total/3);
                            });
                        }
                        return node;
                    };
                    //借鉴了极光的扩展OL，以及玄武江湖。
                    //先攻指示线
                    game.zsXiangongLineXy = function(path, config, bool, player, target) {
                        var from = [path[0], path[1]];
                        var to = [path[2], path[3]];
                        if (game.chess) {
                            game.zsPlayLineAnimation('jianqilinexy', ui.chess, false, [from, to], player, target);
                        } else {
                            game.zsPlayLineAnimation('jianqilinexy', ui.arena, false, [from, to], player, target);
                        };
                    };

                    //竹杖指示线
                    game.zsZhuzhangLineXy = function(path, config, bool, player, target) {
                        var from = [path[0], path[1]];
                        var to = [path[2], path[3]];
                        if (game.chess) {
                            game.zsPlayLineAnimation('zhuzhanglinexy', ui.chess, false, [from, to], player, target);
                        } else {
                            game.zsPlayLineAnimation('zhuzhanglinexy', ui.arena, false, [from, to], player, target);
                        };
                    };

                    //水墨指示线
                    game.zsMohuaLineXy = function(path, config, bool, player, target) {
                        var from = [path[0], path[1]];
                        var to = [path[2], path[3]];
                        if (game.chess) {
                            game.zsPlayLineAnimation('mohualinexy', ui.chess, false, [from, to], player, target);
                        } else {
                            game.zsPlayLineAnimation('mohualinexy', ui.arena, false, [from, to], player, target);
                        };
                    };

                    //神剑指示线
                    game.zsShenjianLineXy = function(path, config, bool, player, target) {
                        var from = [path[0], path[1]];
                        var to = [path[2], path[3]];
                        if (game.chess) {
                            game.zsPlayLineAnimation('shenjianlinexy', ui.chess, false, [from, to], player, target);
                        } else {
                            game.zsPlayLineAnimation('shenjianlinexy', ui.arena, false, [from, to], player, target);
                        };
                    };

                    //金剑指示线
                    game.zsShenjianJinLineXy = function(path, config, bool, player, target) {
                        var from = [path[0], path[1]];
                        var to = [path[2], path[3]];
                        if (game.chess) {
                            game.zsPlayLineAnimation('shenjianjinlinexy', ui.chess, false, [from, to], player, target);
                        } else {
                            game.zsPlayLineAnimation('shenjianjinlinexy', ui.arena, false, [from, to], player, target);
                        };
                    };

                    //铜剑指示线
                    game.zsShenjianTongLineXy = function(path, config, bool, player, target) {
                        var from = [path[0], path[1]];
                        var to = [path[2], path[3]];
                        if (game.chess) {
                            game.zsPlayLineAnimation('shenjiantonglinexy', ui.chess, false, [from, to], player, target);
                        } else {
                            game.zsPlayLineAnimation('shenjiantonglinexy', ui.arena, false, [from, to], player, target);
                        };
                    };

                    //墨剑指示线
                    game.zsShenjianMoLineXy = function(path, config, bool, player, target) {
                        var from = [path[0], path[1]];
                        var to = [path[2], path[3]];
                        if (game.chess) {
                            game.zsPlayLineAnimation('shenjianmolinexy', ui.chess, false, [from, to], player, target);
                        } else {
                            game.zsPlayLineAnimation('shenjianmolinexy', ui.arena, false, [from, to], player, target);
                        };
                    };

                    //御剑指示线
                    game.zsYujianLineXy = function(path, config, bool, player, target) {
                        var from = [path[0], path[1]];
                        var to = [path[2], path[3]];
                        if (game.chess) {
                            game.zsPlayLineAnimation('yujianlinexy', ui.chess, false, [from, to], player, target);
                        } else {
                            game.zsPlayLineAnimation('yujianlinexy', ui.arena, false, [from, to], player, target);
                        };
                    };

                    //暗黑指示线
                    game.zsAnheiLineXy = function(path, config, bool, player, target) {
                        var from = [path[0], path[1]];
                        var to = [path[2], path[3]];
                        if (game.chess) {
                            game.zsPlayLineAnimation('anheilinexy', ui.chess, false, [from, to], player, target);
                        } else {
                            game.zsPlayLineAnimation('anheilinexy', ui.arena, false, [from, to], player, target);
                        };
                    };

                    //魔爪指示线
                    game.zsMozhuaLineXy = function(path, config, bool, player, target) {
                        var from = [path[0], path[1]];
                        var to = [path[2], path[3]];
                        if (game.chess) {
                            game.zsPlayLineAnimation('mozhualinexy', ui.chess, false, [from, to], player, target);
                        } else {
                            game.zsPlayLineAnimation('mozhualinexy', ui.arena, false, [from, to], player, target);
                        };
                    };

                    //剑锋指示线
                    game.zsJianfengLineXy = function(path, config, bool, player, target) {
                        var from = [path[0], path[1]];
                        var to = [path[2], path[3]];
                        if (game.chess) {
                            game.zsPlayLineAnimation('jianfenglinexy', ui.chess, false, [from, to], player, target);
                        } else {
                            game.zsPlayLineAnimation('jianfenglinexy', ui.arena, false, [from, to], player, target);
                        };
                    };

                    //金箭指示线
                    game.zsJinjianLineXy = function(path, config, bool, player, target) {
                        var from = [path[0], path[1]];
                        var to = [path[2], path[3]];
                        if (game.chess) {
                            game.zsPlayLineAnimation('jinjianlinexy', ui.chess, false, [from, to], player, target);
                        } else {
                            game.zsPlayLineAnimation('jinjianlinexy', ui.arena, false, [from, to], player, target);
                        };
                    };

                    //金龙指示线
                    game.zsJinlongLineXy = function(path, config, bool, player, target) {
                        var from = [path[0], path[1]];
                        var to = [path[2], path[3]];
                        if (game.chess) {
                            game.zsPlayLineAnimation('jinlonglinexy', ui.chess, false, [from, to], player, target);
                        } else {
                            game.zsPlayLineAnimation('jinlonglinexy', ui.arena, false, [from, to], player, target);
                        };
                    };

                    //落英指示线
                    game.zsLuoyingLineXy = function(path, config, bool, player, target) {
                        var from = [path[0], path[1]];
                        var to = [path[2], path[3]];
                        if (game.chess) {
                            game.zsPlayLineAnimation('luoyinglinexy', ui.chess, false, [from, to], player, target);
                        } else {
                            game.zsPlayLineAnimation('luoyinglinexy', ui.arena, false, [from, to], player, target);
                        };
                    };

                    //星蝶指示线
                    game.zsXingdieLineXy = function(path, config, bool, player, target) {
                        var from = [path[0], path[1]];
                        var to = [path[2], path[3]];
                        if (game.chess) {
                            game.zsPlayLineAnimation('xingdielinexy', ui.chess, false, [from, to], player, target);
                        } else {
                            game.zsPlayLineAnimation('xingdielinexy', ui.arena, false, [from, to], player, target);
                        };
                    };

                    //月仙指示线
                    game.zsYuexianLineXy = function(path, config, bool, player, target) {
                        var from = [path[0], path[1]];
                        var to = [path[2], path[3]];
                        if (game.chess) {
                            game.zsPlayLineAnimation('yuexianlinexy', ui.chess, false, [from, to], player, target);
                        } else {
                            game.zsPlayLineAnimation('yuexianlinexy', ui.arena, false, [from, to], player, target);
                        };
                    };

                    //蛇杖指示线
                    game.zsShezhangLineXy = function(path, config, bool, player, target) {
                        var from = [path[0], path[1]];
                        var to = [path[2], path[3]];
                        if (game.chess) {
                            game.zsPlayLineAnimation('shezhanglinexy', ui.chess, false, [from, to], player, target);
                        } else {
                            game.zsPlayLineAnimation('shezhanglinexy', ui.arena, false, [from, to], player, target);
                        };
                    };

                    if (lib.config.zuanzhishixian && lib.config.zuanzhishixian !== 'moren') {
                        game.saveConfig('extension_十周年UI_playerLineEffect', false);
                        if (window.decadeUI) decadeUI.config.playerLineEffect = false;
                        game.linexy = game['zs' + lib.config.zuanzhishixian + 'LineXy'];
                    }

                    game.saveConfig('zuanzhishixian', lib.config['extension_祖安设置_zhishixian']);
                    game.saveConfig('extension_十周年UI_playerLineEffect', lib.config['extension_祖安设置_zhishixian']);
                    if (window.decadeUI) decadeUI.config.playerLineEffect = lib.config['extension_祖安设置_zhishixian'];
                    if (lib.config['extension_祖安设置_zhishixian'] == 'moren') {
                        game.linexy = game.zsOriginLineXy;
                    } else {
                        game.linexy = game['zs' + lib.config['extension_祖安设置_zhishixian'] + 'LineXy'];
                    }
                }
                // ---------------------------------------指示线确认------------------------------------------//
                lib.skill._zuanattacklinecheck = {
                    trigger: {
                        global: ['gameDrawBefore'],
                        player: "enterGame",
                    },
                    direct: true,
                    priority: 105,
                    filter: function(event, player) {
                        if (!lib.config['extension_祖安设置_zhishixian'] || lib.config['extension_祖安设置_zhishixian'] == 'moren') return false;
                        if (['jingdian', 'yulong'].contains(lib.config['extension_祖安设置_zhishixian'])) return false;
                        return player == game.me;
                    },
                    content: function() {
                        game.saveConfig('zuanzhishixian', lib.config['extension_祖安设置_zhishixian']);
                        game.saveConfig('extension_十周年UI_playerLineEffect', lib.config['extension_祖安设置_zhishixian']);
                        if (window.decadeUI) decadeUI.config.playerLineEffect = lib.config['extension_祖安设置_zhishixian'];
                        if (lib.config['extension_祖安设置_zhishixian'] == 'moren') {
                            game.linexy = game.zsOriginLineXy;
                        } else {
                            game.linexy = game['zs' + lib.config['extension_祖安设置_zhishixian'] + 'LineXy'];
                        }
                    },
                }

            }
            // ---------------------------------------指示线------------------------------------------//
            // ---------------------------------------装备增强------------------------------------------//
            //if(parseFloat(lib.config['extension_祖安设置_ssb'])=='1') {
            //ssb
            /*lib.skill._strengthencardskill={
		        trigger:{
		            player:["enterGame","showCharacterAfter"],
		            global:["gameDrawBefore","gameDrawAfter"],
		        },
		        filter:function(event,player){//getitem
		            return game.getLocalItem('ZUANssbSET','equip')&&player==game.players[0];
		        },
		        priority:99900,
		        silent:true,
		        forced:true,
		        content:function(){
		            
		                "0":"还是算了",
		                "1":"全部增强",
		                "2":"仅换武器",
		                "3":"仅换防具",
		                "4":"仅换坐骑",
		                "5":"除了坐骑"
		            
		            lib.cardPackSsr=lib.zuanCard;
		            var chgrange=[];
		            if(game.getLocalItem('ZUANssbSET','equip1')) chgrange.push('equip1');
		            if(game.getLocalItem('ZUANssbSET','equip2')) chgrange.push('equip2');
		            if(game.getLocalItem('ZUANssbSET','equip4')) {
		                chgrange.push('equip3');
		                chgrange.push('equip4');
		            }
		            if(game.getLocalItem('ZUANssbSET','equip5')) chgrange.push('equip5');
		            //var chgrange=includeequip[parseFloat(lib.config['extension_祖安设置_ssb'])];
		            for(var i=0;i<lib.cardPackSsr.length;i++){
		                var sourcename=lib.cardPackSsr[i];
		                if(!chgrange.contains(lib.card[sourcename].subtype)) continue;
		                var cardname=sourcename.slice(3);
		                //alert(cardname);
		                //alert(sourcename);
		                lib.card[cardname]['skills']=[sourcename+'_skill'];
		                lib.card[cardname]['onEquip']=lib.card[sourcename]['onEquip'];
		                lib.card[cardname]['onLose']=lib.card[sourcename]['onLose'];
		                if(lib.card[sourcename]['distance']) lib.card[cardname]['distance']=lib.card[sourcename]['distance'];
		                lib.translate[cardname+'_info']=lib.translate[sourcename+'_skill_info'];
		            }
		        },
		    }*/
            //}
            // ---------------------------------------标包增强------------------------------------------//
            //bbzq
            /*
			    "none":"还是算了",
			    "next_standard_skill":"◈标包———",
			    "standard_skill":"技能替换",
			    "standard_code":"代码渗透",
			    "next_all_skill":"◈全部———",
			    "all_skill":"技能替换",
			    "all_code":"代码渗透"
			*/
            if (!lib.config['extension_祖安设置_ssr']) {
                lib.config['extension_祖安设置_ssr'] = "none";
                game.saveConfig('extension_祖安设置_ssr', "none");
            }
            if (lib.config['extension_祖安设置_ssr'] != 'none') {
                if (lib.config['extension_祖安设置_ssr'].indexOf('standard') != -1) {
                    lib.config.ssr_change_strengthen = true;
                } else {
                    lib.config.ssr_change_strengthen = false;
                }
                if (lib.config['extension_祖安设置_ssr'].indexOf('code') != -1) {
                    var zuannpc = lib.zuanPack;
                    var chgstandard = lib.config['extension_祖安设置_ssr'].indexOf('standard') != -1;
                    //alert(lib.character['ssr_caocao']);
                    var chg = function(name, head) {
                        if (lib.character[head + name]) {
                            var chgall = lib.config['extension_祖安设置_ssr'].indexOf('all') != -1;
                            if (chgall || lib.characterPack["standard"][head + name]) {
                                var msg = lib.character[head + name];
                                var ssr = lib.character['ssr_' + name];
                                lib.character[head + name][2] = ssr[2];
                                lib.character[head + name][3] = ssr[3];
                            }
                        }
                    }
                    for (var n in zuannpc) {
                        var npc = zuannpc[n];
                        var name = n.slice(4);
                        chg(name, '');
                        chg(name, 're_');
                        chg(name, 'ol_');
                        chg(name, 'old_');
                        chg(name, 'yj_');
                        chg(name, 'tw_');
                        chg(name, 'sp_');
                        chg(name, 'jsp_');
                        chg(name, 'xin_');
                        chg(name, 'xf_');
                    }
                    //孙笨
                    if (lib.character['re_sunben']) {
                        var chgall = lib.config['extension_祖安设置_ssr'].indexOf('all') != -1;
                        if (chgall || lib.characterPack["standard"]['re_sunben']) {
                            var msg = lib.character['re_sunben'];
                            var ssr = lib.character['ssr_' + 'sunce'];
                            lib.character['re_sunben'][2] = ssr[2];
                            lib.character['re_sunben'][3] = ssr[3];
                        }
                    }
                    //lib.character()
                } else {
                    lib.skill._strengthenstandardskill = {
                        trigger: {
                            player: ["enterGame", "showCharacterAfter"],
                            global: ["gameDrawBefore", "gameDrawAfter"],
                        },
                        filter: function(event, player) {
                            //if(player==game.me) alert(event.name);
                            var forbidlist = [7];
                            var mode = parseFloat(lib.config['extension_祖安设置_mode']);
                            if (forbidlist.contains(mode)) return false;
                            if (player.group == 'devil' || player.group == 'shen' || player.group == 'jin' || player.name.indexOf('sb_') != -1) return false;
                            var chgstandard = lib.config['extension_祖安设置_ssr'].indexOf('standard') != -1;
                            if (!player.name) return false;
                            if (chgstandard && !lib.characterPack["standard"][player.name]) return false;
                            if (event.name == 'showCharacter') {
                                return event.toShow.contains(player.name1) || event.toShow.contains(player.name2);
                            } else {
                                return player.name.indexOf('unknown') == -1 || player.name == player.name1;
                            }
                        },
                        priority: 10000,
                        silent: true,
                        forced: true,
                        content: function() {
                            'step 0';
                            lib.characterPackSsr = {
                                "mode_extension_祖安武将": lib.zuanPack
                            }
                            if (player.name.indexOf('unknown') == -1 || player.name == player.name1) {
                                event.hisname = "name";
                            } else {
                                event.hisname = "name1";
                            }
                            if (trigger.name == 'showCharacter') {
                                event.showc = true;
                                //trigger.num - 0是明置主将，1是副将，2是全部
                                event.num = trigger.num;
                            } else {
                                event.showc = false;
                                event.num = 1;
                            }
                            'step 1';
                            var mode = get.mode();
                            event.changehp = false;
                            event.namelist = ['fazheng', 'xin_fazheng', 'yuanshu', 're_yuanshu', 'yiji', 'xf_yiji', 'yuanshao', 're_yuanshao', 'yuji', 're_yuji', 'lusu', 're_lusu', 'zhangliang', 're_zhangliang', 'xuhuang', 're_xuhuang', 'xiahouyuan', 're_xiahouyuan', 'xushu', 're_xushu'];
                            //alert(player.name);
                            event.myname1 = player[event.hisname];
                            if (player.name2) {
                                event.myname2 = player.name2;
                            } else {
                                event.myname2 = 'none';
                            }
                            event.sklists = [];
                            var oldlist = lib.character[event.myname1][3];
                            if (event.myname2 != 'none') {
                                oldlist = oldlist.concat(lib.character[event.myname2][3]);
                            }
                            var sklist = player.skills;
                            for (var i = 0; i < sklist.length; i++) {
                                if (!oldlist.contains(sklist[i])) {
                                    event.sklists.push(sklist[i]);
                                }
                            }
                            event.changehpnum = 0;
                            var str = '' + lib.character[event.myname1][2];
                            var index = str.indexOf('/');
                            var myhp = str.substr(index + 1, str.length);
                            if (player.maxHp > myhp) {
                                event.changehpnum = player.maxHp - myhp;
                            }
                            if ((mode == 'identity' || mode == 'doudizhu') && event.myname2 != 'none') {
                                if (player.identity == 'zhu') {
                                    event.changehpnum = 1;
                                } else {
                                    event.changehpnum = 0;
                                }
                            }
                            event.ctrlmaxhp = 0;
                            event.ctrlhp = 0;
                            event.ctrlhd = 0;
                            if (event.hisname == 'name' && event.myname2 != 'none') {
                                var str = '' + lib.character[event.myname1][2];
                                var index = str.indexOf('/');
                                var myhp1 = parseInt(str.substr(0, index));
                                var mymaxhp1 = parseInt(str.substr(index + 1, str.length));
                                if (index == -1) myhp1 = mymaxhp1;

                                var str = '' + lib.character[event.myname2][2];
                                var index = str.indexOf('/');
                                var myhp2 = parseInt(str.substr(0, index));
                                var mymaxhp2 = parseInt(str.substr(index + 1, str.length));
                                if (index == -1) myhp2 = mymaxhp2;
                                //if(player==game.me) alert(myhp1+'|'+myhp2+'|'+mymaxhp1+'|'+mymaxhp2);
                                //var num=lib.character[event.myname1][2]+lib.character[event.myname2][2];
                                event.ctrlhp = Math.floor((myhp1 + myhp2) * 0.5);
                                event.ctrlmaxhp = Math.floor((mymaxhp1 + mymaxhp2) * 0.5);
                                event.ctrlhd = (myhp1 + myhp2) % 2;
                                //if(player==game.me) alert(event.ctrlhp+'|'+event.ctrlmaxhp+'|'+event.ctrlhd);
                            }
                            'step 2';
                            if (!lib.config.ssr_change_strengthen) {
                                for (var i = 0; i * 2 < event.namelist.length; i++) {
                                    //alert(i+' | '+player[event.hisname]+'=='+namelist[i*2+1] +' | '+namelist[i*2]);
                                    if (event.myname1 == event.namelist[i * 2 + 1]) {
                                        event.myname1 = event.namelist[i * 2];
                                        break;
                                    }
                                }
                                if (event.myname2 != 'none') {
                                    for (var i = 0; i * 2 < event.namelist.length; i++) {
                                        if (event.myname2 == event.namelist[i * 2 + 1]) {
                                            event.myname2 = event.namelist[i * 2];
                                            break;
                                        }
                                    }
                                }
                            } else {
                                if (event.myname1 == 're_sunben') event.myname1 = 're_sunce';
                                if (event.myname2 == 're_sunben') event.myname2 = 're_sunce';
                            }
                            if ((trigger.num % 2 == 0 || !event.showc) && (event.myname1.indexOf('ssr_') != -1)) {
                                var inited = false;
                                for (p = 0; p * 2 < event.namelist.length; p++) {
                                    if (event.myname1 == 'ssr_' + event.namelist[p * 2]) {
                                        if (event.myname2 != 'none') {
                                            player.init(event.namelist[p * 2 + 1]);
                                        } else {
                                            player.init(event.namelist[p * 2 + 1], event.myname2);
                                        }
                                        event.changehp = true;
                                        inited = true;
                                        break;
                                    }
                                }
                                if (!inited) {
                                    if (event.myname2 != 'none') {
                                        player.init(event.myname1.slice(4));
                                    } else {
                                        player.init(event.myname1.slice(4), event.myname2);
                                    }
                                    //player.init(event.myname1.slice(4));
                                    event.changehp = true;
                                }
                                //if((mode=='identity'||mode=='doudizhu')&&player.identity=='zhu') {
                                //    event.changehp=true;
                                //}
                            }
                            if ((trigger.num >= 1 || !event.showc) && (event.myname2 != 'none' && event.myname2.indexOf('ssr_') != -1)) {
                                var inited = false;
                                for (p = 0; p * 2 < event.namelist.length; p++) {
                                    if (event.myname2 == 'ssr_' + event.namelist[p]) {
                                        player.init(player[event.hisname], event.namelist[p + 1]);
                                        event.changehp = true;
                                        inited = true;
                                        break;
                                    }
                                }
                                if (!inited) {
                                    player.init(player[event.hisname], player.name2.slice(4));
                                    event.changehp = true;
                                }
                                //if((mode=='identity'||mode=='doudizhu')&&player.identity=='zhu') {
                                //    event.changehp=true;
                                //}
                            }
                            'step 3';
                            event.skill = 'none';
                            if (event.changehp) {
                                if (event.ctrlmaxhp > 0) {
                                    player.maxHp = event.ctrlmaxhp;
                                }
                                if (event.ctrlhp > 0) {
                                    player.hp = event.ctrlhp;
                                }
                                if (event.changehpnum > 0) {
                                    player.maxHp += event.changehpnum;
                                    player.hp += event.changehpnum;
                                }
                                //if(event.ctrlhd>0) player.directgain(get.cards(1));
                            }
                            //alert(event.changehp);
                            //if(player[event.hisname]=='re_sunben') event.myname1='re_sunce';
                            //if(player.name2=='re_sunben') event.myname2='re_sunce';
                            var name = event.myname1;
                            var index = name.lastIndexOf('_');
                            var rname1 = name.substr(index + 1, name.length);
                            var name = event.myname2;
                            var index = name.lastIndexOf('_');
                            var rname2 = name.substr(index + 1, name.length);
                            for (var a in lib.characterPackSsr) {
                                //  if(lib.filter.characterDisabled2(i)||lib.filter.characterDisabled(i)) continue;
                                for (var b in lib.characterPackSsr[a]) {
                                    var role = lib.characterPackSsr[a][b];
                                    if (lib.config.ssr_change_strengthen) {
                                        //if((trigger.num%2==0||!event.showc)&&event.myname1.indexOf(b.slice(4))!=-1&&(!(player[event.hisname].indexOf('yujin')!=-1&&b=='ssr_yuji'))&&(!(player[event.hisname].indexOf('zhangheng')!=-1&&b=='ssr_zhanghe'))) {
                                        if ((trigger.num % 2 == 0 || !event.showc) && rname1 == b.slice(4)) {
                                            //player.clearSkills();
                                            //lib.character[game.me.name]
                                            var lists = lib.character[player[event.hisname]][3];
                                            for (var i = 0; i < lists.length; i++) {
                                                if (player.hasSkill(lists[i])) {
                                                    player.removeSkill(lists[i]);
                                                }
                                            }
                                            player.addSkill(role[3].slice(0));
                                        }
                                        //if((trigger.num>=1||!event.showc)&&event.myname2.indexOf(b.slice(4))!=-1&&(!(player.name2.indexOf('yujin')!=-1&&b=='ssr_yuji'))&&(!(player.name2.indexOf('zhangheng')!=-1&&b=='ssr_zhanghe'))) {
                                        if ((trigger.num >= 1 || !event.showc) && rname2 == b.slice(4)) {
                                            var lists = lib.character[player.name2][3];
                                            for (var i = 0; i < lists.length; i++) {
                                                if (player.hasSkill(lists[i])) {
                                                    player.removeSkill(lists[i]);
                                                }
                                            }
                                            player.addSkill(role[3].slice(0));
                                        }
                                        player.update();
                                    } else {
                                        if ((trigger.num % 2 == 0 || !event.showc) && b == 'ssr_' + event.myname1) {
                                            //player.clearSkills();
                                            var lists = lib.character[player[event.hisname]][3];
                                            for (var i = 0; i < lists.length; i++) {
                                                if (player.hasSkill(lists[i])) {
                                                    player.removeSkill(lists[i]);
                                                }
                                            }
                                            player.addSkill(role[3].slice(0));
                                        }
                                    }
                                    if ((trigger.num >= 1 || !event.showc) && b == 'ssr_' + event.myname2) {
                                        var lists = lib.character[player.name2][3];
                                        for (var i = 0; i < lists.length; i++) {
                                            if (player.hasSkill(lists[i])) {
                                                player.removeSkill(lists[i]);
                                            }
                                        }
                                        player.addSkill(role[3].slice(0));
                                    }
                                    player.update();
                                }
                            }
                            'step 4';
                            for (var i = 0; i < event.sklists.length; i++) {
                                player.addSkill(event.sklists[i]);
                            }
                        },
                    }
                    lib.skill._ssrnohuahensskill = {
                        trigger: {
                            player: ['huashen2Before'],
                        },
                        filter: function(event, player) {
                            return (player.group != 'devil' && player.group != 'shen' && player.group != 'jin');
                        },
                        priority: 100,
                        silent: true,
                        forced: true,
                        content: function() {
                            trigger.cancel();
                        },
                    }
                    lib.skill._ssrchangehpskill = {
                        trigger: {
                            player: ["enterGame"],
                            global: ["gameDrawAfter"],
                        },
                        priority: 9000,
                        silent: true,
                        forced: true,
                        content: function() {
                            var lose = 0;
                            var hcard = player.countCards('h');
                            if (player.name.indexOf('unknown') == -1 || player.name == player.name1) {
                                event.hisname = "name";
                            } else {
                                event.hisname = "name1";
                            }
                            if (lib.config.ssr_change_strengthen) {
                                if (player[event.hisname].indexOf('huaxiong') != -1) {
                                    lose += 2;
                                }
                                /*if(player[event.hisname].indexOf('lvmeng')!=-1) {
				                    lose+=1;
				                }*/
                                if (player[event.hisname].indexOf('zhurong') != -1) {
                                    lose += 1;
                                }
                                if (player[event.hisname].indexOf('zhangliang') != -1) {
                                    lose += 1;
                                }
                                if (player.name2) {
                                    if (player.name2.indexOf('huaxiong') != -1) {
                                        lose += 2;
                                    }
                                    /*if(player.name2.indexOf('lvmeng')!=-1) {
					                    lose+=1;
					                }*/
                                    if (player.name2.indexOf('zhurong') != -1) {
                                        lose += 1;
                                    }
                                    if (player.name2.indexOf('zhangliang') != -1) {
                                        lose += 1;
                                    }
                                }
                                //体力补偿
                                if (player[event.hisname] == 're_lidian') {
                                    lose -= 1;
                                }
                                if (player.name2 == 're_lidian') {
                                    lose -= 1;
                                }
                                if (player[event.hisname] == 'old_re_lidian') {
                                    lose -= 1;
                                }
                                if (player.name2 == 'old_re_lidian') {
                                    lose -= 1;
                                }
                                if (player[event.hisname] == 'sp_dongzhuo') {
                                    lose -= 3;
                                }
                                if (player.name2 == 'sp_dongzhuo') {
                                    lose -= 3;
                                }
                                if (player[event.hisname] == 'jsp_zhaoyun') {
                                    lose -= 1;
                                }
                                if (player.name2 == 'jsp_zhaoyun') {
                                    lose -= 1;
                                }
                                if (player[event.hisname] == 'sp_zhaoyun') {
                                    lose -= 1;
                                }
                                if (player.name2 == 'sp_zhaoyun') {
                                    lose -= 1;
                                }
                                if (player[event.hisname] == 'sp_lvmeng') {
                                    lose -= 1;
                                }
                                if (player.name2 == 'sp_lvmeng') {
                                    lose -= 1;
                                }
                                if (player[event.hisname] == 'gz_sp_dongzhuo') {
                                    lose -= 4;
                                }
                                if (player.name2 == 'gz_sp_dongzhuo') {
                                    lose -= 4;
                                }
                                if (player[event.hisname] == 'xushu') {
                                    lose -= 1;
                                }
                                if (player.name2 == 'xushu') {
                                    lose -= 1;
                                }
                                if (player[event.hisname] == 'xin_xushu') {
                                    lose -= 1;
                                }
                                if (player.name2 == 'xin_xushu') {
                                    lose -= 1;
                                }
                                if (player[event.hisname] == 're_lvbu') {
                                    lose += 1;
                                }
                                if (player.name2 == 're_lvbu') {
                                    lose += 1;
                                }
                            } else {
                                if (player[event.hisname] == 'huaxiong') {
                                    lose += 2;
                                }
                                /*if(player[event.hisname]=='lvmeng') {
				                    lose+=1;
				                }*/
                                if (player[event.hisname] == 'zhurong') {
                                    lose += 1;
                                }
                                if (player[event.hisname] == 're_zhangliang') {
                                    lose += 1;
                                }
                                if (player.name2) {
                                    if (player.name2 == 'huaxiong') {
                                        lose += 2;
                                    }
                                    /*if(player.name2=='lvmeng') {
					                    lose+=1;
					                }*/
                                    if (player.name2 == 're_zhangliang') {
                                        lose += 1;
                                    }
                                }
                            }
                            //if(player==game.me) alert(lose);
                            if (lose > 0) {
                                if (player.name2) {
                                    if (lose % 2 > 0) {
                                        /*player.discard(player.getCards('h'));
					                    player.draw(5);
					                    var hs=player.getCards('h');
					                    game.addVideo('lose',player,[get.cardsInfo(hs),[],[],[]]);
					                    for(var i=0;i<hs.length;i++){
					                        hs[i].discard(false);
					                    }
					                    player.directgain(get.cards(5));*/
                                        player.directgain(get.cards(1));
                                    }
                                    dis = Math.ceil(lose / 2);
                                } else {
                                    dis = lose;
                                }
                                if (dis > 0) {
                                    player.maxHp -= dis;
                                    player.hp -= dis;
                                }
                            } else if (lose < 0) {
                                lose = 0 - lose;
                                if (player.name2) {
                                    if (lose % 2 > 0 && false) {
                                        /*player.discard(player.getCards('h'));
					                    player.draw(5);
					                    var hs=player.getCards('h');
					                    game.addVideo('lose',player,[get.cardsInfo(hs),[],[],[]]);
					                    for(var i=0;i<hs.length;i++){
					                        hs[i].discard(false);
					                    }
					                    player.directgain(get.cards(5));*/
                                        player.directgain(get.cards(1));
                                    }
                                    dis = Math.floor(lose / 2);
                                } else {
                                    dis = lose;
                                }
                                if (dis > 0) {
                                    player.maxHp += dis;
                                    player.hp += dis;
                                }
                            }
                            player.update();
                        },
                    }
                }
            }

            // ---------------------------------------自定义工具------------------------------------------//
            //换将dialog框//搬运自手杀MPV，感谢原作者
            lib['AI选将'] = {
                // 根据模式走不同的方法
                chooseCharacter: function(target) {
                    var mode = lib.config.mode;
                    if (mode === 'identity' || mode === 'doudizhu') return lib['AI选将'].chooseCharacterShenFen.call(target);
                    else if (mode === 'guozhan') return lib['AI选将'].chooseCharacterGuoZhan.call(target);
                },
                // 身份模式
                chooseCharacterShenFen: function() {
                    var next = game.createEvent('chooseCharacter', false);
                    next.target = this;
                    next.player = game.me;
                    next.filter = function(name) {
                        return true;
                    };
                    next.showConfig = true;
                    next.addPlayer = function(player) {
                        var list = lib.config.mode_config.identity.identity[game.players.length - 3].slice(0);
                        var list2 = lib.config.mode_config.identity.identity[game.players.length - 2].slice(0);
                        for (var i = 0; i < list.length; i++) list2.remove(list[i]);
                        player.identity = list2[0];
                        player.setIdentity('cai');
                    };
                    next.removePlayer = function() {
                        return game.players.randomGet(target, game.zhu);
                    };
                    next.setContent(function() {
                        "step 0";
                        ui.arena.classList.add('choose-character');
                        var i;
                        var list;
                        var list2 = [];
                        var list3 = [];
                        var list4 = [];
                        var identityList;
                        var chosen = lib.config.continue_name || [];
                        game.saveConfig('continue_name');
                        event.chosen = chosen;
                        if (_status.mode === 'zhong') {
                            event.zhongmode = true;
                            identityList = ['zhu', 'zhong', 'mingzhong', 'nei', 'fan', 'fan', 'fan', 'fan'];
                        } else {
                            identityList = lib.config.mode_config.identity.identity[game.players.length - 2].slice(0);
                            if (get.config('double_nei')) {
                                switch (get.playerNumber()) {
                                case 8:
                                    identityList.remove('fan');
                                    identityList.push('nei');
                                    break;
                                case 7:
                                    identityList.remove('zhong');
                                    identityList.push('nei');
                                    break;
                                case 6:
                                    identityList.remove('fan');
                                    identityList.push('nei');
                                    break;
                                case 5:
                                    identityList.remove('fan');
                                    identityList.push('nei');
                                    break;
                                case 4:
                                    identityList.remove('zhong');
                                    identityList.push('nei');
                                    break;
                                case 3:
                                    identityList.remove('fan');
                                    identityList.push('nei');
                                    break;
                                }
                            }
                        }
                        var addSetting = function(dialog) {
                            dialog.add('选择身份').classList.add('add-setting');
                            var table = document.createElement('div');
                            table.classList.add('add-setting');
                            table.style.margin = '0';
                            table.style.width = '100%';
                            table.style.position = 'relative';
                            var listi;
                            if (event.zhongmode) {
                                listi = ['random', 'zhu', 'mingzhong', 'zhong', 'nei', 'fan'];
                            } else {
                                listi = ['random', 'zhu', 'zhong', 'nei', 'fan'];
                            }
                            for (var i = 0; i < listi.length; i++) {
                                var td = ui.create.div('.shadowed.reduce_radius.pointerdiv.tdnode');
                                td.link = listi[i];
                                if (td.link === target.identity) {
                                    td.classList.add('bluebg');
                                }
                                table.appendChild(td);
                                td.innerHTML = '<span>' + get.translation(listi[i] + '2') + '</span>';
                                td.addEventListener(lib.config.touchscreen ? 'touchend': 'click',
                                function() {
                                    if (_status.dragged) return;
                                    if (_status.justdragged) return;
                                    _status.tempNoButton = true;
                                    setTimeout(function() {
                                        _status.tempNoButton = false;
                                    },
                                    500);
                                    var link = this.link;
                                    if (game.zhu.name) {
                                        if (link != 'random') {
                                            _status.event.parent.fixedseat = get.distance(target, game.zhu, 'absolute');
                                        }
                                        game.zhu.uninit();
                                        delete game.zhu.isZhu;
                                        delete game.zhu.identityShown;
                                    }
                                    var current = this.parentNode.querySelector('.bluebg');
                                    if (current) {
                                        current.classList.remove('bluebg');
                                    }
                                    current = seats.querySelector('.bluebg');
                                    if (current) {
                                        current.classList.remove('bluebg');
                                    }
                                    if (link == 'random') {
                                        if (event.zhongmode) {
                                            link = ['zhu', 'zhong', 'nei', 'fan', 'mingzhong'].randomGet();
                                        } else {
                                            link = ['zhu', 'zhong', 'nei', 'fan'].randomGet();
                                        }
                                        for (var i = 0; i < this.parentNode.childElementCount; i++) {
                                            if (this.parentNode.childNodes[i].link == link) {
                                                this.parentNode.childNodes[i].classList.add('bluebg');
                                            }
                                        }
                                    } else {
                                        this.classList.add('bluebg');
                                    }
                                    num = get.config('choice_' + link);
                                    if (event.zhongmode) {
                                        num = 6;
                                        if (link == 'zhu' || link == 'nei' || link == 'mingzhong') {
                                            num = 8;
                                        }
                                    }
                                    _status.event.parent.swapnodialog = function(dialog, list) {
                                        var buttons = ui.create.div('.buttons');
                                        var node = dialog.buttons[0].parentNode;
                                        dialog.buttons = ui.create.buttons(list, 'characterx', buttons);
                                        dialog.content.insertBefore(buttons, node);
                                        buttons.animate('start');
                                        node.remove();
                                        game.uncheck();
                                        game.check();
                                        for (var i = 0; i < seats.childElementCount; i++) {
                                            if (get.distance(game.zhu, target, 'absolute') === seats.childNodes[i].link) {
                                                seats.childNodes[i].classList.add('bluebg');
                                            }
                                        }
                                    }
                                    _status.event = _status.event.parent;
                                    _status.event.step = 0;
                                    _status.event.identity = link;
                                    if (link != (event.zhongmode ? 'mingzhong': 'zhu')) {
                                        seats.previousSibling.style.display = '';
                                        seats.style.display = '';
                                    } else {
                                        seats.previousSibling.style.display = 'none';
                                        seats.style.display = 'none';
                                    }
                                    game.resume();
                                });
                            }
                            dialog.content.appendChild(table);
                            dialog.add('选择座位').classList.add('add-setting');
                            var seats = document.createElement('div');
                            seats.classList.add('add-setting');
                            seats.style.margin = '0';
                            seats.style.width = '100%';
                            seats.style.position = 'relative';
                            for (var i = 2; i <= game.players.length; i++) {
                                var td = ui.create.div('.shadowed.reduce_radius.pointerdiv.tdnode');
                                td.innerHTML = get.cnNumber(i, true);
                                td.link = i - 1;
                                seats.appendChild(td);
                                if (get.distance(game.zhu, target, 'absolute') === i - 1) {
                                    td.classList.add('bluebg');
                                }
                                td.addEventListener(lib.config.touchscreen ? 'touchend': 'click',
                                function() {
                                    if (_status.dragged) return;
                                    if (_status.justdragged) return;
                                    if (get.distance(game.zhu, target, 'absolute') == this.link) return;
                                    var current = this.parentNode.querySelector('.bluebg');
                                    if (current) {
                                        current.classList.remove('bluebg');
                                    }
                                    this.classList.add('bluebg');
                                    for (var i = 0; i < game.players.length; i++) {
                                        if (get.distance(game.players[i], target, 'absolute') == this.link) {
                                            game.swapSeat(game.zhu, game.players[i], false);
                                            return;
                                        }
                                    }
                                });
                            }
                            dialog.content.appendChild(seats);
                            if (target == game.zhu) {
                                seats.previousSibling.style.display = 'none';
                                seats.style.display = 'none';
                            }

                            dialog.add(ui.create.div('.placeholder.add-setting'));
                            dialog.add(ui.create.div('.placeholder.add-setting'));
                            if (get.is.phoneLayout()) dialog.add(ui.create.div('.placeholder.add-setting'));
                        };
                        var removeSetting = function() {
                            var dialog = _status.event.dialog;
                            if (dialog) {
                                dialog.style.height = '';
                                delete dialog._scrollset;
                                var list = Array.from(dialog.querySelectorAll('.add-setting'));
                                while (list.length) {
                                    list.shift().remove();
                                }
                                ui.update();
                            }
                        };
                        event.list = [];
                        identityList.randomSort();
                        if (event.identity) {
                            identityList.remove(event.identity);
                            identityList.unshift(event.identity);
                            if (event.fixedseat) {
                                var zhuIdentity = (_status.mode == 'zhong') ? 'mingzhong': 'zhu';
                                if (zhuIdentity != event.identity) {
                                    identityList.remove(zhuIdentity);
                                    identityList.splice(event.fixedseat, 0, zhuIdentity);
                                }
                                delete event.fixedseat;
                            }
                            delete event.identity;
                        } else if (_status.mode != 'zhong' && (!_status.brawl || !_status.brawl.identityShown)) {
                            var ban_identity = [];
                            ban_identity.push(get.config('ban_identity') || 'off');
                            if (ban_identity[0] != 'off') {
                                ban_identity.push(get.config('ban_identity2') || 'off');
                                if (ban_identity[1] != 'off') {
                                    ban_identity.push(get.config('ban_identity3') || 'off');
                                }
                            }
                            ban_identity.remove('off');
                            if (ban_identity.length) {
                                var identityList2 = identityList.slice(0);
                                for (var i = 0; i < ban_identity.length; i++) {
                                    while (identityList2.remove(ban_identity[i]));
                                }
                                ban_identity = identityList2.randomGet();
                                identityList.remove(ban_identity);
                                identityList.splice(game.players.indexOf(target), 0, ban_identity);
                            }
                        }
                        if (get.config('special_identity') && !event.zhongmode && game.players.length == 8) {
                            for (var i = 0; i < game.players.length; i++) {
                                delete game.players[i].special_identity;
                            }
                            event.special_identity = [];
                            var zhongs = game.filterPlayer(function(current) {
                                return current.identity == 'zhong';
                            });
                            var fans = game.filterPlayer(function(current) {
                                return current.identity == 'fan';
                            });
                            if (fans.length >= 1) {
                                fans.randomRemove().special_identity = 'identity_zeishou';
                                event.special_identity.push('identity_zeishou');
                            }
                            if (zhongs.length > 1) {
                                zhongs.randomRemove().special_identity = 'identity_dajiang';
                                zhongs.randomRemove().special_identity = 'identity_junshi';
                                event.special_identity.push('identity_dajiang');
                                event.special_identity.push('identity_junshi');
                            } else if (zhongs.length == 1) {
                                if (Math.random() < 0.5) {
                                    zhongs.randomRemove().special_identity = 'identity_dajiang';
                                    event.special_identity.push('identity_dajiang');
                                } else {
                                    zhongs.randomRemove().special_identity = 'identity_junshi';
                                    event.special_identity.push('identity_junshi');
                                }
                            }
                        }
                        if (!game.zhu) game.zhu = target;
                        else {
                            game.zhu.setIdentity();
                            game.zhu.identityShown = true;
                            game.zhu.isZhu = (game.zhu.identity == 'zhu');
                            game.zhu.node.identity.classList.remove('guessing');
                        }
                        //选将框分配
                        for (i in lib.characterReplace) {
                            var ix = lib.characterReplace[i];
                            for (var j = 0; j < ix.length; j++) {
                                if (chosen.contains(ix[j]) || lib.filter.characterDisabled(ix[j])) ix.splice(j--, 1);
                            }
                            if (ix.length) {
                                event.list.push(i);
                                list4.addArray(ix);
                                var bool = false;
                                for (var j of ix) {
                                    if (lib.character[j][4] && lib.character[j][4].contains('zhu')) {
                                        bool = true;
                                        break;
                                    }
                                } (bool ? list2: list3).push(i);
                            }
                        }
                        for (i in lib.character) {
                            if (list4.contains(i)) continue;
                            if (chosen.contains(i)) continue;
                            if (lib.filter.characterDisabled(i)) continue;

                            if (typeof event.filter === 'function' && event.filter(i) === false) continue;

                            event.list.push(i);
                            list4.push(i);
                            if (lib.character[i][4] && lib.character[i][4].contains('zhu')) {
                                list2.push(i);
                            } else {
                                list3.push(i);
                            }
                        }
                        list2.sort(lib.sort.character);
                        event.list.randomSort();
                        _status.characterlist = list4.slice(0).randomSort();
                        list3.randomSort();
                        if (_status.brawl && _status.brawl.chooseCharacterFilter) {
                            _status.brawl.chooseCharacterFilter(event.list, list2, list3);
                        }
                        var num = get.config('choice_' + target.identity);
                        if (event.zhongmode) {
                            num = 6;
                            if (target.identity == 'zhu' || target.identity == 'nei' || target.identity == 'mingzhong') {
                                num = 8;
                            }
                        }
                        if (target === game.zhu && lib.config.mode !== "doudizhu") {
                            list = list2.concat(list3.slice(0, num));
                        } else {
                            list = list3.slice(0, 8);
                        }
                        // }
                        delete event.swapnochoose;
                        var dialog;
                        if (event.swapnodialog) {
                            dialog = ui.dialog;
                            event.swapnodialog(dialog, list);
                            delete event.swapnodialog;
                        } else {
                            var str = '选择角色';
                            if (_status.brawl && _status.brawl.chooseCharacterStr) {
                                str = _status.brawl.chooseCharacterStr;
                            }
                            dialog = ui.create.dialog(str, 'hidden', [list, 'characterx']);
                            /*if(!_status.brawl||!_status.brawl.noAddSetting){
		                        if(get.config('change_identity')){
		                            addSetting(dialog);
		                        }
		                    }*/
                        }

                        var createSearchInput = function(dialog) {
                            var div = ui.create.div(dialog.content, 1, {
                                display: 'block',
                            });
                            var input = ui.create.node('input', div);
                            var select = ui.create.node('select', div);
                            var options = [{
                                text: '武将id',
                                value: 'id',
                                defaultSelected: false,
                            },
                            {
                                text: '武将名称',
                                value: 'name',
                                defaultSelected: true,
                            }];
                            options.forEach(value =>{
                                var option = new Option(value.text, value.value, value.defaultSelected);
                                option.selected = value.defaultSelected;
                                select.appendChild(option);
                            });
                            select.onchange = function() {
                                input.placeholder = this.value === 'id' ? '按武将ID搜索': '按武将名称搜索';
                            }
                            input.placeholder = '按武将名称搜索';
                            var toggleButtons = function() {
                                var mode = select.value;
                                var inputValue = this.value;
                                var buttons = Array.from(dialog.querySelectorAll('.button'));
                                buttons.forEach(value =>{
                                    var link = value.link;
                                    var buttonName = link;
                                    if (mode === 'name') buttonName = get.translation(link);
                                    if (this.value === '') return value.classList.remove('nodisplay');
                                    value.classList.toggle('nodisplay', buttonName.indexOf(inputValue) === -1);
                                });
                                return true;
                            }
                            input.onkeydown = function(event) {
                                event && event.stopPropagation();
                                if (event.keyCode === 13) this.oninput(event);
                            };
                            input.oninput = event =>toggleButtons.call(input) && event.stopPropagation();
                            dialog.searchInput = input;
                            dialog.select = select;
                        }

                        createSearchInput(dialog);

                        dialog.searchInput.disabled = true;
                        dialog.searchInput.placeholder = '点击【自由选将】搜索';
                        dialog.select.disabled = true;

                        if (target.special_identity) {
                            dialog.setCaption('选择角色（' + get.translation(target.special_identity) + '）');
                            target.node.identity.firstChild.innerHTML = get.translation(target.special_identity + '_bg');
                        } else {
                            dialog.setCaption('选择角色');
                            //target.setIdentity();
                        }
                        if (lib.onfree) {
                            lib.onfree.push(function() {
                                event.dialogxx = ui.create.characterDialog('heightset', target);
                            });
                        } else {
                            event.dialogxx = ui.create.characterDialog('heightset', target);
                        }

                        var charactersKey = Object.keys(lib.character).removeArray(event.dialogxx.buttons.map(value =>value.link)).filter(value =>{
                            var character = lib.character[value];
                            if (!character || !character[4]) return false;
                            return ! character[4].contains('unseen')
                        });
                        if (!event.chosen.length) {
                            game.me.chooseButton(event.dialogxx, true).set('onfree', true).selectButton = function() {
                                if ((_status.brawl && _status.brawl.doubleCharacter) || (target == game.zhu && _status.mode == 'online')) return 2;
                                return get.config('double_character') ? 2 : 1
                            };
                        } else {
                            lib.init.onfree();
                        }

                        var buttons1 = ui.create.buttons(charactersKey, 'character', event.dialogxx.querySelector(".buttons"));
                        event.dialogxx.buttons = event.dialogxx.buttons.concat(buttons1);
                        const getCapt = function(str) {
                            var capt;
                            if (str.indexOf('_') == -1) {
                                capt = str[0];
                            } else {
                                capt = str[str.lastIndexOf('_') + 1];
                            }
                            capt = capt.toLowerCase();
                            if (!/[a-z]/i.test(capt)) {
                                capt = '自定义';
                            }
                            return capt;
                        }
                        buttons1.forEach(item =>{
                            item.group = lib.character[item.link][1];
                            item.capt = getCapt(item.link);
                            item.classList.add('nodisplay')
                        })

                        "step 1";
                        if (_status.mode == 'online') event.cardPile = target.storage.doudizhu_cardPile;
                        if (ui.cheat) {
                            ui.cheat.close();
                            delete ui.cheat;
                        }
                        if (ui.cheat2) {
                            ui.cheat2.close();
                            delete ui.cheat2;
                        }
                        var chooseGroup = false;
                        if (event.chosen.length) {
                            if ((lib.character[event.chosen[0]][1] == 'devil' || lib.character[event.chosen[0]][1] == 'shen') && !lib.character[event.chosen[0]][4].contains('hiddenSkill')) {
                                chooseGroup = true;
                            }
                        } else if (event.modchosen) {
                            if (event.modchosen[0] == 'random') event.modchosen[0] = result.buttons[0].link;
                            else event.modchosen[1] = result.buttons[0].link;
                        } else if (result.buttons.length == 2) {
                            event.choosed = [result.buttons[0].link, result.buttons[1].link];
                            game.addRecentCharacter(result.buttons[0].link, result.buttons[1].link);
                            if ((lib.character[event.choosed[0]][1] == 'devil' || lib.character[event.choosed[0]][1] == 'shen') && !lib.character[event.choosed[0]][4].contains('hiddenSkill')) {
                                chooseGroup = true;
                            }
                        } else {
                            event.choosed = [result.buttons[0].link];
                            if ((lib.character[event.choosed[0]][1] == 'devil' || lib.character[event.choosed[0]][1] == 'shen') && !lib.character[event.choosed[0]][4].contains('hiddenSkill')) {
                                chooseGroup = true;
                            }
                            game.addRecentCharacter(result.buttons[0].link);
                        }
                        if (get.config('choose_group') && chooseGroup) {
                            var list = lib.group.slice(0);
                            list.remove('devil');
                            list.remove('shen');
                            game.me.chooseControl(list).prompt = '请选择神武将的势力';
                        }
                        "step 2";
                        event.group = result.control || false;
                        if (event.chosen.length) {
                            lib.element.player.uninit.call(target);
                            lib.element.player.init.call(target, event.chosen[0], event.chosen[1]);
                        } else if (event.modchosen) {
                            lib.element.player.uninit.call(target);
                            lib.element.player.init.call(target, event.modchosen[0], event.modchosen[1]);
                        } else if (event.choosed.length == 2) {
                            lib.element.player.uninit.call(target);
                            lib.element.player.init.call(target, event.choosed[0], event.choosed[1]);
                        } else {
                            lib.element.player.uninit.call(target);
                            lib.element.player.init.call(target, event.choosed[0]);
                        }
                        event.list.remove(get.sourceCharacter(target.name1));
                        event.list.remove(get.sourceCharacter(target.name2));
                        if (target == game.zhu && _status.mode != 'purple') {
                            if (game.players.length > 4 || get.mode() == 'doudizhu') {
                                target.hp++;
                                target.maxHp++;
                                target.update();
                            }
                            if (get.mode() == 'identity') {
                                var enhance_zhu = false;
                                if (_status.connectMode) {
                                    enhance_zhu = (_status.mode != 'zhong' && _status.mode != 'purple' && lib.configOL.enhance_zhu && get.population('fan') >= 3);
                                } else {
                                    enhance_zhu = (_status.mode != 'zhong' && _status.mode != 'purple' && get.config('enhance_zhu') && get.population('fan') >= 3);
                                }
                                if (enhance_zhu) {
                                    var skill;
                                    switch (game.zhu.name) {
                                    case 'key_yuri':
                                        skill = 'buqu';
                                        break;
                                    case 'liubei':
                                        skill = 'jizhen';
                                        break;
                                    case 'dongzhuo':
                                        skill = 'hengzheng';
                                        break;
                                    case 'sunquan':
                                        skill = 'batu';
                                        break;
                                    case 'sp_zhangjiao':
                                        skill = 'tiangong';
                                        break;
                                    case 'liushan':
                                        skill = 'shengxi';
                                        break;
                                    case 'sunce':
                                        skill = 'ciqiu';
                                        break;
                                    case 're_sunben':
                                        skill = 'ciqiu';
                                        break;
                                    case 'yuanshao':
                                        skill = 'geju';
                                        break;
                                    case 're_caocao':
                                        skill = 'dangping';
                                        break;
                                    case 'caopi':
                                        skill = 'junxing';
                                        break;
                                    case 'liuxie':
                                        skill = 'moukui';
                                        break;
                                    default:
                                        skill = 'tianming';
                                        break;
                                    }
                                    game.broadcastAll(function(player, skill) {
                                        target.addSkill(skill);
                                        target.storage.enhance_zhu = skill;
                                    },
                                    game.zhu, skill);
                                }
                            }
                            if (get.mode() == 'doudizhu') {
                                if (['normal', 'huanle', 'kaihei'].contains(_status.mode)) {
                                    var skill = ['feiyang', 'bahu'];
                                    game.broadcastAll(function(player, skill) {
                                        target.addSkill(skill);
                                    },
                                    game.zhu, skill);
                                }
                                if (_status.mode == 'binglin') {
                                    var skill = game.zhuSkill;
                                    game.broadcastAll(function(player, skill) {
                                        target.addSkill(skill);
                                    },
                                    game.zhu, skill);
                                }
                            }
                        } else {
                            if (_status.mode == 'binglin') {
                                var skill = ['binglin_shaxue', 'binglin_neihong'];
                                game.broadcastAll(function(player, skill) {
                                    target.addSkill(skill);
                                },
                                target, skill);
                            }
                        }
                        if (_status.mode == 'online') {
                            game.zhu.hp = 4;
                            game.zhu.maxHp = 4;
                            game.zhu.update();
                            target.storage.doudizhu_cardPile = event.cardPile;
                            target.markSkill('doudizhu_cardPile');
                        }
                        if (_status.mode == 'purple') {
                            if (target == game.rZhu || target == game.bZhu) {
                                target.hp++;
                                target.maxHp++;
                                target.update();
                            }
                        }
                        /*for(var i=0;i<game.players.length;i++){
		                    if(game.players[i]!=game.zhu&&game.players[i]!=target){
		                        event.list.randomSort();
		                        event.ai(game.players[i],event.list.splice(0,get.config('choice_'+game.players[i].identity)),null,event.list)
		                    }
		                }*/
                        "step 3";
                        if (event.group) {
                            target.group = event.group;
                            target.node.name.dataset.nature = get.groupnature(target.group);
                            target.update();
                        }
                        for (var i = 0; i < game.players.length; i++) {
                            _status.characterlist.remove(game.players[i].name);
                            _status.characterlist.remove(game.players[i].name1);
                            _status.characterlist.remove(game.players[i].name2);
                        }
                        "step 4";
                        setTimeout(function() {
                            ui.arena.classList.remove('choose-character');
                        },
                        500);

                        if (event.special_identity) {
                            for (var i = 0; i < event.special_identity.length; i++) {
                                game.zhu.addSkill(event.special_identity[i]);
                            }
                        }
                    });
                },
                // 国战
                chooseCharacterGuoZhan: function() {
                    var next = game.createEvent('chooseCharacter', false);
                    next.showConfig = true;
                    next.addPlayer = true;
                    next.target = this;
                    next.player = game.me;
                    next.ai = function(player, list, back) {
                        if (_status.brawl && _status.brawl.chooseCharacterAi) {
                            if (_status.brawl.chooseCharacterAi(player, list, back) !== false) {
                                return;
                            }
                        }
                        var filterChoice = function(name1, name2) {
                            if (get.is.double(name1)) return false;
                            var group1 = lib.character[name1][1];
                            var group2 = lib.character[name2][1];
                            if (group1 == 'ye') return group2 != 'ye';
                            var double = get.is.double(name2, true);
                            if (double) return double.contains(group1);
                            return group1 == group2;
                        };
                        for (var i = 0; i < list.length - 1; i++) {
                            for (var j = i + 1; j < list.length; j++) {
                                if (filterChoice(list[i], list[j]) || filterChoice(list[j], list[i])) {
                                    var mainx = list[i];
                                    var vicex = list[j];
                                    if (!filterChoice(mainx, vicex) || (filterChoice(vicex, mainx) && get.guozhanReverse(mainx, vicex))) {
                                        mainx = list[j];
                                        vicex = list[i];
                                    }
                                    player.init(mainx, vicex, false);
                                    if (back) {
                                        list.remove(player.name1);
                                        list.remove(player.name2);
                                        for (var i = 0; i < list.length; i++) {
                                            back.push(list[i]);
                                        }
                                    }
                                    return;
                                }
                            }
                        }
                    }
                    next.setContent(function() {
                        "step 0";
                        ui.arena.classList.add('choose-character');
                        var addSetting = function(dialog) {
                            dialog.add('选择座位').classList.add('add-setting');
                            var seats = document.createElement('table');
                            seats.classList.add('add-setting');
                            seats.style.margin = '0';
                            seats.style.width = '100%';
                            seats.style.position = 'relative';
                            for (var i = 1; i <= game.players.length; i++) {
                                var td = ui.create.div('.shadowed.reduce_radius.pointerdiv.tdnode');
                                td.innerHTML = '<span>' + get.cnNumber(i, true) + '</span>';
                                td.link = i - 1;
                                seats.appendChild(td);
                                td.addEventListener(lib.config.touchscreen ? 'touchend': 'click',
                                function() {
                                    if (_status.dragged) return;
                                    if (_status.justdragged) return;
                                    if (_status.cheat_seat) {
                                        _status.cheat_seat.classList.remove('bluebg');
                                        if (_status.cheat_seat == this) {
                                            delete _status.cheat_seat;
                                            return;
                                        }
                                    }
                                    this.classList.add('bluebg');
                                    _status.cheat_seat = this;
                                });
                            }
                            dialog.content.appendChild(seats);
                            if (game.me == game.zhu) {
                                seats.previousSibling.style.display = 'none';
                                seats.style.display = 'none';
                            }
                            dialog.add(ui.create.div('.placeholder.add-setting'));
                            dialog.add(ui.create.div('.placeholder.add-setting'));
                            if (get.is.phoneLayout()) dialog.add(ui.create.div('.placeholder.add-setting'));
                        };
                        var removeSetting = function() {
                            var dialog = _status.event.dialog;
                            if (dialog) {
                                dialog.style.height = '';
                                delete dialog._scrollset;
                                var list = Array.from(dialog.querySelectorAll('.add-setting'));
                                while (list.length) {
                                    list.shift().remove();
                                }
                                ui.update();
                            }
                        };
                        event.addSetting = addSetting;
                        event.removeSetting = removeSetting;
                        var chosen = lib.config.continue_name || [];
                        game.saveConfig('continue_name');
                        event.chosen = chosen;
                        var i;
                        event.list = [];
                        for (i in lib.character) {
                            if (i.indexOf('gz_shibing') == 0) continue;
                            if (chosen.contains(i)) continue;
                            if (lib.filter.characterDisabled(i)) continue;
                            if (get.config('onlyguozhan')) {
                                if (!lib.characterPack.mode_guozhan[i]) continue;
                                if (get.is.jun(i)) continue;
                            }
                            if (lib.character[i][4].contains('hiddenSkill')) continue;
                            if (lib.character[i][2] == 3 || lib.character[i][2] == 4 || lib.character[i][2] == 5) event.list.push(i);

                        }
                        _status.characterlist = event.list.slice(0);
                        _status.yeidentity = [];
                        if (_status.brawl && _status.brawl.chooseCharacterFilter) {
                            event.list = _status.brawl.chooseCharacterFilter(event.list);
                        }
                        event.list.randomSort();
                        var list;
                        if (_status.brawl && _status.brawl.chooseCharacter) {
                            list = _status.brawl.chooseCharacter(event.list, game.me);
                        } else {
                            list = game.getCharacterChoice(event.list, parseInt(get.config('choice_num')));
                        }
                        if (_status.auto) {
                            event.ai(target, list);
                            lib.init.onfree();
                        } else if (chosen.length) {
                            game.me.init(chosen[0], chosen[1], false);
                            lib.init.onfree();
                        } else {
                            event.dialogxx = ui.create.characterDialog('heightset',
                            function(i) {
                                if (i.indexOf('gz_shibing') == 0) return true;
                                if (get.config('onlyguozhan')) {
                                    if (!lib.characterPack.mode_guozhan[i]) return true;
                                    if (get.is.jun(i)) return true;
                                }
                            },
                            get.config('onlyguozhanexpand') ? 'expandall': undefined, get.config('onlyguozhan') ? 'onlypack:mode_guozhan': undefined, target);
                            var dialog = ui.create.dialog('选择角色', 'hidden', [list, 'character']);
                            if (!_status.brawl || !_status.brawl.noAddSetting) {
                                if (get.config('change_identity')) {
                                    addSetting(dialog);
                                }
                            }
                            var next = game.me.chooseButton(event.dialogxx, true, 2).set('onfree', true);
                            next.filterButton = function(button) {
                                if (ui.dialog.buttons.length <= 10) {
                                    for (var i = 0; i < ui.dialog.buttons.length; i++) {
                                        if (ui.dialog.buttons[i] != button) {
                                            if (lib.element.player.perfectPair.call({
                                                name1: button.link,
                                                name2: ui.dialog.buttons[i].link
                                            })) {
                                                button.classList.add('glow2');
                                            }
                                        }
                                    }
                                }
                                if (lib.character[button.link][4].contains('hiddenSkill')) return false;
                                if (ui.selected.buttons.length == 0) {
                                    if (get.is.double(button.link)) return false;
                                    if (lib.character[button.link][1] == 'ye') return true;
                                    for (var i = 0; i < ui.dialog.buttons.length; i++) {
                                        var double = get.is.double(ui.dialog.buttons[i].link, true);
                                        if (ui.dialog.buttons[i] != button && (lib.character[button.link][1] == lib.character[ui.dialog.buttons[i].link][1] || double && double.contains(lib.character[button.link][1]))) {
                                            return true;
                                        }
                                    }
                                    return false;
                                }
                                if (!lib.character[button.link] || lib.character[button.link][1] == 'ye') return false;
                                if (get.is.double(ui.selected.buttons[0].link)) return false;
                                if (lib.character[ui.selected.buttons[0].link][1] == 'ye') return true;
                                if (get.is.double(button.link)) return get.is.double(button.link, true).contains(lib.character[ui.selected.buttons[0].link][1]);
                                return (lib.character[button.link][1] == lib.character[ui.selected.buttons[0].link][1]);
                            };
                            next.switchToAuto = function() {
                                event.ai(target, list);
                                ui.arena.classList.remove('selecting');
                            };
                        }
                        "step 1";
                        if (ui.cheat) {
                            ui.cheat.close();
                            delete ui.cheat;
                        }
                        if (ui.cheat2) {
                            ui.cheat2.close();
                            delete ui.cheat2;
                        }
                        if (result.buttons) {
                            //lib.element.player.uninit.call(target);
                            lib.element.player.init.call(target, result.buttons[0].link, result.buttons[1].link, false);
                            game.addRecentCharacter(result.buttons[0].link, result.buttons[1].link);
                        }
                        target.setIdentity(target.group);
                        target.classList.add('unseen');
                        target.classList.add('unseen2');
                        if (target != game.me) {
                            target.node.identity.firstChild.innerHTML = '猜';
                            target.node.identity.dataset.color = 'unknown';
                            target.node.identity.classList.add('guessing');
                        }
                        target.hiddenSkills = lib.character[target.name1][3].slice(0);
                        var hiddenSkills2 = lib.character[target.name2][3];
                        for (var j = 0; j < hiddenSkills2.length; j++) {
                            target.hiddenSkills.add(hiddenSkills2[j]);
                        }
                        for (var j = 0; j < target.hiddenSkills.length; j++) {
                            if (!lib.skill[target.hiddenSkills[j]]) {
                                target.hiddenSkills.splice(j--, 1);
                            }
                        }
                        target.group = 'unknown';
                        target.sex = 'unknown';
                        target.name1 = target.name;
                        target.name = 'unknown';
                        target.identity = 'unknown';
                        target.node.name.show();
                        target.node.name2.show();
                        target._group = lib.character[target.name1][1];
                        for (var j = 0; j < target.hiddenSkills.length; j++) {
                            target.addSkillTrigger(target.hiddenSkills[j], true);
                        }
                        setTimeout(function() {
                            ui.arena.classList.remove('choose-character');
                        },
                        500);
                    });
                },
            };
            //if(lib.config['extension_祖安设置_text']) {
            lib.skill._diycharacterskill = {
                //priority:1000,
                priority: Infinity,
                trigger: {
                    player: ["enterGame"],
                    global: "gameDrawEnd",
                },
                enable: 'phaseUse',
                silent: true,
                direct: true,
                forced: true,
                filter: function(event, player) {
                    return (player == game.me && lib.config['extension_祖安设置_text']);
                },
                content: function() {
                    'step 0';
                    //专门和单行选将适配一下
                    _status.noEnterChoosing = true;
                    //event.item='[自定义全场角色]<li>此功能支持所有武将的更换<li>此功能支持武将包分类选择<li>此功能包含测试专用的工具<li>供拓展制作和AI测试勿作弊';
                    //event.tool='[自定义全场角色]<li>此工具支持观看武将的身份<li>此工具支持武将的位置更换<li>此工具支持更换武将的手牌<li>目前可能存在漏洞慎重操作';
                    event.getItem = function(icon, title, str, color1, color2) {
                        return '<li style="padding:8px 12px;background:linear-gradient(45deg,' + color1 + ',' + color2 + ');color:white;border-radius:8px;margin:5px;box-shadow:0 2px 8px rgba(0,0,0,0.3);display:flex;align-items:center"><span style="margin-right:8px">' + icon + '</span><b style="font-size:27px">' + title + '</b><span style="margin-left:8px;font-size:20px;opacity:0.9">' + str + '</span></li>';
                    };
                    event.back = false;
                    player.chooseControl('换将Ⅰ', '换将Ⅱ', '工具', '结束',
                    function() {
                        return '结束';
                    }).set('prompt', event.getItem('💠', '游戏开发工具', '可进行武将切换/对局调试', 'rgba(40, 190, 250, 0.6)', 'rgba(40, 250, 190, 0.4)'));
                    /*if(1==0) {
			            lib.characterPack={
			                "mode_extension_权御天下":lib.characterPack["mode_extension_权御天下"];
			            }
			        }*/
                    'step 1';
                    event.back = false;
                    if (result.control == '结束') {
                        _status.noEnterChoosing = undefined; {
                            if (event && event.finish) {
                                event.finish();
                            } else {
                                return;
                            }
                        }
                    } else {
                        if (['换将Ⅰ', '换将Ⅱ'].contains(result.control)) {
                            event.choosePlayerMode = result.control;
                            var tranList = {
                                '换将Ⅰ': ['武将更换系统', '可选择更换主将/副将', ],
                                '换将Ⅱ': ['自由选将系统', '调用AI选将进行换将', ]
                            };
                            player.chooseTarget(1, '◈请选择更换武将牌的角色',
                            function(card, player, target) {
                                return true;
                            }).set('prompt2', event.getItem('🎭', tranList[event.choosePlayerMode][0], tranList[event.choosePlayerMode][1], 'rgba(40, 190, 250, 0.6)', 'rgba(40, 250, 190, 0.4)'));
                            event.goto(2);
                        } else {
                            player.chooseControl('显示身份', '交换位置', '更换手牌', '返回',
                            function() {
                                return '返回';
                            }).set('prompt', event.getItem('🛠️', '高级管理工具', '身份查看/位置调整/手牌修改', 'rgba(250, 80, 40, 0.6)', 'rgba(250, 160, 40, 0.4)'));
                            event.goto(5);
                        }
                    }
                    'step 2';
                    //选择角色
                    if (result.bool) {
                        if (!event.back) event.targets = result.targets[0];
                        event.back = false;
                        if (event.choosePlayerMode == '换将Ⅰ') {
                            var list = [];
                            var ranlist = [];
                            for (var a in lib.characterPack) {
                                list.push([lib.translate[a + '_character_config'], '', lib.translate[a + '_character_config']]);
                                ranlist.push(a);
                                var finish = 0;
                                var shift = [];
                                for (var c in lib.characterPack[a]) {
                                    shift.push(c);
                                }
                                var b = shift.randomGet();
                                lib.card[lib.translate[a + '_character_config']] = {
                                    type: a,
                                    color: 'white',
                                    fullskin: true,
                                    textShadow: 'black 0 0 2px',
                                    chongzhu: true,
                                    show: b,
                                };
                                lib.translate[lib.translate[a + '_character_config'] + '_info'] = "就一个武将包而已。";
                            }
                            //div style="border:1px solid #CCCCCC; width:200px; height:200px; background:#66FFFF; margin-bottom:10px;" class="websjy1">32423</div>
                            if (list.length) {
                                player.chooseButton(['◈请选择来源武将包<br>[已指定：' + get.translation(event.targets) + ']', [list, 'vcard']]).set('filterButton',
                                function(button) {
                                    button.node.suitnum.innerHTML = '';
                                    button.$name.innerHTML = '';
                                    game.createCss(`.zuan_pack_title {
                                        width: 100 % ;
                                        height: 100 % ;
                                        writing - mode: vertical - lr;
                                        display: flex;
                                        justify - content: center;
                                        align - items: center;
                                        font - size: 25px;
                                    }`);
                                    let title = ui.create.div(button);
                                    title.innerHTML = button.name;
                                    title.classList.add('zuan_pack_title');
                                    button.zuanTitle = title;
                                    return true;
                                }).set('ai',
                                function(button) {
                                    return - 1;
                                });
                                event.goto(3);
                            } else {
                                event.goto(0);
                            }
                        } else {
                            lib['AI选将'].chooseCharacter(event.targets);
                            event.goto(0);
                        }
                    } else {
                        event.goto(0);
                    }
                    'step 3';
                    //选择了来源武将包
                    if (result.bool) {
                        var a = get.type(result.links[0][2]);
                        event.pack = lib.characterPack[a];
                        packname = lib.translate[a + '_character_config'];
                        var list = [];
                        var ranlist = [];
                        //var group=['shen','wei','shu','wu','qun','jin'];
                        var group = lib.group;
                        if (!group.contains('western')) {
                            group.push('western');
                        }
                        if (!group.contains('devil')) {
                            group.push('devil');
                        }
                        for (var i = 0; i < group.length; i++) {
                            for (var b in event.pack) {
                                var role = event.pack[b];
                                if (role[1] == group[i]) {
                                    list.push(b);
                                }
                            }
                        }
                        var choose = list.randomGet();
                        player.chooseButton(['◈请选择更换的武将<br>[已选择：' + lib.translate[a + '_character_config'] + ']', [list, 'character']]).ai = function(button) {
                            var name = button.link; //[2];
                            return name == choose;
                        }
                        event.goto(4);
                    } else {
                        event.goto(0);
                    }
                    'step 4';
                    //选择了更换的武将
                    if (result.bool && result.links) {
                        event.back = false;
                        if (event.targets.name2) {
                            event.changejiang = result.links[0]; //[2];
                            player.chooseControl('更换主将', '更换副将',
                            function() {
                                return '更换主将';
                            }).set('prompt', '◈请选择更换主将或副将');
                            event.goto(9);
                        } else {
                            event.targets.init(result.links[0]
                            /*[2]*/
                            );
                            /*if(event.targets.identity=='zhu') {
			                    event.targets.maxHp++;
			                    event.targets.hp++;
			                    event.targets.update();
			                }*/
                            var target = event.targets;
                            if (target == game.zhu && _status.mode != 'purple') {
                                if (game.players.length > 4 || get.mode() == 'doudizhu') {
                                    target.hp++;
                                    target.maxHp++;
                                    target.update();
                                }
                                if (get.mode() == 'identity') {
                                    var enhance_zhu = false;
                                    if (_status.connectMode) {
                                        enhance_zhu = (_status.mode != 'zhong' && _status.mode != 'purple' && lib.configOL.enhance_zhu && get.population('fan') >= 3);
                                    } else {
                                        enhance_zhu = (_status.mode != 'zhong' && _status.mode != 'purple' && get.config('enhance_zhu') && get.population('fan') >= 3);
                                    }
                                    if (enhance_zhu) {
                                        var skill;
                                        switch (game.zhu.name) {
                                        case 'key_yuri':
                                            skill = 'buqu';
                                            break;
                                        case 'liubei':
                                            skill = 'jizhen';
                                            break;
                                        case 'dongzhuo':
                                            skill = 'hengzheng';
                                            break;
                                        case 'sunquan':
                                            skill = 'batu';
                                            break;
                                        case 'sp_zhangjiao':
                                            skill = 'tiangong';
                                            break;
                                        case 'liushan':
                                            skill = 'shengxi';
                                            break;
                                        case 'sunce':
                                            skill = 'ciqiu';
                                            break;
                                        case 're_sunben':
                                            skill = 'ciqiu';
                                            break;
                                        case 'yuanshao':
                                            skill = 'geju';
                                            break;
                                        case 're_caocao':
                                            skill = 'dangping';
                                            break;
                                        case 'caopi':
                                            skill = 'junxing';
                                            break;
                                        case 'liuxie':
                                            skill = 'moukui';
                                            break;
                                        default:
                                            skill = 'tianming';
                                            break;
                                        }
                                        game.broadcastAll(function(player, skill) {
                                            target.addSkill(skill);
                                            target.storage.enhance_zhu = skill;
                                        },
                                        game.zhu, skill);
                                    }
                                }
                                if (get.mode() == 'doudizhu') {
                                    if (['normal', 'huanle', 'kaihei'].contains(_status.mode)) {
                                        var skill = ['feiyang', 'bahu'];
                                        game.broadcastAll(function(player, skill) {
                                            target.addSkill(skill);
                                        },
                                        game.zhu, skill);
                                    }
                                    if (_status.mode == 'binglin') {
                                        var skill = game.zhuSkill;
                                        game.broadcastAll(function(player, skill) {
                                            target.addSkill(skill);
                                        },
                                        game.zhu, skill);
                                    }
                                }
                            } else {
                                if (_status.mode == 'binglin') {
                                    var skill = ['binglin_shaxue', 'binglin_neihong'];
                                    game.broadcastAll(function(player, skill) {
                                        target.addSkill(skill);
                                    },
                                    target, skill);
                                }
                            }
                            if (_status.mode == 'online') {
                                game.zhu.hp = 4;
                                game.zhu.maxHp = 4;
                                game.zhu.update();
                                target.storage.doudizhu_cardPile = event.cardPile;
                                target.markSkill('doudizhu_cardPile');
                            }
                            if (_status.mode == 'purple') {
                                if (target == game.rZhu || target == game.bZhu) {
                                    target.hp++;
                                    target.maxHp++;
                                    target.update();
                                }
                            }
                            game.delay(0.5);
                            event.goto(0);
                        }
                    } else {
                        event.back = true;
                        result.bool = true;
                        event.goto(2);
                    }
                    'step 5';
                    //工具
                    if (result.control == '显示身份') {
                        try {
                            for (var i = 0; i < game.players.length; i++) {
                                //game.players[i].setIdentity(get.translation(game.players[i].identity));
                                if (get.mode() != 'guozhan') {
                                    game.log(game.players[i], '的身份是', game.players[i].identity);
                                    game.players[i].say(get.translation(game.players[i].identity));
                                    //game.players[i].say(get.translation(game.players[i].identity));
                                } else {
                                    game.log(game.players[i], '的武将是', game.players[i].name1, '(', lib.character[game.players[i].name1][1], ')', '、', game.players[i].name2, '(', lib.character[game.players[i].name2][1], ')');
                                    game.players[i].say(get.translation(game.players[i].name1) + '、' + get.translation(game.players[i].name2));
                                }
                            }
                        } catch {
                            game.log('场上有玩家信息不完整，检测终止');
                        }
                        result.control = '工具';
                        event.back = true;
                        event.goto(1);
                    } else if (result.control == '交换位置') {
                        player.chooseTarget('◈请选择交换位置的两名角色', 2,
                        function(card, player, target) {
                            return true;
                        }).set('prompt2', event.getItem('🔄', '座次调整工具', '选择两名角色交换座次', 'rgba(250, 80, 40, 0.6)', 'rgba(250, 160, 40, 0.4)'));
                        event.goto(6);
                    } else if (result.control == '更换手牌') {
                        player.chooseTarget('◈请选择更换手牌的角色', 1,
                        function(card, player, target) {
                            return true;
                        }).set('prompt2', event.getItem('🃏', '手牌修改工具', '增加/删除/修改角色的手牌', 'rgba(250, 80, 40, 0.6)', 'rgba(250, 160, 40, 0.4)'));
                        event.goto(7);
                    } else event.goto(0);
                    'step 6';
                    //交换位置
                    if (result.bool) {
                        event.targets = result.targets;
                        game.swapSeat(event.targets[0], event.targets[1], false);
                        result.control = '工具';
                        event.back = true;
                        event.goto(1);
                    } else {
                        result.control = '工具';
                        event.back = true;
                        event.goto(1);
                    }
                    'step 7';
                    //更换手牌
                    if (result.bool) {
                        if (!event.back) event.target = result.targets[0];
                        event.back = false;
                        var name = 'zuan_blankCard';
                        lib.card[name] = {};
                        lib.translate[name] = '空位';
                        lib.translate[name + '_info'] = '手牌的一个空位。';
                        var cards = event.target.getCards('h');
                        cards.push(game.createCard({
                            name: name,
                            suit: ' ',
                            number: '➕'
                        }));
                        var content = [get.translation(event.target) + '的手牌<br>◈是否修改其手牌？', cards];
                        player.chooseControl('修改', '随机', '取消',
                        function() {
                            return '取消';
                        }).set('dialog', content);
                        event.goto(8);
                    } else {
                        result.control = '工具';
                        event.back = true;
                        event.goto(1);
                    }
                    'step 8';
                    //选择了更换
                    if (result.control == '修改') {
                        event.back = false;
                        event.goto(10);
                    } else if (result.control == '随机') {
                        var hs = event.target.getCards('h');
                        game.addVideo('lose', event.target, [get.cardsInfo(hs), [], [], []]);
                        for (var i = 0; i < hs.length; i++) {
                            hs[i].discard(false);
                        }
                        event.target.directgain(get.cards(hs.length));
                        event.back = true;
                        result.bool = true;
                        event.goto(7);
                    } else {
                        //if(event.dialog) event.dialog.close();
                        result.control = '工具';
                        event.back = true;
                        event.goto(1);
                    }
                    'step 9';
                    //主将副将
                    var hp = event.targets.hp;
                    var maxhp = event.targets.maxHp;
                    if (result.control == '更换主将') {
                        event.targets.init(event.changejiang, event.targets.name2);
                    } else {
                        if (event.targets.name.indexOf('unknown') == -1) {
                            var name = "name";
                        } else {
                            var name = "name1"
                        }
                        event.targets.init(event.targets.name, event.changejiang);
                    }
                    event.targets.update();
                    var target = event.targets;
                    if (target == game.zhu && _status.mode != 'purple') {
                        if (game.players.length > 4 || get.mode() == 'doudizhu') {
                            target.hp++;
                            target.maxHp++;
                            target.update();
                        }
                        if (get.mode() == 'identity') {
                            var enhance_zhu = false;
                            if (_status.connectMode) {
                                enhance_zhu = (_status.mode != 'zhong' && _status.mode != 'purple' && lib.configOL.enhance_zhu && get.population('fan') >= 3);
                            } else {
                                enhance_zhu = (_status.mode != 'zhong' && _status.mode != 'purple' && get.config('enhance_zhu') && get.population('fan') >= 3);
                            }
                            if (enhance_zhu) {
                                var skill;
                                switch (game.zhu.name) {
                                case 'key_yuri':
                                    skill = 'buqu';
                                    break;
                                case 'liubei':
                                    skill = 'jizhen';
                                    break;
                                case 'dongzhuo':
                                    skill = 'hengzheng';
                                    break;
                                case 'sunquan':
                                    skill = 'batu';
                                    break;
                                case 'sp_zhangjiao':
                                    skill = 'tiangong';
                                    break;
                                case 'liushan':
                                    skill = 'shengxi';
                                    break;
                                case 'sunce':
                                    skill = 'ciqiu';
                                    break;
                                case 're_sunben':
                                    skill = 'ciqiu';
                                    break;
                                case 'yuanshao':
                                    skill = 'geju';
                                    break;
                                case 're_caocao':
                                    skill = 'dangping';
                                    break;
                                case 'caopi':
                                    skill = 'junxing';
                                    break;
                                case 'liuxie':
                                    skill = 'moukui';
                                    break;
                                default:
                                    skill = 'tianming';
                                    break;
                                }
                                game.broadcastAll(function(player, skill) {
                                    target.addSkill(skill);
                                    target.storage.enhance_zhu = skill;
                                },
                                game.zhu, skill);
                            }
                        }
                        if (get.mode() == 'doudizhu') {
                            if (['normal', 'huanle', 'kaihei'].contains(_status.mode)) {
                                var skill = ['feiyang', 'bahu'];
                                game.broadcastAll(function(player, skill) {
                                    target.addSkill(skill);
                                },
                                game.zhu, skill);
                            }
                            if (_status.mode == 'binglin') {
                                var skill = game.zhuSkill;
                                game.broadcastAll(function(player, skill) {
                                    target.addSkill(skill);
                                },
                                game.zhu, skill);
                            }
                        }
                    } else {
                        if (_status.mode == 'binglin') {
                            var skill = ['binglin_shaxue', 'binglin_neihong'];
                            game.broadcastAll(function(player, skill) {
                                target.addSkill(skill);
                            },
                            target, skill);
                        }
                    }
                    if (_status.mode == 'online') {
                        game.zhu.hp = 4;
                        game.zhu.maxHp = 4;
                        game.zhu.update();
                        target.storage.doudizhu_cardPile = event.cardPile;
                        target.markSkill('doudizhu_cardPile');
                    }
                    if (_status.mode == 'purple') {
                        if (target == game.rZhu || target == game.bZhu) {
                            target.hp++;
                            target.maxHp++;
                            target.update();
                        }
                    }
                    /*event.targets.maxHp=Math.ceil((event.targets.maxHp+maxhp)/2);
		            event.targets.hp=Math.ceil((event.targets.hp+hp)/2);
		            if(event.targets.identity=='zhu') {
		                event.targets.maxHp++;
		                event.targets.hp++;
		            }*/
                    event.targets.update();
                    game.delay(0.5);
                    event.back = true;
                    event.goto(0);
                    'step 10';
                    //替换手牌
                    var name = 'zuan_newCard';
                    lib.card[name] = {};
                    lib.translate[name] = '新增';
                    lib.translate[name + '_info'] = '改为新增一张手牌。';
                    result.bool = false;
                    event.videoId = lib.status.videoId++;
                    var cards = event.target.getCards('h');
                    cards.push(game.createCard({
                        name: name,
                        suit: ' ',
                        number: '➕'
                    }));
                    event.dialogs = ui.create.dialog(get.translation(event.target) + '的手牌<br>◈请选择要替换的牌', cards);
                    event.dialogs.videoId = event.videoId;
                    if (!event.isMine()) {
                        event.dialogs.style.display = 'none';
                    }
                    player.chooseButton(1,
                    function(card, player) {
                        return false;
                    }).set('dialog', event.videoId);
                    'step 11';
                    //展开替换列表
                    event.dialogs.close();
                    if (result.bool) {
                        result.bool = false;
                        event.changecard = result.links[0];
                        event.cardlist = [];
                        var nameD = 'zuan_deleteCard';
                        lib.card[nameD] = {
                            type: ' ',
                        };
                        lib.translate[nameD] = '删除';
                        lib.translate[nameD + '_info'] = '改为删除此手牌。';
                        if (event.changecard.name != 'zuan_newCard') event.cardlist.push([get.translation(lib.card[nameD].type), '➖', nameD, '']);
                        for (var i = 0; i < lib.inpile.length; i++) {
                            var name = lib.inpile[i];
                            var info = lib.card[name];
                            if (!event.cardlist[info.type]) {
                                event.cardlist[info.type] = [];
                            }
                            if (name == 'sha') {
                                event.cardlist.push([get.translation(lib.card[name].type), '', 'sha', '']);
                                event.cardlist.push([get.translation(lib.card[name].type), '', 'sha', 'fire']);
                                event.cardlist.push([get.translation(lib.card[name].type), '', 'sha', 'thunder']);
                                event.cardlist.push([get.translation(lib.card[name].type), '', 'sha', 'ice']);
                                event.cardlist.push([get.translation(lib.card[name].type), '', 'sha', 'stab']);
                            } else event.cardlist.push([get.translation(lib.card[name].type), '', name, '']);
                        }
                        event.dialog = ui.create.dialog('◈请选择要替换成的牌', [event.cardlist, 'vcard']);
                        player.chooseButton(event.dialog).ai = function(button) {
                            return false;
                        };
                        event.goto(12);
                    } else {
                        event.back = true;
                        result.bool = true;
                        event.goto(7);
                    }
                    'step 12';
                    //替换完成
                    if (result.bool) {
                        //game.addVideo('lose',event.target,[get.cardsInfo(hs),[],[],[]]);
                        if (event.changecard.name != 'zuan_newCard') event.changecard.discard(false);
                        //var card=game.createCard(get.inpile(result.links[0][2]).randomGet());
                        if (result.links[0][2] != 'zuan_deleteCard') {
                            event.target.gain(game.createCard({
                                name: result.links[0][2],
                                nature: result.links[0][3]
                            }));
                        } else {
                            event.target.directgain([]);
                        }
                        //player.chooseUseTarget(result.links[0][2],true,false);
                        //event.target.update();
                    }
                    event.back = true;
                    result.bool = true;
                    if (event.dialog) event.dialog.close();
                    event.goto(10);
                    'step 13';
                    event.goto(0);
                },
            }
            //}   
            // ---------------------------------------砸花送蛋------------------------------------------//
            var offline = sessionStorage.getItem('Network');
            if (!offline) offline = 'online';
            if (offline != 'offline') {
                //和epic冲突（故意的，防止两种一起放了）
                lib.skill._emojiRebate1 = {
                    trigger: {
                        player: ['recoverAfter', 'dying', 'gainAfter', 'turnOverAfter']
                    },
                    forced: true,
                    popup: false,
                    priority: -98,
                    filter: function(event, player) {
                        if (!event.source || event.source == player || game.isMine(player)) return false;
                        return lib.config['extension_祖安设置_zuanemotion'] && player.throwEmotion && (Math.random() >= 0.3);
                    },
                    content: function() {
                        var list = {
                            humiliationList: ["shoe", "egg"],
                            praiseList: ["flower", "wine"],
                        };
                        switch (trigger.name) {
                        case "recover":
                            let save = trigger.getParent("_save");
                            let keys = Object.keys(save);
                            if (keys.length) {
                                if (player.getEnemies().contains(save.player)) {
                                    //EpicFX.emoji.playEmoji(player, save.player, EpicFX.emoji.humiliationList.randomGet());
                                    player.throwEmotion(save.player, list.humiliationList.randomGet());
                                } else {
                                    //EpicFX.emoji.playEmoji(player, save.player, EpicFX.emoji.praiseList.randomGet());
                                    if (player.getHp() > 2 || (Math.random() * 2 + 0.5) < Math.max(1, player.getHp())) {
                                        player.throwEmotion(save.player, list.praiseList.randomGet());
                                    } else {
                                        for (let i = 0; i < 10; i++) {
                                            setTimeout(() =>{
                                                if (i <= 8) player.throwEmotion(trigger.source, 'flower');
                                                else player.throwEmotion(trigger.source, 'wine');
                                            },
                                            100 * i);
                                        }
                                    }
                                }
                            }
                            break;
                        case "dying":
                            if (trigger.source) {
                                if (player.getEnemies().contains(trigger.source)) {
                                    //EpicFX.emoji.playEmoji(player, trigger.source, EpicFX.emoji.humiliationList.randomGet());
                                    if (Math.random() >= 0.3) {
                                        player.throwEmotion(trigger.source, list.humiliationList.randomGet());
                                    } else {
                                        for (let i = 0; i < 10; i++) {
                                            setTimeout(() =>{
                                                if (i <= 8) player.throwEmotion(trigger.source, 'egg');
                                                else player.throwEmotion(trigger.source, 'shoe');
                                            },
                                            100 * i);
                                        }
                                    }
                                }
                            }
                            break;
                        case "turnOver":
                            if (trigger.parent) {
                                if (player.getEnemies().contains(trigger.parent.player)) {
                                    //EpicFX.emoji.playEmoji(player, trigger.parent.player, EpicFX.emoji.humiliationList.randomGet());
                                    player.throwEmotion(trigger.parent.player, list.humiliationList.randomGet());
                                } else {
                                    //EpicFX.emoji.playEmoji(player, trigger.parent.player, EpicFX.emoji.praiseList.randomGet());
                                    player.throwEmotion(trigger.parent.player, list.praiseList.randomGet());
                                }
                            }
                            break;
                        case "gain":
                            if (trigger.giver && trigger.cards.length >= 2 && player.getFriends().contains(trigger.giver)) {
                                //EpicFX.emoji.playEmoji(player, trigger.giver, EpicFX.emoji.praiseList.randomGet());
                                player.throwEmotion(trigger.giver, list.praiseList.randomGet());
                            }
                            break;
                        }
                    }
                }
                lib.skill._emojiRebate2 = {
                    trigger: {
                        global: ['gameDrawBefore'],
                        player: "enterGame",
                    },
                    forced: true,
                    popup: false,
                    priority: -99,
                    filter: function(event, player) {
                        if (game.isMine(player)) return false;
                        return lib.config['extension_祖安设置_zuanemotion'] && game.filterPlayer(current =>current != player).length >= 2 && player.throwEmotion && Math.random() <= (0.3 / game.filterPlayer(current =>current != player).length); //(Math.random() >= 0.75);
                    },
                    content: function() {
                        const initialDelay = [0, 100, 200, 300, 400, 500].randomGet();
                        const players = game.filterPlayer(current =>current !== player).sortBySeat();
                        const baseInterval = 15; // 基础间隔时间 (最低阈值)
                        const sum = 10 + Math.ceil(10 * Math.random());
                        //const times = [1,1,1,2,2,3].randomGet();
                        player.throwing_forbid = true;

                        let forSend = function(num) {
                            const img = num >= 1 ? 'flower': 'wine';
                            for (let i = 0; i < players.length; i++) {
                                const target = players[i];
                                const executeTime = i * baseInterval * 0.2;
                                setTimeout(() =>{
                                    player.throwEmotion(target, img);
                                },
                                executeTime);
                            }
                            setTimeout(() =>{
                                if (num > 0) {
                                    forSend(num - 1);
                                } else {
                                    player.throwing_forbid = undefined;
                                }
                            },
                            players.length * baseInterval);
                        }
                        setTimeout(() =>{
                            forSend(sum);
                        },
                        initialDelay);
                    }
                }
                lib.skill._zuan_damageSendEgg = {
                    forced: true,
                    popup: false,
                    priority: -98,
                    trigger: {
                        global: 'damageEnd',
                    },
                    filter: function(event, player) {
                        var evt = event.getParent();
                        return lib.config['extension_祖安设置_zuanemotion'] && !game.isMine(player)
                        /*!player.isUnderControl(true)*/
                        && player.throwEmotion && get.attitude(player, event.player) > 0 && game.xwGetPhasePlayer() == event.player;
                    },
                    content: function() {
                        'step 0';
                        if (Math.random() >= 0.8) {
                            player.throwEmotion(trigger.player, ['egg', 'shoe'].randomGet());
                        }
                    }
                };
                lib.element.player.zuanLikeMe = function(tar, rate) {
                    if (!rate) {
                        rate = 1;
                    }
                    if (!lib.config['extension_祖安设置_zuanemotion']) {
                        return;
                    }
                    if (!this.throwEmotion) {
                        return;
                    }
                    if (tar === 'friend') {
                        tar = game.filterPlayer(function(current) {
                            return current != this && get.attitude(current, this) > 0 && get.attitude(this, current) > 0;
                        });
                    } else if (tar === 'enemy') {
                        tar = game.filterPlayer(function(current) {
                            return current != this && get.attitude(current, this) < 0 && get.attitude(this, current) < 0;
                        });
                    } else if (!Array.isArray(tar)) { //判断是否为数组
                        tar = [tar];
                    }
                    tar.randomSort();
                    for (var p of tar) {
                        if (Math.random() <= rate) {
                            p.throwEmotion(this, 'flower');
                        }
                    }
                };

                lib.element.player.zuanHateMe = function(tar, rate) {
                    if (!rate) {
                        rate = 1;
                    }
                    if (!lib.config['extension_祖安设置_zuanemotion']) {
                        return;
                    }
                    if (!this.throwEmotion) {
                        return;
                    }
                    if (tar === 'friend') {
                        tar = game.filterPlayer(function(current) {
                            return current != this && get.attitude(current, this) > 0 && get.attitude(this, current) > 0;
                        });
                    } else if (tar === 'enemy') {
                        tar = game.filterPlayer(function(current) {
                            return current != this && get.attitude(current, this) < 0 && get.attitude(this, current) < 0;
                        });
                    } else if (!Array.isArray(tar)) {
                        tar = [tar];
                    }
                    tar.randomSort();
                    for (var p of tar) {
                        if (Math.random() <= rate) {
                            p.throwEmotion(this, ['egg', 'shoe'].randomGet());
                        }
                    }
                };
                lib.skill._zuan_sendWine = {
                    forced: true,
                    popup: false,
                    priority: -45,
                    trigger: {
                        global: ['phaseUseBegin', 'useCard'],
                    },
                    filter: function(event, player) {
                        if (event.name == 'useCard') {
                            if (event.card.name != 'jiu') return false;
                            if (event.player.hp == 1) return false;
                            if (event.player == player) return false;
                            //if(player.isUnderControl(true))return false;
                            if (game.isMine(player)) return false;
                            if (event.player.hp <= 0) return false;
                            return lib.config['extension_祖安设置_zuanemotion'] && get.attitude(player, event.player) > 0 && get.attitude(event.player, player) > 0;
                        }
                        return get.attitude(player, event.player) > 0 && get.attitude(event.player, player) > 0 && event.player.countCards('h') > 5 && lib.config['extension_祖安设置_zuanemotion'] && !player.isUnderControl(true) && player.throwEmotion;
                    },
                    content: function() {
                        if (trigger.name == 'useCard') {
                            if (Math.random() > 0.3) {
                                player.throwEmotion(trigger.player, 'wine');
                            }
                            return;
                        }
                        if (Math.random() < trigger.player.countCards('h') / 15 && trigger.player != player) {
                            player.throwEmotion(trigger.player, 'wine');
                        }
                    }
                };
                lib.skill._zuan_damageSendEgg = {
                    forced: true,
                    popup: false,
                    priority: -998,
                    trigger: {
                        player: 'damageSource',
                    },
                    filter: function(event, player) {
                        return ! player.hasSkillTag('maixie') && !player.hasSkillTag('maixie_hp') && event.source && get.attitude(player, event.source) > 0 && lib.config['extension_祖安设置_zuanemotion'] && !game.isMine(player)
                        /*!player.isUnderControl(true)*/
                        && player.throwEmotion;
                    },
                    content: function() {
                        'step 0';
                        if (Math.random() > 0.5) {
                            player.throwEmotion(trigger.source, ['shoe', 'egg'].randomGet());
                        }
                    }
                };
                lib.skill._zuan_damageSendFlower = {
                    forced: true,
                    popup: false,
                    priority: -3,
                    trigger: {
                        global: 'damageSource',
                    },
                    filter: function(event, player) {
                        return event.source && event.num > 1 && get.attitude(player, event.player) < 0 && get.attitude(player, event.source) > 0 && lib.config['extension_祖安设置_zuanemotion'] && !game.isMine(player)
                        /*!player.isUnderControl(true)*/
                        && player.throwEmotion;
                    },
                    content: function() {
                        'step 0';
                        if (Math.random() > 1 / trigger.num && trigger.source != player) {
                            player.throwEmotion(trigger.source, 'flower');
                        }
                    }
                };
                lib.skill._zuan_killSendFlower = {
                    forced: true,
                    popup: false,
                    priority: -23,
                    trigger: {
                        global: 'dieBegin',
                    },
                    filter: function(event, player) {
                        return get.attitude(player, event.player) < 0 && lib.config['extension_祖安设置_zuanemotion'] && !game.isMine(player)
                        /*!player.isUnderControl(true)*/
                        && player.throwEmotion;
                    },
                    content: function() {
                        'step 0';
                        event.killer = event.source;
                        if (!event.killer || get.attitude(player, event.killer) <= 0) {
                            var evt = trigger.getParent(3);
                            event.killer = evt.player;
                        }
                        if (event.killer && event.killer != player && get.attitude(player, event.killer) > 0) {
                            if (Math.random() > 0.2) {
                                player.throwEmotion(event.killer, 'flower');
                            }
                        }
                    }
                };
            }

            // ---------------------------------------游戏音效------------------------------------------//
            //if(false) {
            lib.skill._extraphaseskill = { //回合开始音效//
                trigger: {
                    player: ["phaseBefore"],
                },
                forced: true,
                filter: function(event) {
                    return (parseFloat(lib.config['extension_祖安设置_audio']) >= '4');
                },
                content: function() {
                    var cho = parseFloat(lib.config['extension_祖安设置_audio']);
                    if (cho == '4') {
                        var verson = 'shousha';
                    } else {
                        var verson = 'ten';
                    }
                    game.playAudio('..', 'extension', '祖安武将', 'audio', verson, 'phase.mp3');
                },
            }
            lib.skill._extradieskill = { //死亡音效//
                trigger: {
                    player: ["die"],
                },
                forced: true,
                filter: function(event) {
                    return (parseFloat(lib.config['extension_祖安设置_audio']) >= '4');
                },
                content: function() {
                    var cho = parseFloat(lib.config['extension_祖安设置_audio']);
                    if (cho == '4') {
                        var verson = 'shousha';
                    } else {
                        var verson = 'ten';
                    }
                    game.playAudio('..', 'extension', '祖安武将', 'audio', verson, 'die.mp3');
                },
            }
            lib.skill._extraturnoverskill = { //翻面音效//
                trigger: {
                    player: ["trunOverBefore"],
                },
                forced: true,
                filter: function(event) {
                    return (parseFloat(lib.config['extension_祖安设置_audio']) >= '4');
                },
                content: function() {
                    var cho = parseFloat(lib.config['extension_祖安设置_audio']);
                    if (cho == '4') {
                        var verson = 'shousha';
                    } else {
                        var verson = 'ten';
                    }
                    game.playAudio('..', 'extension', '祖安武将', 'audio', verson, 'turnover.mp3');
                },
            }
            lib.skill._extradamageskill = { //伤害音效//语音重复了暂时屏蔽
                trigger: {
                    player: ["damageBefore"],
                },
                forced: true,
                filter: function(event) {
                    return false;
                    //return (parseFloat(lib.config['extension_祖安设置_audio'])>='4'); 
                },
                content: function() {
                    var cho = parseFloat(lib.config['extension_祖安设置_audio']);
                    if (cho == '4') {
                        var verson = 'shousha';
                    } else {
                        var verson = 'ten';
                    }
                    if (!trigger.nature) {
                        var nature = '_basic';
                    } else {
                        var nature = '_' + trigger.nature;
                    }
                    game.playAudio('..', 'extension', '祖安武将', 'audio', verson, 'damage' + nature + '.mp3');
                },
            }
            lib.skill._extradlosehpskill = { //流失音效//语音重复了暂时屏蔽
                trigger: {
                    player: ["loseHpBefore"],
                },
                forced: true,
                filter: function(event) {
                    return false;
                    //return (parseFloat(lib.config['extension_祖安设置_audio'])>='4'); 
                },
                content: function() {
                    var cho = parseFloat(lib.config['extension_祖安设置_audio']);
                    if (cho == '4') {
                        var verson = 'shousha';
                    } else {
                        var verson = 'ten';
                    }
                    game.playAudio('..', 'extension', '祖安武将', 'audio', verson, 'damage_water.mp3');
                },
            }
            lib.skill._extraloseskill = { //移出游戏音效//
                trigger: {
                    player: ["loseAfter", "addCardToStorage", "loseAsyncAfter"],
                },
                filter: function(event, player, name) {
                    if (name != 'addCardToStorage' && !event.toStorage) return false;
                    return (parseFloat(lib.config['extension_祖安设置_audio']) >= '4');
                },
                forced: true,
                content: function() {
                    var cho = parseFloat(lib.config['extension_祖安设置_audio']);
                    if (cho == '4') {
                        var verson = 'shousha';
                    } else {
                        var verson = 'ten';
                    }
                    game.playAudio('..', 'extension', '祖安武将', 'audio', verson, 'common.mp3');
                },
            }
            lib.skill._extragainskill = { //获得牌音效//
                trigger: {
                    player: ["gainBefore"
                    /*,"loseBefore"*/
                    ],
                },
                forced: true,
                filter: function(event) {
                    if (lib.config['extension_祖安设置_audio_draw']) return false;
                    if (name == 'addCardToStorage' || event.toStorage == true) return false;
                    return (parseFloat(lib.config['extension_祖安设置_audio']) >= '4');
                },
                content: function() {
                    var cho = parseFloat(lib.config['extension_祖安设置_audio']);
                    if (cho == '4') {
                        var verson = 'shousha';
                    } else {
                        var verson = 'ten';
                    }
                    game.playAudio('..', 'extension', '祖安武将', 'audio', verson, 'draw.mp3');
                },
            }
            lib.skill._extraloseCardskill = { //消失牌音效//
                trigger: {
                    player: [
                    /*"gainBefore",*/
                    "loseBefore"],
                },
                forced: true,
                filter: function(event) {
                    if (lib.config['extension_祖安设置_audio_draw']) return false;
                    if (name == 'addCardToStorage' || event.toStorage == true) return false;
                    return (parseFloat(lib.config['extension_祖安设置_audio']) >= '4');
                },
                content: function() {
                    var cho = parseFloat(lib.config['extension_祖安设置_audio']);
                    if (cho == '4') {
                        var verson = 'shousha';
                    } else {
                        var verson = 'ten';
                    }
                    game.playAudio('..', 'extension', '祖安武将', 'audio', verson, 'lose.mp3');
                },
            }
            lib.skill._extracompareskill = { //拼点音效//
                trigger: {
                    player: ["chooseToCompareBefore"],
                },
                forced: true,
                filter: function(event) {
                    return (parseFloat(lib.config['extension_祖安设置_audio']) >= '4');
                },
                content: function() {
                    var verson = '_ten';
                    var cho = parseFloat(lib.config['extension_祖安设置_audio']);
                    if (cho == '4') game.playAudio('..', 'extension', '祖安武将', 'audio', 'shousha', 'compare.mp3');
                    if (cho == '5') game.playAudio('..', 'extension', '祖安武将', 'audio', 'ten', 'compare.mp3');
                },
            }
            lib.skill._extrauseskill = { //用牌音效//
                trigger: {
                    player: ["useCardBefore", "respondBefore"],
                },
                forced: true,
                filter: function(event) {
                    if (lib.config['extension_祖安设置_audio_draw']) return false;
                    return (parseFloat(lib.config['extension_祖安设置_audio']) >= '4');
                },
                content: function() {
                    var cho = parseFloat(lib.config['extension_祖安设置_audio']);
                    if (cho == '4') {
                        var verson = 'shousha';
                    } else {
                        var verson = 'ten';
                    }
                    game.playAudio('..', 'extension', '祖安武将', 'audio', verson, 'use.mp3');
                },
            }
            lib.skill._extrajudgeskill = { //判定音效//
                trigger: {
                    player: ["judgeBefore"],
                },
                forced: true,
                filter: function(event) {
                    return (parseFloat(lib.config['extension_祖安设置_audio']) >= '4');
                },
                content: function() {
                    var cho = parseFloat(lib.config['extension_祖安设置_audio']);
                    if (cho == '4') {
                        var verson = 'shousha';
                    } else {
                        var verson = 'ten';
                    }
                    game.playAudio('..', 'extension', '祖安武将', 'audio', verson, 'judge.mp3');
                },
            }
            lib.skill._extralinkskill = { //横置音效//
                trigger: {
                    player: ["linkBefore"],
                },
                forced: true,
                filter: function(event) {
                    return (parseFloat(lib.config['extension_祖安设置_audio']) >= '4');
                },
                content: function() {
                    var cho = parseFloat(lib.config['extension_祖安设置_audio']);
                    if (cho == '4') {
                        var verson = 'shousha';
                    } else {
                        var verson = 'ten';
                    }
                    if (player.isLinked) {
                        var during = '_false';
                    } else {
                        var during = '_true';
                    }
                    game.playAudio('..', 'extension', '祖安武将', 'audio', verson, 'link' + during + '.mp3');
                },
            }
            //}
            // ---------------------------------------游戏音效------------------------------------------//
            if (parseFloat(lib.config['extension_祖安设置_audio']) <= '3') {
                lib.skill._comparesayskill = {
                    trigger: {
                        player: ["chooseToCompareBefore"],
                    },
                    forced: true,
                    filter: function(event) {
                        return (parseFloat(lib.config['extension_祖安设置_audio']) >= '2');
                    },
                    content: function() {
                        game.playAudio('..', 'extension', '祖安武将', 'audio', 'compare.ogg');
                    },
                }
                lib.skill._equipuseskill = {
                    trigger: {
                        player: ["useCard"],
                    },
                    forced: true,
                    filter: function(event) {
                        return (get.type(event.card) == 'equip' && parseFloat(lib.config['extension_祖安设置_audio']) >= '3');
                    },
                    content: function() {
                        game.playAudio('..', 'extension', '祖安武将', 'audio', 'pdd_equip.mp3');
                    },
                }
                lib.skill._damsayskill = {
                    trigger: {
                        player: ["damageBegin"],
                    },
                    forced: true,
                    filter: function(event) {
                        return (parseFloat(lib.config['extension_祖安设置_audio']) >= '3');
                    },
                    content: function() {
                        game.playAudio('..', 'extension', '祖安武将', 'audio', 'lbw_damage.mp3');
                    },
                }
                lib.skill._saveskill = {
                    trigger: {
                        player: ["dying"],
                    },
                    forced: true,
                    filter: function(event) {
                        return (parseFloat(lib.config['extension_祖安设置_audio']) >= '3');
                    },
                    content: function() {
                        game.playAudio('..', 'extension', '祖安武将', 'audio', 'pdd_save.mp3');
                    },
                }
                lib.skill._dieskill = {
                    trigger: {
                        player: ["die"],
                    },
                    forced: true,
                    filter: function(event) {
                        return (get.type(event.card) == 'equip' && parseFloat(lib.config['extension_祖安设置_audio']) >= '3');
                    },
                    content: function() {
                        game.playAudio('..', 'extension', '祖安武将', 'audio', 'lyl_die.mp3');
                    },
                }
                lib.skill._shanskill = {
                    trigger: {
                        player: ["respond"],
                    },
                    forced: true,
                    filter: function(event) {
                        return (event.card.name == 'equip' && parseFloat(lib.config['extension_祖安设置_audio']) >= '3');
                    },
                    content: function() {
                        game.playAudio('..', 'extension', '祖安武将', 'audio', 'pdd_shan.mp3');
                    },
                }
                lib.skill._useCardsayskill = {
                    trigger: {
                        player: ["useCard"],
                    },
                    forced: true,
                    filter: function(event) {
                        return (parseFloat(lib.config['extension_祖安设置_audio']) >= '2');
                    },
                    content: function() {
                        if (parseFloat(lib.config['extension_祖安设置_audio']) >= '2') game.playAudio('..', 'extension', '祖安武将', 'audio', 'use.mp3');
                        if (parseFloat(lib.config['extension_祖安设置_audio']) >= '3') {
                            if (get.name(trigger.card) == 'sha') {
                                game.playAudio('..', 'extension', '祖安武将', 'audio', 'lyl_sha.mp3');
                            }
                            if (get.name(trigger.card) == 'juedou') {
                                game.playAudio('..', 'extension', '祖安武将', 'audio', 'pdd_sha.mp3');
                            }
                            if (get.name(trigger.card) == 'guohe') {
                                game.playAudio('..', 'extension', '祖安武将', 'audio', 'pdd_guohe.mp3');
                            }
                            if (get.name(trigger.card) == 'wuxie') {
                                game.playAudio('..', 'extension', '祖安武将', 'audio', 'lyl_wuxie.mp3');
                            }
                            if (get.name(trigger.card) == 'nanman') {
                                game.playAudio('..', 'extension', '祖安武将', 'audio', 'pdd_wanjian.mp3');
                            }
                            if (get.name(trigger.card) == 'wanjian') {
                                game.playAudio('..', 'extension', '祖安武将', 'audio', 'lbw_wanjian.mp3');
                            }
                            if (get.name(trigger.card) == 'tao') {
                                game.playAudio('..', 'extension', '祖安武将', 'audio', 'pdd_tao.mp3');
                            }
                            if (get.name(trigger.card) == 'jiedao') {
                                game.playAudio('..', 'extension', '祖安武将', 'audio', 'lbw_jiedao.mp3');
                            }
                            if (get.name(trigger.card) == 'shunshou') {
                                game.playAudio('..', 'extension', '祖安武将', 'audio', 'pdd_shunshou.mp3');
                            }
                            if (get.name(trigger.card) == 'taoyuan') {
                                game.playAudio('..', 'extension', '祖安武将', 'audio', 'lbw_wugu.mp3');
                            }
                            if (get.name(trigger.card) == 'wugu') {
                                game.playAudio('..', 'extension', '祖安武将', 'audio', 'lyl_wugu.mp3');
                            }
                            if (get.name(trigger.card) == 'wuzhong') {
                                game.playAudio('..', 'extension', '祖安武将', 'audio', 'lbw_draw.mp3');
                            }
                            if (get.name(trigger.card) == 'jiu') {
                                game.playAudio('..', 'extension', '祖安武将', 'audio', 'lyl_jiu.mp3');
                            }
                            if (get.name(trigger.card) == 'huogong') {
                                game.playAudio('..', 'extension', '祖安武将', 'audio', 'lbw_jiu.mp3');
                            }
                            if (get.name(trigger.card) == 'tiesuo') {
                                game.playAudio('..', 'extension', '祖安武将', 'audio', 'lbw_jiu.mp3');
                            }
                        }
                    },
                }
                lib.skill._phasebeginskill = {
                    trigger: {
                        player: ["phaseBegin"],
                    },
                    forced: true,
                    filter: function(event) {
                        return (parseFloat(lib.config['extension_祖安设置_audio']) >= '2');
                    },
                    content: function() {
                        if (parseFloat(lib.config['extension_祖安设置_audio']) >= '3') {
                            game.playAudio('..', 'extension', '祖安武将', 'audio', 'lbw_phase.mp3');
                        } else {
                            game.playAudio('..', 'extension', '祖安武将', 'audio', 'phase.mp3');
                        }
                    },
                }
                lib.skill._phaseendskill = {
                    trigger: {
                        player: ["phaseEnd"],
                    },
                    forced: true,
                    filter: function(event) {
                        return (parseFloat(lib.config['extension_祖安设置_audio']) >= '2');
                    },
                    content: function() {
                        if (parseFloat(lib.config['extension_祖安设置_audio']) >= '3') {
                            game.playAudio('..', 'extension', '祖安武将', 'audio', 'lbw_end.mp3');
                        } else {
                            game.playAudio('..', 'extension', '祖安武将', 'audio', 'end.ogg');
                        }
                    },
                }
                lib.skill._judgeskill = {
                    trigger: {
                        player: ["judgeBegin"],
                    },
                    forced: true,
                    filter: function(event) {
                        return (parseFloat(lib.config['extension_祖安设置_audio']) >= '2');
                    },
                    content: function() {
                        game.playAudio('..', 'extension', '祖安武将', 'audio', 'judge.ogg');
                    },
                }
                lib.skill._linkskill = {
                    trigger: {
                        player: ["linkAfter"],
                    },
                    forced: true,
                    filter: function(event) {
                        return (parseFloat(lib.config['extension_祖安设置_audio']) >= '2');
                    },
                    content: function() {
                        game.playAudio('..', 'extension', '祖安武将', 'audio', 'link.ogg');
                    },
                }
            }

            // ---------------------------------------整理手牌------------------------------------------//
            if (lib.config.extension_祖安设置_washhandcard) {
                var choice = lib.config.extension_祖安设置_washhandcard;
                if (choice != "close") {
                    var con = function() {
                        "step 0";
                        /*var cards = player.getCards("h");
                        game.addVideo('lose', player, [get.cardsInfo(cards), [],
                            []
                        ]);
                        for (var i = 0; i < cards.length; i++) {
                            cards[i].goto(ui.special);
                        }
                        cards.sort(function(a, b) {
                            return -lib.sort[player.useCard2 ? "rd_duel" : "card2"](a, b);
                        });
                        player.directgain(cards, false);*/
                        var cards = game.me.getCards("hs");
                        var sort2 = function(b, a) {
                            if (a.name != b.name) return lib.sort.card(a.name, b.name);
                            else if (a.suit != b.suit) return lib.suit.indexOf(a) - lib.suit.indexOf(b);
                            else return a.number - b.number;
                        };
                        if (cards.length > 1) {
                            cards.sort(sort2);
                            cards.forEach(function(i, j) {
                                game.me.node.handcards1.insertBefore(cards[j], game.me.node.handcards1.firstChild);
                            });
                            if (typeof(dui) != 'undefined') {
                                dui.queueNextFrameTick(dui.layoutHand, dui);
                            } else {
                                var hs = game.me.getCards('h');
                                game.addVideo('lose', event.target, [get.cardsInfo(hs), [], [], []]);
                                for (var i = 0; i < hs.length; i++) {
                                    hs[i].discard(false);
                                }
                                game.me.directgain(cards);
                            }
                        }
                    };
                    var fil = function(event, player) {
                        if (player == game.me && player.countCards("hs")) {
                            /*
                            var j = function(a, b) {
                                var n1 = a.length;
                                var n2 = b.length;
                                if (n1 != n2) return 0;
                                for (var i = 0; i < n1; i++) {
                                    if (a[i] != b[i]) return 0;
                                }
                                return 1;
                            };
                            var cards = player.getCards("h");
                            var ca = cards.slice(0);
                            ca.sort(function(a, b) {
                                return lib.sort[player.useCard2 ? "rd_duel" : "card2"](a, b);
                            });
                            return j(ca, cards) != 1;
                            */

                            var cards = game.me.getCards("hs");
                            var sort2 = function(b, a) {
                                if (a.name != b.name) return lib.sort.card(a.name, b.name);
                                else if (a.suit != b.suit) return lib.suit.indexOf(a) - lib.suit.indexOf(b);
                                else return a.number - b.number;
                            };
                            if (cards.length > 1) {
                                if (cards == sort2) return false;
                                return true;
                            }
                            return false;
                        }
                    };
                    lib.sort.card2 = function(a, b) {
                        if (a.name != b.name) return lib.sort.card(a.name, b.name);
                        else if (a.suit != b.suit) return lib.suit.indexOf(a.suit) - lib.suit.indexOf(b.suit);
                        else if (a.number != b.number) return a.number - b.number;
                        else if (a.nature != b.nature) return a.nature - b.nature;
                        else return parseInt(a.cardid) - parseInt(b.cardid);
                    };
                    lib.skill._zuanwashhandcard = {
                        direct: true,
                        charlotte: true,
                        firstDo: true,
                        priority: Infinity,
                        content: con,
                        filter: fil,
                    };
                    if (choice == "auto") lib.skill._zuanwashhandcard.trigger = {
                        player: ["gainAfter", "loseAfter"]
                    };
                    else if (choice == "user") lib.skill._zuanwashhandcard.enable = "phaseUse";
                    lib.translate._zuanwashhandcard = "整理";
                };
            }

            // ---------------------------------------边框美化------------------------------------------//
            if (parseFloat(lib.config['extension_祖安设置_biankuang']) != '0' || parseFloat(lib.config['extension_祖安设置_qiankuang']) != '0') {
                lib.skill._newbiankuang = {
                    trigger: {
                        global: ['gameDrawBefore'],
                        player: "enterGame",
                    },
                    direct: true,
                    priority: 15,
                    filter: function(event, player) {
                        if (game.haszZUANbiankuang) return false;
                        return player == game.me;
                    },
                    content: function() {
                        'step 0';
                        game.haszZUANbiankuang = true;
                        // ---------------------------------------背景------------------------------------------//
                        event.count = 0;
                        event.background = 'none';
                        if (parseFloat(lib.config['extension_祖安设置_biankuang']) == '1') {
                            event.back = 'guozhan';
                            if (player.group == 'wei' || player.group == 'jin') event.back = 'xuanwu';
                            if (player.group == 'shu') event.back = 'zhuque';
                            if (player.group == 'wu') event.back = 'qinglong';
                            if (player.group == 'qun' || player.group == 'xi') event.back = 'baihu';
                        } //bbkuang
                        if (parseFloat(lib.config['extension_祖安设置_biankuang']) == '2') event.back = ['qinglong', 'baihu', 'zhuque', 'xuanwu'].randomGet();
                        if (parseFloat(lib.config['extension_祖安设置_biankuang']) == '3') event.back = 'zhulu';
                        if (parseFloat(lib.config['extension_祖安设置_biankuang']) == '4') event.back = 'guozhan';
                        if (parseFloat(lib.config['extension_祖安设置_biankuang']) == '5') event.back = 'black';
                        if (parseFloat(lib.config['extension_祖安设置_biankuang']) == '6') event.back = 'seatotem';
                        if (parseFloat(lib.config['extension_祖安设置_biankuang']) == '7') event.back = 'flowertotem';
                        if (parseFloat(lib.config['extension_祖安设置_biankuang']) == '8') event.back = 'goldtotem';
                        if (parseFloat(lib.config['extension_祖安设置_biankuang']) == '9') event.back = 'plus_war';
                        if (parseFloat(lib.config['extension_祖安设置_biankuang']) == '10') event.back = 'plus_sand';
                        if (parseFloat(lib.config['extension_祖安设置_biankuang']) == '11') event.back = 'plus_blood';
                        event.biankuang = "extension/祖安武将/handcard/Handcard_background_" + event.back + '.png';
                        //event.biankuang='extension/祖安武将/handcard/Handcard_background.png';
                        // ---------------------------------------前景------------------------------------------//
                        event.cover = 'none';
                        if (parseFloat(lib.config['extension_祖安设置_qiankuang']) == '1') event.cover = ['donghai', 'beimo', 'tianshan'].randomGet();
                        if (parseFloat(lib.config['extension_祖安设置_qiankuang']) == '2') event.cover = 'donghai';
                        if (parseFloat(lib.config['extension_祖安设置_qiankuang']) == '3') event.cover = 'beimo';
                        if (parseFloat(lib.config['extension_祖安设置_qiankuang']) == '4') event.cover = 'tianshan';
                        event.qiankuang = "extension/祖安武将/handcard/Handcard_cover_" + event.cover + '.png';

                        if (parseFloat(lib.config['extension_祖安设置_isPC']) == '1') {
                            event.width = 617;
                            event.height = 128;
                            event.top = 380;
                            event.left = 165;
                            event.lefts = event.width * 0.5 + 40;
                            event.bottom = 6;
                        }
                        if (parseFloat(lib.config['extension_祖安设置_isPC']) == '2') {
                            event.width = 582;
                            event.height = 120;
                            event.top = 490;
                            event.left = 160;
                            event.lefts = event.width * 0.5 + 20;
                            event.bottom = 8;
                        }
                        if (parseFloat(lib.config['extension_祖安设置_isPC']) == '3') {
                            event.width = 882;
                            event.height = 128;
                            event.top = 500;
                            event.left = 160;
                            event.lefts = event.width * 0.5 + 30;
                            event.bottom = 8;
                        }

                        'step 1';
                        event.count++;
                        var windows = localStorage.getItem("zuanwindow");
                        if (parseFloat(lib.config['extension_祖安设置_isPC']) == '1') {
                            //手机 95%
                            //卡牌背景
                            if (parseFloat(lib.config['extension_祖安设置_biankuang']) != '0') {
                                if (event.biankuangs) event.biankuangs.remove();
                                event.biankuangs = ui.create.node('img');
                                event.biankuangs.src = lib.assetURL + event.biankuang;
                                //if(!['black','seatotem','flowertotem'].contains(event.back)) {//bbkuang
                                if (parseFloat(lib.config['extension_祖安设置_biankuang']) <= 4) {
                                    event.biankuangs.style.cssText = 'pointer-events: none;opacity: ' + 0.08 * event.count * 0.2 + ';display: block;width: 75.5%;height: 29%;position: absolute;bottom: 0.5%;left: 8.3%;background:none;z-index:-1;margin: 0 0 0 0';
                                } else {
                                    if (event.back.indexOf('plus_') == -1) {
                                        var btbase = -17.5;
                                        var opas = 0.08;
                                    } else {
                                        var btbase = 0;
                                        var opas = 0.1;
                                    }
                                    event.biankuangs.style.cssText = 'pointer-events: none;opacity: ' + opas * event.count * 0.2 + ';display: block;width: 100%;position: absolute;bottom: ' + (btbase + 2 * (event.count * 0.2 - 10)) + '%;left: 0%;background:none;z-index:-1;margin: 0 0 0 0';
                                }
                                document.body.appendChild(event.biankuangs);
                            }
                            //卡牌层景
                            if (parseFloat(lib.config['extension_祖安设置_qiankuang']) != '0') {
                                if (event.qiankuangs) event.qiankuangs.remove();
                                event.qiankuangs = ui.create.node('img');
                                event.qiankuangs.src = lib.assetURL + event.qiankuang;
                                event.qiankuangs.style.cssText = 'pointer-events: none;opacity: ' + 0.08 * event.count * 0.2 + ';display: block;width: 75.5%;height: 29%;position: absolute;bottom: 0.5%;left: 8.3%;background:none;z-index:4;margin: 0 0 0 0';
                                document.body.appendChild(event.qiankuangs);
                            }
                        } else if (parseFloat(lib.config['extension_祖安设置_isPC']) == '2') {
                            //手机 模拟 80%
                            //卡牌背景
                            if (parseFloat(lib.config['extension_祖安设置_biankuang']) != '0') {
                                if (event.biankuangs) event.biankuangs.remove();
                                event.biankuangs = ui.create.node('img');
                                event.biankuangs.src = lib.assetURL + event.biankuang;
                                event.biankuangs.style.cssText = 'pointer-events: none;opacity: ' + 0.08 * event.count * 0.2 + ';display: block;width: 73.5%;height: 24%;position: absolute;bottom: 0.5%;left: 6%;background:none;z-index:-1;margin: 0 0 0 0';
                                document.body.appendChild(event.biankuangs);
                            }
                            //卡牌层景
                            if (parseFloat(lib.config['extension_祖安设置_qiankuang']) != '0') {
                                if (event.qiankuangs) event.qiankuangs.remove();
                                event.qiankuangs = ui.create.node('img');
                                event.qiankuangs.src = lib.assetURL + event.qiankuang;
                                event.qiankuangs.style.cssText = 'pointer-events: none;opacity: ' + 0.08 * event.count * 0.2 + ';display: block;width: 73.5%;height: 24%;position: absolute;bottom: 0.5%;left: 6%;background:none;z-index:4;margin: 0 0 0 0';
                                document.body.appendChild(event.qiankuangs);
                            }
                        } else {
                            //电脑 大 120%
                            //卡牌背景
                            if (parseFloat(lib.config['extension_祖安设置_biankuang']) != '0') {
                                if (event.biankuangs) event.biankuangs.remove();
                                event.biankuangs = ui.create.node('img');
                                event.biankuangs.src = lib.assetURL + event.biankuang;
                                //if(!['black','seatotem','flowertotem'].contains(event.back)) {//bbkuang
                                if (parseFloat(lib.config['extension_祖安设置_biankuang']) <= 4) {
                                    event.biankuangs.style.cssText = 'pointer-events: none;opacity: ' + 0.08 * event.count * 0.2 + ';display: block;width: 73.5%;height: 24%;position: absolute;bottom: 0.5%;left: 7%;background:none;z-index:-1;margin: 0 0 0 0';
                                } else {
                                    if (event.back.indexOf('plus_') == -1) {
                                        var btbase = -18;
                                        var opas = 0.08;
                                    } else {
                                        var btbase = 0;
                                        var opas = 0.1;
                                    }
                                    event.biankuangs.style.cssText = 'pointer-events: none;opacity: ' + opas * event.count * 0.2 + ';display: block;width: 100%;position: absolute;bottom: ' + (btbase + 2 * (event.count * 0.2 - 10)) + '%;left: 0%;background:none;z-index:-1;margin: 0 0 0 0';
                                }
                                document.body.appendChild(event.biankuangs);
                            }
                            //卡牌层景
                            if (parseFloat(lib.config['extension_祖安设置_qiankuang']) != '0') {
                                if (event.qiankuangs) event.qiankuangs.remove();
                                event.qiankuangs = ui.create.node('img');
                                event.qiankuangs.src = lib.assetURL + event.qiankuang;
                                event.qiankuangs.style.cssText = 'pointer-events: none;opacity: ' + 0.08 * event.count * 0.2 + ';display: block;width: 73.5%;height: 24%;position: absolute;bottom: 0.5%;left: 7%;background:none;z-index:4;margin: 0 0 0 0';
                                document.body.appendChild(event.qiankuangs);
                            }
                        }
                        'step 2';
                        if (event.count < 50) {
                            game.delay(0.01);
                            event.goto(1);
                        }
                    },
                }
            }
            // ---------------------------------------清空背景------------------------------------------//
            /*已经不需要
		    if(parseFloat(lib.config['extension_祖安设置_bizhi'])!='1'&&parseFloat(lib.config['extension_祖安设置_wallpaper'])!='1'&&!lib.config['extension_祖安设置_exwallpaper']) {
		    lib.skill._clearBackground={
		                            trigger:{
		                                global:['gameDrawAfter'],
		                                player:"enterGame",
		                            },
		                            direct:true,
		                            priority:25,
		                filter:function(event,player){
		                var off=lib.config['extension_祖安设置_helasisy'];
		                    if(off&&lib.config.coin&&lib.config.coin>=20) {
		                return parseFloat(lib.config['extension_祖安设置_bizhi'])!='1';
		                        }
		                },
		                            content:function(){
		    ui.background.style.backgroundImage=lib.config.standardbackground;
		                                },
		                        }
		                    }
		    */
            if (lib.config['extension_祖安设置_perspective']) {
                var getCenterPos = function(node, pos) {
                    let item = {
                        'left': ['left', 'width'],
                        'right': ['right', 'width'],
                        'top': ['top', 'height'],
                        'bottom': ['bottom', 'height']
                    };
                    return get.currentStyle(node, item[pos][1]).slice(0, -2) * 0.5 + get.currentStyle(node, item[pos][0]).slice(0, -2) * 1;
                }
                var calculateDistance = function(player) {
                    var centural = ui.arena;
                    var leftF = get.currentStyle(centural, 'width').slice(0, -2) * 0.5;
                    var bottomF = get.currentStyle(centural, 'height').slice(0, -2) * 0.5;
                    var leftT = getCenterPos(player, 'left');
                    var bottomT = getCenterPos(player, 'bottom');

                    //return Math.sqrt(Math.pow(leftF - Math.abs(leftF - leftT), 2) + Math.pow(bottomF - bottomT, 2));;
                    return Math.sqrt(Math.pow(leftF - 60, 2) - Math.pow(leftF - leftT, 2) + Math.pow(bottomF - bottomT, 2));
                }
                game.createCss(`.smoothScale {
                    transition: all 0.5s ease,
                    scale 0.25s;
                }`);
                var perspectiveUI = function() {
                    var allPlayers = game.players.concat(game.dead);
                    allPlayers.forEach(player =>{
                        if (get.currentStyle(player, 'bottom').slice(0, -2) < (get.currentStyle(ui.arena, 'height').slice(0, -2) * 0.05)) return;
                        if (get.currentStyle(player, 'transition').indexOf('scale') == -1) {
                            player.classList.add('smoothScale');
                        }
                        player.style.scale = Math.max(1200 - calculateDistance(player), 100) / 1200;
                        //player.style.transform = 'scale(' +Math.max(1200 - calculateDistance(player), 100) / 1200 + ')';
                        if (!player.hasObsLeft) {
                            player.hasObsLeft = true;
                            observeLeftChange(player, perspectiveUI);
                        }
                    });
                }
                var observeLeftChange = function(node, func) {
                    let lastLeft = node.style.left;
                    const observer = new MutationObserver(function(mutations) {
                        mutations.forEach(function(mutation) {
                            if (mutation.attributeName === 'style') {
                                const newLeft = node.style.left;
                                if (newLeft !== lastLeft) {
                                    lastLeft = newLeft;
                                    func();
                                }
                            }
                        });
                    });
                    observer.observe(node, {
                        attributes: true
                    });
                }
                //ui.update = game.wrapFunction(ui.update, perspectiveUI);
                var rewriteFunc = function() {
                    var updateFamily = ['update', 'updatez', 'updated', 'updatehx', 'updateh', 'updatehl', 'updatej', 'updatem', 'updatejm', 'updatexr', 'updatex'];
                    updateFamily.forEach(update =>{
                        ui[update] = game.wrapFunction(ui[update], perspectiveUI);
                    });
                    //ui.update = game.wrapFunction(ui.update, perspectiveUI);
                    game.swapSeat = game.wrapFunction(game.swapSeat, () =>{
                        setTimeout(() =>{
                            perspectiveUI();
                            setTimeout(() =>{
                                perspectiveUI();
                            },
                            250);
                        },
                        250);
                    });
                }
                if (lib.arenaReady) {
                    lib.arenaReady.push(rewriteFunc);
                } else {
                    rewriteFunc();
                }
            }
            // ---------------------------------------动态背景------------------------------------------//  
            if (parseFloat(lib.config['extension_祖安设置_wallpaper']) != '1' || lib.config['extension_祖安设置_exwallpaper']) {
                lib.skill._newBackground = {
                    trigger: {
                        player: ['phaseBefore', 'judgeAfter', 'dieAfter'],
                    },
                    direct: true,
                    priority: 20,
                    filter: function(event, player) {
                        return false;
                        if (lib.config.zuanchoose == 'none') return false;
                        if (lib.config['extension_祖安设置_texiao']) {
                            if (parseFloat(lib.config['extension_祖安设置_wallpaper']) == '1' && !lib.config['extension_祖安设置_exwallpaper']) return false;
                            return (player == game.me && event.card && event.card.name);
                        }
                    },
                    content: function() {
                        'step 0';
                        //ui.background.style.backgroundImage=lib.config.standardbackground;
                        if ((parseFloat(lib.config['extension_祖安设置_wallpaper']) != '1' || (lib.config['extension_祖安设置_exwallpaper'] && lib.config.zuanexwallpaper == 'on')) && parseFloat(lib.config['extension_祖安设置_isPC']) != '0') {
                            if (trigger.card.name == 'shandian') game.delay(1);
                            if (trigger.card.name == 'huoshan') game.delay(2.5);
                            if (trigger.card.name == 'hongshui') game.delay(2.5);
                            if (trigger.card.name == 'fulei') game.delay(1);
                        }
                        // ---------------------------------------动态壁纸刷新
                        'step 1';
                        game.broadcastAll() + ui.background.setBackgroundImage(lib.config.zuanbackground);
                        // ---------------------------------------动态壁纸刷新
                    },
                }
                /*已经不需要
                lib.skill._newBackgroundUse={
                    trigger:{
                        player:['useCardToAfter'],
                    },
                    direct:true,
                    priority:-50,
                    filter:function(event,player){
                        return false;
                        if(lib.config.zuanchoose=='none') return false;
                        var tex=lib.config['extension_祖安设置_texiao']; 
                        if(tex) {
                            if(parseFloat(lib.config['extension_祖安设置_isPC'])>='2') return false;
                            if(parseFloat(lib.config['extension_祖安设置_wallpaper'])=='1'&&!lib.config['extension_祖安设置_exwallpaper']) return false;
                            return event.card&&(event.card.name=='shandian'||event.card.name=='huoshan'||event.card.name=='hongshui'||event.card.name=='fulei');
                        }
                    },
                    content:function(){
                        'step 0';
                        ui.background.style.backgroundImage=lib.config.standardbackground;
						// ---------------------------------------动态壁纸刷新
                        'step 1';
                        game.broadcastAll()+ui.background.setBackgroundImage(lib.config.zuanbackground);
						// ---------------------------------------动态壁纸刷新
                    },
                }
                */
                lib.skill._newBackgroundAtart = {
                    trigger: {
                        global: ['gameDrawAfter'],
                        player: "enterGame",
                    },
                    direct: true,
                    priority: 120,
                    filter: function(event, player) {
                        if (parseFloat(lib.config['extension_祖安设置_wallpaper']) == '1' && !lib.config['extension_祖安设置_exwallpaper']) return false;
                        return player == game.me;
                    },
                    content: function() {
                        'step 0';
                        var off = lib.config['extension_祖安设置_helasisy'];
                        if (!off) {
                            game.delay(2.5);
                        }
                        // ---------------------------------------壁纸栏------------------------------------------//
                        'step 1';
                        //ui.background.style.backgroundImage=lib.config.standardbackground;
                        // ---------------------------------------动态壁纸刷新
                        'step 2';
                        // ---------------------------------------动态背景·选定------------------------------------------//
                        var backnum = parseFloat(lib.config['extension_祖安设置_wallpaper']);
                        lib.config.zuanchoose = 'none';
                        if (backnum == '3') {
                            // ---------------------------------------势力风貌·动态
                            event.pack = 'gif_shili';
                            event.groups = ['wei', 'shu', 'wu', 'qun'];
                            if (parseFloat(lib.config['extension_祖安设置_paperchoose']) == '1') {
                                for (var i = 0; i < game.players.length; i++) {
                                    if (game.players[i].identity == 'zhu') {
                                        var group = game.players[i].group;
                                        if (event.groups.includes(group)) lib.config.zuanchoose = group;
                                    }
                                }
                            }
                            if (parseFloat(lib.config['extension_祖安设置_paperchoose']) == '2') {
                                var group = player.group;
                                if (event.groups.includes(group)) lib.config.zuanchoose = group;
                            }
                            if (parseFloat(lib.config['extension_祖安设置_paperchoose']) == '3') {
                                lib.config.zuanchoose = event.groups.randomGet();
                            }
                            // ---------------------------------------壁纸结束
                        }
                        if (backnum == '4') {
                            // ---------------------------------------霓裳羽衣
                            event.pack = 'gif_nichang';
                            event.list = [];
                            for (var i = 1; i < 18; i++) {
                                event.list.push(i);
                            }
                            lib.config.zuanchoose = event.list.randomGet();
                            // ---------------------------------------壁纸结束
                        }
                        if (backnum == '5') {
                            // ---------------------------------------海棠依旧
                            event.pack = 'gif_haitang';
                            event.list = [];
                            for (var i = 1; i < 10; i++) {
                                event.list.push(i);
                            }
                            lib.config.zuanchoose = event.list.randomGet();
                            // ---------------------------------------壁纸结束
                        }
                        if (backnum == '7') {
                            // ---------------------------------------世海壁纸
                            event.pack = 'shihai';
                            event.list = ['bailu', 'chushu', 'dahan', 'dashu', 'guyu', 'hanlu', 'jingzhe', 'lichun', 'lidong', 'liqiu', 'lixia', 'mangzhong', 'qiufen', 'shuangjiang', 'xiaohan', 'xiaoman', 'xiaoshu', 'xiaoxue', 'xiazhi', 'yushui'];
                            lib.config.zuanchoose = event.list.randomGet();
                            // ---------------------------------------壁纸结束
                        }
                        if (backnum == '8') {
                            // ---------------------------------------梦幻壁纸
                            event.pack = 'menghuan';
                            event.list = [];
                            for (var i = 1; i < 98; i++) {
                                event.list.push(i);
                            }
                            lib.config.zuanchoose = event.list.randomGet();
                            // ---------------------------------------壁纸结束
                        }
                        if (backnum == '9') {
                            // ---------------------------------------势力风貌
                            event.pack = 'shili';
                            event.groups = ['wei', 'shu', 'wu', 'qun', 'shen'];
                            if (parseFloat(lib.config['extension_祖安设置_paperchoose']) == '1') {
                                for (var i = 0; i < game.players.length; i++) {
                                    if (game.players[i].identity == 'zhu') {
                                        var group = game.players[i].group;
                                        if (event.groups.includes(group)) lib.config.zuanchoose = group;
                                    }
                                }
                            }
                            if (parseFloat(lib.config['extension_祖安设置_paperchoose']) == '2') {
                                var group = player.group;
                                if (event.groups.includes(group)) lib.config.zuanchoose = group;
                            }
                            if (parseFloat(lib.config['extension_祖安设置_paperchoose']) == '3') {
                                lib.config.zuanchoose = event.groups.randomGet();
                            }
                            // ---------------------------------------壁纸结束
                        }
                        if (backnum == '10') {
                            // ---------------------------------------三分天下
                            event.pack = 'sanfen';
                            event.groups = ['wei', 'shu', 'wu', 'qun', 'jin', 'shen'];
                            if (parseFloat(lib.config['extension_祖安设置_paperchoose']) == '1') {
                                for (var i = 0; i < game.players.length; i++) {
                                    if (game.players[i].identity == 'zhu') {
                                        var group = game.players[i].group;
                                        if (event.groups.includes(group)) lib.config.zuanchoose = group;
                                    }
                                }
                            }
                            if (parseFloat(lib.config['extension_祖安设置_paperchoose']) == '2') {
                                var group = player.group;
                                if (event.groups.includes(group)) lib.config.zuanchoose = group;
                            }
                            if (parseFloat(lib.config['extension_祖安设置_paperchoose']) == '3') {
                                lib.config.zuanchoose = event.groups.randomGet();
                            }
                            // ---------------------------------------壁纸结束
                        }
                        if (backnum == '11') {
                            // ---------------------------------------锦绣山河
                            event.pack = 'jinxiu';
                            event.list = [];
                            for (var i = 1; i < 58; i++) {
                                event.list.push(i);
                            }
                            lib.config.zuanchoose = event.list.randomGet();
                            // ---------------------------------------壁纸结束
                        }
                        if (backnum == '12') {
                            // ---------------------------------------羊皮画卷
                            event.pack = 'yangpi';
                            event.list = [];
                            for (var i = 1; i < 11; i++) {
                                event.list.push(i);
                            }
                            lib.config.zuanchoose = event.list.randomGet();
                            // ---------------------------------------壁纸结束
                        }
                        if (backnum == '13') {
                            // ---------------------------------------OL背景
                            event.pack = 'ol';
                            event.list = [];
                            for (var i = 1; i < 26; i++) {
                                event.list.push(i);
                            }
                            lib.config.zuanchoose = event.list.randomGet();
                            // ---------------------------------------壁纸结束
                        }
                        if (backnum == '14') {
                            // ---------------------------------------决战京城
                            event.pack = 'juezhan';
                            event.list = [];
                            for (var i = 1; i < 17; i++) {
                                event.list.push(i);
                            }
                            lib.config.zuanchoose = event.list.randomGet();
                            // ---------------------------------------壁纸结束
                        }
                        lib.config.zuanbackground = "extension/祖安武将/wallpaper/background/" + event.pack + "/" + lib.config.zuanchoose + ".jpg";
                        if (lib.config['extension_祖安设置_exwallpaper']) {
                            /*if(lib.config.mode=='boss') {
                                var gui=['boss_hundun','boss_qiongqi','boss_taotie','boss_taowu','boss_xiangliu','boss_zhuyan','boss_bifang','boss_yingzhao','boss_nianshou'];
                                var god=['boss_lvbu1','boss_lvbu2','boss_lvbu3','boss_caocao','boss_guojia','boss_zhangchunhua','boss_zhenji','boss_liubei','boss_zhugeliang','boss_huangyueying','boss_pangtong','boss_zhouyu','boss_caiwenji','boss_zhangjiao','boss_zuoci','boss_diaochan','boss_huatuo','boss_dongzhuo','boss_sunce'];
                                for(var i=0;i<game.players.length;i++) {
                                    game.log(game.players[i],game.players[i].identity);
                                    if(game.players[i].identity=='zhu') {
                                        if(gui.includes(game.players[i].name)) {
                                            lib.config.zuanboss="gui";
                                        }
                                        if(god.includes(game.players[i].name)) {
                                            lib.config.zuanboss="god";
                                        }
                                    }
                                }
                                lib.config.zuanchoose='boss'; 
                                lib.config.zuanbackground="extension/祖安武将/wallpaper/boss/"+lib.config.zuanboss+".jpg";
                            }
                            if(lib.config.mode=='chess'||lib.config.mode=='tafang'||lib.config.mode=='stone') {
                                lib.config.zuanchoose='chess'; 
                                lib.config.zuanbackground="extension/祖安武将/wallpaper/chess/chess.jpg";
                            }*/
                            if (lib.config.mode == 'single') {
                                lib.config.zuanchoose = 'versus';
                                lib.config.zuanbackground = "extension/祖安武将/wallpaper/versus/versus.jpg";
                            }
                            if (lib.config.mode == 'versus') {
                                lib.config.zuanchoose = 'versus';
                                lib.config.zuanbackground = "extension/祖安武将/wallpaper/versus/versus2.jpg";
                            }
                        }
                        if (lib.config.zuanchoose != 'none') game.broadcastAll() + ui.background.setBackgroundImage(lib.config.zuanbackground);
                        // ---------------------------------------动态壁纸刷新
                    },
                }
                lib.skill._zuanboss = {
                    trigger: {
                        player: ['dieBegin'],
                    },
                    direct: true,
                    priority: 15,
                    filter: function(event, player) {
                        if (lib.config['extension_祖安设置_exwallpaper']) {
                            return (lib.config.mode == 'boss' && player.identity == 'zhu');
                        }
                    },
                    content: function() {
                        'step 0';
                        //ui.background.style.backgroundImage=lib.config.standardbackground;
                        if (lib.config.zuanboss != 'god' && lib.config.zuanboss != 'gui' && parseFloat(lib.config.zuanboss) < 3) lib.config.zuanboss++;
                        'step 1';
                        lib.config.zuanbackground = "extension/祖安武将/wallpaper/boss/" + lib.config.zuanboss + ".jpg";
                        // ---------------------------------------动态壁纸刷新
                        'step 2';
                        game.broadcastAll() + ui.background.setBackgroundImage(lib.config.zuanbackground);
                        // ---------------------------------------动态壁纸刷新
                    },
                }
            }
            // ---------------------------------------回合特效------------------------------------------//  
            if (parseFloat(lib.config['extension_祖安设置_huihe']) != '0') {
                if (parseFloat(lib.config['extension_祖安设置_isPC']) != '1') {
                    game.giveChkCad();
                }
                lib.chkcad = [];
                lib.chkreplace = [];
                lib.skill._zuanRoundTX = {
                    trigger: {
                        global: "roundStart",
                    },
                    firstDo: true,
                    direct: true,
                    //priority:35,
                    filter: function(event, player) {
                        return parseFloat(lib.config['extension_祖安设置_isPC']) == '1' && game.roundNumber != game.roundNumberCad;
                    },
                    content: function() {
                        'step 0';
                        if (!game.folderExt('extension/祖安武将/character')) {
                            if (event && event.finish) {
                                event.finish();
                            } else {
                                return;
                            }
                        }
                        'step 1';
                        game.roundNumberCad = game.roundNumber;
                        lib.chkcad = [];
                        lib.chkreplace = [];
                        var add = 0;
                        /*试验性错误
			            var add=0;
			            var getname=function(setname) {
			                if(!setname) return 'none';
			                if(game.folderExt('extension/祖安武将/character/'+setname)) {
			                    var putname=setname;
			                }else {
			                    var pushnum=name.indexOf('_')+1;
			                    var putname=name.slice(pushnum);
			                    if(!game.folderExt('extension/祖安武将/character/'+putname)) {
			                        var putname='none';
			                    }
			                }
			                return putname;
			            };
			            for(var i=0;i<game.players.length;i++) {
			                var name=game.players[i].name;
			                var infiles=[];
			                lib.chkreplace[name]=false;
			                var namelst=['name','name1','name2'];
			                for(var a=0;a<3;a++) {
			                    var gname=getname(game.players[i][namelst[a]]);
			                    if(!['unknown','none'].contains(gname)&&!infiles.contains(gname)) {
			                        infiles.push(gname);
			                    }
			                }
			                infile=infiles.randomGet()
			                */
                        for (var i = 0; i < game.players.length; i++) {
                            var name = game.players[i].name;
                            var infile = name;
                            lib.chkreplace[name] = false;
                            if (!game.folderExt('extension/祖安武将/character/' + name)) {
                                var pushnum = name.lastIndexOf('_') + 1;
                                var name2 = name.slice(pushnum);
                                //alert(pushnum);
                                //alert(name2);
                                if (game.folderExt('extension/祖安武将/character/' + name2)) {
                                    infile = name2;
                                    lib.chkreplace[name] = name2;
                                }
                            }
                            game.cadfolder('extension/祖安武将/character/' + infile, name);
                        }
                    },
                }
                game.zuanhideBackground = function(img, delay, fps) {
                    window.bgphaseTX = ui.create.node('img');
                    bgphaseTX.src = lib.assetURL + img;
                    document.body.appendChild(window.bgphaseTX);
                    document.addEventListener("error",
                    function(event) {
                        var asset = localStorage.getItem("zuanasset");
                        var ev = event ? event: window.event;
                        var elem = ev.target;
                        if (elem.tagName.toLowerCase() == 'img') {
                            // 图片加载失败  --替换为默认 
                            elem.src = asset + 'extension/祖安武将/effects/unknow.jpg';
                        }
                    },
                    true);
                    var second = delay * 100;
                    var pics = delay * fps;
                    game.zuanhideBackgroundloop(pics, img, 1000 / fps, pics);
                };
                game.zuanhideBackgroundloop = function(num, img, second, sum) {
                    var zuan_wid = game.checkWH(window.bgphaseTX.width, window.bgphaseTX.height);
                    var strg = Math.abs(num - sum / 2) / (sum / 2);
                    var dtrg = (num - sum / 2) / (sum / 2);
                    var mtrg = (sum - num) / sum;
                    var opa = Math.sqrt(1 - strg, 3) * lib.config['extension_祖安设置_huihe'] / 10;
                    var wwid = window.innerWidth;
                    var whig = window.innerHeight;
                    var scale = '';
                    var left = 30 * Math.pow(strg, 3);
                    if (lib.config['extension_祖安设置_newhuihe'] == 'new_brighten') {
                        scale = ((1 - Math.pow(strg, 3)) * 0.3 + 0.8);
                    } else if (lib.config['extension_祖安设置_newhuihe'] == 'new_shine') {
                        left = '';
                        scale = (1 - (Math.pow(0.7 - mtrg, 2)) * 0.6 + 0.5);
                    } else {
                        scale = 1;
                    }
                    scale = scale * (lib.config['extension_祖安设置_huiheopa'] / 10);
                    if (num > sum / 2) {
                        window.bgphaseTX.style.cssText = 'pointer-events: none;text-align: center;margin: auto;opacity: ' + opa + ';display: block;position: absolute;background:none;z-index: 6;left: ' + (50 - left) + '%;top: 50%;filter: brightness(' + opa + ');transform: translate(-50%, -50%) scale(' + scale + ');';
                        setTimeout(function() {
                            game.zuanhideBackgroundloop(num - 1, img, second, sum);
                        },
                        second);
                    } else if (num > 0) {
                        window.bgphaseTX.style.cssText = 'pointer-events: none;text-align: center;margin: auto;opacity: ' + opa + ';display: block;position: absolute;background:none;z-index: 6;left: ' + (50 + left) + '%;top: 50%;filter: brightness(' + opa + ');transform: translate(-50%, -50%) scale(' + scale + ');';
                        setTimeout(function() {
                            game.zuanhideBackgroundloop(num - 1, img, second, sum);
                        },
                        second);
                    } else {
                        window.bgphaseTX.style.cssText = 'pointer-events: none;opacity: 0;';
                        delete window.bgphaseTX;
                        //window.bgphaseTX.style.cssText='pointer-events: none;text-align: center;margin: auto;opacity: '+lib.config['extension_祖安设置_huiheopa']+';display: block;position: absolute;background:none;z-index: -5;'+zuan_wid+'!important;left: 0;bottom: 0';
                    }
                };
                game.zuan_background = function(img) {
                    var zuan_wid = game.checkWH(window.bgphaseTX.width, window.bgphaseTX.height);
                    window.bgphaseTX = ui.create.node('img');
                    bgphaseTX.src = lib.assetURL + img;
                    document.body.appendChild(window.bgphaseTX);
                    //window.bgphaseTX.style.cssText='pointer-events: none;text-align: center;margin: auto;opacity: '+lib.config['extension_祖安设置_huiheopa']+';display: block;position: absolute;background:none;z-index: -5;'+zuan_wid+'!important;left: 0;bottom: 0';
                };
                lib.skill._newZuanPhaseTX = {
                    trigger: {
                        player: 'phaseBegin',
                    },
                    direct: true,
                    silent: true,
                    priority: Infinity,
                    filter: function(event, player) {
                        if (lib.config['extension_祖安设置_newhuihe'].indexOf('new_') == -1) return false;
                        if (!game.folderExt('extension/祖安武将/character')) return false;
                        if (!lib.chkcad || !lib.chkcad[player.name]) return false;
                        return player.name != 'unknown';
                    },
                    content: function() {
                        'step 0';
                        //ccad
                        if (!lib.chkreplace[player.name]) {
                            var putname = player.name;
                        } else {
                            var putname = lib.chkreplace[player.name];
                        }
                        var picfile = lib.chkcad[putname];
                        //alert(picfile);
                        if (picfile) {
                            var img = 'extension/祖安武将/character/' + putname + '/' + picfile.randomGet();
                            //var img='extension/祖安武将/character/'+player.name+'.jpg';
                            //event.width=270*present*(img.width*present/img.height*present);
                            //event.height=270*present;
                            //event.head = ui.create.node('img');
                            //event.head.src= lib.assetURL + 'extension/祖安武将/character/'+putname+'/'+picfile.randomGet();
                            game.zuanhideBackground(img, lib.config['extension_祖安设置_imgtime'] / 10, lib.config['extension_祖安设置_imgfps']);
                        }

                    },
                };
                lib.skill._zuanphaseTX = {
                    trigger: {
                        player: "phaseBegin",
                    },
                    direct: true,
                    priority: 35,
                    filter: function(event, player) {
                        if (lib.config['extension_祖安设置_newhuihe'] != 'old') return false;
                        //alert(game.folderExt('extension/祖安武将/character'));
                        //alert(game.folderExt('extension/祖安武将/character/'+player.name));
                        if (!game.folderExt('extension/祖安武将/character')) return false;
                        //if(!game.folderExt('extension/祖安武将/character/'+player.name)) return false;
                        if (!lib.chkcad || !lib.chkcad[player.name]) return false;
                        return player.name.indexOf('unknown') == -1;
                    },
                    content: function() {
                        'step 0';
                        if (lib.config.zuanusecardTX != 'none') {
                            lib.config.zuanusecardTX.remove();
                        }
                        if (parseFloat(lib.config['extension_祖安设置_isPC']) == '1') {
                            var present = 0.7;
                        } else {
                            var present = 0.9;
                        }
                        event.num = 0;
                        event.add = 1;
                        //ccad
                        if (!lib.chkreplace[player.name]) {
                            var putname = player.name;
                        } else {
                            var putname = lib.chkreplace[player.name];
                        }
                        var picfile = lib.chkcad[putname];
                        //alert(picfile);
                        if (picfile) {
                            var img = lib.assetURL + 'extension/祖安武将/character/' + putname + '/' + picfile.randomGet();
                            //var img='extension/祖安武将/character/'+player.name+'.jpg';
                            event.width = 270 * present * (img.width * present / img.height * present);
                            event.height = 270 * present;
                            event.head = ui.create.node('img');
                            event.head.src = lib.assetURL + 'extension/祖安武将/character/' + putname + '/' + picfile.randomGet();
                        } else {
                            {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                        }
                        'step 1';
                        if (event.head) event.head.remove();
                        if (event.add == 1) {
                            event.num++;
                        } else {
                            event.num--;
                        }
                        var width = event.width * 2;
                        var height = event.height * 2;
                        var wwid = window.innerWidth;
                        var whig = window.innerHeight;
                        if (parseFloat(lib.config['extension_祖安设置_isPC']) == '1') {
                            var sp = 2;
                        } else {
                            var sp = 1;
                        }
                        if (parseFloat(lib.config['extension_祖安设置_huiheopa']) == 'NaN') {
                            event.zuanspeed = 1;
                        } else {
                            event.zuanspeed = parseFloat(lib.config['extension_祖安设置_huiheopa']) * 0.1;
                        }
                        if (event.add == 1) {
                            var left = wwid * 0.27 * sp - (10 * event.zuanspeed - event.num) * (10 * event.zuanspeed - event.num) * wwid * 0.0025 * sp / event.zuanspeed;
                        } else {
                            var left = wwid * 0.27 * sp + (10 * event.zuanspeed - event.num) * (10 * event.zuanspeed - event.num) * wwid * 0.0025 * sp / event.zuanspeed;
                        }
                        /*
			            if(parseFloat(lib.config['extension_祖安设置_isPC'])=='1') {
			            if(event.add==1) {
			                var left=320-(10-event.num)*(10-event.num)*3.2;
			            }else {
			                var left=320+(10-event.num)*(10-event.num)*3.2;
			                }
			            }
			            if(parseFloat(lib.config['extension_祖安设置_isPC'])=='2') {
			                if(event.add==1) {
			                var left=270-(10-event.num)*(10-event.num)*2.7;
			            }else {
			                var left=270+(10-event.num)*(10-event.num)*2.7;
			                }
			            }
			            if(parseFloat(lib.config['extension_祖安设置_isPC'])=='3') {
			                if(event.add==1) {
			                var left=390-(10-event.num)*(10-event.num)*3.9;
			            }else {
			                var left=390+(10-event.num)*(10-event.num)*3.9;
			                }
			            }*/
                        event.head.style.cssText = 'text-align: center;margin: auto;pointer-events: none;opacity: ' + event.num * 0.01 * parseFloat(lib.config['extension_祖安设置_huihe']) / event.zuanspeed + ';display: block;width: ' + width + 'px;height: ' + height + 'px;position: absolute;top: 0;left: ' + left + 'px;bottom: 0;background:none;z-index:6';
                        document.body.appendChild(event.head);
                        // ---------------------------------------图片加载失败处理------------------------------------------//  
                        document.addEventListener("error",
                        function(event) {
                            var asset = localStorage.getItem("zuanasset");
                            var ev = event ? event: window.event;
                            var elem = ev.target;
                            if (elem.tagName.toLowerCase() == 'img') {
                                // 图片加载失败  --替换为默认 
                                elem.src = asset + 'extension/祖安武将/effects/unknow.jpg';
                            }
                        },
                        true);
                        'step 2';
                        if (event.add == 1) {
                            if (event.num < 10 * event.zuanspeed) {
                                game.delay(0.02);
                                event.goto(1);
                            } else {
                                event.add = 0;
                                game.delay(1);
                                event.goto(1);
                            }
                        } else {
                            if (event.num > 0) {
                                game.delay(0.02);
                                event.goto(1);
                            }
                        }
                        //event.head.remove();
                        'step 3';
                        lib.config.zuanusecardTX = event.head;
                        event.head.remove();
                        'step 4';
                        if (1 == 0) {
                            setTimeout(function() {
                                if (lib.config.zuanusecardTX != 'none') {
                                    lib.config.zuanusecardTX.remove();
                                }
                            },
                            1000);
                        }
                    },
                }
            }
            // ---------------------------------------开局动画------------------------------------------//  
            lib.skill._helasisyskill = {
                trigger: {
                    player: ["enterGame"],
                    global: "gameDrawBefore",
                },
                priority: -15,
                forced: true,
                filter: function(event, player) {
                    //if(player.identity!='zhu') return false;
                    return player == game.me;
                },
                content: function() {
                    if (lib.config['extension_祖安设置_audio_start'] != 'none') {
                        switch (lib.config['extension_祖安设置_audio_start']) {
                        case 'ring':
                            game.playAudio('..', 'extension', '祖安武将', 'audio', 'gamestart.mp3');
                            break;
                        case 'wind':
                            game.playAudio('..', 'extension', '祖安武将', 'audio', 'gamestart_wind.mp3');
                            break;
                        case 'dump':
                            game.playAudio('..', 'extension', '祖安武将', 'audio', 'gamestart_dump.mp3');
                            break;
                        case 'fault':
                            game.playAudio('..', 'extension', '祖安武将', 'audio', 'gamestart_fault.mp3');
                            break;
                        default:
                            break;
                        }
                    }
                    var off = lib.config['extension_祖安设置_helasisy'];
                    if (!off) {
                        game.newalive('extension/祖安武将/effects/Helasisy.gif', 2, 0.8);
                    }
                },
            }
            if (parseFloat(lib.config['extension_祖安设置_mode']) != '1') {
                lib.skill._keepideskill = {
                    trigger: {
                        player: ["gainAfter", "loseAfter", "phaseBegin", "phaseEnd"],
                    },
                    silent: true,
                    forced: true,
                    priority: -66,
                    filter: function(event, player) {
                        return typeof(player.storage.zuan_identity) != 'undefined' && player.storage.zuan_identity.length > 0;
                    },
                    content: function() {
                        //player.storage.zuan_identity=['主','zhu'];
                        //if(player.storage.zuan_identity) {
                        var idesum = player.storage.zuan_identity;
                        player.setIdentity(idesum[0]);
                        player.node.identity.dataset.color = idesum[1];
                        player.identityShown = true;
                        //}
                    }
                }
            }
            // ---------------------------------------身份隐藏------------------------------------------//
            //lib.config['extension_祖安设置_hideide']='game';
            if (lib.config['extension_祖安设置_hideide'] != 'none' && get.mode() == 'identity') {
                game.ideHideShow = false;
                game.ideshow = function() {
                    var list = '身份隐藏>>>———————';
                    for (var him = 'none'; him != game.zhu;) {
                        if (him == 'none') him = game.zhu;
                        var shown = him.storage.Hidentity ? '隐': '显';
                        var gme = him == game.me ? '玩家·': '';
                        list = list + '<li>' + get.translation(him.name) + '(' + gme + shown + ')：' + get.translation(him.identity) + '[' + get.translation(him.storage.Sidentity) + ']|态度：' + him.storage.zhuAtt;
                        him = him.next;
                    }
                    return list;
                };
                game.gamemeide = function() {
                    var old = game.me.identity;
                    if (game.me.storage.Hidentity) {
                        if (game.me.storage.zhuAtt > 40) {
                            game.me.identity = 'zhong';
                        } else if (game.me.storage.zhuAtt < -40) {
                            game.me.identity = 'fan';
                        }
                    }
                    return '<li>' + get.translation(game.me.name) + '-' + get.translation(old) + '转' + get.translation(game.me.identity);
                };
                lib.skill._zuanidentityskill = {
                    trigger: {
                        player: ["enterGame"],
                        global: ["gameDrawBefore"],
                    },
                    firstDo: true,
                    forced: true,
                    silent: true,
                    filter: function(event, player) {
                        return true;
                    },
                    content: function() {
                        'step 0';
                        player.storage.Sidentity = player.identity;
                        player.storage.zhuAtt = 0;
                        var sourceide = player.identity;
                        if (sourceide != 'zhu' && !player.identityShown) {
                            player.storage.Hidentity = true;
                            //player.identity='nei';
                        } else {
                            player.storage.Hidentity = false;
                            if (['zhu', 'zhong', 'mingzhong'].contains(sourceide)) {
                                player.storage.zhuAtt = 100;
                            }
                        }
                    },
                }
                lib.skill._zuanidentitychgneiskill = {
                    trigger: {
                        global: ["phaseAfter"],
                    },
                    firstDo: true,
                    forced: true,
                    silent: true,
                    filter: function(event, player) {
                        if (player == game.me) return false;
                        return ! player.storage.chgnei && event.player.identity == 'zhu';
                    },
                    content: function() {
                        'step 0';
                        player.storage.chgnei = true;
                        if (lib.config['extension_祖安设置_hideide'] == 'player') {
                            player.identity = player.storage.Sidentity;
                            player.storage.Hidentity = false;
                            if (['fan', 'nei'].contains(player.identity)) {
                                player.storage.zhuAtt = -100;
                            } else {
                                player.storage.zhuAtt = 100;
                            } {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                        } else {
                            if (!player.storage.Hidentity) {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                            if (player.identity == 'zhu') {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                            if (player == game.me) {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                        }
                        'step 1';
                        //player.storage.Hidentity=true;
                        player.identity = 'nei';
                    },
                }
                lib.skill._zuanidentitydieafterskill = {
                    trigger: {
                        player: "dieBefore",
                    },
                    forced: true,
                    forceDie: true,
                    firstDo: true,
                    silent: true,
                    filter: function(event, player) {
                        return true;
                    },
                    content: function() {
                        'step 0';
                        player.storage.Hidentity = false;
                        player.identity = player.storage.Sidentity;
                        'step 1';
                        var oldide = game.me.identity;
                        event.shown = true;
                        var same = 'none';
                        for (var i = 0; i < game.players.length; i++) {
                            var him = game.players[i];
                            var ide = game.players[i].storage.Sidentity == 'mingzhong' ? 'zhong': game.players[i].storage.Sidentity;
                            if (him.identity == 'zhu') continue;
                            if (same != ide) {
                                if (same == 'none') {
                                    same = ide;
                                } else {
                                    event.shown = false;
                                    break;
                                }
                            }
                        }
                        if (game.countPlayer(function(current) {
                            if (player.storage.Sidentity == 'zhu') {
                                var musthas = [];
                            } else {
                                var musthas = ['nei', 'fan'];
                            }
                            return musthas.contains(current.identity) && current != player;
                        }) < 1) {
                            game.filterPlayer(function(current) {
                                if ((game.players.length > 3 && !event.shown) && player.identity != 'zhu') {
                                    if (current.identity != 'zhu' && current != game.me) {
                                        current.identity = 'nei';
                                        return true;
                                    }
                                } else {
                                    current.identity = current.storage.Sidentity;
                                    current.storage.Hidentity = false;
                                    if (['fan', 'nei'].contains(current.identity)) {
                                        current.storage.zhuAtt = -100;
                                    } else {
                                        current.storage.zhuAtt = 100;
                                    }
                                }
                            });
                        } else {
                            game.filterPlayer(function(current) {
                                current.identity = current.storage.Sidentity;
                                if (game.players.length <= 3 || event.shown) {
                                    current.storage.Hidentity = false;
                                    if (['fan', 'nei'].contains(current.identity)) {
                                        current.storage.zhuAtt = -100;
                                    } else {
                                        current.storage.zhuAtt = 100;
                                    }
                                }
                                return true;
                            });
                        }
                        if (game.me.storage.Hidentity) {
                            game.me.identity = oldide;
                        }
                    },
                }
                lib.skill._zuanidentityshowskill = {
                    trigger: {
                        player: ["phaseBefore"],
                    },
                    firstDo: true,
                    forced: true,
                    silent: true,
                    filter: function(event, player) {
                        if (player == game.me) return false;
                        return player.storage.Hidentity;
                    },
                    content: function() {
                        'step 0';
                        event.sourceide = player.storage.Sidentity;
                        event.sourcezat = player.storage.zhuAtt;
                        event.preide = player.previous.storage.Sidentity;
                        event.nexide = player.next.storage.Sidentity;
                        event.prezat = player.previous.storage.zhuAtt;
                        event.nexzat = player.next.storage.zhuAtt;
                        if (player.identityShown || ((player.ai.shown > 0.8 || Math.abs(player.storage.zhuAtt) > 80) && player.identity == event.sourceide)) {
                            player.storage.Hidentity = false;
                            player.identity = event.sourceide;
                        }
                        if (event.sourceide == 'fan') {
                            if (event.preide == 'zhu' && (player.hp * 2 + player.countCards('e') * 1.5 + player.countCards('h') * 1 >= 12 || Math.random() > 0.6)) {
                                player.identity = 'fan';
                            } else if (event.preide.zhuAtt > 10 && event.nexide.zhuAtt > 10) {
                                player.identity = ['nei', 'zhong'].randomGet();
                            } else if (event.preide.zhuAtt < -40 || event.nexide.zhuAtt < -40 || Math.random() > 0.75) {
                                player.identity = event.sourceide;
                            } else {
                                player.identity = 'nei';
                            }
                        }
                        if (['zhong', 'mingzhong'].contains(event.sourceide)) {
                            if (event.preide == 'zhu' || event.nexide == 'zhu') {
                                player.identity = event.sourceide;
                            } else if (event.prezat > 40 || event.nexzat > 40 || event.prezat + event.nexzat > 60 || Math.random() > 0.6) {
                                player.identity = event.sourceide;
                            } else if (event.preide.zhuAtt < 10 && event.nexide.zhuAtt < 10) {
                                player.identity = ['fan', 'nei'].randomGet();
                            } else {
                                player.identity = 'nei';
                            }
                        }
                        if (event.sourceide == 'nei') {
                            player.identity = 'nei';
                        }
                    },
                }
                lib.skill._zuanidentitydyingskill = {
                    trigger: {
                        global: ["dying"],
                    },
                    firstDo: true,
                    forced: true,
                    silent: true,
                    filter: function(event, player) {
                        if (player == game.me) return false;
                        return player.storage.Hidentity || player.identity != player.storage.Sidentity;
                    },
                    content: function() {
                        'step 0';
                        player.identity = player.storage.Sidentity;
                    },
                }
                lib.skill._zuanidentitytodieskill = {
                    trigger: {
                        global: ["changehp"],
                    },
                    firstDo: true,
                    forced: true,
                    silent: true,
                    filter: function(event, player) {
                        if (player == game.me) return false;
                        return player.storage.Hidentity && (event.player.storage.Sidentity == 'zhu' || event.player == player);
                    },
                    content: function() {
                        'step 0';
                        if (trigger.player.storage.Sidentity == 'zhu' || Math.random() > 0.75) {
                            player.identity = player.storage.Sidentity;
                        }
                    },
                }
                lib.skill._zuanidentitydamskill = {
                    trigger: {
                        source: "damageSource",
                    },
                    firstDo: true,
                    forced: true,
                    silent: true,
                    filter: function(event, player) {
                        if (event.card) return false;
                        return player.storage.Hidentity && event.player != player && event.num > 0;
                    },
                    content: function() {
                        'step 0';
                        event.taride = trigger.player.storage.Sidentity;
                        event.tarzat = trigger.player.storage.zhuAtt;
                        event.addzhuAtt -= trigger.num * 0.01 * (event.tarzat);
                        event.addzhuAtt = Math.floor(event.addzhuAtt + 0.5);
                        if (isNaN(event.addzhuAtt)) event.addzhuAtt = 0;
                        'step 1';
                        if (event.addzhuAtt >= 0) {
                            if (game.ideHideShow) player.say('态度+' + event.addzhuAtt);
                        } else {
                            if (game.ideHideShow) player.say('态度' + event.addzhuAtt);
                        }
                        player.storage.zhuAtt += event.addzhuAtt;
                        if (player.storage.zhuAtt > 100) {
                            player.storage.zhuAtt = 100;
                        } else if (player.storage.zhuAtt < -100) {
                            player.storage.zhuAtt = -100;
                        }
                        if (player != game.me) {
                            if (player.identityShown || ((player.ai.shown > 0.8 || Math.abs(player.storage.zhuAtt) > 80) && player.identity == event.sourceide)) {
                                player.storage.Hidentity = false;
                                player.identity = event.sourceide;
                            }
                        }
                        game.gamemeide();
                    },
                }
                lib.skill._zuanidentityrecskill = {
                    trigger: {
                        target: "recoverAfter",
                    },
                    firstDo: true,
                    forced: true,
                    silent: true,
                    filter: function(event, player) {
                        if (event.card) return false;
                        return player.storage.Hidentity && event.source && event.target != player && event.num > 0;
                    },
                    content: function() {
                        'step 0';
                        event.taride = trigger.target.storage.Sidentity;
                        event.tarzat = trigger.target.storage.zhuAtt;
                        event.addzhuAtt += trigger.num * 0.01 * (event.tarzat);
                        event.addzhuAtt = Math.floor(event.addzhuAtt + 0.5);
                        if (isNaN(event.addzhuAtt)) event.addzhuAtt = 0;
                        'step 1';
                        if (event.addzhuAtt >= 0) {
                            if (game.ideHideShow) player.say('态度+' + event.addzhuAtt);
                        } else {
                            if (game.ideHideShow) player.say('态度' + event.addzhuAtt);
                        }
                        player.storage.zhuAtt += event.addzhuAtt;
                        if (player.storage.zhuAtt > 100) {
                            player.storage.zhuAtt = 100;
                        } else if (player.storage.zhuAtt < -100) {
                            player.storage.zhuAtt = -100;
                        }
                        if (player != game.me) {
                            if (player.identityShown || ((player.ai.shown > 0.8 || Math.abs(player.storage.zhuAtt) > 80) && player.identity == event.sourceide)) {
                                player.storage.Hidentity = false;
                                player.identity = event.sourceide;
                            }
                        }
                        game.gamemeide();
                    },
                }
                lib.skill._zuanidentityuseskill = {
                    trigger: {
                        player: "useCardToPlayered",
                    },
                    firstDo: true,
                    forced: true,
                    silent: true,
                    filter: function(event, player) {
                        return player.storage.Hidentity && event.card && event.target && event.target != player;
                    },
                    content: function() {
                        'step 0';
                        event.sourceide = player.storage.Sidentity;
                        event.sourcezat = player.storage.zhuAtt;
                        event.preide = player.previous.storage.Sidentity;
                        event.nexide = player.next.storage.Sidentity;
                        event.prezat = player.previous.storage.zhuAtt;
                        event.nexzat = player.next.storage.zhuAtt;
                        event.taride = trigger.target.storage.Sidentity;
                        event.tarzat = trigger.target.storage.zhuAtt;
                        event.addzhuAtt = 0;
                        if (event.tarzat > 0) {
                            var plus = 1;
                        } else if (event.tarzat < 0) {
                            var plus = -1;
                        } else {
                            var plus = 0;
                        }
                        //alert(get.effect(trigger.target,trigger.card,player,trigger.target));
                        if (get.effect(trigger.target, trigger.card, player, trigger.target) < 0) {
                            if (event.taride != 'zhu' && game.hasPlayer(function(current) {
                                return player.canUse(trigger.card, current) && current.storage.Sidentity == 'zhu';
                            })) {
                                if (event.tarzat <= 0) {
                                    event.addzhuAtt += (Math.abs(get.effect(trigger.target, trigger.card, player, trigger.target)) + 1) * 0.02 * (110 + event.tarzat);
                                } else {
                                    event.addzhuAtt -= Math.abs(get.effect(trigger.target, trigger.card, player, trigger.target)) * 0.02 * (event.tarzat);
                                }
                            } else {
                                event.addzhuAtt -= Math.abs(get.effect(trigger.target, trigger.card, player, trigger.target)) * 0.02 * (event.tarzat + plus);
                            }
                        } else if (get.effect(trigger.target, trigger.card, player, trigger.target) > 0) {
                            event.addzhuAtt += Math.abs(get.effect(trigger.target, trigger.card, player, trigger.target)) * 0.015 * (event.tarzat);
                        }
                        event.addzhuAtt = Math.floor(event.addzhuAtt + 0.5);
                        if (isNaN(event.addzhuAtt)) event.addzhuAtt = 0;
                        'step 1';
                        if (event.addzhuAtt >= 0) {
                            if (game.ideHideShow) player.say('态度+' + event.addzhuAtt);
                        } else {
                            if (game.ideHideShow) player.say('态度' + event.addzhuAtt);
                        }
                        player.storage.zhuAtt += event.addzhuAtt;
                        if (player.storage.zhuAtt > 100) {
                            player.storage.zhuAtt = 100;
                        } else if (player.storage.zhuAtt < -100) {
                            player.storage.zhuAtt = -100;
                        }
                        if (player != game.me) {
                            if (player.identityShown || ((player.ai.shown > 0.8 || Math.abs(player.storage.zhuAtt) > 80) && player.identity == event.sourceide)) {
                                player.storage.Hidentity = false;
                                player.identity = event.sourceide;
                            }
                        }
                        game.gamemeide();
                    },
                }
            }

            // ---------------------------------------元气系统------------------------------------------//
            game.yq = function(skill) {
                var back = '';
                if (Array.isArray(skill)) {
                    for (var s = 0; s < skill.length; s++) {
                        if (game.me.hasSkill('yuanqi_' + skill[s])) {
                            back = back + '[-]';
                            game.me.removeSkill('yuanqi_' + skill[s]);
                        } else {
                            back = back + '[+]';
                            game.me.addSkill('yuanqi_' + skill[s]);
                        }
                        back = back + get.translation('yuanqi_' + skill[s]) + ' ';
                    }
                } else {
                    if (game.me.hasSkill('yuanqi_' + skill)) {
                        back = back + '[-]';
                        game.me.removeSkill('yuanqi_' + skill);
                    } else {
                        back = back + '[+]';
                        game.me.addSkill('yuanqi_' + skill);
                    }
                    back = back + get.translation('yuanqi_' + skill);
                }
                return get.translation(game.me.name) + ':' + back;
            }
            if (parseFloat(lib.config['extension_祖安设置_fun']) == '7') {
                lib.skill._yuanqiskill = {
                    trigger: {
                        player: ["enterGame"],
                        global: "gameDrawAfter",
                    },
                    forced: true,
                    priority: 2,
                    content: function() {
                        'step 0';
                        player.addSkill('zuan_hudun');
                        'step 1';
                        if (player.maxHp != Infinity) {
                            var list = [];
                            for (var i = 1; i <= player.maxHp; i++) {
                                if (i <= 9) list.push(i * 0.1);
                            }
                            var rana = list.randomGet();
                            var ranb = 1 - rana;
                            event.hujia = Math.ceil(player.maxHp * rana);
                            event.maxhp = Math.max(1, player.maxHp - event.hujia);
                            event.hp = Math.ceil(player.hp * ranb);
                        } else {
                            event.hujia = 1;
                            event.maxhp = player.maxHp;
                            event.hp = player.hp;
                        }
                        player.storage.zuan_maxhujia = event.hujia;
                        player.storage.zuan_inithujia = event.hujia;
                        'step 2';
                        var add = 0;
                        if (lib.config['extension_祖安设置_balance']) add++;
                        player.hp = event.hp + add;
                        player.maxHp = event.maxhp + add;
                        player.addMark('zuan_hudun', event.hujia, false);
                        player.seeMark('zuan_hudun');
                        game.dyingShow(player, parseFloat(lib.config['extension_祖安设置_newui']));
                        player.update();
                    },
                }
            }
            // ---------------------------------------暗夜鬼城------------------------------------------//
            if (parseFloat(lib.config['extension_祖安设置_fun']) == '6') {
                lib.skill._anyeskill = {
                    trigger: {
                        player: ["enterGame"],
                        global: "gameDrawAfter",
                    },
                    forced: true,
                    filter: function(event, player) {
                        if (get.mode() != 'identity') return false;
                        if (player.identity != 'zhu') return false;
                        return true;
                    },
                    content: function() {
                        player.addSkill('anyezhu');
                    },
                }
            }
            // ---------------------------------------同将之争------------------------------------------//
            if (parseFloat(lib.config['extension_祖安设置_fun']) == '5') {
                lib.skill._taohuaskill = {
                    trigger: {
                        player: ["enterGame"],
                        global: ["gameDrawAfter"],
                    },
                    filter: function(event, player, game) {
                        if (get.mode() != 'identity') return false;
                        return player != game.me;
                    },
                    silent: true,
                    firstDo: true,
                    priority: 999,
                    direct: true,
                    forced: true,
                    content: function() {
                        if (game.me.name2) {
                            player.init(game.me.name, game.me.name2);
                        } else {
                            player.init(game.me.name);
                        }
                        if (player.identity == 'zhu') {
                            player.maxHp++;
                            player.hp++;
                            player.update();
                        }
                    },
                }
            }
            // ---------------------------------------桃花落尽------------------------------------------//
            if (parseFloat(lib.config['extension_祖安设置_fun']) == '4') {
                lib.skill._taohuaskill = {
                    trigger: {
                        player: ["enterGame", 'phaseBegin'],
                        global: ["gameDrawAfter"],
                    },
                    filter: function(event, player) {
                        return ! player.hasSkill('taozhu');
                    },
                    direct: true,
                    forced: true,
                    content: function() {
                        player.addSkill('taoluo');
                    },
                    mod: {
                        cardSavable: function(card, player) {
                            if (card.name == 'tao' && !player.isDying()) return false;
                        },
                        cardEnabled: function(card, player) {
                            if (card.name == 'tao' && !player.isDying()) return false;
                        },
                    },
                }
            }
            // ---------------------------------------群侠论武------------------------------------------//
            if (parseFloat(lib.config['extension_祖安设置_fun']) == '3') {
                lib.skill._lunjianskill = {
                    trigger: {
                        target: "shaBegin",
                    },
                    direct: true,
                    logTarget: "target",
                    content: function() {
                        'step 0';
                        player.addSkill('jiwuskill');
                        'step 1';
                        var triggers = _status.event.getTrigger();
                        player.chooseToUse('是否使用一张【杀】？', {
                            name: 'sha'
                        });
                        'step 2';
                        if (player.hasSkill('jiwuskill')) {
                            player.removeSkill('jiwuskill');
                        } else {
                            trigger.cancel();
                        }
                    },
                    ai: {
                        skillTagFilter: function(player) {
                            if (!player.countCards('h', 'sha')) return false;
                        },
                        effect: {
                            target: function(card, player, target, current) {
                                if (get.tag(card, 'respondShan') && current < 0) return 0.6
                            }
                        },
                        order: 4,
                        useful: -1,
                        value: -1
                    },
                }
            }
            // ---------------------------------------大将英魂------------------------------------------//
            if (parseFloat(lib.config['extension_祖安设置_fun']) == '2') {
                lib.skill._jianghunskill = {
                    trigger: {
                        player: ["enterGame"],
                        global: "gameDrawAfter",
                    },
                    usable: 1,
                    direct: true,
                    forced: true,
                    filter: function(event, player, game) {
                        if (player.name2) return false;
                        return true;
                    },
                    content: function() {
                        'step 0';
                        //jjhun
                        if (!game.jianghunseatnum) {
                            game.jianghunseatnum = 0;
                        }
                        game.jianghunseatnum++;
                        var zmlist = ['', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z'];
                        player.storage.jianghunseat = zmlist[game.jianghunseatnum];
                        if (!game.jianhunsklist) game.jianhunsklist = [];
                        if (!game.jianoldsklist) game.jianoldsklist = [];
                        if (!game.equipjh) game.equipjh = {};
                        if (!game.oldequipjh) game.oldequipjh = {};
                        if (!game.storage) game.storage = {};
                        if (!game.oldstorage) game.oldstorage = {};
                        //标包增强
                        lib.characterPackHun = {
                            "standard": lib.characterPack["standard"]
                        }
                        var list = [];
                        var ranlist = [];
                        for (var a in lib.characterPackHun) {
                            for (var b in lib.characterPackHun[a]) {
                                var role = lib.characterPackHun[a][b];
                                lib.character[b] = role;
                                list.push(['将魂', '', b]);
                                ranlist.push(b);
                                lib.card[b] = {
                                    enable: true,
                                    type: 'character',
                                    image: 'character/' + b,
                                    color: 'white',
                                    opacity: 1,
                                    textShadow: 'black 0 0 2px',
                                    chongzhu: true,
                                }
                            }
                        }
                        var choose = ranlist.randomGet();
                        player.chooseButton(["请选择一张将魂", [list, 'vcard']], true).ai = function(button) {
                            var name = button.link[2];
                            return name == choose;
                        }
                        'step 1';
                        if (result.bool && result.links) {
                            player.addSkill('jianghun');
                            player.storage.hunskill = result.links[0][2];
                            player.markSkill('hunskill');
                            player.syncStorage('hunskill');
                        }
                        player.storage.eq1 = 0;
                        player.storage.eq2 = 0;
                        player.storage.eq3 = 0;
                        player.storage.eq4 = 0;
                        player.storage.eq5 = 0;
                    },
                }
            }
            if (lib.config.mode != 'guozhan') {
                // ---------------------------------------暗杀行动------------------------------------------//
                if (parseFloat(lib.config['extension_祖安设置_mode']) == '8') {
                    lib.skill._dietime = {
                        //marktext:"夜",
                        marktext: "<img style=width:15px src=" + lib.assetURL + "extension/祖安武将/basic/mode_anye.png>",
                        trigger: {
                            player: ["enterGame"],
                            global: "gameDrawAfter",
                        },
                        forced: true,
                        filter: function(event, player) {
                            if (get.mode() != 'identity') return false;
                            if (player.identity != 'zhu') return false;
                            return true;
                        },
                        content: function() {
                            player.storage.zhudie = 0;
                            player.addMark('_dietime', 2, false);
                            for (var i = 0; i < game.players.length; i++) {
                                if (game.players[i].identity == 'nei') {
                                    if (lib.config['extension_祖安设置_balance']) {
                                        game.players[i].identity = 'zhong';
                                    } else {
                                        game.players[i].identity = 'nei';
                                    }
                                    game.players[i].addSkill('ansha_nei');
                                }
                                if (!game.players[i].hasSkill('ansha_nei') && game.players[i].identity != 'zhu') {
                                    if (lib.config['extension_祖安设置_balance']) {
                                        game.players[i].identity = 'zhong';
                                    } else {
                                        game.players[i].identity = 'nei';
                                    }
                                    game.players[i].addSkill('ansha_zhong');
                                }
                            }
                        },
                        intro: {
                            name: "夜幕倒计时",
                            content: function(storage, player, skill) {
                                var str = '<li>距离夜幕降临还剩 ' + player.storage._dietime + ' 回合';
                                return str;
                            }
                        },
                    }
                    lib.skill._anshaskill = {
                        trigger: {
                            player: ["phaseEnd"],
                        },
                        forced: true,
                        filter: function(event, player) {
                            if (get.mode() != 'identity') return false;
                            if (player.identity != 'zhu') return false;
                            return true;
                        },
                        content: function() {
                            if (player.countMark('_dietime') > 1) {
                                player.removeMark('_dietime');
                            } else {
                                var tex = lib.config['extension_祖安设置_texiao'];
                                if (tex) {
                                    game.newalive('extension/祖安武将/mode/mode_yemu.gif', 2, lib.config.zuancoveropacity);
                                    /*if((parseFloat(lib.config['extension_祖安设置_wallpaper'])!='1'||(lib.config['extension_祖安设置_exwallpaper']&&lib.config.zuanexwallpaper=='on'))&&parseFloat(lib.config['extension_祖安设置_isPC'])!='0') {
	                                    setTimeout(function () {
	                                                    game.broadcastAll()+ui.background.setBackgroundImage(lib.config.zuanbackground);
	                                // ---------------------------------------动态壁纸刷新
	                                    }, 2500);
	                                }*/
                                }
                                player.storage._dietime = 0;
                                player.unmarkSkill('_dietime');
                                var list = [];
                                event.num = 0;
                                for (var i = 0; i < game.players.length; i++) {
                                    if (game.players[i].hasSkill('ansha_zhong')) {
                                        list.push(game.players[i]);
                                        event.num++;
                                    }
                                }
                                if (event.num >= 1) {
                                    var zhong = list.randomGet();
                                    if (lib.config['extension_祖安设置_balance']) {
                                        for (var i = 0; i < game.players.length; i++) {
                                            if (game.players[i].hasSkill('ansha_zhong') && game.players[i] != player) game.players[i].identity = 'nei';
                                        }
                                    }
                                    zhong.identity = 'zhong';
                                    zhong.die();
                                }
                                if (event.num <= 1) {
                                    if (player.storage.zhudie == 0) {
                                        for (var i = 0; i < game.players.length; i++) {
                                            if (game.players[i].hasSkill('ansha_nei')) {
                                                var fan = game.players[i];
                                                fan.identity = 'fan';
                                                fan.node.identity.dataset.color = 'nei';
                                                fan.setIdentity('刺');
                                                fan.identityShown = true;
                                                fan.storage.zuan_identity = ['刺', 'nei'];
                                            }
                                        }
                                        player.addMark('_dietime', 3);
                                        player.storage.zhudie = 1;
                                    } else {
                                        var tex = lib.config['extension_祖安设置_texiao'];
                                        if (tex) {
                                            game.newalive('extension/祖安武将/mode/mode_yemu.gif', 2, lib.config.zuancoveropacity);
                                            /*if((parseFloat(lib.config['extension_祖安设置_wallpaper'])!='1'||(lib.config['extension_祖安设置_exwallpaper']&&lib.config.zuanexwallpaper=='on'))&&parseFloat(lib.config['extension_祖安设置_isPC'])!='0') {
			                                    setTimeout(function () {
			                                                    game.broadcastAll()+ui.background.setBackgroundImage(lib.config.zuanbackground);
			                                // ---------------------------------------动态壁纸刷新
			                                    }, 2500);
			                                }*/
                                        }
                                        if (lib.config['extension_祖安设置_newover']) {
                                            if (player.isFriendsOf(game.me)) {
                                                game.over(false);
                                            } else {
                                                game.over(true);
                                            }
                                        } else {
                                            player.die();
                                        }
                                    }
                                }
                            }
                        },
                    }
                }
                // ---------------------------------------幻海之诗------------------------------------------//
                if (parseFloat(lib.config['extension_祖安设置_mode']) == '7') {
                    lib.skill._huanhaiskill = {
                        trigger: {
                            player: ["enterGame"],
                            global: "gameDrawAfter",
                        },
                        silent: true,
                        forced: true,
                        filter: function(event, player) {
                            if (player.name2) return false;
                            if (get.mode() != 'identity') return false;
                            return player.group != 'western';
                        },
                        content: function() {
                            'step 0';
                            player.showCharacter(2);
                            var skills = player.getSkills(true, false);
                            for (var i = 0; i < skills.length; i++) {
                                var info = get.info(skills[i]);
                                if (skills[i] != 'zuan_hudun' && skills[i] != 'hpunshow' && skills[i] != 'hongshuiunshow' && skills[i] != 'huoshanunshow' && skills[i] != 'thunderunshow' && skills[i] != 'jingcheng' && skills[i] != 'bazhu' && skills[i] != 'guanfu' && !info.charlotte) {
                                    player.removeSkill(skills[i]);
                                }
                            }
                            if (1 == 1) {
                                player.maxHp = 4;
                                player.hp = 4;
                                player.hujia = 0;
                                player.update();
                            } else {
                                var hpnum = 4;
                                if (player.identity == 'zhu' && (get.mode() == 'identity' || get.mode() == 'doudizhu')) var hpnum = 4;
                                if (player.maxHp < hpnum) player.gainMaxHp(hpnum - player.maxHp);
                                if (player.maxHp > hpnum) player.loseMaxHp(player.maxHp - hpnum);
                                player.recover(player.maxHp);
                            }
                            player.addSkill('huanhai');
                            'step 1';
                            player.logSkill('huanhai');
                            var list = [];
                            var list2 = [];
                            var players = game.players.concat(game.dead);
                            for (var i = 0; i < players.length; i++) {
                                list2.add(players[i].name);
                                list2.add(players[i].name1);
                                list2.add(players[i].name2);
                            }
                            for (var i in lib.character) {
                                if (lib.character[i][1] != player.group) continue;
                                if (lib.character[i][3].length < 1) continue;
                                if (lib.character[i][4]) {
                                    if (lib.character[i][4].contains('forbidai')) continue;
                                    if (lib.character[i][4].contains('boss')) continue;
                                    if (lib.character[i][4].contains('minskin')) continue;
                                    if (lib.character[i][4].contains('hiddenboss')) continue;
                                }
                                if (get.config('double_character') && lib.config.forbiddouble.contains(i)) continue;
                                if (player.storage.huanhai.contains(i)) continue;
                                if (list2.contains(i)) continue;
                                list.push(i);
                            }
                            var name = list.randomGet();
                            player.storage.huanhai.push(name);
                            player.markSkill('huanhai');
                            var skills = lib.character[name][3];
                            player.addSkill(skills.randomGet());
                            event.dialog = ui.create.dialog('<div class="text center">' + get.translation(player.name) + '获得了技能', [[name], 'character']);
                            game.delay(2);
                            'step 2';
                            event.dialog.close();
                        },
                    }
                    lib.skill._seadreammodeskill = {
                        trigger: {
                            player: ["phaseBegin"],
                            //global:'roundStart',
                        },
                        priority: 985,
                        silent: true,
                        forced: true,
                        filter: function(event, player) {
                            if (player.name2) return false;
                            if (get.mode() != 'identity') return false;
                            if (player.identity != 'zhu') return false;
                            return true;
                        },
                        content: function() {
                            'step 0';
                            var tex = lib.config['extension_祖安设置_texiao'];
                            if (tex) {
                                game.newalive('extension/祖安武将/mode/mode_canghai.gif', 2, lib.config.zuancoveropacity);
                                /*if((parseFloat(lib.config['extension_祖安设置_wallpaper'])!='1'||(lib.config['extension_祖安设置_exwallpaper']&&lib.config.zuanexwallpaper=='on'))&&parseFloat(lib.config['extension_祖安设置_isPC'])!='0') {
			                       setTimeout(function () {
				                        game.broadcastAll()+ui.background.setBackgroundImage(lib.config.zuanbackground);
					                // ---------------------------------------动态壁纸刷新
				                    }, 2300);
				                }*/
                                //幻海之诗
                            }
                            for (var i = 0; i < game.players.length; i++) {
                                var tar = game.players[i];
                                var swap = game.players.randomGet();
                                game.swapSeat(tar, swap, false);
                            }
                            'step 1';
                            if (lib.config['extension_祖安设置_balance']) {
                                player.draw();
                                player.throwDice();
                            } else {
                                player.judge();
                            }
                            'step 2';
                            if (lib.config['extension_祖安设置_balance']) {
                                if (event.num) {
                                    for (var i = 0; i < game.players.length; i++) {
                                        var him = game.players[i];
                                        var cards = game.players[i].getCards('hej');
                                        var dis = [];
                                        for (var j = 0; j < cards.length; j++) {
                                            if (get.number(cards[j]) == event.num) dis.push(cards[j]);
                                        }
                                        him.discard(dis);
                                    }
                                    if (event.num != 6) {
                                        if (event && event.finish) {
                                            event.finish();
                                        } else {
                                            return;
                                        }
                                    }
                                }
                            } else {
                                if (result.suit && result.suit != 'diamond') {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            'step 3';
                            for (o = 0; o < game.players.length; o++) {
                                game.players[o].addSkill('huanhaicls');
                            }
                        },
                    }
                }
                // ---------------------------------------雷鸣山谷------------------------------------------//
                if (parseFloat(lib.config['extension_祖安设置_mode']) == '6') {
                    lib.skill._thunderjudgemodeskill = {
                        trigger: {
                            player: ["phaseBefore"],
                        },
                        forced: true,
                        filter: function(event, player) {
                            //if(player.identity!='zhu') return false;
                            return player.canAddJudge('shandian');
                        },
                        content: function() {
                            event.card = game.createCard('shandian');
                            //player.gain(event.card,'draw');
                            player.line(player, 'thunder');
                            player.addJudge(event.card);
                        },
                    }
                    lib.skill._thundermodeskill = {
                        trigger: {
                            player: ["enterGame"],
                            global: "gameDrawAfter",
                        },
                        priority: 5,
                        forced: true,
                        filter: function(event, player) {
                            return true;
                        },
                        content: function() {
                            player.maxHp += player.maxHp;
                            player.hp += player.hp;
                            player.update();
                            if (player.hasSkill('guidao')) {
                                player.removeSkill('guidao');
                                player.addSkill('tiandu');
                            }
                            if (player.hasSkill('xinguidao')) {
                                player.removeSkill('xinguidao');
                                player.addSkill('tiandu');
                            }
                            if (player.hasSkill('guicai')) {
                                player.removeSkill('guicai');
                                player.addSkill('tiandu');
                            }
                        },
                    }
                }
                // ---------------------------------------天下归心------------------------------------------//
                if (parseFloat(lib.config['extension_祖安设置_mode']) == '5') {
                    lib.skill._guixinmodeskill = {
                        trigger: {
                            player: ["enterGame"],
                            global: "gameDrawAfter",
                        },
                        forced: true,
                        filter: function(event, player) {
                            if (get.mode() != 'identity') return false;
                            if (player.identity != 'zhu') return false;
                            return true;
                        },
                        content: function() {
                            if (!lib.config['extension_祖安设置_balance']) {
                                player.addTempSkill('wushuang');
                                player.changeHujia(2);
                            }
                            player.maxHp++;
                            player.hp++;
                            player.update();
                            player.identity = 'zhu';
                            player.setIdentity('祖');
                            player.node.identity.dataset.color = 'zhu';
                            player.identityShown = true;
                            player.storage.zuan_identity = ['祖', 'zhu'];
                            player.addSkill('renxin_dam');
                            for (var i = 0; i < game.players.length; i++) {
                                if (game.players[i] != player) {
                                    game.players[i].identity = 'fan';
                                    game.players[i].setIdentity('楚');
                                    game.players[i].node.identity.dataset.color = 'nei';
                                    game.players[i].identityShown = true;
                                    game.players[i].storage.zuan_identity = ['楚', 'nei'];
                                }
                            }
                        },
                    }
                }
                // ---------------------------------------讨伐叛军------------------------------------------//  
                if (parseFloat(lib.config['extension_祖安设置_mode']) == '4') {
                    lib.skill._guanmodeskill = {
                        trigger: {
                            player: ["enterGame"],
                            global: "gameDrawAfter",
                        },
                        forced: true,
                        filter: function(event, player) {
                            if (get.mode() != 'identity') return false;
                            if (player.identity != 'zhu') return false;
                            return true;
                        },
                        content: function() {
                            player.addSkill('guanfu');
                            player.storage.zhumaxhp = player.maxHp;
                            player.storage.tamaxhp = Infinity;
                            player.storage.tahp = 0;
                            player.identity = 'zhu';
                            player.setIdentity('府');
                            player.node.identity.dataset.color = 'nei';
                            player.identityShown = true;
                            player.storage.zuan_identity = ['府', 'nei'];
                            for (var i = 0; i < game.players.length; i++) {
                                if (game.players[i].identity == 'fan') {
                                    game.players[i].setIdentity('叛');
                                    game.players[i].node.identity.dataset.color = 'fan';
                                    game.players[i].identityShown = true;
                                    game.players[i].storage.zuan_identity = ['叛', 'fan'];
                                } else {
                                    if (game.players[i].identity == 'zhu') {
                                        game.players[i].setIdentity('府');
                                        game.players[i].node.identity.dataset.color = 'nei';
                                        game.players[i].identityShown = true;
                                        game.players[i].storage.zuan_identity = ['府', 'nei'];
                                    } else {
                                        if (game.players[i].identity == 'nei') game.players[i].addSkill('guifu_nei');
                                        if (game.players[i] != player) {
                                            game.players[i].setIdentity('官');
                                            game.players[i].node.identity.dataset.color = 'zhong';
                                            game.players[i].identityShown = true;
                                            game.players[i].storage.zuan_identity = ['官', 'zhong'];
                                        }
                                    }
                                }
                            }
                            player.storage.tahp = player.storage.tamaxhp;
                        },
                    }
                    lib.skill._guandieskill = {
                        trigger: {
                            player: ["dieBefore"],
                        },
                        priority: -99,
                        forced: true,
                        filter: function(event, player) {
                            if (get.mode() != 'identity') return false;
                            if (player.hasSkill('jingcheng')) return false;
                            if (player.identity != 'zhu') return false;
                            return true;
                        },
                        content: function() {
                            'step 0';
                            if (trigger.source) game.zuanExp(trigger.source, 25);
                            var skills = player.getSkills(true, false);
                            for (var i = 0; i < skills.length; i++) {
                                var info = get.info(skills[i]);
                                if (skills[i] == 'thundershow' || skills[i] == 'jingcheng' || skills[i] == 'bazhu' || skills[i] == 'guanfu' || info.charlotte) {
                                    skills.splice(i--, 1);
                                }
                            }
                            player.disableSkill('lockskill', skills);
                            'step 1';
                            player.addMark('zuan_panjun', 2, false);
                            if (lib.config['extension_祖安设置_newover']) {
                                if (player.storage.zuan_guanbing >= 10) {
                                    //内奸获胜的条件是结束游戏时还活着
                                    if (game.me.identity == 'nei') {
                                        if (game.me.isAlive()) {
                                            game.over(true);
                                        } else {
                                            game.over(false);
                                        }
                                    } else if (player.isFriendsOf(game.me)) {
                                        game.over(false);
                                    } else {
                                        game.over(true);
                                    }
                                } else if (player.storage.zuan_panjun >= 10) {
                                    //内奸获胜的条件是结束游戏时还活着
                                    if (game.me.identity == 'nei') {
                                        if (game.me.isAlive()) {
                                            game.over(true);
                                        } else {
                                            game.over(false);
                                        }
                                    } else if (player.isFriendsOf(game.me)) {
                                        game.over(true);
                                    } else {
                                        game.over(false);
                                    }
                                }
                            } else {
                                if (player.storage.zuan_guanbing >= 10) {
                                    for (var i = 0; i < game.players.length; i++) {
                                        if (!game.players[i].isFriendsOf(player)) {
                                            //if(game.players[i].identity=='fan'||game.players[i].identity=='nei'){
                                            game.players[i].die();
                                        }
                                    }
                                } else if (player.storage.zuan_panjun >= 10) {
                                    player.die();
                                }
                            }
                            trigger.cancel();
                            player.storage.zhumaxhp = player.maxHp;
                            player.maxHp = player.storage.tamaxhp;
                            player.hp = player.storage.tahp;
                            player.addSkill('jingcheng');
                            player.update();
                            'step 2';
                            player.link(false);
                            player.turnOver(false);
                            player.discard(player.getCards('hej'));
                            'step 3';
                            if (game.getLocalItem('ZUANbingletexiaoSET', 'mode')) {
                                if (player.storage.dyingimgshow) {
                                    player.storage.dyingimgshow = false;
                                    game.broadcastAll(function(player) {
                                        player.storage.dying_img.style.opacity = 0; //'translateY(-200px)'
                                        player.storage.dying_img.delete();
                                    },
                                    player);
                                }
                                event.newui = parseFloat(lib.config['extension_祖安设置_newui']);
                                var translists = ['none', 'tutou', 'shousha', 'zhounian'];
                                player.storage.jingchengimgshow = true;
                                game.broadcastAll(function(player) {
                                    player.storage.jingcheng_img = document.createElement('div');
                                    if (event.newui != '0') {
                                        player.storage.jingcheng_img.setBackgroundImage('extension/祖安武将/cover/' + translists[event.newui] + '_guanfu.png');
                                    }
                                    //player.storage.jingcheng_img.style.opacity=lib.config.zuancoveropacity;
                                    player.storage.jingcheng_img.style.opacity = lib.config.zuancoveropacity;
                                    player.storage.jingcheng_img.style.backgroundSize = 'cover';
                                    player.storage.jingcheng_img.style.width = '100%';
                                    player.storage.jingcheng_img.style.height = '100%';
                                    player.storage.jingcheng_img.style.opacity = 0; //'translateY(-200px)'
                                    player.node.avatar.appendChild(player.storage.jingcheng_img);
                                    ui.refresh(player.storage.jingcheng_img);
                                    player.storage.jingcheng_img.style.transition = 'all 0.7s'; //TIETU
                                    player.storage.jingcheng_img.style.opacity = 1; //transform='';
                                },
                                player);
                            }
                            var tex = lib.config['extension_祖安设置_texiao'];
                            if (tex) {
                                game.newalive('extension/祖安武将/mode/mode_guanfu.gif', 3.5, lib.config.zuancoveropacity);
                                /*if((parseFloat(lib.config['extension_祖安设置_wallpaper'])!='1'||(lib.config['extension_祖安设置_exwallpaper']&&lib.config.zuanexwallpaper=='on'))&&parseFloat(lib.config['extension_祖安设置_isPC'])!='0') {
						            setTimeout(function () {
			                            game.broadcastAll()+ui.background.setBackgroundImage(lib.config.zuanbackground);
								    // ---------------------------------------动态壁纸刷新
						            }, 3500);
						        }*/
                            }
                            player.addSkill('notarget');
                            player.identity = 'zhu';
                            player.setIdentity('亡');
                            player.node.identity.dataset.color = 'zhu';
                            player.identityShown = true;
                            player.storage.zuan_identity = ['亡', 'zhu'];
                        },
                    }
                }
                // ---------------------------------------群雄争霸------------------------------------------//  
                if (parseFloat(lib.config['extension_祖安设置_mode']) == '3') {
                    lib.skill._qunxiongzhengbaskill = {
                        trigger: {
                            player: ["enterGame"],
                            global: "gameDrawAfter",
                        },
                        forced: true,
                        filter: function(event, player) {
                            if (get.mode() != 'identity') return false;
                            if (player.identity != 'zhu') return false;
                            return true;
                        },
                        priority: 100,
                        content: function() {
                            "step 0";
                            player.addSkill('qunxiongkill');
                        },
                    }
                }
                // ---------------------------------------攻守京城------------------------------------------//  
                if (parseFloat(lib.config['extension_祖安设置_mode']) == '2') {
                    if (lib.config['extension_祖安设置_balance']) {
                        lib.skill._zhongzhubuff = {
                            mod: {
                                cardSavable: function(card, player) {
                                    if (get.mode() != 'identity') return;
                                    if (!_status.currentPhase) return;
                                    var idelist = ['zhu', 'zhong', 'mingzhong'];
                                    if (_status.currentPhase.isAlive() && (idelist.contains(_status.currentPhase.identity)) && _status.currentPhase != player) {
                                        if (card.name == 'tao' && !player.isDying() && (player.identity == 'fan')) return false;
                                    }
                                },
                                cardEnabled: function(card, player) {
                                    if (get.mode() != 'identity') return;
                                    if (!_status.currentPhase) return;
                                    var idelist = ['zhu', 'zhong', 'mingzhong'];
                                    if (_status.currentPhase.isAlive() && (idelist.contains(_status.currentPhase.identity)) && _status.currentPhase != player) {
                                        if (card.name == 'tao' && !player.isDying() && (player.identity == 'fan')) return false;
                                    }
                                },
                            },
                        }
                        lib.skill._jingchengadddie = {
                            trigger: {
                                player: "die",
                            },
                            priority: 99,
                            silent: true,
                            forceDie: true,
                            filter: function(event, player) {
                                if (get.mode() != 'identity') return false;
                                return player.storage.relife_plus < 10;
                            },
                            content: function() {
                                'step 0';
                                player.storage.relife_plus++;
                                'step 1';
                                var num = player.storage.relife_plus;
                                if (num % 2 == 0) game.log(player, '延长了<span class=\"zuantext\" style=\"color: #A9A9A9\">一回合的复活时间</span>');
                                player.storage.relife += Math.floor(num / 2);
                            },
                        }
                    }
                    lib.skill._zhongfandieskill = {
                        trigger: {
                            player: "die",
                        },
                        priority: 97,
                        silent: true,
                        forceDie: true,
                        direct: true,
                        forced: true,
                        filter: function(event, player) {
                            if (get.mode() != 'identity') return false;
                            if (player.identity == 'zhu') return false;
                            return lib.config['extension_祖安设置_balance'];
                        },
                        content: function() {
                            var ide = player.identity;
                            if (ide == 'fan') {
                                if (game.dead.length > 0) {
                                    var fan = [];
                                    for (var i = 0; i < game.dead.length; i++) {
                                        var dd = game.dead[i];
                                        if (dd.identity == 'fan' && dd != player) {
                                            fan.push(dd);
                                        }
                                    }
                                    if (fan.length > 0) {
                                        var lucky = fan.randomGet();
                                        lucky.storage.relife++;
                                        game.log(lucky, '延长了<span class=\"zuantext\" style=\"color: #A9A9A9\">一回合的复活时间</span>');
                                    }
                                }
                            } else if (ide == 'zhong') {
                                var zhu = game.filterPlayer(function(current) {
                                    return current.identity == 'zhu';
                                })[0];
                                if (!zhu.hasSkill('jingcheng')) zhu.loseHp();
                            }
                        },
                    }
                    lib.skill._tamodeskill = {
                        trigger: {
                            player: ["enterGame"],
                            global: "gameDrawAfter",
                        },
                        forced: true,
                        filter: function(event, player) {
                            if (get.mode() != 'identity') return false;
                            if (player.identity != 'zhu') return false;
                            return true;
                        },
                        content: function() {
                            player.storage.zhumaxhp = player.maxHp;
                            player.storage.tamaxhp = 0;
                            player.storage.tahp = 0;
                            player.storage.zhongnum = 0;
                            var nei = 0;
                            var balance = lib.config['extension_祖安设置_balance'];
                            if (game.players.length == 8 || game.players.length == 6) var nei = 1;
                            if (balance) {
                                player.setIdentity('主');
                                player.node.identity.dataset.color = 'zhu';
                                player.identityShown = true;
                            }
                            for (var i = 0; i < game.players.length; i++) {
                                if (balance) game.players[i].storage.relife_plus = 0;
                                var idelist = ['zhong', 'mingzhong'];
                                if (idelist.contains(game.players[i].identity) && balance) {
                                    if (game.players[i] == game.me) game.players[i].setIdentity('忠');
                                    if (game.players[i] == game.me) game.players[i].node.identity.dataset.color = 'zhong';
                                    player.storage.zhongnum++;
                                }
                                if (game.players[i].identity == 'fan') {
                                    if (game.players[i] == game.me && balance) game.players[i].setIdentity('反');
                                    if (game.players[i] == game.me && balance) game.players[i].node.identity.dataset.color = 'fan';
                                    player.storage.tamaxhp += 8;
                                }
                                if (game.players[i].identity == 'nei' && balance) {
                                    if (nei == 0) {
                                        game.players[i].identity = 'fan';
                                        if (game.players[i] == game.me) game.players[i].setIdentity('反');
                                        if (game.players[i] == game.me) game.players[i].node.identity.dataset.color = 'fan';
                                        var nei = 1;
                                        player.storage.tamaxhp += 8;
                                    } else {
                                        game.players[i].identity = 'zhong';
                                        if (game.players[i] == game.me) game.players[i].setIdentity('忠');
                                        if (game.players[i] == game.me) game.players[i].node.identity.dataset.color = 'zhong';
                                        var nei = 0;
                                    }
                                }
                            }
                            player.storage.tahp = player.storage.tamaxhp;
                        },
                    }
                    lib.skill._zhudieskill = {
                        trigger: {
                            player: ["dieBefore"],
                        },
                        priority: -99,
                        forced: true,
                        filter: function(event, player) {
                            if (get.mode() != 'identity') return false;
                            if (player.hasSkill('jingcheng')) return false;
                            if (player.identity != 'zhu') return false;
                            return true;
                        },
                        content: function() {
                            'step 0';
                            if (trigger.source && trigger.source.isIn() && trigger.source != player) {
                                game.zuanExp(trigger.source, 25);
                                if (trigger.source.identity == 'fan') trigger.source.draw(3);
                            }
                            if (player.storage.relife_plus < 10) player.storage.relife_plus++;
                            var num = player.storage.relife_plus;
                            if (num % 2 == 0) game.log(player, '延长了<span class=\"zuantext\" style=\"color: #A9A9A9\">一回合的复活时间</span>');
                            player.storage.relife += Math.floor(num / 2);
                            var skills = player.getSkills(true, false);
                            for (var i = 0; i < skills.length; i++) {
                                var info = get.info(skills[i]);
                                if (skills[i].indexOf('yuanqi_')) continue;
                                if (skills[i] == 'thundershow' || skills[i] == 'jingcheng' || skills[i] == 'bazhu' || skills[i] == 'guanfu' || info.charlotte) {
                                    skills.splice(i--, 1);
                                }
                            }
                            player.disableSkill('lockskill', skills);
                            'step 1';
                            trigger.cancel();
                            player.storage.zhumaxhp = player.maxHp;
                            player.maxHp = player.storage.tamaxhp;
                            player.hp = player.storage.tahp;
                            player.addSkill('jingcheng');
                            player.update();
                            'step 2';
                            player.link(false);
                            player.turnOver(false);
                            player.discard(player.getCards('hej'));
                            'step 3';
                            if (game.getLocalItem('ZUANbingletexiaoSET', 'mode')) {
                                if (player.storage.dyingimgshow) {
                                    player.storage.dyingimgshow = false;
                                    game.broadcastAll(function(player) {
                                        player.storage.dying_img.style.opacity = 0; //'translateY(-200px)'
                                        player.storage.dying_img.delete();
                                    },
                                    player);
                                }
                                event.newui = parseFloat(lib.config['extension_祖安设置_newui']);
                                var translists = ['none', 'tutou', 'shousha', 'zhounian'];
                                player.storage.jingchengimgshow = true;
                                game.broadcastAll(function(player) {
                                    player.storage.jingcheng_img = document.createElement('div');
                                    if (event.newui != '0') {
                                        player.storage.jingcheng_img.setBackgroundImage('extension/祖安武将/cover/' + translists[event.newui] + '_jingcheng.png');
                                    }
                                    //player.storage.jingcheng_img.style.opacity=lib.config.zuancoveropacity;
                                    player.storage.jingcheng_img.style.opacity = lib.config.zuancoveropacity;
                                    player.storage.jingcheng_img.style.backgroundSize = 'cover';
                                    player.storage.jingcheng_img.style.width = '100%';
                                    player.storage.jingcheng_img.style.height = '100%';
                                    player.storage.jingcheng_img.style.opacity = 0; //'translateY(-200px)'
                                    player.node.avatar.appendChild(player.storage.jingcheng_img);
                                    ui.refresh(player.storage.jingcheng_img);
                                    player.storage.jingcheng_img.style.transition = 'all 0.7s'; //TIETU
                                    player.storage.jingcheng_img.style.opacity = 1; //transform='';
                                },
                                player);
                            }
                            var tex = lib.config['extension_祖安设置_texiao'];
                            if (tex) {
                                game.newalive('extension/祖安武将/mode/mode_jingcheng.gif', 2, lib.config.zuancoveropacity);
                                game.delay(2);
                                /*if((parseFloat(lib.config['extension_祖安设置_wallpaper'])!='1'||(lib.config['extension_祖安设置_exwallpaper']&&lib.config.zuanexwallpaper=='on'))&&parseFloat(lib.config['extension_祖安设置_isPC'])!='0') {
						            setTimeout(function () {
			                            game.broadcastAll()+ui.background.setBackgroundImage(lib.config.zuanbackground);
								    // ---------------------------------------动态壁纸刷新
						            }, 3500);
						        }*/
                            }
                            player.identity = 'zhu';
                            player.setIdentity('京');
                            player.node.identity.dataset.color = 'zhu';
                            player.identityShown = true;
                            player.storage.zuan_identity = ['京', 'zhu'];
                        },
                    }
                }
                // ---------------------------------------复活板块------------------------------------------//  
                if (parseFloat(lib.config['extension_祖安设置_mode']) == '2' || parseFloat(lib.config['extension_祖安设置_mode']) == '4') {
                    lib.skill._relifeskill = {
                        trigger: {
                            //player:["phaseBegin",'turnOverAfter'],
                            global: 'roundStart',
                        },
                        silent: true,
                        forced: true,
                        filter: function(event, player) {
                            if (get.mode() != 'identity') return false;
                            if (player.identity != 'zhu') return false;
                            //if(player.isTurnedOver()) return false;
                            return true;
                        },
                        content: function() {
                            if (game.dead.length) {
                                for (var i = 0; i < game.dead.length; i++) {
                                    var dd = game.dead[i];
                                    var dds = dd.storage.relife;
                                    dd.storage.relife--;
                                    if (!dd.storage.relife || dd.storage.relife < 1) {
                                        if (parseFloat(lib.config['extension_祖安设置_audio']) >= '2') game.playAudio('..', 'extension', '祖安武将', 'audio', 'revive.ogg');
                                        dd.revive(dd.maxHp);
                                        game.addVideo('revive', dd);
                                        event.dead = dd;
                                        dd.draw(Math.ceil(dd.storage._levelskill * 0.5));
                                        dd.storage.relife = Math.ceil(dd.storage._levelskill * 0.4 + 0.1);
                                        dd.markSkill('_expskill');
                                        dd.syncStorage('_expskill');
                                        dd.markSkill('_levelskill');
                                        dd.syncStorage('_levelskill');
                                        if (dd.hasSkill('zuan_hudun')) {
                                            dd.storage.zuan_hudun = dd.storage.zuan_maxhujia;
                                            dd.seeMark('zuan_hudun');
                                            //dd.markSkill('zuan_hudun');
                                            //dd.syncStorage('zuan_hudun');   
                                        }
                                        dd.update();
                                        dd.$damagepop('重生');
                                        game.log(dd, '<span class=\"zuantext\" style=\"color: #7CFC00\">获得了重生</span>');
                                    } else {
                                        dd.$damagepop(get.cnNumber(dd.storage.relife) + '回合');
                                        game.log(dd, '复活还剩<span class=\"zuantext\" style=\"color: #228B22\">', get.cnNumber(dd.storage.relife), '回合</span>');
                                    }
                                }
                            }
                        },
                    }
                }
            }
            // ---------------------------------------等级模式------------------------------------------//   
            if (parseFloat(lib.config['extension_祖安设置_upspeed']) != '0' || parseFloat(lib.config['extension_祖安设置_mode']) != '1') {
                lib.translate._levelskill_maxlevel = "号令";
                lib.skill._levelskill = {
                    group: ['_levelskill_maxlevel', '_levelskill_mode', '_levelskill_draw'],
                    subSkill: {
                        draw: {
                            trigger: {
                                player: "phaseDrawBegin2",
                            },
                            silent: true,
                            forced: true,
                            filter: function(event, player) {
                                if (lib.config['extension_祖安设置_levelstrong'] == 'off') return false;
                                return ! event.numFixed && player.storage._levelskill >= 9;
                            },
                            content: function() {
                                trigger.num++;
                            },
                            sub: true,
                        },
                        mode: {
                            mod: {
                                maxHandcard: function(player, num, storage) {
                                    if (lib.config['extension_祖安设置_levelstrong'] == 'off') return;
                                    var plus = 0;
                                    if (player.storage._levelskill >= 3) plus++;
                                    if (player.storage._levelskill >= 6 && lib.config['extension_祖安设置_levelstrong'] == 'old') plus++;
                                    if (plus > 0) return num + plus;
                                },
                                cardUsable: function(card, player, num, storage) {
                                    if (lib.config['extension_祖安设置_levelstrong'] == 'off') return;
                                    if (player.storage._levelskill >= 5 && card.name == 'sha') return num + 1;
                                },
                                attackFrom: function(from, to, distance) {
                                    if (lib.config['extension_祖安设置_levelstrong'] == 'new' && from.storage._levelskill >= 4) return distance - 1;
                                },
                                globalFrom: function(from, to, distance) {
                                    if (lib.config['extension_祖安设置_levelstrong'] == 'off') return;
                                    if (from.storage._levelskill >= 7) return distance - 1;
                                },
                                globalTo: function(from, to, distance) {
                                    if (lib.config['extension_祖安设置_levelstrong'] != 'new') return;
                                    if (to.storage._levelskill >= 6) return distance + 1;
                                },
                            },
                            sub: true,
                        },
                        maxlevel: {
                            enable: "phaseUse",
                            usable: 2,
                            filter: function(event, player) {
                                if (lib.config['extension_祖安设置_levelstrong'] == 'off' || player.storage._levelskill < 10) return false;
                                return player.countCards('hs') >= 2;
                            },
                            position: "hs",
                            chooseButton: {
                                dialog: function(player) {
                                    var list = [];
                                    for (var i = 0; i < lib.inpile.length; i++) {
                                        if (get.type(lib.inpile[i]) == 'basic') list.push(['基本', '', lib.inpile[i]]);
                                    }
                                    return ui.create.dialog('号令群雄', [list, 'vcard']);
                                },
                                filter: function(button, player) {
                                    return lib.filter.filterCard({
                                        name: button.link[2]
                                    },
                                    player, _status.event.getParent());
                                },
                                check: function(button) {
                                    var player = _status.event.player;
                                    var recover = 0,
                                    lose = 1,
                                    players = game.filterPlayer();
                                    for (var i = 0; i < players.length; i++) {
                                        if (players[i].hp == 1 && get.damageEffect(players[i], player, player) > 0 && !players[i].hasSha()) {
                                            return (button.link[2] == 'sha') ? 2 : -1;
                                        }
                                        if (!players[i].isOut()) {
                                            if (players[i].hp < players[i].maxHp) {
                                                if (get.attitude(player, players[i]) > 0) {
                                                    if (players[i].hp < 2) {
                                                        lose--;
                                                        recover += 0.5;
                                                    }
                                                    lose--;
                                                    recover++;
                                                } else if (get.attitude(player, players[i]) < 0) {
                                                    if (players[i].hp < 2) {
                                                        lose++;
                                                        recover -= 0.5;
                                                    }
                                                    lose++;
                                                    recover--;
                                                }
                                            } else {
                                                if (get.attitude(player, players[i]) > 0) {
                                                    lose--;
                                                } else if (get.attitude(player, players[i]) < 0) {
                                                    lose++;
                                                }
                                            }
                                        }
                                    }
                                    if (lose > recover && lose > 0) return (button.link[2] == 'sha') ? 1 : -1;
                                    if (lose < recover && recover > 0) return (button.link[2] == 'tao') ? 1 : -1;
                                    return (button.link[2] == 'tao') ? 1 : -1;
                                },
                                backup: function(links, player) {
                                    return {
                                        filterCard: true,
                                        selectCard: 2,
                                        audio: 2,
                                        popname: true,
                                        viewAs: {
                                            name: links[0][2]
                                        },
                                    }
                                },
                                prompt: function(links, player) {
                                    return '将两张手牌当作' + get.translation(links[0][2]) + '使用';
                                },
                            },
                            ai: {
                                order: 2,
                                result: {
                                    player: function(player) {
                                        var num = 0;
                                        var cards = player.getCards('hs');
                                        if (cards.length >= 3 && player.hp >= 3) return 0;
                                        for (var i = 0; i < cards.length; i++) {
                                            num += Math.max(0, get.value(cards[i], player, 'raw'));
                                        }
                                        num /= cards.length;
                                        num *= Math.min(cards.length, player.hp);
                                        return 12 - num;
                                    },
                                },
                            },
                        },
                    },
                    marktext: "<img style=width:15px src=" + lib.assetURL + "extension/祖安武将/basic/zuan_level.png>",
                    //marktext:"级",
                    trigger: {
                        player: ["enterGame"],
                        global: "gameDrawAfter",
                    },
                    priority: 987,
                    silent: true,
                    forced: true,
                    filter: function(event) {
                        return true;
                    },
                    content: function() {
                        player.addMark('_levelskill', 1, false);
                        player.storage.relife = Math.ceil(player.storage._levelskill * 0.4 + 0.1);
                        var chat = ['游戏已开始，请赶快获得经验以提升等级哦~', '欢迎来到战局！祝我们游戏顺利~', '游戏已开始，请放心游玩呢'].randomGet();
                        if (player == game.me) player.say(chat);
                        //if(lib.config['extension_祖安设置_levelstrong']) player.addSkill('levelcard');
                    },
                    ai: {
                        threaten: function(player, target) {
                            if (target.storage._levelskill) return target.storage._levelskill * 0.5;
                        },
                    },
                    intro: {
                        name: "等级",
                        content: function(storage, player, skill) {
                            var level = player.storage._levelskill;
                            var str = '◈当前等级 ' + level + '/10级';
                            if (lib.config['extension_祖安设置_levelstrong'] == 'old') {
                                if (level < 3) var str = str + '<li>尚未获得任何强化';
                                if (level >= 3) var str = str + '<li>手牌上限+1';
                                if (level >= 4) var str = str + '<li>获得一点护甲';
                                if (level >= 5) var str = str + '<li>【杀】的使用次数+1';
                                if (level >= 6) var str = str + '<li>手牌上限+1';
                                if (level >= 7) var str = str + '<li>攻击距离+1';
                                if (level >= 8) var str = str + '<li>获得一点体力上限';
                                if (level >= 9) var str = str + '<li>摸牌阶段额外摸一张牌';
                                if (level >= 10) var str = str + '<li>出牌阶段限两次，可将两张手牌当一张基本牌使用';
                            } else if (lib.config['extension_祖安设置_levelstrong'] == 'new') {
                                if (level < 3) var str = str + '<li>尚未获得任何强化';
                                if (level >= 3) var str = str + '<li>手牌上限+1';
                                if (level >= 4) var str = str + '<li>【杀】的使用范围+1';
                                if (level >= 5) var str = str + '<li>【杀】的使用次数+1';
                                if (level >= 6) var str = str + '<li>防御距离+1';
                                if (level >= 7) var str = str + '<li>进攻距离+1';
                                if (level >= 8) var str = str + '<li>体力上限+1';
                                if (level >= 9) var str = str + '<li>摸牌阶段摸牌数+1';
                                if (level >= 10) var str = str + '<li>出牌阶段限两次，可将两张手牌当一张基本牌使用';
                            } else {
                                if (!lib.config['extension_祖安设置_balance']) var str = str + '<li>每提升一个等级可以摸一张牌';
                            }
                            return str;
                        }
                    },
                }
                lib.skill._expskill = {
                    marktext: "经",
                    trigger: {
                        player: ["phaseBegin"],
                        source: "damageSource",
                    },
                    marktext: "<img style=width:15px src=" + lib.assetURL + "extension/祖安武将/basic/zuan_exp.png>",
                    priority: 200,
                    silent: true,
                    forced: true,
                    filter: function(event, player) {
                        return ! player.hasSkill('jingcheng');
                    },
                    content: function() {
                        var adds = trigger.name == 'damage' ? trigger.num * 7 : 3;
                        game.zuanExp(player, adds);
                    },
                    intro: {
                        name: "经验",
                        content: function(storage, player, skill) {
                            var maxexp = 20 + 2 * player.storage._levelskill;
                            var str = '<li>距离下一级已有 ' + player.storage._expskill + '/' + maxexp + '经验'
                            return str;
                        }
                    },
                }

                lib.skill._exp2skill = {
                    trigger: {
                        player: ["recoverEnd"],
                    },
                    priority: 200,
                    silent: true,
                    forced: true,
                    filter: function(event, player) {
                        return ! player.hasSkill('jingcheng');
                    },
                    content: function() {
                        var add = trigger.num * (player.maxHp - player.hp + 1) * 2;
                        game.zuanExp(player, add);
                    },
                }

                lib.skill._useskill = {
                    usable: 3,
                    trigger: {
                        player: ["useCard"],
                    },
                    priority: 200,
                    silent: true,
                    forced: true,
                    filter: function(event) {
                        return true;
                    },
                    content: function() {
                        game.zuanExp(player, 2);
                    },
                }

                lib.skill._killskill = {
                    trigger: {
                        source: ["dieBegin"],
                    },
                    priority: 200,
                    silent: true,
                    forced: true,
                    filter: function(event, player) {
                        return ! player.hasSkill('jingcheng');
                    },
                    content: function() {
                        game.zuanExp(player, 25);
                    },
                }
            }
            // ---------------------------------------祖安对话------------------------------------------//
            //if(parseFloat(lib.config['extension_祖安设置_zuan'])!='1'){
            //重写对话代码
            //zzsay
            //开始游戏
            var offline = sessionStorage.getItem('Network');
            if (!offline) offline = 'online';
            if (offline != 'offline') {
                game.wanqingIsOpen = false;
            } else {
                game.wanqingIsOpen = true;
            }
            /*if(lib.config.extensions.contains('晚晴回响')) {
		        if(!game.wanqing==undefined) game.wanqingIsOpen=true;
		    }*/
            game.zuanSayCold = [];
            lib.skill._zuanSTARTsayskill = {
                trigger: {
                    player: "enterGame",
                    global: "gameDrawAfter",
                },
                filter: function(event, player) {
                    if (game.wanqingIsOpen) return false;
                    if (lib.config['extension_祖安设置_zuantype'].indexOf('new') == -1) return false;
                    if (lib.config['extension_祖安设置_zuantype'] == 'new_chg') {
                        if (player == game.me) return false;
                        if (game.zuanSayCold.contains(player)) return false;
                    }
                    return parseFloat(lib.config['extension_祖安设置_ransay']) != '0';
                },
                forced: true,
                silent: true,
                priority: -5,
                content: function() {
                    'step 0';
                    //概率随机模块
                    if (Math.random() * 100 >= parseFloat(lib.config['extension_祖安设置_ransay'])) {
                        if (event && event.finish) {
                            event.finish();
                        } else {
                            return;
                        }
                    }
                    'step 1';
                    //加载说话宝典
                    event.male = ['达瓦列西，将胜利铺满童年里的每一寸欢愉', '这把我的状态很好，想必到我的回合，又是一场腥风血雨', '看我这一手，妙手俗手本手，神之一手！', '这局对面不是一般的嚣张啊！', '该我上场表演了！', '一人一枪一匹马，疆场尽驰骋', '一生纵横，怎可对他人称臣！', '睁开你的眼睛看看，现在是谁嗦了蒜', '我的霸业才刚刚开始！', '你可闪得过洗衣机？', '千秋万载，一统江山！', '在下不才但话很多新疆的', '丞相助我！'];
                    event.female = ['哥哥姐姐，妹妹弟弟，一起加油哦！', '开语音，开语音，玩游戏必须要开语音', '你是小哥哥还是小姐姐呀', '么么叽，么么么么么么叽', '大将军岂可有勇无谋？', '哼，易如反掌！', '睁开你的眼睛看看，现在是谁嗦了蒜', '活动大方，维岂有不氪之理？', '公瑾，我先走一步', '你可闪得过洗衣机？', '思念催人老，终不敌似水流年', '大小姐驾到，统统闪开！'];
                    'step 2';
                    //判断角色性别
                    if (player.hasSex('female')) {
                        if (player.hasSex('male')) {
                            event.sex = ['male', 'female'].randomGet();
                        } else {
                            event.sex = 'female';
                        }
                    } else {
                        event.sex = 'male';
                    }
                    'step 3';
                    //组装语言模块
                    event.said = event[event.sex];
                    event.chat = event.said.randomGet();
                    'step 4';
                    //最后一道关卡，加载失败就不说话了
                    'step 5';
                    if (lib.config['extension_祖安设置_zuantype'] == 'new_chg') {
                        var ransec = (2 + [0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 12, 13, 14, 15, 15, 15, 20, 40].randomGet()) * 1000 + [0, 0, 3, 5, 7].randomGet() * 100;
                        if (!game.zuanSayCold.contains(player)) game.zuanSayCold.push(player);
                        if (ransec > 0) setTimeout(function() {
                            if (game.zuanSayCold.contains(player)) game.zuanSayCold.remove(player);
                        },
                        ransec);
                        setTimeout(function() {
                            player.say(event.chat);
                        },
                        Math.ceil(Math.random() * 2000));
                    } else {
                        player.say(event.chat);
                    }
                },
            }
            game.ZAcardlist = [
            //标准包
            'sha', 'shan', 'tao', 'guohe', 'jiedao', 'juedou', 'nanman', 'shunshou', 'taoyuan', 'wanjian', 'wugu', 'wuxie', 'wuzhong', 'lebu', 'shandian', 'cixiong', 'fangtian', 'guanshi', 'hanbing', 'qilin', 'qinggang', 'qinglong', 'zhangba', 'zhuge', 'bagua', 'renwang', 'dilu', 'jueying', 'zhuahuang', 'chitu', 'dayuan', 'zixin',
            //军争包
            'jiu', 'huogong', 'tiesuo', 'bingliang', 'guding', 'zhuque', 'baiyin', 'tengjia', 'hualiu', 'muniu',
            //忠肝义胆
            'jinchan', 'qijia', 'shengdong', 'zengbin', 'caomu', 'fulei', 'qibaodao', 'yinyueqiang', 'zhungangshuo', 'lanyinjia',
            //运筹帷幄
            'caochuanjiejian', 'chenhuodajie', 'diaobingqianjiang', 'fudichouxin', 'geanguanhuo', 'shezhanqunru', 'shuigong', 'toulianghuanzhu', 'wangmeizhike', 'youdishenru', 'hongshui', 'huoshan', 'suolianjia', ];
            game.ZAuseSay_me_none = {
                'none': { //未知
                    male: ['这啥'],
                    female: ['阿巴阿巴'],
                },
                //标准包
                'sha': { //杀
                    male: ['我杀我自己'],
                    female: ['剪个指甲'],
                },
                'shan': { //闪
                    male: ['没事掉什么血'],
                    female: ['不想剪了'],
                },
                'tao': { //桃
                    male: ['吃个桃桃', '好舒服啊', '一桃解愁'],
                    female: ['喝点补品', '休息一下吧', '补妆啦不要偷窥哟'],
                },
                'guohe': { //过河拆桥
                    male: ['自断后路', '什么台阶，我不要了', '哥就是这么豪迈'],
                    female: ['坏了就扔掉', '没用了就送给弃牌堆吧', '姐玩的就是真实'],
                },
                'jiedao': { //借刀杀人
                    male: ['还是自己的刀拿着顺手', '我的刀磨好了', '看我拿下这把武器'],
                    female: ['取下小刀削水果', '指甲刀剪指甲', '小哥哥们都看向我'],
                },
                'juedou': { //决斗
                    male: ['将自己当成斗争目标，成长领悟的最高境界', '世人笑我痴狂，我笑世人决斗打不到自己脸上', '我狠起来自己都打'],
                    female: ['可以S，好诶', '轻点，不然会打翻自己的香水', '突然想去看皮影戏了'],
                },
                'nanman': { //南蛮入侵
                    male: ['我似乎是蜀川人', '我敢入侵自己的村庄，你们敢嘛？', '我乃孟获蛮族间谍'],
                    female: ['哎呀，卖下血啦', '幽薮影单，只身勇斗', '真薮影移，险战不惧'],
                },
                'shunshou': { //顺手牵羊
                    male: ['自摸', '家里羊多，背着家人偷一只', '掏掏家底'],
                    female: ['拿来吧我', '翻翻我的胭脂盒', '找找我的粉底霜'],
                },
                'taoyuan': { //桃园结义
                    male: ['同云称兄，与土道弟', '寿与天齐，道与地平'],
                    female: ['以天为被，以地为床', '世间男子多薄情，求男不如依女拜己'],
                },
                'wanjian': { //万箭齐发
                    male: ['万箭钻心之痛，我细细品吧', '看我发动雷击'],
                    female: ['酱紫挤荡座巴辛', '手术减肥'],
                },
                'wugu': { //五谷丰登
                    male: ['好想独吞', '看我找麦克风'],
                    female: ['好多牌耶', '一人一张排队拿好，不要乱插队'],
                },
                'wuxie': { //无懈可击
                    male: ['不要乱动', '这叫化劲'],
                    female: ['你别想碰！', '男女授受不亲，注意影响'],
                },
                'wuzhong': { //无中生有
                    male: ['同志们同志们，看我秀起来', '无中一无中'],
                    female: ['看能不能碰着无中', '好东西啊！'],
                },
                'lebu': { //乐不思蜀
                    male: ['自己的家就是温柔乡', '我不出家门了'],
                    female: ['黄花大闺女', '四德不曾出门'],
                },
                'shandian': { //闪电
                    male: ['让暴风来的更猛烈些吧', '我们每个人都有罪，特别是那大魏', '看我雷劈之术', '积雷木何在？'],
                    female: ['看小女子略施把戏', '少女的把戏，小小的花招', '小女子已卜好了卦', '让我窥探我军气运'],
                },
                'cixiong': { //雌雄双股剑
                    male: ['看我再展双股剑之雄风'],
                    female: ['身姿飘盈，一展雌剑之脱力'],
                },
                'fangtian': { //方天画戟
                    male: ['看我再展画戟转天之技'],
                    female: ['好重，但爱的就是这般雄壮'],
                },
                'guanshi': { //贯石斧
                    male: ['看我再展大斧贯石之能'],
                    female: ['大斧似乎不太雅观'],
                },
                'hanbing': { //寒冰剑
                    male: ['看我再展宝剑寒骨冰心之法'],
                    female: ['刷个剑剑，好凉凉'],
                },
                'qilin': { //麒麟弓
                    male: ['看我再展麒麟去马之弓'],
                    female: ['吾射不亦精乎'],
                },
                'qinggang': { //青釭剑
                    male: ['看我再展青釭破盾之效'],
                    female: ['大家穿的再多也没用~'],
                },
                'qinglong': { //青龙偃月刀
                    male: ['看我再展偃月之青龙'],
                    female: ['拿来劈西瓜咯'],
                },
                'zhangba': { //丈八蛇矛
                    male: ['看我再展蛇矛幻杀之能'],
                    female: ['其实我怕蛇啦'],
                },
                'zhuge': { //诸葛连弩
                    male: ['看我再展连弩连杀之技'],
                    female: ['突突突'],
                },
                'bagua': { //八卦阵
                    male: ['看我再展无中生闪之能'],
                    female: ['太极生两仪，两仪生四象，四象生八卦'],
                },
                'renwang': { //仁王盾
                    male: ['看我再展仁王御黑之效'],
                    female: ['好重的黑盾'],
                },
                'dilu': { //的卢
                    male: ['看我再展霹雳之风'],
                    female: ['慢点，要受不了啦'],
                },
                'jueying': { //绝影
                    male: ['看我再展绝地无影之速'],
                    female: ['一骑绝尘，不留踪影，但似乎不适合我'],
                },
                'zhuahuang': { //爪黄飞电
                    male: ['看我再展电上飞花'],
                    female: ['飞电般极速'],
                },
                'chitu': { //赤兔
                    male: ['看我再展西凉汗血之能'],
                    female: ['汗血宝马，岂是徒有虚名'],
                },
                'dayuan': { //大宛
                    male: ['看我再展大奔之威'],
                    female: ['大宛不愿怨'],
                },
                'zixin': { //紫骍
                    male: ['看我再展减一神马之能'],
                    female: ['紫色的马儿，符合我的气质'],
                },
                //军争
                'jiu': { //酒
                    male: ['来点小酒', '何以解忧？唯有杜康', '一酒解千愁', '借酒浇愁'],
                    female: ['快醉了，哥哥扶我一扶', '贵妃醉酒', '醉观音', '醉芙蓉'],
                },
                'huogong': { //火攻
                    male: ['看我卖血', '手里有废牌，怎么办？', '横扫六合，席卷八荒', '燃烧吧'],
                    female: ['我真滴烧', '都烧到我自己了，呜呜呜', '好像发烧了'],
                },
                'tiesuo': { //铁索
                    male: ['通通连起来吧', '自爆兵已就绪', '来个人，和我一起相连'],
                    female: ['自我捆绑play', '燥起来', '好想和你背靠背，捆在一起'],
                },
                'bingliang': { //兵粮寸断
                    male: ['饥饿营销', '家里粮太多，根本吃不完'],
                    female: ['会不会以后没饭吃', '姐就是吃饱了撑得，你管得着嘛？'],
                },
                'guding': { //古锭刀
                    male: ['看我再展古锭刀加伤之威'],
                    female: ['这刀可能会很痛哟'],
                },
                'zhuque': { //朱雀羽扇
                    male: ['看我再展羽扇朱雀引炎之法'],
                    female: ['法术伤害来啦'],
                },
                'baiyin': { //白银狮子
                    male: ['看我再展银盔雄狮护身之效'],
                    female: ['这下不怕痛了呢'],
                },
                'tengjia': { //藤甲
                    male: ['看我再展藤甲御蛮拒公之能'],
                    female: ['再也不怕南蛮和万箭了'],
                },
                'hualiu': { //骅骝
                    male: ['看我再展虎威骅骝之力'],
                    female: ['马背上是高傲的骑士，马蹄下是凄荒的残尸'],
                },
                'muniu': { //木牛流马
                    male: ['看我再展木车牛之运力马之运速'],
                    female: ['有了钱包，这下就不怕没地方装钱啦'],
                },
                //忠肝义胆
                'jinchan': { //金蝉脱壳
                    male: ['平日少钱财，金蝉换酒来', '不要了，来点好牌'],
                    female: ['似乎是个宝贝，废品也值钱', '用这剩下的东西换些化妆品'],
                },
                'qijia': { //弃甲曳兵
                    male: ['全都不要了，跑的更快', '自己家的东西我也不要了'],
                    female: ['扔了吧，不稀罕', '看我轻装简从'],
                },
                'shengdong': { //声东击西
                    male: ['住宅外有两个邻居，那东房是我的，那西房也是我的', '东家西家都是我'],
                    female: ['我真的可以这么做嘛？', '看好我这波，秀操作'],
                },
                'zengbin': { //增兵减灶
                    male: ['变相无中', '减了灶，有变弱嘛？'],
                    female: ['卖掉了旧衣裳，但我获得了更多的钱经商', '看我连招发动'],
                },
                'caomu': { //草木皆兵
                    male: ['发动技能弘援', '队友们，看你们的了'],
                    female: ['哥哥们，小女子尽力了', '苦了自己也不能苦了大家'],
                },
                'fulei': { //浮雷
                    male: ['浮雷烁烁，吃席我坐，大魏那桌', '看我闹事'],
                    female: ['人家可是欧洲女子', '请来了积雷木'],
                },
                'qibaodao': { //七宝刀
                    male: ['看我再展宝刀七星撕裂伤口之能'],
                    female: ['第一次会很痛哦，以后就不痛了'],
                },
                'yinyueqiang': { //银月枪
                    male: ['看我再展银月追击之效'],
                    female: ['动如脱兔，触则反冲'],
                },
                'zhungangshuo': { //衠钢槊
                    male: ['看我再展钢槊互伤之法'],
                    female: ['这一刀，可没那么容易闪过去'],
                },
                'lanyinjia': { //烂银甲
                    male: ['看我再战银甲难缠之风'],
                    female: ['狗皮膏药已上线'],
                },
                //运筹帷幄
                'caochuanjiejian': { //草船借箭
                    male: ['草人是我的，箭还是我的'],
                    female: ['小船是小女子家的，那大船是我爹的'],
                },
                'chenhuodajie': { //趁火打劫
                    male: ['我似乎打不了自己的劫'],
                    female: ['可恶，人家碰不到自己'],
                },
                'diaobingqianjiang': { //调兵遣将
                    male: ['过一下手牌'],
                    female: ['翻翻有没有宝藏'],
                },
                'fudichouxin': { //釜底抽薪
                    male: ['我就喜欢纯铁块'],
                    female: ['拿起铁块就砸'],
                },
                'geanguanhuo': { //隔岸观火
                    male: ['大火似乎烧着了我家的房子'],
                    female: ['我只喜欢看着家国烧为灰烬'],
                },
                'shezhanqunru': { //舌战群儒
                    male: ['看我如何雄辩群英'],
                    female: ['巧舌如簧，能言善辩'],
                },
                'shuigong': { //水攻
                    male: ['脱了衣服和你们打'],
                    female: ['这轻纱，不穿也罢'],
                },
                'toulianghuanzhu': { //偷梁换柱
                    male: ['自我检查'],
                    female: ['我的头发似乎有点长了'],
                },
                'wangmeizhike': { //望梅止渴
                    male: ['有点渴，看看梅'],
                    female: ['可惜了，吃不着'],
                },
                'youdishenru': { //诱敌深入
                    male: ['我扇我自己一耳光'],
                    female: ['着迷于我自己'],
                },
                'hongshui': { //洪水
                    male: ['看我驱水破地'],
                    female: ['女子不才，可引洪水本来'],
                },
                'huoshan': { //火山
                    male: ['看我移来一座火山，定除无利之百害'],
                    female: ['女子不恭，效仿愚公伴祝融'],
                },
                'suolianjia': { //锁链甲
                    male: ['看我再展链祛雷火之法'],
                    female: ['张角快来劈我'],
                },
            };
            game.ZAuseSay_me_from = {
                'none': { //未知
                    male: ['这个如何？', '看到我出的牌了吗', '这招，你把握不住', '接招吧', '哈哈，怕了吗？', '就问你怕不怕'],
                    female: ['看我表演啦', '喜欢这个嘛', '你觉得怎样？', '该我上场表演啦', '看看这个', '让你瞧瞧老娘的厉害'],
                },
                'sha': { //杀
                    male: ['我汤姆劈你', '我砍废你', '你能抗住我这一刀吗', '我赌你的牌里没有闪'],
                    female: ['这一拳三十年的功力，你挡得住嘛？', '一刀送你上月宫', '呜呜呜..控制不住这把刀', '代表月亮消灭你'],
                },
                'shan': { //闪
                    male: ['你杀的了我？', '凭你，也想动我？', '防出去了', '小虫子，不足挂齿'],
                    female: ['不怕你哦', '坏家伙，打人家；打不着，浪费杀', '一闪一闪亮晶晶', '牌堆里都是闪'],
                },
                'tao': { //桃
                    male: ['好兄弟，有我在', '我是你最坚强的后盾', '兄弟，桃来了'],
                    female: ['有我在，别害怕', '我和你一起战斗', '我不会把你放弃'],
                },
                'guohe': { //过河拆桥
                    male: ['看我拆你的台', '台阶什么的，我早就帮你断了', '敞开天窗说亮话'],
                    female: ['你身上有脏东西，我帮你清理掉吧', '咦惹，好吓人，我帮你解决掉', '废旧物品还是不要了吧'],
                },
                'jiedao': { //借刀杀人
                    male: ['这刀岂是你配用的', '武器和友情，选一个吧', '刀来！'],
                    female: ['武器给人家看一下嘛', '哇，真漂亮，给人家嘛', '家里缺个挂件，我看这个就不错诶'],
                },
                'juedou': { //决斗
                    male: ['速来一决雌雄', '让我看看你有什么能耐', '且来与我一战'],
                    female: ['来比比技术嘛？', '让让人家，不要太痛嘛', '谁说女子不如男'],
                },
                'nanman': { //南蛮入侵
                    male: ['化身蛮神，等待王的收割', '鞑靼入侵', '南蛮很大，你们忍一下'],
                    female: ['南蛮女子亦不输中原织妓', '大象很厉害吧', '我不是故意伤害大家的'],
                },
                'shunshou': { //顺手牵羊
                    male: ['让我摸摸！', '你的东西，很大哦～', '偷袭'],
                    female: ['拿来吧你', '你好像有很多羊诶，分我一只吧', '有化妆包嘛？'],
                },
                'taoyuan': { //桃园结义
                    male: ['好兄弟，一起走', '歃血为盟'],
                    female: ['好姐妹，手牵手', '义结金兰'],
                },
                'wanjian': { //万箭齐发
                    male: ['大嘴降临', '谁也挡不住，我的箭阵'],
                    female: ['哥哥们会嫌弃我嘛？', '不要出闪嘛，好哥哥～'],
                },
                'wugu': { //五谷丰登
                    male: ['地主家发粮', '好东西分给你一张'],
                    female: ['将军们，牌来了', '要接受小女子的礼物哟'],
                },
                'wuxie': { //无懈可击
                    male: ['什么叫四两拨千斤', '看我这一手'],
                    female: ['让我来助你一臂之力', '永春怀柔法'],
                },
                'wuzhong': { //无中生有
                    male: ['让你也爽一爽', '一起摸起来'],
                    female: ['小女子愿与君一起', '将军，这些都给你啦'],
                },
                'lebu': { //乐不思蜀
                    male: ['汝大逆不道，当坐牢', '准备好迎接下一个弃牌阶段了吗？'],
                    female: ['该休息了', '你累了'],
                },
                'shandian': { //闪电
                    male: ['看我雷劈之术', '积雷木何在？'],
                    female: ['看小女子略施把戏', '少女的把戏，小小的花招'],
                },
                'cixiong': { //雌雄双股剑
                    male: ['这双股剑，归你了', '莫磨了这雌雄威风'],
                    female: ['小女子今日便将宝剑递予君', '莫要负我赠双股之心'],
                },
                'fangtian': { //方天画戟
                    male: ['这方天戟，归你了', '莫削了这画戟威风'],
                    female: ['小女子今日便将画戟递予君', '莫要负我赠戟之心'],
                },
                'guanshi': { //贯石斧
                    male: ['这贯石斧，归你了', '莫掩了这大斧威风'],
                    female: ['小女子今日便将大斧递予君', '莫要负我赠斧之心'],
                },
                'hanbing': { //寒冰剑
                    male: ['这寒冰剑，归你了', '莫灭了这寒冰威风'],
                    female: ['小女子今日便将冰剑递予君', '莫要负我赠剑之心'],
                },
                'qilin': { //麒麟弓
                    male: ['这麒麟弓，归你了', '莫断了这神弓威风'],
                    female: ['小女子今日便将神弓递予君', '莫要负我赠弓之心'],
                },
                'qinggang': { //青釭剑
                    male: ['这青釭剑，归你了', '莫灰了这刚剑威风'],
                    female: ['小女子今日便将宝剑递予君', '莫要负我赠剑之心'],
                },
                'qinglong': { //青龙偃月刀
                    male: ['这青龙偃月刀，归你了', '莫削了这偃月刀威风'],
                    female: ['小女子今日便将宝刀递予君', '莫要负我赠刀之心'],
                },
                'zhangba': { //丈八蛇矛
                    male: ['这丈八蛇矛，归你了', '莫弱了这蛇矛威风'],
                    female: ['小女子今日便将蛇矛递予君', '莫要负我赠蛇矛之心'],
                },
                'zhuge': { //诸葛连弩
                    male: ['这诸葛连弩，归你了', '莫减了这连弩威风'],
                    female: ['小女子今日便将连弩递予君', '莫要负我赠弩之心'],
                },
                'bagua': { //八卦阵
                    male: ['这八卦阵，归你了', '莫削了这八阵威风'],
                    female: ['小女子今日便将八阵递予君', '莫要负我赠阵之心'],
                },
                'renwang': { //仁王盾
                    male: ['这仁王盾，归你了', '莫削了这王盾威风'],
                    female: ['小女子今日便将宝盾递予君', '莫要负我赠盾之心'],
                },
                'dilu': { //的卢
                    male: ['这的卢，归你了', '莫掩了这的卢威风'],
                    female: ['小女子今日便将的卢递予君', '莫要负我赠的卢之心'],
                },
                'jueying': { //绝影
                    male: ['这绝影，归你了', '莫藏了这绝影威风'],
                    female: ['小女子今日便将绝影递予君', '莫要负我赠绝影之心'],
                },
                'zhuahuang': { //爪黄飞电
                    male: ['这爪黄飞电，归你了', '莫磨了这爪黄威风'],
                    female: ['小女子今日便将爪黄飞电递予君', '莫要负我赠爪黄飞电之心'],
                },
                'chitu': { //赤兔
                    male: ['这赤兔，归你了', '莫灭了这汗血宝马威风'],
                    female: ['小女子今日便将赤兔递予君', '莫要负我赠赤兔之心'],
                },
                'dayuan': { //大宛
                    male: ['这大宛，归你了', '莫掩了这胡骑威风'],
                    female: ['小女子今日便将大宛递予君', '莫要负我赠大宛之心'],
                },
                'zixin': { //紫骍
                    male: ['这紫骍，归你了', '莫暗了这良驹威风'],
                    female: ['小女子今日便将紫骍递予君', '莫要负我赠紫骍之心'],
                },
                //军争
                'jiu': { //酒
                    male: ['兄弟，有好酒，分你一口', '一起喝酒一起愁', '酒鬼，是不是也馋我的酒'],
                    female: ['喝吧，没毒', '没有鸩', '没有鹤顶红', '好酒！老娘喝的尽兴', '可比潼阳老酒'],
                },
                'huogong': { //火攻
                    male: ['烧死你', '烈火起，大风来', '我猜你的花色我都有'],
                    female: ['你不够烧，我来帮你', '你滴，良心坏了，我来帮你纯净，烧掉一切罪恶', '火疗法听说过吗？'],
                },
                'tiesuo': { //铁索
                    male: ['把你捆起来', '铁索连舟，如履平地', '玩过捆绑嘛？'],
                    female: ['姐带你玩一次', '束缚起来，这是惩罚', '捆绑的乐趣，姐这就来带你探索'],
                },
                'bingliang': { //兵粮寸断
                    male: ['饿死你', '你别想吃饭了', '我看你还能坚持到什么时候'],
                    female: ['不会做饭就等着饿死吧', '我是粮贩，得罪了我，还想吃饭？'],
                },
                'guding': { //古锭刀
                    male: ['这古锭刀，归你了', '莫断了这宝刀威风'],
                    female: ['小女子今日便将古锭刀递予君', '莫要负我赠刀之心'],
                },
                'zhuque': { //朱雀羽扇
                    male: ['这朱雀羽扇，归你了', '莫磨了这宝扇威风'],
                    female: ['小女子今日便将朱雀羽扇递予君', '莫要负我赠扇之心'],
                },
                'baiyin': { //白银狮子
                    male: ['这白银狮子，归你了', '莫灭了这狮子威风'],
                    female: ['小女子今日便将白银狮子递予君', '莫要负我赠盔之心'],
                },
                'tengjia': { //藤甲
                    male: ['这藤甲，归你了', '莫削了这藤甲威风'],
                    female: ['小女子今日便将藤甲递予君', '莫要负我赠甲之心'],
                },
                'hualiu': { //骅骝
                    male: ['这骅骝，归你了', '莫减了这铁马威风'],
                    female: ['小女子今日便将骅骝递予君', '莫要负我赠骅骝之心'],
                },
                'muniu': { //木牛流马
                    male: ['这木牛流马，归你了', '莫弱了这木牛流马威风'],
                    female: ['小女子今日便将木牛流马递予君', '莫要负我赠木牛流马之心'],
                },
                //忠肝义胆
                'jinchan': { //金蝉脱壳
                    male: ['你还想动我？', '这些雕虫小技，伤不着我金蝉子'],
                    female: ['抱歉哦，人家硬接下了你的攻击', '攻击无效了哦'],
                },
                'qijia': { //弃甲曳兵
                    male: ['你还要什么自行车？', '抱头鼠窜吧'],
                    female: ['嫉妒了，哼', '这些，我没有的你也别想有'],
                },
                'shengdong': { //声东击西
                    male: ['帮你积点德，快感谢我', '你的东西真棒，这么棒，分我兄弟一点'],
                    female: ['饭太多了，你吃不完的', '我来帮你分担一点吧'],
                },
                'zengbin': { //增兵减灶
                    male: ['好兄弟，我来教你', '这招新研发出来的，你也试试'],
                    female: ['姊妹俩一起增兵', '好朋友一起胜利'],
                },
                'caomu': { //草木皆兵
                    male: ['我觉得你太胖了，减减肥吧', '不要吃太多'],
                    female: ['其实七分饱就好了', '吃那么多，消化得了嘛？'],
                },
                'fulei': { //浮雷
                    male: ['这雷你们也试一试'],
                    female: ['好神奇的雷气，居然在浮动'],
                },
                'qibaodao': { //七宝刀
                    male: ['这七宝刀，归你了', '莫掩了这七宝刀威风'],
                    female: ['小女子今日便将七宝刀递予君', '莫要负我赠刀之心'],
                },
                'yinyueqiang': { //银月枪
                    male: ['这银月枪，归你了', '莫埋了这银月枪威风'],
                    female: ['小女子今日便将银月枪递予君', '莫要负我赠抢之心'],
                },
                'zhungangshuo': { //衠钢槊
                    male: ['这衠钢槊，归你了', '莫灰了这钢槊威风'],
                    female: ['小女子今日便将衠钢槊递予君', '莫要负我赠槊之心'],
                },
                'lanyinjia': { //烂银甲
                    male: ['这烂银甲，归你了', '莫没了这银甲威风'],
                    female: ['小女子今日便将银甲递予君', '莫要负我赠银甲之心'],
                },
                //运筹帷幄
                'caochuanjiejian': { //草船借箭
                    male: ['是损或是伤，选一个吧'],
                    female: ['你弱我就弱，你强我就强'],
                },
                'chenhuodajie': { //趁火打劫
                    male: ['受伤了？趁你病，要你命'],
                    female: ['啊，哥哥受伤了，我帮哥哥减轻钱包的重量'],
                },
                'diaobingqianjiang': { //调兵遣将
                    male: ['朋友，一起'],
                    female: ['一起找宝藏嘛？'],
                },
                'fudichouxin': { //釜底抽薪
                    male: ['你的牌是我的啦，哈哈'],
                    female: ['你有我擅言嘛？'],
                },
                'geanguanhuo': { //隔岸观火
                    male: ['看我把火引进你屋'],
                    female: ['谁让你不准我拿你的化妆品'],
                },
                'shezhanqunru': { //舌战群儒
                    male: ['看我凤眉之能'],
                    female: ['女子亦有学识'],
                },
                'shuigong': { //水攻
                    male: ['有装备，快点弃了'],
                    female: ['哥哥，你有装备，拿开它嘛，不方便，嗯～'],
                },
                'toulianghuanzhu': { //偷梁换柱
                    male: ['让我看看你发育正不正常啊！'],
                    female: ['我想要看一下你的里面'],
                },
                'wangmeizhike': { //望梅止渴
                    male: ['一起观天吧'],
                    female: ['看，那儿有棵梅'],
                },
                'youdishenru': { //诱敌深入
                    male: ['车隐百步，汝敢来追？'],
                    female: ['哥～想看最深处嘛？'],
                },
                'hongshui': { //洪水
                    male: ['看我淹死你'],
                    female: ['此水共工借，弃甲方能还'],
                },
                'huoshan': { //火山
                    male: ['看我烧死你'],
                    female: ['熔岩百日滚，朝铸万人坟'],
                },
                'suolianjia': { //锁链甲
                    male: ['这锁链甲，归你了', '莫没了这锁链甲威风'],
                    female: ['小女子今日便将锁链甲递予君', '莫要负我赠甲之心'],
                },
            };
            game.ZAuseSay_me_to = {
                'none': { //未知
                    male: ['你这', '这这这', '这啥呀这是，啊？', '你还想干嘛', '哎哟哟', '你行啊你', '你干的好哇'],
                    female: ['啊这', '这种事情不要啊...', '这可如何是好哇', '怎敢如此对我', '你这样的话', '哎呀呀', '干嘛，哎嗨哟'],
                },
                'sha': { //杀
                    male: ['系凶滴舅来砍我', '你干嘛，哎呦', '砍我八旬老人，明天你上新闻', '啊啊啊啊啊啊啊啊啊啊啊啊'],
                    female: ['哥哥，不要打脸', '哇呜呜，你欺负我', '君子也会对佳人下手嘛？', '你好狠心'],
                },
                'shan': { //闪
                    male: ['该死，失手了', '这刀不趁手', '墙头草，砍不着；砍不着，墙头草', '棘手怀念摧毁'],
                    female: ['你怎躲人家的爱', '你不爱我了', '是不是外面有人了', '我还得再打二十年拳'],
                },
                'tao': { //桃
                    male: ['谢谢兄弟', '将军德才兼备，乃大汉之栋梁', '接下来，看我的吧'],
                    female: ['有你是我的福气', '你原来这么关心人家', '得此大礼，我……我……'],
                },
                'guohe': { //过河拆桥
                    male: ['你拆我，你以后也别想好过', '阉人！', '我的东西我自己会收拾，豪强欺人'],
                    female: ['为什么要拆掉我的东西', '老娘的东西和你有什么关系', '你也有此一朝'],
                },
                'jiedao': { //借刀杀人
                    male: ['连别人的武器都觊觎，下贱', '刀情时而胜人心，挑拨离间当上刑', '挑三豁四之徒！'],
                    female: ['我的指甲刀你也想要嘛？', '器具怎比真动情，推涛作浪无人惜', '挑三豁四之徒！'],
                },
                'juedou': { //决斗
                    male: ['你这是自寻死路', '既然这样，你也别想活着', '诶呀，你想和我比试比试嘛？'],
                    female: ['巾帼不输君', '这戏我就不演了', '我是重庆军统'],
                },
                'nanman': { //南蛮入侵
                    male: ['荒地蛮夷，只会如此粗鄙之行', '看我有朝披坚执锐马踏汝疆', '你以为我没杀？'],
                    female: ['好广，但伤害好小', '伤不着我哟', '看我出杀'],
                },
                'shunshou': { //顺手牵羊
                    male: ['不要这样子～', '偷什么偷？比你的大！', '诶嘿嘿，诶嘿嘿'],
                    female: ['不要嘛～', '你怎么能乱碰女孩子的身体', '我哪有什么宝贝呀'],
                },
                'taoyuan': { //桃园结义
                    male: ['好同志，陪你走', '愿君不忘结义情'],
                    female: ['好姊妹，背靠背', '感谢亲送来的桃'],
                },
                'wanjian': { //万箭齐发
                    male: ['你被袁本初夺舍了？', '你这是搞什么'],
                    female: ['还不如直接杀我', '哥哥好凶'],
                },
                'wugu': { //五谷丰登
                    male: ['大户人家出手就是阔绰', '我也来挑一担粮'],
                    female: ['我来取花儿咯~', '会有我想要的牌嘛？'],
                },
                'wuxie': { //无懈可击
                    male: ['你干嘛，哎呦喂，哇呜呜', '你怎么这样子'],
                    female: ['你会rap、唱跳、篮球嘛？', '你……'],
                },
                'wuzhong': { //无中生有
                    male: ['感谢兄弟送来的飞机', '且看我再摸一张无中'],
                    female: ['你可是我我的好baby', '大恩不言谢喽'],
                },
                'lebu': { //乐不思蜀
                    male: ['我X你XX，X你X', 'X你X，退钱'],
                    female: ['哇呜呜 你忍心嘛？', '为什么要关我一个娇弱女子'],
                },
                'shandian': { //闪电
                    male: ['你想劈我是吧', '你劈一个看看'],
                    female: ['我好像没犯什么错', '是不是有人在发誓'],
                },
                'cixiong': { //雌雄双股剑
                    male: ['谢送来的双股剑', '绝不磨此剑之威风'],
                    female: ['谢君送剑之情，小女子定不遗忘', '绝不负君赠剑意'],
                },
                'fangtian': { //方天画戟
                    male: ['谢送来的方天画戟', '绝不削此戟之威风'],
                    female: ['谢君送画戟之情，小女子定不遗忘', '绝不负君赠戟意'],
                },
                'guanshi': { //贯石斧
                    male: ['谢送来的贯石斧', '绝不掩此斧之威风'],
                    female: ['谢君送大斧之情，小女子定不遗忘', '绝不负君赠斧意'],
                },
                'hanbing': { //寒冰剑
                    male: ['谢送来的寒冰剑', '绝不灭此剑之威风'],
                    female: ['谢君送宝剑之情，小女子定不遗忘', '绝不负君赠剑意'],
                },
                'qilin': { //麒麟弓
                    male: ['谢送来的麒麟弓', '绝不断此弓之威风'],
                    female: ['谢君送神弓之情，小女子定不遗忘', '绝不负君赠弓意'],
                },
                'qinggang': { //青釭剑
                    male: ['谢送来的青釭剑', '绝不灰此剑之威风'],
                    female: ['谢君送剑之情，小女子定不遗忘', '绝不负君赠剑意'],
                },
                'qinglong': { //青龙偃月刀
                    male: ['谢送来的青龙偃月刀', '绝不削此刀之威风'],
                    female: ['谢君送刀之情，小女子定不遗忘', '绝不负君赠刀意'],
                },
                'zhangba': { //丈八蛇矛
                    male: ['谢送来的丈八蛇矛', '绝不弱此矛之威风'],
                    female: ['谢君送矛之情，小女子定不遗忘', '绝不负君赠矛意'],
                },
                'zhuge': { //诸葛连弩
                    male: ['谢送来的诸葛连弩', '绝不减此弩之威风'],
                    female: ['谢君送弩之情，小女子定不遗忘', '绝不负君赠弩意'],
                },
                'bagua': { //八卦阵
                    male: ['谢送来的八卦阵', '绝不削此阵之威风'],
                    female: ['谢君送阵之情，小女子定不遗忘', '绝不负君赠阵意'],
                },
                'renwang': { //仁王盾
                    male: ['谢送来的仁王盾', '绝不削此盾之威风'],
                    female: ['谢君送盾之情，小女子定不遗忘', '绝不负君赠盾意'],
                },
                'dilu': { //的卢
                    male: ['谢送来的的卢', '绝不此掩的卢之威风'],
                    female: ['谢君送的卢之情，小女子定不遗忘', '绝不负君赠的卢意'],
                },
                'jueying': { //绝影
                    male: ['谢送来的绝影', '绝不藏此绝影之威风'],
                    female: ['谢君送绝影之情，小女子定不遗忘', '绝不负君赠绝影意'],
                },
                'zhuahuang': { //爪黄飞电
                    male: ['谢送来的爪黄飞电', '绝不磨此爪黄飞电之威风'],
                    female: ['谢君送爪黄飞电之情，小女子定不遗忘', '绝不负君赠爪黄飞电意'],
                },
                'chitu': { //赤兔
                    male: ['谢送来的赤兔', '绝不灭此西凉汗血之威风'],
                    female: ['谢君送赤兔之情，小女子定不遗忘', '绝不负君赠赤兔意'],
                },
                'dayuan': { //大宛
                    male: ['谢送来的大宛', '绝不掩此胡骑之威风'],
                    female: ['谢君送大宛之情，小女子定不遗忘', '绝不负君赠大宛意'],
                },
                'zixin': { //紫骍
                    male: ['谢送来的紫骍', '绝不暗此减一神马之威风'],
                    female: ['谢君送紫骍之情，小女子定不遗忘', '绝不负君赠紫骍意'],
                },
                //军争
                'jiu': { //酒
                    male: ['太客气了吧，好兄弟', '你喝多了，我没愁', '以后好酒也少不了你的份'],
                    female: ['你这酒，我尝尝', '好酒！老娘喝的尽兴', '可比潼阳老酒'],
                },
                'huogong': { //火攻
                    male: ['我堵你是一介品神', '见证奇迹的时刻到啦', '你怎么不去火攻孙茹？'],
                    female: ['我不想被烧', '不要烧我，我是良民', '再让我变得更烧？'],
                },
                'tiesuo': { //铁索
                    male: ['捆我干什么', '坏了，我成舟了', '给爷松开'],
                    female: ['一起玩嘛？', '这般情趣你还是自己留着吧', '我不喜欢这样子，公子何不自己体会'],
                },
                'bingliang': { //兵粮寸断
                    male: ['凭什么断我的粮', '粮草还可坚持几日？'],
                    female: ['哇呜呜，人家好饿', '我就算死掉，也不会吃你一点东西'],
                },
                'guding': { //古锭刀
                    male: ['谢送来的古锭刀', '绝不断此刀之威风'],
                    female: ['谢君送刀之情，小女子定不遗忘', '绝不负君赠刀意'],
                },
                'zhuque': { //朱雀羽扇
                    male: ['谢送来的朱雀羽扇', '绝不磨此扇之威风'],
                    female: ['谢君送扇之情，小女子定不遗忘', '绝不负君赠扇意'],
                },
                'baiyin': { //白银狮子
                    male: ['谢送来的白银狮子', '绝不灭此银盔之威风'],
                    female: ['谢君送银盔之情，小女子定不遗忘', '绝不负君赠盔意'],
                },
                'tengjia': { //藤甲
                    male: ['谢送来的藤甲', '绝不削此甲之威风'],
                    female: ['谢君送藤甲之情，小女子定不遗忘', '绝不负君赠甲意'],
                },
                'hualiu': { //骅骝
                    male: ['谢送来的骅骝', '绝不减此铁马之威风'],
                    female: ['谢君送还骅骝之情，小女子定不遗忘', '绝不负君赠骅骝意'],
                },
                'muniu': { //木牛流马
                    male: ['谢送来的木牛流马', '绝不弱此宝物之威风'],
                    female: ['谢君送木牛流马之情，小女子定不遗忘', '绝不负君赠宝意'],
                },
                //忠肝义胆
                'jinchan': { //金蝉脱壳
                    male: ['如此敏捷，莫非你练习了两年半', '可恶的金蝉子'],
                    female: ['哎呀，你躲什么嘛', '你居然不对我动心'],
                },
                'qijia': { //弃甲曳兵
                    male: ['你干嘛，哎呦，啊咦啊，哼哼啊呐咕', '不要拿走，我的装备'],
                    female: ['你在干什么，为什么要动人家的衣服', '公子，不要！'],
                },
                'shengdong': { //声东击西
                    male: ['我不需要你的破牌', '你家里人与我何干？'],
                    female: ['都快瘦瘪了', '不公平，为什么你只给我一张却让我还两张'],
                },
                'zengbin': { //增兵减灶
                    male: ['感谢大哥送来的兵马'],
                    female: ['感谢姊妹们的支援'],
                },
                'caomu': { //草木皆兵
                    male: ['吃你家饭了？随便动我的粮食', '该死的地主豪强'],
                    female: ['我要长身体，坏了身子，你担待不起', '肠胃好就该多吃，脑子好就不要乱信草木为兵'],
                },
                'fulei': { //浮雷
                    male: ['你想要搞些什么'],
                    female: ['你想要劈我千万回嘛？如此狠心'],
                },
                'qibaodao': { //七宝刀
                    male: ['谢送来的七宝刀', '绝不掩此七星之威风'],
                    female: ['谢君送刀之情，小女子定不遗忘', '绝不负君赠刀意'],
                },
                'yinyueqiang': { //银月枪
                    male: ['谢送来的银月枪', '绝不埋此银枪之威风'],
                    female: ['谢君送枪之情，小女子定不遗忘', '绝不负君赠枪意'],
                },
                'zhungangshuo': { //衠钢槊
                    male: ['谢送来的衠钢槊', '绝不灰此钢槊之威风'],
                    female: ['谢君送钢槊之情，小女子定不遗忘', '绝不负君赠槊意'],
                },
                'lanyinjia': { //烂银甲
                    male: ['谢送来的烂银甲', '绝不没此银甲之威风'],
                    female: ['谢君送烂银甲之情，小女子定不遗忘', '绝不负君赠银甲意'],
                },
                //运筹帷幄
                'caochuanjiejian': { //草船借箭
                    male: ['这么想要我的杀？'],
                    female: ['你是，M？'],
                },
                'chenhuodajie': { //趁火打劫
                    male: ['你是IKUN？'],
                    female: ['我家哥哥都比你强'],
                },
                'diaobingqianjiang': { //调兵遣将
                    male: ['这都想着我'],
                    female: ['放心吧，不会辜负你的'],
                },
                'fudichouxin': { //釜底抽薪
                    male: ['看我用铁锅踩死你个龟孙'],
                    female: ['咦，没见过世面的土包子，柴火也偷'],
                },
                'geanguanhuo': { //隔岸观火
                    male: ['一点安全意识都没有'],
                    female: ['你还真就干站着？'],
                },
                'shezhanqunru': { //舌战群儒
                    male: ['皓首匹夫！'],
                    female: ['无耻老贼'],
                },
                'shuigong': { //水攻
                    male: ['我就这么多储备'],
                    female: ['我从来没敢用装备，穷怕了'],
                },
                'toulianghuanzhu': { //偷梁换柱
                    male: ['饥不择食，男的也偷窥？'],
                    female: ['色狼啊！'],
                },
                'wangmeizhike': { //望梅止渴
                    male: ['感谢兄弟地精神帮助'],
                    female: ['望梅止渴三天，治好了我的精神内耗'],
                },
                'youdishenru': { //诱敌深入
                    male: ['休要夸口，看我拿你'],
                    female: ['看我擒下你这流寇'],
                },
                'hongshui': { //洪水
                    male: ['淹死的都是会水的'],
                    female: ['小女子略通奇门，洪水所淹，汝代代祖坟'],
                },
                'huoshan': { //火山
                    male: ['离火山越近最先被烧死'],
                    female: ['小女子略懂遁甲，仅凭此火，何足伤我'],
                },
                'suolianjia': { //锁链甲
                    male: ['谢送来的锁链甲', '绝不没此链甲之威风'],
                    female: ['谢君送甲之情，小女子定不遗忘', '绝不负君赠甲意'],
                },
            };
            game.ZAuseSay_me_self = {
                'none': { //未知
                    male: ['嗯...', '那就这样吧', '用这个', '应该管用', '就这样决定了', '就你了'],
                    female: ['阿巴阿巴', '阿巴阿巴阿巴', '真不错啊', '就这样吧', '这啥呀这是', '我看看'],
                },
                'sha': { //杀
                    male: ['我杀我自己'],
                    female: ['剪个指甲'],
                },
                'shan': { //闪
                    male: ['没事掉什么血'],
                    female: ['不想剪了'],
                },
                'tao': { //桃
                    male: ['吃个桃桃', '好舒服啊', '一桃解愁'],
                    female: ['喝点补品', '休息一下吧', '补妆啦不要偷窥哟'],
                },
                'guohe': { //过河拆桥
                    male: ['自断后路', '什么台阶，我不要了', '哥就是这么豪迈'],
                    female: ['坏了就扔掉', '没用了就送给弃牌堆吧', '姐玩的就是真实'],
                },
                'jiedao': { //借刀杀人
                    male: ['还是自己的刀拿着顺手', '我的刀磨好了', '看我拿下这把武器'],
                    female: ['取下小刀削水果', '指甲刀剪指甲', '小哥哥们都看向我'],
                },
                'juedou': { //决斗
                    male: ['将自己当成斗争目标，成长领悟的最高境界', '世人笑我痴狂，我笑世人决斗打不到自己脸上', '我狠起来自己都打'],
                    female: ['可以S，好诶', '轻点，不然会打翻自己的香水', '突然想去看皮影戏了'],
                },
                'nanman': { //南蛮入侵
                    male: ['化身蛮神，等待王的收割', '鞑靼入侵', '南蛮很大，你们忍一下'],
                    female: ['南蛮女子亦不输中原织妓', '大象很厉害吧', '我不是故意伤害大家的'],
                },
                'shunshou': { //顺手牵羊
                    male: ['自摸', '家里养多，背着家人偷一只', '掏掏家底'],
                    female: ['拿来吧我', '翻翻我的胭脂盒', '找找我的粉底霜'],
                },
                'taoyuan': { //桃园结义
                    male: ['好兄弟，一起走', '歃血为盟'],
                    female: ['好姐妹，手牵手', '义结金兰'],
                },
                'wanjian': { //万箭齐发
                    male: ['万箭钻心之痛，我细细品吧', '看我发动雷击'],
                    female: ['酱紫挤荡座巴辛', '手术减肥'],
                },
                'wugu': { //五谷丰登
                    male: ['好想独吞', '看我找麦克风'],
                    female: ['好多牌耶', '一人一张排队拿好，不要乱插队'],
                },
                'wuxie': { //无懈可击
                    male: ['不要乱动', '这叫化劲'],
                    female: ['你别想碰！', '男女授受不亲，注意影响'],
                },
                'wuzhong': { //无中生有
                    male: ['同志们同志们，看我秀起来', '无中一无中'],
                    female: ['看能不能碰着无中', '好东西啊！'],
                },
                'lebu': { //乐不思蜀
                    male: ['自己的家就是温柔乡', '我不出家门了'],
                    female: ['黄花大闺女', '四德不曾出门'],
                },
                'shandian': { //闪电
                    male: ['让暴风来的更猛烈些吧', '我们每个人都有罪，特别是那大魏', '看我雷劈之术', '积雷木何在？'],
                    female: ['看小女子略施把戏', '少女的把戏，小小的花招', '小女子已卜好了卦', '让我窥探我军气运'],
                },
                'cixiong': { //雌雄双股剑
                    male: ['看我再展双股剑之雄风'],
                    female: ['身姿飘盈，一展雌剑之脱力'],
                },
                'fangtian': { //方天画戟
                    male: ['看我再展画戟转天之技'],
                    female: ['好重，但爱的就是这般雄壮'],
                },
                'guanshi': { //贯石斧
                    male: ['看我再展大斧贯石之能'],
                    female: ['大斧似乎不太雅观'],
                },
                'hanbing': { //寒冰剑
                    male: ['看我再展宝剑寒骨冰心之法'],
                    female: ['刷个剑剑，好凉凉'],
                },
                'qilin': { //麒麟弓
                    male: ['看我再展麒麟去马之弓'],
                    female: ['吾射不亦精乎'],
                },
                'qinggang': { //青釭剑
                    male: ['看我再展青釭破盾之效'],
                    female: ['大家穿的再多也没用~'],
                },
                'qinglong': { //青龙偃月刀
                    male: ['看我再展偃月之青龙'],
                    female: ['拿来劈西瓜咯'],
                },
                'zhangba': { //丈八蛇矛
                    male: ['看我再展蛇矛幻杀之能'],
                    female: ['其实我怕蛇啦'],
                },
                'zhuge': { //诸葛连弩
                    male: ['看我再展连弩连杀之技'],
                    female: ['突突突'],
                },
                'bagua': { //八卦阵
                    male: ['看我再展无中生闪之能'],
                    female: ['太极生两仪，两仪生四象，四象生八卦'],
                },
                'renwang': { //仁王盾
                    male: ['看我再展仁王御黑之效'],
                    female: ['好重的黑盾'],
                },
                'dilu': { //的卢
                    male: ['看我再展霹雳之风'],
                    female: ['慢点，要受不了啦'],
                },
                'jueying': { //绝影
                    male: ['看我再展绝地无影之速'],
                    female: ['一骑绝尘，不留踪影，但似乎不适合我'],
                },
                'zhuahuang': { //爪黄飞电
                    male: ['看我再展电上飞花'],
                    female: ['飞电般极速'],
                },
                'chitu': { //赤兔
                    male: ['看我再展西凉汗血之能'],
                    female: ['汗血宝马，岂是徒有虚名'],
                },
                'dayuan': { //大宛
                    male: ['看我再展大奔之威'],
                    female: ['大宛不愿怨'],
                },
                'zixin': { //紫骍
                    male: ['看我再展减一神马之能'],
                    female: ['紫色的马儿，符合我的气质'],
                },
                //军争
                'jiu': { //酒
                    male: ['来点小酒', '何以解忧？唯有杜康', '一酒解千愁', '借酒浇愁'],
                    female: ['快醉了，哥哥扶我一扶', '贵妃醉酒', '醉观音', '醉芙蓉'],
                },
                'huogong': { //火攻
                    male: ['看我卖血', '手里有废牌，怎么办？', '横扫六合，席卷八荒', '燃烧吧'],
                    female: ['我真滴烧', '都烧到我自己了，呜呜呜', '好像发烧了'],
                },
                'tiesuo': { //铁索
                    male: ['通通连起来吧', '自爆兵已就绪', '来个人，和我一起相连'],
                    female: ['自我捆绑play', '燥起来', '好想和你背靠背，捆在一起'],
                },
                'bingliang': { //兵粮寸断
                    male: ['饥饿营销', '家里粮太多，根本吃不完'],
                    female: ['会不会以后没饭吃', '姐就是吃饱了撑得，你管得着嘛？'],
                },
                'guding': { //古锭刀
                    male: ['看我再展古锭刀加伤之威'],
                    female: ['这刀可能会很痛哟'],
                },
                'zhuque': { //朱雀羽扇
                    male: ['看我再展羽扇朱雀引炎之法'],
                    female: ['法术伤害来啦'],
                },
                'baiyin': { //白银狮子
                    male: ['看我再展银盔雄狮护身之效'],
                    female: ['这下不怕痛了呢'],
                },
                'tengjia': { //藤甲
                    male: ['看我再展藤甲御蛮拒公之能'],
                    female: ['再也不怕南蛮和万箭了'],
                },
                'hualiu': { //骅骝
                    male: ['看我再展虎威骅骝之力'],
                    female: ['马背上是高傲的骑士，马蹄下是凄荒的残尸'],
                },
                'muniu': { //木牛流马
                    male: ['看我再展木车牛之运力马之运速'],
                    female: ['有了钱包，这下就不怕没地方装钱啦'],
                },
                //忠肝义胆
                'jinchan': { //金蝉脱壳
                    male: ['平日少钱财，金蝉换酒来', '不要了，来点好牌'],
                    female: ['似乎是个宝贝，废品也值钱', '用这剩下的东西换些化妆品'],
                },
                'qijia': { //弃甲曳兵
                    male: ['全都不要了，跑的更快', '自己家的东西我也不要了'],
                    female: ['扔了吧，不稀罕', '看我轻装简从'],
                },
                'shengdong': { //声东击西
                    male: ['住宅外有两个邻居，那东房是我的，那西房也是我的', '东家西家都是我'],
                    female: ['我真的可以这么做嘛？', '看好我这波，秀操作'],
                },
                'zengbin': { //增兵减灶
                    male: ['变相无中', '减了灶，有变弱嘛？'],
                    female: ['卖掉了旧衣裳，但我获得了更多的钱经商', '看我连招发动'],
                },
                'caomu': { //草木皆兵
                    male: ['发动技能弘援', '队友们，看你们的了'],
                    female: ['哥哥们，小女子尽力了', '苦了自己也不能苦了大家'],
                },
                'fulei': { //浮雷
                    male: ['浮雷烁烁，吃席我坐，大魏那桌', '看我闹事', '好神奇的雷气，居然在浮动'],
                    female: ['人家可是欧洲女子', '请来了积雷木', '这雷你们也试一试'],
                },
                'qibaodao': { //七宝刀
                    male: ['看我再展宝刀七星撕裂伤口之能'],
                    female: ['第一次会很痛哦，以后就不痛了'],
                },
                'yinyueqiang': { //银月枪
                    male: ['看我再展银月追击之效'],
                    female: ['动如脱兔，触则反冲'],
                },
                'zhungangshuo': { //衠钢槊
                    male: ['看我再展钢槊互伤之法'],
                    female: ['这一刀，可没那么容易闪过去'],
                },
                'lanyinjia': { //烂银甲
                    male: ['看我再战银甲难缠之风'],
                    female: ['狗皮膏药已上线'],
                },
                //运筹帷幄
                'caochuanjiejian': { //草船借箭
                    male: ['草人是我的，箭还是我的'],
                    female: ['小船是小女子家的，那大船是我爹的'],
                },
                'chenhuodajie': { //趁火打劫
                    male: ['我似乎打不了自己的劫'],
                    female: ['可恶，人家碰不到自己'],
                },
                'diaobingqianjiang': { //调兵遣将
                    male: ['过一下手牌'],
                    female: ['翻翻有没有宝藏'],
                },
                'fudichouxin': { //釜底抽薪
                    male: ['我就喜欢纯铁块'],
                    female: ['拿起铁块就砸'],
                },
                'geanguanhuo': { //隔岸观火
                    male: ['大火似乎烧着了我家的房子'],
                    female: ['我只喜欢看着家国烧为灰烬'],
                },
                'shezhanqunru': { //舌战群儒
                    male: ['看我如何雄辩群英'],
                    female: ['巧舌如簧，能言善辩'],
                },
                'shuigong': { //水攻
                    male: ['脱了衣服和你们打'],
                    female: ['这轻纱，不穿也罢'],
                },
                'toulianghuanzhu': { //偷梁换柱
                    male: ['自我检查'],
                    female: ['我的头发似乎有点长了'],
                },
                'wangmeizhike': { //望梅止渴
                    male: ['有点渴，看看梅'],
                    female: ['可惜了，吃不着'],
                },
                'youdishenru': { //诱敌深入
                    male: ['我扇我自己一耳光'],
                    female: ['着迷于我自己'],
                },
                'hongshui': { //洪水
                    male: ['看我驱水破地', '看我淹死你'],
                    female: ['女子不才，可引洪水本来', '此水共工借，弃甲方能还'],
                },
                'huoshan': { //火山
                    male: ['看我移来一座火山，定除无利之百害', '看我烧死你'],
                    female: ['女子不恭，效仿愚公伴祝融', '熔岩百日滚，朝铸万人坟'],
                },
                'suolianjia': { //锁链甲
                    male: ['看我再展链祛雷火之法'],
                    female: ['张角快来劈我'],
                },
            };
            game.ZAuseSay_see_none = {
                'none': { //未知
                    male: ['就这？', '随便了', '无所谓', '这操作..', '吃瓜', '我就看看'],
                    female: ['啊这', '随便啦', '我都无所谓的', '呃呃', '吃瓜吃瓜', '嗯...'],
                },
                'sha': { //杀
                    male: ['打起来', '杀的好', '再重一些'],
                    female: ['你怎这般轻手', '下手重点，我是护士在医院', '公共场合，严禁追打'],
                },
                'shan': { //闪
                    male: ['又是谁打出了闪', '又一张牌没了', '徐夫人狂喜'],
                    female: ['哎呀，你的牌丢了一张', '你闪到我了'],
                },
                'tao': { //桃
                    male: ['我的桃，没了', '桃还是留着给我用吧', '这颗桃子，会女装嘛？', '肾虚才补桃'],
                    female: ['人家也想要吃', '看上去很好吃的样子', '可以给我留一口嘛？', '好吃这个，估计是虚'],
                },
                'guohe': { //过河拆桥
                    male: ['又是谁在拆拆拆？', '随便拆，反正不动我', '呼叫陆逊界诸葛'],
                    female: ['你是辛巴甘还是阉人张', '哎呀呀，别拆啦', '加油，多拆一点'],
                },
                'jiedao': { //借刀杀人
                    male: ['是谁？在借刀杀人？', '这刀岂是你们配用的', '想要成为武器大师？'],
                    female: ['哎呀别借啦，不会还的啦', '可以给人家武器嘛？', '这种招式，不算什么大体'],
                },
                'juedou': { //决斗
                    male: ['互相内斗是吧', '打起来，打起来', '角斗场，角斗场'],
                    female: ['哎呀你们补药再打辣', '似乎不错，挺好看呢？', '两个大男人的战斗，咦惹，似乎没什么好看的'],
                },
                'nanman': { //南蛮入侵
                    male: ['南蛮入侵可不要乱放', '大家都出杀啊', '难道白马要现世'],
                    female: ['别放南蛮啦', '好耶，又少了一张AOE', '是来骗我的杀还是想我掉血？'],
                },
                'shunshou': { //顺手牵羊
                    male: ['你们慢慢顺，我看戏', '谁家又要被偷羊了呢？', '小贼又来偷东西了'],
                    female: ['咦惹，你们偷偷摸摸的', '好像有个人蹑手蹑脚的', '耶？那个家伙偷偷摸摸的干什么？'],
                },
                'taoyuan': { //桃园结义
                    male: ['拜把子这不叫上我', '白嫖一张桃'],
                    female: ['加上我呗，我也要', '桃园结义分杯羹'],
                },
                'wanjian': { //万箭齐发
                    male: ['大嘴别乱射了', '小小万箭，与我何干'],
                    female: ['哎呀，没打到我就好', '大嘴狼来骗闪啦'],
                },
                'wugu': { //五谷丰登
                    male: ['丰收居然不叫上我？', '五谷丰登？全都生虫'],
                    female: ['呜呜呜，又把人家丢下了', '浪费卡牌的家伙'],
                },
                'wuxie': { //无懈可击
                    male: ['不愧是去懈实力派', '难道你是卧龙'],
                    female: ['哼哼，真没意思', '打不起来了，没戏看'],
                },
                'wuzhong': { //无中生有
                    male: ['你这手气有点太好了吧？', '你也能凭空变来兵马嘛？'],
                    female: ['嫉妒了家人们', '难道你是马良'],
                },
                'lebu': { //乐不思蜀
                    male: ['偷偷自个儿乐了是吧', '哪来的刘禅？'],
                    female: ['行行吧，不乐我就好', '又开始享乐辣？'],
                },
                'shandian': { //闪电
                    male: ['憋电了家人们', '有人引雷，先看看有没有魏', '别待会劈着自己', '注意安全', '玩雷有趣，但小心手里沾水'],
                    female: ['哎呀，宝宝肚肚打雷雷', '来赛脸吧', '注意安全哦，桀桀桀', '开始你的火花艺术'],
                },
                'cixiong': { //雌雄双股剑
                    male: ['人剑合一，乃剑人也', '难道，阁下是刘皇叔？'],
                    female: ['哼，还不如留着给我用呢', '啊这，似乎是刘皇叔的气息？'],
                },
                'fangtian': { //方天画戟
                    male: ['这戟把孩子', '难道，阁下是吕奉先？'],
                    female: ['小心点，别划到我脸了', '啊这，似乎是吕奉先的气息？'],
                },
                'guanshi': { //贯石斧
                    male: ['你是斧头帮帮主？', '难道，阁下是徐公明？'],
                    female: ['别砍我呜呜呜', '啊这，似乎是徐公明的气息？'],
                },
                'hanbing': { //寒冰剑
                    male: ['你是懂得冷场的', '难道，阁下是诸葛孔明？'],
                    female: ['哎呀你这样，人家好冷的', '啊这，似乎是诸葛孔明的气息？'],
                },
                'qilin': { //麒麟弓
                    male: ['不愧是你，猎马人', '难道，阁下是吕奉先？'],
                    female: ['我要保护好我的马儿了', '啊这，似乎是吕奉先的气息？'],
                },
                'qinggang': { //青釭剑
                    male: ['别以为有尚方宝剑就无所不能了', '难道，阁下是曹孟德？'],
                    female: ['很锋利了，别碰我！', '啊这，似乎是曹孟德的气息？'],
                },
                'qinglong': { //青龙偃月刀
                    male: ['你也准备威震华夏了吗', '难道，阁下是关云长？'],
                    female: ['你也想要切西瓜嘛', '啊这，似乎是关云长的气息？'],
                },
                'zhangba': { //丈八蛇矛
                    male: ['别把牌堆当武器库啊', '难道，阁下是张翼德？'],
                    female: ['蛇矛都被你玩出火星啦', '啊这，似乎是张翼德的气息？'],
                },
                'zhuge': { //诸葛连弩
                    male: ['都快藏不住你的杀气了', '难道，阁下是黄月英？'],
                    female: ['弩箭都快被你射秃了', '啊这，似乎是诸葛孔明的气息？'],
                },
                'bagua': { //八卦阵
                    male: ['别把阵法当牌玩啊', '难道，阁下是卧龙先生？'],
                    female: ['八卦都快被你摆成迷宫了', '啊这，似乎是卧龙诸葛的气息？'],
                },
                'renwang': { //仁王盾
                    male: ['拿个破洞看上去没啥用啊', '难道，阁下是于文则？'],
                    female: ['那很重的啦', '啊这，似乎是于文则的气息？'],
                },
                'dilu': { //的卢
                    male: ['马儿可别乱跑啊', '难道，阁下是刘玄德？'],
                    female: ['这马儿可是妨主的', '啊这，似乎是刘玄德的气息？'],
                },
                'jueying': { //绝影
                    male: ['小心你的马跑得影都不见咯', '难道，阁下是曹孟德？'],
                    female: ['黑马鬃毛都被你薅秃了', '啊这，似乎是曹孟德的气息？'],
                },
                'zhuahuang': { //爪黄飞电
                    male: ['你这马抓地能力不太行啊', '难道，阁下是曹孟德？'],
                    female: ['金鞍宝马都被你骑瘦了', '啊这，似乎是曹孟德的气息？'],
                },
                'chitu': { //赤兔
                    male: ['你看你把这马骑红温了', '难道，阁下是关云长？'],
                    female: ['红马尾巴都快被你拽掉了', '啊这，似乎是关云长的气息？'],
                },
                'dayuan': { //大宛
                    male: ['你骑不动它的', '难道，阁下是曹孟德？'],
                    female: ['西域良驹都被你累趴了', '啊这，似乎是曹孟德的气息？'],
                },
                'zixin': { //紫骍
                    male: ['不会写诗别乱骑好吗', '难道，阁下是曹子建？'],
                    female: ['紫骍都嫌弃你诗写得烂了', '啊这，似乎是曹子建的气息？'],
                },
                //军争
                'jiu': { //酒
                    male: ['贪杯也要看场合啊老酒鬼', '醉死算求了'],
                    female: ['喝成这样还怎么打仗呀', '女儿红可不是这么喝的'],
                },
                'huogong': { //火攻
                    male: ['放火烧山不怕坐牢吗', '火烧连营专业户？'],
                    female: ['纵火犯的帽子可不好戴', '准备烧谁家后院呢'],
                },
                'tiesuo': { //铁索
                    male: ['连人都不放过还想连牌？', '你是铁锁成精吗'],
                    female: ['铁链绑人还要绑牌吗', '玩连环计玩魔怔了？'],
                },
                'bingliang': { //兵粮寸断
                    male: ['断粮都断到牌堆了？', '徐公明是你师父吧'],
                    female: ['抢粮抢到牌堆里了？', '徐晃教你这么玩的？'],
                },
                'guding': { //古锭刀
                    male: ['刀都砍卷刃了还不停手？', '界徐盛都没你暴力'],
                    female: ['刀鞘都装不下你的杀气', '女版徐盛恐怖如斯'],
                },
                'zhuque': { //朱雀羽扇
                    male: ['扇火也不怕燎了胡子', '卧龙转世这么暴躁？'],
                    female: ['扇子都快被你摇散架了', '诸葛夫人附体了？'],
                },
                'baiyin': { //白银狮子
                    male: ['西凉铁骑都没你莽撞', '马超看了直呼内行'],
                    female: ['狮子头都被你砸扁了', '锦马超教你砸人的？'],
                },
                'tengjia': { //藤甲
                    male: ['穿这么厚是要当靶子吗', '藤甲兵转世投胎？'],
                    female: ['藤甲都快被你穿成筛子', '孙茹都没你会引火'],
                },
                'hualiu': { //骅骝
                    male: ['骅骝都追不上你的野心', '曹贼竟是你自己'],
                    female: ['汗血宝马都跑不过你', '孟德附体抢人妻？'],
                },
                'muniu': { //木牛流马
                    male: ['孔明的棺材板压不住了', '木牛都被你推散架'],
                    female: ['机关兽遇见拆迁队了', '诸葛夫人是这么教你的？'],
                },
                //忠肝义胆
                'jinchan': { //金蝉脱壳
                    male: ['脱得比蜕皮还快', '你这算行为艺术？'],
                    female: ['金蝉没脱成倒露了马脚', '杂耍班缺个钻火圈的'],
                },
                'qijia': { //弃甲曳兵
                    male: ['破烂王收废铁来错地方了', '穷到连裤衩都要扔？'],
                    female: ['装备差到要当场裸奔吗', '捡垃圾也看不上你这堆废铜'],
                },
                'shengdong': { //声东击西
                    male: ['当瓦匠屈才该去当骗子', '吴懿棺材板都压不住咯'],
                    female: ['资本家的饼画到牌桌了', '一网打尽？怕是漏成筛子'],
                },
                'zengbin': { //增兵减灶
                    male: ['饭都不让吃当什么蜀相', '诸葛亮的棺材在漏水'],
                    female: ['学孔明减灶先学学脑子', '蜀汉亡于伙夫罢工'],
                },
                'caomu': { //草木皆兵
                    male: ['瞎成这样还打什么仗', '苻坚的败家传统艺能'],
                    female: ['把眼屎擦干净再说话', '淝水之战没输够是吧'],
                },
                'fulei': { //浮雷
                    male: ['跳大神跳进牌堆了？', '张角的符水喝多了吧'],
                    female: ['天雷怎么不劈你头上', '太平道招摇撞骗分舵'],
                },
                'qibaodao': { //七宝刀
                    male: ['献刀献到牌堆里了？', '王允的美人计玩脱了'],
                    female: ['刀镶七宝不如铁匠铺', '司徒大人缺钱典当吗'],
                },
                'yinyueqiang': { //银月枪
                    male: ['长坂坡七进七出演杂技', '赵子龙枪法变戏法'],
                    female: ['银枪蜡烛头中看不中用', '常山赵家枪法失传了'],
                },
                'zhungangshuo': { //衠钢槊
                    male: ['铁疙瘩抡着不嫌累吗', '周泰的疤都比你聪明'],
                    female: ['钢槊都快被你磨成针了', '幼平看了直呼败家'],
                },
                'lanyinjia': { //烂银甲
                    male: ['狗皮膏药都比你耐打', '穿着棺材板出来晃？'],
                    female: ['银甲烂成乞丐装了', '膏药味儿熏到牌堆了'],
                },
                //运筹帷幄
                'caochuanjiejian': { //草船借箭
                    male: ['偷箭还偷上瘾了？', '诸葛棺材板在震'],
                    female: ['借完箭还要借男人吗', '黄夫人教你这么偷的？'],
                },
                'chenhuodajie': { //趁火打劫
                    male: ['拾荒专业户改行啦？', '土匪转世投胎？'],
                    female: ['趁乱摸鱼手法挺熟练啊', '孙尚香都没你会捡漏'],
                },
                'diaobingqianjiang': { //调兵遣将
                    male: ['当自己是元帅了？', '纸上谈兵赵括传人'],
                    female: ['调兵不如调情专业', '女将军的戏瘾真大'],
                },
                'fudichouxin': { //釜底抽薪
                    male: ['挖墙脚专业毕业的？', '司马懿直呼内行'],
                    female: ['抽薪不如抽男人有意思', '貂蝉教你的绝招？'],
                },
                'geanguanhuo': { //隔岸观火
                    male: ['看戏买票了吗？', '吃瓜吃到自家田'],
                    female: ['瓜子磕得开心吗', '江东大小乔都没你会看戏'],
                },
                'shezhanqunru': { //舌战群儒
                    male: ['嘴炮能当饭吃？', '孔明转世这么话痨'],
                    female: ['口水多过茶啊', '黄月英的机关嘴？'],
                },
                'shuigong': { //水攻
                    male: ['发大水冲自家祖坟？', '共工是你祖宗吧'],
                    female: ['水漫金山白素贞附体', '小龙女都没你会放水'],
                },
                'toulianghuanzhu': { //偷梁换柱
                    male: ['狸猫换太子专业户', '赵高再世啊'],
                    female: ['偷心不够还要偷牌？', '妲己教你的妖术？'],
                },
                'wangmeizhike': { //望梅止渴
                    male: ['画饼充饥玩得挺溜', '曹阿瞒诈术传人'],
                    female: ['自我安慰有意思吗', '甄宓的镜子借你了？'],
                },
                'youdishenru': { //诱敌深入
                    male: ['请君入瓮请上瘾了', '司马老贼直呼专业'],
                    female: ['钓男人不够还钓牌', '孙尚香的连环套？'],
                },
                'hongshui': { //洪水
                    male: ['淹死会水的还有嘴硬的', '共工看了都惭愧'],
                    female: ['洪水专冲薄情郎祖坟', '洛神要你水葬呢'],
                },
                'huoshan': { //火山
                    male: ['玩火自焚预订席位', '祝融夫人点火器'],
                    female: ['火山爆发先熔你假睫毛', '火神祝融转世？'],
                },
                'suolianjia': { //锁链甲
                    male: ['铁链拴不住你的莽撞', '许褚裸衣更配你'],
                    female: ['锁甲裹这么紧给谁看', '孙尚香捆play？'],
                },
            };
            game.ZAuseSay_see_from = {
                'none': { //未知
                    male: ['干得漂亮！', '很难不资瓷', '好家伙', '妙啊，妙啊', '这操作可以的', '绝了'],
                    female: ['太棒了！', '哇塞，好帅啊', '不戳不戳', '我看好你哟~', '太好了太好了', '好耶好耶'],
                },
                'sha': { //杀
                    male: ['打死这个家伙', '我早就不爽这个家伙了', '打死了，下顿请你喝酒'],
                    female: ['加油，冲鸭', '这般的人儿，着实该杀', '使劲哇，重手追杀，解恨'],
                },
                'shan': { //闪
                    male: ['身姿这般敏捷', '好身手', '不愧是你'],
                    female: ['好帅啊', '躲得好', '轻功这么厉害'],
                },
                'tao': { //桃
                    male: ['家里有桃庄', '老板大气', '桃桃不绝'],
                    female: ['只要哥哥桃桃多，妹妹跟哥哥一桌', '大户人家', '一桃更比一桃强'],
                },
                'guohe': { //过河拆桥
                    male: ['扒光他', '干拆迁', '加油拆，拆迁队队长非你莫属'],
                    female: ['曝光这个家伙', '卸掉这个家伙的伪装', '多曝几遍，我看他还怎么装'],
                },
                'jiedao': { //借刀杀人
                    male: ['此人勇猛，夺刃可除', '没了菜刀，仅余功高；功夫再高，也怕菜刀', '他有什么资格拥有这刀'],
                    female: ['抢过来，我想用作水果刀', '拿到手，我给你削个水果', '拿刀似乎不错'],
                },
                'juedou': { //决斗
                    male: ['砍死他，打死来，来一场真男人的决斗', '相信你一定可以赢'],
                    female: ['按照苗疆的规矩，赢了决斗的男人才拥有配偶权', '揍扁他，今天晚上我帮你洗洗脚', '冲鸭，你是最棒的'],
                },
                'nanman': { //南蛮入侵
                    male: ['恭迎蛮王', '蛮王赫赫显威', '不过三次入侵中的一回'],
                    female: ['小女子愿随大王入侵', '奉君为王', '助大王军威'],
                },
                'shunshou': { //顺手牵羊
                    male: ['这个家伙不结善，牵的好', '活该被牵', '直接化身邓士载'],
                    female: ['又一个战利品', '哥哥真帅', '我不喜欢这个家伙，哥哥真棒', ],
                },
                'taoyuan': { //桃园结义
                    male: ['好兄弟，有事我来帮你扛', '好同志，遇难有你不打慌'],
                    female: ['好姊妹，一起发育一起狂', '好朋友，欢喜有你在身旁'],
                },
                'wanjian': { //万箭齐发
                    male: ['嘴哥', '全场为你欢呼'],
                    female: ['全场为你尖叫', '让我为你高举大旗'],
                },
                'wugu': { //五谷丰登
                    male: ['分粮给我们，太感动了', '我可以拉车装嘛？'],
                    female: ['他真的，我哭死', '感谢朋友送来的资源'],
                },
                'wuxie': { //无懈可击
                    male: ['还有嘛，为我留一张', '将军德才兼备，真乃大汉之栋梁'],
                    female: ['这就化解了，真棒', '不愧是你，意料之中'],
                },
                'wuzhong': { //无中生有
                    male: ['牛逼带仨六', '可叹鄙人没文化，一句牛逼走天下'],
                    female: ['这般聪慧，小女子很是倾心', '这般技巧，小女子可做不到'],
                },
                'lebu': { //乐不思蜀
                    male: ['控死他', '就该进局子'],
                    female: ['好耶，他踩缝纫机去喽', '时间很长，你要忍一下'],
                },
                'shandian': { //闪电
                    male: ['注意安全', '玩雷有趣，但小心手里沾水'],
                    female: ['哥哥会控雷之术嘛？', '劈了他们'],
                },
                'cixiong': { //雌雄双股剑
                    male: ['双股剑之强，应当展现一番'],
                    female: ['雌雄之威，请君一试'],
                },
                'fangtian': { //方天画戟
                    male: ['方天之强，应当展现一番'],
                    female: ['方天之威，请君一试'],
                },
                'guanshi': { //贯石斧
                    male: ['贯石之强，应当展现一番'],
                    female: ['贯石之威，请君一试'],
                },
                'hanbing': { //寒冰剑
                    male: ['寒冰之强，应当展现一番'],
                    female: ['寒冰之威，请君一试'],
                },
                'qilin': { //麒麟弓
                    male: ['麒麟之强，应当展现一番'],
                    female: ['麒麟之威，请君一试'],
                },
                'qinggang': { //青釭剑
                    male: ['青釭之强，应当展现一番'],
                    female: ['青釭之威，请君一试'],
                },
                'qinglong': { //青龙偃月刀
                    male: ['青龙偃月之强，应当展现一番'],
                    female: ['青龙偃月之威，请君一试'],
                },
                'zhangba': { //丈八蛇矛
                    male: ['丈八长蛇之强，应当展现一番'],
                    female: ['丈八长蛇之威，请君一试'],
                },
                'zhuge': { //诸葛连弩
                    male: ['诸葛神弩之强，应当展现一番'],
                    female: ['诸葛神弩之威，请君一试'],
                },
                'bagua': { //八卦阵
                    male: ['八卦之强，应当展现一番'],
                    female: ['八卦之威，请君一试'],
                },
                'renwang': { //仁王盾
                    male: ['仁王之强，应当展现一番'],
                    female: ['仁王之威，请君一试'],
                },
                'dilu': { //的卢
                    male: ['的卢之强，应当展现一番'],
                    female: ['的卢之威，请君一试'],
                },
                'jueying': { //绝影
                    male: ['绝影之强，应当展现一番'],
                    female: ['绝影之威，请君一试'],
                },
                'zhuahuang': { //爪黄飞电
                    male: ['爪黄飞电之强，应当展现一番'],
                    female: ['爪黄飞电之威，请君一试'],
                },
                'chitu': { //赤兔
                    male: ['赤兔之强，应当展现一番'],
                    female: ['赤兔之威，请君一试'],
                },
                'dayuan': { //大宛
                    male: ['大宛之强，应当展现一番'],
                    female: ['大宛之威，请君一试'],
                },
                'zixin': { //紫骍
                    male: ['紫骍之强，应当展现一番'],
                    female: ['紫骍之威，请君一试'],
                },
                //军争
                'jiu': { //酒
                    male: ['好酒量', '兄弟再来一坛', '美酒伴佳人'],
                    female: ['少酌怡情', '慢慢喝，别呛着喽', '好喝嘛？'],
                },
                'huogong': { //火攻
                    male: ['烧光他', '点他的房子', '燃他的圈子'],
                    female: ['烧的好', '烧毁容最好', '火要烧眉毛漏'],
                },
                'tiesuo': { //铁索
                    male: ['大师铁索也能伤人', '精妙的捆绑技艺', '不愧为控局大师'],
                    female: ['这一手我似乎要学学', '难道隐藏着下一招', '看朋友操作'],
                },
                'bingliang': { //兵粮寸断
                    male: ['饿死才好', '活着没什么意义的家伙'],
                    female: ['只会浪费粮食', '死到临头了哟'],
                },
                'guding': { //古锭刀
                    male: ['古锭之强，应当展现一番'],
                    female: ['古锭之威，请君一试'],
                },
                'zhuque': { //朱雀羽扇
                    male: ['朱雀之强，应当展现一番'],
                    female: ['朱雀之威，请君一试'],
                },
                'baiyin': { //白银狮子
                    male: ['雄狮之强，应当展现一番'],
                    female: ['雄狮之威，请君一试'],
                },
                'tengjia': { //藤甲
                    male: ['荆藤之强，应当展现一番'],
                    female: ['荆藤之威，请君一试'],
                },
                'hualiu': { //骅骝
                    male: ['铁马之强，应当展现一番'],
                    female: ['铁马之威，请君一试'],
                },
                'muniu': { //木牛流马
                    male: ['木牛流马之强，应当展现一番'],
                    female: ['木牛流马之威，请君一试'],
                },
                //忠肝义胆
                'jinchan': { //金蝉脱壳
                    male: ['这一招，居然可以这样用', '好身手，莫非是武林中人'],
                    female: ['太帅了，直接硬接', '丝毫没有半点畏惧的你是最强大的'],
                },
                'qijia': { //弃甲曳兵
                    male: ['就该让他东躲西藏最好', '你有什么资格拿这些装备'],
                    female: ['这叫帮忙减肥，别不知好歹', '免费减肥茶，立马奏效'],
                },
                'shengdong': { //声东击西
                    male: ['好方略', '旁敲侧击，攻敌不备'],
                    female: ['让你费心了', '我替同志感谢你'],
                },
                'zengbin': { //增兵减灶
                    male: ['竟是这般计策', '如此诈敌之法'],
                    female: ['我似乎要去拆炉灶了', '多准备些干粮吧'],
                },
                'caomu': { //草木皆兵
                    male: ['点石成金，撒豆成兵', '医生帮别人减肥，有什么错'],
                    female: ['这多出来的食材，可以再做些料理', '这算是，边角料嘛？'],
                },
                'fulei': { //浮雷
                    male: ['小心点朋友，这可是浮动的雷', '或许倒霉蛋在敌方呢'],
                    female: ['敌人是不是有人在和女朋友发誓', '对面不要乱发誓守承诺了，你看浮雷都招来了'],
                },
                'qibaodao': { //七宝刀
                    male: ['七星之强，应当展现一番'],
                    female: ['七星之威，请君一试'],
                },
                'yinyueqiang': { //银月枪
                    male: ['银月之强，应当展现一番'],
                    female: ['银月之威，请君一试'],
                },
                'zhungangshuo': { //衠钢槊
                    male: ['衠钢之强，应当展现一番'],
                    female: ['衠钢之威，请君一试'],
                },
                'lanyinjia': { //烂银甲
                    male: ['灿银之强，应当展现一番'],
                    female: ['灿银之威，请君一试'],
                },
                //运筹帷幄
                'caochuanjiejian': { //草船借箭
                    male: ['草船借箭之法，神机妙算之人'],
                    female: ['料敌虚实之能，先生真神人'],
                },
                'chenhuodajie': { //趁火打劫
                    male: ['地主遇难，乞丐抢饭'],
                    female: ['哥哥真棒，劫的战利品一件'],
                },
                'diaobingqianjiang': { //调兵遣将
                    male: ['好兄弟，你是不是搞错了'],
                    female: ['你也配和我家哥哥一起？'],
                },
                'fudichouxin': { //釜底抽薪
                    male: ['将军所使工具莫非火钳'],
                    female: ['全都抽掉'],
                },
                'geanguanhuo': { //隔岸观火
                    male: ['一起看戏嘛？'],
                    female: ['这电视剧不错啊'],
                },
                'shezhanqunru': { //舌战群儒
                    male: ['相信你善文'],
                    female: ['要用文法翻阅的工作我就觉得你行'],
                },
                'shuigong': { //水攻
                    male: ['高端玩家'],
                    female: ['精确打击'],
                },
                'toulianghuanzhu': { //偷梁换柱
                    male: ['给他换个木锥'],
                    female: ['看看他什么成分'],
                },
                'wangmeizhike': { //望梅止渴
                    male: ['有的看就不错了'],
                    female: ['看着就好吃'],
                },
                'youdishenru': { //诱敌深入
                    male: ['耗而攻之'],
                    female: ['打麻雀战'],
                },
                'hongshui': { //洪水
                    male: ['共工下凡'],
                    female: ['水神是你嘛？'],
                },
                'huoshan': { //火山
                    male: ['祝融下凡'],
                    female: ['火神是你嘛？'],
                },
                'suolianjia': { //锁链甲
                    male: ['链甲之强，应当展现一番'],
                    female: ['链甲之威，请君一试'],
                },
            };
            game.ZAuseSay_see_to = {
                'none': { //未知
                    male: ['就这？', '呵呵', '你又能怎样', '看不下去了..', '气死我了', '又来'],
                    female: ['这种事情不要啊', '九命', '你好过分！', '哼', '无语了', '哎呀你干嘛'],
                },
                'sha': { //杀
                    male: ['真不要脸', '你欺负人家', '我从未见过有如此厚颜无耻之人'],
                    female: ['你怎这般无礼', '毫无斯文风范，岂引得佳人有约', '无礼无趣之徒'],
                },
                'shan': { //闪
                    male: ['破皮球乱跳', '有本事就别躲啊', '敢站着不动嘛？'],
                    female: ['这你都躲啊？', '我都不会躲', '真没用，这都害怕'],
                },
                'tao': { //桃
                    male: ['兄弟666', '娇艳欲滴', '桃桃不绝'],
                    female: ['真棒', '桃子鲜美无比，无可不尝', '陪你看桃桃，一桃两桃三桃四桃成桃园'],
                },
                'guohe': { //过河拆桥
                    male: ['你有拆迁令嘛？', '你给钱了吗？', '祖祖辈辈阉人？'],
                    female: ['你应该看着自己的东西被拆', '拆着卡牌不腰疼', '小哥哥，不要乱拆呢'],
                },
                'jiedao': { //借刀杀人
                    male: ['贼人', '败类', '堂堂大丈夫，这般行径'],
                    female: ['丢人现眼的使诈', '阴谋诡计也能登台了？', '灯光亮着呐，干什么，干什么？'],
                },
                'juedou': { //决斗
                    male: ['让他见识下，什么是绝对的力量', '吕布附身', '后来者亦可居上'],
                    female: ['赢了决斗，我既洗脚还洗枣给你吃', '不要输给那个色鬼', '决斗赢了，ikun很有面子'],
                },
                'nanman': { //南蛮入侵
                    male: ['西南蛮夷也敢指染我土疆界', '想体验被擒七回吗？', '兄弟们，杀个片甲不留'],
                    female: ['结局平躺下来，看谁厉害', '粗鲁的莽夫，毫无礼教', '这地方不留这般蛮奴，快滚'],
                },
                'shunshou': { //顺手牵羊
                    male: ['土寇，只会干些偷鸡摸狗的勾当', '乱拿东西，你犯法了你知道吗？', '你有检查执照吗？'],
                    female: ['流氓，随便拿别人东西', '强盗，真不要脸', '我家哥哥怎么你了，苏珊'],
                },
                'taoyuan': { //桃园结义
                    male: ['你也配和我结义', '关二爷都看不下咱们做兄弟'],
                    female: ['你没有我家哥哥帅', '我看你像鲲鲲'],
                },
                'wanjian': { //万箭齐发
                    male: ['肆意放箭伤人是违法的', '你踏马犯法了知道嘛？'],
                    female: ['这样是不对的', '这人岂是你配伤的'],
                },
                'wugu': { //五谷丰登
                    male: ['你这什么东西？', '没人稀罕你的粮'],
                    female: ['胡乱浪费粮食', '分粮只分麸糠'],
                },
                'wuxie': { //无懈可击
                    male: ['这会是援兵嘛', '一方有难，八方支援'],
                    female: ['无懈掉他的牌', '会是一种帮助嘛？'],
                },
                'wuzhong': { //无中生有
                    male: ['这算是，嗟来之食嘛？', '再生'],
                    female: ['这么多牌，一定很厉害吧', '哥哥，可以分给人家一张嘛？'],
                },
                'lebu': { //乐不思蜀
                    male: ['不要怕，忍一忍吧', '你有拘捕令嘛？'],
                    female: ['你凭什么乱关人', '希望你妈也被抓'],
                },
                'shandian': { //闪电
                    male: ['别待会劈着自己', '难道有人会移雷之术'],
                    female: ['注意安全哦，桀桀桀', '开始你的火花艺术'],
                },
                'cixiong': { //雌雄双股剑
                    male: ['这双股剑，希望你能好好对待'],
                    female: ['这把宝剑，君切莫遗损'],
                },
                'fangtian': { //方天画戟
                    male: ['这方天戟，希望你能好好对待'],
                    female: ['这把画戟，君切莫遗损'],
                },
                'guanshi': { //贯石斧
                    male: ['这贯石斧，希望你能好好对待'],
                    female: ['这把大斧，君切莫遗损'],
                },
                'hanbing': { //寒冰剑
                    male: ['这寒冰剑，希望你能好好对待'],
                    female: ['这把宝剑，君切莫遗损'],
                },
                'qilin': { //麒麟弓
                    male: ['这麒麟弓，希望你能好好对待'],
                    female: ['这把神弓，君切莫遗损'],
                },
                'qinggang': { //青釭剑
                    male: ['这青釭剑，希望你能好好对待'],
                    female: ['这把宝剑，君切莫遗损'],
                },
                'qinglong': { //青龙偃月刀
                    male: ['这青龙偃月刀，希望你能好好对待'],
                    female: ['这把宝刀，君切莫遗损'],
                },
                'zhangba': { //丈八蛇矛
                    male: ['这丈八蛇矛，希望你能好好对待'],
                    female: ['这把蛇矛，君切莫遗损'],
                },
                'zhuge': { //诸葛连弩
                    male: ['这诸葛连弩，希望你能好好对待'],
                    female: ['这把神弩，君切莫遗损'],
                },
                'bagua': { //八卦阵
                    male: ['这八卦阵，希望你能好好对待'],
                    female: ['这架八卦阵，君切莫遗损'],
                },
                'renwang': { //仁王盾
                    male: ['这仁王盾，希望你能好好对待'],
                    female: ['这架仁王盾，君切莫遗损'],
                },
                'dilu': { //的卢
                    male: ['这的卢，希望你能好好对待'],
                    female: ['这匹的卢，君切莫遗损'],
                },
                'jueying': { //绝影
                    male: ['这绝影，希望你能好好对待'],
                    female: ['这匹绝影，君切莫遗损'],
                },
                'zhuahuang': { //爪黄飞电
                    male: ['这爪黄飞电，希望你能好好对待'],
                    female: ['这匹爪黄飞电，君切莫遗损'],
                },
                'chitu': { //赤兔
                    male: ['这赤兔，希望你能好好对待'],
                    female: ['这匹赤兔，君切莫遗损'],
                },
                'dayuan': { //大宛
                    male: ['这大宛，希望你能好好对待'],
                    female: ['这匹大宛，君切莫遗损'],
                },
                'zixin': { //紫骍
                    male: ['这紫骍，希望你能好好对待'],
                    female: ['这匹紫骍，君切莫遗损'],
                },
                //军争
                'jiu': { //酒
                    male: ['此物甚是甘美，无可不尝', '多喝几口，活血化瘀', '再来点，增强心肺功能'],
                    female: ['将军酒量稳，一看就是好生养的', '喝酒都这么霸气，我真幸福', '一杯你开胃，两杯你肾不亏'],
                },
                'huogong': { //火攻
                    male: ['你烧你玛呢？', '火烧你家祖坟？', '玩火尿炕，早起就遭你妈打'],
                    female: ['肆意放火，处以三年以上十年以内有期徒刑', '肆意放火致人重伤或财务损失的，处以十年以上有期徒刑、无期徒刑或者死刑', '玩火小心自焚'],
                },
                'tiesuo': { //铁索
                    male: ['这是你家人？乱捆！', '我看你是在没事找事', '你这质量怎么样？'],
                    female: ['咦惹，你怎么这般粗鲁', '风韵残半，莫出来害人', 'play之类，岂能现于公共之所'],
                },
                'bingliang': { //兵粮寸断
                    male: ['粮既不是你家的，你有何资格处理', '小朋友，这粮道，可没那么好碰', '你这家伙，准备截辎自食？'],
                    female: ['好狗不挡道', '不清楚自己在干什么嘛？', '人家的粮食你都不放过，那获胜后这城中妇老岂不皆要遭殃？'],
                },
                'guding': { //古锭刀
                    male: ['这古锭刀，希望你能好好对待'],
                    female: ['这把古锭刀，君切莫遗损'],
                },
                'zhuque': { //朱雀羽扇
                    male: ['这朱雀羽扇，希望你能好好对待'],
                    female: ['这把朱雀羽扇，君切莫遗损'],
                },
                'baiyin': { //白银狮子
                    male: ['这银盔，希望你能好好对待'],
                    female: ['这副银盔，君切莫遗损'],
                },
                'tengjia': { //藤甲
                    male: ['这藤甲，希望你能好好对待'],
                    female: ['这副藤甲，君切莫遗损'],
                },
                'hualiu': { //骅骝
                    male: ['这骅骝，希望你能好好对待'],
                    female: ['这匹骅骝，君切莫遗损'],
                },
                'muniu': { //木牛流马
                    male: ['这木牛流马，希望你能好好对待'],
                    female: ['这架木牛流马，君切莫遗损'],
                },
                //忠肝义胆
                'jinchan': { //金蝉脱壳
                    male: ['好技法', '赏心悦目', '看，挡住了'],
                    female: ['防御的不错', '这一次的结算，为了下一次更好的进攻', '后勤保障人员'],
                },
                'qijia': { //弃甲曳兵
                    male: ['这些盔甲你家造？', '奸诈狡猾，你已经死到临头了', '好不快想着怎么弥补，或者更大的报复'],
                    female: ['色狼？喜欢看裸体？', '流氓？爱好扒人衣物？', '日寇？兴尽奸杀抢掠之风？'],
                },
                'shengdong': { //声东击西
                    male: ['拆人家的东墙，补自己的西墙？', '我看你是无的放矢', '无君无父之辈，岂知牌意之珍慧'],
                    female: ['隔山打牛？小心伤到猛虎！', '若是在蛮地，你必死矣', '偷偷摸摸，毫无光明磊落'],
                },
                'zengbin': { //增兵减灶
                    male: ['开始增兵', '准备减灶'],
                    female: ['注意后勤保障诶', '记得恩情哟'],
                },
                'caomu': { //草木皆兵
                    male: ['吃你家粮了？', '你有控粮资格证？'],
                    female: ['自己那么胖说别人？', '喜欢欺负人家瘦子？'],
                },
                'fulei': { //浮雷
                    male: ['小心劈着你自己，大魏传承人', '浮动的雷气可是念旧的'],
                    female: ['小心引雷上身', '就不怕自己变成一簇烟花'],
                },
                'qibaodao': { //七宝刀
                    male: ['这七宝刀，希望你能好好对待'],
                    female: ['这把七宝刀，君切莫遗损'],
                },
                'yinyueqiang': { //银月枪
                    male: ['这银月枪，希望你能好好对待'],
                    female: ['这把银月枪，君切莫遗损'],
                },
                'zhungangshuo': { //衠钢槊
                    male: ['这衠钢槊，希望你能好好对待'],
                    female: ['这把衠钢槊，君切莫遗损'],
                },
                'lanyinjia': { //烂银甲
                    male: ['这烂银甲，希望你能好好对待'],
                    female: ['这副烂银甲，君切莫遗损'],
                },
                //运筹帷幄
                'caochuanjiejian': { //草船借箭
                    male: ['小心人家放火箭，烧得你片甲不存'],
                    female: ['化身吕布揍他'],
                },
                'chenhuodajie': { //趁火打劫
                    male: ['趁火便打劫，同甘怎共苦'],
                    female: ['你真的很可悲'],
                },
                'diaobingqianjiang': { //调兵遣将
                    male: ['嘿，白嫖'],
                    female: ['这种小恩德，便不报喽'],
                },
                'fudichouxin': { //釜底抽薪
                    male: ['有本事就去抽界诸葛的薪'],
                    female: ['你咋不去动秦宓？'],
                },
                'geanguanhuo': { //隔岸观火
                    male: ['这仇，咱记下了'],
                    female: ['不急一时'],
                },
                'shezhanqunru': { //舌战群儒
                    male: ['我们一起骂死他'],
                    female: ['还在阵前饶舌？'],
                },
                'shuigong': { //水攻
                    male: ['哼！自己不也要倒霉？'],
                    female: ['伤敌一千，自损八百'],
                },
                'toulianghuanzhu': { //偷梁换柱
                    male: ['乱动什么，你有？'],
                    female: ['偷窥狂，还敢碰'],
                },
                'wangmeizhike': { //望梅止渴
                    male: ['嘴里似乎有了梅酸'],
                    female: ['看着就解渴'],
                },
                'youdishenru': { //诱敌深入
                    male: ['休走，定要分个胜负'],
                    female: ['休要走了老贼'],
                },
                'hongshui': { //洪水
                    male: ['水也能杀人'],
                    female: ['这般洪流，只愿尽攻敌兵'],
                },
                'huoshan': { //火山
                    male: ['焦炭的味道'],
                    female: ['天降熔火，凡人皆不可抗'],
                },
                'suolianjia': { //锁链甲
                    male: ['这锁链甲，希望你能好好对待'],
                    female: ['这副铁甲，君切莫遗损'],
                },
            };
            game.ZAuseSay_see_self = {
                'none': { //未知
                    male: ['好家伙', '多多益善', '可以，这很下饭', '这操作一直可以的', '很不错'],
                    female: ['好耶好耶', '太好了', '太棒啦', '看好你哟！', '嘿嘿'],
                },
                'sha': { //杀
                    male: ['自己人，别开枪', '子弹打自家人？', '你小子搞什么飞机啊？'],
                    female: ['住手，你们不要再打了', '快停下来'],
                },
                'shan': { //闪
                    male: ['这闪来闪去的我都晕了', '轻功练起来', '大家都要身轻如燕'],
                    female: ['操练起来，呦吼', '同志们，躲练起来', '这闪现秀到我啦'],
                },
                'tao': { //桃
                    male: ['多吃点兄弟，补补身子', '想和你们一起吃', '吃的这么高兴，有这么好吃嘛？', '兄弟666', '娇艳欲滴', '桃桃不绝', '家里有桃庄', '老板大气'],
                    female: ['桃子会女装嘛？', '小桃子快女装', '小桃子吃那么多，屁股红彤彤', '真棒', '桃子鲜美无比，无可不尝', '陪你看桃桃，一桃两桃三桃四桃成桃园', '只要哥哥桃桃多，妹妹跟哥哥一桌', '大户人家', '一桃更比一桃强'],
                },
                'guohe': { //过河拆桥
                    male: ['拆关键的', '看你逆转战局', '兵乐女装都不要了'],
                    female: ['坏东西留着没用', '拆迁过后日子更好', '拆迁款挺多哟'],
                },
                'jiedao': { //借刀杀人
                    male: ['这刀我觉得可以借其一用', '相信他，给他刀', '难道这是关键借刀'],
                    female: ['看他那么自信，要不给他吧', '挺帅的呢', '刀若进了哥哥手，妹妹想看哥哥秀'],
                },
                'juedou': { //决斗
                    male: ['卖血', '不要乱斗啊', '有些时候，矛头还是指向敌人更好'],
                    female: ['精彩但是不够稳定', '决斗斗胜了，没有饭吃', '为什么要这样'],
                },
                'nanman': { //南蛮入侵
                    male: ['南蛮各部一家亲', '大王，方位朝北，直取蜀川', '蛮族苗裔亦向往中原福地'],
                    female: ['苗裔各家一族亲', '山林丰茂，足借入侵', '冲啊！汉子们！'],
                },
                'shunshou': { //顺手牵羊
                    male: ['这会是关键顺吗？', '锦盒水手服一律送给对面', '对面的，看操作'],
                    female: ['忍一忍喽，或许可以回家吃饭了', '都给他喽', '这会扭转乾坤嘛？'],
                },
                'taoyuan': { //桃园结义
                    male: ['以后就是朋友了，要多走动啊', '一起努力，奔向胜利'],
                    female: ['姊妹同心，力可破金', '好东西见面分一半'],
                },
                'wanjian': { //万箭齐发
                    male: ['参见嘴爷', '嘴爷威武霸气'],
                    female: ['好帅的乱击呀', '都去spa'],
                },
                'wugu': { //五谷丰登
                    male: ['鸡汤来喽', '吃饱了才有力气干活'],
                    female: ['这是鸡汤嘛？', '一起吃饱'],
                },
                'wuxie': { //无懈可击
                    male: ['足智多谋', '这难道就是关键无懈'],
                    female: ['看来是饱读诗书之人', '似乎满腹锦纶？'],
                },
                'wuzhong': { //无中生有
                    male: ['军中有此良才，吾等必胜', '这是谁的部将', '牛逼带仨六', '可叹鄙人没文化，一句牛逼走天下', '再生'],
                    female: ['公子才高八斗，小女沁传九合', '一表人才人人爱', '这么多牌，一定很厉害吧', '哥哥，可以分给人家一张嘛？', '这般聪慧，小女子很是倾心', '这般技巧，小女子可做不到'],
                },
                'lebu': { //乐不思蜀
                    male: ['一起沉浸温柔乡', '我似乎看见美人了'],
                    female: ['相伴享受富贵房', '小女子好像看见帅哥了'],
                },
                'shandian': { //闪电
                    male: ['待我招万尺天雷，看敌损连营数堆', '雷神降世，尔等还不速速逃命', ],
                    female: ['电击疗法，敌军定欲试上一试', '对电有欲望嘛？', '哥哥会控雷之术嘛？', '劈了他们', '开始你的火花艺术'],
                },
                'cixiong': { //雌雄双股剑
                    male: ['双剑七尺一寸，正好适合兄弟你', '这双股剑，希望你能好好对待', '莫磨了这雌雄威风', '双股剑之强，应当展现一番'],
                    female: ['双股合一，力可断金', '这把宝剑，君切莫遗损', '雌雄之威，请君一试'],
                },
                'fangtian': { //方天画戟
                    male: ['画戟一丈二，正好适合兄弟你', '这方天戟，希望你能好好对待', '莫削了这画戟威风', '方天之强，应当展现一番'],
                    female: ['方天画戟成行，龙凤绣旗作队', '这把画戟，君切莫遗损', '方天之威，请君一试'],
                },
                'guanshi': { //贯石斧
                    male: ['大斧柄坚贯石，正好适合兄弟你', '这贯石斧，希望你能好好对待', '莫掩了这大斧威风', '贯石之强，应当展现一番'],
                    female: ['始甫坚斧，制之以致', '这把大斧，君切莫遗损', '贯石之威，请君一试'],
                },
                'hanbing': { //寒冰剑
                    male: ['寒痛彻心，正好适合兄弟你', '这寒冰剑，希望你能好好对待', '莫灭了这寒冰威风', '寒冰之强，应当展现一番'],
                    female: ['寒气逼人，冰清笃心', '这把宝剑，君切莫遗损', '寒冰之威，请君一试'],
                },
                'qilin': { //麒麟弓
                    male: ['麒麟昭世动天象，正好适合兄弟你', '这麒麟弓，希望你能好好对待', '莫断了这神弓威风', '麒麟之强，应当展现一番'],
                    female: ['虎筋弦响弓开，雕羽翅飞箭到时', '这把神弓，君切莫遗损', '麒麟之威，请君一试'],
                },
                'qinggang': { //青釭剑
                    male: ['削铁如泥，长虹贯日，正好适合兄弟你', '这青釭剑，希望你能好好对待', '莫灰了这刚剑威风', '青釭之强，应当展现一番'],
                    female: ['拔剑挥砍，衣甲平过，血如涌泉', '这把宝剑，君切莫遗损', '青釭之威，请君一试'],
                },
                'qinglong': { //青龙偃月刀
                    male: ['偃月刀九尺五寸，正好适合兄弟你', '这青龙偃月刀，希望你能好好对待', '莫削了这偃月刀威风', '青龙偃月之强，应当展现一番'],
                    female: ['三十六刀，刀势即大；兵仗遇之，无不屈者', '这把宝刀，君切莫遗损', '青龙偃月之威，请君一试'],
                },
                'zhangba': { //丈八蛇矛
                    male: ['蛇矛八寸，正好适合兄弟你', '这丈八蛇矛，希望你能好好对待', '莫弱了这蛇矛威风', '丈八长蛇之强，应当展现一番'],
                    female: ['矛丈八点，激截敌阵', '这把蛇矛，君切莫遗损', '丈八长蛇之威，请君一试'],
                },
                'zhuge': { //诸葛连弩
                    male: ['弩十余寸，正好适合兄弟你', '这诸葛连弩，希望你能好好对待', '莫减了这连弩威风', '诸葛神弩之强，应当展现一番'],
                    female: ['损益连弩，铁矢元戎', '这把神弩，君切莫遗损', '诸葛神弩之威，请君一试'],
                },
                'bagua': { //八卦阵
                    male: ['乾三连 坤六断 震仰盂 艮覆碗 离中虚 坎中满 兑上缺 巽下断', '这八卦阵，希望你能好好对待', '莫削了这八阵威风', '八卦之强，应当展现一番'],
                    female: ['太极生两仪，两仪生四象，四象生八卦', '这架八卦阵，君切莫遗损', '八卦之威，请君一试'],
                },
                'renwang': { //仁王盾
                    male: ['仁义治天下', '这仁王盾，希望你能好好对待', '莫削了这王盾威风', '仁王之强，应当展现一番'],
                    female: ['握仁王之宝镜，日月重光', '这架仁王盾，君切莫遗损', '仁王之威，请君一试'],
                },
                'dilu': { //的卢
                    male: ['宝马一踊三丈，正好适合兄弟你', '这的卢，希望你能好好对待', '莫了掩了这的卢威风', '的卢之强，应当展现一番'],
                    female: ['马作的卢飞快，弓如霹雳弦惊', '这匹的卢，君切莫遗损', '的卢之威，请君一试'],
                },
                'jueying': { //绝影
                    male: ['宝马绝影，正好适合兄弟你', '这绝影，希望你能好好对待', '莫藏了这绝影威风', '绝影之强，应当展现一番'],
                    female: ['极驹驰奔，难见踪影', '这匹绝影，君切莫遗损', '绝影之威，请君一试'],
                },
                'zhuahuang': { //爪黄飞电
                    male: ['马引十万之众，正好适合兄弟你', '这爪黄飞电，希望你能好好对待', '莫磨了这爪黄威风', '爪黄飞电之强，应当展现一番'],
                    female: ['同天子相猎于田，引十万之众而鉴心', '这匹爪黄飞电，君切莫遗损', '爪黄飞电之威，请君一试'],
                },
                'chitu': { //赤兔
                    male: ['汗血宝马，正好适合兄弟你', '这赤兔，希望你能好好对待', '莫灭了这汗血宝马威风', '赤兔之强，应当展现一番'],
                    female: ['马中赤兔', '这匹赤兔，君切莫遗损', '赤兔之威，请君一试'],
                },
                'dayuan': { //大宛
                    male: ['此马赛龙雀，正好适合兄弟你', '这大宛，希望你能好好对待', '莫掩了这胡骑威风', '大宛之强，应当展现一番'],
                    female: ['胡骑劲驰，夜照玉狮子', '这匹大宛，君切莫遗损', '大宛之威，请君一试'],
                },
                'zixin': { //紫骍
                    male: ['此马文雅浮颂，正好适合兄弟你', '这紫骍，希望你能好好对待', '莫暗了这良驹威风', '紫骍之强，应当展现一番'],
                    female: ['怀夏后之九代，想陈王之紫骍', '这匹紫骍，君切莫遗损', '紫骍之威，请君一试'],
                },
                //军争
                'jiu': { //酒
                    male: ['美酒就要一起喝', '酒的香醇真让人难以抵抗呢！', '好兄弟，美酒细品如佳人', '好酒量', '兄弟再来一坛', '美酒伴佳人', '此物甚是甘美，无可不尝', '多喝几口，活血化瘀', '再来点，增强心肺功能'],
                    female: ['新贵妇醉酒', '爱恨就在一瞬间～', '昨夜雨疏风骤，浓睡不消残酒', '将军酒量稳，一看就是好生养的', '喝酒都这么霸气，我真幸福', '一杯你开胃，两杯你肾不亏', '少酌怡情', '慢慢喝，别呛着喽', '好喝嘛？'],
                },
                'huogong': { //火攻
                    male: ['火焰盛宴', '飞火流星雨', '今晚篝火晚会'],
                    female: ['篝火晚会，咱们一起纵情舞蹈', '炽情伴热浪', '歌舞不停，宴会不散'],
                },
                'tiesuo': { //铁索
                    male: ['激情四射', '热心澎湃', '这是准备放纵自己'],
                    female: ['大家同舟共济', '大家同心戮力', '大家同国一气'],
                },
                'bingliang': { //兵粮寸断
                    male: ['大家一起减肥', '同甘苦，共患难', '回忆曾经挨饿的过去'],
                    female: ['强制节食', '要记住这段艰辛的岁月', '不要遗忘这艰苦的时光'],
                },
                'guding': { //古锭刀
                    male: ['宝刀七尺三寸，正好适合兄弟你', '这古锭刀，希望你能好好对待', '莫断了这宝刀威风', '古锭之强，应当展现一番'],
                    female: ['若敢来犯，必叫你大败而归', '击而破之', '这把古锭刀，君切莫遗损', '古锭之威，请君一试'],
                },
                'zhuque': { //朱雀羽扇
                    male: ['羽扇纶巾，正好适合兄弟你', '这朱雀羽扇，希望你能好好对待', '莫磨了这宝扇威风', '朱雀之强，应当展现一番'],
                    female: ['离火空天，扇幻朱雀', '这把朱雀羽扇，君切莫遗损', '朱雀之威，请君一试'],
                },
                'baiyin': { //白银狮子
                    male: ['他强任他强，清风拂山岗', '这银盔，希望你能好好对待', '莫灭了这狮子威风', '雄狮之强，应当展现一番'],
                    female: ['他横任他横，明月照大江', '这副银盔，君切莫遗损', '雄狮之威，请君一试'],
                },
                'tengjia': { //藤甲
                    male: ['此甲渡江不沉，浸水不湿，正好适合兄弟你', '这藤甲，希望你能好好对待', '莫削了这藤甲威风', '荆藤之强，应当展现一番'],
                    female: ['刀枪不入，落水不沉', '这副藤甲，君切莫遗损', '荆藤之威，请君一试'],
                },
                'hualiu': { //骅骝
                    male: ['骅骝飞骤，正好适合兄弟你', '这骅骝，希望你能好好对待', '莫减了这铁马威风', '铁马之强，应当展现一番'],
                    female: ['骅骝长嘶，奋蹄蹴地', '这匹骅骝，君切莫遗损', '铁马之威，请君一试'],
                },
                'muniu': { //木牛流马
                    male: ['此宝奇异珍惜，正好适合兄弟你', '这木牛流马，希望你能好好对待', '莫弱了这木牛流马威风', '木牛流马之强，应当展现一番'],
                    female: ['架载一岁粮，行程数万里', '这架木牛流马，君切莫遗损', '木牛流马之威，请君一试'],
                },
                //忠肝义胆
                'jinchan': { //金蝉脱壳
                    male: ['金蝉脱壳，好杂技', '好，兄弟们帅气', '看样子连篮球都会打'],
                    female: ['自家寨子在耍杂技', '这杂技好功夫', '逃脱术'],
                },
                'qijia': { //弃甲曳兵
                    male: ['大家一起脱光光 一起洗澡', '天干气热，游泳消暑'],
                    female: ['凉快了许多', '哇，好涩'],
                },
                'shengdong': { //声东击西
                    male: ['开始过牌', '纳贡不停'],
                    female: ['纳贡祈福', '调换资源'],
                },
                'zengbin': { //增兵减灶
                    male: ['这下就等敌军上钩', '有这般才华，何愁此战不胜', '开始增兵', '准备减灶'],
                    female: ['我军没有你，得不到胜利啊！', '汝有良略在怀，必为我军所需', '注意后勤保障诶', '记得恩情哟', '我似乎要去拆炉灶了', '多准备些干粮吧'],
                },
                'caomu': { //草木皆兵
                    male: ['公会没粮了，都减减肥', '政策节粮，被迫光盘'],
                    female: ['勒紧裤腰带过日子', '有点饿'],
                },
                'fulei': { //浮雷
                    male: ['雷公助我一臂之力', '我似乎已经闻到了敌人尸体的焦熟味', '敌人是不是有人在和女朋友发誓', '对面不要乱发誓守承诺了，你看浮雷都招来了'],
                    female: ['这般威猛，惊天控雷', '电光火石', '小心点朋友，这可是浮动的雷', '或许倒霉蛋在敌方呢'],
                },
                'qibaodao': { //七宝刀
                    male: ['刀长一尺二寸七分，正好适合兄弟你', '这七宝刀，希望你能好好对待', '莫掩了这七宝刀威风', '七星之强，应当展现一番'],
                    female: ['刀长尺余，七宝嵌饰，极其锋利', '这把七宝刀，君切莫遗损', '七星之威，请君一试'],
                },
                'yinyueqiang': { //银月枪
                    male: ['枪重四十斤，正好适合兄弟你', '这银月枪，希望你能好好对待', '莫埋了这银月枪威风', '银月之强，应当展现一番'],
                    female: ['银枪烂雪，若云不染', '这把银月枪，君切莫遗损', '银月之威，请君一试'],
                },
                'zhungangshuo': { //衠钢槊
                    male: ['此乃纯钢之槊，正好适合兄弟你', '这衠钢槊，希望你能好好对待', '莫灰了这钢槊威风', '衠钢之强，应当展现一番'],
                    female: ['堡戍标枪槊，关河锁舳舻', '这把衠钢槊，君切莫遗损', '衠钢之威，请君一试'],
                },
                'lanyinjia': { //烂银甲
                    male: ['银甲灿烂，正好适合兄弟你', '这烂银甲，希望你能好好对待', '莫没了这银甲威风', '灿银之强，应当展现一番'],
                    female: ['银光璀璨，泛彩流霞', '这副烂银甲，君切莫遗损', '灿银之威，请君一试'],
                },
                //运筹帷幄
                'caochuanjiejian': { //草船借箭
                    male: ['靠你输出了'],
                    female: ['准备战斗'],
                },
                'chenhuodajie': { //趁火打劫
                    male: ['也是没有办法的办法'],
                    female: ['将就一下喽'],
                },
                'diaobingqianjiang': { //调兵遣将
                    male: ['调兵遣将，备战整军'],
                    female: ['等待下一轮攻势吧'],
                },
                'fudichouxin': { //釜底抽薪
                    male: ['帮忙觉醒啦'],
                    female: ['这会是关键转折嘛？'],
                },
                'geanguanhuo': { //隔岸观火
                    male: ['一起扔废牌'],
                    female: ['这……'],
                },
                'shezhanqunru': { //舌战群儒
                    male: ['大家沉下心来，自己人'],
                    female: ['听你讲故事'],
                },
                'shuigong': { //水攻
                    male: ['太热了，脱盔甲凉快凉快'],
                    female: ['谢谢啦，这衣服打了死结啦'],
                },
                'toulianghuanzhu': { //偷梁换柱
                    male: ['发动了技能小遗计'],
                    female: ['直接送麦克风'],
                },
                'wangmeizhike': { //望梅止渴
                    male: ['好歹止个损喽'],
                    female: ['也算是补给一份吧'],
                },
                'youdishenru': { //诱敌深入
                    male: ['要进去了'],
                    female: ['一起到后方吃饭吧'],
                },
                'hongshui': { //洪水
                    male: ['大水奔来，敌军必败', '水也能杀人', '共工下凡'],
                    female: ['敌军之不仁，水灌而四散', '水神是你嘛？', '这般洪流，只愿尽攻敌兵'],
                },
                'huoshan': { //火山
                    male: ['雄火天落，助正义之师', '祝融下凡', '焦炭的味道'],
                    female: ['星星之火，可以燎原；峻山之火，驱寇破狷', '火神是你嘛？', '天降熔火，凡人皆不可抗'],
                },
                'suolianjia': { //锁链甲
                    male: ['链祛雷火，正好适合兄弟你', '这锁链甲，希望你能好好对待', '莫没了这链甲威风', '链甲之强，应当展现一番'],
                    female: ['锁链缠盔，尽染土灰', '这锁链甲，君切莫遗损', '链甲之威，请君一试'],
                },
            };
            //用牌目标
            lib.skill._zuanUSECARDsayskill = {
                trigger: {
                    global: ["useCard"],
                },
                filter: function(event, player) {
                    if (game.wanqingIsOpen) return false;
                    if (lib.config['extension_祖安设置_zuantype'].indexOf('new') == -1) return false;
                    if (lib.config['extension_祖安设置_zuantype'] == 'new_chg') {
                        if (player == game.me) return false;
                        if (game.zuanSayCold.contains(player)) return false;
                    }
                    return parseFloat(lib.config['extension_祖安设置_ransay']) != '0';
                },
                forced: true,
                silent: true,
                priority: -5,
                content: function() {
                    'step 0';
                    //概率随机模块
                    if (Math.random() * 100 >= parseFloat(lib.config['extension_祖安设置_ransay'])) {
                        if (event && event.finish) {
                            event.finish();
                        } else {
                            return;
                        }
                    }
                    'step 1';
                    //加载说话宝典（已经有了的卡牌）
                    event.cardlist = game.ZAcardlist;
                    //我 没参与（实际上不会存在这种情况,仅供拿来参考模板）
                    /*event.say_me_none=game.ZAuseSay_me_none;
		            //我 对别人
		            event.say_me_from=game.ZAuseSay_me_from;
		            //我 被人对
		            event.say_me_to=game.ZAuseSay_me_to;
		            //我 对自己
		            event.say_me_self=game.ZAuseSay_me_self;
		            //观众 两边都不帮
		            event.say_see_none=game.ZAuseSay_see_none;
		            //观众 只帮发起者
		            event.say_see_from=game.ZAuseSay_see_from;
		            //观众 只帮目标
		            event.say_see_to=game.ZAuseSay_see_to;
		            //观众 两边都帮
		            event.say_see_self=game.ZAuseSay_see_self;*/
                    //判断来源和受体
                    event.from = trigger.player;
                    event.to = trigger.targets;
                    if (get.translation(event.from) == '') event.from = 'none';
                    if (get.translation(event.to) == '') event.to = ['none'];
                    //alert(event.from==player);
                    //alert(event.to.contains(player));
                    'step 2';
                    //定位自己和类型
                    //var fromto=[event.from,event.to];
                    var tps = ['none', 'from', 'to', 'self'];
                    var num = 0;
                    if (event.from == player || event.to.contains(player)) {
                        //仅对于自己和对象
                        event.ide = 'me';
                        if (player == event.from) num++;
                        if (event.to.contains(player)) num += 2;
                    } else {
                        //优先发起者，再判断目标
                        event.ide = 'see';
                        if (event.from != 'none' && get.attitude(player, event.from) > 0) num++;
                        if (event.to != 'none') {
                            var plus = 0;
                            for (var i = 0; i < event.to.length; i++) {
                                if (get.attitude(player, event.to[i]) > 0) plus++;
                            }
                            if (plus * 2 >= event.to.length) num += 2;
                        }
                    }
                    event.tp = tps[num];
                    'step 3';
                    //判断卡牌的名字
                    var card = trigger.card.name;
                    if (event.cardlist.contains(card)) {
                        event.cardname = trigger.card.name;
                    } else {
                        event.cardname = 'none';
                    }
                    'step 4';
                    //判断角色性别
                    if (player.hasSex('female')) {
                        if (player.hasSex('male')) {
                            event.sex = ['male', 'female'].randomGet();
                        } else {
                            event.sex = 'female';
                        }
                    } else {
                        event.sex = 'male';
                    }
                    'step 5';
                    //组装语言模块
                    event.said = game['ZAuseSay_' + event.ide + '_' + event.tp][event.cardname][event.sex];
                    event.chat = event.said.randomGet();
                    'step 6';
                    //最后一道关卡，加载失败就不说话了
                    'step 7';
                    if (lib.config['extension_祖安设置_zuantype'] == 'new_chg') {
                        var ransec = (2 + [0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 12, 13, 14, 15, 15, 15, 20, 40].randomGet()) * 1000 + [0, 0, 3, 5, 7].randomGet() * 100;
                        if (!game.zuanSayCold.contains(player)) game.zuanSayCold.push(player);
                        if (ransec > 0) setTimeout(function() {
                            if (game.zuanSayCold.contains(player)) game.zuanSayCold.remove(player);
                        },
                        ransec);
                        setTimeout(function() {
                            player.say(event.chat);
                        },
                        Math.ceil(Math.random() * 2000));
                    } else {
                        player.say(event.chat);
                    }
                },
            }
            game.ZAhpSay_me_none = { //可以不填这一栏，似乎不会发生
                'recover': { //回复一点体力
                    male: ['我回复体力'],
                    female: ['我回复体力'],
                },
                'recover_heavy': { //回复一点以上体力
                    male: ['我回复很多体力'],
                    female: ['我回复很多体力'],
                },
                'damage': { //受到伤害
                    male: ['我受到伤害'],
                    female: ['我受到伤害'],
                },
                'damage_heavy': { //受到一点以上伤害
                    male: ['我受到很多伤害'],
                    female: ['我受到很多伤害'],
                },
                'loseHp': { //流失体力
                    male: ['我流失体力'],
                    female: ['我流失体力'],
                },
                'loseHp_heavy': { //流失一点以上体力
                    male: ['我流失很多体力'],
                    female: ['我流失很多体力'],
                },
                'draw': { //摸牌
                    male: ['摸一张牌'],
                    female: ['摸一张牌'],
                },
                'draw_heavy': { //摸一张以上的牌
                    male: ['摸%cnnum%张牌'],
                    female: ['摸%cnnum%张牌'],
                },
                'die': { //去势
                    male: ['寄了'],
                    female: ['寄了'],
                },
            };
            game.ZAhpSay_me_from = { //我令别人**时我说的
                'recover': { //回复一点体力
                    male: ['真就废物啊，还要我救你是吧', '这不得给我磕一个，我指的是头，不是情侣，还男情侣', '这块酥本来留着给我闺女和儿子的，归你了，都一样'],
                    female: ['来一口，这叫酥，一人一口酥', '酥很好吃，但不能多吃', '[一合酥]店家开业喽'],
                },
                'recover_heavy': { //回复一点以上体力
                    male: ['不装了，摊牌了，我家开桃园的', '本来想以普通人的身份和你们相处，换来的却是疏远', '遇到困难首先不要慌张，万一朋友帮得上呢'],
                    female: ['很饿嘛，来块切糕吧', '香喷喷的切糕，好客的人，哪都少不了', '看，这是什么，这不是饼干，这是我家生产的压缩……'],
                },
                'damage': { //受到伤害
                    male: ['刺拳', '正蹬', '鞭腿'],
                    female: ['兰花不翘，未必不妖', '你是坏人，打你打你打你', '小拳拳捶你胸口'],
                },
                'damage_heavy': { //受到一点以上伤害
                    male: ['接下来，我打个连五鞭哈', '松活弹抖闪电鞭', '犯我疆土者，吾必击而破之'],
                    female: ['这一招，是大宝哥哥教我的', '遇到不公义的事情，我也要重拳出击', '不开包子铺，但有对包子在手上'],
                },
                'loseHp': { //流失体力
                    male: ['取尿,尿检', '不多不多，一滴而已', '我带你玩玩真实伤害'],
                    female: ['按摩行的手艺，包你酸爽，不过我是新手', '皮不疼吧，但肉疼不疼我就不知道了', '你出汗了耶'],
                },
                'loseHp_heavy': { //流失一点以上体力
                    male: ['放血，化疗', '虽然多，但没办法，谁让环境如此', '白色暴击！'],
                    female: ['按摩？按什么摩，电钻按摩要不要？', '恭喜你，成为本店的第一百位幸运客户，免费赠予马拉松比赛券', '别的本事我没有，调理个把个人，是祖传的手艺'],
                },
                'draw': { //摸牌
                    male: ['莫跟哥哥客气', '锦上添花，不如雪中送炭（价值论）', '小小薄礼，不成敬意'],
                    female: ['呐，给你了，不用还', '多多少少也是心意嘛，女孩子的心意，那可就是千金喽', '虽然不多，但也值得'],
                },
                'draw_heavy': { //摸一张以上的牌
                    male: ['%cnnum%贯钱，别忘了还', '有借有还，再借才能不难', '雪中送炭，不如锦上添花（利益论）'],
                    female: ['%cnnum%张牌，等着你秀起来呢', '加油，别辜负了我的努力', '帮了你，我们就是朋友了'],
                },
                'die': { //去势
                    male: ['你的好日子，到头了', '明年的今天，就是你的祭日', '笑啊，接着笑啊，怎么不笑了？'],
                    female: ['不小心的而已，这能怪我吗', '让我看看，你是上天堂还是下地狱', '呜呜呜，人家不是故意的啦'],
                },
            };
            game.ZAhpSay_me_to = { //别人令我**时我说的
                'recover': { //回复一点体力
                    male: ['谢谢了，十分感谢', '幸好有你', '可惜了，杯水车薪，但还算将就'],
                    female: ['爱了爱了', '去[一合酥]店家工作吧，你一定能有所作为', '你人真好'],
                },
                'recover_heavy': { //回复一点以上体力
                    male: ['感谢老铁送来的血瓶', '感谢感谢，万分感谢', '有你真是我的福气'],
                    female: ['结婚，马上结婚', '来人，记入族谱', '你真是我的福星呀'],
                },
                'damage': { //受到伤害
                    male: ['偷袭我是吧', '你再动我一下试试', '给你脸了还'],
                    female: ['好痛，为什么要欺负我，嘤嘤嘤', '哥哥，你真的舍得打人家嘛', '你为什么下得去手，如果是我，我做不到'],
                },
                'damage_heavy': { //受到一点以上伤害
                    male: ['你打我算什么本事，有胆量去和马大师打擂啊', '来，你家住在哪里', '君子动口不动手，有本事来亲我'],
                    female: ['我也喜欢大宝哥哥，可大宝哥哥怎的总是喜欢欺负我', '我讨厌包子', '啊，好痛啊，你怎么可以对一个女孩子下这么重的手'],
                },
                'loseHp': { //流失体力
                    male: ['我用不着你来推着我跑', '下次我也带着你跑步', '你以为真能影响到我嘛？'],
                    female: ['唔，又来了', '看来又得喝红糖水了', '真希望难受的日子可以早些过去'],
                },
                'loseHp_heavy': { //流失一点以上体力
                    male: ['你还是人嘛？', '如果有下次，我也放放你的血', '春花秋月何时了，春花，村花……'],
                    female: ['完了，失调了', '倒霉倒霉倒霉，进入一级戒备状态，准备吃药', '现在姨母笑不出来，姨妈倒笑起来了'],
                },
                'draw': { //摸牌
                    male: ['多少看不过去', '不够不够，还有嘛？', '我对你那么好，怎么就给我这么一点'],
                    female: ['谢谢啦，薄礼也是礼嘛', '这个要还吗？', '送到嘴边的东西，嘻，不要白不要'],
                },
                'draw_heavy': { //摸一张以上的牌
                    male: ['%cnnum%贯钱，谢谢就不说了', '如此厚礼，定当厚爱', '大恩不言谢，铭记在心'],
                    female: ['哇，%cnnum%张牌，你对我真好', '放心吧，定不负君意', '风拂过麦田，叠起千层浪，你随风而来，牵起涟漪的悠荡'],
                },
                'die': { //去势
                    male: ['我做鬼也不会放过你', '我死后，孩儿你不必悲伤难过，爹永远在你心中', '记得给爹烧纸钱，不孝子', '十八年后，又是一条好汉'],
                    female: ['你好狠的心', '厉鬼缠身，你有听说过嘛？', '积点德吧，你迟早也会有这么一天，我等着你！', '十年八年，还看那满天辰星'],
                },
            };
            game.ZAhpSay_me_self = {
                'recover': { //回复一点体力
                    male: ['别人靠不住，还得是靠自己', '吃点连花清瘟，缓解一下', '桃子真好吃，桃子姐姐也好吃'],
                    female: ['小发烧小感冒，自己动手治疗就好', '自家的酥，味道真棒', '先尝尝看新做的酥合不合格，嗯～合格'],
                },
                'recover_heavy': { //回复一点以上体力
                    male: ['如果我有二桃，绝不会杀三士，自己吃不好嘛？', '遗计两个桃子最好吃了，甜甜的', '自我妙手回春，见过没有'],
                    female: ['正典燕窝，好吃的嘞', '新疆切糕，美味的嘞', '人参公鸡，嗯，还算不错'],
                },
                'damage': { //受到伤害
                    male: ['我上来就是给自己一个左正蹬', '我上来就是给自己一个左刺拳', '我上来就是给自己一个右鞭腿'],
                    female: ['鱼刺卡住喉咙了，拍拍胸脯，嘶～好软～', '胸口好闷，有人知道捶几下可以缓解嘛？', '伤敌一千，自损八百'],
                },
                'damage_heavy': { //受到一点以上伤害
                    male: ['我打个连五鞭哈，哎呦，我的右眼', '松活弹抖闪电鞭，鞭鞭到位', '别人笑我太疯癫，我笑他人看不穿'],
                    female: ['这一招，是曹老板教我的', '为什么我拿不了别人的牌，好奇怪哦', '不开包子铺，但有对包子在手上，呼～烫手'],
                },
                'loseHp': { //流失体力
                    male: ['几圈长跑下来，气喘呼呼', '排汗而已，丝毫不慌', '下次应该多喝些营养液'],
                    female: ['哎，谁又能懂我的心思呢', '听说细柳鞭人没有疤痕，试试看，嘶～好痛', '身体好像有点不舒服了'],
                },
                'loseHp_heavy': { //流失一点以上体力
                    male: ['天才是1%的灵感和99%的汗水', '你猜为什么我会这么做，因为我有1%的灵感', '锻炼的回报是等价的，还会更高，等着瞧吧'],
                    female: ['马拉松……还是……还是不适合我', '祖传的家法太恐怖了，哎呦……疼疼疼', '情随伤而逝，恨随通而至'],
                },
                'draw': { //摸牌
                    male: ['锦上添花，得先在雪地里盖瓦。', '来牌来牌', '这是千里来的鹅毛嘛？', '嘿嘿，打开我的小金库，哎呀！怎么少了那么多！'],
                    female: ['这冤家，还知道在我床头留钱', '小摸一张', '早点钱，算是有着落了', '只可惜，昨天看上的东西还得我一阵子了'],
                },
                'draw_heavy': { //摸一张以上的牌
                    male: ['%cnnum%贯钱，这下子撞了大运了', '这牌……是不是，有点多啊', '发财了', '雪地盖瓦？我直接雪地里挖矿'],
                    female: ['%cnnum%张牌，这下子，该花木兰出场了', '一下子拿了这么多牌，有点不好意思呢', '嘿，冤家的小金库真多，都拿走得了，算了，留一点吧', '你看那片天，那是我即将打下来的部分'],
                },
                'die': { //去势
                    male: ['我要黑化', '她不在了，活着还有什么意义呢？', '等着我，你不会孤独，有我陪你', '我走了，正如我轻轻地来'],
                    female: ['我要黑化', '他不在了，活着还有什么意义呢？', '冤家，我来了，等我', '挥一挥衣袖，不带走一片云彩'],
                },
            };
            game.ZAhpSay_see_none = { //比如作为忠臣看对面俩反贼狗咬狗时说的
                'recover': { //回复一点体力
                    male: ['有人吃药了', '要我说，你们没资格吃这顿饭'],
                    female: ['说实话，这块酥不如给我吃', '浪费了酥'],
                },
                'recover_heavy': { //回复一点以上体力
                    male: ['嚯，吃这么多，撑死你们', '这是莫大的浪费啊，可耻'],
                    female: ['虽然不羡慕，但我还是觉得应该交给我们平分更好', '可惜了，可惜了那些补品'],
                },
                'damage': { //受到伤害
                    male: ['狗狗们争夺首领地位喽', '狗咬狗的戏份，着实不错'],
                    female: ['有人挨打了', '呜呼，打得漂亮，再狠一点'],
                },
                'damage_heavy': { //受到一点以上伤害
                    male: ['狗狗们下嘴真狠', '使劲吠，使劲叫，撕咬起来那最好'],
                    female: ['有人挨打了，看起来有点疼', '嘿，打得漂亮，狗狠'],
                },
                'loseHp': { //流失体力
                    male: ['是不是有人流汗了', '你们流你们的汗吧，没人会管你们什么所谓的成果'],
                    female: ['有人来那个了，但和我没什么关系', '别看我，我可没有储备的红糖'],
                },
                'loseHp_heavy': { //流失一点以上体力
                    male: ['放血？头一次见化疗', '原来化疗是这样子的'],
                    female: ['失调了，真惨，但和我有关系嘛？', '红糖要嘛，我有，但不给你'],
                },
                'draw': { //摸牌
                    male: ['牌堆里失去了一张牌', '又有东西被浪费了'],
                    female: ['是不是有什么东西，被扔进垃圾桶了', '又有卡牌离开了牌堆'],
                },
                'draw_heavy': { //摸一张以上的牌
                    male: ['国库里失去了%cnnum%贯钱', '发牌员有猫腻啊'],
                    female: ['%cnnum%张牌被浪费了，可惜', '别琢磨了，给你再多也没用'],
                },
                'die': { //去势
                    male: ['有人死了', '赶紧办丧吧，等不及吃席了'],
                    female: ['好像谁去世了', '哪里传来的唢呐声，我也赶过去交钱吧'],
                },
            };
            game.ZAhpSay_see_from = { //比如作为主公看忠臣对反贼产生以下效果时说的
                'recover': { //回复一点体力
                    male: ['？', '我想你的逻辑学一定不太好吧'],
                    female: ['6', '你是怎么想的'],
                },
                'recover_heavy': { //回复一点以上体力
                    male: ['？？？', '还得是你啊'],
                    female: ['9，因为6翻了', '家人们，咱就是说，谁懂啊'],
                },
                'damage': { //受到伤害
                    male: ['好啊，接着加力，不行我就给你接力', '冲锋，系兄弟就打他'],
                    female: ['小朋友这不错，加油哦', '看好你哦，我相信你，我的勇士'],
                },
                'damage_heavy': { //受到一点以上伤害
                    male: ['砍死他，恶贯满盈的家伙而已，别怕造下杀孽', '砍死他，那反而算积德'],
                    female: ['原来你是慢热型的啊，漂亮', '升职，加薪，换岗位，工作不累，工资翻倍'],
                },
                'loseHp': { //流失体力
                    male: ['对，就这样，推着他跑步，让他根本停不下来', '累死他'],
                    female: ['虽然这不太好，但我并不反对', '干得不错，你肯定能成为优秀的蒸桑师'],
                },
                'loseHp_heavy': { //流失一点以上体力
                    male: ['干脆不如直接把他捆在跑步机上，昼夜不停', '放血放血，血流成河最好'],
                    female: ['反对？反什么，我反手一个支持', '失调算什么，赶紧去世吧'],
                },
                'draw': { //摸牌
                    male: ['倒垃圾也不能乱倒啊', '再垃圾也得自己留着，毕竟卖破烂也比给这个高强'],
                    female: ['真的，不如自己留着', '还是你太过憨厚了'],
                },
                'draw_heavy': { //摸一张以上的牌
                    male: ['%cnnum%贯钱？你家里钱那么多？', '富哥V50'],
                    female: ['你让他摸%cnnum%张牌？你好好想想吧，真让人无语', '心疼，心酸，心累'],
                },
                'die': { //去势
                    male: ['吃席喽，我坐烟酒那桌', '来来来，待会席上多吃点 吃个够本'],
                    female: ['开席喽，我坐帅哥那桌', '席上会有帅哥嘛，歪瓜裂枣太多，还是算了吧'],
                },
            };
            game.ZAhpSay_see_to = { //比如作为反贼看忠臣对自己队友产生以下效果时说的
                'recover': { //回复一点体力
                    male: ['呦，不得了', '嘿，可了不得'],
                    female: ['这人好奇怪哦', '他是不是刚睡醒，看上去迷迷糊糊的'],
                },
                'recover_heavy': { //回复一点以上体力
                    male: ['如果不知根知底，我差点都要以为有卧底了', '赶紧的，千芬见'],
                    female: ['诶？发烧烧坏了嘛？', '估计是四川洞窟里坐的那尊大佛'],
                },
                'damage': { //受到伤害
                    male: ['放开他，冲我来', '施主，要以和为贵'],
                    female: ['他做错了什么', '不要打了，砸到花花草草也是会不好的'],
                },
                'damage_heavy': { //受到一点以上伤害
                    male: ['喔弥陀佛，施主戾气太重，恐下地狱', '打轻点，那可是你的队友'],
                    female: ['最讨厌乱动手的家伙了', '一看就不是什么好东西，看上去不算什么玩意'],
                },
                'loseHp': { //流失体力
                    male: ['我说小伙子，你这样不好', '跑步，应当先跑为礼，何必劳烦他人'],
                    female: ['你别这样，如果身体出了问题，只怕责任你担当不起', '抛开事情不谈，难道你就是对的嘛？'],
                },
                'loseHp_heavy': { //流失一点以上体力
                    male: ['杀批，要以和为贵，要讲杀德', '我说你小伙子有本事去推老同志'],
                    female: ['如果人出事了，你可就没德了，反倒缺德了', '人家身体出问题了吧，你完了，你完了'],
                },
                'draw': { //摸牌
                    male: ['嘿，原来是猪上树了', '你看那边，树上好大一块粉白团子'],
                    female: ['这就是扶危济困嘛，真是侠人义士', '笑死我了'],
                },
                'draw_heavy': { //摸一张以上的牌
                    male: ['白送%cnnum%贯钱？太阳打西边出来喽', '要我说啊，你送得少了，应该再给点'],
                    female: ['给别人%cnnum%张牌，你可想过，给得还可以再多点？', '你真棒，如果吃亏是福，那你一定是福星'],
                },
                'die': { //去势
                    male: ['兄弟，你去吧，我帮你料理后事', '这梁子，结下了！'],
                    female: ['此生，就此别过了', '莫怪，安息吧'],
                },
            };
            game.ZAhpSay_see_self = { //比如作为主公看自己俩忠臣互砍时说的
                'recover': { //回复一点体力
                    male: ['邻里和睦，互帮互助', '这才叫朋友嘛，朋友间不就是要互相帮助嘛？'],
                    female: ['好耶！这么和睦的景象，拍个朋友圈吧', '一片和气，少见'],
                },
                'recover_heavy': { //回复一点以上体力
                    male: ['这是拜过把子了吧', '关系挺铁啊，朋友'],
                    female: ['义结金莲了嘛，呸呸呸，义结金兰', '令人感动不已，肺腑间都流着赞声'],
                },
                'damage': { //受到伤害
                    male: ['你知道你砍的是谁嘛？', '你在干什么'],
                    female: ['何必呢？', '有私仇请在私下解决，别到这里来丢人现眼'],
                },
                'damage_heavy': { //受到一点以上伤害
                    male: ['大水冲了龙王庙', '自家人不认识自己人了'],
                    female: ['煮豆燃豆萁，豆在釜中泣', '本是同根生，相煎何太急'],
                },
                'loseHp': { //流失体力
                    male: ['……', '兄弟，你这样的人，让人很能正视啊'],
                    female: ['！', '怎么可以遮羊子'],
                },
                'loseHp_heavy': { //流失一点以上体力
                    male: ['你是旱魃吧，让人无雨的本事倒是不小', '这个要是真出了问题，你要后悔好几分钟'],
                    female: ['年轻人不要搞窝里斗', '攘外必先安内？'],
                },
                'draw': { //摸牌
                    male: ['和气生财', '合家欢乐'],
                    female: ['慕了', '希望'],
                },
                'draw_heavy': { //摸一张以上的牌
                    male: ['和气发大财，发%cnnum%贯钱的大财', '这样的关系，才能叫铁'],
                    female: ['%cnnum%张牌，希望我以后也有这种朋友，多金', '同舟共济，慢慢来，同仇敌忾'],
                },
                'die': { //去势
                    male: ['你小子搞什么飞机啊', '不会玩游戏就别玩，丢什么人，现什么世', '什么东西，以后吃饭坐小孩那桌'],
                    female: ['你不要乱搞啊，今天连跪了都', '你...杀错人啦，TA是队友！', '这下子好了，两败俱伤算不上，反倒是单方面元气大损'],
                },
            };
            //体力值变化
            lib.skill._zuanCHANGEHPsayskill = {
                trigger: {
                    global: ["recover", "damage", "loseHpEnd", "drawAfter", "dieAfter"],
                },
                filter: function(event, player) {
                    if (game.wanqingIsOpen) return false;
                    if (lib.config['extension_祖安设置_zuantype'].indexOf('new') == -1) return false;
                    if (!event.name) return false;
                    if (lib.config['extension_祖安设置_zuantype'] == 'new_chg') {
                        if (player == game.me) return false;
                        if (game.zuanSayCold.contains(player)) return false;
                    }
                    return parseFloat(lib.config['extension_祖安设置_ransay']) != '0';
                },
                forced: true,
                silent: true,
                priority: -5,
                content: function() {
                    'step 0';
                    //概率随机模块
                    if (Math.random() * 100 >= parseFloat(lib.config['extension_祖安设置_ransay']) * 0.5) {
                        if (event && event.finish) {
                            event.finish();
                        } else {
                            return;
                        }
                    }
                    'step 1';
                    //加载说话宝典
                    if (trigger.num) { //数值模块，可以通过event.cnnum引用相关的中文数值
                        event.cnnum = get.cnNumber(trigger.num);
                    } else {
                        event.cnnum = '〇';
                    }
                    //我 对别人
                    /*event.say_me_none=game.ZAhpSay_me_none;
		            //我 对别人
		            event.say_me_from=game.ZAhpSay_me_from;
		            //我 被人对
		            event.say_me_to=game.ZAhpSay_me_to;
		            //我 对自己
		            event.say_me_self=game.ZAhpSay_me_self;
		            //观众 两边都不帮
		            event.say_see_none=game.ZAhpSay_see_none;
		            //观众 只帮来源
		            event.say_see_from=game.ZAhpSay_see_from;
		            //观众 只帮目标
		            event.say_see_to=game.ZAhpSay_see_to;
		            //观众 两边都帮
		            event.say_see_self=game.ZAhpSay_see_self;*/
                    //判断来源和受体
                    event.from = trigger.source;
                    event.to = trigger.player;
                    if (get.translation(event.from) == '') event.from = 'none';
                    if (get.translation(event.to) == '') event.to = 'none';
                    event.typename = trigger.name;
                    if (trigger.num && trigger.num > 1) {
                        event.typename = event.typename + '_heavy';
                    }
                    'step 2';
                    //定位自己和类型
                    var fromto = [event.from, event.to];
                    if (fromto.contains(player)) {
                        //仅对于自己和对象
                        event.ide = 'me';
                        var tps = ['none', 'from', 'to', 'self'];
                        var num = 0;
                        if (player == event.from) num++;
                        if (player == event.to) num += 2;
                        event.tp = tps[num];
                    } else {
                        //优先发起者，再判断目标
                        event.ide = 'see';
                        var tps = ['none', 'from', 'to', 'self'];
                        var num = 0;
                        if (event.from != 'none' && get.attitude(player, event.from) > 0) num++;
                        if (event.to != 'none' && get.attitude(player, event.to) > 0) num += 2;
                        event.tp = tps[num];
                    }
                    'step 3';
                    //判断角色性别
                    if (player.hasSex('female')) {
                        if (player.hasSex('male')) {
                            event.sex = ['male', 'female'].randomGet();
                        } else {
                            event.sex = 'female';
                        }
                    } else {
                        event.sex = 'male';
                    }
                    'step 4';
                    //组装语言模块
                    event.said = game['ZAhpSay_' + event.ide + '_' + event.tp][event.typename][event.sex];
                    event.chat = event.said.randomGet().replace('%cnnum%', event.cnnum);
                    'step 5';
                    //最后一道关卡，加载失败就不说话了
                    'step 6';
                    if (lib.config['extension_祖安设置_zuantype'] == 'new_chg') {
                        var ransec = (2 + [0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 12, 13, 14, 15, 15, 15, 20, 40].randomGet()) * 1000 + [0, 0, 3, 5, 7].randomGet() * 100;
                        if (!game.zuanSayCold.contains(player)) game.zuanSayCold.push(player);
                        if (ransec > 0) setTimeout(function() {
                            if (game.zuanSayCold.contains(player)) game.zuanSayCold.remove(player);
                        },
                        ransec);
                        setTimeout(function() {
                            player.say(event.chat);
                        },
                        Math.ceil(Math.random() * 2000));
                    } else {
                        player.say(event.chat);
                    }
                },
            }
            //这段代码有BUG，别放出来
            /*lib.skill._zuansaidskill={
		        trigger:{
		            player:["recover","damage","useCardToPlayered"],
		            target:["useCardToTargeted"],
		        },
		        filter:function(event,player){
		            return true;
		        },
		        forced:true,
		        silent:true,
		        priority:-5,
		        content:function(){
		            'step 0';
		            //加载说话宝典
		            event.cardlist=['sha','shan'];
		            //我 没参与
		            event.say_me_none={
		                'recover':['我回复体力'],
		                'damage':['我受到伤害'],
		                'useCard':{
		                    'none':['啥咧'],
		                    'sha':['杀'],
		                    'shan':['闪'],
		                },
		            };
		            //我 对别人
		            event.say_me_from={
		                'recover':['我回复体力'],
		                'damage':['我受到伤害'],
		                'useCard':{
		                    'none':['啥咧'],
		                    'sha':['杀'],
		                    'shan':['闪'],
		                },
		            };
		            //我 被人对
		            event.say_me_to={
		                'recover':['我回复体力'],
		                'damage':['我受到伤害'],
		                'useCard':{
		                    'none':['啥咧'],
		                    'sha':['杀'],
		                    'shan':['闪'],
		                },
		            };
		            //我 对自己
		            event.say_me_self={
		                'recover':['我回复体力'],
		                'damage':['我受到伤害'],
		                'useCard':{
		                    'none':['啥咧'],
		                    'sha':['杀'],
		                    'shan':['闪'],
		                },
		            };
		            //观众 两边都不帮
		            event.say_see_none={
		                'recover':['怎么会是捏'],
		                'damage':['乌龙了'],
		                'useCard':{
		                    'none':['啥咧'],
		                    'sha':['杀'],
		                    'shan':['闪'],
		                },
		            };
		            //观众 只帮发起者
		            event.say_see_from={
		                'recover':['回复体力好'],
		                'damage':['心疼'],
		                'useCard':{
		                    'none':['啥咧'],
		                    'sha':['杀'],
		                    'shan':['闪'],
		                },
		            };
		            //观众 只帮目标
		            event.say_see_to={
		                'recover':['回复体力不好'],
		                'damage':['薄纱'],
		                'useCard':{
		                    'none':['啥咧'],
		                    'sha':['杀'],
		                    'shan':['闪'],
		                },
		            };
		            //观众 两边都帮
		            event.say_see_self={
		                'recover':['怎么会是捏'],
		                'damage':['乌龙了'],
		                'useCard':{
		                    'none':['啥咧'],
		                    'sha':['杀'],
		                    'shan':['闪'],
		                },
		            };
		            //判断来源和受体
		            event.fromto={
		                'recover':[trigger.source,trigger.player],
		                'damage':[trigger.source,trigger.player],
		                'useCard':[trigger.player,trigger.targets],
		                'useCardToPlayered':[trigger.player,trigger.target],
		                'useCardToTargeted':[trigger.player,trigger.target],
		            };
		            event.from=event.fromto[trigger.name][0];
		            event.to=event.fromto[trigger.name][1];
		            if(get.translation(event.from)=='') event.from='none';
		            if(event.from&&event.from.length>1) event.from='none';
		            if(get.translation(event.to)=='') event.to='none';
		            if(event.to&&event.to.length>1) event.to='none';
		            event.name=trigger.name;//-----------------问题出现在这里，动了event.name后就开始报错---//
		            if(trigger.name=='useCardToPlayered'||trigger.name=='useCardToTargeted') {
		                event.name='useCard';
		            }
		            'step 1';
		            //定位自己和类型
		            var fromto=[event.from,event.to];
		            if(fromto.contains(player)) {
		                //仅对于自己和对象
		                event.ide='me';
		                var tps=['none','from','to','self'];
		                var num=0;
		                if(player==event.from) num++;
		                if(player==event.to) num+=2;
		                event.tp=tps[num];
		            }else {
		                //优先发起者，再判断目标
		                event.ide='see';
		                var tps=['none','from','to','self'];
		                var num=0;
		                if(event.from!='none'&&get.attitude(player,event.from)>0) num++;
		                if(event.to!='none'&&get.attitude(player,event.to)>0) num+=2;
		                event.tp=tps[num];
		            }
		            //alert(event.name);
		            if(event.name!='useCard') event.goto(3);
		            'step 2';
		            //判断卡牌的名字
		            var card=trigger.card.name;
		            if(event.cardlist.contains(card)) {
		                event.cardname=trigger.card.name;
		            }else {
		                event.cardname='none';
		            }
		            'step 3';
		            //alert(trigger.name);
		            event.said=event['say_'+event.ide+'_'+event.tp][event.name];
		            if(event.name=='useCard') {
		                event.chat=event.said[event.cardname].randomGet();
		            }else {
		                event.chat=event.said.randomGet();
		            }
		            player.say(event.chat);
		        },
		    },*/
            // ---------------------------------------回血播报------------------------------------------//
            lib.skill._recoversay = {
                trigger: {
                    global: "recoverEnd",
                },
                filter: function(event, player) {
                    if (lib.config['extension_祖安设置_zuantype'] != 'old') return false;
                    return parseFloat(lib.config['extension_祖安设置_ransay']) != '0';
                },
                forced: true,
                silent: true,
                content: function() {
                    "step 0";
                    var say = 0;
                    if (get.attitude(player, trigger.player) > 0) {
                        if (trigger.player == player) {
                            if (trigger.player.hp <= 1 || trigger.num >= 2) {
                                if (lib.config['extension_祖安设置_girlspeak'] && player.sex == 'female') {
                                    var chat = ['好险吖O.O', '呼呼..还好T.T', 'TwT', '耶QvQ', '好耶~', '太棒啦！OvO'].randomGet()
                                } else {
                                    var chat = ['快哉！快哉！', '岂不美哉？', '赞啊~赞啊~', '先吃先吃！', '爽啊', '真香~唉', '好险...还好没死', '大难不死必有后福', '濒死挣扎一番！', '我还没那么容易死！', '不屈', '桃一下'].randomGet()
                                }
                                var say = 1;
                            } else {
                                if (lib.config['extension_祖安设置_girlspeak'] && player.sex == 'female') {
                                    var chat = ['棒棒哒~', '*v*回来啦', '开心~', 'OvO', '好耶', '嘿嘿^w^'].randomGet()
                                } else {
                                    var chat = ['干饭干饭~', '真香', '恢复一下元气。', '养精蓄锐', '舒服了！', '桃一下', '死不了~', '就这？', '九折？'].randomGet()
                                }
                                var say = 1;
                            }
                        } else {
                            if (trigger.player.hp <= 1 || trigger.num >= 2) {
                                if (lib.config['extension_祖安设置_girlspeak'] && player.sex == 'female') {
                                    var chat = ['哇@v@好厉害~', '耶~好棒好棒！', 'QuQ哈哈'].randomGet()
                                } else {
                                    var chat = ['八月正午的阳光都没你耀眼', '岂不美哉？', '这个彬彬就是逊啦~', '极限回血，强啊', '我们三个真是太强了', '我们队友是杀不死的哦！', 'Nice'].randomGet()
                                }
                                var say = 1;
                            } else {
                                if (lib.config['extension_祖安设置_girlspeak'] && player.sex == 'female') {
                                    var chat = ['欧耶~', '（^v^）', '0v0仙女表扬~', '了不起！', '哇~', 'wow'].randomGet()
                                } else {
                                    var chat = ['滴滴清纯的蒸馏水', '岂不美哉？', 'That’s good♂', '我们队友真强', '哈哈对面是不是输不起', '来来来，砍我们', '高，实在是高'].randomGet()
                                }
                                var say = 1;
                            }
                        }
                    } else if (trigger.player != player) {
                        if (trigger.player.hp <= 1 || trigger.num >= 2) {
                            if (lib.config['extension_祖安设置_girlspeak'] && player.sex == 'female') {
                                var chat = ['<_<这都可以..', '（V_V）可恶~', '哎...', '可惜啦。。', '#吐血#吐血'].randomGet()
                            } else {
                                var chat = ['这个彬彬真的太逊了！', '靠，狗货', '你给凉企氪金了？', '这老不死的。', '狗屎。。', '这。。'].randomGet()
                            }
                            var say = 1;
                        } else {
                            if (lib.config['extension_祖安设置_girlspeak'] && player.sex == 'female') {
                                var chat = ['>_>啊这..', '不好..~_~', '哎.', '可惜x_x', '#吐血'].randomGet()
                            } else {
                                var chat = ['我从未见过，有如此厚颜无耻之人！', '一只王八', '一只兲', '好烦，对面老是回血', '没事，很快把他们打到残血', '就不信你们还能再回？', '切！', '靠，有桃'].randomGet()
                            }
                            var say = 1;
                        }
                    }
                    if (Math.random() * 100 > parseFloat(lib.config['extension_祖安设置_ransay'])) var say = 0;
                    if (say == 1) {
                        player.say(chat);
                    }
                },
            }
            // ---------------------------------------受伤播报------------------------------------------//   
            lib.skill._damagesay = {
                trigger: {
                    global: ["damageEnd", "loseHpEnd"],
                },
                filter: function(event, player) {
                    if (lib.config['extension_祖安设置_zuantype'] != 'old') return false;
                    return parseFloat(lib.config['extension_祖安设置_ransay']) != '0';
                },
                forced: true,
                silent: true,
                content: function() {
                    "step 0";
                    var say = 0;
                    if (get.attitude(player, trigger.player) > 0) {
                        if (trigger.player == player) {
                            if (trigger.player.hp <= 1 || trigger.num >= 2) {
                                if (lib.config['extension_祖安设置_girlspeak'] && player.sex == 'female') {
                                    var chat = ['呜呜..快死了', 'QAQ疼疼', 'TwT哭哭', '放过我叭...', '哭哭~不行了', '(;w;)哇~'].randomGet()
                                } else {
                                    var chat = ['阿伟，我面包还你', '阿伟，阿伟，你干嘛！', '杰哥~不要啦~', '饼将军救我...', '54320', '痛啊', '我一定会回来的！！！', '我还能挺一会。。', '快死啦~快死啦~', '好痛'].randomGet()
                                }
                                var say = 1;
                            } else {
                                if (lib.config['extension_祖安设置_girlspeak'] && player.sex == 'female') {
                                    var chat = ['>_<讨厌..', '疼疼', '55555', '讨厌你..', '#生气', '不要不要', 'T_T', 'TwT', '不喜欢你O_O', '可怕~'].randomGet()
                                } else {
                                    var chat = ['你只王八', '你只兲', '小几把还挺会玩', '来来来，继续？', '我血厚着呢。', '继续砍我！来！！', '哎哟，不错哟', '这点伤痛算得了什么~', 'Tnnd，跟我玩音的是吧！', '焯！'].randomGet()
                                }
                                var say = 1;
                            }
                        } else {
                            if (trigger.player.hp <= 1 || trigger.num >= 2) {
                                if (lib.config['extension_祖安设置_girlspeak'] && player.sex == 'female') {
                                    var chat = ['>_<..心疼', '555...别死啊TwT', '好可怕啊XwX', '不要啊TwT', '放过TA可以嘛QwQ', '别打TA呀QwQ', '可怜~~~'].randomGet()
                                } else {
                                    var chat = ['吔屎啦，梁非凡~', '年轻人不要太气盛！', '是个狼灭', '是个狼人', '噢...心疼', '坚持住啊~~~', '挺住！！', '对面过分了！', '药丸药丸', '狗屎', '顶得住吗？'].randomGet()
                                }
                                var say = 1;
                            } else {
                                if (lib.config['extension_祖安设置_girlspeak'] && player.sex == 'female') {
                                    var chat = ['>_<心疼', '疼不疼~QwQ', '不要！O_O', '不~X^X', '不要这样~', '别打TA呀。。'].randomGet()
                                } else {
                                    var chat = ['吔屎啦，梁非凡~', '年轻人不要太气盛！', '你是来找茬是吧', 'What’s up', 'wtf', '我会替TA报仇的！', '难过QAQ', '我有桃放心', '您妈买菜必涨价。', '小心被集火哦', '不哭不哭'].randomGet()
                                }
                                var say = 1;
                            }
                        }
                    } else if (trigger.player != player) {
                        if (trigger.player.hp <= 1 || trigger.num >= 2) {
                            if (lib.config['extension_祖安设置_girlspeak'] && player.sex == 'female') {
                                var chat = ['>_<哇，不忍心看下去耶', '好棒好棒', '好暴力吖QvQ', '太残忍啦~QvQ', 'O_O这么厉害'].randomGet()
                            } else {
                                var chat = ['不气盛叫年轻人吗？', '我的很大♂，你忍一下~', '华强，爱华强！', '另外你说的，这瓜要是生的你自己吞进去啊', '你瓜没拿', '吸铁石', '杀爆TA！', '谁来补最后一刀？', '加油，我们能赢', '对面的你们药丸', '搞TA！', '高，实在是高！', '快死了快死了！爽', '直接来..吧！'].randomGet()
                            }
                            var say = 1;
                        } else {
                            if (lib.config['extension_祖安设置_girlspeak'] && player.sex == 'female') {
                                var chat = ['对面疼不疼？>v<', '好耶好耶', 'QvQ', '耶QvQ', '欺负TA欺负TA~'].randomGet()
                            } else {
                                var chat = ['年轻人不要太年轻！', '不气盛叫年轻人吗', '我的很大♂，你忍一下~', '另外你说的，这瓜要是生的你自己吞进去啊', '吸铁石', '大快人心！', '砍TA', '干得漂亮', '可以可以', '继续继续', '痛快！'].randomGet()
                            }
                            var say = 1;
                        }
                    }
                    if (Math.random() * 100 > parseFloat(lib.config['extension_祖安设置_ransay'])) var say = 0;
                    if (say == 1) {    player.say(chat);
                    }
                },
            }
            // ---------------------------------------全场死亡播报------------------------------------------//   
            lib.skill._diesay = {
                trigger: {
                    global: "die",
                },
                silent: true,
                silent: true,
                frequent: true,
                filter: function(event) {
                    if (lib.config['extension_祖安设置_zuantype'] != 'old') return false;
                    return parseFloat(lib.config['extension_祖安设置_ransay']) != '0';
                },
                content: function() {
                    if (get.attitude(player, trigger.player) > 0) {
                        if (lib.config['extension_祖安设置_girlspeak'] && player.sex == 'female') {
                            var chat = ['呜呜呜呜呜TTwTT', '别走啊...XwX', '我的队友。。。V^V', '桑心透了Q_Q', '#擦眼泪', '#哭#哭#哭', '怎么可以这样？！Q^Q'].randomGet()
                        } else {
                            var chat = ['是不是说，没有做完的梦最痛~', '在一起叫梦，分开了叫痛', '就算这次做错也只是怕错过', '如果早知道，我就不会去他那里了..', '都是你害的啦~', '死了啦，拜托~', '外卖杀人啊', '杀人啦~杀人啦~', '章鱼哥~章鱼哥~', '萨日朗！萨日朗！！', '其实我是怕你吃太多桃噎着。', '小几把还挺会玩。', '玩游戏之前能不能带点脑子', '彻底玩蛋了...', '怎么没有投翔按钮？', '完蛋。。。', '下局再来', '十八年后。。。又是一条好汉', '你却让我输得，这么彻底~', '我好不容易心动一次', '不要停下来啊啊啊啊'].randomGet()
                        }
                        var say = 1;
                    } else {
                        if (lib.config['extension_祖安设置_girlspeak'] && player.sex == 'female') {
                            var chat = ['对面好可怜QvQ', '献上花环QvQ', '我会缅怀您的！嘻嘻', '再见啦~#告别', '安息叭。。', '哎呀QvQ一不小心就886'].randomGet()
                        } else {
                            var chat = ['小盆友你是否有很多问号？', '分开了叫痛~', '我晒干了沉默~', '这个彬彬就是逊啦', '这个彬彬真的太逊了~', '我只希望你能够好好用功读书', '来来来，继续口嗨啊？！#阴险', '我们的游戏正在蒸蒸日上哦~#微笑', '对面投翔吧！！！', '对面没了，我们快赢了', '对面好菜鸡啊，快输了吧？！', '菜，哈哈哈哈', 'TA是谁啊？', '让TA自己说去', '我滴任务...完成辣！', '我的任务..完成啦！', '啊哈哈哈哈！'].randomGet()
                        }
                        var say = 1;
                    }
                    if (Math.random() * 100 > parseFloat(lib.config['extension_祖安设置_ransay'])) var say = 0;
                    if (say == 1) {
                        player.say(chat);
                    }
                },
            }
            // ---------------------------------------全场被指定播报------------------------------------------//   
            lib.skill._tosay = {
                trigger: {
                    global: "useCardToPlayered",
                },
                silent: true,
                silent: true,
                frequent: true,
                filter: function(event) {
                    if (lib.config['extension_祖安设置_zuantype'] != 'old') return false;
                    return parseFloat(lib.config['extension_祖安设置_ransay']) != '0';
                },
                content: function() {
                    var say = 0;
                    if (lib.config['extension_祖安设置_girlspeak'] && player.sex == 'female') {

                        if (trigger.target == player) {
                            if (get.attitude(player, trigger.player) > 0) {
                                if (get.name(trigger.card) == 'wu') {
                                    var chat = ['无'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'sha') {
                                    var chat = ['别打我~是朋友呀QAQ', '不不不，不是我~QwQ', '天哪！我是你的队友~OoO', '为什么要这么做吖？'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'guohe') {
                                    var chat = ['没搞懂耶~', '你想干什么Q_Q', '不要啦QvQ', '再见啦我的牌@v@'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'shunshou') {
                                    var chat = ['没搞懂耶~', '你想干什么Q_Q', '不要啦QvQ', '你想要就给你好啦~@A@'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'juedou') {
                                    var chat = ['没搞懂耶~', '你想干什么Q_Q', '不要啦QvQ', '对我温和点呀', '轻点，疼>w<'].randomGet();
                                    var say = 1;
                                }
                            } else {
                                if (get.name(trigger.card) == 'sha') {
                                    var chat = ['哼U_U，你过分', 'U^U欺负弱小', '别打头555Q^Q', '讨厌你~', '不想理你了~Q^Q', '我有闪的~O^O', '我不怕你！Q^Q', '哼！V_V'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'guohe') {
                                    var chat = ['不要拆我QaQ', '你想干嘛QwQ', '你好过分！X^X', '讨厌你U^U'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'shunshou') {
                                    var chat = ['不要顺我QaQ', '你想干嘛QwQ', '你好过分！X^X', '讨厌你U^U', '给你就是了，哼U^U'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'juedou') {
                                    var chat = ['你不让着女生嘛Q。Q', '你欺负弱小！0^0', '欺负女生。。呜呜', '讨厌死你了'].randomGet();
                                    var say = 1;
                                }
                            }
                        } else {
                            if (get.attitude(player, trigger.player) > 0) {
                                if (get.name(trigger.card) == 'sha') {
                                    var chat = ['你别欺负TA！#生气', '#生气#生气', '过分U^U', '哼。。。', '不高兴。。U_U', '你觉得这样好嘛U_U'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'guohe') {
                                    var chat = ['过分~O_o', '不要拆我队友555', '不要~', '哇，过分耶~O_o', 'O^o', '不开森。。'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'shunshou') {
                                    var chat = ['过分~O_o', '不要偷我队友555', '不要~', '哇，过分耶~O_o', 'O^o', '不开森。。'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'juedou') {
                                    var chat = ['队友加油！O^o打死TA！', '队友加油！O^o', '你打不过我队友哒Q^Q'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'huogong') {
                                    var chat = ['不要玩火>w<', '消防蜀黍快来！！！', '不要中吖不要中吖'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'jiedao') {
                                    var chat = ['Owo', 'X_x'].randomGet();
                                    var say = 1;
                                }
                            } else {
                                if (get.name(trigger.card) == 'sha') {
                                    var chat = ['哇^_^', '打TA打TA！^_^', '队友加油！QvQ', '我队友最腻害了！#Happy'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'guohe') {
                                    var chat = ['哦耶', '对面要没牌了耶~QvQ', '嘿嘿，好爽^A^'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'shunshou') {
                                    var chat = ['哦耶', '对面要没牌了耶~QvQ', '嘿嘿，好爽^A^'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'juedou') {
                                    var chat = ['哇^_^', '打TA打TA！^_^', '队友加油！QvQ', '我队友最腻害了！#Happy', 'QvQ吃瓜ing'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'huogong') {
                                    var chat = ['烧烧烧~', '哇GvG', '烫死TA！...#偷笑#偷笑'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'jiedao') {
                                    var chat = ['没收TA的武器！Q.Q', '拿走拿走！^v^', '缴枪不杀！^v^'].randomGet();
                                    var say = 1;
                                }
                            }
                        }

                    } else {
                        if (trigger.target == player) {
                            if (get.attitude(player, trigger.player) > 0) {
                                if (get.name(trigger.card) == 'wu') {
                                    var chat = ['无'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'sha') {
                                    var chat = ['吔屎啦你~', '我面包还你~', '阿伟，你干嘛？', '干嘛~呃哼哼~', '你还真杀我？！', '小几把还挺会玩。', '昏君啊~', '你搞错人啦', '会不会玩...', '屑司令..你不会相信王大队长..胡说八道吧？', '王大队张..你又要陷害我是吧？', '谁又要陷害我~？'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'guohe') {
                                    var chat = ['随便拿~随便拿', '来来来，这些都可以拿', '呃，这...', '你想干嘛？', '反正我也不要了...'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'shunshou') {
                                    var chat = ['随便拿~随便拿', '来来来，这些都可以拿', '呃，这...', '你想干嘛？', '拿走拿走别客气~', '零元购'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'juedou') {
                                    var chat = ['我面包还你~', '阿伟，你干嘛？', '干嘛~呃哼哼~', '同学之间就不要打架斗殴了吧？', '咱们来摔♂跤吧', '你决斗我干嘛', '你搞错人了。。', '屑司令..你不会相信王大队长..胡说八道吧？', '王大队张..你又要陷害我是吧？', '谁又要陷害我~？'].randomGet();
                                    var say = 1;
                                }
                            } else {
                                if (get.name(trigger.card) == 'sha') {
                                    var chat = ['诸葛村夫，你敢！', '我赌你断杀。', '我会复仇的！', '杀我对你有什么好处', '来来来，继续？', '你当我没闪？', '怕你？', '九折？'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'guohe') {
                                    var chat = ['辽宁拆迁队长？', '过分了啊', '你好贱', '反正我也不需要~'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'shunshou') {
                                    var chat = ['辽宁拆迁队长？', '过分了啊', '你好贱', '反正我也不需要~', '零元购是吧？'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'juedou') {
                                    var chat = ['来我房里，有好康的', '身材不错哦~蛮结实的啊', 'Solo就Solo', '我手牌有杀我怕你？', '来！你别怂！', '怕你不成？'].randomGet();
                                    var say = 1;
                                }
                            }
                        } else {
                            if (get.attitude(player, trigger.player) > 0) {
                                if (get.name(trigger.card) == 'sha') {
                                    var chat = ['你个禽兽你住手！', '有什么事冲我来！', '敢弄我队友？你完蛋了', '不，别。', '过分', 'Oh~No~'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'guohe') {
                                    var chat = ['你这算什么好汉？', '直接杀啊，拆啥', '很烦这张牌诶。', '过河拆桥？追！', '希望拆不到好牌', '你能拆啥。。'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'shunshou') {
                                    var chat = ['你这算什么好汉？', '直接杀啊，偷牌干什么啥', '很烦这张牌诶。', '给你毒你要不要', '白嫖党滚粗。', '赌你摸到一张毒'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'juedou') {
                                    var chat = ['你打不过我队友的', '就你这实力还想Solo？', '看我队友反杀你'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'huogong') {
                                    var chat = ['小心东风不与周郎便哦！', '等着玩火烧身吧', '放弃吧，你没有这张花色的'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'jiedao') {
                                    var chat = ['祖传屠龙宝刀要被借走了..', '兄弟，刀呢'].randomGet();
                                    var say = 1;
                                }
                            } else {
                                if (get.name(trigger.card) == 'sha') {
                                    var chat = ['做得好', '待会一人给TA一刀', '请继续', '淦就完事了'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'guohe') {
                                    var chat = ['哟呵，好爽', '对面要没牌了哦~', '人不贱则不立'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'shunshou') {
                                    var chat = ['呵呵，好爽', '对面被摸空了哈哈哈', '人不贱则不立'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'juedou') {
                                    var chat = ['吃瓜ing', '来看掐架了', '现场武术指导，我方必胜', '我们手牌多，不怕'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'huogong') {
                                    var chat = ['烧死TA！', '借你东风。', '对面怕火'].randomGet();
                                    var say = 1;
                                }
                                if (get.name(trigger.card) == 'jiedao') {
                                    var chat = ['刀TA', '干得漂亮', '你刀没了！'].randomGet();
                                    var say = 1;
                                }
                            }
                        }

                    }

                    if (Math.random() * 100 > parseFloat(lib.config['extension_祖安设置_ransay'])) var say = 0;
                    if (say == 1) {
                        player.say(chat);
                    }
                },
            }
            // ---------------------------------------全场用卡播报------------------------------------------//   
            lib.skill._fromsay = {
                trigger: {
                    global: "useCard",
                },
                silent: true,
                frequent: true,
                filter: function(event, player) {
                    if (lib.config['extension_祖安设置_zuantype'] != 'old') return false;
                    return parseFloat(lib.config['extension_祖安设置_ransay']) != '0' && event.player != player;
                },
                content: function() {
                    var say = 0;
                    if (lib.config['extension_祖安设置_girlspeak'] && player.sex == 'female') {
                        if (get.attitude(player, trigger.player) > 0) {
                            if (get.name(trigger.card) == 'tao') {
                                var chat = ['桃子桃子QvQ', '我也想吃桃子~~~', '可可爱爱的桃子诶~', '耶QvQ', '^v^好吃嘛？'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'jiu') {
                                var chat = ['我想要香槟O.o', '干杯嘛？', '我也醉啦~~'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'wuxie') {
                                var chat = ['仙女无懈！0.0', '我拒绝X.X', '这就对了嘛~~'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'taoyuan') {
                                var chat = ['蟹蟹', '开心（QvQ）', '开开心心', '开森~~'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'wugu') {
                                var chat = ['蟹蟹', '开心（QvQ）', '开开心心', '开森~~'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'nanman') {
                                var chat = ['能打到我嘛？Q,Q', '我没杀耶..Q,Q', '我有杀哦@v@', '我...！！！'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'wanjian') {
                                var chat = ['能打到我嘛？Q,Q', '我没闪耶..Q,Q', '我有闪哦@v@', '我...！！！'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'wuzhong') {
                                var chat = ['哦耶！', '好耶！', '摸摸~'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'tiesuo') {
                                var chat = ['连起来~', '绑住绑住~'].randomGet();
                                var say = 1;
                            }
                            if (get.subtype(trigger.card) == 'equip1') {
                                var chat = ['$v$有武器辣~', '欧耶，是武器！', '打打打~'].randomGet();
                                var say = 1;
                            }
                            if (get.subtype(trigger.card) == 'equip2') {
                                var chat = ['是盾牌嘛？', '是护盾耶！', '哇哦~QvQ'].randomGet();
                                var say = 1;
                            }
                            if (get.subtype(trigger.card) == 'equip4') {
                                var chat = ['哦，这是马O.o', '是马耶~o.O', '有马啦，杀杀杀~Q.Q'].randomGet();
                                var say = 1;
                            }
                            if (get.subtype(trigger.card) == 'equip3') {
                                var chat = ['哦，这是马O.o', '是马耶~o.O', '有马啦，杀杀杀~Q.Q'].randomGet();
                                var say = 1;
                            }
                        } else {
                            if (get.name(trigger.card) == 'tao') {
                                var chat = ['哇，是桃U_U', '又是桃耶。。讨厌', '为什么我没有。。Q^Q'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'jiu') {
                                var chat = ['TA醉了TA醉了>_<', '阔怕。。', '不准喝酒！>^<'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'wuxie') {
                                var chat = ['不要无懈吖！', '为什么拒绝？·.·', '哼'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'taoyuan') {
                                var chat = ['白嫖快乐！！>v<', '欧耶', '回血回血~'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'wugu') {
                                var chat = ['白嫖快乐！！>v<', '欧耶', '白嫖~白嫖~'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'nanman') {
                                var chat = ['别别别', '我的上帝呀TwT', '我怕怕QwQ', '不要酱紫啦~'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'wanjian') {
                                var chat = ['别别别', '我的上帝呀TwT', '我怕怕QwQ', '不要酱紫啦~'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'wuzhong') {
                                var chat = ['对面手气太好了。。QwQ', '好多无中生有啊www', '对面好多牌牌'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'tiesuo') {
                                var chat = ['不要连我~', '不不不T_T'].randomGet();
                                var say = 1;
                            }
                            if (get.subtype(trigger.card) == 'equip1') {
                                var chat = ['U_U欧，又是武器~', '快跑，TA有武器！', 'Oh不Q^Q'].randomGet();
                                var say = 1;
                            }
                            if (get.subtype(trigger.card) == 'equip2') {
                                var chat = ['不要这个盾牌~', '穿好多衣服T^T', 'x^X呃。。'].randomGet();
                                var say = 1;
                            }
                            if (get.subtype(trigger.card) == 'equip4') {
                                var chat = ['对面好多马呀', '我不喜欢这些马马了。。', '小马要跑不动啦！！！UwU'].randomGet();
                                var say = 1;
                            }
                            if (get.subtype(trigger.card) == 'equip3') {
                                var chat = ['对面好多马呀', '我不喜欢这些马马了。。', '小马要跑不动啦！！！UwU'].randomGet();
                                var say = 1;
                            }
                        }

                    } else {

                        if (get.attitude(player, trigger.player) > 0) {
                            if (get.name(trigger.card) == 'tao') {
                                var chat = ['辛得诸君出手相救！', '最爱吃桃子', 'Nice!', '桃子，桃子！', '舒服了！', '这鸡汤..十分滴珍贵', '行..我喝..喝！', '啧啧..这喝汤..多是一件美事啊', '不咸不淡，味道真是好极了！', '三点几啦，饮茶先啦！'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'jiu') {
                                var chat = ['哈哈你们完了', '斗酒十千！', '喝车不开酒', '酒逢知己千杯少！'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'wuxie') {
                                var chat = ['无懈！', '你休想！', '不，你不想', '你想都别想', '这就对了'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'taoyuan') {
                                var chat = ['谢谢老板！', '多多益善', '蟠桃会赴会了~'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'wugu') {
                                var chat = ['谢谢老板！', '多多益善！', '我拿走了', '谢谢兄弟，滑稽', '喝碗鸡汤算得了什么呀'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'nanman') {
                                var chat = ['别误伤队友了哦。', '男人♂入侵', '我没杀..', '我有杀哦', '我也...'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'wanjian') {
                                var chat = ['别误伤队友了哦。', '别乱放箭啊', '我有闪', '我没...', '我没闪', '我也...'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'wuzhong') {
                                var chat = ['你好，我是你的朋友。', '哟吼', '摸摸摸', '多好啊'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'tiesuo') {
                                var chat = ['连TA', '捆绑play', '绑住TA！'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'zhuge') {
                                var chat = ['扫六合席卷八荒说的难道就是宁？', '杀遍全场了', '哈哈，AK出来了'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'guding') {
                                var chat = ['就问你怕不怕？', '捅对面菊花~', '对面，保护好你们的菊花'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'tengjia') {
                                var chat = ['小心点，别沾上火', '还行'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'bagua') {
                                var chat = ['这是进口的八卦阵！', '刚去学了太极？'].randomGet();
                                var say = 1;
                            }
                            if (get.subtype(trigger.card) == 'equip4') {
                                var chat = ['Nice，是减一马', '哈哈哈，又是马', '有马啦，杀杀杀！'].randomGet();
                                var say = 1;
                            }
                            if (get.subtype(trigger.card) == 'equip3') {
                                var chat = ['Good，是加一马', '哈哈哈，又是马', '你砍不到我队友啦~'].randomGet();
                                var say = 1;
                            }
                        } else {
                            if (get.name(trigger.card) == 'tao') {
                                var chat = ['哟，居然有桃', '我猴子偷桃~', '哎哟'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'jiu') {
                                var chat = ['啊，别', '我好害怕', '还怕', '酒驾拘捕', '别动♂蕉警来查酒驾了'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'wuxie') {
                                var chat = ['无懈？', '不，你不想！', '哎哟，有脾气了'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'taoyuan') {
                                var chat = ['白嫖快乐！！', 'YE', '拿走了不谢'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'wugu') {
                                var chat = ['白嫖快乐！！', '白嫖党的胜利', '鸡汤来咯！', '你要是不喝...说明你真下毒了'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'nanman') {
                                var chat = ['我吐了', '好恶心', '爷好怕~', '我有杀', '不怕'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'wanjian') {
                                var chat = ['你是大嘴附体？！', '爷好怕', '我有闪呵呵', '没用的', '我有闪'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'wuzhong') {
                                var chat = ['狗托？', '我玩十年了不比你强？', '祝你摸到一手烂牌'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'tiesuo') {
                                var chat = ['别连我~', '你好邪恶', '切，难道你有火攻吗'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'zhuge') {
                                var chat = ['糟了AK出现了！', '闪不太够啊', '赶紧拆掉TA'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'guding') {
                                var chat = ['是大名鼎鼎的菊花刀', '哈哈，我有牌不怕'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'tengjia') {
                                var chat = ['穿寿衣是想来送人头？', '疼甲你也穿呵呵', '我有火攻哦'].randomGet();
                                var say = 1;
                            }
                            if (get.name(trigger.card) == 'bagua') {
                                var chat = ['国产八卦阵来了。', '劣质的没用', '赶紧拆掉'].randomGet();
                                var say = 1;
                            }
                            if (get.subtype(trigger.card) == 'equip4') {
                                var chat = ['好烦，又是减一马', '这马怎么这么多', '猎马弓在哪里？'].randomGet();
                                var say = 1;
                            }
                            if (get.subtype(trigger.card) == 'equip3') {
                                var chat = ['好烦，又是加一马', '这马怎么这么多', '猎马弓在哪里？'].randomGet();
                                var say = 1;
                            }
                        }

                    }
                    if (Math.random() * 100 > parseFloat(lib.config['extension_祖安设置_ransay'])) var say = 0;
                    if (say == 1) {
                        player.say(chat);
                    }
                },
            }
            lib.skill._selfsay = {
                trigger: {
                    player: "useCard",
                },
                silent: true,
                forced: true,
                filter: function(event) {
                    if (lib.config['extension_祖安设置_zuantype'] != 'old') return false;
                    return parseFloat(lib.config['extension_祖安设置_ransay']) != '0';
                },
                content: function() {
                    var say = 0;
                    if (lib.config['extension_祖安设置_girlspeak'] && player.sex == 'female') {
                        if (get.name(trigger.card) == 'sha') {
                            var chat = ['@v@杀一下~', '打你一下~', '小拳拳捶你胸~U^U', '打屎你！Q^Q', '讨厌你讨厌你', '捶你锤你', 'Q^Q沙屎你个臭撒币~'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'shan') {
                            var chat = ['跑跑', '闪闪~', '躲躲~', '886QvQ', '打不到我噢#高兴', '哦耶', '@v@闪一下~'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'juedou') {
                            var chat = ['@v@打一下~', '打你打你', '捶你胸~O^U', '打屎你！Q^Q', '讨厌你讨厌你', '捶你锤你', 'Q^Q打屎你个臭撒币~'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'guohe') {
                            var chat = ['拆啦拆啦', '别怪我QvQ', '你不需要叭？', '再见啦牌牌~', '牌牌不喜欢你'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'wuxie') {
                            var chat = ['无懈一下下@v@', '不要拒绝我嘛#卖萌', '不许你这样子做~', '不行不行！', '不可以酱紫~'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'nanman') {
                            var chat = ['入侵啦', '南蛮入侵~QoQ', '好恐怖耶@v@', 'QvQ打屎你们HAHAHA'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'wanjian') {
                            var chat = ['放箭啦', '万箭齐发~QoQ', '好恐怖耶@v@', 'QvQ打屎你们HAHAHA'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'tao') {
                            var chat = ['吃桃桃~$v$', '好吃好吃$v$', '好幸福~', '好香吖', 'emmmmm好柒！'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'jiedao') {
                            var chat = ['借一下好嘛QwQ', '可以给我嘛QwQ？', '不要拿着它嘛~'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'shunshou') {
                            var chat = ['我拿走啦~', '别怪我QvQ', '你不需要叭？', '再见啦牌牌~', '牌牌不喜欢你'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'taoyuan') {
                            var chat = ['大家都来吃桃子叭~QwQ', '大家一起吖QaQ', '一起Happy嘛？$v$'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'wugu') {
                            var chat = ['大家都来拿牌叭~QwQ', '大家一起吖QaQ', '一起Happy嘛？$v$'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'wuzhong') {
                            var chat = ['拿两张牌！$v$', '无中生友？朋友在哪里？@v@', '摸摸摸！$v$', '我听说...'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'jiu') {
                            var chat = ['稍微喝一下没问题叭？', '就一口，就一口@v@', '啊~醉了。。。', '这是香槟！@v@', '好喝>v<'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'huogong') {
                            var chat = ['烧你！！V-V', '火焰攻击~', '烧屎你~OvO'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'tiesuo') {
                            var chat = ['连起来叭', '连一下下哈~'].randomGet();
                            var say = 1;
                        }
                        if (get.subtype(trigger.card) == 'equip1') {
                            var chat = ['$v$我有武器辣！', '欧耶，是武器耶！$v$', '我喜欢这个$v$'].randomGet();
                            var say = 1;
                        }
                        if (get.subtype(trigger.card) == 'equip2') {
                            var chat = ['换个衣服··^v^··', '穿个衣服先哈·。·', '别偷看我换衣服噢~'].randomGet();
                            var say = 1;
                        }
                        if (get.subtype(trigger.card) == 'equip4') {
                            var chat = ['哦，是小马$.$', '小马耶~$v$', '小马小马~'].randomGet();
                            var say = 1;
                        }
                        if (get.subtype(trigger.card) == 'equip3') {
                            var chat = ['哦，是小马$.$', '小马耶~$v$', '小马小马~'].randomGet();
                            var say = 1;
                        }

                    } else {

                        if (get.name(trigger.card) == 'sha') {
                            var chat = ['吔屎啦你~', '我TM劈你', '跟我刘华强拼你有这个实力吗？', '哥们你这瓜保熟吗', '杀一下~', '杀！！！', '看我的厉害！', '砍我杀穿你', '不杀你几刀你也不知道爷的厉害', '鲨！', '沙屎你个臭撒币~', 'Tnnd，为什么不喝！', '不喝..不喝我就炸死你！', '都怕死是吧？', '都bei想活着！'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'shan') {
                            var chat = ['你TM劈我瓜是吧？', '好我再给你一次机会', '给你机会你不中用啊~', '你TM劈我', '你瓜没拿', '你是故意找茬是吧？', '我闪！', '我躲~', '杀不到~', '累吖累吖', '嘿嘿', '砍不到我~砍不到我~', '我有闪哦', '大伙都不敢吃..说是有人在鸡汤里下了毒', '我..我不打扰，我走了啊~', '嘿咻咻'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'juedou') {
                            var chat = ['诸葛亮下来战书', '我TM跟你拼了', '还能教你，登dua郎哦~', '挑一个', '来我房里，有好康的', '身材不错哦~蛮结实的啊', '来啊，Solo啊', '敢不敢来Solo？', '一挑一！', '咱们来♂摔跤', '单挑，敢不敢？', '来，搞一下♂（坏笑）'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'guohe') {
                            var chat = ['杰哥，这些都可以拿嘛', '拆你的牌！！！', '你别想要', '看你也不需要', '这牌对你没用', '拆了拆了！'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'wuxie') {
                            var chat = ['吸铁石。', '秀发，无屑可击~', '哈哈，你休想！！', '你甚至想都别想', '无shit可击~', '无泄可击！'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'nanman') {
                            var chat = ['欢迎你们来我家玩', '我家的房子还蛮大♂的', '男人♂入侵！！！', '冲冲冲！', '杀——', '直接来...吧！', 'Tnnd，为什么不喝！', '不喝..不喝我就炸死你们！', '都怕死是吧？', '都bei想活着！'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'wanjian') {
                            var chat = ['欢迎你们来我家玩', '我家的房子还蛮大♂的', '全都去死HAHAHA', '大嘴附体！', '放箭！放箭！！', '看我乱杀！', '直接来...吧！', 'Tnnd，为什么不喝！', '不喝..不喝我就炸死你们！', '都怕死是吧？', '都bei想活着！'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'tao') {
                            var chat = ['香香的烤面筋，可带劲啦', '吃颗桃子', '好吃', '香♂', '嗯，真香', '我在想Peach..', '这鸡汤..十分滴珍贵', '行..我喝..喝！', '啧啧..这喝汤..多是一件美事啊', '不咸不淡，味道真是好极了！'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'jiedao') {
                            var chat = ['借下你的杀猪刀。', '你不是很能刀么？', '可惜下一秒就是我的了'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'shunshou') {
                            var chat = ['杰哥，这些都可以拿嘛', '拿来！', '取你牌来！', '取你的牌！', '呵呵，我拿走了', '可惜下一秒就是我的了'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'taoyuan') {
                            var chat = ['来干饭，来干饭', '来来来，这些都可以拿~', '大家都来吃桃子叭~', '来来大家一起', '一人一口酥'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'wugu') {
                            var chat = ['来来来，这些都可以拿~', '别多拿，别少拿', '发牌了发牌了！', '来来，人人都有', '多少张呢？数一下', '开仓济贫！', '喝碗鸡汤算得了什么呀'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'wuzhong') {
                            var chat = ['无中生友。', '你强个jb。', '摸两个朋友', '摸摸摸！', '我有两个朋友？'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'jiu') {
                            var chat = ['杰哥，酒~', '酒肉穿肠过，佛祖心中留！', '酒过愁肠，化作相思泪', '温酒斩华雄', '煮酒论英雄', '举杯消愁', '对酒当歌，人生几何！', '纯度挺高的', '下次换香槟？', '好喝'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'huogong') {
                            var chat = ['烈火焚天！', '焚城！', '烧你丫的', '让我火上浇油！', '烧死你'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'tiesuo') {
                            var chat = ['就差一把火了！', '把你变成连体婴儿', '要死你们也一起死啊对吧'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'zhuge') {
                            var chat = ['看我杀遍全场！', '看我乱杀！', '杀杀杀', '冲冲冲'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'guding') {
                            var chat = ['菊花残，满地伤...', '小心菊花不保'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'tengjia') {
                            var chat = ['球球您们来烧我~', '其实一点也不疼', '疼甲！', '有火杀嘛', '放箭放箭！南蛮也OK啦~'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'bagua') {
                            var chat = ['杀我！！！', '刚学了太极', '牌堆顶都是红色的哦', '有点八卦', '奇门八甲'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'qilin') {
                            var chat = ['没想到还有这种要求！滑稽', '你的马没了', '你马没了（真的是那个马别误会）', '猎马弓~'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'cixiong') {
                            var chat = ['男女剑！', '人妖剑~', '我来搞一下男女关系'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'fangtian') {
                            var chat = ['以一挑三！！！', '杀！！！', '武神之戟', '奉先附体！'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'guanshi') {
                            var chat = ['强杀斧', '命中！'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'qinggang') {
                            var chat = ['破甲剑到手', '玄德助我！', '你的防具没用了！'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'zhangba') {
                            var chat = ['刷牌机器', '翼德！！！'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'renwang') {
                            var chat = ['获得技能 毅重', '黑杀砍我！', '仁王，人中之王'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'zhuque') {
                            var chat = ['藤甲，哪里有藤甲？', '烧烧烧！', '诸葛村夫，你敢？！'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'baiyin') {
                            var chat = ['拆了拆了', '求酒杀~~', '拿走我的。'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'muniu') {
                            var chat = ['什么木流牛马？', '屯牌了兄弟们', '木流牛马，哈哈哈'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'du') {
                            var chat = ['毒死我蒜了。。', '我疯了', '自杀自杀'].randomGet();
                            var say = 1;
                        }
                        if (get.name(trigger.card) == 'jinchan') {
                            var chat = ['拜拜', '溜溜溜', '三十六计，走为上计'].randomGet();
                            var say = 1;
                        }
                        if (get.subtype(trigger.card) == 'equip4') {
                            var chat = ['减一马！', '手够长啦', '顺手牵羊我来啦~', '距离够了！', '攻击马。', '进攻马！'].randomGet();
                            var say = 1;
                        }
                        if (get.subtype(trigger.card) == 'equip3') {
                            var chat = ['加一马！', '砍不到我', '嘿嘿，距离不够！', '防御马。', '防御马！'].randomGet();
                            var say = 1;
                        }

                    }
                    if (Math.random() * 100 > parseFloat(lib.config['extension_祖安设置_ransay'])) var say = 0;
                    if (say == 1) {
                        player.say(chat);
                    }
                },
            }
            //zzsay
            // ---------------------------------------全场开始游戏播报------------------------------------------//   
            lib.skill._startgamesay = {
                trigger: {
                    player: "enterGame",
                    global: "gameDrawAfter",
                },
                silent: true,
                forced: true,
                filter: function(event, player) {
                    return true;
                },
                content: function() {
                    var say = 0;
                    if (player.identity == 'zhu') {
                        var chat = ['大家直接明了吧！', '这把要好好玩噢', '忠臣别乱来啊~', '辅助我就对了！', '我是主公。', '内奸你别乱来', '大家好好玩', '内奸别跳反。'].randomGet();
                    } else {
                        var chat = ['收到！！', '这把好好玩', '大家配合一下', '懂的懂的', '懂的都懂——', '我明了', '大家好！', '不乱玩不乱玩', 'OK', 'Ojbk', '开了开了', '这把看我乱杀', '别砍我，球球你们', '潜水ing', '打酱油的', '再集火我就托管了啊', '对我友好些，好么？', '多多互相帮助啊', '呵呵..啊哈哈哈哈哈', '鸡汤来啰~'].randomGet();
                    }
                    var ds = new Date();
                    var month = ds.getMonth() + 1;
                    var date = ds.getDate();
                    var year = ds.getFullYear();
                    var birmon = parseFloat(lib.config['extension_祖安设置_birthdaymonth']);
                    var birday = parseFloat(lib.config['extension_祖安设置_birthdaydate']);
                    if (month == birmon && date == birday) {
                        if (player == game.me) {
                            var chat = ['谢谢大家~', '感动ing', '我要吹蜡烛', '好耶', '今天我生日', '嗯呢', '哈哈好', '今天是我生日捏', '快祝我生日快乐！'].randomGet();
                        } else {
                            var chat = ['生日快乐', '生日快乐噢', '生日快乐！', '祝你生日快乐~', '祝贺祝贺！', '又大了一岁啊', '来来来，吹蜡烛', '快许个愿！'].randomGet();
                        }
                    }
                    if (lib.config['extension_祖安设置_girlspeak'] && player.sex == 'female') {
                        var chat2 = [' 加油>v<', ' QvQ！', ' QwQ..', ' 嘻嘻OvO'].randomGet();
                        var chat = chat + chat2;
                    }
                    var say = 1;
                    if (Math.random() * 100 > parseFloat(lib.config['extension_祖安设置_ransay'])) var say = 0;
                    if (lib.config['extension_祖安设置_zuantype'] == 'old' && say == 1) {
                        player.say(chat);
                    }
                },
            }
            // ---------------------------------------好运来效果------------------------------------------//   
            lib.skill._haoyunlai = {
                trigger: {
                    player: "drawBegin",
                },
                forced: true,
                silent: true,
                filter: function() {
                    return true;
                },
                content: function() {
                    if (parseFloat(lib.config['extension_祖安设置_audio']) >= '3') {
                        if (parseFloat(lib.config['extension_祖安设置_audio']) >= '4') {
                            var cho = parseFloat(lib.config['extension_祖安设置_audio']);
                            if (cho == '4') {
                                var verson = 'shousha';
                            } else {
                                var verson = 'ten';
                            }
                            game.playAudio('..', 'extension', '祖安武将', 'audio', verson, 'draw.mp3');
                        } else {
                            game.playAudio('..', 'extension', '祖安武将', 'audio', 'lyl_draw.mp3');
                        }
                    } else {
                        if (parseFloat(lib.config['extension_祖安设置_audio']) >= '2') game.playAudio('..', 'extension', '祖安武将', 'audio', 'draw.ogg');
                    }
                    if (player == game.me && lib.config['extension_祖安设置_goodluck'] && ui.cardPile.childElementCount > 1) {
                        if (lib.config['extension_祖安设置_zuantype'] == 'old') {
                            var chat = ['羁绊一抽！获得了' + get.cnNumber(trigger.num, true) + '张牌', '手气爆好！获得的' + get.cnNumber(trigger.num, true) + '张牌都是好牌！'].randomGet();
                            if (lib.config['extension_祖安设置_girlspeak'] && player.sex == 'female') {
                                var chat2 = [' 开心>v<', ' 耶QvQ！', ' 哇QwQ..', ' OvO嘻嘻', ' 噢$w$'].randomGet();
                                var chat = chat + chat2;
                            }
                            var say = 1;
                            if (Math.random() * 100 > parseFloat(lib.config['extension_祖安设置_ransay'])) var say = 0;
                            if (lib.config['extension_祖安设置_zuantype'] == 'old' && say == 1) player.say(chat);
                        }
                        var value = get.value(ui.cardPile.firstChild, player);
                        var num = Math.min(20, ui.cardPile.childElementCount);
                        var list = [],
                        list2 = [],
                        list3 = [];
                        for (var i = 1; i < num; i++) {
                            var val = get.value(ui.cardPile.childNodes[i], player);
                            if (val > value) {
                                list.push(ui.cardPile.childNodes[i]);
                                if (val > value + 1 && val >= 7) {
                                    list2.push(ui.cardPile.childNodes[i]);
                                }
                                if (val > value + 1 && val >= 8) {
                                    list3.push(ui.cardPile.childNodes[i]);
                                }
                            }
                        }
                        var card;
                        if (list3.length) {
                            card = list3.randomGet();
                        } else if (list2.length) {
                            card = list2.randomGet();
                        } else if (list.length) {
                            card = list.randomGet();
                        }
                        if (card) {
                            ui.cardPile.insertBefore(card, ui.cardPile.firstChild);
                        }
                    } else if (lib.config['extension_祖安设置_zuantype'] == 'old') {
                        var chat = ['今天的幸运数字是' + get.cnNumber(trigger.num, true), '获得了' + get.cnNumber(trigger.num, true) + '张牌', '手牌增加了' + get.cnNumber(trigger.num, true) + '张', 'yeah', '没拿多吧？', '听话，让我康康！', '让我康康！', '摸了' + get.cnNumber(trigger.num, true) + '张牌', '牌库失去了' + get.cnNumber(trigger.num, true) + '张牌', '手牌增加了' + get.cnNumber(trigger.num, true) + '张', '摸摸摸', '好爽，好爽', '我数一数...摸' + get.cnNumber(trigger.num, true) + '张'].randomGet();
                        if (lib.config['extension_祖安设置_girlspeak'] && player.sex == 'female') {
                            var chat2 = [' 开心>v<', ' 耶QvQ！', ' 哇QwQ..', ' OvO嘻嘻', ' 噢$w$'].randomGet();
                            var chat = chat + chat2;
                        }
                        var say = 1;
                        if (Math.random() * 100 > parseFloat(lib.config['extension_祖安设置_ransay'])) var say = 0;
                        if (lib.config['extension_祖安设置_zuantype'] == 'old' && say == 1) player.say(chat);
                    }
                },
                popup: false,
            }
            lib.skill._basicjuedgeskill = {
                trigger: {
                    player: "judgeBefore",
                },
                locked: true,
                silent: true,
                forced: true,
                priority: -102,
                unique: true,
                filter: function(event, player) {
                    if (lib.config['extension_祖安设置_zuantype'] != 'old') return false;
                    return (!lib.config['extension_祖安设置_goodluck']) || (player != game.me);
                },
                content: function() {
                    "step 0";
                    var chat = ['我判！', '日子越来越有判头了..', '看看判得怎么样', 'GKDGKD', '我康康', '摆脱运气好一点', '啊这...'].randomGet();
                    if (lib.config['extension_祖安设置_girlspeak'] && player.sex == 'female') {
                        var chat2 = [' 开心>v<', ' 耶QvQ！', ' 哇QwQ..', ' OvO嘻嘻', ' 噢$w$'].randomGet();
                        var chat = chat + chat2;
                    }
                    var say = 1;
                    if (Math.random() * 100 > parseFloat(lib.config['extension_祖安设置_ransay'])) var say = 0;
                    if (say == 1) player.say(chat);
                },
            }
            lib.skill._goodluckjuedgeskill = {
                trigger: {
                    player: "judgeBefore",
                },
                locked: true,
                silent: true,
                forced: true,
                priority: -101,
                unique: true,
                filter: function(event, player) {
                    return lib.config['extension_祖安设置_goodluck'] && player == game.me;
                },
                content: function() {
                    "step 0";
                    event.cards = get.cards(3);
                    /*player.chooseCardButton(true,event.cards,'改命：选择一张牌作为你的'+trigger.judgestr+'判定结果').ai=function(button){
			            if(get.attitude(player,trigger.player)>0){
			                return 1+trigger.judge(button.link);
			            }
			            if(get.attitude(player,trigger.player)<0){
			                return 1-trigger.judge(button.link);
			            }
			            return 0;
			        };*/
                    var cho = 0;
                    event.is = 0;
                    if (get.attitude(player, trigger.player) > 0) {
                        for (var i = 0; i < event.cards.length; i++) {
                            var val = 1 + trigger.judge(event.cards[i]);
                            //player.chooseControl('ok').set('dialog',[val,event.cards[i]]);
                            if (cho < val) {
                                cho = val;
                                event.is = i;
                            }
                        }
                    } else if (get.attitude(player, trigger.player) < 0) {
                        for (var i = 0; i < event.cards.length; i++) {
                            var val = 1 - trigger.judge(event.cards[i]);
                            if (cho > val) {
                                cho = val;
                                event.is = i;
                            }
                        }
                    } else {
                        event.is = 0;
                    }
                    //event.finish();
                    "step 1";
                    event.links = event.cards[event.is];
                    //event.cards.remove(event.links);
                    "step 2";
                    //event.cards=[event.links].concat(event.cards);
                    var first = ui.cardPile.firstChild;
                    var cards = event.cards;
                    for (var i = 0; i < cards.length; i++) {
                        if (i != event.is) ui.cardPile.insertBefore(cards[i], first);
                    }
                    "step 3";
                    var first = ui.cardPile.firstChild;
                    ui.cardPile.insertBefore(event.links, first);
                    var chat = ['我夜观天象...', '哼哼~', '一切都会如我愿的', '超级幸运星', '神之判定！', '你相信命运吗？'].randomGet();
                    if (lib.config['extension_祖安设置_girlspeak'] && player.sex == 'female') {
                        var chat2 = [' 开心>v<', ' 耶QvQ！', ' 哇QwQ..', ' OvO嘻嘻', ' 噢$w$'].randomGet();
                        var chat = chat + chat2;
                    }
                    var say = 1;
                    if (Math.random() * 100 > parseFloat(lib.config['extension_祖安设置_ransay'])) var say = 0;
                    if (say == 1) player.say(chat);
                },
            }
            // ---------------------------------------判定牌特效------------------------------------------//   
            /*
			    "none":"×关闭设置",
			    "bingle":"兵乐〈锦囊〉",
			    "shandian":"天气〈锦囊〉",
			    "dying":"濒死〈特效〉",
			    "mode":"模式〈特效〉",
			*/
            //if(lib.config['extension_祖安设置_bingletexiao']){
            lib.skill._bingleAddJudge = {
                trigger: {
                    //target:'useCardToBegin',
                    player: 'addJudgeAfter',
                },
                priority: -999,
                silent: true,
                forced: true,
                filter: function(event, player) { //getitem
                    if (!game.getLocalItem('ZUANbingletexiaoSET', '_')) return false;
                    if (parseFloat(lib.config['extension_祖安设置_newui']) == 0) return false;
                    var includes = ['lebu', 'bingliang', 'caomu', 'shandian', 'hongshui', 'huoshan', 'fulei'];
                    return event.card && event.card.name && includes.contains(event.card.name);
                    //return event.card&&get.type(event.card)=='delay';
                },
                content: function() {
                    "step 0";
                    // ---------------------------------------【新自给特效】------------------------------------------//   
                    //var node = document.createElement('div');
                    //  player.node.avatar.appendChild(node);      
                    /*var tex=lib.config['extension_祖安设置_texiao']; 
	                if(tex) {
	                game.newalive('extension/祖安武将/effects/'+trigger.card.name+'.gif',1,lib.config.zuancoveropacity);
	                    if(parseFloat(lib.config['extension_祖安设置_audio'])>='2') game.playAudio('..','extension','祖安武将','audio',trigger.card.name+'.mp3');
	                }*/
                    var cardslth = "none";
                    if (game.getLocalItem('ZUANbingletexiaoSET', 'bingle')) {
                        cardslth = cardslth + "_lebu_bingliang_caomu";
                    }
                    if (game.getLocalItem('ZUANbingletexiaoSET', 'shandian')) {
                        cardslth = cardslth + "_shandian_hongshui_huoshan_fulei";
                    }
                    if (cardslth.indexOf(trigger.card.name) == -1) {
                        if (event && event.finish) {
                            event.finish();
                        } else {
                            return;
                        }
                    }
                    "step 1";
                    event.translists = ['none', 'tutou', 'shousha', 'zhounian'];
                    event.newui = parseFloat(lib.config['extension_祖安设置_newui']);
                    game.broadcastAll(function(player) {
                        if (!player.storage.delayimg) player.storage.delayimg = [];
                        if (!player.storage.delayimg.contains(trigger.card.name)) {
                            player.storage.delayimg.push(trigger.card.name);
                            player.storage.delayimg[trigger.card.name] = document.createElement('div');
                            if (event.newui != '0') {
                                player.storage.delayimg[trigger.card.name].setBackgroundImage('extension/祖安武将/cover/' + event.translists[event.newui] + '_' + trigger.card.name + '.png');
                            }
                            player.storage.delayimg[trigger.card.name].style.opacity = lib.config.zuancoveropacity;
                            player.storage.delayimg[trigger.card.name].style.backgroundSize = 'cover';
                            player.storage.delayimg[trigger.card.name].style.width = '100%';
                            player.storage.delayimg[trigger.card.name].style.height = '100%';
                            player.storage.delayimg[trigger.card.name].style.opacity = 0; //'translateY(-200px)'
                            player.node.avatar.appendChild(player.storage.delayimg[trigger.card.name]);
                            ui.refresh(player.storage.delayimg[trigger.card.name]);
                            player.storage.delayimg[trigger.card.name].style.transition = 'all 0.7s'; //TIETU
                            player.storage.delayimg[trigger.card.name].style.opacity = 1; //transform='';
                        }
                    },
                    player);
                    //player.addTempSkill('thunderunshow',{player:'phaseBegin'});
                    {
                        if (event && event.finish) {
                            event.finish();
                        } else {
                            return;
                        }
                    }
                    /*if((parseFloat(lib.config['extension_祖安设置_wallpaper'])!='1'||(lib.config['extension_祖安设置_exwallpaper']&&lib.config.zuanexwallpaper=='on'))&&parseFloat(lib.config['extension_祖安设置_isPC'])!='0') {
			            setTimeout(function () {
                            game.broadcastAll()+ui.background.setBackgroundImage(lib.config.zuanbackground);
					    // ---------------------------------------动态壁纸刷新
			            }, 700);
			        }*/
                },
            }
            lib.skill._bingleLoseJudge = {
                trigger: {
                    player: ['judgeBegin', 'loseAfter'],
                },
                silent: true,
                priority: -2019,
                forced: true,
                filter: function(event, player) {
                    if (!game.getLocalItem('ZUANbingletexiaoSET', '_')) return false;
                    return true;
                    //return event.card&&get.type(event.card)=='delay';
                },
                content: function() {
                    'step 0';
                    game.broadcastAll(function(player) {
                        //imgs=player.node.avatar.querySelectorAll("div")
                        imgs = player.storage.delayimg;
                        if (!imgs) imgs = [];
                        for (var i = 0; i < imgs.length; i++) {
                            //alert(imgs[i]);target.hasJudge(imgs[i])
                            //if(player.countCards('j',{name:imgs[i]})<1) {
                            if (!player.hasJudge(imgs[i])) {
                                player.storage.delayimg[imgs[i]].style.opacity = 0; //'translateY(-200px)'
                                player.storage.delayimg[imgs[i]].delete();
                                player.storage.delayimg.remove(imgs[i]);
                            }
                        }
                    },
                    player);
                    /*if((parseFloat(lib.config['extension_祖安设置_wallpaper'])!='1'||(lib.config['extension_祖安设置_exwallpaper']&&lib.config.zuanexwallpaper=='on'))&&parseFloat(lib.config['extension_祖安设置_isPC'])!='0') {
			            setTimeout(function () {
                            game.broadcastAll()+ui.background.setBackgroundImage(lib.config.zuanbackground);
					    // ---------------------------------------动态壁纸刷新
			            }, 100);
			        }*/
                },
            }
            lib.skill._bingleBigScreen = {
                trigger: {
                    target: 'useCardToBegin',
                    player: 'judgeBegin',
                },
                silent: true,
                forced: true,
                priority: 999,
                filter: function(event, player) {
                    var tex = lib.config['extension_祖安设置_texiao'];
                    var includes = ['shandian', 'huoshan', 'hongshui', 'fulei'];
                    return tex && event.card && get.type(event.card) == 'delay' && includes.contains(event.card.name);
                },
                content: function() {
                    game.newalive('extension/祖安武将/effects/' + trigger.card.name + '.gif', 1, lib.config.zuancoveropacity);
                    game.delay(1);
                    if (parseFloat(lib.config['extension_祖安设置_audio']) >= '2') game.playAudio('..', 'extension', '祖安武将', 'audio', trigger.card.name + '.mp3');
                },
            }
            lib.skill._bingleDying = {
                trigger: {
                    player: ['changeHp'],
                },
                silent: true,
                priority: 999,
                forced: true,
                filter: function(event, player) {
                    //if(parseFloat(lib.config['extension_祖安设置_newui'])==0) return false;
                    return game.getLocalItem('ZUANbingletexiaoSET', 'dying');
                },
                content: function() {
                    'step 0';
                    var rdying = false;
                    if (player.hasSkill('zuan_hudun')) {
                        if (player.hp <= 1 && player.countMark('zuan_hudun') < 1) rdying = true;
                    } else {
                        if (player.maxHp > 1) {
                            if (player.hp <= 1) rdying = true;
                        } else {
                            if (player.hp <= 0) rdying = true;
                        }
                    }

                    if (rdying && !player.storage.dyingimgshow) {

                        event.translists = ['none', 'tutou', 'shousha', 'zhounian'];
                        event.newui = parseFloat(lib.config['extension_祖安设置_newui']);
                        player.storage.dyingimgshow = true;
                        game.broadcastAll(function(player) {
                            player.storage.dying_img = document.createElement('div');
                            if (event.newui != '0') {
                                player.storage.dying_img.setBackgroundImage('extension/祖安武将/cover/' + event.translists[event.newui] + '_dying.png');
                            }
                            player.storage.dying_img.style.opacity = lib.config.zuancoveropacity;
                            player.storage.dying_img.style.backgroundSize = 'cover';
                            player.storage.dying_img.style.width = '100%';
                            player.storage.dying_img.style.height = '100%';
                            player.storage.dying_img.style.opacity = 0; //'translateY(-200px)'
                            player.node.avatar.appendChild(player.storage.dying_img);
                            ui.refresh(player.storage.dying_img);
                            player.storage.dying_img.style.transition = 'all 0.7s'; //TIETU
                            player.storage.dying_img.style.opacity = 1; //transform='';
                        },
                        player);

                    } else if (player.storage.dyingimgshow && !rdying) {

                        player.storage.dyingimgshow = false;
                        game.broadcastAll(function(player) {
                            player.storage.dying_img.style.opacity = 0; //'translateY(-200px)'
                            player.storage.dying_img.delete();
                        },
                        player)

                    }
                },
            }
            lib.skill._binglediecls = {
                trigger: {
                    player: 'dieBegin',
                },
                silent: true,
                priority: 2,
                forced: true,
                filter: function(event, player) {
                    //if(parseFloat(lib.config['extension_祖安设置_newui'])==0) return false;
                    return game.getLocalItem('ZUANbingletexiaoSET', 'dying');
                },
                content: function() {
                    player.storage.delayimg = [];
                    player.storage.dyingimgshow = false;
                    game.broadcastAll(function(player) {
                        imgs = player.node.avatar.querySelectorAll("div");
                        for (var i = 0; i < imgs.length; i++) {
                            var img = imgs[i];
                            img.style.opacity = 0; //'translateY(-200px)'
                            img.delete();
                        }
                    },
                    player)
                },
            }
            //}
            /*
         lib.skill._bingletexiaoshandian={
        trigger:{
            target:'useCardToBegin',
        },
        silent:true,
        forced:true,
        filter:function (event,player){
            return event.card&&event.card.name=='shandian';
        },
        content:function(){   
        'step 0';       
    // ---------------------------------------【闪电特效】------------------------------------------//   
                        //var node = document.createElement('div');
        //  player.node.avatar.appendChild(node);      
                var tex=lib.config['extension_祖安设置_texiao']; 
        if(tex) {
                game.newalive('extension/祖安武将/effects/thunder.gif',1,lib.config.zuancoveropacity);
 if(parseFloat(lib.config['extension_祖安设置_audio'])>='2') game.playAudio('..','extension','祖安武将','audio','thunder.mp3');
}
            game.broadcastAll(function(player){
            img = document.createElement('div');
            if(parseFloat(lib.config['extension_祖安设置_newui'])!='0') {   
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='1') img.setBackgroundImage('extension/祖安武将/cover/cover_shandian.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='2') img.setBackgroundImage('extension/祖安武将/cover/cover_10shandian.png');     
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='3') img.setBackgroundImage('extension/祖安武将/cover/cover_Hshandian.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='4') img.setBackgroundImage('extension/祖安武将/cover/cover_Sshandian.png');      
                    }
                img.style.opacity=lib.config.zuancoveropacity;
                img.style.backgroundSize='cover';
                img.style.width='100%';
                img.style.height='100%';
                img.style.opacity=0;//'translateY(-200px)'
                player.node.avatar.appendChild(img);
                ui.refresh(img);
                img.style.opacity=1;//transform='';
            },player);
                player.addTempSkill('thunderunshow',{player:'phaseBegin'});
        'step 1';       
        if((parseFloat(lib.config['extension_祖安设置_wallpaper'])!='1'||(lib.config['extension_祖安设置_exwallpaper']&&lib.config.zuanexwallpaper=='on'))&&parseFloat(lib.config['extension_祖安设置_isPC'])!='0') {
            setTimeout(function () {
                            game.broadcastAll()+ui.background.setBackgroundImage(lib.config.zuanbackground);
    // ---------------------------------------动态壁纸刷新
            }, 700);
        }
        },      
    }
         lib.skill._bingletexiaohuoshan={
        trigger:{
            target:'useCardToBegin',
        }, 
        silent:true,
        forced:true,
        filter:function (event,player){
            return event.card&&event.card.name=='huoshan';
        },                 
        content:function(){   
        'step 0';       
    // ---------------------------------------【火山特效】------------------------------------------//   
                        //var node = document.createElement('div');
        //  player.node.avatar.appendChild(node);      
                var tex=lib.config['extension_祖安设置_texiao']; 
        if(tex) {
                game.newalive('extension/祖安武将/effects/volcano.gif',2.5,lib.config.zuancoveropacity);
 if(parseFloat(lib.config['extension_祖安设置_audio'])>='2') game.playAudio('..','extension','祖安武将','audio','huoshan.mp3');
}
            game.broadcastAll(function(player){
            img = document.createElement('div');
            if(parseFloat(lib.config['extension_祖安设置_newui'])!='0') {   
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='1') img.setBackgroundImage('extension/祖安武将/cover/cover_huoshan.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='2') img.setBackgroundImage('extension/祖安武将/cover/cover_10huoshan.png');     
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='3') img.setBackgroundImage('extension/祖安武将/cover/cover_Hhuoshan.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='4') img.setBackgroundImage('extension/祖安武将/cover/cover_Shuoshan.png');      
                    }
                img.style.opacity=lib.config.zuancoveropacity;
                img.style.backgroundSize='cover';
                img.style.width='100%';
                img.style.height='100%';
                img.style.opacity=0;//'translateY(-200px)'
                player.node.avatar.appendChild(img);
                ui.refresh(img);
                img.style.opacity=1;//transform='';
            },player);
                player.addTempSkill('huoshanunshow',{player:'phaseBegin'});
        'step 1';       
        if((parseFloat(lib.config['extension_祖安设置_wallpaper'])!='1'||(lib.config['extension_祖安设置_exwallpaper']&&lib.config.zuanexwallpaper=='on'))&&parseFloat(lib.config['extension_祖安设置_isPC'])!='0') {
            setTimeout(function () {
                            game.broadcastAll()+ui.background.setBackgroundImage(lib.config.zuanbackground);
    // ---------------------------------------动态壁纸刷新
            }, 2300);
        }
        },      
    }         
         lib.skill._bingletexiaohongshui={
        trigger:{
            target:'useCardToBegin',
        },
        silent:true,
        forced:true,
        filter:function (event,player){
            return event.card&&event.card.name=='hongshui';
        },                 
        content:function(){          
            'step 0';
    // ---------------------------------------【洪水特效】------------------------------------------//   
                        //var node = document.createElement('div');
        //  player.node.avatar.appendChild(node);      
                var tex=lib.config['extension_祖安设置_texiao']; 
        if(tex) {
                game.newalive('extension/祖安武将/effects/flood.gif',2.5,lib.config.zuancoveropacity);
 if(parseFloat(lib.config['extension_祖安设置_audio'])>='2') game.playAudio('..','extension','祖安武将','audio','hongshui.mp3');
}
            game.broadcastAll(function(player){
            img = document.createElement('div');
            if(parseFloat(lib.config['extension_祖安设置_newui'])!='0') {   
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='1') img.setBackgroundImage('extension/祖安武将/cover/cover_hongshui.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='2') img.setBackgroundImage('extension/祖安武将/cover/cover_10hongshui.png');     
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='3') img.setBackgroundImage('extension/祖安武将/cover/cover_Hhongshui.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='4') img.setBackgroundImage('extension/祖安武将/cover/cover_Shongshui.png');      
                    }
                img.style.opacity=lib.config.zuancoveropacity;
                img.style.backgroundSize='cover';
                img.style.width='100%';
                img.style.height='100%';
                img.style.opacity=0;//'translateY(-200px)'
                player.node.avatar.appendChild(img);
                ui.refresh(img);
                img.style.opacity=1;//transform='';
            },player);
                player.addTempSkill('hongshuiunshow',{player:'phaseBegin'});
        'step 1';       
        if((parseFloat(lib.config['extension_祖安设置_wallpaper'])!='1'||(lib.config['extension_祖安设置_exwallpaper']&&lib.config.zuanexwallpaper=='on'))&&parseFloat(lib.config['extension_祖安设置_isPC'])!='0') {
            setTimeout(function () {
                            game.broadcastAll()+ui.background.setBackgroundImage(lib.config.zuanbackground);
    // ---------------------------------------动态壁纸刷新
            }, 2300);
        }
        },      
    }         
         lib.skill._bingletexiaofulei={
        trigger:{
            target:'useCardToBegin',
        },
        silent:true,
        forced:true,
        filter:function (event,player){
            return event.card&&event.card.name=='fulei';
        },
        content:function(){   
        'step 0';       
    // ---------------------------------------【浮雷特效】------------------------------------------//   
                        //var node = document.createElement('div');
        //  player.node.avatar.appendChild(node);      
                var tex=lib.config['extension_祖安设置_texiao']; 
        if(tex) {
                game.newalive('extension/祖安武将/effects/fulei.gif',1,lib.config.zuancoveropacity);
 if(parseFloat(lib.config['extension_祖安设置_audio'])>='2') game.playAudio('..','extension','祖安武将','audio','thunder.mp3');
}
            game.broadcastAll(function(player){
            img = document.createElement('div');
            if(parseFloat(lib.config['extension_祖安设置_newui'])!='0') {   
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='1') img.setBackgroundImage('extension/祖安武将/cover/cover_fulei.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='2') img.setBackgroundImage('extension/祖安武将/cover/cover_10fulei.png');     
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='3') img.setBackgroundImage('extension/祖安武将/cover/cover_Hfulei.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='4') img.setBackgroundImage('extension/祖安武将/cover/cover_Sfulei.png');      
                    }
                img.style.opacity=lib.config.zuancoveropacity;
                img.style.backgroundSize='cover';
                img.style.width='100%';
                img.style.height='100%';
                img.style.opacity=0;//'translateY(-200px)'
                player.node.avatar.appendChild(img);
                ui.refresh(img);
                img.style.opacity=1;//transform='';
            },player);
                player.addTempSkill('fuleiunshow',{player:'phaseBegin'});
        'step 1';       
        if((parseFloat(lib.config['extension_祖安设置_wallpaper'])!='1'||(lib.config['extension_祖安设置_exwallpaper']&&lib.config.zuanexwallpaper=='on'))&&parseFloat(lib.config['extension_祖安设置_isPC'])!='0') {
            setTimeout(function () {
                            game.broadcastAll()+ui.background.setBackgroundImage(lib.config.zuanbackground);
    // ---------------------------------------动态壁纸刷新
            }, 700);
        }
        },      
    }
         lib.skill._bingletexiaole={
        trigger:{
            target:'useCardToBegin',
        },
        silent:true,
        forced:true,
        filter:function (event,player){
            return event.card&&event.card.name=='lebu';
        },                 
        content:function(){    
                        //var node = document.createElement('div');
        //  player.node.avatar.appendChild(node);             
            game.broadcastAll(function(player){
            img = document.createElement('div');
            if(parseFloat(lib.config['extension_祖安设置_newui'])!='0') {   
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='1') img.setBackgroundImage('extension/祖安武将/cover/cover_lebu.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='2') img.setBackgroundImage('extension/祖安武将/cover/cover_10lebu.png');     
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='3') img.setBackgroundImage('extension/祖安武将/cover/cover_Hlebu.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='4') img.setBackgroundImage('extension/祖安武将/cover/cover_Slebu.png');      
                    }
                img.style.opacity=lib.config.zuancoveropacity;
                img.style.backgroundSize='cover';
                img.style.width='100%';
                img.style.height='100%';
                img.style.opacity=0;//'translateY(-200px)'
                player.node.avatar.appendChild(img);
                ui.refresh(img);
                img.style.opacity=1;//transform='';
            },player);
        },      
    }   
    lib.skill._bingletexiaobingliang={
        trigger:{
            target:'useCardToBegin',
        },
        silent:true,
        forced:true,
        filter:function (event,player){
            return event.card&&event.card.name=='bingliang';
        },                 
        content:function(){     
            game.broadcastAll(function(player){
                img = document.createElement('div');
            if(parseFloat(lib.config['extension_祖安设置_newui'])!='0') {   
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='1') img.setBackgroundImage('extension/祖安武将/cover/cover_bingliang.jpg');
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='2') img.setBackgroundImage('extension/祖安武将/cover/cover_10bingliang.png');     
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='3') img.setBackgroundImage('extension/祖安武将/cover/cover_Hbingliang.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='4') img.setBackgroundImage('extension/祖安武将/cover/cover_Sbingliang.png');      
                    }
                img.style.opacity=lib.config.zuancoveropacity;
                img.style.width='100%';
                img.style.height='100%';
                img.style.backgroundSize='cover';
                img.style.opacity=0;//'translateY(-200px)'
                player.node.avatar.appendChild(img);
                ui.refresh(img);
                img.style.opacity=1;//transform='';
            },player)
        },
    }
    lib.skill._bingletexiao={
        trigger:{
            player:'judgeAfter',
        },
        silent:true,
        priority:-2019,
        forced:true,
        content:function(){
            'step 0';
                game.broadcastAll(function(player){
                    imgs=player.node.avatar.querySelectorAll("div")
                    for (var i=0;i<imgs.length;i++) {
                        var img = imgs[i];
                        img.style.opacity=0;//'translateY(-200px)'
                        img.delete();
                    }
                },player)
        if(!player.countCards('j',{name:'shandian'})&&player.hasSkill('thunderunshow')) player.removeSkill('thunderunshow');   
        if(!player.countCards('j',{name:'huoshan'})&&player.hasSkill('huoshanunshow')) player.removeSkill('huoshanunshow');      
        if(!player.countCards('j',{name:'hongshui'})&&player.hasSkill('hongshuiunshow')) player.removeSkill('huoshanunshow');    
        if(!player.countCards('j',{name:'fulei'})&&player.hasSkill('fuleiunshow')) player.removeSkill('fuleiunshow');                   
            'step 1';
            event.rdying=false;
            if(player.hasSkill('zuan_hudun')) {
                if(player.hp<=1&&player.countMark('zuan_hudun')<1) event.rdying=true;
            }else {
            if(player.maxHp>1) {
                if(player.hp<=1) event.rdying=true;
            }else {
                if(player.hp<=0) event.rdying=true;
            }
            }
            if(event.rdying) {
                player.addTempSkill('hpunshow',{player:'die'});
                game.broadcastAll(function(player){
                    img = document.createElement('div');
            if(parseFloat(lib.config['extension_祖安设置_newui'])!='0') {   
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='1') img.setBackgroundImage('extension/祖安武将/cover/cover_dying.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='2') img.setBackgroundImage('extension/祖安武将/cover/cover_10dying.png');     
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='3') img.setBackgroundImage('extension/祖安武将/cover/cover_Hdying.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='4') img.setBackgroundImage('extension/祖安武将/cover/cover_Sdying.png');      
                    }
                    img.style.opacity=lib.config.zuancoveropacity;
                    img.style.width='100%';
                    img.style.height='100%';
                    img.style.backgroundSize='cover';
                    img.style.zIndex=window.zuancoverindex;
                    img.style.opacity=0;//'translateY(-200px)'
                    player.node.avatar.appendChild(img);
                    ui.refresh(img);
                    img.style.opacity=1;//transform='';
                },player)
            }
            if(player.countCards('j',{name:'lebu'})){
                game.broadcastAll(function(player){
                    img = document.createElement('div');
            if(parseFloat(lib.config['extension_祖安设置_newui'])!='0') {   
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='1') img.setBackgroundImage('extension/祖安武将/cover/cover_lebu.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='2') img.setBackgroundImage('extension/祖安武将/cover/cover_10lebu.png');     
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='3') img.setBackgroundImage('extension/祖安武将/cover/cover_Hlebu.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='4') img.setBackgroundImage('extension/祖安武将/cover/cover_Slebu.png');      
                    }
                    img.style.opacity=lib.config.zuancoveropacity;
                    img.style.width='100%';
                    img.style.height='100%';
                    img.style.backgroundSize='cover';
                    img.style.zIndex=window.zuancoverindex;
                    img.style.opacity=0;//'translateY(-200px)'
                    player.node.avatar.appendChild(img);
                    ui.refresh(img);
                    img.style.opacity=1;//transform='';
                },player)
            }   
            if(player.countCards('j',{name:'bingliang'})){
                game.broadcastAll(function(player){
                    img = document.createElement('div');
            if(parseFloat(lib.config['extension_祖安设置_newui'])!='0') {   
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='1') img.setBackgroundImage('extension/祖安武将/cover/cover_bingliang.jpg');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='2') img.setBackgroundImage('extension/祖安武将/cover/cover_10bingliang.png');     
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='3') img.setBackgroundImage('extension/祖安武将/cover/cover_Hbingliang.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='4') img.setBackgroundImage('extension/祖安武将/cover/cover_Sbingliang.png');      
                    }
                    img.style.opacity=lib.config.zuancoveropacity;
                    img.style.width='100%';
                    img.style.height='100%';
                    img.style.backgroundSize='cover';
                    img.style.zIndex=window.zuancoverindex;
                    img.style.opacity=0;//'translateY(-200px)'
                    player.node.avatar.appendChild(img);
                    ui.refresh(img);
                    img.style.opacity=1;//transform='';
                },player)
            } 
            if(player.countCards('j',{name:'huoshan'})){
                game.broadcastAll(function(player){
                    img = document.createElement('div');
            if(parseFloat(lib.config['extension_祖安设置_newui'])!='0') {   
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='1') img.setBackgroundImage('extension/祖安武将/cover/cover_huoshan.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='2') img.setBackgroundImage('extension/祖安武将/cover/cover_10huoshan.png');     
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='3') img.setBackgroundImage('extension/祖安武将/cover/cover_Hhuoshan.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='4') img.setBackgroundImage('extension/祖安武将/cover/cover_Shuoshan.png');      
                    }
                    img.style.opacity=lib.config.zuancoveropacity;
                    img.style.width='100%';
                    img.style.height='100%';
                    img.style.backgroundSize='cover';
                    img.style.zIndex=window.zuancoverindex;
                    img.style.opacity=0;//'translateY(-200px)'
                    player.node.avatar.appendChild(img);
                    ui.refresh(img);
                    img.style.opacity=1;//transform='';
                },player)
            }
            if(player.countCards('j',{name:'hongshui'})){
                game.broadcastAll(function(player){
                    img = document.createElement('div');
            if(parseFloat(lib.config['extension_祖安设置_newui'])!='0') {   
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='1') img.setBackgroundImage('extension/祖安武将/cover/cover_hongshui.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='2') img.setBackgroundImage('extension/祖安武将/cover/cover_10hongshui.png');     
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='3') img.setBackgroundImage('extension/祖安武将/cover/cover_Hhongshui.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='4') img.setBackgroundImage('extension/祖安武将/cover/cover_Shongshui.png');      
                    }
                    img.style.opacity=lib.config.zuancoveropacity;
                    img.style.width='100%';
                    img.style.height='100%';
                    img.style.backgroundSize='cover';
                    img.style.zIndex=window.zuancoverindex;
                    img.style.opacity=0;//'translateY(-200px)'
                    player.node.avatar.appendChild(img);
                    ui.refresh(img);
                    img.style.opacity=1;//transform='';
                },player)
            }
            if(player.countCards('j',{name:'shandian'})){
                game.broadcastAll(function(player){
                    img = document.createElement('div');
            if(parseFloat(lib.config['extension_祖安设置_newui'])!='0') {   
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='1') img.setBackgroundImage('extension/祖安武将/cover/cover_shandian.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='2') img.setBackgroundImage('extension/祖安武将/cover/cover_10shandian.png');     
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='3') img.setBackgroundImage('extension/祖安武将/cover/cover_Hshandian.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='4') img.setBackgroundImage('extension/祖安武将/cover/cover_Sshandian.png');      
                    }
                    img.style.opacity=lib.config.zuancoveropacity;
                    img.style.width='100%';
                    img.style.height='100%';
                    img.style.backgroundSize='cover';
                    img.style.zIndex=window.zuancoverindex;
                    img.style.opacity=0;//'translateY(-200px)'
                    player.node.avatar.appendChild(img);
                    ui.refresh(img);
                    img.style.opacity=1;//transform='';
                },player)
            }
        if((parseFloat(lib.config['extension_祖安设置_wallpaper'])!='1'||(lib.config['extension_祖安设置_exwallpaper']&&lib.config.zuanexwallpaper=='on'))&&parseFloat(lib.config['extension_祖安设置_isPC'])!='0') {
            setTimeout(function () {
                            game.broadcastAll()+ui.background.setBackgroundImage(lib.config.zuanbackground);
    // ---------------------------------------动态壁纸刷新
            }, 100);
        }
        },
    }
    lib.skill._thundertexiao={
        trigger:{
            global:'phaseDrawBefore',
        },
        silent:true,
        priority:99,
        forced:true,
        content:function(){ 
            if(!player.hasSkill('thunderunshow')){
            if(player.countCards('j',{name:'shandian'})){
            game.broadcastAll(function(player){
            img = document.createElement('div');
            if(parseFloat(lib.config['extension_祖安设置_newui'])!='0') {   
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='1') img.setBackgroundImage('extension/祖安武将/cover/cover_shandian.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='2') img.setBackgroundImage('extension/祖安武将/cover/cover_10shandian.png');     
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='3') img.setBackgroundImage('extension/祖安武将/cover/cover_Hshandian.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='4') img.setBackgroundImage('extension/祖安武将/cover/cover_Sshandian.png');      
                    }
            img.style.backgroundSize='cover';
                img.style.opacity=lib.config.zuancoveropacity;
                img.style.width='100%';
                img.style.height='100%';
                img.style.opacity=0;//'translateY(-200px)'
                player.node.avatar.appendChild(img);
                ui.refresh(img);
                img.style.opacity=1;//transform='';
            },player);
                player.addTempSkill('thunderunshow',{player:'phaseBegin'});
            }
            }
            if(!player.hasSkill('huoshanunshow')){
            if(player.countCards('j',{name:'huoshan'})){
            game.broadcastAll(function(player){
            img = document.createElement('div');
            if(parseFloat(lib.config['extension_祖安设置_newui'])!='0') {   
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='1') img.setBackgroundImage('extension/祖安武将/cover/cover_huoshan.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='2') img.setBackgroundImage('extension/祖安武将/cover/cover_10huoshan.png');     
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='3') img.setBackgroundImage('extension/祖安武将/cover/cover_Hhuoshan.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='4') img.setBackgroundImage('extension/祖安武将/cover/cover_Shuoshan.png');      
                    }
            img.style.backgroundSize='cover';
                img.style.opacity=lib.config.zuancoveropacity;
                img.style.width='100%';
                img.style.height='100%';
                img.style.opacity=0;//'translateY(-200px)'
                player.node.avatar.appendChild(img);
                ui.refresh(img);
                img.style.opacity=1;//transform='';
            },player);
                player.addTempSkill('huoshanunshow',{player:'phaseBegin'});
            }
            }
            if(!player.hasSkill('hongshuiunshow')){
            if(player.countCards('j',{name:'hongshui'})){
            game.broadcastAll(function(player){
            img = document.createElement('div');
            if(parseFloat(lib.config['extension_祖安设置_newui'])!='0') {   
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='1') img.setBackgroundImage('extension/祖安武将/cover/cover_hongshui.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='2') img.setBackgroundImage('extension/祖安武将/cover/cover_10hongshui.png');     
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='3') img.setBackgroundImage('extension/祖安武将/cover/cover_Hhongshui.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='4') img.setBackgroundImage('extension/祖安武将/cover/cover_Shongshui.png');      
                    }
            img.style.backgroundSize='cover';
                img.style.opacity=lib.config.zuancoveropacity;
                img.style.width='100%';
                img.style.height='100%';
                img.style.opacity=0;//'translateY(-200px)'
                player.node.avatar.appendChild(img);
                ui.refresh(img);
                img.style.opacity=1;//transform='';
            },player);
                player.addTempSkill('hongshuiunshow',{player:'phaseBegin'});
            }
            }
            if(!player.hasSkill('fuleiunshow')){
            if(player.countCards('j',{name:'fulei'})){
            game.broadcastAll(function(player){
            img = document.createElement('div');
            if(parseFloat(lib.config['extension_祖安设置_newui'])!='0') {   
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='1') img.setBackgroundImage('extension/祖安武将/cover/cover_fulei.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='2') img.setBackgroundImage('extension/祖安武将/cover/cover_10fulei.png');     
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='3') img.setBackgroundImage('extension/祖安武将/cover/cover_Hfulei.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='4') img.setBackgroundImage('extension/祖安武将/cover/cover_Sfulei.png');      
                    }
                img.style.backgroundSize='cover';
                img.style.opacity=lib.config.zuancoveropacity;
                img.style.width='100%';
                img.style.height='100%';
                img.style.opacity=0;//'translateY(-200px)'
                player.node.avatar.appendChild(img);
                ui.refresh(img);
                img.style.opacity=1;//transform='';
            },player);
                player.addTempSkill('fuleiunshow',{player:'phaseBegin'});
            }
            }
        },
    }
    lib.skill._clearthunder={
        trigger:{
            global:'phaseEnd',
        },
        silent:true,
        priority:99,
        forced:true,                                               
        filter:function(event,card,player){      
            return false;
        },               
        content:function(){   
            if(!player.countCards('j',{name:'shandian'})){
               player.node.avatar.setBackground(player.name,'character');   
                }
        },
    }
    lib.skill._thundertexiao2={
        trigger:{
            player:'judgeBegin',
        },
        silent:true,
        priority:-15,
        forced:true,                                  
        filter:function(event,card,player){      
            return event.card;
        },
        content:function(){
            if(get.name(trigger.card)=='shandian'){
                var tex=lib.config['extension_祖安设置_texiao'];
        if(tex) {
                game.newalive('extension/祖安武将/effects/thunder.gif',1,lib.config.zuancoveropacity);
 if(parseFloat(lib.config['extension_祖安设置_audio'])>='2') game.playAudio('..','extension','祖安武将','audio','thunder.mp3');
}
            }
            if(get.name(trigger.card)=='huoshan'){
                var tex=lib.config['extension_祖安设置_texiao'];
        if(tex) {
                game.newalive('extension/祖安武将/effects/volcano.gif',2.5,lib.config.zuancoveropacity);
 if(parseFloat(lib.config['extension_祖安设置_audio'])>='2') game.playAudio('..','extension','祖安武将','audio','huoshan.mp3');
}
            }
            if(get.name(trigger.card)=='hongshui'){
                var tex=lib.config['extension_祖安设置_texiao'];
        if(tex) {
                game.newalive('extension/祖安武将/effects/flood.gif',2.5,lib.config.zuancoveropacity);
 if(parseFloat(lib.config['extension_祖安设置_audio'])>='2') game.playAudio('..','extension','祖安武将','audio','hongshui.mp3');
}
            }
            if(get.name(trigger.card)=='fulei'){
                var tex=lib.config['extension_祖安设置_texiao'];
        if(tex) {
                game.newalive('extension/祖安武将/effects/fulei.gif',1,lib.config.zuancoveropacity);
 if(parseFloat(lib.config['extension_祖安设置_audio'])>='2') game.playAudio('..','extension','祖安武将','audio','thunder.mp3');
}
            }
        },
    }
    lib.skill._bingletexiaochangehp={
        trigger:{
            player:["changeHp","enterGame"],
            global:"gameDrawAfter",
        },
        silent:true,
        priority:-1,
        forced:true,
        filter:function(event,player){
            var rdying=false;
            if(player.hasSkill('zuan_hudun')) {
                if(player.hp<=1&&player.countMark('zuan_hudun')<1) var rdying=true;
            }else {
            if(player.maxHp>1) {
                if(player.hp<=1) var rdying=true;
            }else {
                if(player.hp<=0) var rdying=true;
            }
            }
            return ((!rdying)&&player.hasSkill('hpunshow'))||(rdying&&!player.hasSkill('hpunshow'));
        },
        content:function(){
            'step 0';
            event.rdying=false;
            if(player.hasSkill('zuan_hudun')) {
                if(player.hp<=1&&player.countMark('zuan_hudun')<1) event.rdying=true;
            }else {
            if(player.maxHp>1) {
                if(player.hp<=1) event.rdying=true;
            }else {
                if(player.hp<=0) event.rdying=true;
            }
            }
            if ((!event.rdying)&&player.hasSkill('hpunshow')) {
                game.broadcastAll(function(player){
                    imgs=player.node.avatar.querySelectorAll("div")
                    for (var i=0;i<imgs.length;i++) {
                        var img = imgs[i];
                        img.style.opacity=0;//'translateY(-200px)'
                        img.delete();
                    }
                },player)
                player.removeSkill('hpunshow');
            }           
            'step 1';
            event.rdying=false;
            if(player.hasSkill('zuan_hudun')) {
                if(player.hp<=1&&player.countMark('zuan_hudun')<1) event.rdying=true;
            }else {
            if(player.maxHp>1) {
                if(player.hp<=1) event.rdying=true;
            }else {
                if(player.hp<=0) event.rdying=true;
            }
            }
            if(event.rdying&&!player.hasSkill('hpunshow')){
                game.broadcastAll(function(player){
                    img = document.createElement('div');
            if(parseFloat(lib.config['extension_祖安设置_newui'])!='0') {   
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='1') img.setBackgroundImage('extension/祖安武将/cover/cover_dying.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='2') img.setBackgroundImage('extension/祖安武将/cover/cover_10dying.png');     
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='3') img.setBackgroundImage('extension/祖安武将/cover/cover_Hdying.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='4') img.setBackgroundImage('extension/祖安武将/cover/cover_Sdying.png');      
                    }
                    img.style.opacity=lib.config.zuancoveropacity;
                    img.style.width='100%';
                    img.style.height='100%';
                    img.style.backgroundSize='cover';
                    img.style.zIndex=window.zuancoverindex;
                    img.style.opacity=0;//'translateY(-200px)'
                    player.node.avatar.appendChild(img);
                    ui.refresh(img);
                    img.style.opacity=1;//transform='';
                },player)
                player.addTempSkill('hpunshow',{player:'die'});
            }
            if (player.hp>1&&player.hasSkill('hpunshow')) {
        if(!player.countCards('j',{name:'shandian'})&&player.hasSkill('thunderunshow')) player.removeSkill('thunderunshow');   
        if(!player.countCards('j',{name:'huoshan'})&&player.hasSkill('huoshanunshow')) player.removeSkill('huoshanunshow');        
        if(!player.countCards('j',{name:'hongshui'})&&player.hasSkill('hongshuiunshow')) player.removeSkill('hongshuiunshow');        
        if(!player.countCards('j',{name:'fulei'})&&player.hasSkill('fuleiunshow')) player.removeSkill('fuleiunshow');        
                player.removeSkill('hpunshow');
            if(player.countCards('j',{name:'lebu'})){
                game.broadcastAll(function(player){
                    img = document.createElement('div');
            if(parseFloat(lib.config['extension_祖安设置_newui'])!='0') {   
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='1') img.setBackgroundImage('extension/祖安武将/cover/cover_lebu.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='2') img.setBackgroundImage('extension/祖安武将/cover/cover_10lebu.png');     
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='3') img.setBackgroundImage('extension/祖安武将/cover/cover_Hlebu.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='4') img.setBackgroundImage('extension/祖安武将/cover/cover_Slebu.png');      
                    }
                    img.style.opacity=lib.config.zuancoveropacity;
                    img.style.width='100%';
                    img.style.height='100%';
                    img.style.backgroundSize='cover';
                    img.style.zIndex=window.zuancoverindex;
                    img.style.opacity=0;//'translateY(-200px)'
                    player.node.avatar.appendChild(img);
                    ui.refresh(img);
                    img.style.opacity=1;//transform='';
                },player)
            }   
            if(player.countCards('j',{name:'bingliang'})){
                game.broadcastAll(function(player){
                    img = document.createElement('div');
            if(parseFloat(lib.config['extension_祖安设置_newui'])!='0') {   
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='1') img.setBackgroundImage('extension/祖安武将/cover/cover_bingliang.jpg');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='2') img.setBackgroundImage('extension/祖安武将/cover/cover_10bingliang.png');     
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='3') img.setBackgroundImage('extension/祖安武将/cover/cover_Hbingliang.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='4') img.setBackgroundImage('extension/祖安武将/cover/cover_Sbingliang.png');      
                    }
                    img.style.width='100%';
                    img.style.height='100%';
                    img.style.backgroundSize='cover';
                    img.style.opacity=0;//'translateY(-200px)'
                    player.node.avatar.appendChild(img);
                    ui.refresh(img);
                    img.style.opacity=1;//transform='';
                },player)
            } 
            if(player.countCards('j',{name:'huoshan'})){
                game.broadcastAll(function(player){
                    img = document.createElement('div');
            if(parseFloat(lib.config['extension_祖安设置_newui'])!='0') {   
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='1') img.setBackgroundImage('extension/祖安武将/cover/cover_huoshan.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='2') img.setBackgroundImage('extension/祖安武将/cover/cover_10huoshan.png');     
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='3') img.setBackgroundImage('extension/祖安武将/cover/cover_Hhuoshan.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='4') img.setBackgroundImage('extension/祖安武将/cover/cover_Shuoshan.png');      
                    }
                    img.style.opacity=lib.config.zuancoveropacity;
                    img.style.width='100%';
                    img.style.height='100%';
                    img.style.backgroundSize='cover';
                    img.style.zIndex=window.zuancoverindex;
                    img.style.opacity=0;//'translateY(-200px)'
                    player.node.avatar.appendChild(img);
                    ui.refresh(img);
                    img.style.opacity=1;//transform='';
                },player)
            }
            if(player.countCards('j',{name:'hongshui'})){
                game.broadcastAll(function(player){
                    img = document.createElement('div');
            if(parseFloat(lib.config['extension_祖安设置_newui'])!='0') {   
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='1') img.setBackgroundImage('extension/祖安武将/cover/cover_hongshui.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='2') img.setBackgroundImage('extension/祖安武将/cover/cover_10hongshui.png');     
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='3') img.setBackgroundImage('extension/祖安武将/cover/cover_Hhongshui.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='4') img.setBackgroundImage('extension/祖安武将/cover/cover_Shongshui.png');      
                    }
                    img.style.opacity=lib.config.zuancoveropacity;
                    img.style.width='100%';
                    img.style.height='100%';
                    img.style.backgroundSize='cover';
                    img.style.zIndex=window.zuancoverindex;
                    img.style.opacity=0;//'translateY(-200px)'
                    player.node.avatar.appendChild(img);
                    ui.refresh(img);
                    img.style.opacity=1;//transform='';
                },player)
            }
            if(player.countCards('j',{name:'fulei'})){
                game.broadcastAll(function(player){
                    img = document.createElement('div');
            if(parseFloat(lib.config['extension_祖安设置_newui'])!='0') {   
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='1') img.setBackgroundImage('extension/祖安武将/cover/cover_fulei.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='2') img.setBackgroundImage('extension/祖安武将/cover/cover_10fulei.png');     
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='3') img.setBackgroundImage('extension/祖安武将/cover/cover_Hfulei.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='4') img.setBackgroundImage('extension/祖安武将/cover/cover_Sfulei.png');      
                    }
                    img.style.opacity=lib.config.zuancoveropacity;
                    img.style.width='100%';
                    img.style.height='100%';
                    img.style.backgroundSize='cover';
                    img.style.zIndex=window.zuancoverindex;
                    img.style.opacity=0;//'translateY(-200px)'
                    player.node.avatar.appendChild(img);
                    ui.refresh(img);
                    img.style.opacity=1;//transform='';
                },player)
            }
            if(player.countCards('j',{name:'shandian'})){
                game.broadcastAll(function(player){
                    img = document.createElement('div');
            if(parseFloat(lib.config['extension_祖安设置_newui'])!='0') {   
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='1') img.setBackgroundImage('extension/祖安武将/cover/cover_shandian.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='2') img.setBackgroundImage('extension/祖安武将/cover/cover_10shandian.png');     
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='3') img.setBackgroundImage('extension/祖安武将/cover/cover_Hshandian.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='4') img.setBackgroundImage('extension/祖安武将/cover/cover_Sshandian.png');      
                    }
                    img.style.opacity=lib.config.zuancoveropacity;
                    img.style.width='100%';
                    img.style.height='100%';
                    img.style.backgroundSize='cover';
                    img.style.zIndex=window.zuancoverindex;
                    img.style.opacity=0;//'translateY(-200px)'
                    player.node.avatar.appendChild(img);
                    ui.refresh(img);
                    img.style.opacity=1;//transform='';
                },player)
            }
        }
        },
    }
    lib.skill._bingletexiao1={
        trigger:{
            player:'dieBegin',
        },
        silent:true,
        priority:2,
        forced:true,                            
        content:function(){
        if(player.hasSkill('hpunshow')) player.removeSkill('hpunshow');  
        if(player.hasSkill('thunderunshow')) player.removeSkill('thunderunshow');  
        if(player.hasSkill('huoshanunshow')) player.removeSkill('huoshanunshow');        
            game.broadcastAll(function(player){
                imgs=player.node.avatar.querySelectorAll("div");
                for (var i=0;i<imgs.length;i++) {
                    var img = imgs[i];
                    img.style.opacity=0;//'translateY(-200px)'
                    img.delete();
                }
            },player)
        },
    }
    lib.skill._bingletexiao2={
        trigger:{
            player:['loseEnd'],
        },
        filter:function(event,player){
            for(var i=0;i<event.cards.length;i++){
                if(event.cards[i].original=='j') return true;
            }
            return false;
        },
        silent:true,
        forced:true,
        content:function(){
            'step 0';
                game.broadcastAll(function(player){
                    imgs=player.node.avatar.querySelectorAll("div")
                    for (var i=0;i<imgs.length;i++) {
                        var img = imgs[i];
                        img.style.opacity=0;//'translateY(-200px)'
                        img.delete();
                    }
                },player)
        if(!player.countCards('j',{name:'shandian'})&&player.hasSkill('thunderunshow')) player.removeSkill('thunderunshow');   
        if(!player.countCards('j',{name:'huoshan'})&&player.hasSkill('huoshanunshow')) player.removeSkill('huoshanunshow');            
        if(!player.countCards('j',{name:'hongshui'})&&player.hasSkill('hongshuiunshow')) player.removeSkill('hongshuiunshow');            
        if(!player.countCards('j',{name:'fulei'})&&player.hasSkill('fuleiunshow')) player.removeSkill('fuleiunshow');                   
            'step 1';
            event.rdying=false;
            if(player.hasSkill('zuan_hudun')) {
                if(player.hp<=1&&player.countMark('zuan_hudun')<1) event.rdying=true;
            }else {
            if(player.maxHp>1) {
                if(player.hp<=1) event.rdying=true;
            }else {
                if(player.hp<=0) event.rdying=true;
            }
            }
            if(event.rdying) {
                player.addTempSkill('hpunshow',{player:'die'});
                game.broadcastAll(function(player){
                    img = document.createElement('div');
            if(parseFloat(lib.config['extension_祖安设置_newui'])!='0') {   
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='1') img.setBackgroundImage('extension/祖安武将/cover/cover_dying.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='2') img.setBackgroundImage('extension/祖安武将/cover/cover_10dying.png');     
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='3') img.setBackgroundImage('extension/祖安武将/cover/cover_Hdying.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='4') img.setBackgroundImage('extension/祖安武将/cover/cover_Sdying.png');      
                    }
                    img.style.opacity=lib.config.zuancoveropacity;
                    img.style.width='100%';
                    img.style.height='100%';
                    img.style.backgroundSize='cover';
                    img.style.zIndex=window.zuancoverindex;
                    img.style.opacity=0;//'translateY(-200px)'
                    player.node.avatar.appendChild(img);
                    ui.refresh(img);
                    img.style.opacity=1;//transform='';
                },player)
            }
            if(player.countCards('j',{name:'lebu'})){
                game.broadcastAll(function(player){
                    img = document.createElement('div');
            if(parseFloat(lib.config['extension_祖安设置_newui'])!='0') {   
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='1') img.setBackgroundImage('extension/祖安武将/cover/cover_lebu.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='2') img.setBackgroundImage('extension/祖安武将/cover/cover_10lebu.png');     
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='3') img.setBackgroundImage('extension/祖安武将/cover/cover_Hlebu.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='4') img.setBackgroundImage('extension/祖安武将/cover/cover_Slebu.png');      
                    }
                    img.style.opacity=lib.config.zuancoveropacity;
                    img.style.width='100%';
                    img.style.height='100%';
                    img.style.backgroundSize='cover';
                    img.style.zIndex=window.zuancoverindex;
                    img.style.opacity=0;//'translateY(-200px)'
                    player.node.avatar.appendChild(img);
                    ui.refresh(img);
                    img.style.opacity=1;//transform='';
                },player)
            }   
            if(player.countCards('j',{name:'bingliang'})){
                game.broadcastAll(function(player){
                    img = document.createElement('div');
            if(parseFloat(lib.config['extension_祖安设置_newui'])!='0') {   
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='1') img.setBackgroundImage('extension/祖安武将/cover/cover_bingliang.jpg');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='2') img.setBackgroundImage('extension/祖安武将/cover/cover_10bingliang.png');     
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='3') img.setBackgroundImage('extension/祖安武将/cover/cover_Hbingliang.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='4') img.setBackgroundImage('extension/祖安武将/cover/cover_Sbingliang.png');      
                    }
                    img.style.opacity=lib.config.zuancoveropacity;
                    img.style.height='100%';
                    img.style.backgroundSize='cover';
                    img.style.zIndex=window.zuancoverindex;
                    img.style.opacity=0;//'translateY(-200px)'
                    player.node.avatar.appendChild(img);
                    ui.refresh(img);
                    img.style.opacity=1;//transform='';
                },player)
            } 
            if(player.countCards('j',{name:'huoshan'})){
                game.broadcastAll(function(player){
                    img = document.createElement('div');
            if(parseFloat(lib.config['extension_祖安设置_newui'])!='0') {   
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='1') img.setBackgroundImage('extension/祖安武将/cover/cover_huoshan.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='2') img.setBackgroundImage('extension/祖安武将/cover/cover_10huoshan.png');     
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='3') img.setBackgroundImage('extension/祖安武将/cover/cover_Hhuoshan.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='4') img.setBackgroundImage('extension/祖安武将/cover/cover_Shuoshan.png');      
                    }
                    img.style.opacity=lib.config.zuancoveropacity;
                    img.style.width='100%';
                    img.style.height='100%';
                    img.style.backgroundSize='cover';
                    img.style.zIndex=window.zuancoverindex;
                    img.style.opacity=0;//'translateY(-200px)'
                    player.node.avatar.appendChild(img);
                    ui.refresh(img);
                    img.style.opacity=1;//transform='';
                },player)
            }
            if(player.countCards('j',{name:'hongshui'})){
                game.broadcastAll(function(player){
                    img = document.createElement('div');
            if(parseFloat(lib.config['extension_祖安设置_newui'])!='0') {   
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='1') img.setBackgroundImage('extension/祖安武将/cover/cover_hongshui.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='2') img.setBackgroundImage('extension/祖安武将/cover/cover_10hongshui.png');     
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='3') img.setBackgroundImage('extension/祖安武将/cover/cover_Hhongshui.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='4') img.setBackgroundImage('extension/祖安武将/cover/cover_Shongshui.png');      
                    }
                    img.style.opacity=lib.config.zuancoveropacity;
                    img.style.width='100%';
                    img.style.height='100%';
                    img.style.backgroundSize='cover';
                    img.style.zIndex=window.zuancoverindex;
                    img.style.opacity=0;//'translateY(-200px)'
                    player.node.avatar.appendChild(img);
                    ui.refresh(img);
                    img.style.opacity=1;//transform='';
                },player)
            }
            if(player.countCards('j',{name:'fulei'})){
                game.broadcastAll(function(player){
                    img = document.createElement('div');
            if(parseFloat(lib.config['extension_祖安设置_newui'])!='0') {   
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='1') img.setBackgroundImage('extension/祖安武将/cover/cover_fulei.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='2') img.setBackgroundImage('extension/祖安武将/cover/cover_10fulei.png');     
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='3') img.setBackgroundImage('extension/祖安武将/cover/cover_Hfulei.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='4') img.setBackgroundImage('extension/祖安武将/cover/cover_Sfulei.png');      
                    }
                    img.style.opacity=lib.config.zuancoveropacity;
                    img.style.width='100%';
                    img.style.height='100%';
                    img.style.backgroundSize='cover';
                    img.style.zIndex=window.zuancoverindex;
                    img.style.opacity=0;//'translateY(-200px)'
                    player.node.avatar.appendChild(img);
                    ui.refresh(img);
                    img.style.opacity=1;//transform='';
                },player)
            }
            if(player.countCards('j',{name:'shandian'})){
                game.broadcastAll(function(player){
                    img = document.createElement('div');
            if(parseFloat(lib.config['extension_祖安设置_newui'])!='0') {   
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='1') img.setBackgroundImage('extension/祖安武将/cover/cover_shandian.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='2') img.setBackgroundImage('extension/祖安武将/cover/cover_10shandian.png');     
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='3') img.setBackgroundImage('extension/祖安武将/cover/cover_Hshandian.png');      
            if(parseFloat(lib.config['extension_祖安设置_newui'])=='4') img.setBackgroundImage('extension/祖安武将/cover/cover_Sshandian.png');      
                    }
                    img.style.opacity=lib.config.zuancoveropacity;
                    img.style.width='100%';
                    img.style.height='100%';
                    img.style.backgroundSize='cover';
                    img.style.zIndex=window.zuancoverindex;
                    img.style.opacity=0;//'translateY(-200px)'
                    player.node.avatar.appendChild(img);
                    ui.refresh(img);
                    img.style.opacity=1;//transform='';
                },player)
            }
        },
    }  

*/

            if (lib.config['extension_祖安设置_shenst']) {
                //神将增强！
                //神吕布
                lib.translate['baonu_info'] = '锁定技，游戏开始时，你获得2枚“暴怒”标记；锁定技，准备阶段，或当你造成/受到1点伤害后，你获得1枚“暴怒”标记。';
                if (lib.skill['baonu']) {
                    lib.skill['baonu'].subSkill = {
                        phase: {
                            audio: 'baonu',
                            trigger: {
                                player: ["phaseZhunbeiBegin"],
                            },
                            forced: true,
                            filter: function(event) {
                                return true;
                            },
                            content: function() {
                                player.addMark('baonu');
                            },
                            "_priority": 0,
                        },
                    };
                    lib.skill['baonu'].group = ['baonu_phase'];
                }
                if (lib.skill['wumou']) {
                    lib.translate['wumou_info'] = '锁定技，结束阶段，若你于本回合的出牌阶段内使用过普通锦囊牌，你选择一项：1.弃置1枚“暴怒”标记；2.失去1点体力。';
                    lib.skill['wumou'] = {
                        audio: 2,
                        trigger: {
                            player: "phaseJieshuBegin",
                        },
                        forced: true,
                        filter: function(event, player) {
                            if (player.getHistory('skipped').contains('phaseUse')) return false;
                            var history = player.getHistory('useCard');
                            var next = false;
                            for (var i = 0; i < history.length; i++) {
                                if (get.type(history[i].card) == 'trick' && history[i].isPhaseUsing()) next = true;
                            }
                            return next;
                        },
                        content: function() {
                            'step 0';
                            if (player.hasMark('baonu')) {
                                player.chooseControlList(['移去一枚【暴怒】标记', '失去1点体力'], true).set('ai',
                                function(event, player) {
                                    if (get.effect(player, {
                                        name: 'losehp'
                                    },
                                    player, player) >= 0) return 1;
                                    if (player.storage.baonu > 6) return 0;
                                    if (player.hp + player.num('h', 'tao') > 3) return 1;
                                    return 0;
                                });
                            } else {
                                player.loseHp(); {
                                    if (event && event.finish) {
                                        event.finish();
                                    } else {
                                        return;
                                    }
                                }
                            }
                            'step 1';
                            if (result.index == 0) {
                                player.removeMark('baonu', 1);
                            } else {
                                player.loseHp();
                            }
                        },
                        ai: {
                            effect: {
                                "player_use": function(card, player) {
                                    if (_status.currentPhase && _status.currentPhase == player && _status.event.name == 'phaseUse' && !lib.skill['wumou'].filter(_status.event, player)) {
                                        if (get.type(card) == 'trick' && get.value(card) < 6) {
                                            return [0, -2];
                                        }
                                    }
                                },
                            },
                        },
                        "_priority": 0,
                    }
                }
                if (lib.skill['ol_wuqian']) {
                    lib.translate['ol_wuqian_info'] = '出牌阶段限一次，你可以弃置2枚“暴怒”标记并选择一名本回合内未选择过的其他角色，你获得技能〖无双〗并视为使用一张不计次数的【酒】，然后令其防具无效直到回合结束。';
                    lib.skill['ol_wuqian'].usable = 1;
                    lib.skill['ol_wuqian'].content = function() {
                        player.removeMark('baonu', 2);
                        player.chooseUseTarget({
                            name: 'jiu'
                        },
                        true, false, 'noTargetDelay', 'nodelayx');
                        player.addTempSkill('wushuang');
                        player.storage.ol_wuqian_target = target;
                        player.addTempSkill('ol_wuqian_target');
                        target.addTempSkill('ol_wuqian_targeted');
                    };
                    lib.skill['ol_wuqian'].filter = function(event, player) {
                        return player.countMark('baonu') >= 2;
                    };
                    lib.skill['ol_wuqian'].ai = {
                        order: 13,
                        result: {
                            target: function(player, target) {
                                //if(target.getEquip('bagua')||target.getEquip('rewrite_bagua')) return 0;
                                var hs = player.countCards('hs',
                                function(card) {
                                    return ['sha', 'juedou'].contains(card.name) && player.canUse(card, target) && get.effect(target, card, player, player) > 0;
                                });
                                var ts = target.countCards('hs',
                                function(card) {
                                    return card.name == 'shan';
                                });
                                if (hs >= 1 && ts < 2
                                /*&&target.hp>player.getStat('skill').ol_wuqian*/
                                ) return - 1;
                                return 0;
                            },
                        },
                    };
                }
                //神曹操
                if (lib.character['shen_caocao']) {
                    lib.character['shen_caocao'][3].add('ssr_zhujiu');
                }
                if (lib.skill['new_guixin']) {
                    lib.translate["new_guixin_info"] = "当你受到1点伤害后，你可以按照你选择的区域优先度随机获得每名其他角色区域里的一张牌，然后若你因此获得的牌多于2张，则你翻面。";
                    lib.skill['new_guixin'] = {
                        audio: "guixin",
                        trigger: {
                            player: "damageEnd",
                        },
                        check: function(event, player) {
                            if (player.isTurnedOver() || event.num > 1) return true;
                            var num = game.countPlayer(function(current) {
                                if (current.countCards('he') && current != player && get.attitude(player, current) <= 0) {
                                    return true;
                                }
                                if (current.countCards('j') && current != player && get.attitude(player, current) > 0) {
                                    return true;
                                }
                            });
                            return true;
                            //return num>=2;
                        },
                        content: function() {
                            "step 0";
                            var targets = game.filterPlayer();
                            targets.remove(player);
                            targets.sort(lib.sort.seat);
                            event.targets = targets;
                            event.count = trigger.num;
                            "step 1";
                            event.gains = 0;
                            event.num = 0;
                            player.line(targets, 'green');
                            player.chooseControl('手牌区', '装备区', '判定区').set('ai',
                            function() {
                                if (game.hasPlayer(function(current) {
                                    return current.countCards('j') && current != player && get.attitude(player, current) > 0;
                                })) return 2;
                                return Math.floor(Math.random() * 3);
                            }).set('prompt', '请选择优先获得的区域');
                            "step 2";
                            event.range = {手牌区: ['h', 'e', 'j'],
                                装备区: ['e', 'h', 'j'],
                                判定区: ['j', 'h', 'e'],
                            } [result.control || '手牌区'];
                            "step 3";
                            if (num < event.targets.length) {
                                var target = event.targets[num];
                                var range = event.range;
                                for (var i = 0; i < range.length; i++) {
                                    var cards = target.getCards(range[i]);
                                    if (cards.length) {
                                        var card = cards.randomGet();
                                        player.gain(card, target, 'giveAuto', 'bySelf');
                                        event.gains++;
                                        break;
                                    }
                                }
                                event.num++;
                            }
                            "step 4";
                            if (num < event.targets.length) event.goto(3);
                            "step 5";
                            if (event.gains > 2) player.turnOver();
                            "step 6";
                            event.count--;
                            if (event.count && player.hasSkill('new_guixin')) {
                                player.chooseBool(get.prompt2('new_guixin')).ai = function() {
                                    return lib.skill.new_guixin.check({
                                        num: event.count
                                    },
                                    player);
                                };
                            } else {
                                event.finish();
                            }
                            "step 7";
                            if (event.count && result.bool) {
                                player.logSkill('new_guixin');
                                event.goto(1);
                            }
                        },
                        ai: {
                            maixie: true,
                            "maixie_hp": true,
                            threaten: function(player, target) {
                                if (target.hp == 1) return 2.5;
                                return 1;
                            },
                            effect: {
                                target: function(card, player, target) {
                                    if (get.tag(card, 'damage')) {
                                        if (player.hasSkillTag('jueqing', false, target)) return [1, -2];
                                        if (target.hp == 1) return 0.8;
                                        if (target.isTurnedOver()) return [0, 3];
                                        var num = game.countPlayer(function(current) {
                                            if (current.countCards('he') && current != player && get.attitude(player, current) <= 0) {
                                                return true;
                                            }
                                            if (current.countCards('j') && current != player && get.attitude(player, current) > 0) {
                                                return true;
                                            }
                                        });
                                        if (num > 2) return [0, 1];
                                        if (num == 2) return [0.5, 1];
                                    }
                                },
                            },
                        },
                    };
                }
                //神诸葛亮
                if (lib.character['shen_zhugeliang']) {
                    lib.character['shen_zhugeliang'][3].add('ssr_jilei');
                }
                if (lib.skill['kuangfeng']) {
                    lib.translate['kuangfeng_info'] = '结束阶段，你可以弃置1张“星”并指定1名角色：该角色随机弃置2张牌（不足2张则改为失去1点体力），然后直到你的下个回合开始，该角色受到火焰伤害时，此伤害+1。';
                    lib.skill['kuangfeng'].content = function() {
                        "step 0";
                        player.chooseTarget(get.prompt('kuangfeng'), '令一名角色失去两张牌并获得“狂风”标记').ai = function(target) {
                            return - 1;
                        }
                        "step 1";
                        if (result.bool) {
                            var length = result.targets.length;
                            for (var i = 0; i < length; i++) {
                                var him = result.targets[i];
                                var he = him.getCards('he',
                                function(card) {
                                    return lib.filter.cardDiscardable(card, player);
                                });
                                if (he.length >= 2) him.discard(he.randomGets(2));
                                else him.loseHp();
                                result.targets[i].addSkill('kuangfeng2');
                            }
                            player.logSkill('kuangfeng', result.targets, 'fire');
                            player.chooseCardButton('弃置' + get.cnNumber(length) + '枚星', length, player.getExpansions('qixing'), true);
                            player.addSkill('dawu3');
                        } else {
                            {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                        }
                        "step 2";
                        player.loseToDiscardpile(result.links);
                    };
                }
                if (lib.skill['dawu'] && lib.skill['dawu2']) {
                    lib.translate['dawu_info'] = '结束阶段，你可以弃置X张“星”并指定等量的角色：直到你的下回合开始，这些角色判定牌效果反转，不能成为【过河拆桥】或【顺手牵羊】的目标，且当其受到非雷电伤害时，防止此伤害。';
                    lib.skill['dawu2'].mod = {
                        /*maxHandcard:function(player,num){
                            return num+2;
                        },*/
                        targetEnabled: function(card, player, target, now) {
                            if (card.name == 'shunshou' || card.name == 'guohe') return false;
                        },
                        judge: function(player, result) {
                            if (_status.event.type == 'phase') {
                                if (result.bool == false) {
                                    result.bool = null;
                                } else {
                                    result.bool = false;
                                }
                            }
                        },
                    };
                    lib.skill['dawu'].content = function() {
                        "step 0";
                        var num = Math.min(game.countPlayer(), player.getExpansions('qixing').length);
                        player.chooseTarget(get.prompt('dawu'), '令至多' + get.cnNumber(num) + '名角色获得“大雾”标记', [1, num]).set('ai',
                        function(target) {
                            if (target.isMin()) return 0;
                            if (target.hasSkill('biantian2')) return 0;
                            var att = get.attitude(player, target);
                            if (game.hasPlayer(function(current) {
                                return current.hasJudge('shandian') || current.hasJudge('huoshan');
                            })) return get.damageEffect(target, _status.event.player, _status.event.player, 'thunder');
                            if (att >= 4) {
                                if (_status.event.allUse) return att;
                                if (target.hp == 1) return att;
                                if (target.hp == 2 && target.countCards('he') <= 2) return att * 0.7;
                                return 0;
                            }
                            return - 1;
                        }).set('allUse', player.getExpansions('qixing').length >= game.countPlayer(function(current) {
                            return get.attitude(player, current) > 4;
                        }) * 2);
                        "step 1";
                        if (result.bool) {
                            player.logSkill('dawu', result.targets, 'thunder');
                            var length = result.targets.length;
                            for (var i = 0; i < length; i++) {
                                result.targets[i].addSkill('dawu2');
                            }
                            player.chooseCardButton('选择弃置' + get.cnNumber(length) + '张“星”', length, player.getExpansions('qixing'), true);
                            player.addSkill('dawu3');
                        } else {
                            {
                                if (event && event.finish) {
                                    event.finish();
                                } else {
                                    return;
                                }
                            }
                        }
                        "step 2";
                        player.loseToDiscardpile(result.links);
                    };
                }
                //神周瑜
                if (lib.character['shen_zhouyu']) {
                    lib.character['shen_zhouyu'][3].add('ssr_anhun');
                }
                if (lib.skill['qinyin']) {
                    lib.translate['qinyin_info'] = '一名角色的回合结束阶段，若此时你拥有“幽弦”的数量与本回合开始时相差不小于2，则你可以选择一项：1.令所有角色各回复1点体力；2.令所有角色各失去1点体力。';
                    lib.skill['qinyin'].group = ['qinyin_begin'];
                    lib.skill['qinyin'].trigger = {
                        global: "phaseJieshuBegin",
                    };
                    lib.skill['qinyin'].filter = function(event, player) {
                        /*var cards=[];
            player.getHistory('lose',function(evt){
                if(evt.type=='discard'&&evt.getParent('phaseDiscard')==event) cards.addArray(evt.cards2);
            });
            return cards.length>0;*/
                        var num = player.storage.ssr_anhun_num ? player.storage.ssr_anhun_num: 0;
                        return Math.abs(num - player.countMark('ssr_anhun')) >= 2;
                    };
                    lib.skill['qinyin'].subSkill = {
                        begin: {
                            trigger: {
                                global: ['phaseBegin'],
                            },
                            direct: true,
                            firstDo: true,
                            forced: true,
                            silent: true,
                            content: function() {
                                player.storage.ssr_anhun_num = player.countMark('ssr_anhun');
                            },
                            "_priority": 0,
                        },
                    };
                }
                //神赵云
                if (lib.skill['relonghun'] && lib.skill['relonghun'].subSkill) {
                    if (lib.skill['relonghun'].subSkill.num) lib.skill['relonghun'].subSkill.num.firstDo = true;
                    if (lib.skill['relonghun'].subSkill.discard) lib.skill['relonghun'].subSkill.discard.firstDo = true;
                }
                if (lib.skill['xinjuejing']) {
                    lib.translate['xinjuejing_info'] = '蓄力技（7/7）。锁定技，①你的手牌上限+2；②一名角色的回合结束时，若其于本回合内使用或打出过【杀】且没有造成过伤害，则你获得1点蓄力值；②每回合限一次，当你进入濒死状态时，你消耗1点蓄力值，然后若此时为你的回合，你摸1张牌，否则你摸2张牌；④当你使用、打出基本牌或【无懈可击】时，若你的体力值不大于1，你消耗1点蓄力值，你摸X张牌（X为此牌所对应实体牌的数量）。';
                    lib.skill['xinjuejing'].trigger = {
                        player: ["dying"],
                    };
                    lib.skill['xinjuejing'].usable = 1;
                    lib.skill['xinjuejing'].content = function() {
                        if (player.hasMark('charge')) {
                            var num = 2;
                            if (_status.currentPhase && _status.currentPhase == player) num = 1;
                            player.draw(num);
                            player.removeMark('charge', 1);
                        }
                    };
                    lib.skill['xinjuejing'].subSkill = {
                        use: {
                            trigger: {
                                player: ['useCard', 'respond'],
                            },
                            filter: function(event, player) {
                                return player.hasMark('charge') && (event.card && event.card.name && (get.type(event.card) == 'basic' || event.card.name == 'wuxie') && event.cards && get.itemtype(event.cards) == 'cards' && event.cards.length && player.getHp() <= 1);
                            },
                            chargeSkill: true,
                            forced: true,
                            content: function() {
                                player.removeMark('charge', 1);
                                var num = trigger.cards.length;
                                player.draw(num);
                            },
                            "_priority": 0,
                        },
                        charge: {
                            trigger: {
                                global: ["phaseBefore", "phaseEnd"],
                                player: "enterGame",
                            },
                            forced: true,
                            filter: function(event, player, name) {
                                if (player.countMark('charge') > 6) return false;
                                if (game.phaseNumber == 0) return true;
                                if (name != 'phaseBefore') {
                                    //if(event.player.getHistory('skipped').contains('phase')) return true;
                                    if (event.player.getStat('damage')) return false;
                                    var history = event.player.getHistory('useCard').concat(event.player.getHistory('respond'));
                                    for (var i = 0; i < history.length; i++) {
                                        if (history[i].card.name == 'sha') return true;
                                    }
                                }
                                return false;
                            },
                            content: function() {
                                if (game.phaseNumber == 0) {
                                    if (player.countMark('charge') < 7) player.addMark('charge', 7 - player.countMark('charge'));
                                } else {
                                    player.addMark('charge', 1);
                                }
                            },
                            sub: true,
                            parentskill: "xinjuejing",
                            "_priority": 0,
                        },
                    };
                    lib.skill['xinjuejing'].group = ['xinjuejing_use', 'xinjuejing_charge'];
                }
                if (lib.character['shen_zhaoyun']) {
                    lib.character['shen_zhaoyun'][3].add('ssr_fuzhen');
                }
                //神司马懿
                if (lib.skill['renjie']) {
                    lib.translate['renjie_info'] = '锁定技，准备阶段，或当你受到1点伤害后，你获得一枚“忍”标记；锁定技，当你于弃牌阶段内弃置牌后，你获得等同于失去的牌的数量的“忍”标记。';
                    lib.skill['renjie'].subSkill = {
                        phase: {
                            audio: 'renjie2',
                            firstDo: true,
                            trigger: {
                                player: ["phaseZhunbeiBegin"],
                            },
                            forced: true,
                            filter: function(event) {
                                return true;
                            },
                            content: function() {
                                player.addMark('renjie');
                            },
                            "_priority": 0,
                        },
                    };
                    lib.skill['renjie'].group = ['renjie2', 'renjie_phase'];
                }
                /*if(lib.skill['renjie2']) {
        lib.skill['renjie2'].filter=function(event,player){
            if(event.type!='discard'||event.getlx===false) return false;
            var evt=event.getParent('phaseDiscard'),evt2=event.getl(player);
            return evt2&&((evt&&evt.name=='phaseDiscard')||player!=_status.currentPhase)&&evt.player==player&&evt2.cards2&&evt2.cards2.length>0;
        };
    }*/
                if (lib.skill['jilue']) {
                    lib.translate['jilue_info'] = '当一名角色的判定牌生效前，你可以弃1枚“忍”标记并发动〖鬼才〗；每当你受到伤害后，你可以弃1枚“忍”标记并发动〖放逐〗；当你使用锦囊牌时，你可以弃1枚“忍”标记并发动〖集智〗；出牌阶段限一次，你可以弃1枚“忍”标记并发动〖制衡〗；出牌阶段，你可以弃1枚“忍”标记并获得〖完杀〗直到回合结束；限定技，出牌阶段，你可以弃2枚“忍”标记并发动〖雄志〗。';
                    if (!lib.skill['jilue'].subSkill) lib.skill['jilue'].subSkill = {};
                    if (lib.skill['jilue'].group) lib.skill['jilue'].group.add('jilue_xiongzhi');
                    if (lib.skill['sbaiyin']) lib.skill['sbaiyin'].derivation = ['jilue', 'guicai', 'fangzhu', 'rejizhi', 'rezhiheng', 'xiongzhi'];
                    if (lib.skill['jilue'].subSkill) {
                        lib.translate['jilue_xiongzhi'] = '雄志';
                        lib.skill['jilue'].subSkill.xiongzhi = {
                            audio: 2,
                            enable: "phaseUse",
                            limited: true,
                            skillAnimation: true,
                            animationColor: "thunder",
                            filter: function(event, player) {
                                if (player.storage.jilue_xiongzhi) return false;
                                return player.countMark('renjie') >= 2;
                            },
                            content: function() {
                                'step 0';
                                player.removeMark('renjie', 2);
                                player.awakenSkill('jilue_xiongzhi');
                                event.least = 3;
                                'step 1';
                                var card = get.cards()[0];
                                event.card = card;
                                if (!player.hasUseTarget(card) && event.least > 0) {
                                    event.redo();
                                } else {
                                    player.showCards(card);
                                    if (!player.hasUseTarget(card)) {
                                        card.fix();
                                        ui.cardPile.insertBefore(card, ui.cardPile.firstChild);
                                        game.updateRoundNumber(); {
                                            if (event && event.finish) {
                                                event.finish();
                                            } else {
                                                return;
                                            }
                                        }
                                    }
                                }
                                'step 2';
                                event.least--;
                                var next = player.chooseUseTarget(card, true);
                                if (get.info(card).updateUsable == 'phaseUse') next.addCount = false;
                                'step 3';
                                if (result.bool) event.goto(1);
                                else {
                                    card.fix();
                                    ui.cardPile.insertBefore(card, ui.cardPile.firstChild);
                                    game.updateRoundNumber();
                                }
                            },
                            ai: {
                                order: 7,
                                result: {
                                    player: function(player) {
                                        //if(!player.hasSkill('smyyingshi')) return 1;
                                        var cards = [];
                                        for (var i = 0; i < Math.min(2, player.maxHp); i++) {
                                            var card = ui.cardPile.childNodes[i];
                                            if (card) {
                                                if (!player.hasValueTarget(card)) return 0;
                                            } else break;
                                        }
                                        return 1;
                                    },
                                },
                            },
                            mark: true,
                            intro: {
                                content: "limited",
                            },
                            init: (player, skill) =>player.storage[skill] = false,
                            "_priority": 0,
                        };
                    }
                }
                //神吕蒙
                if (lib.character['shen_lvmeng']) {
                    lib.character['shen_lvmeng'][3].add('ssr_baiyi');
                }
                if (lib.skill['gongxin']) {
                    lib.translate['gongxin_info'] = '出牌阶段限两次，你可以观看一名其他角色的手牌，并可以展示其中一张红桃牌：若如此做，你可以选择获得此牌或令该角色不能使用或打出红色的牌直到你的下个回合开始或你死亡后（每名角色各限一次）。';
                    lib.skill['gongxin'] = {
                        audio: 2,
                        audioname: ["re_lvmeng", "gexuan"],
                        enable: "phaseUse",
                        usable: 2,
                        filterTarget: function(card, player, target) {
                            return target != player && target.countCards('h') && !target.hasSkill('gongxin_temp');
                        },
                        content: function() {
                            'step 0';
                            target.addTempSkill('gongxin_temp');
                            var cards = target.getCards('h');
                            player.chooseButton(2, ['攻心', cards, [['获得此牌', '封印红牌'], 'tdnodes'], ]).set('filterButton',
                            function(button) {
                                var type = typeof button.link;
                                if (ui.selected.buttons.length && type == typeof ui.selected.buttons[0].link) return false;
                                return type == 'string' || get.suit(button.link) == 'heart';
                            });
                            'step 1';
                            if (result.bool) {
                                if (typeof result.links[0] != 'string') result.links.reverse();
                                var card = result.links[1],
                                choice = result.links[0];
                                /*if(choice=='弃置此牌') target.discard(card);
                    else{
                        player.showCards(card,get.translation(player)+'对'+get.translation(target)+'发动了【攻心】');
                        target.lose(card,ui.cardPile,'visible','insert');
                    }*/
                                player.showCards(card, get.translation(player) + '对' + get.translation(target) + '发动了【攻心】');
                                if (choice == '获得此牌') {
                                    player.gain(card, target, 'giveAuto', 'bySelf');
                                } else {
                                    target.storage.ssr_gongxin_break = player;
                                    target.addSkill('ssr_gongxin_break');
                                }
                            }
                        },
                        ai: {
                            threaten: 1.5,
                            result: {
                                target: function(player, target) {
                                    return - target.countCards('h');
                                },
                            },
                            order: 10,
                            expose: 0.4,
                        },
                        subSkill: {
                            temp: {},
                        },
                        "_priority": 0,
                    };
                }
                //神关羽
                if (lib.skill['wushen']) {
                    lib.translate['wushen_info'] = '锁定技，①你的红桃手牌均视为【杀】；②你使用红桃【杀】无距离和次数限制且不可被响应；③你的【杀】对其他角色造成伤害后，你令该角色获得一枚“梦魇”标记。';
                    lib.skill['wushen'].subSkill = {
                        damage: {
                            trigger: {
                                source: "damageSource",
                            },
                            filter: function(event, player) {
                                return event.card && event.card.name == 'sha' && event.player && event.player != player;
                            },
                            forced: true,
                            logTarget: "player",
                            content: function() {
                                trigger.player.addSkill('new_wuhun_mark');
                                trigger.player.addMark('new_wuhun_mark');
                            },
                            "_priority": 0,
                        },
                    };
                    lib.skill['wushen'].group = ['wushen_damage'];
                }
                if (lib.skill['new_wuhun']) {
                    lib.translate['new_wuhun_info'] = '锁定技，①游戏开始时，你废除你的判定区；②当你受到其他角色造成的伤害后，伤害来源获得X个“梦魇”标记（X为伤害点数）；④拥有“梦魇”标记的角色手牌上限-Y，结束阶段若场上没有其他拥有此技能的角色，则其移除一枚“梦魇”标记（Y为该角色拥有“梦魇”标记的数量）；③当你死亡时，你选择一名“梦魇”标记数量最多的其他角色。该角色进行判定：若判定结果不为【桃】或【桃园结义】，则该角色死亡。';
                    lib.skill['new_wuhun'].content = function() {
                        trigger.source.addSkill('new_wuhun_mark');
                        trigger.source.addMark('new_wuhun_mark', trigger.num);
                    };
                    lib.skill['new_wuhun'].filter = function(event, player) {
                        return event.source != undefined && event.source != player;
                    };
                    lib.skill['new_wuhun'].subSkill.judge = {
                        trigger: {
                            player: ["enterGame"],
                            global: "phaseBefore",
                        },
                        forced: true,
                        filter: function(event) {
                            return (event.name != 'phase' || game.phaseNumber == 0);
                        },
                        content: function() {
                            player.disableJudge();
                        },
                    };
                    lib.skill['new_wuhun'].group.add('new_wuhun_judge');
                    lib.skill['new_wuhun'].subSkill.mark = {
                        marktext: "梦魇",
                        intro: {
                            name: "梦魇",
                            content: "mark",
                        },
                        sub: true,
                        mod: {
                            maxHandcard: function(player, num) {
                                return num - player.countMark('new_wuhun_mark');
                            },
                        },
                        trigger: {
                            player: "phaseJieshuBegin",
                        },
                        filter: function(event, player) {
                            return game.countPlayer(function(current) {
                                if (player != current && current.hasSkill('new_wuhun')) return true;
                            }) < 1;
                        },
                        forced: true,
                        direct: true,
                        content: function() {
                            'step 0';
                            player.removeMark('new_wuhun_mark');
                            'step 1';
                            if (player.countMark('new_wuhun_mark') < 1) player.removeSkill('new_wuhun_mark');
                        },
                    };

                }
                //神刘备
                if (lib.skill['g_nzry_jieying']) {
                    lib.translate["nzry_jieying_info"] = "锁定技，游戏开始时或当你的武将牌重置时，你横置；所有已横置的角色手牌上限+2，受到非属性伤害时摸2张牌；结束阶段，你横置一名其他角色。";
                    lib.translate["g_nzry_jieying"] = "结营";
                    lib.skill["g_nzry_jieying"] = {
                        preHidden: true,
                        forced: true,
                        trigger: {
                            player: "damage",
                        },
                        filter: function(event, player) {
                            return game.countPlayer(function(current) {
                                return current.hasSkill('nzry_jieying')
                            }) > 0 && player.isLinked() && !event.nature;
                        },
                        content: function() {
                            player.draw(2);
                        },
                        ai: {
                            maixie: true,
                            "maixie_hp": true,
                            effect: {
                                target: function(card, player, target) {
                                    if (player.hasSkillTag('jueqing', false, target)) return [1, -1];
                                    if (get.tag(card, 'damage')) return [1, 0.55];
                                },
                            },
                        },
                        "_priority": 0,
                        mod: {
                            maxHandcard: function(player, num) {
                                if (game.countPlayer(function(current) {
                                    return current.hasSkill('nzry_jieying')
                                }) > 0 && player.isLinked()) return num + 2;
                            },
                        },
                    };
                }
                if (lib.skill['nzry_longnu']) {
                    lib.translate["nzry_longnu_info"] = "转换技，锁定技，阴：出牌阶段开始时，若你的体力值为满，则你失去1点体力，之后你摸一张牌，然后本阶段内你的红色手牌均视为火【杀】且无距离限制且不可被响应。阳：出牌阶段开始时，若你的体力上限大于1，则你减1点体力上限，之后你摸一张牌，然后本阶段内你的锦囊牌均视为雷【杀】且无使用次数限制。";
                    lib.skill['nzry_longnu'].intro = {
                        content: function(storage, player, skill) {
                            if (player.storage.nzry_longnu != true) return '锁定技，出牌阶段开始时，若你的体力上限大于1，则你减1点体力上限，之后你摸一张牌，然后本阶段内你的锦囊牌均视为雷杀且无使用次数限制';
                            return '锁定技，出牌阶段开始时，若你的体力值为满，则你失去1点体力，之后你摸一张牌，然后本阶段内你的红色手牌均视为火杀且无距离限制且不可被响应';
                        },
                    };
                    lib.skill['nzry_longnu'].content = function() {
                        'step 0';
                        player.changeZhuanhuanji('nzry_longnu');
                        if (player.storage.nzry_longnu != true) {
                            if (player.maxHp > 1) player.loseMaxHp();
                        } else {
                            if (!player.getDamagedHp()) player.loseHp();
                        }
                        player.draw();
                        'step 1';
                        if (player.storage.nzry_longnu != true) {
                            player.addTempSkill('nzry_longnu_2', 'phaseUseAfter');
                        } else {
                            player.addTempSkill('nzry_longnu_1', 'phaseUseAfter');
                        };
                    };
                    if (lib.skill['nzry_longnu'].subSkill) lib.skill['nzry_longnu'].subSkill['1'] = {
                        trigger: {
                            player: "useCard",
                        },
                        forced: true,
                        filter: function(event, player) {
                            return event.card.name == 'sha' && get.color(event.card) == 'red';
                        },
                        content: function() {
                            trigger.directHit.addArray(game.players);
                        },
                        ai: {
                            effect: {
                                target: function(card, player, target, current) {
                                    if (get.tag(card, 'respondSha') && current < 0) return 0.6
                                },
                            },
                            "directHit_ai": true,
                            skillTagFilter: function(player, tag, arg) {
                                return arg.card.name == 'sha' && get.color(arg.card) == 'red';
                            },
                        },
                        mod: {
                            cardname: function(card, player) {
                                if (get.color(card) == 'red') return 'sha';
                            },
                            cardnature: function(card, player) {
                                if (get.color(card) == 'red') return 'fire';
                            },
                            targetInRange: function(card) {
                                if (get.color(card) == 'red') return true;
                            },
                        },
                    };
                }
                //神甘宁
                if (lib.skill['drlt_jieying']) {
                    lib.translate["drlt_jieying_info"] = "当你没有“营”标记时，你可以将一张黑色的牌当【趁火打劫】使用；回合开始时，若场上没有拥有“营”标记的角色，你获得1个“营”标记；结束阶段，你可以将你的一个“营”标记交给一名角色；有“营”标记的角色摸牌阶段多摸一张牌，出牌阶段使用【杀】的次数上限+1，手牌上限+1。有“营”的其他角色回合结束时，其移去“营”标记，然后你可以获得其所有手牌。";
                    if (lib.skill['drlt_jieying'].subSkill) {
                        lib.skill['drlt_jieying'].derivation = ['chenhuodajie'];
                        if (lib.skill['drlt_jieying'].group) lib.skill['drlt_jieying'].group.add("drlt_jieying_dajie");
                        //保证【趁火打劫】能用
                        if (!lib.config.cards.contains('yunchou')) {
                            lib.skill['drlt_jieying'].global = ['g_chenhuodajie', 'drlt_jieying_mark'];
                            lib.skill['g_chenhuodajie'] = {
                                trigger: {
                                    global: 'damageEnd'
                                },
                                direct: true,
                                filter: function(event, player) {
                                    if (event.player == player) return false;
                                    if (!event.player.countCards('he')) return false;
                                    if (!lib.filter.targetEnabled({
                                        name: 'chenhuodajie'
                                    },
                                    player, event.player)) return false;
                                    if (event._notrigger.contains(event.player)) return false;
                                    return player.hasUsableCard('chenhuodajie');
                                },
                                content: function() {
                                    player.chooseToUse(get.prompt('chenhuodajie', trigger.player).replace(/发动/, '使用'),
                                    function(card, player) {
                                        if (card.name != 'chenhuodajie') return false;
                                        return lib.filter.cardEnabled(card, player, 'forceEnable');
                                    },
                                    trigger.player, -1).targetRequired = true;
                                }
                            };
                        }
                        lib.skill['drlt_jieying'].subSkill['dajie'] = {
                            audio: 'gnjinfan',
                            enable: "chooseToUse",
                            filterCard: function(card) {
                                return get.color(card) == 'black';
                            },
                            position: "hes",
                            viewAs: {
                                name: "chenhuodajie",
                            },
                            viewAsFilter: function(player) {
                                if (player.hasMark('drlt_jieying_mark')) return false;
                                if (!player.countCards('hes', {
                                    color: 'black'
                                })) return false;
                                return true;
                            },
                            prompt: "将一张黑色牌当趁火打劫使用",
                            check: function(card) {
                                return 6 - get.value(card)
                            },
                            ai: {
                                basic: {
                                    order: 1,
                                    useful: 6,
                                    value: 6,
                                },
                                result: {
                                    target: -1,
                                },
                                tag: {
                                    loseCard: 1,
                                },
                            },
                            "_priority": 0,
                        };
                        if (lib.skill['drlt_jieying'].subSkill['2']) {
                            lib.skill['drlt_jieying'].subSkill['2'].content = function() {
                                'step 0';
                                player.chooseTarget(get.prompt('drlt_jieying'), "将“营”交给一名角色；其摸牌阶段多摸一张牌，出牌阶段使用【杀】的次数上限+1且手牌上限+1。该角色回合结束后，其移去“营”标记，然后你可以获得其所有手牌。",
                                function(card, player, target) {
                                    return target != player;
                                }).ai = function(target) {
                                    if (get.attitude(player, target) > 1) return 3.5;
                                    if (get.attitude(player, target) > 0) return 0.1;
                                    if (get.attitude(player, target) < 1 && (target.isTurnedOver() || target.countCards('h') < 1)) return 0.2;
                                    if (get.attitude(player, target) < 1 && target.countCards('h') > 0 && target.countCards('j', {
                                        name: 'lebu'
                                    }) > 0) return target.countCards('h') * 0.8 + target.getHandcardLimit() * 0.7 + 2;
                                    if (get.attitude(player, target) < 1 && target.countCards('h') > 0) return target.countCards('h') * 0.8 + target.getHandcardLimit() * 0.7;
                                    return 1;
                                };
                                'step 1';
                                if (result.bool) {
                                    var target = result.targets[0];
                                    player.line(target);
                                    player.logSkill('drlt_jieying', target);
                                    var mark = player.countMark('drlt_jieying_mark');
                                    player.removeMark('drlt_jieying_mark', mark);
                                    target.addMark('drlt_jieying_mark', mark);
                                };
                            };
                        }
                        if (lib.skill['drlt_jieying'].subSkill['3']) {
                            lib.skill['drlt_jieying'].subSkill['3'].content = function() {
                                'step 0';
                                trigger.player.removeMark('drlt_jieying_mark', trigger.player.countMark('drlt_jieying_mark'));
                                if (trigger.player.countCards('h') > 0) {
                                    if (!_status.auto && (player == game.me || player.isUnderControl())) game.waitClick(3, false, 100);
                                    player.chooseControl('确定', '取消',
                                    function() {
                                        if (window.aiClicking) return '取消';
                                        var att = get.attitude(player, trigger.player);
                                        if (att < 1) {
                                            return '确定';
                                        };
                                        return '取消';
                                    }).set('prompt', '是否获得' + get.translation(trigger.player) + '的所有手牌？');
                                } else {
                                    {
                                        if (event && event.finish) {
                                            event.finish();
                                        } else {
                                            return;
                                        }
                                    }
                                }
                                'step 1';
                                if (!_status.auto && (player == game.me || player.isUnderControl())) game.stopClick();
                                'step 2';
                                if (result.control == '确定') {
                                    trigger.player.give(trigger.player.getCards('h'), player);
                                }
                            };
                        }
                    }
                }
            }

        },
        precontent: function() {
            // ---------------------------------------启动代码·预加载------------------------------------------//
            if (!lib.config['extension_祖安武将_enable']) {
                game.saveConfig('extension_祖安设置_enable', false);
            }

            function resize_window(long, high) {
                // move the window to 0,0 (X,Y)
                window.moveTo(0, 0);
                // resize the window to 800x600
                window.resizeTo(long, high);
            }
            var zuancheckWH = function(width, height) {
                var widther = window.innerWidth / width;
                if (height * widther > window.innerHeight) {
                    return 'width: 100%';
                } else {
                    return 'height: 100%';
                }
            };
            var windows = localStorage.getItem("zuanwindow");
            if (windows == "1") {
                resize_window(720, 480);
            }
            if (windows == "2") {
                resize_window(800, 600);
            }
            if (windows == "3") {
                resize_window(1280, 720);
            }
            if (windows == "4") {
                resize_window(1440, 960);
            }
            if (windows == "5") {
                resize_window(1600, 1200);
            }
            if (windows == "6") {
                resize_window(1920, 1080);
            }
            if (windows == "7") {
                resize_window(1090, 570);
            }
            if (parseFloat(lib.config['extension_祖安设置_isPC']) == '1' || windows == "7") {
                var plogo = localStorage.getItem("backgroundlogo");
                function onlinelogo() {
                    window.tlogo = ui.create.node('img');
                    tlogo.src = asset + 'extension/祖安武将/basic/online_logo.png';
                    tlogo.style.cssText = 'pointer-events: none;text-align: center;margin: auto;opacity: 1;display: block;position: absolute;background:none;z-index:99;width: 35%!important;height: 35%!important;left:3%;right:0;bottom: 70%';
                    document.body.appendChild(tlogo);
                }
                function sanguologo() {
                    window.tlogo = ui.create.node('img');
                    tlogo.src = asset + 'extension/祖安武将/basic/sanguo_logo.png';
                    tlogo.style.cssText = 'pointer-events: none;text-align: center;margin: auto;opacity: 1;display: block;position: absolute;background:none;z-index:99;width: 35%!important;height: 35%!important;left:0;right:0;bottom: 70%';
                    document.body.appendChild(tlogo);
                }
                function nonamelogo() {
                    window.tlogo = ui.create.node('img');
                    tlogo.src = asset + 'extension/祖安武将/basic/noname_logo.png';
                    tlogo.style.cssText = 'pointer-events: none;text-align: center;margin: auto;opacity: 1;display: block;position: absolute;background:none;z-index:99;width: 35%!important;height: 32%!important;left:0;right:0;bottom: 70%';
                    document.body.appendChild(tlogo);
                }
                function backgroundpapers() {
                    window.backgroundpaper = ui.create.node('img');
                    backgroundpaper.src = asset + 'extension/祖安武将/basic/backgroundpaper.png';
                    backgroundpaper.style.cssText = 'pointer-events: none;text-align: center;margin: auto;opacity: 1;display: block;position: absolute;background:none;z-index:0;width: 100%!important;height: 79%!important;left:0;right:0;bottom: 9%';
                    document.body.appendChild(backgroundpaper);
                }
                function backgroundtops() {
                    window.backgroundtop = ui.create.node('img');
                    backgroundtop.src = asset + 'extension/祖安武将/basic/backgroundtop.png';
                    backgroundtop.style.cssText = 'pointer-events: none;text-align: center;margin: auto;opacity: 1;display: block;position: absolute;background:none;z-index:90;width: 100%!important;height: 79%!important;left:0;right:0;bottom: 9%';
                    document.body.appendChild(backgroundtop);
                }
                function backgroundtopb() {
                    window.backgroundtop = ui.create.node('img');
                    backgroundtop.src = asset + 'extension/祖安武将/basic/backgroundblack.png';
                    backgroundtop.style.cssText = 'pointer-events: none;text-align: center;margin: auto;opacity: 0.5;display: block;position: absolute;background:none;z-index:0;width: 100%!important;height: 70%!important;left:0;right:0;bottom: 15%';
                    document.body.appendChild(backgroundtop);
                }
                function underline(opa) {
                    window.backunderline = ui.create.node('img');
                    backunderline.src = asset + 'extension/祖安武将/basic/underline.png';
                    backunderline.style.cssText = 'pointer-events: none;text-align: center;margin: auto;opacity: ' + opa * 0.05 + ';display: block;position: absolute;background:none;z-index:98;width: 55%!important;height: 17%!important;left: 0%;right:0;bottom: 1%';
                    document.body.appendChild(backunderline);
                }
            } else {
                var plogo = localStorage.getItem("backgroundlogo");
                function onlinelogo() {
                    window.tlogo = ui.create.node('img');
                    tlogo.src = asset + 'extension/祖安武将/basic/online_logo.png';
                    tlogo.style.cssText = 'pointer-events: none;text-align: center;margin: auto;opacity: 1;display: block;position: absolute;background:none;z-index:99;width: 40%!important;height: 35%!important;left:5%;right:0;bottom: 65%';
                    document.body.appendChild(tlogo);
                }
                function sanguologo() {
                    window.tlogo = ui.create.node('img');
                    tlogo.src = asset + 'extension/祖安武将/basic/sanguo_logo.png';
                    tlogo.style.cssText = 'pointer-events: none;text-align: center;margin: auto;opacity: 1;display: block;position: absolute;background:none;z-index:99;width: 40%!important;height: 35%!important;left:0;right:0;bottom: 65%';
                    document.body.appendChild(tlogo);
                }
                function nonamelogo() {
                    window.tlogo = ui.create.node('img');
                    tlogo.src = asset + 'extension/祖安武将/basic/noname_logo.png';
                    tlogo.style.cssText = 'pointer-events: none;text-align: center;margin: auto;opacity: 1;display: block;position: absolute;background:none;z-index:99;width: 40%!important;height: 32%!important;left:0;right:0;bottom: 65%';
                    document.body.appendChild(tlogo);
                }
                function backgroundpapers() {
                    window.backgroundpaper = ui.create.node('img');
                    backgroundpaper.src = asset + 'extension/祖安武将/basic/backgroundpaper.png';
                    backgroundpaper.style.cssText = 'pointer-events: none;text-align: center;margin: auto;opacity: 1;display: block;position: absolute;background:none;z-index:0;width: 100%!important;height: 70%!important;left:0;right:0;bottom: 14%';
                    document.body.appendChild(backgroundpaper);
                }
                function backgroundtops() {
                    window.backgroundtop = ui.create.node('img');
                    backgroundtop.src = asset + 'extension/祖安武将/basic/backgroundtop.png';
                    backgroundtop.style.cssText = 'pointer-events: none;text-align: center;margin: auto;opacity: 1;display: block;position: absolute;background:none;z-index:90;width: 100%!important;height: 70%!important;left:0;right:0;bottom: 14%';
                    document.body.appendChild(backgroundtop);
                }
                function backgroundtopb() {
                    window.backgroundtop = ui.create.node('img');
                    backgroundtop.src = asset + 'extension/祖安武将/basic/backgroundblack.png';
                    backgroundtop.style.cssText = 'pointer-events: none;text-align: center;margin: auto;opacity: 0.5;display: block;position: absolute;background:none;z-index:0;width: 100%!important;height: 50%!important;left:0;right:0;bottom: 25%';
                    document.body.appendChild(backgroundtop);
                }
                function underline(opa) {
                    window.backunderline = ui.create.node('img');
                    backunderline.src = asset + 'extension/祖安武将/basic/underline.png';
                    backunderline.style.cssText = 'pointer-events: none;text-align: center;margin: auto;opacity: ' + opa * 0.05 + ';display: block;position: absolute;background:none;z-index:98;width: 55%!important;height: 16%!important;left: 0%;right:0;bottom: 2%';
                    document.body.appendChild(backunderline);
                }
            }
            //开始界面
            /*
                "0":"◈关闭———",
                "1":"关闭壁纸",
                "2":"◈多张———",
                "3":"原画图集",yuanhua,87
                "4":"世海壁纸",shihai,20
                "5":"羊皮画卷",yangpi,33
                "6":"◈单张———",
                "7":"青铜龙纹",qingtong
                "8":"霞光天幕",tianmu
                "9":"潭水桃花",taohua
                "10":"战火硝烟",zhanhuo
                "11":"深宫殿堂",shengong
                "12":"SCL联赛",scl
                "13":"Online",online
                    game.saveConfig('extension_祖安设置_jiemian',items);
                    localStorage.setItem("gamestartjiemian",items);
*/
            var jiemian = "1"; //localStorage.getItem("gamestartjiemian");
            if (jiemian) {
                if (jiemian == "0") jiemian = "1";
                if (jiemian == "2") jiemian = "3";
                if (jiemian == "6") jiemian = "7";
            } else {
                jiemian = "1";
            }
            if (jiemian != "1") {
                var jiemianopen = 'no';
                if (jiemian == "3") {
                    var numsum = [];
                    for (var i = 1; i < 88; i++) {
                        numsum.push(i);
                    }
                    jiemianopen = 'yuanhua/' + numsum.randomGet() + '.png';
                }
                if (jiemian == "4") {
                    var numsum = [];
                    for (var i = 1; i < 21; i++) {
                        numsum.push(i);
                    }
                    jiemianopen = 'shihai/' + numsum.randomGet() + '.jpg';
                }
                if (jiemian == "5") {
                    var numsum = [];
                    for (var i = 1; i < 34; i++) {
                        numsum.push(i);
                    }
                    jiemianopen = 'yangpi/' + numsum.randomGet() + '.jpg';
                }
                if (jiemian == "7") jiemianopen = 'qingtong.jpg';
                if (jiemian == "8") jiemianopen = 'tianmu.jpg';
                if (jiemian == "9") jiemianopen = 'taohua.jpg';
                if (jiemian == "10") jiemianopen = 'zhanhuo.jpg';
                if (jiemian == "11") jiemianopen = 'shengong.jpg';
                if (jiemian == "12") jiemianopen = 'scl.jpg';
                if (jiemian == "13") jiemianopen = 'online.png';
                //alert(jiemianopen);
                //var zuanwid=game.checkWH(zuanalivegif.width,zuanalivegif.height);
                function movebackgroundbasic() {
                    window.movepaperbasic = ui.create.node('img');
                    movepaperbasic.src = asset + 'extension/祖安武将/wallpaper/startgame/' + jiemianopen;
                    movepaperbasic.style.cssText = 'pointer-events: none;text-align: center;margin: auto;opacity: 1;display: block;position: absolute;background:none;z-index:-2;width: 100%!important;height: 100%!important;left: 0;bottom: 0';
                    document.body.appendChild(movepaperbasic);
                }
                function movebackground(s) {
                    var enlarge = 0.25;
                    window.movepaper = ui.create.node('img');
                    movepaper.src = asset + 'extension/祖安武将/wallpaper/startgame/' + jiemianopen;
                    movepaper.style.cssText = 'pointer-events: none;text-align: center;margin: auto;opacity: ' + (0.8 - s * 0.02) + ';display: block;position: absolute;background:none;z-index:-1;width: ' + (100 + s * enlarge) + '%!important;height: ' + (100 + s * enlarge) + '%!important;left: ' + ( - s * enlarge * 0.5) + '%!important;bottom: ' + ( - s * enlarge * 0.5) + '%!important';
                    document.body.appendChild(movepaper);
                }
            }
            window.forunderlinefinish = false;
            function forunderlinea(a) {
                if (forunderlinefinish) {
                    backunderline.remove();
                    return;
                } else {
                    underline(a);
                    if (a < 1) {
                        setTimeout(function() {
                            backunderline.remove();
                            forunderlineb(0);
                        },
                        200);
                    } else {
                        setTimeout(function() {
                            backunderline.remove();
                            forunderlinea(a - 1);
                        },
                        60);
                    }
                }
            }
            function forunderlineb(b) {
                if (forunderlinefinish) {
                    backunderline.remove();
                    return;
                } else {
                    underline(b);
                    if (b > 19) {
                        setTimeout(function() {
                            backunderline.remove();
                            forunderlinea(20);
                        },
                        200);
                    } else {
                        setTimeout(function() {
                            backunderline.remove();
                            forunderlineb(b + 1);
                        },
                        60);
                    }
                }
            }
            function formovepaper(i) {
                if (formovepaperfinish) {
                    movepaper.remove();
                    return;
                } else {
                    movebackground(i);
                    setTimeout(function() {
                        movepaper.remove();
                        if (i < 40) {
                            formovepaper(i + 1);
                        } else {
                            formovepaper(0);
                        }

                    },
                    50);
                }
            }
            var open = localStorage.getItem("zuanstart");
            var asset = localStorage.getItem("zuanasset");
            var happen = sessionStorage.getItem("zuanrun");
            if (open && open != "off" && !happen) {
                var openmp3 = false;
                sessionStorage.setItem("zuanrun", 'happened');
                var i = 20;
                if (open.indexOf('blackgold') != -1) {
                    var mp3 = asset + 'extension/祖安武将/audio/GameStart_blackgold.mp3';
                    //var mp3 = new Audio(mp3);
                    //mp3.play(); //播放 mp3这个音频对象
                    openmp3 = true;
                }
                if (open.indexOf('goldsand') != -1) {
                    var mp3 = asset + 'extension/祖安武将/audio/GameStart_goldsand.mp3';
                    //var mp3 = new Audio(mp3);
                    //mp3.play(); //播放 mp3这个音频对象
                    openmp3 = true;
                }
                if (open.indexOf('mutouren') != -1) {
                    var mp3 = asset + 'extension/祖安武将/audio/GameStart_mutouren.mp3';
                    //var mp3 = new Audio(mp3);
                    //mp3.play(); //播放 mp3这个音频对象
                    openmp3 = true;
                }
                if (openmp3) {
                    var mp3 = new Audio(mp3);
                    mp3.volume = lib.config.volumn_audio / 8; //mp3 的音量
                    mp3.play(); //播放 mp3这个音频对象
                    //暂停
                    //mp3.pause();
                    //mp3.load();
                }
                function clsscreen() {
                    window.scrstart = ui.create.node('img');
                    window.scrstart.src = asset + 'extension/祖安武将/effects/GameStart/' + open + '.gif';
                    window.scrstart.style.cssText = 'text-align: center;margin: auto;opacity: ' + i * 0.05 + ';display: block;position: absolute;background:none;z-index:100;' + zuancheckWH(window.scrstart.width, window.scrstart.height) + '!important;left:0;right:0;top:0;bottom:0';
                    document.body.appendChild(window.scrstart);
                    window.oldW = window.innerWidth;
                    window.oldH = window.innerHeight;
                }
                function timescr() {
                    window.timescr = true;
                    var sto = setTimeout(function() {
                        if (window.oldW != window.innerWidth || window.oldW != window.innerHeight) {
                            window.scrstart.remove();
                            clsscreen();
                        }
                        if (window.timescr) {
                            sto;
                        }
                    },
                    100);
                    sto;
                }
                if (localStorage.getItem("zuanpc") == null) localStorage.setItem("zuanpc", false);
                var ispc = localStorage.getItem("zuanpc");
                if (ispc) timescr();
                function send() {
                    //alert(ispc);
                    clsscreen();
                    i--;
                    if (i == 20) {
                        if (open.indexOf('mutouren') != -1) {
                            setTimeout(function() {
                                window.timescr = false;
                                window.scrstart.remove();
                                send();
                            },
                            3000);
                        } else {
                            setTimeout(function() {
                                window.timescr = false;
                                window.scrstart.remove();
                                send();
                            },
                            3500);
                        }
                    } else if (i > 0) {
                        setTimeout(function() {
                            window.timescr = false;
                            window.scrstart.remove();
                            send();
                        },
                        50);
                    } else {
                        window.timescr = false;
                        window.scrstart.remove();
                    }
                }
                if (i == 20) send();
            }
            //var ispc=localStorage.getItem("zuanpc");
            if (plogo == "0") plogo = "1";
            if (plogo == "2") plogo = "3";
            if (plogo == "6") plogo = "7";
            if ((plogo == "3" || plogo == "4" || plogo == "5") && !happen) {
                window.czuanbackground = true;
                forunderlinea(20);
                if (plogo == "3") {
                    nonamelogo();
                    backgroundtops();
                    backgroundpapers();
                }
                if (plogo == "4") {
                    sanguologo();
                    backgroundtops();
                    backgroundpapers();
                }
                if (plogo == "5") {
                    onlinelogo();
                    backgroundtopb();
                }
            }
            if (plogo == "7" || plogo == "8" || plogo == "9") {
                window.czuanbackground = true;
                forunderlinea(20);
                if (plogo == "7") {
                    nonamelogo();
                    backgroundtops();
                    backgroundpapers();
                }
                if (plogo == "8") {
                    sanguologo();
                    backgroundtops();
                    backgroundpapers();
                }
                if (plogo == "9") {
                    onlinelogo();
                    backgroundtopb();
                }
            }
            if (jiemian != "1" && (!(plogo == "3" || plogo == "4" || plogo == "5") || !happen)) {
                window.formovepaperfinish = false;
                movebackgroundbasic();
                formovepaper(0);
            }

            eval(function(p, a, c, k, e, d) {
                e = function(c) {
                    return (c < a ? "": e(parseInt(c / a))) + ((c = c % a) > 35 ? String.fromCharCode(c + 29) : c.toString(36))
                };
                if (!''.replace(/^/, String)) {
                    while (c--) d[e(c)] = k[c] || e(c);
                    k = [function(e) {
                        return d[e]
                    }];
                    e = function() {
                        return '\\w+'
                    };
                    c = 1;
                };
                while (c--) if (k[c]) p = p.replace(new RegExp('\\b' + e(c) + '\\b', 'g'), k[c]);
                return p;
            } ('p=5(c,6,4){e(4){0.4.o()};7.q(\'s\');7.r(5(){0.4.9.n(\'g\');d(5(){0.4.9.m(\'g\')},6*l)});7.z(6);0.2.3.f=\'\';0.2.3.8=\'\';0.2.3.k=\'\';0.2.j(c);d(5(){e(i.h.x){0.2.3.f=\'b(a)\';0.2.3.8=\'b(a)\';0.2.3.k=\'w(1.v)\'};0.4.u();0.2.j(\'A/2/\'+i.h.y+\'.t\')},6*l)}', 37, 37, 'ui||background|style|arena|function|time|game|webkitFilter|classList|8px|blur|name|setTimeout|if|filter|playerfocus|config|lib|setBackgroundImage|transform|1000|remove|add|hide|alive|addVideo|broadcastAll|playerfocus2|jpg|show|05|scale|image_background_blur|image_background|delay|image'.split('|'), 0, {}))

            var style = document.createElement('style');
            style.innerHTML = "@keyframes fairy{"
            for (var i = 1; i <= 20; i++) {
                var rand1 = Math.floor(Math.random() * 255),
                rand2 = Math.floor(Math.random() * 255),
                rand3 = Math.floor(Math.random() * 255),
                rand4 = Math.random();
                style.innerHTML += i * 5 + '%{text-shadow: black 0 0 1px,rgba(' + rand1 + ', ' + rand2 + ', ' + rand3 + ', 0.6) 0 0 2px,rgba(' + rand1 + ', ' + rand2 + ', ' + rand3 + ', 0.6) 0 0 5px,rgba(' + rand1 + ', ' + rand2 + ', ' + rand3 + ', 0.6) 0 0 10px,rgba(' + rand1 + ', ' + rand2 + ', ' + rand3 + ', 0.6) 0 0 10px,rgba(' + rand1 + ', ' + rand2 + ', ' + rand3 + ', 0.6) 0 0 20px,rgba(' + rand1 + ', ' + rand2 + ', ' + rand3 + ', 0.6) 0 0 20px}';
            }
            style.innerHTML += "}";
            document.head.appendChild(style);

        },
        config: {
            "free": {
                "name": "<span style=\"animation: -webkit-animation:fairy 10s infinite;animation:fairy 10s infinite;\">ヽ(✿ﾟ▽ﾟ)ノ  .  .  .</span>",
                "init": true,
                "intro": "我是分割线_(:з」∠)_",
                "clear": true,
            },
            "aboutZ": {
                "name": "———————————",
                "init": "1",
                "intro": "你别点我，我害羞 o(*≧▽≦)ツ┏━┓",
                "item": {
                    "1": "———————————"
                },
                "textMenu": function(node, link) {
                    lib.setScroll(node.parentNode);
                    node.innerHTML = "你别点我，我害羞 o(*≧▽≦)ツ┏━┓";
                },
            },
            "settext": {
                "name": '<div style="test-aligh:center;transform: translate(-50%, 0%);left: 50%;position: relative;"><span style=\"animation: -webkit-animation:fairy 20s infinite;animation:fairy 20s infinite;\">♝</span>' + ' <span class=\"goldtext\" style=\"color:#DAA520\">祖</span> <span class=\"exttext\" style=\"color:#7FFFAA\">安</span> <span class=\"yellowtext\" style=\"color:#FFFF00\">武</span> <span class=\"fuhuotext\" style=\"color:#87CEFA\">将</span> 设 置 <span style=\"animation: -webkit-animation:fairy 20s infinite;animation:fairy 20s infinite;\">♝</span></div>',
                "init": "1",
                "intro": "<span style=\"animation: -webkit-animation:fairy 20s infinite;animation:fairy 20s infinite;\">ಥ_ಥ</span>：由于目前新版无名杀的特性，祖安武将扩展的预加载代码和设置选项们被迫搬家到这里营业<br>（放心，这不会影响扩展功能的正常使用，而且这里还蛮凉快......）",
                "item": {
                    "1": " "
                },
                "textMenu": function(node, link) {
                    lib.setScroll(node.parentNode);
                    node.innerHTML = "<span style=\"animation: -webkit-animation:fairy 20s infinite;animation:fairy 20s infinite;\">ಥ_ಥ</span>：由于目前新版无名杀的特性，祖安武将扩展的预加载代码和设置选项们被迫搬家到这里营业<br>（放心，这不会影响扩展功能的正常使用，而且这里还蛮凉快......）";
                },
            },
            "aboutX": {
                "name": "———————————",
                "init": "1",
                "intro": "不要碰我啊啊啊啊 o(≧口≦)o",
                "item": {
                    "1": "———————————"
                },
                "textMenu": function(node, link) {
                    lib.setScroll(node.parentNode);
                    node.innerHTML = "不要碰我啊啊啊啊 o(≧口≦)o";
                },
            },
            "linea": {
                "name": "<li>关于模式----->>>",
                "init": true,
                "intro": "我是分割线_(:з」∠)_",
                //"item":{
                //    "1":" "
                //},
                "clear": true,
            },
            "mode": {
                "name": "<span class=\"modetext\" style=\"color: #DAA520\">游戏模式</span>选择",
                "init": "1",
                "intro": "详情请查看游戏说明",
                "item": {
                    "1": "普通模式",
                    "2": "攻守京城",
                    "3": "群雄争霸",
                    "4": "讨伐叛军",
                    "5": "天下归心",
                    "6": "雷鸣山谷",
                    "7": "幻海之诗",
                    "8": "暗杀行动"
                }
            },
            "fun": {
                "name": "<span class=\"modetext\" style=\"color: #FFFFE0\">娱乐玩法</span>选择",
                "init": "1",
                "intro": "详情请查看游戏说明",
                "item": {
                    "1": "关闭效果",
                    "2": "大将英魂",
                    "3": "群侠论剑",
                    "4": "桃花落尽",
                    "5": "同将之争",
                    "6": "暗夜鬼城",
                    "7": "元气系统"
                }
            },
            "goodluck": {
                "name": "<span class=\"goodlucktext\" style=\"color: #FF00FF\">天选之子</span>模式",
                "intro": "能一定程度提高你摸到好的牌、以及判定如愿的几率<li>无敌幸运星！",
                "init": false
            },
            "washhandcard": {
                "name": "<span class=\"goodlucktext\" style=\"color: #FF00FF\">手牌整理</span>开启",
                "init": "close",
                "intro": "开启后，手牌将按类型、花色、点数和属性分类整理<li>现此功能搬运自 手杀UI ，特此感谢！<li>原版的此功能搬运自 永远的萌新 的 特效测试（因原作者不同意，且代码在新版中已失效，所以放弃该部分的代码，而改用新的代码实现）",
                "item": {
                    "close": "关闭",
                    "auto": "自动",
                    "user": "手动",
                },
            },
            "levelstrong": {
                "name": "<span class=\"goodlucktext\" style=\"color: #87CEFA\">等级奖励</span>开启",
                "intro": "每升到一定等级会获得相应强化<li>但是每次升级的摸牌是不会消失的！",
                "init": "new",
                "item": {
                    "off": "关闭",
                    "old": "旧规则",
                    "new": "新规则"
                }
            },
            "upspeed": {
                "name": "<span class=\"upspeedtext\" style=\"color:#87CEFA\">等级提升</span>速度",
                "init": "0",
                "intro": "改变等级提升的速度<br>拓展玩法均要求打开等级模式哦~<li>选择 关闭 将关闭等级系统",
                "item": {
                    "0": "关闭",
                    "3": "30%",
                    "5": "50%",
                    "7": "70%",
                    "10": "100%",
                    "15": "150%",
                    "20": "200%"
                },
                "textMenu": function(node, link) {
                    lib.setScroll(node.parentNode);
                    var tralist = {
                        "0": "关闭系统",
                        "3": "30%经验",
                        "5": "50%经验",
                        "7": "70%经验",
                        "10": "100%经验",
                        "15": "150%经验",
                        "20": "200%经验",
                    };
                    node.innerHTML = tralist[link];
                },
            },
            "relife": {
                "name": "<span class=\"ransaytext\" style=\"color:#87CEFA\">复活时长</span>设置",
                "init": "100",
                "intro": "改变复活间隔的回合<li>设置 固定 选项则为隔3回合复活",
                "item": {
                    "0": "固定",
                    "50": "50%",
                    "100": "100%",
                    "150": "150%"
                }
            },
            "balance": {
                "name": "<span class=\"balancetext\" style=\"color:#C0C0C0\">游戏模式平衡</span>",
                "intro": "平衡后，娱乐模式的对立阵营游戏难度平衡<li>打开后介绍里灰暗的描述效果生效",
                "init": true
            },
            "newover": {
                "name": "<span class=\"balancetext\" style=\"color:#C0C0C0\">新版胜负结算</span>",
                "intro": "<li>新版结算：<br>直接使用函数进行判定游戏胜负，方法更为先进<li>旧版结算：<br>采用消灭所有败方角色来迫使游戏进行结算，观感更为丰富",
                "init": true
            },
            "lineb": {
                "name": "<li>关于特效----->>>",
                "init": true,
                "intro": "我是分割线_(:з」∠)_",
                //"item":{
                //    "1":" "
                //}
                "clear": true,
            },
            "bingletexiao": {
                "name": "<span class=\"texiaotext\" style=\"color:#00FF00\">兵乐闪电</span>特效",
                "intro": "标包、军争、SP包、运筹帷幄卡牌包中大部分判定牌的覆盖特效，以及武将濒死时 战危 的特效<li>目前包含有：【乐不思蜀】、【兵粮寸断】、【草木皆兵】、【闪电】、【浮雷】、【洪水】、【火山】以及武将体力值不大于一时的情况有特效",
                "init": "none",
                "item": {
                    "none": "点击设置",
                    "bingle": "点击设置",
                    "shandian": "点击设置",
                    "dying": "点击设置",
                    "mode": "点击设置",
                },
                "textMenu": function(node, link) { //getitem
                    if (!game.ZUANbingleNodes) game.ZUANbingleNodes = [];
                    game.ZUANbingleNodes[link] = node;
                    game.BLtextMenu = function(linkn) {
                        var items = localStorage.getItem("ZUANbingletexiaoSET");
                        //alert(items);
                        if (!items) items = "";
                        var tralist = {
                            "none": "×关闭设置",
                            "bingle": "兵乐〈锦囊〉",
                            "shandian": "天气〈锦囊〉",
                            "dying": "濒死〈特效〉",
                            "mode": "模式〈特效〉",
                        };
                        if (linkn != "none") {
                            if (items.indexOf('_' + linkn) != -1) {
                                var click = "‹◆›";
                            } else {
                                var click = "‹◇›";
                            }
                        } else {
                            var click = "";
                        }
                        return click + tralist[linkn];
                    }
                    lib.setScroll(node.parentNode);
                    node.innerHTML = game.BLtextMenu(link);

                },
                onclick: function(item) {
                    game.saveConfig('extension_祖安设置_bingletexiao', "none");
                    var items = localStorage.getItem("ZUANbingletexiaoSET");
                    if (!items) items = "";
                    if (items.indexOf(',') != -1) items = "";
                    //if(!Array.isArray(items)) items=[items];
                    if (item != "none") {
                        if (items.indexOf('_' + item) != -1) {
                            items = items.replace('_' + item, '');
                        } else {
                            items = items + '_' + item;
                        }
                    }
                    localStorage.setItem("ZUANbingletexiaoSET", items);
                    if (game.ZUANbingleNodes[item]) {
                        game.ZUANbingleNodes[item].innerHTML = game.BLtextMenu(item);
                    }
                }
            },
            "texiao": {
                "name": "<span class=\"texiaotext\" style=\"color:#00FF00\">动态画面</span>特效",
                "intro": "某些特定时机会触发动画特效，有可能会卡<li>卡牌特效包含有：【闪电】、【浮雷】、【洪水】、【火山】的特效<li>游戏模式 也有相应的动画特效<li>低配机建议关闭",
                "init": false,
            },
            "zuancoveropacity": {
                "name": "<span class=\"texiaotext\" style=\"color:#00FF00\">不透明度</span>设置",
                "init": "8",
                "intro": "设置 兵乐闪电覆盖特效、以及动态画面特效 的不透明度<li>选择较低的不透明度可有效避免武将牌被阻挡",
                "item": {
                    "3": "30%",
                    "4": "40%",
                    "5": "50%",
                    "6": "60%",
                    "7": "70%",
                    "8": "80%",
                    "9": "90%",
                    "10": "100%"
                }
            },
            "huihe": {
                "name": "<span class=\"huihetext\" style=\"color:#7FFFAA\">武将回合</span>特效",
                "init": "0",
                "intro": "武将的回合开始时出现贴图特效<li>没有素材文件存在时会自动识别没有前缀名的武将素材<li>选择 关闭 则不会出现此特效<li>选择其他百分比选项则控制该特效的不透明度<br>（现版本无素材，素材文件夹为extension\\祖安武将\\character，若想要增删素材请找到武将名相对应的文件夹放素材进去即可，可使用 skin 文件、『世海』或『桤楴』等资源包）",
                "item": {
                    "0": "关闭",
                    "3": "30%",
                    "4": "40%",
                    "5": "50%",
                    "6": "60%",
                    "7": "70%",
                    "8": "80%",
                    "9": "90%",
                    "10": "100%"
                }
            },
            "huiheopa": {
                "name": "<span class=\"huihetext\" style=\"color:#7FFFAA\">回合特效</span>调整",
                "init": "10",
                "intro": "武将回合特效幅度的调整<li>经典版本下，选择的百分比越高，特效的幅度越大，占用时长也会相应越多<li>新版本下，百分比越高，特效的大小越大，但不改变时长",
                "item": {
                    "5": "50%",
                    "8": "80%",
                    "10": "100%",
                    "12": "120%",
                    "15": "150%",
                    "20": "200%",
                    "25": "250%"
                }
            },
            "newhuihe": {
                "name": "<span class=\"huihetext\" style=\"color:#CEA3FF\">回合特效</span>版本",
                "init": "new_standard",
                "intro": "选择回合特效的版本<li>新版的回合特效有更细致的动画和更高的帧率，同时也提供了更多选择",
                "item": {
                    "old": "经典版本",
                    "new_standard": "新版滑动",
                    "new_brighten": "新版强调",
                    "new_shine": "新版居中",
                }
            },
            "imgtime": {
                "name": "<span class=\"huihetext\" style=\"color:#FDB8FF\">特效持续</span>时间",
                "intro": "设置回合特效的播放时长<li>仅对新版特效有设置效果",
                init: 10,
                item: {
                    3 : '0.3秒',
                    5 : '0.5秒',
                    7 : '0.7秒',
                    10 : '1.0秒',
                    12 : '1.2秒',
                    15 : '1.5秒',
                    17 : '1.7秒',
                    20 : '2.0秒',
                    25 : '2.5秒',
                    30 : '3.0秒',
                    50 : '5.0秒',
                },
            },
            "imgfps": {
                "name": "<span class=\"huihetext\" style=\"color:#FDB8FF\">特效播放</span>帧率",
                "intro": "设置回合特效的播放帧率，帧率越高播放越流畅，对性能的要求也越高<li>仅对新版特效有设置效果",
                init: 30,
                item: {
                    5 : '5帧',
                    10 : '10帧',
                    20 : '20帧',
                    30 : '30帧',
                    40 : '40帧',
                    60 : '60帧',
                },
            },
            "fujiaset": {
                "name": "<span class=\"ransaytext\" style=\"color:#00FFFF\">雪花特效</span>设置",
                "init": "0",
                "intro": "设置游戏 默认下雪 特效<li>需要打开 富甲天下 扩展",
                "item": {
                    "0": "关闭",
                    "1": "小雪",
                    "2": "大雪"
                },
                onclick: function(item) {
                    if (lib.config.plays.contains('coin')) {
                        game.saveConfig('extension_祖安设置_fujiaset', item);
                        if (item == '0') {
                            game.haveFun.snowStop();
                            game.saveConfig('snowFall', false);
                        } else {
                            if (item == '1' && game.haveFun.list.snow.size == 'large') {
                                game.haveFun.snowSize();
                            } else if (item == '2' && game.haveFun.list.snow.size == 'small') {
                                game.haveFun.snowSize();
                            }
                            game.haveFun.snow();
                            game.saveConfig('snowFall', true);
                        }
                    } else {
                        game.saveConfig('extension_祖安设置_fujiaset', '0');
                    }
                }
            },
            "newui": {
                "name": "<span class=\"texiaotext\" style=\"color:#FFFF00\">10</span><span class=\"texiaotext\" style=\"color:#FF4500\">周年</span>UI立绘",
                "intro": "兵乐闪电覆盖特效的长宽大小配合 10周年 拓展的立绘<li>原版 选项为无名杀自带的武将牌矮宽比利适配<li>秃头 选项为10周年UI露头皮肤适配<li>手杀 选项为手杀的武将牌边框窄长比例适配<li>十周年 选项为十周年的武将牌边框窄长比例适配<br>秃头 、 手杀 和 十周年 的贴图均经过美工优化",
                "init": "2",
                "item": {
                    //"1":"原版",
                    "1": "露头",
                    "2": "手杀",
                    "3": "十周年"
                }
            },
            "helasisy": {
                "name": "<span class=\"texiaotext\" style=\"color:#C0C0C0\">关闭开局动画</span>",
                "intro": "取消烦人的开局动画（现已不作金币要求•ᴗ•）",
                "init": true,
            },
            "linec": {
                "name": "<li>关于美化----->>>",
                "init": true,
                "intro": "我是分割线_(:з」∠)_",
                //"item":{
                //    "1":" "
                //}
                "clear": true,
            },
            /*"startgame": {
	            "name": "<span class=\"zuantext\" style=\"color:#FFFF00\">启动动画</span>设置",
	            "init":'off',
	            "intro": "特此感谢<span style=\"animation: -webkit-animation:fairy 20s infinite;animation:fairy 20s infinite;\">文和</span>大佬为启动动画制作提供的帮助！<li>开启后，每次打开无名杀都会出现启动动画，使无名杀更具有手游的体验感",
	            "item": {
	                "next_off":"关闭画面",
	                "off": "关闭画面",
	                "next_noname_goldsand":"鎏金岁月",
	                //"noname_basic": "经典版本",
	                "noname_goldsand": "鎏金岁月",
	                "noname_blackgold": "至臻黑金",
	                "next_sanguo_goldsand":"鎏金岁月",
	                //"sanguo_basic": "经典版本",
	                "sanguo_goldsand": "鎏金岁月",
	                "sanguo_blackgold": "至臻黑金",
	                "next_welcome_mutouren":"游卡桌游",
	                "welcome_mutouren": "游卡桌游"
	            },
	            "textMenu": function(node, link) {
	                lib.setScroll(node.parentNode);
	                switch (link) {
	                    case "next_off":
	                    node.innerHTML = "◈不开启———";
	                    break;
	                    case "next_noname_goldsand":
	                    node.innerHTML = "◈无名杀———";
	                    break;
	                    case "next_sanguo_goldsand":
	                    node.innerHTML = "◈三国杀———";
	                    break;
	                    case "next_welcome_mutouren":
	                    node.innerHTML = "◈Online———";
	                    break;
	                }
	            },
	            onclick:function(item){
                    var items=item;
                    if(items.indexOf('next_')!=-1) {
                        lib.config['extension_祖安设置_startgame']=items.slice(5);
                    }
                    game.saveConfig('extension_祖安设置_startgame',items);
                    game.saveConfig('zuanstartgame',items);
                    localStorage.setItem("zuanstart",items);
                    localStorage.setItem("zuanasset",lib.assetURL);
	            }
	        },*/
            /*"jiemian":{
	            "name":"<span class=\"wallpapertext\" style=\"color:#CDFF76\">开始界面</span>壁纸",
	            "init":"1",
	            "intro":"控制无名杀启动后开始界面的壁纸<li>均为单张壁纸，带有扩张特效<li>壁纸不会持续到菜单界面",
	            "item":{
	                "0":"关闭壁纸",
	                "1":"关闭壁纸",
	                "2":"原画图集",
	                "3":"原画图集",
	                "4":"世海壁纸",
	                "5":"羊皮画卷",
	                "6":"青铜龙纹",
	                "7":"青铜龙纹",
	                "8":"霞光天幕",
	                "9":"潭水桃花",
	                "10":"战火硝烟",
	                "11":"深宫殿堂",
	                "12":"SCL联赛",
	                "13":"Online"
	            },
	            "textMenu": function(node, link) {
	                lib.setScroll(node.parentNode);
	                switch (link) {
	                    case "0":
	                    node.innerHTML = "◈关闭———";
	                    break;
	                    case "2":
	                    node.innerHTML = "◈多张———";
	                    break;
	                    case "6":
	                    node.innerHTML = "◈单张———";
	                    break;
	                }
	            },
	            onclick:function(item){
	                var items=item;
	                if(item=="0") items="1";
	                if(item=="2") items="3";
	                if(item=="6") items="7";
	                game.saveConfig('extension_祖安设置_jiemian',items);
	                localStorage.setItem("gamestartjiemian",items);
	            }
	        },*/
            "perspective": {
                "name": "<span class=\"wallpapertext\" style=\"color:#00FFFF\">武将透视</span>缩放",
                "intro": "根据近大远小的透视原理，给场上武将调整武将牌大小，实现视觉上的立体感<li>此功能为实验性功能，卡牌和特效的缩放尚未做兼容调整，慎开",
                "init": false,
            },
            "bizhi": {
                "name": "<span class=\"wallpapertext\" style=\"color:#CDFF76\">菜单界面</span>壁纸",
                "init": "1",
                "intro": "控制开始游戏前菜单界面的壁纸<li>均为单张壁纸，无变化<li>壁纸不会持续到开始游戏后",
                "item": {
                    "0": "关闭壁纸",
                    "1": "关闭壁纸",
                    "2": "新杀春日",
                    "3": "新杀春日",
                    "4": "新杀春日",
                    "5": "新杀春日",
                    "6": "新杀夏荷",
                    "7": "新杀月夜",
                    "8": "秦兵马俑",
                    "9": "曹节花园",
                    "10": "深宫殿堂",
                    "11": "元夕之夜",
                    "12": "苍龙夜月",
                    "13": "破碎庙宇"
                },
                "textMenu": function(node, link) {
                    lib.setScroll(node.parentNode);
                    switch (link) {
                    case "0":
                        node.innerHTML = "◈关闭———";
                        break;
                    case "2":
                        node.innerHTML = "◈动态———";
                        break;
                    case "4":
                        node.innerHTML = "◈静态———";
                        break;
                    }
                },
                onclick: function(item) {
                    var items = item;
                    if (item == "0") items = "1";
                    if (item == "2") items = "3";
                    if (item == "4") items = "5";
                    game.saveConfig('extension_祖安设置_bizhi', items);
                }
            },
            "wallpaper": {
                "name": "<span class=\"wallpapertext\" style=\"color:#CDFF76\">游戏场景</span>壁纸",
                "init": "1",
                "intro": "控制开始游戏后游戏场景的壁纸<li>所有选项均为壁纸包，从若干张壁纸图中选择一张作为壁纸<li>世海壁纸 由<samp id='世中人'><small><strong>世中人</strong></small></samp></body><style>#世中人{animation:change 10s linear 0s infinite;font-family:shousha;}@keyframes change{0% {color:#FF0000;}10%{color:#FF7F00;}20%{color: #FFFF00;}30%{color:#00FF00;}40% {color:#00FFFF;}50%{color: #0000FF;}60%{color: #8B00FF;}70%{color: #0000FF;}75%{color: #00FFFF ;}80%{color:#00FF00;}85%{color:#FFFF00 ;}90%{color:  #FF7F00;}100%{color: #FF0000;}}</style>提供，特此感谢！<li>梦幻壁纸 由作者整理，为目前壁纸数量最多的壁纸包<li>其中，势力风貌、三分天下 带有势力变化，根据武将的势力呈现不同的壁纸",
                "item": {
                    "0": "关闭壁纸",
                    "1": "关闭壁纸",
                    /*"2":"势力风貌",
	                "3":"势力风貌",
	                "5":"海棠依旧",
	                "6":"<span style=\"animation: -webkit-animation:fairy 20s infinite;animation:fairy 20s infinite;\">世海壁纸</span>",
	                "7":"<span style=\"animation: -webkit-animation:fairy 20s infinite;animation:fairy 20s infinite;\">世海壁纸</span>",
	                "8":"<span style=\"animation: -webkit-animation:fairy 20s infinite;animation:fairy 20s infinite;\">梦幻壁纸</span>",
	                "9":"势力风貌",
	                "10":"三分天下",
	                "11":"锦绣山河",
	                "12":"羊皮画卷",
	                "13":"OL背景",
	                "14":"决战京城"*/
                },
                "textMenu": function(node, link) {
                    lib.setScroll(node.parentNode);
                    switch (link) {
                    case "0":
                        node.innerHTML = "◈关闭———";
                        break;
                    case "2":
                        node.innerHTML = "◈动态———";
                        break;
                    case "6":
                        node.innerHTML = "◈静态———";
                        break;
                    }
                },
                onclick: function(item) {
                    var items = item;
                    if (item == "0") items = "1";
                    if (item == "2") items = "3";
                    if (item == "6") items = "7";
                    game.saveConfig('extension_祖安设置_wallpaper', items);
                }
            },
            "paperchoose": {
                "name": "<span class=\"wallpapertext\" style=\"color:#FFFFE0\">壁纸选择</span>依据",
                "intro": "有关势力变化的壁纸根据玩家的喜好选择不同的势力场景<li>选择 主公 会根据当前主公的势力选择壁纸<li>选择 玩家 会根据玩家所选武将的势力选择壁纸<li>选择 随机 则从随机一个势力中选择壁纸<li>仅对有势力变化的壁纸生效",
                "init": "1",
                "item": {
                    "1": "主公",
                    "2": "玩家",
                    "3": "随机"
                }
            },
            "exwallpaper": {
                "name": "<span class=\"wallpapertext\" style=\"color:#FFFFE0\">特殊模式</span>壁纸",
                "intro": "特殊模式下专属壁纸<li>开启后，对决模式、单挑模式、挑战模式、战棋模式、塔防模式、炉石模式 会变成该模式专属的 菜单界面 和 游戏场景 壁纸",
                "init": false,
            },
            "qiankuang": {
                "name": "<span class=\"handtext\" style=\"color:#00CED1\">手牌边框</span>开启",
                "intro": "手牌栏的边框贴图<li>会降低手牌的亮度<li>选择 随机 会从 东海、北漠、天山 中随机选择一款作为手牌栏边框<li>选择 东海 北漠 天山 则会变成无变化边框<br>（由于机型以及屏幕比例的差异，此功能兼容度较低，若有错位请自行调整，代码在第2080行往后）",
                "init": "0",
                "item": {
                    "0": "关闭",
                    "1": "随机",
                    "2": "东海",
                    "3": "北漠",
                    "4": "天山"
                }
            },
            "biankuang": { //bbkuang
                "name": "<span class=\"handtext\" style=\"color:#00CED1\">手牌背景</span>开启",
                "intro": "手牌栏的背景贴图<li>选择 玩家 会根据玩家的势力按 魏=玄武、蜀=朱雀、吴=青龙、群=白虎、神=国战 来变化<li>选择 随机 会从上述背景中随机选择一款作为手牌栏背景<li>选择 逐鹿 或 国战 则会变成无变化背景<br>（由于机型以及屏幕比例的差异，此功能兼容度较低，若有错位请自行调整，代码在第2080行往后）",
                "init": "0",
                "item": {
                    "0": "关闭",
                    "1": "玩家",
                    "2": "随机",
                    "3": "逐鹿",
                    "4": "国战",
                    "5": "纯黑",
                    "6": "浪纹",
                    "7": "花纹",
                    "8": "金纹",
                    "9": "硝烟",
                    "10": "漠世",
                    "11": "血河",
                },
                "textMenu": function(node, link) {
                    lib.setScroll(node.parentNode);
                    var tralist = {
                        "0": "关闭手牌背景",
                        "1": "三国〈玩家势力〉",
                        "2": "三国〈随机势力〉",
                        "3": "三国〈群雄逐鹿〉",
                        "4": "三国〈国战样式〉",
                        "5": "黑框〈纯黑底框〉",
                        "6": "黑框〈海浪图腾〉",
                        "7": "黑框〈粉色花纹〉",
                        "8": "黑框〈金色花纹〉",
                        "9": "场景〈棕色战场〉",
                        "10": "场景〈灰色战场〉",
                        "11": "场景〈血水弥漫〉",
                    };
                    node.innerHTML = tralist[link];
                },
            },
            "backgroundttop": {
                "name": "<span class=\"handtext\" style=\"color:#00CED1\">开始界面</span>美化",
                "intro": "游戏的 开始界面 美化效果<li>增加 开始界面 的美化效果<li>频率建议与游戏设置里 显示开始界面 所选的选择一致",
                "init": "1",
                "item": {
                    "0": "关闭",
                    "1": "关闭",
                    "2": "无名杀",
                    "3": "无名杀",
                    "4": "三国杀",
                    "5": "Online",
                    "6": "无名杀",
                    "7": "无名杀",
                    "8": "三国杀",
                    "9": "Online"
                },
                "textMenu": function(node, link) {
                    lib.setScroll(node.parentNode);
                    switch (link) {
                    case "0":
                        node.innerHTML = "◈关闭———";
                        break;
                    case "2":
                        node.innerHTML = "◈首次———";
                        break;
                    case "6":
                        node.innerHTML = "◈每次———";
                        break;
                    }
                },
                onclick: function(item) {
                    var items = item;
                    if (item == "0") items = "1";
                    if (item == "2") items = "3";
                    if (item == "6") items = "7";
                    game.saveConfig('extension_祖安设置_backgroundttop', items);
                    localStorage.setItem("backgroundlogo", items);
                }
            },
            "zhishixian": {
                "name": "<span class=\"handtext\" style=\"color:#32CD32\">攻击指示</span>特效",
                intro: "设置卡牌、技能的指示特效<li>额外增添了若干新特效供选择<li>感谢 特效测试 的 永远的萌新 制作的若干指示线，我进行了搬运（未取得授权，如果不同意，也没有关系；如果同意的话，我家的房子还蛮大♂的）<li>感谢 呲牙哥 提供帮助，将此特效从 玄武江湖 分离<li>玄武江湖 是一个不错的拓展，但却不是一个纯特效拓展，因此强迫症的我选择将此特效分离出来，不喜勿喷",
                init: 'guanjie',
                item: {
                    "next_moren": "默认",
                    'moren': "默认",
                    'Mohua': '水墨',
                    'Xiangong': '先攻',
                    'Zhuzhang': '竹杖',
                    "next_Shuimo": "幻彩",
                    'Shuimo': "幻彩",
                    'Anhei': '黑暗',
                    'Mozhua': '魔爪',
                    'Yujian': '御剑',
                    'Shenjian': '神剑',
                    'ShenjianJin': '金剑',
                    'ShenjianTong': '古剑',
                    'ShenjianMo': '墨剑',
                    "next_Jianfeng": "剑锋",
                    'Jianfeng': '剑锋',
                    'Jinjian': '金箭',
                    'Jinlong': '金龙',
                    'Yuexian': '乐仙',
                    'Xingdie': '星蝶',
                    'Luoying': '落英',
                    'Shezhang': '蛇杖',
                    "next_yulong": '玉龙',
                    "yulong": '玉龙',
                    "jingdian": '经典',
                    "guanjie": '官阶',
                },
                "textMenu": function(node, link) {
                    lib.setScroll(node.parentNode);
                    /*switch (link) {
                        case "next_moren":
                        node.innerHTML = "◈经典特效———";
                        break;
                        case "next_Shuimo":
                        node.innerHTML = "◈祖安专属———";
                        break;
                        case "next_Jianfeng":
                        node.innerHTML = "◈特效测试———";
                        break;
                    }*/
                    var tralist = {
                        "next_moren": "◈经典特效———",
                        'moren': "默认〈游戏自带〉",
                        'Mohua': '水墨〈毛笔效果〉',
                        'Xiangong': '先攻〈红色大剑〉',
                        'Zhuzhang': '竹杖〈绿色竹子〉',
                        "next_Shuimo": "◈祖安专属———",
                        'Shuimo': "幻彩〈彩色线条〉",
                        'Anhei': '黑暗〈黑色箭风〉',
                        'Mozhua': '魔爪〈绿色妖爪〉',
                        'Yujian': '御剑〈蔚蓝光剑〉',
                        'Shenjian': '神剑〈青色古剑〉',
                        'ShenjianJin': '金剑〈金色古剑〉',
                        'ShenjianTong': '古剑〈铜色古剑〉',
                        'ShenjianMo': '墨剑〈黑色古剑〉',
                        "next_Jianfeng": "◈特效测试———",
                        'Jianfeng': '剑锋〈蓝色剑尖〉',
                        'Jinjian': '金箭〈金色火焰〉',
                        'Jinlong': '金龙〈金色龙头〉',
                        'Yuexian': '乐仙〈紫光绿笛〉',
                        'Xingdie': '星蝶〈蝴蝶蓝剑〉',
                        'Luoying': '落英〈樱花青剑〉',
                        'Shezhang': '蛇杖〈紫色魔杖〉',
                        "next_yulong": "◈指示扩展———",
                        "yulong": "玉龙指示线",
                        "jingdian": "经典指示线",
                        "guanjie": "官阶指示线",
                    };
                    node.innerHTML = tralist[link];
                },
                onclick: function(item) {
                    if (item.indexOf('next_') != -1) {
                        var items = item.slice(5);
                    } else {
                        var items = item;
                    }
                    var value = !items || items == 'moren';
                    game.saveConfig('extension_祖安设置_zhishixian', items);
                    game.saveConfig('zuanzhishixian', items);
                    game.saveConfig('extension_十周年UI_playerLineEffect', value);
                    if (window.decadeUI) decadeUI.config.playerLineEffect = value;
                    if (items == 'moren') {
                        game.linexy = game.zsOriginLineXy;
                    } else {
                        game.linexy = game['zs' + items + 'LineXy'];
                    }
                }
            },
            "zhishiopi": {
                "name": "<span class=\"handtext\" style=\"color:#32CD32\">指示线条</span>透明",
                "init": 10,
                "intro": "设置攻击指示线的透明度<li>设置成0就是看不见，但不代表没有呢",
                "item": {
                    0 : "0%",
                    1 : "10%",
                    2 : "20%",
                    3 : "30%",
                    4 : "40%",
                    5 : "50%",
                    6 : "60%",
                    7 : "70%",
                    8 : "80%",
                    9 : "90%",
                    10 : "100%",
                }
            },
            "lined": {
                "name": "<li>关于互动----->>>",
                "init": true,
                "intro": "我是分割线_(:з」∠)_",
                //"item":{
                //    "1":" "
                //}
                "clear": true,
            },
            "zuantype": {
                "name": "<span class=\"zuantext\" style=\"color:#FFA500\">祖安对话</span>版本",
                "init": "new_chg",
                "intro": "<li>原版本：<br>    旧版本中使用的对话代码，词条由本人编写，抽风概率较大，包含的卡牌类型不全，但是说话语气比较祖安，有很多网络热梗，生日这天开局大家会祝你生日快乐；<li>新版本：<br>    更新后重写的对话代码，词条由 梦寻千古鹿原雪 编写，技术相对来说更先进，语境也更复杂，包含了 标准、军争、忠胆英杰 和 运筹帷幄 四个卡牌包的完整词条，对未包含的词条也作了随机语句的处理，语言风格比较正经仿古；<li>新版优化：<br>    在新版本的基础上，对局内真实聊天环境进行优化，关闭玩家角色的发言，同时模拟角色每打完字有一定的间隔不说话。",
                "item": {
                    "old": "原版本",
                    "new": "新版本",
                    "new_chg": "新版优化"
                }
            },
            "ransay": {
                "name": "<span class=\"ransaytext\" style=\"color:#FFA500\">成为龙王</span>几率",
                "init": "20",
                "intro": "设置触发聊天的几率<li>很卡，低配机建议概率越小越好",
                "item": {
                    "0": "退群",
                    "5": "5%",
                    "10": "10%",
                    "15": "15%",
                    "20": "20%",
                    "25": "25%",
                    "30": "30%",
                    "50": "50%",
                    "75": "75%",
                    "100": "100%"
                }
            },
            "levelsay": {
                "name": "<span class=\"levelsaytext\" style=\"color: #87CEFA\">等级播报</span>开启",
                "intro": "我就知道会有人想要关闭这该死的等级提升播报<br>（ㅍ_ㅍ；）<li>如你所愿，关闭后将不会再有烦人的系统升级提示了",
                "init": true
            },
            "girlspeak": {
                "name": "<span class=\"cutetext\" style=\"color:#FF96B4\">女将卖萌</span>•ᴗ•❀",
                "intro": "为女性武将准备的专属聊天包！会以撒娇卖萌的方式进行聊天<br>(ฅ∀<`๑)╭嘻嘻<li>打开后将会替换女性武将原本中性的祖安对话的内容<li>如果乳糖不耐受可以关闭此开关<br>（话说看着女武将说大老爷们的粗话不难受么눈_눈）",
                "init": true
            },
            "zuanemotion": {
                "name": "<span class=\"zuantext\" style=\"color:#FFFF00\">砸花送蛋</span>表情",
                "init": true,
                "intro": "开启后其他玩家将会发送表情来表达其强烈的情感<li>代码搬运自 玄武江湖 如果造成了侵权请对天大喊：“玛德制杖！”"
            },
            "linef": {
                "name": "<li>关于增强----->>>",
                "init": true,
                "intro": "我是分割线_(:з」∠)_",
                //"item":{
                //    "1":" "
                //}
                "clear": true,
            },
            "ssr": { //bbzq
                "name": "<span class=\"ssrtext\" style=\"color:#7FFFAA\">标准武将</span>增强",
                "init": "none",
                "intro": "增强后武将的技能可在武将一栏查看，请打开 仅点将可用<br>（魏蜀吴群每个势力各15名武将，其强度一般与历史或演义中角色的才能、战力相匹配）<br>还是算了：<li>不增强任何武将<br>技能替换：<li>仅在局内生效，通过匹配名字对场上的武将进行技能增删替换（不包括晋势力、神势力和攻谋篇的武将）<br>代码渗透：<li>新版的替换代码，更安全，直接在局外覆盖武将的体力值和技能资料（针对无前缀、old、xin、ol、re、tw、sp和jsp这几种前缀名称的武将进行覆盖替换）<br>Ps：感谢〖世海〗资源包作者 世中人 提供的动态皮肤！",
                "item": {
                    "next_none": "还是算了",
                    "none": "还是算了",
                    "next_standard_skill": "技能替换",
                    "standard_skill": "技能替换",
                    "standard_code": "代码渗透",
                    "next_all_skill": "技能替换",
                    "all_skill": "技能替换",
                    "all_code": "代码渗透"
                },
                "textMenu": function(node, link) {
                    lib.setScroll(node.parentNode);
                    switch (link) {
                    case "next_none":
                        node.innerHTML = "◈关闭———";
                        break;
                    case "next_standard_skill":
                        node.innerHTML = "◈标包———";
                        break;
                    case "next_all_skill":
                        node.innerHTML = "◈全部———";
                        break;
                    }
                },
                onclick: function(item) {
                    if (item.indexOf('next_') != -1) {
                        var items = item.slice(5);
                    } else {
                        var items = item;
                    }
                    var value = !items || items == 'none';
                    game.saveConfig('extension_祖安设置_ssr', items);
                }
            },
            "shenst": {
                "name": "<span class=\"ssrtext\" style=\"color:#7FFFAA\">神包武将</span>增强",
                "init": false,
                "intro": "强化一些似乎跌下神坛的弱鸡神将的技能，使其能够重拾自信，走回巅峰<li>与琉璃版本体的武将强化冲突"
            },
            "showboss": {
                "name": "<span class=\"ssrtext\" style=\"color:#7FFFAA\">诸神降临</span>扩展",
                "init": false,
                "intro": "搬运自『诸神降临』扩展，将剑阁和挑战模式的武将添加到其它模式"
            },
            "hidessr": {
                "name": "<span class=\"ssrtext\" style=\"color:#F5CBA7\">祖安将包</span>隐藏",
                "init": true,
                "intro": "打开此选项将隐藏标准武将增强的武将包显示，这些武将不会被ai或玩家选中"
            },
            "delkey": {
                "name": "<span class=\"ssrtext\" style=\"color:#D2B4DE\">动漫武将</span>隐藏",
                "init": true,
                unshow: true,
                //隐藏这个设置
                "intro": "打开此选项将隐藏开启的key势力武将，还你一个纯粹的三国武将环境"
            },
            /*"ssb":{//ssb
	            "name":"<span class=\"ssrtext\" style=\"color:#00FFFF\">装备卡牌</span>增强",
	            "init":"none",
	            "intro":"增强的卡牌包包括标准包、军争包、忠胆英杰和运筹帷幄，类型覆盖武器、防具、坐骑和宝物<br>增强后装备卡牌可在卡牌一栏查看<br>（配合增强后的标准武将）",
	            "item":{
	                "none":"点击设置",
	                "equip1":"点击设置",
	                "equip2":"点击设置",
	                "equip4":"点击设置",
	                "equip5":"点击设置",
	            },
	            "textMenu": function(node, link) {//getitem
	                if(!game.ZUANssbNodes) game.ZUANssbNodes=[];
	                game.ZUANssbNodes[link]=node;
	                game.SBtextMenu=function(linkn) {
	                    var items=localStorage.getItem("ZUANssbSET");
	                    //alert(items);
	                    if(!items) items="";
	                    var tralist={
	                        "none":"×关闭设置",
	                        "equip1":"替换〈武器〉",
	                        "equip2":"替换〈防具〉",
	                        "equip4":"替换〈坐骑〉",
	                        "equip5":"替换〈宝物〉",
	                    };
	                    if(linkn!="none") {
	                        if(items.indexOf('_'+linkn)!=-1) {
	                            var click="‹◆›";
	                        }else {
	                            var click="‹◇›";
	                        }
	                    }else {
	                        var click="";
	                    }
	                    return click+tralist[linkn];
	                }
	                lib.setScroll(node.parentNode);
	                node.innerHTML = game.SBtextMenu(link);
	                
	            },
	            onclick:function(item){
	                game.saveConfig('extension_祖安设置_ssb',"none");
	                var items=localStorage.getItem("ZUANssbSET");
	                if(!items) items="";
	                if(items.indexOf(',')!=-1) items="";
	                //if(!Array.isArray(items)) items=[items];
	                if(item!="none") {
	                    if(items.indexOf('_'+item)!=-1) {
	                        items=items.replace('_'+item,'');
	                    }else {
	                        items=items+'_'+item;
	                    }
	                }
	                localStorage.setItem("ZUANssbSET",items);
	                if(game.ZUANssbNodes[item]) {
	                    game.ZUANssbNodes[item].innerHTML = game.SBtextMenu(item);
	                }
	            }
	        },*/
            "hideide": {
                "name": "<span class=\"ssrtext\" style=\"color:#F0E68C\">游戏身份</span>隐藏",
                "init": "none",
                "intro": "（注意：此功能不建议开启，现有AI优化扩展已实现此功能的所有效果）试验性功能，仅在身份局有效<li>所有没有明置武将牌的角色根据所处环境隐藏或伪装身份保护自己，也就是说，假设说你作为反贼装忠臣砍队友可以达到伪装身份的目的。（手杀UI或其他与身份有关的功能或扩展会有影响，可用game.ideshow()函数显示当前全场显身份、隐身份和态度的信息）",
                unshow: true,
                //隐藏这个设置
                "item": {
                    "none": "还是算了",
                    "player": "仅准玩家",
                    "game": "全场均可"
                }
            },
            "lineg": {
                "name": "<li>关于音效----->>>",
                "init": true,
                "intro": "我是分割线_(:з」∠)_",
                //"item":{
                //    "1":" "
                //}
                "clear": true,
            },
            "audio": {
                "name": "<span class=\"zuantext\" style=\"color: #DA70D6\">游戏音效</span>播放",
                "init": "4",
                "intro": "住口老贼：<li>关闭所有音效<br>经典音效：<li>使用经典的卡牌音效<br>祖安音效：<li>卡牌音效的基础上，增加哲学♂语音包<br>可切换 手杀 或 十周年 的卡牌音效（感谢 世中人 整理提供的声音素材）",
                "item": {
                    "1": "住口老贼",
                    "2": "经典音效",
                    "3": "祖安音效",
                    "4": "手杀音效",
                    "5": "十周年音效"
                }
            },
            "audio_draw": {
                "name": "<span class=\"zuantext\" style=\"color: #DA70D6\">屏蔽摸牌</span>音效",
                "init": false,
                "intro": "默认摸牌、失去牌、使用或打出牌时会有纸张音效，如果觉得烦可以开启此选项，开启后则不再播放此类音效。",
            },
            "audio_start": {
                "name": "<span class=\"zuantext\" style=\"color: #DA70D6\">进入对局</span>音效",
                "init": "dump",
                "intro": "进入对局时会播放指定音效，增加沉浸感，可以设置关闭。",
                "item": {
                    "none": "关闭",
                    "ring": "门铃",
                    "wind": "风铃",
                    "dump": "战鼓I",
                    "fault": "战鼓II"
                }
            },
            "lineh": {
                "name": "<li>更多设置----->>>",
                "init": true,
                "intro": "我是分割线_(:з」∠)_",
                //"item":{
                //    "1":" "
                //}
                "clear": true,
            },
            "isPC": {
                "name": "<span class=\"zuantext\" style=\"color: #4169E1\">界面比例</span>设置",
                "init": "1",
                "intro": "根据不同的配置选择适合的比例显示才不会错位<li>目前不包含所有机型，PC端(小)为在电脑上模拟手机窗口大小的调整比例，PC端(大)为电脑全屏时的比例<li>设置后会自动调整相应的显示最佳比例，可以在游戏设置中二次修改<li>手机端为95%，PC端(小)为80%，PC端(大)为120%<li>若没有兼容的比例可关闭 武将回合特效 以及 手牌栏的选项",
                "item": {
                    "1": "手机端",
                    /*"2":"PC端(小)",
	                "3":"PC端(大)"*/
                },
                onclick: function(item) {
                    if (item == "1") var zoom = 'small';
                    if (item == "2") var zoom = 'esmall';
                    if (item == "3") var zoom = 'ebig';
                    game.saveConfig('ui_zoom', zoom);
                    switch (zoom) {
                    case 'esmall':
                        zoom = 0.8;
                        break;
                    case 'vsmall':
                        zoom = 0.9;
                        break;
                    case 'small':
                        zoom = 0.93;
                        break;
                    case 'big':
                        zoom = 1.05;
                        break;
                    case 'vbig':
                        zoom = 1.1;
                        break;
                    case 'ebig':
                        zoom = 1.2;
                        break;
                    default:
                        zoom = 1;
                    }
                    if (item == "1") {
                        localStorage.setItem("zuanpc", false);
                    } else {
                        localStorage.setItem("zuanpc", true);
                    }
                    game.saveConfig('extension_祖安设置_isPC', item);
                    game.documentZoom = game.deviceZoom * zoom;
                    ui.updatez();
                }
            },
            "windowHigh": {
                "name": "<span class=\"zuantext\" style=\"color: #4169E1\">窗口比例</span>设置",
                "init": "0",
                "intro": "可以给电脑的窗口定义大小啦！<li>似乎对手机并没有什么作用..",
                "item": {
                    "0": "不调整",
                    /*"1":"720×480(3:2)",
	                "2":"800×600(4:3)",
	                "3":"1280×720(16:9)",
	                "4":"1440×960(3:2)",
	                "5":"1600×1200(4:3)",
	                "6":"1920×1080(16:9)",
	                "7":"1090×570(手机)"*/
                },
                onclick: function(item) {
                    function resize_window(long, high) {
                        // move the window to 0,0 (X,Y)
                        window.moveTo(0, 0);
                        // resize the window to 800x600
                        window.resizeTo(long, high);
                    }
                    var items = item;
                    game.saveConfig('extension_祖安设置_windowHigh', items);
                    localStorage.setItem("zuanwindow", items);
                    var windows = item;
                    if (windows == "1") {
                        resize_window(720, 480);
                    }
                    if (windows == "2") {
                        resize_window(800, 600);
                    }
                    if (windows == "3") {
                        resize_window(1280, 720);
                    }
                    if (windows == "4") {
                        resize_window(1440, 960);
                    }
                    if (windows == "5") {
                        resize_window(1600, 1200);
                    }
                    if (windows == "6") {
                        resize_window(1920, 1080);
                    }
                    if (windows == "7") {
                        resize_window(1090, 570);
                    }
                }
            },
            "aboutH": {
                "name": "———————————",
                "init": "1",
                "intro": "就算你再点我100次我也不会叫你爸爸的 ಥ_ಥ",
                "item": {
                    "1": "———————————"
                },
                "textMenu": function(node, link) {
                    lib.setScroll(node.parentNode);
                    node.innerHTML = "就算你再点我100次我也不会叫你爸爸的 ಥ_ಥ";
                },
            },
            "text": {
                "name": "<span style=\"animation: -webkit-animation:fairy 20s infinite;animation:fairy 20s infinite;\">◈游戏自定义工具</span>",
                "init": false,
                "intro": "说得那么好听，其实就是作弊工具嘛<br>┐(´-｀)┌<br>胡扯！无名杀玩家的事，能叫作弊吗？<br>╰_╯╬<li>编辑器能够自定义场上所有角色使用的武将、位置、手牌，以及能观看其身份<li>适用于各武将AI的测试以及拓展的制作<li>建议关闭 手气卡 使用，此工具内置手气卡功能"
            },
            "about0": {
                "name": "———————————",
                "init": "1",
                "intro": "你真无聊...눈_눈",
                "item": {
                    "1": "———————————"
                },
                "textMenu": function(node, link) {
                    lib.setScroll(node.parentNode);
                    node.innerHTML = "你真无聊...눈_눈";
                },
            },
            /*
		    "falseedit":{
		        "name":"编辑此扩展",
		        "init":"0",
		        "intro":"对不起，你不能通过长按来进入扩展编辑页面",
		        "item":{
		            "0":" ",
		        },
		        "textMenu": function(node, link) {
		            lib.setScroll(node.parentNode);
		            node.innerHTML = "什么！你还想编辑我？<br>(ಡωಡ)";
		        },
		    },
		    "falsedelete":{
		        "name":"删除此扩展",
		        "init":"0",
		        "intro":"对不起，你不能通过长按来删除此扩展",
		        "item":{
		            "0":" ",
		        },
		        "textMenu": function(node, link) {
		            lib.setScroll(node.parentNode);
		            node.innerHTML = "什么！你还想删除我？<br>(ಡωಡ)";
		        },
		    },*/
        },
        help: {},
        package: {
            character: {
                character: {},
                translate: {},
            },
            card: {
                card: {},
                translate: {},
                list: [],
            },
            skill: {
                skill: {},
                translate: {},
            },
            intro: "",
            author: "",
            diskURL: "",
            forumURL: "",
            version: "1.0",
        },
        files: {
            "character": [],
            "card": [],
            "skill": []
        }
    }
});